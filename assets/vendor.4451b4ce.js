var L2e=Object.defineProperty,N2e=Object.defineProperties;var F2e=Object.getOwnPropertyDescriptors;var N3=Object.getOwnPropertySymbols;var _Q=Object.prototype.hasOwnProperty,bQ=Object.prototype.propertyIsEnumerable;var vQ=(e,t,i)=>t in e?L2e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,F=(e,t)=>{for(var i in t||(t={}))_Q.call(t,i)&&vQ(e,i,t[i]);if(N3)for(var i of N3(t))bQ.call(t,i)&&vQ(e,i,t[i]);return e},ve=(e,t)=>N2e(e,F2e(t));var F3=(e,t)=>{var i={};for(var r in e)_Q.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&N3)for(var r of N3(e))t.indexOf(r)<0&&bQ.call(e,r)&&(i[r]=e[r]);return i};function u(e,t,i,r){var s,n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}let G0;function he(e){return typeof G0[e]=="function"?G0[e]=G0[e](globalThis):G0[e]}var Wle,Xle,Yle,Zle;G0=((Wle=globalThis.dojoConfig)==null?void 0:Wle.has)||((Xle=globalThis.esriConfig)==null?void 0:Xle.has)?F(F({},(Yle=globalThis.dojoConfig)==null?void 0:Yle.has),(Zle=globalThis.esriConfig)==null?void 0:Zle.has):{},he.add=(e,t,i,r)=>((r||G0[e]===void 0)&&(G0[e]=t),i&&he(e)),he.cache=G0,he.add("esri-deprecation-warnings",!0),(()=>{var t;he.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(he.add("host-browser",e),he.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),he.add("dom",e),he("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(he.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),he.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),he.add("khtml",s.includes("Konqueror")?n:void 0),he.add("edge",parseFloat(r.split("Edge/")[1])||void 0),he.add("opr",parseFloat(r.split("OPR/")[1])||void 0),he.add("webkit",!he("wp")&&!he("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),he.add("chrome",!he("edge")&&!he("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),he.add("android",!he("wp")&&parseFloat(r.split("Android ")[1])||void 0),he.add("safari",!s.includes("Safari")||he("wp")||he("chrome")||he("android")||he("edge")||he("opr")?void 0:parseFloat(s.split("Version/")[1])),he.add("mac",s.includes("Macintosh")),!he("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));he.add(o,l),he.add("ios",l)}he.add("trident",parseFloat(s.split("Trident/")[1])||void 0),he("webkit")||(!r.includes("Gecko")||he("wp")||he("khtml")||he("trident")||he("edge")||he.add("mozilla",n),he("mozilla")&&he.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&he.add("esri-mobile",t),i&&he.add("esri-iPhone",i),he.add("esri-geolocation",!!navigator.geolocation)}he.add("esri-canvas-svg-support",!he("trident")),he.add("esri-wasm","WebAssembly"in globalThis),he.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),he.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),he.add("esri-atomics","Atomics"in globalThis),he.add("esri-workers","Worker"in globalThis),he.add("web-feat:cache","caches"in globalThis),he.add("esri-workers-arraybuffer-transfer",!he("safari")||Number(he("safari"))>=12),he.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),he.add("featurelayer-simplify-payload-size-factors",[1,1,4]),he.add("featurelayer-snapshot-enabled",!0),he.add("featurelayer-snapshot-point-min-threshold",8e4),he.add("featurelayer-snapshot-point-max-threshold",4e5),he.add("featurelayer-snapshot-point-coverage",.1),he.add("featurelayer-advanced-symbols",!1),he.add("featurelayer-pbf",!0),he.add("featurelayer-pbf-statistics",!1),he.add("feature-layers-workers",!0),he.add("feature-polyline-generalization-factor",1),he.add("mapview-transitions-duration",200),he.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),he.add("mapserver-pbf-enabled",!1),he.add("mapimagelayer-popup-identify-max-tolerance",20),he.add("heatmap-allow-raster-fallback",!0),he.add("heatmap-force-raster",!1),he("host-webworker")||he("host-browser")&&(he.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),he.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{he.add("esri-image-decode",!0,!0,!0)}).catch(()=>{he.add("esri-image-decode",!1,!0,!0)})}return!1}),he.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();const j_=null;function _(e){return e!=null}function A(e){return e==null}function qs(e,t){return _(e)?t(e):j_}function Avt(e){return e}function U2e(e,t){if(A(e))throw new Error(t);return e}function vt(e,t){return _(e)?e:typeof t=="function"?t():t}function Rvt(e,t){return _(e)?e:t}function at(e){return _(e)&&e.destroy(),null}function Xe(e){return _(e)&&e.dispose(),null}function Js(e){return _(e)&&e.remove(),null}function Ah(e){return _(e)&&e.abort(),null}function Yi(e){return _(e)&&e.release(),null}function k2e(e,t,i){return _(e)&&_(t)?_(i)?i(e,t):e.equals(t):e===t}function z2e(e){return null}function Ovt(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);_(s)&&i.push(s)}),i}function Mvt(e,t){const i=new Array;for(const r of e)i.push(Kc(r,null,t));return i}function Pvt(e,t){for(const i of e)qs(i,t)}function Kc(e,t,i){return _(e)?i(e):t}function Ivt(e){return e.filter(t=>_(t))}function Tr(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function $vt(e){return e}class uh{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*uh._m:t}getInt(){return this._seed=(uh._a*this._seed+uh._c)%uh._m,this._seed}getFloat(){return this.getInt()/(uh._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/uh._m*r}}uh._m=2147483647,uh._a=48271,uh._c=0;function SM(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function wv(e,t,i){if(A(e)&&A(t))return!0;if(A(e)||A(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function RH(e,t){let i=e.length!==t.length;e.length=t.length;for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function B2e(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(o=>i(o,n))),s=e.filter(n=>!t.some(o=>i(o,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function V2e(e){return e&&typeof e.length=="number"}function G2e(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const j2e=!!Array.prototype.fill;function Dvt(e,t){if(j2e)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function H2e(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function ice(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}function rce(e){return e.reduce((t,i)=>t.concat(i||[]),[])}class sce{constructor(){this.last=0}}const nce=new sce;function oce(e,t,i,r){r=r||nce;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function c4(e,t,i,r){const s=i==null?e.length:i,n=oce(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const jh=new Set;function q2e(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;jh.clear();for(let a=0;a<r;++a)jh.add(t[a]);s=s||nce;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(jh.has(e[a])&&(n&&n.push(e[a]),jh.delete(e[a]),e[a]=e[i-1],--i,--a,jh.size===0||i===0))return jh.clear(),i;for(let a=0;a<o;++a)if(jh.has(e[a])&&(n&&n.push(e[a]),jh.delete(e[a]),e[a]=e[i-1],--i,--a,jh.size===0||i===0))return jh.clear(),i;return jh.clear(),i}function W2e(e){return e?(wQ.seed=e,()=>wQ.getFloat()):Math.random}function Lvt(e,t){const i=W2e(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const wQ=new uh;function OH(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}function X2e(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function MH(e,t,i){if(e.slice)return e.slice(t,i);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),i===void 0?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function EE(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function Y2e(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function F1(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function Z2e(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function ace(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function kL(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function lce(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function zL(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function cce(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function uce(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function Q2e(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function U3(e){return A(e)?0:128+e.buffer.byteLength+64}function hce(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&hce(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function ie(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=mce(e);if(_(t))return t;if(dce(e))return e.clone();if(pce(e))return e.map(ie);if(fce(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=ie(e[r]);return i}function _8(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=mce(e);if(_(t))return t;if(pce(e)){let i=!0;const r=e.map(s=>{const n=_8(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(dce(e))return e.clone();if(!fce(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=_8(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function dce(e){return typeof e.clone=="function"}function pce(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function fce(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function xQ(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function mce(e){if(Y2e(e)||F1(e)||Z2e(e)||ace(e)||kL(e)||lce(e)||zL(e)||cce(e)||uce(e))return MH(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((i,r)=>{t.set(r,ie(i))}),t}if(e instanceof Set){const t=new Set;return e.forEach(i=>{t.add(ie(i))}),t}return null}function PH(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function J2e(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&wv(e,t):e instanceof Set?t instanceof Set&&eEe(e,t):e instanceof Map?t instanceof Map&&tEe(e,t):!!xQ(e)&&xQ(t)&&K2e(e,t))}function K2e(e,t){if(e===null||t===null)return!1;const i=Object.keys(e);if(t===null||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}function eEe(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function tEe(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function gce(e,t,i=!1){return vce(e,t,i)}function W2(e,t){if(t!=null)return t[e]||yce(e.split("."),!1,t)}function lc(e,t,i){const r=e.split("."),s=r.pop(),n=yce(r,!0,i);n&&s&&(n[s]=t)}function yce(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function vce(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=r[s],o=t[s];return n===o?r:n===void 0?(r[s]=ie(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=vce(n,o,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=o),r)},e||{}):e}var Qle;const Di={apiKey:void 0,applicationUrl:(Qle=globalThis.location)==null?void 0:Qle.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(gce(Di,globalThis.esriConfig,!0),delete Di.has),!Di.assetsPath){const e="4.24.5";Di.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}Di.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(Di,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),Di.request.corsEnabledServers=[],Di.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const iEe=/\{([^\}]+)\}/g;function TQ(e){return e==null?"":e}function Ef(e,t){return e.replace(iEe,typeof t=="object"?(i,r)=>TQ(W2(r,t)):(i,r)=>TQ(t(r)))}function _ce(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function IH(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function Nvt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const SQ={info:0,warn:1,error:2,none:3};class fe{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,fe._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=fe.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=fe._loggers;return fe._loggers=t,i},set throttlingDisabled(t){fe._throttlingDisabled=t}}}static getLogger(t){let i=fe._loggers[t];return i||(i=new fe({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!fe._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=fe._tickCounter)return;this._loggedMessages[t].set(s,fe._tickCounter),fe._scheduleTickCounterIncrement()}for(const s of Di.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;_(r);){const s=r[t];if(_(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=Di.log.level?Di.log.level:"warn";return SQ[this._parentWithMember("level",i)]<=SQ[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return IH(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){fe._tickCounterScheduled||(fe._tickCounterScheduled=!0,Promise.resolve().then(()=>{fe._tickCounter++,fe._tickCounterScheduled=!1}))}}fe._loggers={},fe._tickCounter=0,fe._tickCounterScheduled=!1,fe._throttlingDisabled=!1;function Ws(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function Fvt(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function $H(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const lS=fe.getLogger("esri.core.Accessor");function rEe(e){return e==null?e:new Date(e)}function sEe(e){return e==null?e:!!e}function EM(e){return e==null?e:e.toString()}function hh(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function DH(e){return e==null?e:Math.round(parseFloat(e))}function bce(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function BL(e,t){return t!=null&&e&&!(t instanceof e)}function wce(e){return e&&"isCollection"in e}function EQ(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function nEe(e,t){if(!t||!t.constructor||!wce(t.constructor))return b8(e,t)?t:new e(t);const i=EQ(e.prototype.itemType),r=EQ(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(b8(e,t),t):new e(t):t}function b8(e,t){return!!bce(t)&&(lS.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+u4(e)+"'"),!0)}function LS(e,t){return t==null?t:wce(e)?nEe(e,t):BL(e,t)?b8(e,t)?t:new e(t):t}function u4(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const oEe=new WeakMap;function aEe(e){switch(e){case Number:return hh;case Lr:return DH;case Boolean:return sEe;case String:return EM;case Date:return rEe;default:return $H(oEe,e,()=>LS.bind(null,e))}}function Ds(e,t){const i=aEe(e);return arguments.length===1?i:i(t)}function KR(e,t,i){return arguments.length===1?KR.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function lEe(e,t){return arguments.length===1?KR(Ds.bind(null,e)):KR(Ds.bind(null,e),t)}function xce(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>xce(e,t-1,r)):e(i)}function VL(e,t,i){if(arguments.length===2)return VL.bind(null,e,t);if(!i)return i;let r=t,s=i=xce(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function cEe(e,t,i){return arguments.length===2?VL(Ds.bind(null,e),t):VL(Ds.bind(null,e),t,i)}function Tce(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function w8(e,t){if(arguments.length===2)return w8(e).call(null,t);const i=new Set,r=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!BL(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),lS.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>u4(p)).join(", ")),lS.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):lS.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function tp(e,t){if(arguments.length===2)return tp(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];i[l]=Ds(c),r.push(u4(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!BL(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=i[c];if(!h)return lS.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!BL(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!bce(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class Lr{}const Uvt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function uEe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function Sce(e){switch(e.type){case"native":return Ds(e.value);case"array":return KR(Sce(e.value));case"one-of":return hEe(e);default:return null}}function hEe(e){let t=null;return(i,r)=>T8(i,e)?i:(t==null&&(t=x8(e)),lS.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function x8(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Lr:return"integer";case Date:return"date";default:return u4(e.value)}case"array":return`array of ${x8(e.value)}`;case"one-of":{const t=e.values.map(i=>x8(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function T8(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case Lr:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!T8(i,t.value));case"one-of":return t.values.some(i=>T8(e,i))}}function dEe(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=W2(r,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class h4{constructor(t,i,r){this.name=t,this.details=r,this.message=void 0,this instanceof h4&&(this.message=i&&dEe(i,r)||"")}toString(){return"["+this.name+"]: "+this.message}}class Ma extends h4{constructor(t,i,r){if(super(t,i,r),!(this instanceof Ma))return new Ma(t,i,r)}}Ma.prototype.type="warning";function NS(e){return Rh(()=>e.forEach(t=>_(t)&&t.remove()))}function Rh(e){return{remove:()=>{e&&(e(),e=void 0)}}}function kvt(e){return Rh(_(e)?()=>e.destroy():void 0)}function pEe(e,t){const i=setTimeout(e,t);return Rh(()=>clearTimeout(i))}function Xo(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function fEe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function F$(e,t,i){return i?GL(e,t,{policy:i,path:""}):GL(e,t,null)}function GL(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace")return r[s]=t[s],r;if(r[s]===void 0)return r[s]=ie(t[s]),r;let a=r[s],l=t[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=GL(a,l,i),i.path=c}else r[s]=GL(a,l,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=l);return r},e||{}):e}function Ece(e){return Array.isArray(e)?e:e.split(".")}function CQ(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function mEe(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...CQ(i));return t}return CQ(e)}function Cce(e,t,i,r){const s=mEe(t);if(s.length!==1){const n=s.map(o=>r(e,o,i));return NS(n)}return r(e,s[0],i)}function LH(e){let t=!1;return()=>{t||(t=!0,e())}}class AQ{constructor(t){this.autoDestroy=!1,this.properties=t}}function CM(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const r=Object.create(t.properties),s=t.autoDestroy;for(const n in r)r[n]=ie(r[n]);t=new AQ(r),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new AQ({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function gEe(e){return CM(e).properties}function AM(e,t){const i=gEe(e);let r=i[t];return r||(r=i[t]={}),r}function yEe(e,t){return F$(e,t,_Ee)}const vEe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function _Ee(e){return vEe.test(e)?"replace":"merge"}function Ace(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const S8=fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function RQ(e,t,i){var r,s;e&&(!i&&!t.read||((r=t.read)==null?void 0:r.reader)||((s=t.read)==null?void 0:s.enabled)===!1||xEe(e)&&lc("read.reader",X2(e),t))}function X2(e){var i,r,s;const t=(i=e.ndimArray)!=null?i:0;if(t>1)return wEe(e);if(t===1)return OQ(e);if("type"in e&&Oce(e.type)){const n=(s=(r=e.type.prototype)==null?void 0:r.itemType)==null?void 0:s.Type,o=OQ(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return NH(e)}function NH(e){return"type"in e?bEe(e.type):TEe(e.types)}function bEe(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void S8.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function Rce(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>Rce(e,s,i,r-1)):e(t,void 0,i)}function wEe(e){var s;const t=NH(e),i=Rce.bind(null,t),r=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=i(n,a,r);let l=r,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function OQ(e){const t=NH(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function Oce(e){if(!Ace(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?FH(t.Type):Mce(t.Type))}function xEe(e){return"types"in e?Mce(e.types):FH(e.type)}function FH(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||Oce(e))}function Mce(e){for(const t in e.typeMap)if(!FH(e.typeMap[t]))return!1;return!0}function TEe(e){var r;let t=null;const i=(r=e.errorContext)!=null?r:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void S8.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=SEe(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Ma(`${i}:unsupported`,f,{definition:s,context:o})),void S8.error(f)}const p=new h;return p.read(s,o),p}}function SEe(e){var i,r;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=CM(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;((i=a.json)==null?void 0:i.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function Pce(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=Xo(t);return fEe(r,i)?r.get(i):t[i]}function Ice(e,t,i){if(e==null)return e;const r=Pce(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:Ice(r,t,i+1)}function RM(e,t,i=0){return typeof t!="string"||t.includes(".")?Ice(e,Ece(t),i):Pce(t,e)}function jL(e,t){return RM(e,t)}function MQ(e,t){return RM(t,e)!==void 0}class H extends h4{constructor(t,i,r){if(super(t,i,r),!(this instanceof H))return new H(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return ie(i)}catch{return"[object]"}}))}}catch(t){throw fe.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new H(t.name,t.message,t.details)}}H.prototype.type="error";function HL(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))HL(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void HL(jL(e,s),n,i)}const r=e.__accessor__;r!=null&&EEe(t,r),e[t]=i}}function EEe(e,t){if(he("esri-unknown-property-errors")&&!CEe(e,t))throw new H("set:unknown-property",AEe(e,t))}function CEe(e,t){return t.metadatas[e]!=null}function AEe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}fe.getLogger("esri.core.accessorSupport.set");function d(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=AM(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&fe.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=jL(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=jL(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){p!==void 0?this._override(i,p):this._clearOverride(i)}:function(p){HL(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=REe(o):a&&(Array.isArray(a)?s.cast=KR(tp(a[0])):s.cast=tp(a))),e.range&&(s.cast=OEe(s.cast,e.range)),yEe(s,e)}}function UH(e,t,i){const r=AM(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function REe(e){let t=0,i=e;if(uEe(e))return Sce(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(Tce(r))return t===0?w8(r):VL(w8(r),t);if(t===1)return lEe(r);if(t>1)return cEe(r,t);const s=e;return s.from?s.from:Ds(s)}function OEe(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}class xi{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=i,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&lc(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const i=this.apiToJSON[t];return this.options.useNumericKeys?+i:i}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function Ko(){return function(e,t){return new xi(e,F({ignoreUnknown:!0},t))}}function ot(e,t={}){var s;const i=e instanceof xi?e:new xi(e,t),r={type:((s=t==null?void 0:t.ignoreUnknown)!=null?s:1)?i.apiValues:String,json:{type:i.jsonValues,read:!(t==null?void 0:t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(r.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(r.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(r.json.name=t.name),d(r)}function Pe(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=UH(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}var uf;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(uf||(uf={}));var fr;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(fr||(fr={}));let qL,zC=[];const MEe=fe.getLogger("esri.core.Accessor");function Zt(e){qL!==void 0&&qL.onObservableAccessed(e)}let U$=!1,k$=!1;function Ag(e,t,i){if(U$)return kH(e,t,i);$ce(e);const r=t.call(i);return Dce(),r}function PEe(e,t){return Ag(void 0,e,t)}function kH(e,t,i){const r=U$;U$=!0,$ce(e);let s=null;try{s=t.call(i)}catch(n){k$&&MEe.error(n)}return Dce(),U$=r,s}function $ce(e){qL=e,zC.push(e)}function Dce(){const e=zC.pop();qL=zC.length>0?zC[zC.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function Lce(e,t){if(t.flags&fr.DepTrackingInitialized)return;const i=k$;k$=!1,t.flags&fr.AutoTracked?kH(t,t.metadata.get,e):Nce(e,t),k$=i}const IEe=[];function Nce(e,t){t.flags&fr.ExplicitlyTracking||(t.flags|=fr.ExplicitlyTracking,kH(t,()=>{const i=t.metadata.dependsOn||IEe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=Ece(r);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=PQ(o,s[n],n!==s.length-1)}else PQ(e,r,!1)}),t.flags&=~fr.ExplicitlyTracking)}function PQ(e,t,i){var n;const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=Xo(e))==null?void 0:n.properties.get(r);return s&&(Zt(s),Lce(e,s)),i?e[r]:void 0}function $Ee(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}function DEe(e){if(e.json||(e.json={}),$Q(e.json),DQ(e.json),IQ(e.json),e.json.origins)for(const t in e.json.origins)$Q(e.json.origins[t]),DQ(e.json.origins[t]),IQ(e.json.origins[t]);return!0}function IQ(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function $Q(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function DQ(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const LEe=fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function LQ(e,t){var r;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const i=(r=e==null?void 0:e.ndimArray)!=null?r:0;e&&(i===1||"type"in e&&Ace(e.type))?t.write.writer=UEe:i>1?t.write.writer=kEe(i):t.types?Array.isArray(t.types)?t.write.writer=FEe(t.types[0]):t.write.writer=NEe(t.types):t.write.writer=eO}function NEe(e){return(t,i,r,s)=>t?Fce(t,e,s)?eO(t,i,r,s):void 0:eO(t,i,r,s)}function Fce(e,t,i){var r,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i==null?void 0:i.messages){const n=(r=t.errorContext)!=null?r:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new H(`${n}:unsupported`,o,{definition:e,context:i})),LEe.error(o)}return!1}function FEe(e){return(t,i,r,s)=>!t||!Array.isArray(t)?eO(t,i,r,s):eO(t.filter(n=>Fce(n,e,s)),i,r,s)}function eO(e,t,i,r){lc(i,WL(e,r),t)}function WL(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?XL(e):e}function XL(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function UEe(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>WL(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[WL(e,r)],lc(i,s,t)}function Uce(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>Uce(r,t,i-1)):WL(e,t)}function kEe(e){return(t,i,r,s)=>{let n;if(t===null)n=null;else{n=Uce(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}lc(r,n,i)}}function E8(e,t){return zH(e,"read",t)}function kce(e,t){return zH(e,"write",t)}function zH(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function zEe(e){const t=BEe(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?VEe(r):t;RQ(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write=F({},e.json.write)),LQ(s,r)}RQ(t,e.json,!0),LQ(t,e.json)}function BEe(e){return e.json.types?C8(e.json):e.type?zce(e):C8(e)}function VEe(e){return e.type?zce(e):C8(e)}function zce(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!Tce(i);)i=i[0],t++;return{type:i,ndimArray:t}}function C8(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function GEe(e){DEe(e)&&($Ee(e),zEe(e))}const mk=new Set,gk=new Set;function P(e){return t=>{t.prototype.declaredClass=e,HEe(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!mk.has(s.initialize)&&(mk.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!gk.has(s.destroy)&&(gk.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);mk.clear(),gk.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<r.length;c++)r[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=CM(t.prototype),n.prototype.declaredClass=e,n}}function jEe(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;Zt(i);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function HEe(e){const t=e.prototype,i=CM(t).properties,r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];GEe(n),r[s]={enumerable:!0,configurable:!0,get:jEe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===uf.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,r)}function He(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=UH(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var FS;function qEe(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return FS.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return FS.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(FS||(FS={}));function zvt(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function Bvt(e,t){for(const i of e)if(i!=null&&t(i))return i}function Bce(e){return e!=null&&typeof e[Symbol.iterator]=="function"}function WEe(e){return e&&e.release&&typeof e.release=="function"}function XEe(e){return e&&e.acquire&&typeof e.acquire=="function"}class vs{constructor(t,i,r,s=1,n=0){if(this.ctor=t,this.acquireFunction=i,this.releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let o=0;o<n;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(vs.test.disabled)i=new this.ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this.ctor}i=this._pool.pop()}return this.acquireFunction?this.acquireFunction(i,...t):XEe(i)&&i.acquire(...t),i}release(t){t&&!vs.test.disabled&&(this.releaseFunction?this.releaseFunction(t):WEe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}vs.test={disabled:!1};var yi;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(yi||(yi={}));const A8=yi.USER+1;function ng(e){switch(e){case"defaults":return yi.DEFAULTS;case"service":return yi.SERVICE;case"portal-item":return yi.PORTAL_ITEM;case"web-scene":return yi.WEB_SCENE;case"web-map":return yi.WEB_MAP;case"user":return yi.USER}}function YL(e){switch(e){case yi.DEFAULTS:return"defaults";case yi.SERVICE:return"service";case yi.PORTAL_ITEM:return"portal-item";case yi.WEB_SCENE:return"web-scene";case yi.WEB_MAP:return"web-map";case yi.USER:return"user"}return void 0}function YEe(e){return YL(e)}class Vce{constructor(t,i){this._observers=t,this._observer=i}remove(){OH(this._observers,this._observer)}}class NQ{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=fr.Dirty|(r.nonNullable?fr.NonNullable:0)|(r.hasOwnProperty("value")?fr.HasDefaultValue:0)|(r.get===void 0?fr.DepTrackingInitialized:0)|(r.dependsOn===void 0?fr.AutoTracked:0)}destroy(){if(this.flags&fr.Dirty&&this._observers){const t=this._observers.slice();for(const i of t)i.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){Zt(this);const t=this.properties.store,i=this.propertyName,r=this.flags,s=t.get(i);if(r&fr.Computing||~r&fr.Dirty&&t.has(i))return s;this.flags|=fr.Computing;const n=this.properties.host;let o;r&fr.AutoTracked?o=Ag(this,this.metadata.get,n):(Nce(n,this),o=this.metadata.get.call(n)),t.set(i,o,yi.COMPUTED);const a=t.get(i);return a===s?this.flags&=~fr.Dirty:PEe(this.commit,this),this.flags&=~fr.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=fr.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new Vce(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&fr.Overriden&&(this.flags|=fr.Dirty);const t=this._observers;if(t!==null)for(let i=0;i<t.length;++i)t[i].onInvalidated()}commit(){this.flags&=~fr.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let i=0;i<t.length;++i)t[i].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class BH{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new BH;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,ie(r))}),i}get(t){return this._values.get(t)}originOf(){return yi.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function k3(e,t,i){return e!==void 0}function FQ(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&fr.NonNullable)||(r.lifecycle,uf.INITIALIZING,!1))}function ZEe(e){return e&&typeof e.destroy=="function"}fe.getLogger("esri.core.accessorSupport.Properties");class QEe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=uf.INITIALIZING,this.store=new BH,this._origin=yi.USER;const i=this.host.constructor.__accessorMetadata__,r=i.properties;for(const s in r){const n=new NQ(this,s,r[s]);this.properties.set(s,n)}this.metadatas=r,this._autoDestroy=i.autoDestroy}initialize(){this.lifecycle=uf.CONSTRUCTING}constructed(){this.lifecycle=uf.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,i]of this.properties){const r=this.internalGet(t);r&&ZEe(r)&&(r.destroy(),~i.flags&fr.NonNullable&&this._internalSet(i,null)),i.destroy()}else for(const[t,i]of this.properties)i.destroy()}get initialized(){return this.lifecycle!==uf.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();Zt(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.flags&fr.HasDefaultValue)return"defaults"}return YL(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(k3(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);k3(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!k3(s))return"";const n=new Set,o=Ag({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${r}${t.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof NQ))continue;const c=l.properties.host,h=l.propertyName,p=Xo(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(t,i,r){const s=this.properties.get(t);if(k3(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.flags&fr.Overriden)}clearOverride(t){const i=this.properties.get(t);i!==void 0&&i.flags&fr.Overriden&&(i.flags&=~fr.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!FQ(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(yk.release(n),!o)return;i=a}r.flags|=fr.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!FQ(r,t,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(yk.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=ng(t)}getDefaultOrigin(){return YL(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==uf.INITIALIZING?this._origin:yi.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&PH(i,s.get(n))&&~t.flags&fr.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),Lce(this.host,t))}_cast(t,i){const r=yk.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class JEe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const yk=new vs(JEe);function KEe(e){e.length=0}class Yl{constructor(t=50,i=50){this._pool=new vs(Array,void 0,KEe,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return vk.acquire()}static release(t){return vk.release(t)}static prune(){vk.prune()}}const vk=new Yl(100);class Gce extends vs{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=z2e(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const z3=[];function US(e){z3.push(e),z3.length===1&&queueMicrotask(()=>{const t=z3.slice();z3.length=0;for(const i of t)i()})}const eCe=29;class cv{constructor(t,i=eCe){this.name=t,this._counter=0,this._items=new Array(i)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,i)=>t-i)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,i)=>t+i,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var R8;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=r,e.iterableSort=s})(R8||(R8={}));const UQ=R8,tCe=1.5,iCe=1.1;class Vt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new sce,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>kQ(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,kQ(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=oce(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){const i=c4(this.data,t,this.length,this._hint);return i!==void 0&&(this.length=this.length-1),this._shrink(),i}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=q2e(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){t>=this.length||i>=this.length||t===i||([this.data[t],this.data[i]]=[this.data[i],this.data[t]])}sort(t){UQ.sort(this.data,0,this.length,t)}iterableSort(t){return UQ.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function kQ(e){e.data.length>tCe*e.length&&(e.data.length=Math.floor(e.length*iCe))}function rCe(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const d4=rCe(globalThis),zQ=new Set;function sCe(e,t,i=!1){i&&zQ.has(t)||(i&&zQ.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function nCe(e,t,i={}){if(he("esri-deprecation-warnings")){const{moduleName:r}=i;jce(e,`Property: ${(r?r+"::":"")+t}`,i)}}function jce(e,t,i={}){if(he("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),sCe(e,a,o)}}function p4(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function OM(e,t,i){if(!p4(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function Hce(e,t,i){if(!p4(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=OM(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}const oCe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function U1({key:e}){return oCe[e]||e}function di(e="Aborted"){return new H("AbortError",e)}function hi(e,t="Aborted"){if(Xs(e))throw di(t)}function f4(e){return _(e)?"aborted"in e?e:e.signal:e}function Xs(e){const t=f4(e);return _(t)&&t.aborted}function nc(e){if(jr(e))throw e}function O8(e){if(!jr(e))throw e}function Yo(e,t){const i=f4(e);if(!A(i)){if(!i.aborted)return Hce(i,"abort",()=>t());t()}}function VH(e,t){const i=f4(e);if(!A(i))return hi(i),Hce(i,"abort",()=>t(di()))}function aCe(e,t){const i=f4(t);return A(i)?e:new Promise((r,s)=>{let n=Yo(t,()=>s(di()));const o=()=>n=Js(n);e.then(o,o),e.then(r,s)})}function jr(e){return e&&e.name==="AbortError"}async function M8(e){try{return await e}catch(t){if(!jr(t))throw t}}async function Vvt(e,t=fe.getLogger("esri")){try{return await e}catch(i){jr(i)||t.error(i)}}function xv(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}async function Zo(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(o=>e[o]),s=await Zo(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function lCe(e){return(await Zo(e)).filter(t=>!!t.value).map(t=>t.value)}function kS(e,t,i){const r=new AbortController;return Yo(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);Yo(r,()=>{o&&(clearTimeout(o),n(di()))})})}function Eu(e){return e&&typeof e.then=="function"}function P8(e){return Eu(e)?e:Promise.resolve(e)}function GH(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(di()),n=xv();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||xv(),n=null,t>0){const f=new AbortController;i=P8(e(...l,f.signal));const m=i;kS(t).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=P8(e(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function ip(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>d4.setTimeout(()=>r.reject(n),s),r.promise=i,r}function Gvt(e,t){return e.then(t,t)}function MM(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),_(i)&&(i.remove(),i=null),r=null};return s.then(o,o),i=Yo(t,()=>{_(n)&&n.abort()}),n}async function BQ(e){await Promise.resolve(),hi(e)}function qce(e){return 1e3*e}function jH(e){return .001*e}class cCe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class uCe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let I8=0,$8=0;const CE={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},D8=["prepare","preRender","render","postRender","update","finish"],L8=[],Db=new Vt;class hCe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const ZL={frameTasks:Db,willDispatch:!1,clearFrameTasks:dCe,dispatch:Yce,executeFrameTasks:fCe};function Y2(e){const t=new uCe(e);return L8.push(t),ZL.willDispatch||(ZL.willDispatch=!0,US(Yce)),t}function Lb(e){const t=new cCe(e);return Db.push(t),QL==null&&(I8=performance.now(),QL=requestAnimationFrame(Wce)),new hCe(t)}let QL=null;function dCe(e=!1){Db.forAll(t=>{t.removed=!0}),e&&Xce()}function pCe(e){$8=Math.max(0,e)}function Wce(){const e=performance.now();QL=null,QL=Db.length>0?requestAnimationFrame(Wce):null,ZL.executeFrameTasks(e)}function fCe(e){const t=e-I8;I8=e;const i=$8>0?$8:1e3/60,r=Math.max(0,t-i);for(let s=0;s<D8.length;s++){const n=performance.now(),o=D8[s];Db.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(CE.time=e,CE.deltaTime=a.ticks===0?0:t,CE.elapsedFrameTime=performance.now()-e,CE.frameDuration=i-r,(l=a.phases[o])==null||l.call(a,CE)))}),mCe[s].record(performance.now()-n)}Xce(),gCe.record(performance.now()-e)}const B3=new Vt;function Xce(){Db.forAll(e=>{e.removed&&B3.push(e)}),Db.removeUnorderedMany(B3.data,B3.length),B3.clear()}function Yce(){for(;L8.length;){const e=L8.shift();e.isActive&&e.callback()}ZL.willDispatch=!1}function jvt(e=1,t){const i=ip(),r=()=>{Xs(t)?i.reject(di()):e===0?i():(--e,US(()=>r()))};return r(),i.promise}const mCe=D8.map(e=>new cv(e)),gCe=new cv("total");function z$(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}let yCe=0;const vCe=0;function hl(){return++yCe}class m4{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed;for(let r=0;r<i.length;++r)t.push(i[r].observe(this));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}let cS=!1;const JL=[];function Zce(e,t){let i=new m4(n),r=null,s=!1;function n(){if(!i||s)return;if(cS)return void Kce(n);const a=r;i.clear(),cS=!0,s=!0,r=Ag(i,e),s=!1,cS=!1,t(r,a),eue()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=Ag(i,e),s=!1,{remove:o}}function Qce(e,t){let i=new m4(s),r=null;function s(){t(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=Ag(i,e),r):null}return o(),{remove:n}}function Jce(e){let t=new m4(r),i=!1;function r(){t&&!i&&(cS?Kce(r):(t.clear(),cS=!0,i=!0,Ag(t,e),i=!1,cS=!1,eue()))}function s(){t&&(t.destroy(),t=null)}return i=!0,Ag(t,e),i=!1,{remove:s}}function Kce(e){JL.includes(e)||JL.unshift(e)}function eue(){for(;JL.length;)JL.pop()()}var oR;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(oR||(oR={}));class tO{constructor(){this.uid=hl(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(oR.Untracked,t,i,r,s,n,PH)}static acquireTracked(t,i,r,s){return this.pool.acquire(oR.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===oR.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,o,a){this.uid=hl(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=hl(),this.removed=!0}}tO.pool=new Gce(tO);const B$=new Yl,dg=new Set;let KL;function eN(e){dg.delete(e),dg.add(e),KL||(KL=Y2(wCe))}function _Ce(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function bCe(e){for(const t of dg.values())t.target===e&&(t.removed=!0)}function wCe(){let e=10;for(;KL&&e--;){KL=null;const t=xCe(),i=B$.acquire();for(const r of t){const s=r.uid;_Ce(r),s===r.uid&&r.removed&&i.push(r)}for(const r of dg)r.removed&&(i.push(r),dg.delete(r));for(const r of i)tO.pool.release(r);B$.release(i),B$.release(t),N8.forEach(r=>r())}}function xCe(){const e=B$.acquire();e.length=dg.size;let t=0;for(const i of dg)e[t]=i,++t;return dg.clear(),e}const N8=new Set;function tue(e){return N8.add(e),{remove(){N8.delete(e)}}}function TCe(e,t,i){let r=Cce(e,t,i,(s,n,o)=>{let a,l,c=Qce(()=>RM(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=tO.acquireUntracked(h,o,p,s,n),l=a.uid),eN(a))});return{remove:LH(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,eN(a)),a=null),r=c=null})}});return r}function SCe(e,t,i){const r=Cce(e,t,i,(s,n,o)=>{let a=!1;return Zce(()=>RM(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,PH(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function ECe(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?SCe(e,t,i):TCe(e,t,i)}function CCe(e,t,i){let r,s,n=Qce(e,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=tO.acquireTracked(o,t,a,i),s=r.uid),eN(r))});return{remove:LH(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,eN(r)),r=null),n=null})}}function ACe(e,t,i){let r=!1;return Zce(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function RCe(e,t,i=!1,r=J2e){return i?ACe(e,t,r):CCe(e,t,r)}function VQ(e){return z$(dg,t=>t.oldValue===e)}var iue;function OCe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const BC=Symbol("Accessor-Handles");class Ee{constructor(...t){if(this[iue]=null,this.constructor===Ee)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new QEe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}CM(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in i){const l=OCe(i[a]);d(l)(o.prototype,a)}return P(r)(o)}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(qs(this[BC],t=>{t.forEach(i=>i.remove())}),this[BC]=null,bCe(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===uf.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return jL(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return HL(this,t,i),this}watch(t,i,r){return ECe(this,t,i,r)}own(t){let i=this[BC];if(A(i)&&(i=this[BC]=new Set),Bce(t))for(const r of t)i.add(r);else i.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,i){return this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}iue=BC;class HH{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new HH;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,ie(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(r=(i=this._values.get(t))==null?void 0:i.origin)!=null?r:yi.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===yi.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new MCe(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===yi.DEFAULTS?t:yi.USER}}class MCe{constructor(t,i){this.value=t,this.origin=i}}function rue(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),yi.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),yi.DEFAULTS)})}function PCe(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&MQ(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&MQ(s,i))return!0;return!1}function ICe(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function $Ce(e,t,i,r,s){let n=E8(t[i],s);ICe(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=E8(t[o],s),PCe(n,i,r)&&(e[o]=!0)}function DCe(e,t,i,r){const s=i.metadatas,n=zH(s[t],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,r):o;a!==void 0&&i.set(t,a)}const sue={origin:"service"};function nue(e,t,i=sue){if(!t||typeof t!="object")return;const r=Xo(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))$Ce(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=E8(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?RM(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||DCe(e,o,r,i)}r.setDefaultOrigin("user")}function LCe(e,t,i,r=sue){var n;const s=ve(F({},r),{messages:[]});i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(o):e.loadWarnings.push(o)})}const NCe=fe.getLogger("esri.core.accessorSupport.write");function FCe(e,t,i,r,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,r,n,i,s),n}function oue(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(e,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new H("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&NCe.error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===yi.DEFAULTS)&&UCe(e,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<ng(n.origin))}function UCe(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,i);return wv(o,s)}return!1}return n===s}function kCe(e,t,i,r){const s=Xo(e),n=s.metadatas,o=kce(n[t],r);return!!o&&oue(e,s,t,o,i,r)}function aue(e,t,i){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return F$(t,e.toJSON(i));const r=Xo(e),s=r.metadatas;for(const a in s){const l=kce(s[a],i);if(!oue(e,r,a,l,void 0,i))continue;const c=e.get(a),h=FCe(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(t=F$(t,h),((o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)==null?void 0:o.length)&&Promise.all(i.resources.pendingOperations).then(()=>F$(t,h)),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:YEe(r.store.originOf(a)),newOrigin:i.origin}))}return t}const bw=e=>{let t=class extends e{constructor(...i){super(...i);const r=Xo(this),s=r.store,n=new HH;r.store=n,rue(r,s,n)}read(i,r){nue(this,i,r)}write(i={},r){return aue(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return zCe.call(this,i,r)}};return t=u([P("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function zCe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let ye=class extends bw(Ee){};ye=u([P("esri.core.JSONSupport")],ye);var yh;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(yh||(yh={}));let g;const L={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)L[g]=0;for(g=2056;g<=2065;g++)L[g]=0;for(g=2067;g<=2135;g++)L[g]=0;for(g=2137;g<=2154;g++)L[g]=0;for(g=2161;g<=2170;g++)L[g]=0;for(g=2172;g<=2193;g++)L[g]=0;for(g=2195;g<=2198;g++)L[g]=0;for(g=2200;g<=2203;g++)L[g]=0;for(g=2205;g<=2217;g++)L[g]=0;for(g=2222;g<=2224;g++)L[g]=1;for(g=2225;g<=2250;g++)L[g]=2;for(g=2251;g<=2253;g++)L[g]=1;for(g=2257;g<=2264;g++)L[g]=2;for(g=2274;g<=2279;g++)L[g]=2;for(g=2280;g<=2282;g++)L[g]=1;for(g=2283;g<=2289;g++)L[g]=2;for(g=2290;g<=2292;g++)L[g]=0;for(g=2308;g<=2313;g++)L[g]=0;for(g=2315;g<=2491;g++)L[g]=0;for(g=2494;g<=2866;g++)L[g]=0;for(g=2867;g<=2869;g++)L[g]=1;for(g=2870;g<=2888;g++)L[g]=2;for(g=2891;g<=2895;g++)L[g]=2;for(g=2896;g<=2898;g++)L[g]=1;for(g=2902;g<=2908;g++)L[g]=2;for(g=2915;g<=2920;g++)L[g]=2;for(g=2921;g<=2923;g++)L[g]=1;for(g=2924;g<=2930;g++)L[g]=2;for(g=2931;g<=2962;g++)L[g]=0;for(g=2964;g<=2968;g++)L[g]=2;for(g=2969;g<=2973;g++)L[g]=0;for(g=2975;g<=2991;g++)L[g]=0;for(g=2995;g<=3051;g++)L[g]=0;for(g=3054;g<=3079;g++)L[g]=0;for(g=3081;g<=3088;g++)L[g]=0;for(g=3092;g<=3101;g++)L[g]=0;for(g=3106;g<=3138;g++)L[g]=0;for(g=3146;g<=3151;g++)L[g]=0;for(g=3153;g<=3166;g++)L[g]=0;for(g=3168;g<=3172;g++)L[g]=0;for(g=3174;g<=3203;g++)L[g]=0;for(g=3294;g<=3358;g++)L[g]=0;for(g=3367;g<=3403;g++)L[g]=0;for(g=3408;g<=3416;g++)L[g]=0;for(g=3417;g<=3438;g++)L[g]=2;for(g=3441;g<=3446;g++)L[g]=2;for(g=3447;g<=3450;g++)L[g]=0;for(g=3451;g<=3459;g++)L[g]=2;for(g=3460;g<=3478;g++)L[g]=0;for(g=3554;g<=3559;g++)L[g]=0;for(g=3560;g<=3570;g++)L[g]=2;for(g=3571;g<=3581;g++)L[g]=0;for(g=3594;g<=3597;g++)L[g]=0;for(g=3601;g<=3604;g++)L[g]=0;for(g=3637;g<=3639;g++)L[g]=0;for(g=3665;g<=3667;g++)L[g]=0;for(g=3693;g<=3695;g++)L[g]=0;for(g=3701;g<=3727;g++)L[g]=0;for(g=3728;g<=3739;g++)L[g]=2;for(g=3740;g<=3751;g++)L[g]=0;for(g=3753;g<=3760;g++)L[g]=2;for(g=3761;g<=3773;g++)L[g]=0;for(g=3775;g<=3777;g++)L[g]=0;for(g=3779;g<=3781;g++)L[g]=0;for(g=3783;g<=3785;g++)L[g]=0;for(g=3788;g<=3791;g++)L[g]=0;for(g=3797;g<=3802;g++)L[g]=0;for(g=3814;g<=3816;g++)L[g]=0;for(g=3825;g<=3829;g++)L[g]=0;for(g=3832;g<=3841;g++)L[g]=0;for(g=3844;g<=3852;g++)L[g]=0;for(g=3873;g<=3885;g++)L[g]=0;for(g=3890;g<=3893;g++)L[g]=0;for(g=3907;g<=3912;g++)L[g]=0;for(g=3942;g<=3950;g++)L[g]=0;for(g=3968;g<=3970;g++)L[g]=0;for(g=3973;g<=3976;g++)L[g]=0;for(g=3986;g<=3989;g++)L[g]=0;for(g=3994;g<=3997;g++)L[g]=0;for(g=4048;g<=4051;g++)L[g]=0;for(g=4056;g<=4063;g++)L[g]=0;for(g=4093;g<=4096;g++)L[g]=0;for(g=4390;g<=4398;g++)L[g]=0;for(g=4399;g<=4413;g++)L[g]=2;for(g=4418;g<=4433;g++)L[g]=2;for(g=4455;g<=4457;g++)L[g]=2;for(g=4484;g<=4489;g++)L[g]=0;for(g=4491;g<=4554;g++)L[g]=0;for(g=4568;g<=4589;g++)L[g]=0;for(g=4652;g<=4656;g++)L[g]=0;for(g=4766;g<=4800;g++)L[g]=0;for(g=5014;g<=5016;g++)L[g]=0;for(g=5069;g<=5072;g++)L[g]=0;for(g=5105;g<=5130;g++)L[g]=0;for(g=5173;g<=5188;g++)L[g]=0;for(g=5253;g<=5259;g++)L[g]=0;for(g=5269;g<=5275;g++)L[g]=0;for(g=5292;g<=5311;g++)L[g]=0;for(g=5329;g<=5331;g++)L[g]=0;for(g=5343;g<=5349;g++)L[g]=0;for(g=5355;g<=5357;g++)L[g]=0;for(g=5387;g<=5389;g++)L[g]=0;for(g=5459;g<=5463;g++)L[g]=0;for(g=5479;g<=5482;g++)L[g]=0;for(g=5518;g<=5520;g++)L[g]=0;for(g=5530;g<=5539;g++)L[g]=0;for(g=5550;g<=5552;g++)L[g]=0;for(g=5562;g<=5583;g++)L[g]=0;for(g=5623;g<=5625;g++)L[g]=2;for(g=5631;g<=5639;g++)L[g]=0;for(g=5649;g<=5653;g++)L[g]=0;for(g=5663;g<=5680;g++)L[g]=0;for(g=5682;g<=5685;g++)L[g]=0;for(g=5875;g<=5877;g++)L[g]=0;for(g=5896;g<=5899;g++)L[g]=0;for(g=5921;g<=5940;g++)L[g]=0;for(g=6050;g<=6125;g++)L[g]=0;for(g=6244;g<=6275;g++)L[g]=0;for(g=6328;g<=6348;g++)L[g]=0;for(g=6350;g<=6356;g++)L[g]=0;for(g=6366;g<=6372;g++)L[g]=0;for(g=6381;g<=6387;g++)L[g]=0;for(g=6393;g<=6404;g++)L[g]=0;for(g=6480;g<=6483;g++)L[g]=0;for(g=6511;g<=6514;g++)L[g]=0;for(g=6579;g<=6581;g++)L[g]=0;for(g=6619;g<=6624;g++)L[g]=0;for(g=6625;g<=6627;g++)L[g]=2;for(g=6628;g<=6632;g++)L[g]=0;for(g=6634;g<=6637;g++)L[g]=0;for(g=6669;g<=6692;g++)L[g]=0;for(g=6707;g<=6709;g++)L[g]=0;for(g=6720;g<=6723;g++)L[g]=0;for(g=6732;g<=6738;g++)L[g]=0;for(g=6931;g<=6933;g++)L[g]=0;for(g=6956;g<=6959;g++)L[g]=0;for(g=7005;g<=7007;g++)L[g]=0;for(g=7057;g<=7070;g++)L[g]=2;for(g=7074;g<=7082;g++)L[g]=0;for(g=7109;g<=7118;g++)L[g]=0;for(g=7119;g<=7127;g++)L[g]=1;for(g=7374;g<=7376;g++)L[g]=0;for(g=7528;g<=7586;g++)L[g]=0;for(g=7587;g<=7645;g++)L[g]=2;for(g=7692;g<=7696;g++)L[g]=0;for(g=7755;g<=7787;g++)L[g]=0;for(g=7791;g<=7795;g++)L[g]=0;for(g=7799;g<=7801;g++)L[g]=0;for(g=7803;g<=7805;g++)L[g]=0;for(g=7825;g<=7831;g++)L[g]=0;for(g=7845;g<=7859;g++)L[g]=0;for(g=8013;g<=8032;g++)L[g]=0;for(g=8065;g<=8068;g++)L[g]=1;for(g=8518;g<=8529;g++)L[g]=2;for(g=8533;g<=8536;g++)L[g]=2;for(g=8538;g<=8540;g++)L[g]=2;for(g=8677;g<=8679;g++)L[g]=0;for(g=8836;g<=8840;g++)L[g]=0;for(g=8857;g<=8859;g++)L[g]=0;for(g=8908;g<=8910;g++)L[g]=0;for(g=9154;g<=9159;g++)L[g]=0;for(g=9205;g<=9218;g++)L[g]=0;for(g=9271;g<=9273;g++)L[g]=0;for(g=9295;g<=9297;g++)L[g]=0;for(g=9356;g<=9360;g++)L[g]=0;for(g=9404;g<=9407;g++)L[g]=0;for(g=9476;g<=9482;g++)L[g]=0;for(g=9487;g<=9494;g++)L[g]=0;for(g=9697;g<=9699;g++)L[g]=0;for(g=20002;g<=20032;g++)L[g]=0;for(g=20062;g<=20092;g++)L[g]=0;for(g=20135;g<=20138;g++)L[g]=0;for(g=20248;g<=20258;g++)L[g]=0;for(g=20348;g<=20358;g++)L[g]=0;for(g=20436;g<=20440;g++)L[g]=0;for(g=20822;g<=20824;g++)L[g]=0;for(g=20904;g<=20932;g++)L[g]=0;for(g=20934;g<=20936;g++)L[g]=0;for(g=21004;g<=21032;g++)L[g]=0;for(g=21035;g<=21037;g++)L[g]=0;for(g=21095;g<=21097;g++)L[g]=0;for(g=21148;g<=21150;g++)L[g]=0;for(g=21207;g<=21264;g++)L[g]=0;for(g=21307;g<=21364;g++)L[g]=0;for(g=21413;g<=21423;g++)L[g]=0;for(g=21453;g<=21463;g++)L[g]=0;for(g=21473;g<=21483;g++)L[g]=0;for(g=21780;g<=21782;g++)L[g]=0;for(g=21891;g<=21894;g++)L[g]=0;for(g=21896;g<=21899;g++)L[g]=0;for(g=22171;g<=22177;g++)L[g]=0;for(g=22181;g<=22187;g++)L[g]=0;for(g=22191;g<=22197;g++)L[g]=0;for(g=22234;g<=22236;g++)L[g]=0;for(g=22521;g<=22525;g++)L[g]=0;for(g=22991;g<=22994;g++)L[g]=0;for(g=23028;g<=23038;g++)L[g]=0;for(g=23830;g<=23853;g++)L[g]=0;for(g=23866;g<=23872;g++)L[g]=0;for(g=23877;g<=23884;g++)L[g]=0;for(g=23886;g<=23894;g++)L[g]=0;for(g=23946;g<=23948;g++)L[g]=0;for(g=24311;g<=24313;g++)L[g]=0;for(g=24342;g<=24347;g++)L[g]=0;for(g=24370;g<=24374;g++)L[g]=10;for(g=24375;g<=24381;g++)L[g]=0;for(g=24718;g<=24721;g++)L[g]=0;for(g=24817;g<=24821;g++)L[g]=0;for(g=24877;g<=24882;g++)L[g]=0;for(g=24891;g<=24893;g++)L[g]=0;for(g=25391;g<=25395;g++)L[g]=0;for(g=25828;g<=25838;g++)L[g]=0;for(g=26191;g<=26195;g++)L[g]=0;for(g=26391;g<=26393;g++)L[g]=0;for(g=26701;g<=26722;g++)L[g]=0;for(g=26729;g<=26799;g++)L[g]=2;for(g=26801;g<=26803;g++)L[g]=2;for(g=26811;g<=26813;g++)L[g]=2;for(g=26847;g<=26870;g++)L[g]=2;for(g=26891;g<=26899;g++)L[g]=0;for(g=26901;g<=26923;g++)L[g]=0;for(g=26929;g<=26946;g++)L[g]=0;for(g=26948;g<=26998;g++)L[g]=0;for(g=27037;g<=27040;g++)L[g]=0;for(g=27205;g<=27232;g++)L[g]=0;for(g=27258;g<=27260;g++)L[g]=0;for(g=27391;g<=27398;g++)L[g]=0;for(g=27561;g<=27564;g++)L[g]=0;for(g=27571;g<=27574;g++)L[g]=0;for(g=27581;g<=27584;g++)L[g]=0;for(g=27591;g<=27594;g++)L[g]=0;for(g=28191;g<=28193;g++)L[g]=0;for(g=28348;g<=28358;g++)L[g]=0;for(g=28402;g<=28432;g++)L[g]=0;for(g=28462;g<=28492;g++)L[g]=0;for(g=29118;g<=29122;g++)L[g]=0;for(g=29168;g<=29172;g++)L[g]=0;for(g=29177;g<=29185;g++)L[g]=0;for(g=29187;g<=29195;g++)L[g]=0;for(g=29900;g<=29903;g++)L[g]=0;for(g=30161;g<=30179;g++)L[g]=0;for(g=30491;g<=30494;g++)L[g]=0;for(g=30729;g<=30732;g++)L[g]=0;for(g=31251;g<=31259;g++)L[g]=0;for(g=31265;g<=31268;g++)L[g]=0;for(g=31275;g<=31279;g++)L[g]=0;for(g=31281;g<=31297;g++)L[g]=0;for(g=31461;g<=31469;g++)L[g]=0;for(g=31491;g<=31495;g++)L[g]=0;for(g=31917;g<=31922;g++)L[g]=0;for(g=31965;g<=32e3;g++)L[g]=0;for(g=32001;g<=32003;g++)L[g]=2;for(g=32005;g<=32031;g++)L[g]=2;for(g=32033;g<=32060;g++)L[g]=2;for(g=32064;g<=32067;g++)L[g]=2;for(g=32074;g<=32077;g++)L[g]=2;for(g=32081;g<=32086;g++)L[g]=0;for(g=32107;g<=32130;g++)L[g]=0;for(g=32133;g<=32158;g++)L[g]=0;for(g=32164;g<=32167;g++)L[g]=2;for(g=32180;g<=32199;g++)L[g]=0;for(g=32201;g<=32260;g++)L[g]=0;for(g=32301;g<=32360;g++)L[g]=0;for(g=32601;g<=32662;g++)L[g]=0;for(g=32664;g<=32667;g++)L[g]=2;for(g=32701;g<=32761;g++)L[g]=0;for(g=53001;g<=53004;g++)L[g]=0;for(g=53008;g<=53019;g++)L[g]=0;for(g=53021;g<=53032;g++)L[g]=0;for(g=53034;g<=53037;g++)L[g]=0;for(g=53042;g<=53046;g++)L[g]=0;for(g=53074;g<=53080;g++)L[g]=0;for(g=54001;g<=54004;g++)L[g]=0;for(g=54008;g<=54019;g++)L[g]=0;for(g=54021;g<=54032;g++)L[g]=0;for(g=54034;g<=54037;g++)L[g]=0;for(g=54042;g<=54046;g++)L[g]=0;for(g=54048;g<=54053;g++)L[g]=0;for(g=54074;g<=54080;g++)L[g]=0;for(g=54098;g<=54101;g++)L[g]=0;for(g=102001;g<=102040;g++)L[g]=0;for(g=102042;g<=102063;g++)L[g]=0;for(g=102065;g<=102067;g++)L[g]=0;for(g=102070;g<=102117;g++)L[g]=0;for(g=102122;g<=102216;g++)L[g]=0;for(g=102221;g<=102377;g++)L[g]=0;for(g=102382;g<=102388;g++)L[g]=0;for(g=102389;g<=102398;g++)L[g]=2;for(g=102399;g<=102444;g++)L[g]=0;for(g=102445;g<=102447;g++)L[g]=2;for(g=102448;g<=102458;g++)L[g]=0;for(g=102459;g<=102468;g++)L[g]=2;for(g=102469;g<=102499;g++)L[g]=0;for(g=102500;g<=102519;g++)L[g]=1;for(g=102520;g<=102524;g++)L[g]=0;for(g=102525;g<=102529;g++)L[g]=2;for(g=102530;g<=102588;g++)L[g]=0;for(g=102590;g<=102598;g++)L[g]=0;for(g=102601;g<=102603;g++)L[g]=0;for(g=102605;g<=102628;g++)L[g]=0;for(g=102629;g<=102646;g++)L[g]=2;for(g=102648;g<=102700;g++)L[g]=2;for(g=102701;g<=102703;g++)L[g]=0;for(g=102707;g<=102730;g++)L[g]=2;for(g=102733;g<=102758;g++)L[g]=2;for(g=102767;g<=102900;g++)L[g]=0;for(g=102901;g<=102933;g++)L[g]=2;for(g=102934;g<=102950;g++)L[g]=13;for(g=102951;g<=102955;g++)L[g]=0;for(g=102961;g<=102963;g++)L[g]=0;for(g=102965;g<=102969;g++)L[g]=0;for(g=102971;g<=102973;g++)L[g]=0;for(g=102975;g<=102989;g++)L[g]=0;for(g=102990;g<=102992;g++)L[g]=1;for(g=102997;g<=103002;g++)L[g]=0;for(g=103003;g<=103008;g++)L[g]=2;for(g=103009;g<=103011;g++)L[g]=0;for(g=103012;g<=103014;g++)L[g]=2;for(g=103019;g<=103021;g++)L[g]=0;for(g=103022;g<=103024;g++)L[g]=2;for(g=103029;g<=103031;g++)L[g]=0;for(g=103032;g<=103034;g++)L[g]=2;for(g=103065;g<=103068;g++)L[g]=0;for(g=103074;g<=103076;g++)L[g]=0;for(g=103077;g<=103079;g++)L[g]=1;for(g=103080;g<=103082;g++)L[g]=0;for(g=103083;g<=103085;g++)L[g]=2;for(g=103090;g<=103093;g++)L[g]=0;for(g=103097;g<=103099;g++)L[g]=0;for(g=103100;g<=103102;g++)L[g]=2;for(g=103107;g<=103109;g++)L[g]=0;for(g=103110;g<=103112;g++)L[g]=2;for(g=103113;g<=103116;g++)L[g]=0;for(g=103117;g<=103120;g++)L[g]=2;for(g=103153;g<=103157;g++)L[g]=0;for(g=103158;g<=103162;g++)L[g]=2;for(g=103163;g<=103165;g++)L[g]=0;for(g=103166;g<=103168;g++)L[g]=1;for(g=103169;g<=103171;g++)L[g]=2;for(g=103186;g<=103188;g++)L[g]=0;for(g=103189;g<=103191;g++)L[g]=2;for(g=103192;g<=103195;g++)L[g]=0;for(g=103196;g<=103199;g++)L[g]=2;for(g=103200;g<=103224;g++)L[g]=0;for(g=103225;g<=103227;g++)L[g]=1;for(g=103232;g<=103237;g++)L[g]=0;for(g=103238;g<=103243;g++)L[g]=2;for(g=103244;g<=103246;g++)L[g]=0;for(g=103247;g<=103249;g++)L[g]=2;for(g=103254;g<=103256;g++)L[g]=0;for(g=103257;g<=103259;g++)L[g]=2;for(g=103264;g<=103266;g++)L[g]=0;for(g=103267;g<=103269;g++)L[g]=2;for(g=103300;g<=103375;g++)L[g]=0;for(g=103381;g<=103383;g++)L[g]=0;for(g=103384;g<=103386;g++)L[g]=1;for(g=103387;g<=103389;g++)L[g]=0;for(g=103390;g<=103392;g++)L[g]=2;for(g=103397;g<=103399;g++)L[g]=0;for(g=103400;g<=103471;g++)L[g]=2;for(g=103476;g<=103478;g++)L[g]=0;for(g=103479;g<=103481;g++)L[g]=2;for(g=103486;g<=103488;g++)L[g]=0;for(g=103489;g<=103491;g++)L[g]=2;for(g=103492;g<=103495;g++)L[g]=0;for(g=103496;g<=103499;g++)L[g]=2;for(g=103528;g<=103543;g++)L[g]=0;for(g=103544;g<=103548;g++)L[g]=2;for(g=103549;g<=103551;g++)L[g]=0;for(g=103552;g<=103554;g++)L[g]=1;for(g=103555;g<=103557;g++)L[g]=2;for(g=103558;g<=103560;g++)L[g]=0;for(g=103571;g<=103573;g++)L[g]=0;for(g=103574;g<=103576;g++)L[g]=2;for(g=103577;g<=103580;g++)L[g]=0;for(g=103581;g<=103583;g++)L[g]=2;for(g=103595;g<=103694;g++)L[g]=0;for(g=103696;g<=103699;g++)L[g]=0;for(g=103700;g<=103793;g++)L[g]=2;for(g=103794;g<=103887;g++)L[g]=0;for(g=103900;g<=103971;g++)L[g]=2;const BCe={102113:!0,102100:!0,3857:!0,3785:!0},VCe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},GQ='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',V3=[-20037508342788905e-9,20037508342788905e-9],G3=[-20037508342787e-6,20037508342787e-6],lue={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:V3,origin:G3,dx:1e-5},102100:{wkTemplate:GQ,valid:V3,origin:G3,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:V3,origin:G3,dx:1e-5},3857:{wkTemplate:GQ,valid:V3,origin:G3,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function pc(e,t){return!A(e)&&!A(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||Nb(e)&&Nb(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function uv(e){return gl(e)&&e.wkid&&lue[e.wkid]||null}function cue(e){return!!gl(e)&&(e.wkid?L[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function iO(e){return!(zf(e)||Bf(e))}function rO(e){return gl(e)&&e.wkid===4326}function uue(e){return gl(e)&&e.wkid===yh.CGCS2000}function Nb(e){return gl(e)&&e.wkid!=null&&BCe[e.wkid]===!0}function sO(e){return gl(e)&&e.wkid===32662}function qH(e){return e===yh.GCSMARS2000||e===yh.GCSMARS2000_SPHERE}function zf(e){return gl(e)&&e.wkid!=null&&qH(e.wkid)}function WH(e){return e===yh.GCSMOON2000}function Bf(e){return gl(e)&&e.wkid!=null&&WH(e.wkid)}function GCe(e){return gl(e)&&e.wkid!=null&&VCe[e.wkid]===!0}function gl(e){return _(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const jCe={wkid:4326,wkt:Ef(lue[4326].wkTemplate,{Central_Meridian:"0.0"})},HCe={wkid:102100,latestWkid:3857},qCe={wkid:32662};var Pp;let _r=Pp=class extends ye{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return Pp.WebMercator;if(e.wkid===4326)return Pp.WGS84}const t=new Pp;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return rO(this)}get isWebMercator(){return Nb(this)}get isGeographic(){return cue(this)}get isWrappable(){return GCe(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===Pp.WGS84)return Pp.WGS84;if(this===Pp.WebMercator)return Pp.WebMercator;const e=new Pp;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=ie(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return pc(this,e)}toJSON(e){return this.write(void 0,e)}};_r.GCS_NAD_1927=null,_r.WGS84=null,_r.WebMercator=null,_r.PlateCarree=null,u([d({readOnly:!0})],_r.prototype,"isWGS84",null),u([d({readOnly:!0})],_r.prototype,"isWebMercator",null),u([d({readOnly:!0})],_r.prototype,"isGeographic",null),u([d({readOnly:!0})],_r.prototype,"isWrappable",null),u([d({type:Lr,json:{write:!0}})],_r.prototype,"latestWkid",void 0),u([d({type:Lr,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],_r.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],_r.prototype,"wkt",void 0),u([He("wkt"),He("web-scene","wkt")],_r.prototype,"writeWkt",null),u([d({type:Lr,json:{write:!0}})],_r.prototype,"vcsWkid",void 0),u([d({type:Lr,json:{write:!0}})],_r.prototype,"latestVcsWkid",void 0),u([d()],_r.prototype,"imageCoordinateSystem",void 0),_r=Pp=u([P("esri.geometry.SpatialReference")],_r),_r.prototype.toJSON.isDefaultToJSON=!0,_r.GCS_NAD_1927=new _r({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),_r.WGS84=new _r(jCe),_r.WebMercator=new _r(HCe),_r.PlateCarree=new _r(qCe),Object.freeze&&(Object.freeze(_r.GCS_NAD_1927),Object.freeze(_r.WGS84),Object.freeze(_r.WebMercator));const Ke=_r;let Ip=class extends ye{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Ke.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Ke)return e;if(e!=null){const i=new Ke;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],Ip.prototype,"type",void 0),u([d({readOnly:!0})],Ip.prototype,"cache",null),u([d({readOnly:!0})],Ip.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ip.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Ip.prototype,"hasZ",void 0),u([d({type:Ke,json:{write:!0}})],Ip.prototype,"spatialReference",void 0),u([Pe("spatialReference")],Ip.prototype,"readSpatialReference",null),Ip=u([P("esri.geometry.Geometry")],Ip);const cc=Ip,WCe=Object.prototype.toString;function XCe(e){const t="__accessorMetadata__"in e?Ds(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return YCe.apply(this,i)}}function YCe(e,t,i,r){AM(e,t).cast=r}function ZCe(e){return(t,i)=>{AM(t,e).cast=t[i]}}function jt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&WCe.call(e[0])==="[object Function]"?XCe(e[0]):e.length===1&&typeof e[0]=="string"?ZCe(e[0]):void 0}function QCe(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,r!=null&&(e.z=((s=e.z)!=null?s:0)+r),e}function JCe(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}class XH{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Ai=new XH(6378137,1/298.257223563,3e5,.006694379990137799),vf=new XH(3396190,1/169.8944472236118,23e4),Rg=new XH(1737400,0,0),KCe=57.29577951308232,eAe=.017453292519943;function jQ(e){return e*KCe}function HQ(e){return e*eAe}function qQ(e){return e/Ai.radius}function tN(e){return Math.PI/2-2*Math.atan(Math.exp(-e/Ai.radius))}function F8(e){return e.wkid!=null||e.wkt!=null}const _k=[0,0];function iN(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,_k,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,_k,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,_k,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function hv(e,t){const i=e&&(F8(e)?e:e.spatialReference),r=t&&(F8(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!pc(r,i)||Nb(r)&&rO(i)||Nb(i)&&rO(r))}function ww(e,t){if(A(e))return null;const i=e.spatialReference,r=t&&(F8(t)?t:t.spatialReference);return hv(i,r)?pc(i,r)?ie(e):Nb(r)?iN(e,UT,Ke.WebMercator,!1,ie(e)):rO(r)?iN(e,aR,Ke.WGS84,!1,ie(e)):null:null}function UT(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=HQ(t);return i[0]=HQ(e)*Ai.radius,i[1]=Ai.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function aR(e,t,i=[0,0],r=!1){const s=jQ(e/Ai.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=jQ(Math.PI/2-2*Math.atan(Math.exp(-t/Ai.radius))),i}function pg(e,t=!1,i=ie(e)){return iN(e,UT,Ke.WebMercator,t,i)}function VC(e,t=!1,i=ie(e)){return iN(e,aR,Ke.WGS84,t,i)}var V$;const AE=[0,0];function WQ(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const j3=fe.getLogger("esri.geometry.Point");let Ha=V$=class extends cc{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new Ke(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)j3.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)j3.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=UT(n.longitude,n.latitude,AE);e=a[0],t=a[1]}}}else WQ(i)?(s=i,i=null):WQ(r)&&(s=r,r=null);const o={x:e,y:t};return o.x==null&&o.y!=null?j3.warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&j3.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return aR(t,i,AE)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",UT(i,e,AE)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return aR(e,t,AE)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",UT(e,t,AE)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new V$;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return V$.copy(e,this),this}equals(e){if(A(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=UT(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=aR(l,c),h=n}return t===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(e,t,i){return QCe(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=uv(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return JCe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],Ha.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ha.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Ha.prototype,"hasZ",null),u([d({type:Number})],Ha.prototype,"latitude",null),u([d({type:Number})],Ha.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),jt(e=>isNaN(e)?e:hh(e))],Ha.prototype,"x",void 0),u([He("x")],Ha.prototype,"writeX",null),u([Pe("x")],Ha.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],Ha.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Ha.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Ha.prototype,"m",void 0),Ha=V$=u([P("esri.geometry.Point")],Ha),Ha.prototype.toJSON.isDefaultToJSON=!0;const nt=Ha,bk=[0,0];function YH(e,t){return!!_(t)&&_a(e,t.x,t.y,t.z)}function Hvt(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!zS(e,i))return!1;return!0}function tAe(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?_a(e,i,r,s)&&_a(e,i,o,s)&&_a(e,n,o,s)&&_a(e,n,r,s)&&_a(e,i,r,a)&&_a(e,i,o,a)&&_a(e,n,o,a)&&_a(e,n,r,a):_a(e,i,r)&&_a(e,i,o)&&_a(e,n,o)&&_a(e,n,r)}function zS(e,t){return _a(e,t[0],t[1])}function iAe(e,t){return _a(e,t[0],t[1],t[2])}function _a(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function rAe(e,t){return bk[1]=t.y,bk[0]=t.x,sAe(e,bk)}function sAe(e,t){return hue(e.rings,t)}function hue(e,t){if(!e)return!1;if(nAe(e))return XQ(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=XQ(i,e[r],t);return i}function nAe(e){return!Array.isArray(e[0][0])}function XQ(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<r&&(n=!n)}return n}function oAe(e,t){return YH(e,t)}function aAe(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function lAe(e,t){const{points:i,hasZ:r}=t,s=r?iAe:zS;for(const n of i)if(s(e,n))return!0;return!1}const Fb=[0,0],Ub=[0,0],kb=[0,0],zb=[0,0],cAe=[Fb,Ub,kb,zb],due=[[kb,Fb],[Fb,Ub],[Ub,zb],[zb,kb]];function uAe(e,t){return hAe(e,t.rings)}function hAe(e,t){Fb[0]=e.xmin,Fb[1]=e.ymax,Ub[0]=e.xmax,Ub[1]=e.ymax,kb[0]=e.xmin,kb[1]=e.ymin,zb[0]=e.xmax,zb[1]=e.ymin;for(const i of cAe)if(hue(t,i))return!0;for(const i of t){if(!i.length)continue;let r=i[0];if(zS(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(zS(e,n)||pue(r,n,due))return!0;r=n}}return!1}function dAe(e,t){Fb[0]=e.xmin,Fb[1]=e.ymax,Ub[0]=e.xmax,Ub[1]=e.ymax,kb[0]=e.xmin,kb[1]=e.ymin,zb[0]=e.xmax,zb[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(zS(e,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(zS(e,o)||pue(s,o,due))return!0;s=o}}return!1}const ao=[0,0];function pAe(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(U8(n,o,c,h,ao)&&!(ao[0]===n[0]&&ao[1]===n[1]||ao[0]===c[0]&&ao[1]===c[1]||ao[0]===o[0]&&ao[1]===o[1]||ao[0]===h[0]&&ao[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(U8(o,a,c,h,ao)&&!(ao[0]===o[0]&&ao[1]===o[1]||ao[0]===c[0]&&ao[1]===c[1]||ao[0]===a[0]&&ao[1]===a[1]||ao[0]===h[0]&&ao[1]===h[1]))return!0}}}return!1}function pue(e,t,i){for(let r=0;r<i.length;r++)if(U8(e,t,i[r][0],i[r][1]))return!0;return!1}function U8(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,h]=i,[p,f]=r,m=p-c,y=n-c,v=a-n,w=f-h,b=o-h,S=l-o,T=w*v-m*S;if(T===0)return!1;const E=(m*b-w*y)/T,C=(v*b-S*y)/T;return E>=0&&E<=1&&C>=0&&C<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function fAe(e){switch(e){case"esriGeometryEnvelope":case"extent":return aAe;case"esriGeometryMultipoint":case"multipoint":return lAe;case"esriGeometryPoint":case"point":return oAe;case"esriGeometryPolygon":case"polygon":return uAe;case"esriGeometryPolyline":case"polyline":return dAe}}var Gu;function mAe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function ry(e,t,i){return t==null?i:i==null?t:e(t,i)}let Nn=Gu=class extends cc{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return mAe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?Ke.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s==null?Ke.WGS84:s}}static fromBounds(e,t){return new Gu({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new Gu({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new nt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new Gu;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&hv(t,i)&&(e=t.isWebMercator?pg(e):VC(e,!0)),e.type==="point"?YH(this,e):e.type==="extent"&&tAe(this,e)}equals(e){if(this===e)return!0;if(A(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&hv(t,i)&&(e=t.isWebMercator?pg(e):VC(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(A(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&hv(t,i)&&(e=t.isWebMercator?pg(e):VC(e,!0)),fAe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=ry(Math.min,this.zmin,e.zmin),this.zmax=ry(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=ry(Math.min,this.mmin,e.mmin),this.mmax=ry(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:A(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=ry(Math.max,this.zmin,e.zmin),this.zmax=ry(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=ry(Math.max,this.mmin,e.mmin),this.mmax=ry(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=uv(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?VC(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new Ke(Ef(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||uv(r)))return this;const s=this._getParts(i).map(a=>a.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach(a=>{a.hasZ||(n=!1),a.hasM||(o=!1)}),{rings:s.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(n){const c=(a.zmax-a.zmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}if(o){const c=(a.mmax-a.mmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}return l}),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||uv(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,e);const v=h.x,w=h.frameId,b=m===v&&a>0;if(a>2*f){const S=new Gu(l<c?m:v,s,f,n,o),T=new Gu(p,s,l<c?v:m,n,o),E=new Gu(0,s,f,n,o),C=new Gu(p,s,0,n,o),O=[],I=[];S.contains(E)&&O.push(y),S.contains(C)&&I.push(y),T.contains(E)&&O.push(w),T.contains(C)&&I.push(w);for(let N=y+1;N<w;N++)O.push(N),I.push(N);t.push({extent:S,frameIds:[y]},{extent:T,frameIds:[w]},{extent:E,frameIds:O},{extent:C,frameIds:I})}else m>v||b?t.push({extent:new Gu(m,s,f,n,o),frameIds:[y]},{extent:new Gu(p,s,v,n,o),frameIds:[w]}):t.push({extent:new Gu(m,s,v,n,o),frameIds:[y]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],Nn.prototype,"cache",null),u([d({readOnly:!0})],Nn.prototype,"center",null),u([d({readOnly:!0})],Nn.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Nn.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Nn.prototype,"hasZ",null),u([d({readOnly:!0})],Nn.prototype,"height",null),u([d({readOnly:!0})],Nn.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Nn.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Nn.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Nn.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Nn.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Nn.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Nn.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Nn.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Nn.prototype,"zmax",void 0),Nn=Gu=u([P("esri.geometry.Extent")],Nn),Nn.prototype.toJSON.isDefaultToJSON=!0;const ri=Nn;function BS(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var k8;function YQ(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function gAe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let Vy=k8=class extends cc{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):gAe(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new ri,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=YQ(Math.min),a=YQ(Math.max);let l,c,h,p,[f,m]=n,[y,v]=n;for(let w=0,b=e.length;w<b;w++){const S=e[w],[T,E]=S;if(f=o(f,T),m=o(m,E),y=a(y,T),v=a(v,E),i&&S.length>2){const C=S[2];l=o(l,C),h=a(h,C)}if(r&&S.length>s){const C=S[s];c=o(c,C),p=a(p,C)}}return t.xmin=f,t.ymin=m,t.xmax=y,t.ymax=v,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),r?(t.mmin=c,t.mmax=p):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=ie(this.points)}addPoint(e){return BS(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:ie(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new k8(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new nt(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new nt(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(BS(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],Vy.prototype,"cache",null),u([d()],Vy.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],Vy.prototype,"points",void 0),u([He("points")],Vy.prototype,"writePoints",null),Vy=k8=u([P("esri.geometry.Multipoint")],Vy),Vy.prototype.toJSON.isDefaultToJSON=!0;const xw=Vy;function ZH(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function fue(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function yAe(e,t){return fue(e,t,.5)}function mue(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=ZH(e[r],e[r+1]);return i}function gue(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=ZH(e[s],e[s+1]);if(t-r<n){const o=(t-r)/n;return fue(e[s],e[s+1],o)}r+=n}return e[i-1]}function QH(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function qvt(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}function Wvt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function vAe(e){return e?yue(e.rings,e.hasZ):null}function yue(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=_Ae(e[n],t,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?bAe(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function _Ae(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],y=e[(f+1)%e.length],[v,w,b]=m,S=v-l,T=w-c,E=t?b-h:void 0,[C,O,I]=y,N=C-l,D=O-c,z=t?I-h:void 0,B=S*D-N*T;if(o+=B,r+=(S+N)*B,s+=(T+D)*B,t&&m.length>2&&y.length>2){const k=S*z-N*E;n+=(E+z)*k,a+=k}v<i[0]&&(i[0]=v),v>i[1]&&(i[1]=v),w<i[2]&&(i[2]=w),w>i[3]&&(i[3]=w),t&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function bAe(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],t&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=ZH(i,r);if(f){s+=f;const m=yAe(h,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function vue(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function _ue(e){return e.points!==void 0}function bue(e){return e.x!==void 0&&e.y!==void 0}function wue(e){return e.paths!==void 0}function xue(e){return e.rings!==void 0}function Tue(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}const j0=Tue(Math.min),H0=Tue(Math.max);function Xvt(e,t){return wue(t)?VS(e,t.paths,!1,!1):xue(t)?VS(e,t.rings,!1,!1):_ue(t)?JH(e,t.points,!1,!1,!1,!1):vue(t)?Sue(e,t):(bue(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function Yvt(e,t){return wue(t)?VS(e,t.paths,!0,!1):xue(t)?VS(e,t.rings,!0,!1):_ue(t)?JH(e,t.points,!0,!1,!0,!1):vue(t)?Sue(e,t,!0,!1,!0,!1):(bue(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function VS(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const y=t[m];for(let v=0;v<y.length;v++){const w=y[v],[b,S]=w;if(c=j0(c,b),h=j0(h,S),p=H0(p,b),f=H0(f,S),i&&w.length>2){const T=w[2];n=j0(n,T),o=H0(o,T)}if(r&&w.length>s){const T=w[s];a=j0(n,T),l=H0(o,T)}}}return i?r?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function Sue(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function JH(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[m,y]=t[0],[v,w]=t[0];for(let b=0;b<t.length;b++){const S=t[b],[T,E]=S;if(m=j0(m,T),y=j0(y,E),v=H0(v,T),w=H0(w,E),l&&S.length>2){const C=S[2];c=j0(c,C),h=H0(h,C)}if(a&&S.length>o){const C=S[o];p=j0(c,C),f=H0(h,C)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=c,e[3]=p,e[4]=v,e[5]=w,e[6]=h,e[7]=f,e):(e[0]=m,e[1]=y,e[2]=c,e[3]=v,e[4]=w,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=p,e[3]=v,e[4]=w,e[5]=f,e):(e[0]=m,e[1]=y,e[2]=v,e[3]=w,e)}function wAe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function xAe(e){return e.points!==void 0}function TAe(e){return e.x!==void 0&&e.y!==void 0}function SAe(e){return e.paths!==void 0}function EAe(e){return e.rings!==void 0}const KH=[];function Eue(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function Cue(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function Aue(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function Rue(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function eq(e,t=!1,i=!1){return t?i?Rue(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Cue(e[0],e[1],e[2],e[3],e[4],e[5]):i?Aue(e[0],e[1],e[2],e[3],e[4],e[5]):Eue(e[0],e[1],e[2],e[3])}function Zvt(e){return e?wAe(e)?e:TAe(e)?AAe(e):EAe(e)?Oue(e):SAe(e)?Mue(e):xAe(e)?CAe(e):null:null}function CAe(e){const{hasZ:t,hasM:i,points:r}=e;return eq(JH(KH,r,t,i),t,i)}function AAe(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?Rue(t,i,r,s,t,i,r,s):Cue(t,i,r,t,i,r):n?Aue(t,i,s,t,i,s):Eue(t,i,t,i)}function Oue(e){const{hasZ:t,hasM:i,rings:r}=e,s=VS(KH,r,t,i);return s?eq(s,t,i):null}function Mue(e){const{hasZ:t,hasM:i,paths:r}=e,s=VS(KH,r,t,i);return s?eq(s,t,i):null}var G$;function ZQ(e){return!Array.isArray(e[0])}let $p=G$=class extends cc{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const o of t)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new G$(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Ke.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=vAe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new nt;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Oue(this);if(!t)return null;const i=new ri(t);return i.spatialReference=e,i}get isSelfIntersecting(){return pAe(this.rings)}writeRings(e,t){t.rings=ie(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(ZQ(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new G$;return e.spatialReference=this.spatialReference,e.rings=ie(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(A(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(_(t)!==_(i)||_(t)&&_(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!wv(n,o,r))return!1}return!0}contains(e){if(!e)return!1;const t=ww(e,this.spatialReference);return rAe(this,_(t)?t:e)}isClockwise(e){let t;return t=ZQ(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,QH(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new nt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new nt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new nt(i[0],i[1],i[2],i[3],this.spatialReference):new nt(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(BS(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new nt(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new nt(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(BS(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],$p.prototype,"cache",null),u([d({readOnly:!0})],$p.prototype,"centroid",null),u([d({readOnly:!0})],$p.prototype,"extent",null),u([d({readOnly:!0})],$p.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],$p.prototype,"rings",void 0),u([He("rings")],$p.prototype,"writeRings",null),$p=G$=u([P("esri.geometry.Polygon")],$p),$p.prototype.toJSON.isDefaultToJSON=!0;const Ao=$p;var z8;function RAe(e){return!Array.isArray(e[0])}let Gy=z8=class extends cc{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Ke.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=Mue(this);if(!t)return null;const i=new ri(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=ie(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(RAe(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new z8;return e.spatialReference=this.spatialReference,e.paths=ie(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new nt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new nt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new nt(i[0],i[1],i[2],i[3],this.spatialReference):new nt(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(BS(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new nt(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new nt(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(BS(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],Gy.prototype,"cache",null),u([d({readOnly:!0})],Gy.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Gy.prototype,"paths",void 0),u([He("paths")],Gy.prototype,"writePaths",null),Gy=z8=u([P("esri.geometry.Polyline")],Gy),Gy.prototype.toJSON.isDefaultToJSON=!0;const au=Gy,Pue=Ko()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),QQ=Ko()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Iue(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function tq(e){return e.points!==void 0}function iq(e){return e.x!==void 0&&e.y!==void 0}function rq(e){return e.paths!==void 0}function _b(e){return e.rings!==void 0}function Og(e){return A(e)?null:e instanceof cc?e:iq(e)?nt.fromJSON(e):rq(e)?au.fromJSON(e):_b(e)?Ao.fromJSON(e):tq(e)?xw.fromJSON(e):Iue(e)?ri.fromJSON(e):null}function Z2(e){return e?iq(e)?"esriGeometryPoint":rq(e)?"esriGeometryPolyline":_b(e)?"esriGeometryPolygon":Iue(e)?"esriGeometryEnvelope":tq(e)?"esriGeometryMultipoint":null:null}const OAe={esriGeometryPoint:nt,esriGeometryPolyline:au,esriGeometryPolygon:Ao,esriGeometryEnvelope:ri,esriGeometryMultipoint:xw};function $ue(e){return e&&OAe[e]||null}const Tw={base:cc,key:"type",typeMap:{extent:ri,multipoint:xw,point:nt,polyline:au,polygon:Ao}};tp(Tw);let wk;function Cf(){return wk||(wk=(async()=>{const e=await import("./arcadeUtils.b2e22eb8.js").then(function(t){return t.t});return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),wk}const MAe=(e,t,i)=>PM.create(e,t,i,null,["$feature"]),PAe=(e,t,i)=>PM.create(e,t,i,null,["$feature","$view"]),IAe=(e,t,i,r)=>PM.create(e,t,i,r,["$feature","$view"]);class PM{constructor(t,i,r,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=i,this._arcadeDictionary=r,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Cf(),h=Ke.fromJSON(i),p=a.parseScript(t,o),f=n.reduce((C,O)=>ve(F({},C),{[O]:null}),{});let m=null;_(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p)&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p)&&a.enableAsyncSupport(),b={vars:f,spatialReference:h,useAsync:!!w},S=new c;S.immutable=!1,S.setField("scale",0);const T=a.compileScript(p,b),E=C=>("$view"in C&&C.$view&&(S.setField("scale",C.$view.scale),C.$view=S),m&&(C.$config=m),T({vars:C,spatialReference:h}));return await Promise.all([y,v,w]),new PM(t,a,c,p,E,new l,r,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const $Ae=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],DAe=["field","normalizationField"];function rN(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(JQ($Ae,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)JQ(DAe,r,t)}}function JQ(e,t,i){if(e)for(const r of e){const s=W2(r,t),n=s&&typeof s!="function"&&i.get(s);n&&lc(r,n.name,t)}}function Due(e,t){if(e!=null&&(t==null?void 0:t.fields.length))if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const xk=new Set;function Lue(e,t){return e&&t?(xk.clear(),nO(xk,e,t),Array.from(xk).sort()):[]}function nO(e,t,i){var r;if(i)if((r=t==null?void 0:t.fields)==null?void 0:r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)Eh(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)e.add(s)}}function Eh(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function Qvt(e,t){return A(t)||A(e)?[]:t.includes("*")?e.fields.map(i=>i.name):t}async function yl(e,t,i){var n;if(!i)return;const{arcadeUtils:r}=await Cf(),s=r.extractFieldNames(i,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Eh(e,t,o)}async function Nue(e,t,i){if(i&&i!=="1=1"){const r=(await import("./WhereClause.d6b5dcf7.js")).WhereClause.create(i,t);if(!r.isStandardized)throw new H("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});nO(e,t,r.fieldNames)}}function LAe({displayField:e,fields:t}){return e||(t&&t.length?Tk(t,"name-or-title")||Tk(t,"unique-identifier")||Tk(t,"type-or-category")||NAe(t):null)}function NAe(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function Tk(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function Jvt(e,t){if(!t)return;const i=W2("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function FAe(e,t,i){i.outStatistic.onStatisticValueExpression?yl(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function Kvt(e,t,i){var s,n;if(!t||!i||!("fields"in i))return;const r=[];if(((s=i.popupTemplate)==null?void 0:s.expressionInfos)&&r.push(...i.popupTemplate.expressionInfos.map(o=>yl(e,t.fieldsIndex,o.expression))),Array.isArray((n=i.popupTemplate)==null?void 0:n.content)){const o=i.popupTemplate.content;for(const a of o)a.type==="expression"&&a.expressionInfo&&r.push(yl(e,t.fieldsIndex,a.expressionInfo.expression))}i.fields&&r.push(...i.fields.map(o=>FAe(e,t.fieldsIndex,o))),await Promise.all(r)}async function e_t(e,t,i){t&&(t.timeInfo&&_(i)&&i.timeExtent&&nO(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&nO(e,t.fieldsIndex,[t.floorInfo.floorField]),_(i)&&_(i.where)&&await Nue(e,t.fieldsIndex,i.where))}async function t_t(e,t,i){t&&i&&await Promise.all(i.map(r=>UAe(e,t,r)))}async function UAe(e,t,i){t&&i&&(i.valueExpression?await yl(e,t.fieldsIndex,i.valueExpression):i.field&&Eh(e,t.fieldsIndex,i.field))}function i_t(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?Lue(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function r_t(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>kAe(e,r,s)))}async function kAe(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await yl(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Eh(e,t,o.slice(1,-1))})}await Nue(e,t,s)}function zAe(e){const t=e.defaultValue;return t!==void 0&&kue(e,t)?t:e.nullable?null:void 0}function Fue(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function BAe(e){return e===null||Fue(e)}const sq="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function VAe(e){return e===null||sq(e)}function Uue(e){return e!=null&&typeof e=="string"}function GAe(e){return e===null||Uue(e)}function jAe(){return!0}function kue(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?VAe:sq;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?BAe:Fue;break;case"string":case"esriFieldTypeString":i=e.nullable?GAe:Uue;break;default:i=jAe}return arguments.length===1?i:i(t)}const HAe=["integer","small-integer","single","double"],qAe=new Set([...HAe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function g4(e){return e!=null&&qAe.has(e.type)}function s_t(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}var sN,nN;function n_t(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function o_t(e,t){return e.nullable&&t===null?null:g4(e)&&!WAe(e.type,Number(t))?sN.OUT_OF_RANGE:kue(e,t)?e.domain?qEe(e.domain,t):null:nN.INVALID_TYPE}function WAe(e,t){const i=typeof e=="string"?zue(e):e;return!!i&&(i.isInteger?sq(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}function zue(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return XAe;case"esriFieldTypeInteger":case"integer":return YAe;case"esriFieldTypeSingle":case"single":return ZAe;case"esriFieldTypeDouble":case"double":return QAe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(sN||(sN={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(nN||(nN={}));const XAe={min:-32768,max:32767,isInteger:!0},YAe={min:-2147483648,max:2147483647,isInteger:!0},ZAe={min:-34e37,max:12e37,isInteger:!1},QAe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function a_t(e,t,i){switch(e){case FS.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case FS.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case nN.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case sN.OUT_OF_RANGE:{const{min:r,max:s}=zue(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function JAe(e,t){return!KAe(e,t,null)}function KAe(e,t,i){if(!t||!t.attributes||!e){if(_(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!_(i))break;i.add(n)}return s}function Bue(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}const oN={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Vue(e){return oN[e]||oN[e.toLowerCase()]}function nq(e){var t;return(t=oN[e])!=null?t:oN[e.toLowerCase()]}function eRe(e){return[...nq(e)]}function Sk(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function Gue(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*Sk(o,n,s+1/3)),Math.round(255*Sk(o,n,s)),Math.round(255*Sk(o,n,s-1/3)),r]}function tRe(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function M(){return[0,0,0]}function $s(e){return[e[0],e[1],e[2]]}function Ue(e,t,i){return[e,t,i]}function il(e){const t=M(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function oq(e,t){return new Float64Array(e,t,3)}function jue(){return M()}function Hue(){return Ue(1,1,1)}function que(){return Ue(1,0,0)}function Wue(){return Ue(0,1,0)}function aq(){return Ue(0,0,1)}const Aa=jue(),mf=Hue(),iRe=que(),rRe=Wue(),Xue=aq();Object.freeze(Object.defineProperty({__proto__:null,create:M,clone:$s,fromValues:Ue,fromArray:il,createView:oq,zeros:jue,ones:Hue,unitX:que,unitY:Wue,unitZ:aq,ZEROS:Aa,ONES:mf,UNIT_X:iRe,UNIT_Y:rRe,UNIT_Z:Xue},Symbol.toStringTag,{value:"Module"}));const Et=1e-6,Ud=Math.random,sRe=Math.PI/180,nRe=180/Math.PI;function y4(e){return e*sRe}function oRe(e){return e*nRe}function aRe(e,t){return Math.abs(e-t)<=Et*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:Et,RANDOM:Ud,toRadian:y4,toDegree:oRe,equals:aRe},Symbol.toStringTag,{value:"Module"}));function Oe(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function se(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function te(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function de(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function pe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function v4(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function aN(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function lRe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function cRe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function B8(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function Yue(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function Zue(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function uRe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function hRe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function oe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function tb(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function or(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function pn(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function Sa(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function Wo(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function dRe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function we(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function xe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function lt(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function tn(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function pRe(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*h,e}function fRe(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+i[0]*h+r[0]*p+s[0]*f,e[1]=t[1]*c+i[1]*h+r[1]*p+s[1]*f,e[2]=t[2]*c+i[2]*h+r[2]*p+s[2]*f,e}function mRe(e,t){t=t||1;const i=2*Ud()*Math.PI,r=2*Ud()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e}function ke(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function ec(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function uu(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-r*c,f=r*l-s*a,m=s*f-n*p,y=n*h-r*f,v=r*p-s*h;const w=2*o;return h*=w,p*=w,f*=w,m*=2,y*=2,v*=2,e[0]=a+h+m,e[1]=l+p+y,e[2]=c+f+v,e}function gRe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function yRe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function vRe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function _Re(e,t){se(H3,e),se(q3,t),we(H3,H3),we(q3,q3);const i=xe(H3,q3);return i>1?0:i<-1?Math.PI:Math.acos(i)}const H3=M(),q3=M();function bRe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function ll(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Bb(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(i-n)<=Et*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Et*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Et*Math.max(1,Math.abs(s),Math.abs(a))}function Vg(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const uc=pe,wRe=v4,xRe=aN,lq=or,cq=pn,uq=Oe,V8=Sa,KQ=Object.freeze(Object.defineProperty({__proto__:null,length:Oe,copy:se,set:te,add:de,subtract:pe,multiply:v4,divide:aN,ceil:lRe,floor:cRe,abs:B8,sign:Yue,min:Zue,max:uRe,round:hRe,scale:oe,scaleAndAdd:tb,distance:or,squaredDistance:pn,squaredLength:Sa,negate:Wo,inverse:dRe,normalize:we,dot:xe,cross:lt,lerp:tn,hermite:pRe,bezier:fRe,random:mRe,transformMat4:ke,transformMat3:ec,transformQuat:uu,rotateX:gRe,rotateY:yRe,rotateZ:vRe,angle:_Re,str:bRe,exactEquals:ll,equals:Bb,direction:Vg,sub:uc,mul:wRe,div:xRe,dist:lq,sqrDist:cq,len:uq,sqrLen:V8},Symbol.toStringTag,{value:"Module"}));function kd(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Xi(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function hq(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function Que(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function Jue(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function Kue(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function TRe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function SRe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function ERe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function CRe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function ARe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function IM(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function RRe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function ehe(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function lN(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function dq(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function pq(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function ORe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function MRe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function the(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function ihe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function _4(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function PRe(e,t){let i,r,s,n,o,a;t=t||1;do i=2*Ud()-1,r=2*Ud()-1,o=i*i+r*r;while(o>=1);do s=2*Ud()-1,n=2*Ud()-1,a=s*s+n*n;while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*s*l,e[3]=t*n*l,e}function lu(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function IRe(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return e[0]=h*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-h*-l,e[2]=f*c+m*-l+h*-a-p*-o,e[3]=t[3],e}function $Re(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function oO(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function rhe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Et*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Et*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Et*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Et*Math.max(1,Math.abs(n),Math.abs(c))}const DRe=Que,LRe=Jue,NRe=Kue,FRe=ehe,URe=lN,kRe=dq,zRe=pq,she=Object.freeze(Object.defineProperty({__proto__:null,copy:kd,set:Xi,add:hq,subtract:Que,multiply:Jue,divide:Kue,ceil:TRe,floor:SRe,min:ERe,max:CRe,round:ARe,scale:IM,scaleAndAdd:RRe,distance:ehe,squaredDistance:lN,length:dq,squaredLength:pq,negate:ORe,inverse:MRe,normalize:the,dot:ihe,lerp:_4,random:PRe,transformMat4:lu,transformQuat:IRe,str:$Re,exactEquals:oO,equals:rhe,sub:DRe,mul:LRe,div:NRe,dist:FRe,sqrDist:URe,len:kRe,sqrLen:zRe},Symbol.toStringTag,{value:"Module"})),eJ=new Float32Array(1);function GS(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function De(e,t,i){return Math.min(Math.max(e,t),i)}function jS(e){return(e&e-1)==0}function l_t(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function c_t(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function qt(e,t,i){return e+(t-e)*i}function $t(e){return e*Math.PI/180}function hc(e){return 180*e/Math.PI}function G8(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function rn(e){return Math.acos(De(e,-1,1))}function rp(e){return Math.asin(De(e,-1,1))}function BRe(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function uS(e,t,i=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=i}function VRe(e){return nhe(Math.max(-j8,Math.min(e,j8)))}function nhe(e){return eJ[0]=e,eJ[0]}function HS(e,t,i){const r=De((i-e)/(t-e),0,1);return r*r*(3-2*r)}function tJ(e,t){const i=Oe(e),r=rp(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return te(t,i,r,s),t}function u_t(e,t,i){return Xi(e,t[0],t[1],t[2],t[3]*i)}function h_t(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(uS(t,1)&&uS(i,1)&&uS(r,1))}const j8=nhe(34028234663852886e22);function W3(e){return De(DH(e),0,255)}function X3(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class ln{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,i,r,s=new ln){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),ln.fromArray(a,i)}return ln.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return ln.fromArray(Gue(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new ln){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(t,i=new ln){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=Vue(t)?nq(t):null;return r&&ln.fromArray(r,i)||ln.fromRgb(t,i)||ln.fromHex(t,i)}static fromJSON(t){return t&&new ln([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return _(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return _(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var i,r,s,n;return typeof t=="string"?ln.fromString(t,this):Array.isArray(t)?ln.fromArray(t,this):(this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof ln||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=ln.AlphaMode.ALWAYS){const i=W3(this.r),r=W3(this.g),s=W3(this.b);return t===ln.AlphaMode.ALWAYS||this.a!==1?[i,r,s,W3(255*this.a)]:[i,r,s]}clone(){return new ln(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return _(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(X3(this.r,0,255)),this.g=Math.round(X3(this.g,0,255)),this.b=Math.round(X3(this.b,0,255)),this.a=X3(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}ln.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(ln||(ln={}));const qe=ln,iJ=new xi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let GRe=0,Gx=class extends ye{constructor(e){super(e),this.id="sym"+GRe++,this.type=null,this.color=new qe([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:iJ.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:iJ.write}}})],Gx.prototype,"type",void 0),u([d({type:qe,json:{write:{allowNull:!0}}})],Gx.prototype,"color",void 0),u([Pe("color")],Gx.prototype,"readColor",null),Gx=u([P("esri.symbols.Symbol")],Gx);const fc=Gx;var H8;let jy=H8=class extends fc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return yl(e,t,n.expression)});await Promise.all(r)}}}clone(){return new H8({data:ie(this.data)})}hash(){return IH(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],jy.prototype,"color",void 0),u([d({json:{write:!0}})],jy.prototype,"data",void 0),u([Pe("data",["symbol"])],jy.prototype,"readData",null),u([He("data",{})],jy.prototype,"writeData",null),u([ot({CIMSymbolReference:"cim"},{readOnly:!0})],jy.prototype,"type",void 0),jy=H8=u([P("esri.symbols.CIMSymbol")],jy);const Q2=jy;let jx=class extends ye{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],jx.prototype,"enabled",void 0),u([He("enabled")],jx.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],jx.prototype,"type",void 0),jx=u([P("esri.symbols.Symbol3DLayer")],jx);const Vf=jx,jRe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,HRe="screenUtils.toPt: input not recognized!",ohe=96;function eo(e){return e?e/72*ohe:0}function yu(e){return e?72*e/ohe:0}function Ji(e){if(typeof e=="string"){const t=e.match(jRe);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?yu(i):i;return s?-n:n}return console.warn(HRe),null}return e}function sp(e=0,t=0){return{x:e,y:t}}function Vr(e=0,t=0){return[e,t]}function qRe(e=0,t=0){return[e,t]}function wo(e=0,t=0,i=0){return[e,t,i]}function d_t(e){return e}function p_t(e){return e}function f_t(e){return e}function tg(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function b4(e){const t=DH(100*(1-e));return Math.max(0,Math.min(t,100))}function qS(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function WRe(e,t){const i=t.transparency!=null?qS(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new qe([r[0]||0,r[1]||0,r[2]||0,i]):null}function XRe(e,t){t.color=e.toJSON().slice(0,3);const i=b4(e.a);i!==0&&(t.transparency=i)}const Gg={type:qe,json:{type:[Lr],default:null,read:{source:["color","transparency"],reader:WRe},write:{target:{color:{type:[Lr]},transparency:{type:Lr}},writer:XRe}}},Af={type:Number,cast:Ji,json:{write:!0}};let H_=class extends ye{constructor(e){super(e),this.color=new qe([0,0,0,1]),this.extensionLength=0,this.size=yu(1)}clone(){}cloneProperties(){return{color:ie(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],H_.prototype,"type",void 0),u([d(Gg)],H_.prototype,"color",void 0),u([d(ve(F({},Af),{json:{write:{overridePolicy:e=>({enabled:!!e})}}}))],H_.prototype,"extensionLength",void 0),u([d(Af)],H_.prototype,"size",void 0),H_=u([P("esri.symbols.edges.Edges3D")],H_);const fq=H_;var q8;let j$=q8=class extends fq{constructor(e){super(e),this.type="sketch"}clone(){return new q8(this.cloneProperties())}};u([ot({sketch:"sketch"},{readOnly:!0})],j$.prototype,"type",void 0),j$=q8=u([P("esri.symbols.edges.SketchEdges3D")],j$);const YRe=j$;var W8;let H$=W8=class extends fq{constructor(e){super(e),this.type="solid"}clone(){return new W8(this.cloneProperties())}};u([ot({solid:"solid"},{readOnly:!0})],H$.prototype,"type",void 0),H$=W8=u([P("esri.symbols.support.SolidEdges3D")],H$);const ZRe=H$,ahe={types:{key:"type",base:fq,typeMap:{solid:ZRe,sketch:YRe}},json:{write:!0}};var X8;let hu=X8=class extends ye{constructor(e){super(e),this.color=null}clone(){const e={color:_(this.color)?this.color.clone():null};return new X8(e)}};u([d(Gg)],hu.prototype,"color",void 0),hu=X8=u([P("esri.symbols.support.Symbol3DMaterial")],hu);var Y8;let Hy=Y8=class extends Vf{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new Y8({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([ot({Extrude:"extrude"},{readOnly:!0})],Hy.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],Hy.prototype,"size",void 0),u([d({type:hu,json:{write:!0}})],Hy.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Hy.prototype,"castShadows",void 0),u([d(ahe)],Hy.prototype,"edges",void 0),Hy=Y8=u([P("esri.symbols.ExtrudeSymbol3DLayer")],Hy);const lhe=Hy;let GC=class extends fc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([ot({esriSLS:"simple-line"},{readOnly:!0})],GC.prototype,"type",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],GC.prototype,"width",void 0),GC=u([P("esri.symbols.LineSymbol")],GC);const QRe=GC,JRe=["begin","end","begin-end"],che=["arrow","circle","square","diamond","cross","x"];var Z8;let Dp=Z8=class extends ye{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new Z8({color:ie(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],Dp.prototype,"placement",void 0),u([ot({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],Dp.prototype,"type",void 0),u([d({type:che})],Dp.prototype,"style",void 0),u([He("style")],Dp.prototype,"writeStyle",null),u([d({type:qe,value:null,json:{write:{allowNull:!0}}})],Dp.prototype,"color",null),u([Pe("color")],Dp.prototype,"readColor",null),u([He("color")],Dp.prototype,"writeColor",null),Dp=Z8=u([P("esri.symbols.LineSymbolMarker")],Dp);const KRe=Dp;var Q8;const Ek=new xi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let ym=Q8=class extends QRe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),i!=null&&(o.width=Ji(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=Ji(n)),o}clone(){var e;return new Q8({color:ie(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([ot({esriSLS:"simple-line"},{readOnly:!0})],ym.prototype,"type",void 0),u([d({type:Ek.apiValues,json:{read:Ek.read,write:Ek.write}})],ym.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],ym.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],ym.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":KRe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],ym.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],ym.prototype,"miterLimit",void 0),ym=Q8=u([P("esri.symbols.SimpleLineSymbol")],ym);const Uh=ym;let jC=class extends fc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Uh}},json:{default:null,write:!0}})],jC.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],jC.prototype,"type",void 0),jC=u([P("esri.symbols.FillSymbol")],jC);const uhe=jC;let q$=class extends ye{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],q$.prototype,"type",void 0),q$=u([P("esri.symbols.patterns.LinePattern3D")],q$);const hhe=q$,eOe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var J8;const tOe=Ko()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let HC=J8=class extends hhe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new J8(e)}};u([d({type:["style"]})],HC.prototype,"type",void 0),u([ot(tOe),d({type:eOe})],HC.prototype,"style",void 0),HC=J8=u([P("esri.symbols.patterns.LineStylePattern3D")],HC);const mq=HC;let W$=class extends ye{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],W$.prototype,"type",void 0),W$=u([P("esri.symbols.patterns.Pattern3D")],W$);const dhe=W$,iOe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var K8;let qC=K8=class extends dhe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new K8(e)}};u([d({type:["style"]})],qC.prototype,"type",void 0),u([d({type:iOe,json:{read:!0,write:!0}})],qC.prototype,"style",void 0),qC=K8=u([P("esri.symbols.patterns.StylePattern3D")],qC);const phe=qC,rOe={types:{key:"type",base:dhe,typeMap:{style:phe}},json:{write:!0}},fhe={types:{key:"type",base:hhe,typeMap:{style:mq}},json:{write:!0}},lR=new qe("white");new qe("black");const sOe=new qe([255,255,255,0]);function nOe(e){return e.r===0&&e.g===0&&e.b===0}var eV;let cR=eV=class extends hu{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:_(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new eV(e)}};u([ot({multiply:"multiply",replace:"replace",tint:"tint"})],cR.prototype,"colorMixMode",void 0),cR=eV=u([P("esri.symbols.support.Symbol3DFillMaterial")],cR);function Dt(e=cOe){return[e[0],e[1],e[2],e[3]]}function m_t(e){return[e[0],e[1],e[2],e[3]]}function Mg(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function gq(e,t,i,r,s=Dt()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function mhe(e,t=Dt()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function w4(e,t){return new ri({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function hS(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function bb(e,t,i){if(A(t))Mg(i,e);else if("length"in t)iV(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function Ck(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function tV(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function ru(e){return A(e)||e[0]>=e[2]?0:e[2]-e[0]}function np(e){return e[1]>=e[3]?0:e[3]-e[1]}function ghe(e){return ru(e)*np(e)}function yq(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function yhe(e,t){return vq(e,t[0],t[1])}function rJ(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function g_t(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=i,p=(w,b)=>(h-l)*w+(a-c)*b+(c*l-a*h)<0,f=p(r,o),m=p(n,o),y=p(n,s),v=p(r,s);return!(f===m&&m===y&&y===v&&v===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function y_t(e,t){return vq(e,t.x,t.y)}function vq(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function WC(e,t,i,r){return t>=e[0]-r&&i>=e[1]-r&&t<=e[2]+r&&i<=e[3]+r}function oOe(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function $M(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function sJ(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function X$(e,t,i){if(A(t))return Mg(i,e);const r=t[0],s=t[1],n=t[2],o=t[3];return i[0]=De(e[0],r,n),i[1]=De(e[1],s,o),i[2]=De(e[2],r,n),i[3]=De(e[3],s,o),i}function aOe(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-ru(e)/2,0),n=Math.max(Math.abs(t[1]-r)-np(e)/2,0);return Math.sqrt(s*s+n*n)}function cN(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function vu(e){return e?Mg(e,rV):Dt(rV)}function iV(e){return e!=null&&e.length===4}function lOe(e){return!(ru(e)!==0&&isFinite(e[0])||np(e)!==0&&isFinite(e[1]))}function wb(e,t){return iV(e)&&iV(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const v_t=[-1/0,-1/0,1/0,1/0],rV=[1/0,1/0,-1/0,-1/0],cOe=[0,0,0,0];function Ls(e=xhe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Vb(e,t,i,r,s,n,o=Ls()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function __t(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new ri(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function WS(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function uOe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function Rf(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function cu(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<r;h++)s=Math.min(s,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),c=Math.max(c,t[i+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function Ak(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function hOe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function Sw(e){return e[0]>=e[3]?0:e[3]-e[0]}function Ew(e){return e[1]>=e[4]?0:e[4]-e[1]}function Hv(e){return e[2]>=e[5]?0:e[5]-e[2]}function vhe(e){const t=Sw(e),i=Hv(e),r=Ew(e);return Math.sqrt(t*t+i*i+r*r)}function zd(e,t=[0,0,0]){return t[0]=e[0]+Sw(e)/2,t[1]=e[1]+Ew(e)/2,t[2]=e[2]+Hv(e)/2,t}function Y3(e,t=[0,0,0]){return t[0]=Sw(e),t[1]=Ew(e),t[2]=Hv(e),t}function dOe(e){return Math.max(Sw(e),Hv(e),Ew(e))}function _q(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function b_t(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function pOe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function Bd(e,t){return!!A(t)||pOe(e,t)}function _he(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function w_t(e,t,i=e){const r=e[0]+Sw(e)/2,s=e[1]+Ew(e)/2,n=e[2]+Hv(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function bhe(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function whe(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function x4(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function ur(e){return e?x4(e,oJ):Ls(oJ)}function bq(e,t){return t||(t=Dt()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function x_t(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function nJ(e){return e.length===6}function T4(e){return Sw(e)===0&&Ew(e)===0&&Hv(e)===0}function T_t(e,t,i){if(A(e)||A(t))return e===t;if(!nJ(e)||!nJ(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function fOe(e,t,i,r,s,n){return Vb(e,t,i,r,s,n,mOe)}const S_t=[-1/0,-1/0,-1/0,1/0,1/0,1/0],oJ=[1/0,1/0,1/0,-1/0,-1/0,-1/0],xhe=[0,0,0,0,0,0],mOe=Ls();function Rk(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const o=Ue(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const gOe=Vb(-.5,-.5,-.5,.5,.5,.5),yOe=Vb(-.5,-.5,0,.5,.5,1),vOe=Vb(-.5,-.5,0,.5,.5,.5);function _Oe(e){switch(e){case"sphere":case"cube":case"diamond":return gOe;case"cylinder":case"cone":case"inverted-cone":return yOe;case"tetrahedron":return vOe;default:return}}const wq=["butt","square","round"],bOe=[...wq,"none"],The=["miter","bevel","round"];var sV;let q_=sV=class extends ye{constructor(e){super(e),this.color=new qe([0,0,0,1]),this.size=yu(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size,pattern:_(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new sV(e)}};u([d(Gg)],q_.prototype,"color",void 0),u([d(Af)],q_.prototype,"size",void 0),u([d(fhe)],q_.prototype,"pattern",void 0),u([d({type:wq,json:{default:"butt",write:{overridePolicy(){return{enabled:_(this.pattern)}}}}})],q_.prototype,"patternCap",void 0),q_=sV=u([P("esri.symbols.support.Symbol3DOutline")],q_);var Y$;let vm=Y$=class extends Vf{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:_(this.edges)?this.edges.clone():null,enabled:this.enabled,material:_(this.material)?this.material.clone():null,pattern:_(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:_(this.outline)?this.outline.clone():null};return new Y$(e)}static fromSimpleFillSymbol(e){var r,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new mq({style:e.outline.style}):null,i={size:(s=(r=e.outline)==null?void 0:r.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:lR).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(i.patternCap=e.outline.cap),new Y$({material:new cR({color:((l=e.color)!=null?l:sOe).clone()}),pattern:e.style&&e.style!=="solid"?new phe({style:e.style}):null,outline:i})}};u([ot({Fill:"fill"},{readOnly:!0})],vm.prototype,"type",void 0),u([d({type:cR,json:{write:!0}})],vm.prototype,"material",void 0),u([d(rOe)],vm.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],vm.prototype,"castShadows",void 0),u([d({type:q_,json:{write:!0}})],vm.prototype,"outline",void 0),u([d(ahe)],vm.prototype,"edges",void 0),vm=Y$=u([P("esri.symbols.FillSymbol3DLayer")],vm);const S4=vm,wOe=["none","underline","line-through"],xOe=["normal","italic","oblique"],TOe=["normal","lighter","bold","bolder"],She={type:Number,cast:e=>{const t=hh(e);return t===0?1:De(t,.1,4)},nonNullable:!0},SOe=["left","right","center"],EOe=["baseline","top","middle","bottom"],Ehe={type:SOe,nonNullable:!0},Che={type:EOe,nonNullable:!0};var nV;let _m=nV=class extends ye{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return Ji(e)}clone(){return new nV({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:wOe,json:{default:"none",write:!0}})],_m.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],_m.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],_m.prototype,"size",void 0),u([jt("size")],_m.prototype,"castSize",null),u([d({type:xOe,json:{default:"normal",write:!0}})],_m.prototype,"style",void 0),u([d({type:TOe,json:{default:"normal",write:!0}})],_m.prototype,"weight",void 0),_m=nV=u([P("esri.symbols.Font")],_m);const E4=_m,COe=fe.getLogger("esri.core.urlUtils"),J2=Di.request,aJ="esri/config: esriConfig.request.proxyUrl is not set.",Ahe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Rhe=/^\s*http:/i,AOe=/^\s*https:/i,ROe=/^\s*file:/i,OOe=/:\d+$/,MOe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,POe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),IOe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class dS{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(POe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(IOe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const Z3={},$Oe=new dS(Di.applicationUrl);let Ea=$Oe;const DOe=LOe();let xq=DOe;const Tq=()=>Ea,E_t=()=>xq;function LOe(){const e=Ea.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${Ea.scheme}://${Ea.host}${Ea.port!=null?`:${Ea.port}`:""}`}${t}`}function Mn(e){const t={path:null,query:null},i=new dS(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=Ohe(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function Ohe(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function lJ(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function aO(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>lJ(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):lJ(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function NOe(e=!1){let t,i=J2.proxyUrl;if(typeof e=="string"){t=VOe(e);const r=C4(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw COe.warn(aJ),new H("urlutils:proxy-not-set",aJ);return t&&oV()&&(i=Rq(i)),Mn(i)}function C_t(e){const t=C4(e);let i,r;if(t){const s=Sq(t.proxyUrl);i=s.path,r=s.query?Ohe(s.query):null}if(i){const s=Mn(e);e=i+"?"+s.path;const n=aO(F(F({},r),s.query));n&&(e=`${e}?${n}`)}return e}const RE={path:"",query:""};function Sq(e){const t=e.indexOf("?");return t!==-1?(RE.path=e.slice(0,t),RE.query=e.slice(t+1)):(RE.path=e,RE.query=null),RE}function Mhe(e){return e=(e=uN(e=XOe(e=Sq(e).path),!0)).toLowerCase()}function FOe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:Mhe(e.urlPrefix)},i=J2.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function C4(e){const t=J2.proxyRules,i=Mhe(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function Phe(e,t){return e=cJ(e),t=cJ(t),uN(e)===uN(t)}function cJ(e){const t=(e=Xd(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function Ihe(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=J2.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function lO(e,t,i=!1){const r=lV(e),s=lV(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function Eq(e){if(typeof e=="string"){if(!oc(e))return!0;e=lV(e)}if(lO(e,Ea))return!0;const t=J2.trustedServers||[];for(let i=0;i<t.length;i++){const r=UOe(t[i]);for(let s=0;s<r.length;s++)if(lO(e,r[s]))return!0}return!1}function UOe(e){return Z3[e]||(Aq(e)||Of(e)?Z3[e]=[new dS(xh(e))]:Z3[e]=[new dS(`http://${e}`),new dS(`https://${e}`)]),Z3[e]}function xh(e,t=xq,i){return Of(e)?i&&i.preserveProtocolRelative?e:Ea.scheme==="http"&&Ea.authority===Yd(e).slice(2)?`http:${e}`:`https:${e}`:Aq(e)?e:vl(e[0]==="/"?qOe(t):t,e)}function Cq(e,t=xq,i){if(!oc(e))return e;const r=Xd(e),s=r.toLowerCase(),n=Xd(t).toLowerCase().replace(/\/+$/,""),o=i?Xd(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function Xd(e){return e=QOe(e=ZOe(e=YOe(e=xh(e=e.trim()))))}function vl(...e){const t=e.filter(_);if(!t||!t.length)return;const i=[];if(oc(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),jOe(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function Yd(e,t=!1){if(Tv(e)||Gf(e))return null;let i=e.indexOf("://");if(i===-1&&Of(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=uN(e,!0)),e}function oc(e){return Of(e)||Aq(e)}function Tv(e){return e!=null&&e.slice(0,5)==="blob:"}function Gf(e){return e.slice(0,5)==="data:"}function $he(e){const t=A4(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function A_t(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const kOe=/^data:(.*?)(;base64)?,(.*)$/;function A4(e){const t=e.match(kOe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function Dhe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function R_t(e,t){zOe(e,t)||BOe(e,t)}function zOe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function BOe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function Of(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function Aq(e){return Ahe.test(e)}function VOe(e){return AOe.test(e)||Ea.scheme==="https"&&Of(e)}function GOe(e){return Rhe.test(e)||Ea.scheme==="http"&&Of(e)}function jOe(e){return ROe.test(e)}function Rq(e){return Of(e)?`https:${e}`:e.replace(Rhe,"https:")}function HOe(){return Ea.scheme==="http"}function oV(){return Ea.scheme==="https"}function uN(e,t=!1){return Of(e)?e.slice(2):(e=e.replace(Ahe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function qOe(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function WOe(e){let t=0;if(oc(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function O_t(e,t){if(!e)return"";const i=Mn(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(t==null?void 0:t.length))return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function XOe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function Lhe(e){return e.replace(/\/+$/,"")}function YOe(e){if(/^https?:\/\//i.test(e)){const t=Sq(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function ZOe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function QOe(e){const t=J2.httpsDomains;if(!GOe(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),OOe.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return HOe()&&r===Ea.authority&&!MOe.test(e)||(oV()&&r===Ea.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||oV()&&!C4(e))&&(e=Rq(e)),e}function aV(e,t,i){if(!(t&&i&&e&&oc(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function lV(e){return typeof e=="string"?new dS(xh(e)):(e.scheme||(e.scheme=Ea.scheme),e)}function Oq(e){return KOe.test(e)}function Nhe(e,t){const i=Mn(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function Fhe(e,t,i){const r=Mn(e),s=r.query||{};return s[t]=String(i),`${r.path}?${aO(s)}`}function Ok(e,t){const i=Mn(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=aO(r);return s?`${i.path}?${s}`:i.path}function Mq(e){if(A(e))return null;const t=e.match(JOe);return t?t[1]:null}const JOe=/.*?\.([^\/]*)$/,KOe=/(^data:image\/svg|\.svg$)/i;function qv(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=xh(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=Cq(e,t.portalItem.itemUrl);tMe.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return cV(e,t&&t.portal)}function Pg(e,t,i=XS.YES){if(!e)return e;!oc(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=xh(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=cV(s,t.portal);r=Cq(cV(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=khe(r,t&&t.portal),oc(r)&&(r=Xd(r)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!oc(r)&&!Gf(r)&&i===XS.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function R4(e,t,i){return qv(e,i)}function Sv(e,t,i,r){const s=Pg(e,r);s!==void 0&&(t[i]=s)}const eMe=/\/items\/([^\/]+)\/resources\//,tMe=/^\.\/resources\//;function Uhe(e){const t=_(e)?e.match(eMe):null;return _(t)?t[1]:null}function khe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?aV(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function cV(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=Tq();return lO(r,`${r.scheme}://${i}`)?aV(e,t.portalHostname,i):aV(e,i,t.portalHostname)}var XS;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(XS||(XS={}));const iMe=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:qv,toJSON:Pg,read:R4,write:Sv,itemIdFromResourceUrl:Uhe,ensureMainOnlineDomain:khe,get MarkKeep(){return XS}},Symbol.toStringTag,{value:"Module"}));var uV;const rMe=Ko()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let W_=uV=class extends ye{constructor(e){super(e)}readHref(e,t,i){return e?qv(e,i):t.dataURI}writeHref(e,t,i,r){e&&(Gf(e)?t.dataURI=e:(t.href=Pg(e,r),oc(t.href)&&(t.href=Xd(t.href))))}clone(){return new uV({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],W_.prototype,"href",void 0),u([Pe("href")],W_.prototype,"readHref",null),u([He("href",{href:{type:String},dataURI:{type:String}})],W_.prototype,"writeHref",null),u([ot(rMe)],W_.prototype,"primitive",void 0),W_=uV=u([P("esri.symbols.support.IconSymbol3DLayerResource")],W_);const sMe="circle";var hV;let kT=hV=class extends Ee{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new hV({x:this.x,y:this.y})}};u([d({type:Number})],kT.prototype,"x",void 0),u([d({type:Number})],kT.prototype,"y",void 0),kT=hV=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],kT);var dV;let XC=dV=class extends ye{constructor(e){super(e),this.color=new qe([0,0,0,1]),this.size=yu(1)}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size};return new dV(e)}};u([d(Gg)],XC.prototype,"color",void 0),u([d(Af)],XC.prototype,"size",void 0),XC=dV=u([P("esri.symbols.support.Symbol3DIconOutline")],XC);var Hx;const nMe=fe.getLogger("esri.symbols.IconSymbol3DLayer");let Lp=Hx=class extends Vf{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new Hx({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,outline:_(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||lR,i=uJ(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||lR).clone()}:null;return new Hx({size:e.size,resource:{primitive:aMe(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||nOe(e.color)?lR:e.color,i=uJ(e);return new Hx({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new Hx({resource:{href:Dhe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function uJ(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=hJ(e.xoffset),s=hJ(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function hJ(e){return isFinite(e)?e:0}u([d({type:hu,json:{write:!0}})],Lp.prototype,"material",void 0),u([d({type:W_,json:{write:!0}})],Lp.prototype,"resource",void 0),u([ot({Icon:"icon"},{readOnly:!0})],Lp.prototype,"type",void 0),u([d(Af)],Lp.prototype,"size",void 0),u([ot({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],Lp.prototype,"anchor",void 0),u([d({type:kT,json:{type:[Number],read:{reader:e=>new kT({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Lp.prototype,"anchorPosition",void 0),u([d({type:XC,json:{write:!0}})],Lp.prototype,"outline",void 0),Lp=Hx=u([P("esri.symbols.IconSymbol3DLayer")],Lp);const oMe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function aMe(e){return oMe[e]||(nMe.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const q0=Lp;class pS{constructor(){this._emitter=new pS.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this.target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return NS(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let i=class extends Ee{constructor(){super(...arguments),this._emitter=new pS.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([P("esri.core.Evented")],i),e.EventedAccessor=i})(pS||(pS={}));const Kr=pS;var qi;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(qi||(qi={}));function Pq(e){return(t,i)=>{t[i]=e}}class zhe{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new Vce(this._observers,t)}notify(){const t=this._observers.slice();for(let i=0;i<t.length;++i){const r=t[i];r.onInvalidated(),r.onCommitted()}}}var Jm;class lMe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const Mu=new vs(lMe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),cMe=()=>{};function Mk(e){return e?e instanceof k1?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function Pk(e){if(e&&e.length)return e[0]}function uMe(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function Bhe(e,t,i,r){t&&t.forEach((s,n,o)=>{e.push(s),Bhe(e,i.call(r,s,n,o),i,r)})}const sy=new Set,ny=new Set,oy=new Set,Ik=new Map;let hMe=0,k1=Jm=class extends Kr.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new zhe,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:hMe++})}static isCollection(e){return e!=null&&e instanceof Jm}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof Jm?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return Zt(this._observable),this._items}set items(e){this._emitBeforeChanges(qi.ADD)||(this._splice(0,this.length,Mk(e)),this._emitAfterChanges(qi.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=cMe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(Zt(this._observable),this._emitBeforeChanges(qi.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(qi.ADD),this}addMany(e,t=this._items.length){if(Zt(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(qi.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,Mk(e)),this._emitAfterChanges(qi.ADD),this}at(e){if(Zt(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(Zt(this._observable),!this.length||this._emitBeforeChanges(qi.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(qi.REMOVE),e}clone(){return Zt(this._observable),this._createNewInstance({items:this._items.map(ie)})}concat(...e){Zt(this._observable);const t=e.map(Mk);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Zt(this._observable),!this.length||this._emitBeforeChanges(qi.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(qi.REMOVE)}every(e,t){return Zt(this._observable),this._items.every(e,t)}filter(e,t){let i;return Zt(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return Zt(this._observable),this._items.find(e,t)}findIndex(e,t){return Zt(this._observable),this._items.findIndex(e,t)}flatten(e,t){Zt(this._observable);const i=[];return Bhe(i,this,e,t),new Jm(i)}forEach(e,t){return Zt(this._observable),this._items.forEach(e,t)}getItemAt(e){return Zt(this._observable),this._items[e]}getNextIndex(e){Zt(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Zt(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Zt(this._observable),this._items.indexOf(e,t)}join(e=","){return Zt(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Zt(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Zt(this._observable);const i=this._items.map(e,t);return new Jm({items:i})}reorder(e,t=this.length-1){Zt(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(qi.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(qi.MOVE)}return e}}pop(){if(Zt(this._observable),!this.length||this._emitBeforeChanges(qi.REMOVE))return;const e=Pk(this._splice(this.length-1,1));return this._emitAfterChanges(qi.REMOVE),e}push(...e){return Zt(this._observable),this._emitBeforeChanges(qi.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(qi.ADD)),this.length}reduce(e,t){Zt(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){Zt(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return Zt(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Zt(this._observable),e<0||e>=this.length||this._emitBeforeChanges(qi.REMOVE))return;const t=Pk(this._splice(e,1));return this._emitAfterChanges(qi.REMOVE),t}removeMany(e){if(Zt(this._observable),!e||!e.length||this._emitBeforeChanges(qi.REMOVE))return[];const t=e instanceof Jm?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=i.indexOf(o);if(a>-1){const l=1+uMe(t,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(qi.REMOVE),r}reverse(){if(Zt(this._observable),this._emitBeforeChanges(qi.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(qi.MOVE),this}shift(){if(Zt(this._observable),!this.length||this._emitBeforeChanges(qi.REMOVE))return;const e=Pk(this._splice(0,1));return this._emitAfterChanges(qi.REMOVE),e}slice(e=0,t=this.length){return Zt(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Zt(this._observable),this._items.some(e,t)}sort(e){if(Zt(this._observable),!this.length||this._emitBeforeChanges(qi.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(qi.MOVE),this}splice(e,t,...i){Zt(this._observable);const r=(t?qi.REMOVE:0)|(i.length?qi.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return Zt(this._observable),this._items.slice()}toJSON(){return Zt(this._observable),this.toArray()}toLocaleString(){return Zt(this._observable),this._items.toLocaleString()}toString(){return Zt(this._observable),this._items.toString()}unshift(...e){return Zt(this._observable),!e.length||this._emitBeforeChanges(qi.ADD)||(this._splice(0,0,e),this._emitAfterChanges(qi.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=Y2(()=>this._dispatchChange())),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const a=Mu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(e,0,n),e+=1,l-=1,c-=1);Mu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Mu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Mu.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=Mu.acquire();h.target=this,h.cancellable=!0;const p=Mu.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));Mu.release(p),Mu.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=Mu.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,Mu.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=Mu.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),Mu.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;sy.clear(),ny.clear(),oy.clear();for(const{added:l,removed:c}of i){if(l)if(oy.size===0&&ny.size===0)for(const h of l)sy.add(h);else for(const h of l)ny.has(h)?(oy.add(h),ny.delete(h)):oy.has(h)||sy.add(h);if(c)if(oy.size===0&&sy.size===0)for(const h of c)ny.add(h);else for(const h of c)sy.has(h)?sy.delete(h):(oy.delete(h),ny.add(h))}const r=Yl.acquire();sy.forEach(l=>{r.push(l)});const s=Yl.acquire();ny.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=Yl.acquire();if(oy.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}Yl.release(r),Yl.release(s),Yl.release(a)}sy.clear(),ny.clear(),oy.clear()}};k1.ofType=e=>{if(!e)return Jm;if(Ik.has(e))return Ik.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends Jm{};return u([Pq({Type:e,ensureType:typeof e=="function"?Ds(e):tp(e)})],i.prototype,"itemType",void 0),i=u([P(`esri.core.Collection<${t}>`)],i),Ik.set(e,i),i},u([d()],k1.prototype,"length",void 0),u([d()],k1.prototype,"items",null),k1=Jm=u([P("esri.core.Collection")],k1);const ft=k1;function Gb(e,t,i=ft){return t||(t=new i),t===e||(t.removeAll(),dMe(e)?t.addMany(e):e&&t.add(e)),t}function Vhe(e){return e}function dMe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const Ghe="20220630",jhe="5a46844c5ac1b721521da79fb0304de9e8457e2c",Hhe="4.24",pMe={async request(e,t){var a;const{default:i}=await Promise.resolve().then(function(){return Zhe}),r=e.options,s=r.responseType;r.signal=t==null?void 0:t.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":["blob","json","text"].includes(s)&&((a=Ihe(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await i(e.url,r),o={data:n.data,ssl:n.ssl};switch(n.requestOptions.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Zr;function M_t(e){Zr=e}function P_t(e){const t=Zr&&Zr.findCredential(e);return t&&t.token?Fhe(e,"token",t.token):e}he("host-webworker")||(he("edge")||he("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const fMe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function qhe(e){const t=Yd(e,!0);return t&&t.endsWith(".arcgis.com")&&!fMe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function Whe(e,t,i=!1,r){return new Promise((s,n)=>{if(Xs(r))return void n(dJ());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(dJ())};const c=()=>{he("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,_(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};_(r)&&r.addEventListener("abort",l),he("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function dJ(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function mMe(e){Di.request.crossOriginNoCorsDomains||(Di.request.crossOriginNoCorsDomains={});const t=Di.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[Yd(i)]=0:(t[Yd("http://"+i)]=0,t[Yd("https://"+i)]=0)}function gMe(e){const t=Di.request.crossOriginNoCorsDomains;if(t){let i=Yd(e);if(i)return i=i.toLowerCase(),!lO(i,Tq())&&t[i]<Date.now()-36e5}return!1}async function yMe(e){var r;const t=Di.request.crossOriginNoCorsDomains;t&&(t[Yd(e).toLowerCase()]=Date.now());const i=Mn(e);e=i.path,((r=i.query)==null?void 0:r.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function ai(e,t){var c;const i=Gf(e),r=Tv(e);r||i||(e=Xd(e));const s={url:e,requestOptions:F({},t)};let n=Ihe(e);if(n){const h=await EMe(n,s);if(h!=null)return{data:h,getHeader:Iq,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(he("host-webworker")||he("host-node"))throw Vd("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw Vd("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw Vd("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Vd("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await xMe(),hN)return hN.execute(e,t);const o=new AbortController;Yo(t,()=>o.abort());const a={controller:o,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Ed.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await AMe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let hN;const Ed=Di.request,Xhe="FormData"in globalThis,vMe=[499,498,403,401],_Me=["COM_0056","COM_0057","SB_0008"],bMe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Iq=()=>null,pV=Symbol();function wMe(e){const t=Yd(e);t&&!ai._corsServers.includes(t)&&ai._corsServers.push(t)}function pJ(e){const t=Yd(e);return!t||t.endsWith(".arcgis.com")||ai._corsServers.includes(t)||Eq(t)}function Vd(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:Iq,ssl:!1};if(t instanceof H)return t.details?(t.details=ie(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=pV in t?t[pV]:t}return jr(t)?di():new H(e,s,n)}async function xMe(){he("host-webworker")?hN||(hN=await import("./request.9ca04f0e.js")):ai._abortableFetch||(ai._abortableFetch=globalThis.fetch.bind(globalThis))}async function fV(){Zr||await import("./IdentityManager.35b7a95a.js")}async function TMe(e){var a;const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null;if(Xhe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:i.cacheBust&&!ai._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:Ed.priority,redirect:"follow",signal:r},(n||o)&&(e.fetchOptions.body=n||o),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=i.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&Di.apiKey&&qhe(t)&&(i.query||(i.query={}),i.query.token=Di.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!Yhe(t)&&!Xs(r)){let l;i.authMode==="immediate"?(await fV(),l=await Zr.getCredential(t,{signal:r}),e.credential=l):i.authMode==="no-prompt"?(await fV(),l=await Zr.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=l):Zr&&(l=Zr.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function Yhe(e){return bMe.some(t=>t.test(e))}async function SMe(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=Tv(t)||Gf(t),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:Ed.timeout;let a=!1;if(!s){e.useSSL&&(t=Rq(t)),i.cacheBust&&r.cache==="default"&&(t=Fhe(t,"request.preventCache",Date.now()));let f=F({},i.query);e.credentialToken&&(f.token=e.credentialToken);let m=aO(f);he("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const y=t.length+1+m.length;let v;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>Ed.maxUrlLength;const w=i.useProxy||!!C4(t);if(w){const b=NOe(t);v=b.path,!a&&v.length+1+y>Ed.maxUrlLength&&(a=!0),b.query&&(f=F(F({},b.query),f))}if(r.method==="HEAD"&&(a||w)){if(a)throw y>Ed.maxUrlLength?Vd("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):Vd("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(w)throw Vd("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=Ok(t,f):(r.body=aO(f),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=Ok(t,f),w&&(e.useProxy=!0,t=`${v}?${t}`),f.token&&Xhe&&r.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!lO(t,Tq())){if(Eq(t))e.withCredentials=!0;else if(Zr){const b=Zr.findServerInfo(t);b&&b.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include",gMe(t)&&await yMe(a?Ok(t,f):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||CMe(i.headers)||!s&&!e.useProxy&&Ed.proxyUrl&&!pJ(t)){if(l=await ai._abortableFetch(t,r),e.useProxy||wMe(t),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=fJ(c,"application/xml");break;case"document":c=fJ(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await mJ(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await mJ(t,e)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):di("Request canceled");if(!(!l&&f instanceof TypeError&&Ed.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||pJ(t))throw f;e.redoRequest=!0,FOe({proxyUrl:Ed.proxyUrl,urlPrefix:Yd(t)})}finally{h&&clearTimeout(h)}return[l,c]}async function EMe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers=F(F({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=F(F({},t.requestOptions.query),e.query)),e.before){let i,r;try{r=await e.before(t)}catch(s){i=Vd("request:interceptor",s,t)}if((r instanceof Error||r instanceof H)&&(i=Vd("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function CMe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function fJ(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function AMe(e){var n;let t,i;await TMe(e);try{do[t,i]=await SMe(e);while(!await RMe(e,t,i))}catch(o){const a=Vd("request:server",o,e.params,t);throw a.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a}const r=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!e.hasToken&&!e.credentialToken&&((n=i.user)==null?void 0:n.username)&&!Eq(r)){const o=Yd(r,!0);o&&Ed.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&mMe(i.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&Zr){const o=Zr.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Zr.findCredential(a,s.userId);l&&Zr._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:t?o=>t.headers.get(o):Iq,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function RMe(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[pV]=i,s;(i==null?void 0:i.error)&&(s=i.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&vMe.includes(n)&&!Yhe(e.params.url)&&(n!==403||!_Me.includes(a)&&(o==null||o===2&&e.credentialToken))){await fV();try{const c=await Zr.getCredential(e.params.url,{error:Vd("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=c}}if(s)throw s;return!0}function mJ(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=Ed.priority,s.src=e,Whe(s,e,i,r)}ai._abortableFetch=null,ai._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var Zhe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:ai}),x0;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(x0||(x0={}));class OMe{constructor(t){this.instance=t,this._resolver=xv(),this._status=x0.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=x0.RESOLVED,this._cleanUp()},()=>{this._status=x0.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===x0.RESOLVED}isRejected(){return this._status===x0.REJECTED}isFulfilled(){return this._status!==x0.PENDING}abort(){this._resolver.reject(di())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=xv(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||jr(s)||this._resolver.reject(s)}),t.resolve()}}const O4=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new OMe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=u([P("esri.core.Promise")],t),t};let dN=class extends O4(Ee){};dN=u([P("esri.core.Promise")],dN);const MMe="not-loaded",PMe="loading",IMe="failed",gJ="loaded",Qhe=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=VH(n,l);this.destroyed&&l(new H("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===MMe){this._set("loadStatus",PMe);const a=this._loadController=new AbortController;s({signal:a.signal}),Yo(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",gJ),this._loadController=null},r=>{this._set("loadStatus",IMe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===gJ}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new H("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[Ma],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([P("esri.core.Loadable")],t),t};let YC=class extends Qhe(dN){};YC=u([P("esri.core.Loadable")],YC),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=Qhe,e.isLoadable=t}(YC||(YC={}));const Ig=YC;let uR;var Jle,Kle,ece;const $k=(ece=(Jle=globalThis.esriConfig)==null?void 0:Jle.locale)!=null?ece:(Kle=globalThis.dojoConfig)==null?void 0:Kle.locale;function Jhe(){var e,t;return(t=$k!=null?$k:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function du(){return uR===void 0&&(uR=Jhe()),uR}const hR=[];function $Me(e){return hR.push(e),{remove(){hR.splice(hR.indexOf(e),1)}}}const mV=[];function $q(e){return mV.push(e),{remove(){hR.splice(mV.indexOf(e),1)}}}function DMe(){const e=Jhe();uR!==e&&(uR=e,[...mV].forEach(t=>{t.call(null,e)}),[...hR].forEach(t=>{t.call(null,e)}))}var tce;(tce=globalThis.addEventListener)==null||tce.call(globalThis,"languagechange",DMe);var gV;const LMe=new xi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let ju=gV=class extends Ee{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new gV({categories:this.categories?ie(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=ww(this.extent,Ke.WGS84);_(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>LMe.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:F(F({},t),n)}}};u([d()],ju.prototype,"categories",void 0),u([d()],ju.prototype,"disableExtraQuery",void 0),u([d({type:ri})],ju.prototype,"extent",void 0),u([d()],ju.prototype,"filter",void 0),u([d()],ju.prototype,"num",void 0),u([d()],ju.prototype,"query",void 0),u([d()],ju.prototype,"sortField",void 0),u([d()],ju.prototype,"sortOrder",null),u([d()],ju.prototype,"start",void 0),ju=gV=u([P("esri.portal.PortalQueryParams")],ju);const ig=ju;let X_=class extends Ee{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],X_.prototype,"nextQueryParams",void 0),u([d()],X_.prototype,"queryParams",void 0),u([d()],X_.prototype,"results",void 0),u([d()],X_.prototype,"total",void 0),X_=u([P("esri.portal.PortalQueryResult")],X_);const NMe=X_;let bm=class extends ye{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new H("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],bm.prototype,"created",void 0),u([d()],bm.prototype,"id",void 0),u([d()],bm.prototype,"portal",void 0),u([d()],bm.prototype,"title",void 0),u([d({readOnly:!0})],bm.prototype,"url",null),u([d()],bm.prototype,"username",void 0),bm=u([P("esri.portal.PortalFolder")],bm);const FMe=bm;let Fn=class extends ye{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=Ds(ig,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new ig,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new ig,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(i=>{const r=i.contentCategorySetsGroupQuery;if(r){const s=new ig;return s.disableExtraQuery=!0,s.num=1,s.query=r,this.portal.queryGroups(s,t)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],s=new ig;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(r=>{const s=r&&r.categorySchema;return s&&s.length?s:[]}):[])}};u([d()],Fn.prototype,"access",void 0),u([d({type:Date})],Fn.prototype,"created",void 0),u([d()],Fn.prototype,"description",void 0),u([d()],Fn.prototype,"id",void 0),u([d()],Fn.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Fn.prototype,"modified",void 0),u([d()],Fn.prototype,"owner",void 0),u([d()],Fn.prototype,"portal",void 0),u([d()],Fn.prototype,"snippet",void 0),u([d()],Fn.prototype,"sortField",void 0),u([d()],Fn.prototype,"sortOrder",void 0),u([d()],Fn.prototype,"tags",void 0),u([d()],Fn.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Fn.prototype,"thumbnailUrl",null),u([d()],Fn.prototype,"title",void 0),u([d({readOnly:!0})],Fn.prototype,"url",null),Fn=u([P("esri.portal.PortalGroup")],Fn);const yV=Fn;var UMe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:yV}),vV;let qr=vV=class extends ye{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=FMe.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=yV.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then(function(){return d0e}).then(({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})}).then(r=>{let s;return r&&r.items?(s=r.items.map(n=>{const o=t.fromJSON(n);return o.portal=this.portal,o}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:r.nextStart,total:r.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new yV({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new H("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new vV;return t.sourceJSON=e,t.read(e),t}};u([d()],qr.prototype,"access",void 0),u([d({type:Date})],qr.prototype,"created",void 0),u([d()],qr.prototype,"culture",void 0),u([d()],qr.prototype,"description",void 0),u([d()],qr.prototype,"email",void 0),u([d()],qr.prototype,"favGroupId",void 0),u([d()],qr.prototype,"fullName",void 0),u([d({type:Date})],qr.prototype,"modified",void 0),u([d()],qr.prototype,"orgId",void 0),u([d()],qr.prototype,"portal",void 0),u([d()],qr.prototype,"preferredView",void 0),u([d()],qr.prototype,"privileges",void 0),u([d()],qr.prototype,"region",void 0),u([d()],qr.prototype,"role",void 0),u([d()],qr.prototype,"roleId",void 0),u([d()],qr.prototype,"sourceJSON",void 0),u([d()],qr.prototype,"thumbnail",void 0),u([d({readOnly:!0})],qr.prototype,"thumbnailUrl",null),u([d()],qr.prototype,"units",void 0),u([d({readOnly:!0})],qr.prototype,"userContentUrl",null),u([d({readOnly:!0})],qr.prototype,"url",null),u([d()],qr.prototype,"username",void 0),u([d()],qr.prototype,"userType",void 0),qr=vV=u([P("esri.portal.PortalUser")],qr);const Dq=qr;var kMe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Dq}),Mc;let Dk;const yJ={PortalGroup:()=>Promise.resolve().then(function(){return UMe}),PortalItem:()=>Promise.resolve().then(function(){return d0e}),PortalUser:()=>Promise.resolve().then(function(){return kMe})};let Be=Mc=class extends bw(Ig){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Di.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)Di.request.trustedServers.includes(t)||Di.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=Dq.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(function(){return j9e}).then(({default:i})=>{hi(e),Dk=i}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(i=>{if(Zr){const r=Zr;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==Mc.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await import("./ElevationLayer.90a7940a.js")).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}fetchBasemaps(e,t){const i=new ig;return i.query=e||(Di.apiKey&&qhe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new Dk({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):Xs(e)?Promise.reject(di()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new ig;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return Xs(e)?Promise.reject(di()):Promise.resolve([])}fetchRegions(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||du();return this._request(this.restUrl+"/portals/regions",ve(F({},e),{query:{culture:t}}))}fetchSettings(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||du();return this._request(this.restUrl+"/portals/self/settings",ve(F({},e),{query:{culture:t}}))}static getDefault(){return Mc._default&&!Mc._default.destroyed||(Mc._default=new Mc),Mc._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new H("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Mc({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new H("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new H("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s=F({authMode:e,query:{culture:du().toLowerCase()}},i);return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=Ds(ig,t),n=o=>this._request(this.restUrl+e,F(F({},s.toRequestOptions(this)),r)).then(a=>{const l=s.clone();return l.start=a.nextStart,new NMe({nextQueryParams:l,queryParams:s,total:a.total,results:Mc._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(nc(l),a)));return i&&yJ[i]?yJ[i]().then(({default:o})=>(hi(r),n(o))):n()}_signIn(){if(this.authMode===Mc.AUTH_MODE_ANONYMOUS)return Promise.reject(new H("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Zr?Zr.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then(r=>{const s=Mc._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=Dk.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i=F({f:"json"},t.query),{authMode:r=this.authMode===Mc.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return ai(this._normalizeSSL(e),c).then(h=>h.data)}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=_(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Be.AUTH_MODE_ANONYMOUS="anonymous",Be.AUTH_MODE_AUTO="auto",Be.AUTH_MODE_IMMEDIATE="immediate",u([d()],Be.prototype,"access",void 0),u([d()],Be.prototype,"allSSL",void 0),u([d()],Be.prototype,"authMode",void 0),u([d()],Be.prototype,"authorizedCrossOriginDomains",void 0),u([Pe("authorizedCrossOriginDomains")],Be.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],Be.prototype,"basemapGalleryGroupQuery",void 0),u([d()],Be.prototype,"bingKey",void 0),u([d()],Be.prototype,"canListApps",void 0),u([d()],Be.prototype,"canListData",void 0),u([d()],Be.prototype,"canListPreProvisionedItems",void 0),u([d()],Be.prototype,"canProvisionDirectPurchase",void 0),u([d()],Be.prototype,"canSearchPublic",void 0),u([d()],Be.prototype,"canShareBingPublic",void 0),u([d()],Be.prototype,"canSharePublic",void 0),u([d()],Be.prototype,"canSignInArcGIS",void 0),u([d()],Be.prototype,"canSignInIDP",void 0),u([d()],Be.prototype,"colorSetsGroupQuery",void 0),u([d()],Be.prototype,"commentsEnabled",void 0),u([d({type:Date})],Be.prototype,"created",void 0),u([d()],Be.prototype,"credential",void 0),u([d()],Be.prototype,"culture",void 0),u([d()],Be.prototype,"currentVersion",void 0),u([d()],Be.prototype,"customBaseUrl",void 0),u([d()],Be.prototype,"defaultBasemap",void 0),u([Pe("defaultBasemap")],Be.prototype,"readDefaultBasemap",null),u([d()],Be.prototype,"defaultDevBasemap",void 0),u([Pe("defaultDevBasemap")],Be.prototype,"readDefaultDevBasemap",null),u([d({type:ri})],Be.prototype,"defaultExtent",void 0),u([d()],Be.prototype,"defaultVectorBasemap",void 0),u([Pe("defaultVectorBasemap")],Be.prototype,"readDefaultVectorBasemap",null),u([d()],Be.prototype,"description",void 0),u([d()],Be.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],Be.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],Be.prototype,"extraQuery",null),u([d()],Be.prototype,"featuredGroups",void 0),u([d()],Be.prototype,"featuredItemsGroupQuery",void 0),u([d()],Be.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],Be.prototype,"livingAtlasGroupQuery",void 0),u([d()],Be.prototype,"hasCategorySchema",void 0),u([d()],Be.prototype,"helpBase",void 0),u([d()],Be.prototype,"helperServices",void 0),u([d()],Be.prototype,"helpMap",void 0),u([d()],Be.prototype,"homePageFeaturedContent",void 0),u([d()],Be.prototype,"homePageFeaturedContentCount",void 0),u([d()],Be.prototype,"httpPort",void 0),u([d()],Be.prototype,"httpsPort",void 0),u([d()],Be.prototype,"id",void 0),u([d()],Be.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],Be.prototype,"isOrganization",null),u([d()],Be.prototype,"isPortal",void 0),u([d()],Be.prototype,"isReadOnly",void 0),u([d()],Be.prototype,"layerTemplatesGroupQuery",void 0),u([d()],Be.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],Be.prototype,"modified",void 0),u([d()],Be.prototype,"name",void 0),u([d()],Be.prototype,"portalHostname",void 0),u([d()],Be.prototype,"portalMode",void 0),u([d()],Be.prototype,"portalProperties",void 0),u([d()],Be.prototype,"region",void 0),u([d({readOnly:!0})],Be.prototype,"restUrl",null),u([d()],Be.prototype,"rotatorPanels",void 0),u([d()],Be.prototype,"showHomePageDescription",void 0),u([d()],Be.prototype,"sourceJSON",void 0),u([d()],Be.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],Be.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],Be.prototype,"stylesGroupQuery3d",void 0),u([d()],Be.prototype,"supportsHostedServices",void 0),u([d()],Be.prototype,"symbolSetsGroupQuery",void 0),u([d()],Be.prototype,"templatesGroupQuery",void 0),u([d()],Be.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Be.prototype,"thumbnailUrl",null),u([d()],Be.prototype,"units",void 0),u([d()],Be.prototype,"url",void 0),u([d()],Be.prototype,"urlKey",void 0),u([Pe("urlKey")],Be.prototype,"readUrlKey",null),u([d()],Be.prototype,"user",void 0),u([Pe("user")],Be.prototype,"readUser",null),u([d()],Be.prototype,"useStandardizedQuery",void 0),u([d()],Be.prototype,"useVectorBasemaps",void 0),u([d()],Be.prototype,"vectorBasemapGalleryGroupQuery",void 0),Be=Mc=u([P("esri.portal.Portal")],Be);const Ro=Be;fe.getLogger("esri.core.Clonable");const mc=e=>{let t=class extends e{clone(){var l;const i=U2e(Xo(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==yi.USER&&p!==yi.DEFAULTS&&p!==yi.WEB_MAP&&p!==yi.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:_8(m),m!=null&&y==null||(p===yi.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=Xo(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,yi.DEFAULTS)}return a}};return t=u([P("esri.core.Clonable")],t),t};let vJ=class extends mc(Ee){};vJ=u([P("esri.core.Clonable")],vJ);let Y_=class extends mc(ye){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return _(e)&&e.placement===this.placement&&e.style===this.style&&(A(this.color)&&A(e.color)||_(this.color)&&_(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Y_.prototype,"type",void 0),u([d({type:JRe,json:{default:"begin-end",write:!0}})],Y_.prototype,"placement",void 0),u([d({type:che,json:{default:"arrow",write:!0}})],Y_.prototype,"style",void 0),u([d({type:qe,json:{type:[Lr],default:null,write:!0}})],Y_.prototype,"color",void 0),Y_=u([P("esri.symbols.LineStyleMarker3D")],Y_);const _V=Y_;var Z$;let Np=Z$=class extends Vf{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=yu(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:_(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:_(this.pattern)?this.pattern.clone():null,marker:_(this.marker)?this.marker.clone():null};return new Z$(e)}static fromSimpleLineSymbol(e){var i,r,s;const t={enabled:!0,size:(i=e.width)!=null?i:yu(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new mq({style:e.style}):null,material:new hu({color:(e.color||lR).clone()}),marker:e.marker?new _V({placement:e.marker.placement,style:e.marker.style,color:(s=(r=e.marker.color)==null?void 0:r.clone())!=null?s:null}):null};return new Z$(t)}};u([d({type:hu,json:{write:!0}})],Np.prototype,"material",void 0),u([ot({Line:"line"},{readOnly:!0})],Np.prototype,"type",void 0),u([d({type:The,json:{write:!0,default:"miter"}})],Np.prototype,"join",void 0),u([d({type:wq,json:{write:!0,default:"butt"}})],Np.prototype,"cap",void 0),u([d(Af)],Np.prototype,"size",void 0),u([d(fhe)],Np.prototype,"pattern",void 0),u([d({types:{key:"type",base:_V,typeMap:{style:_V}},json:{write:!0}})],Np.prototype,"marker",void 0),Np=Z$=u([P("esri.symbols.LineSymbol3DLayer")],Np);const DM=Np;var bV;const zMe=Ko()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let ZC=bV=class extends ye{clone(){return new bV({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:R4,write:Sv}})],ZC.prototype,"href",void 0),u([ot(zMe)],ZC.prototype,"primitive",void 0),ZC=bV=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],ZC);const Khe="sphere";var wV;let z1=wV=class extends Ee{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new wV({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],z1.prototype,"x",void 0),u([d({type:Number})],z1.prototype,"y",void 0),u([d({type:Number})],z1.prototype,"z",void 0),z1=wV=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],z1);var xV;let oa=xV=class extends Vf{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new xV({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:hu,json:{write:!0}})],oa.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],oa.prototype,"castShadows",void 0),u([d({type:ZC,json:{write:!0}})],oa.prototype,"resource",void 0),u([ot({Object:"object"},{readOnly:!0})],oa.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],oa.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],oa.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],oa.prototype,"depth",void 0),u([ot({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],oa.prototype,"anchor",void 0),u([d({type:z1,json:{type:[Number],read:{reader:e=>new z1({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],oa.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],oa.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],oa.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],oa.prototype,"roll",void 0),u([d({readOnly:!0})],oa.prototype,"isPrimitive",null),oa=xV=u([P("esri.symbols.ObjectSymbol3DLayer")],oa);const Lq=oa;var TV;let qa=TV=class extends Vf{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new TV({enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:hu,json:{write:!0}})],qa.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],qa.prototype,"castShadows",void 0),u([ot({Path:"path"},{readOnly:!0})],qa.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],qa.prototype,"profile",void 0),u([d({type:The,json:{write:!0,default:"miter"}})],qa.prototype,"join",void 0),u([d({type:bOe,json:{write:!0,default:"butt"}})],qa.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],qa.prototype,"width",void 0),u([Pe("width",["width","size","height"])],qa.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],qa.prototype,"height",void 0),u([Pe("height",["height","size","width"])],qa.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],qa.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],qa.prototype,"profileRotation",void 0),qa=TV=u([P("esri.symbols.PathSymbol3DLayer")],qa);const Nq=qa;var SV;let zT=SV=class extends ye{constructor(){super(...arguments),this.color=new qe([0,0,0,1]),this.size=0}clone(){const e={color:ie(this.color),size:this.size};return new SV(e)}};u([d(Gg)],zT.prototype,"color",void 0),u([d(Af)],zT.prototype,"size",void 0),zT=SV=u([P("esri.symbols.support.Symbol3DHalo")],zT);let dR=class extends mc(ye){constructor(e){super(e),this.color=null}};u([d(Gg)],dR.prototype,"color",void 0),dR=u([P("esri.symbols.support.Symbol3DTextBackground")],dR);var Q$;let Pl=Q$=class extends Vf{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){_(e)&&_(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s=ve(F({},r),{textSymbol3D:!0});t.font=e.write({},s),delete t.font.size}get size(){return _(this._userSize)?this._userSize:_(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,_(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new Q$({enabled:this.enabled,font:this.font&&ie(this.font),halo:this.halo&&ie(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:_(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ie(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new Q$({font:_(e.font)?e.font.clone():new E4,halo:BMe(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new hu({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new dR({color:e.backgroundColor.clone()}):null})}};function BMe(e,t){return e&&t>0?new zT({color:ie(e),size:t}):null}u([d({type:E4,json:{write:!0}})],Pl.prototype,"font",null),u([He("font")],Pl.prototype,"writeFont",null),u([d({type:zT,json:{write:!0}})],Pl.prototype,"halo",void 0),u([d(ve(F({},Ehe),{json:{default:"center",write:!0}}))],Pl.prototype,"horizontalAlignment",void 0),u([d(ve(F({},She),{json:{default:1,write:!0}}))],Pl.prototype,"lineHeight",void 0),u([d({type:hu,json:{write:!0}})],Pl.prototype,"material",void 0),u([d({type:dR,json:{write:!0}})],Pl.prototype,"background",void 0),u([d(Af)],Pl.prototype,"size",null),u([d({type:String,json:{write:!0}})],Pl.prototype,"text",void 0),u([ot({Text:"text"},{readOnly:!0})],Pl.prototype,"type",void 0),u([d(ve(F({},Che),{json:{default:"baseline",write:!0}}))],Pl.prototype,"verticalAlignment",void 0),Pl=Q$=u([P("esri.symbols.TextSymbol3DLayer")],Pl);const Cw=Pl;var EV;let qy=EV=class extends Vf{constructor(e){super(e),this.color=CV.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new EV({color:ie(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:qe,nonNullable:!0,json:{type:[Lr],write:(e,t,i)=>t[i]=e.toArray(qe.AlphaMode.UNLESS_OPAQUE),default:()=>CV.clone(),defaultEquals:e=>e.toCss(!0)===CV.toCss(!0)}})],qy.prototype,"color",void 0),u([ot({Water:"water"},{readOnly:!0})],qy.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],qy.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],qy.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],qy.prototype,"waveStrength",void 0),qy=EV=u([P("esri.symbols.WaterSymbol3DLayer")],qy);const CV=new qe([0,119,190]),ede=qy;var AV;let Z_=AV=class extends Ee{constructor(){super(...arguments),this.portal=null}clone(){return new AV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],Z_.prototype,"name",void 0),u([d({type:String})],Z_.prototype,"styleUrl",void 0),u([d({type:String})],Z_.prototype,"styleName",void 0),u([d({type:Ro})],Z_.prototype,"portal",void 0),Z_=AV=u([P("esri.symbols.support.StyleOrigin")],Z_);const RV=Z_;var OV;let pR=OV=class extends Ee{clone(){return new OV({url:this.url})}};u([d({type:String})],pR.prototype,"url",void 0),pR=OV=u([P("esri.symbols.support.Thumbnail")],pR);const tde={icon:q0,object:Lq,line:DM,path:Nq,fill:S4,extrude:lhe,text:Cw,water:ede},VMe=ft.ofType({base:Vf,key:"type",typeMap:tde,errorContext:"symbol-layer"}),GMe=fe.getLogger("esri.symbols.Symbol3D");let Fp=class extends fc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||ft;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&GMe.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Gb(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=qv(e.styleUrl,i);return new RV({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new RV({portal:i&&i.portal||Ro.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Ma("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=Pg(e.styleUrl,r);oc(s)&&(s=Xd(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!Phe(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new Ma("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof Vf||e&&tde[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],Fp.prototype,"color",null),u([d({type:VMe,nonNullable:!0,json:{write:!0}}),jt(Vhe)],Fp.prototype,"symbolLayers",null),u([d({type:RV})],Fp.prototype,"styleOrigin",void 0),u([Pe("styleOrigin")],Fp.prototype,"readStyleOrigin",null),u([He("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Fp.prototype,"writeStyleOrigin",null),u([d({type:pR,json:{read:!1}})],Fp.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Fp.prototype,"type",void 0),Fp=u([P("esri.symbols.Symbol3D")],Fp);const K2=Fp;let QC=class extends ye{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],QC.prototype,"type",void 0),u([d({readOnly:!0})],QC.prototype,"visible",void 0),QC=u([P("esri.symbols.callouts.Callout3D")],QC);const ide=QC;var MV;let J$=MV=class extends ye{constructor(){super(...arguments),this.color=new qe("white")}clone(){return new MV({color:ie(this.color)})}};u([d(Gg)],J$.prototype,"color",void 0),J$=MV=u([P("esri.symbols.callouts.LineCallout3DBorder")],J$);const rde=J$;Object.freeze(Object.defineProperty({__proto__:null,default:rde},Symbol.toStringTag,{value:"Module"}));var PV;let Wy=PV=class extends ide{constructor(e){super(e),this.type="line",this.color=new qe([0,0,0,1]),this.size=yu(1),this.border=null}get visible(){return this.size>0&&_(this.color)&&this.color.a>0}clone(){return new PV({color:ie(this.color),size:this.size,border:ie(this.border)})}};u([ot({line:"line"},{readOnly:!0})],Wy.prototype,"type",void 0),u([d(Gg)],Wy.prototype,"color",void 0),u([d(Af)],Wy.prototype,"size",void 0),u([d({type:rde,json:{write:!0}})],Wy.prototype,"border",void 0),u([d({readOnly:!0})],Wy.prototype,"visible",null),Wy=PV=u([P("esri.symbols.callouts.LineCallout3D")],Wy);const jMe=Wy;function Fq(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function sde(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!Fq(e)}function Uq(e){return e.type==="point-3d"||e.type==="label-3d"}function nde(e){return e.horizontalAlignment==="center"}const ode={types:{key:"type",base:ide,typeMap:{line:jMe}},json:{write:!0}};var IV;let B1=IV=class extends ye{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new IV({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Af)],B1.prototype,"screenLength",void 0),u([d({type:Number,json:{write:!0,default:0}})],B1.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],B1.prototype,"maxWorldLength",void 0),B1=IV=u([P("esri.symbols.support.Symbol3DVerticalOffset")],B1);var K$;const ade=ft.ofType({base:null,key:"type",typeMap:{text:Cw}});let Xy=K$=class extends K2{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new ade,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return sde(this)}hasVisibleVerticalOffset(){return Fq(this)}clone(){return new K$({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail),callout:ie(this.callout),verticalOffset:ie(this.verticalOffset)})}static fromTextSymbol(e){return new K$({symbolLayers:[Cw.fromTextSymbol(e)]})}};u([d({type:B1,json:{write:!0}})],Xy.prototype,"verticalOffset",void 0),u([d(ode)],Xy.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],Xy.prototype,"styleOrigin",void 0),u([d({type:ade})],Xy.prototype,"symbolLayers",void 0),u([ot({LabelSymbol3D:"label-3d"},{readOnly:!0})],Xy.prototype,"type",void 0),Xy=K$=u([P("esri.symbols.LabelSymbol3D")],Xy);const M4=Xy;var eD;const lde=ft.ofType({base:null,key:"type",typeMap:{line:DM,path:Nq}}),HMe=ft.ofType({base:null,key:"type",typeMap:{line:DM,path:Nq}});let JC=eD=class extends K2{constructor(e){super(e),this.symbolLayers=new lde,this.type="line-3d"}clone(){return new eD({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleLineSymbol(e){return new eD({symbolLayers:[DM.fromSimpleLineSymbol(e)]})}};u([d({type:lde,json:{type:HMe}})],JC.prototype,"symbolLayers",void 0),u([ot({LineSymbol3D:"line-3d"},{readOnly:!0})],JC.prototype,"type",void 0),JC=eD=u([P("esri.symbols.LineSymbol3D")],JC);const P4=JC;let Yy=class extends fc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Yy.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],Yy.prototype,"type",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Yy.prototype,"xoffset",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Yy.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:Ji(e),json:{write:!0}})],Yy.prototype,"size",void 0),Yy=u([P("esri.symbols.MarkerSymbol")],Yy);const cde=Yy;var $V;const ude=ft.ofType({base:null,key:"type",typeMap:{fill:S4}});let KC=$V=class extends K2{constructor(e){super(e),this.symbolLayers=new ude,this.type="mesh-3d"}clone(){return new $V({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}};u([d({type:ude})],KC.prototype,"symbolLayers",void 0),u([ot({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],KC.prototype,"type",void 0),KC=$V=u([P("esri.symbols.MeshSymbol3D")],KC);const kq=KC;function qMe(e,t,i){return t.imageData?Dhe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):hde(t.url,i)}function hde(e,t){return XMe(t)&&!oc(e)&&t.layer.parsedUrl?vl(t.layer.parsedUrl.path,"images",e):qv(e,t)}function WMe(e,t,i,r){if(Gf(e)){const s=A4(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&Sv(i.url,t,"url",r)}else Sv(e,t,"url",r)}const dde={json:{read:{source:["imageData","url"],reader:qMe},write:{writer(e,t,i,r){WMe(e,t,this.source,r)}}}},pde={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=hde(t.url,i)),r}}}};function XMe(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var DV;let Hu=DV=class extends uhe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=Ji(i)),r!=null&&(s.height=Ji(r)),s}clone(){const e=new DV({color:ie(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",ie(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([ot({esriPFS:"picture-fill"},{readOnly:!0})],Hu.prototype,"type",void 0),u([d(dde)],Hu.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],Hu.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],Hu.prototype,"yscale",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Hu.prototype,"width",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Hu.prototype,"height",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Hu.prototype,"xoffset",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Hu.prototype,"yoffset",void 0),u([d(pde)],Hu.prototype,"source",void 0),Hu=DV=u([P("esri.symbols.PictureFillSymbol")],Hu);const fde=Hu;var LV;let id=LV=class extends cde{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=Ji(t)),i!=null&&(r.height=Ji(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new LV({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",ie(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],id.prototype,"color",void 0),u([ot({esriPMS:"picture-marker"},{readOnly:!0})],id.prototype,"type",void 0),u([d(dde)],id.prototype,"url",void 0),u([d(pde)],id.prototype,"source",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],id.prototype,"height",void 0),u([Pe("height",["height","size"])],id.prototype,"readHeight",null),u([d({type:Number,cast:Ji,json:{write:!0}})],id.prototype,"width",void 0),u([d({json:{write:!1}})],id.prototype,"size",void 0),id=LV=u([P("esri.symbols.PictureMarkerSymbol")],id);const I4=id;var Zy;const mde=ft.ofType({base:null,key:"type",typeMap:{icon:q0,object:Lq,text:Cw}});let Q_=Zy=class extends K2{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new mde,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return sde(this)}hasVisibleVerticalOffset(){return Fq(this)}clone(){return new Zy({verticalOffset:ie(this.verticalOffset),callout:ie(this.callout),styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new Zy({symbolLayers:[q0.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new Zy({symbolLayers:[q0.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var i,r;return((r=(i=e.data)==null?void 0:i.symbol)==null?void 0:r.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new Zy({symbolLayers:[q0.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new Zy({symbolLayers:[q0.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new Zy({symbolLayers:[Cw.fromTextSymbol(e)]})}};u([d({type:B1,json:{write:!0}})],Q_.prototype,"verticalOffset",void 0),u([d(ode)],Q_.prototype,"callout",void 0),u([d({type:mde,json:{origins:{"web-scene":{write:!0}}}})],Q_.prototype,"symbolLayers",void 0),u([ot({PointSymbol3D:"point-3d"},{readOnly:!0})],Q_.prototype,"type",void 0),Q_=Zy=u([P("esri.symbols.PointSymbol3D")],Q_);const W0=Q_;var eA;const gde=ft.ofType({base:null,key:"type",typeMap:{extrude:lhe,fill:S4,icon:q0,line:DM,object:Lq,text:Cw,water:ede}});let tA=eA=class extends K2{constructor(e){super(e),this.symbolLayers=new gde,this.type="polygon-3d"}clone(){return new eA({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromJSON(e){const t=new eA;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:_(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new eA({symbolLayers:[S4.fromSimpleFillSymbol(e)]})}};u([d({type:gde,json:{write:!0}})],tA.prototype,"symbolLayers",void 0),u([ot({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],tA.prototype,"type",void 0),tA=eA=u([P("esri.symbols.PolygonSymbol3D")],tA);const LM=tA;var NV;const Lk=new xi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let J_=NV=class extends uhe{constructor(...e){super(...e),this.color=new qe([0,0,0,.25]),this.outline=new Uh,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new NV({color:ie(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],J_.prototype,"color",void 0),u([d()],J_.prototype,"outline",void 0),u([ot({esriSFS:"simple-fill"},{readOnly:!0})],J_.prototype,"type",void 0),u([d({type:Lk.apiValues,json:{read:Lk.read,write:Lk.write}})],J_.prototype,"style",void 0),J_=NV=u([P("esri.symbols.SimpleFillSymbol")],J_);const Wv=J_;var FV;const Nk=new xi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Up=FV=class extends cde{constructor(...e){super(...e),this.color=new qe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Uh}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=Ji(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new FV({angle:this.angle,color:ie(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],Up.prototype,"color",void 0),u([He("color")],Up.prototype,"writeColor",null),u([ot({esriSMS:"simple-marker"},{readOnly:!0})],Up.prototype,"type",void 0),u([d()],Up.prototype,"size",void 0),u([d({type:Nk.apiValues,json:{read:Nk.read,write:Nk.write}})],Up.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],Up.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Uh}},json:{default:null,write:!0}})],Up.prototype,"outline",void 0),Up=FV=u([P("esri.symbols.SimpleMarkerSymbol")],Up);const Xv=Up;var UV;let is=UV=class extends fc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new E4,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return Ji(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new UV({angle:this.angle,backgroundColor:ie(this.backgroundColor),borderLineColor:ie(this.borderLineColor),borderLineSize:this.borderLineSize,color:ie(this.color),font:this.font&&this.font.clone(),haloColor:ie(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:qe,json:{write:!0}})],is.prototype,"backgroundColor",void 0),u([d({type:qe,json:{write:!0}})],is.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0}})],is.prototype,"borderLineSize",void 0),u([d({type:E4,json:{write:!0}})],is.prototype,"font",void 0),u([d(ve(F({},Ehe),{json:{write:!0}}))],is.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],is.prototype,"kerning",void 0),u([d({type:qe,json:{write:!0}})],is.prototype,"haloColor",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],is.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],is.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],is.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],is.prototype,"text",void 0),u([ot({esriTS:"text"},{readOnly:!0})],is.prototype,"type",void 0),u([d(ve(F({},Che),{json:{write:!0}}))],is.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],is.prototype,"xoffset",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],is.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],is.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],is.prototype,"width",void 0),u([d({type:Number})],is.prototype,"lineWidth",void 0),u([He("lineWidth")],is.prototype,"writeLineWidth",null),u([jt("lineWidth")],is.prototype,"castLineWidth",null),u([d(She)],is.prototype,"lineHeight",void 0),u([He("lineHeight")],is.prototype,"writeLineHeight",null),is=UV=u([P("esri.symbols.TextSymbol")],is);const eE=is;var kV;const YMe=fe.getLogger("esri.symbols.WebStyleSymbol");let rd=kV=class extends fc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=_(this.portal)?this.portal:Ro.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new kV({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=_(t)?t.cache:null,r=i?this.fetchCacheKey:null;if(_(i)){const a=i.get(r);if(a)return a.clone()}const s=await ZMe();hi(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{YMe.error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(_(i)&&i.set(r,o.clone()),o):null}};function ZMe(){return import("./webStyleSymbolUtils.5a943a61.js")}u([d({json:{write:!1}})],rd.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],rd.prototype,"styleName",void 0),u([d({type:Ro,json:{write:!1}})],rd.prototype,"portal",void 0),u([d({type:String,json:{read:R4,write:Sv}})],rd.prototype,"styleUrl",void 0),u([d({type:pR,json:{read:!1}})],rd.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],rd.prototype,"name",void 0),u([ot({styleSymbolReference:"web-style"},{readOnly:!0})],rd.prototype,"type",void 0),u([d()],rd.prototype,"fetchCacheKey",null),rd=kV=u([P("esri.symbols.WebStyleSymbol")],rd);const Aw=rd;function $4(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function YS(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const xb={base:fc,key:"type",typeMap:{"simple-fill":Wv,"picture-fill":fde,"picture-marker":I4,"simple-line":Uh,"simple-marker":Xv,text:eE,"label-3d":M4,"line-3d":P4,"mesh-3d":kq,"point-3d":W0,"polygon-3d":LM,"web-style":Aw,cim:Q2},errorContext:"symbol"},QMe={base:fc,key:"type",typeMap:{"picture-marker":I4,"simple-marker":Xv,text:eE,"web-style":Aw,cim:Q2},errorContext:"symbol"},JMe=X2({types:xb}),yde={base:fc,key:"type",typeMap:{"simple-fill":Wv,"picture-fill":fde,"picture-marker":I4,"simple-line":Uh,"simple-marker":Xv,text:eE,"line-3d":P4,"mesh-3d":kq,"point-3d":W0,"polygon-3d":LM,"web-style":Aw,cim:Q2},errorContext:"symbol"},KMe={base:fc,key:"type",typeMap:{text:eE,"label-3d":M4},errorContext:"symbol"},_J={base:fc,key:"type",typeMap:{"line-3d":P4,"mesh-3d":kq,"point-3d":W0,"polygon-3d":LM,"web-style":Aw,cim:Q2},errorContext:"symbol"},e3e={base:fc,key:"type",typeMap:{"label-3d":M4},errorContext:"symbol"},vde=tp(xb),t3e=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function zV(e){return e instanceof Ee}function bJ(e){return e instanceof ft?Object.keys(e.items):zV(e)?Xo(e).keys():e?Object.keys(e):[]}function Q3(e,t){return e instanceof ft?e.items[t]:e[t]}function i3e(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function fR(e){return e?e.declaredClass:null}function _de(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=bJ(e),s=bJ(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||i3e(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&Q3(e,p)!==Q3(t,p)).concat(n,o).sort(),l=fR(e);if(l&&t3e.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=zV(e)&&zV(t);for(const p of a){const f=Q3(e,p),m=Q3(t,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[p]&&typeof i[p]=="function")y=i[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&fR(f)===fR(m)?_de(f,m):{type:"complete",oldValue:f,newValue:m};_(y)&&(_(c)?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function r3e(e,t){if(A(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function I_t(e,t){for(const i of t)if(r3e(e,i))return!0;return!1}function s3e(e,t){if(!(typeof e=="function"||typeof t=="function"||A(e)&&A(t)))return A(e)||A(t)||typeof e=="object"&&typeof t=="object"&&fR(e)!==fR(t)?{type:"complete",oldValue:e,newValue:t}:_de(e,t)}function J3(e){if(A(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!J3(i))return!1;for(const i of t.removed)if(!J3(i))return!1;for(const i of t.changed)if(!J3(i))return!1;return!0}case"partial":for(const t in e.diff)if(!J3(e.diff[t]))return!1;return!0}}var BV;let iA=BV=class extends ye{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new BV({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],iA.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],iA.prototype,"maxValue",void 0),iA=BV=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],iA);var VV;let T0=VV=class extends ye{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new VV({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ie(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],T0.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],T0.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],T0.prototype,"label",void 0),u([d({type:[iA],json:{write:!0}})],T0.prototype,"classBreakInfos",void 0),T0=VV=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],T0);var GV;const K3=new xi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),eP=new xi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),wJ={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},xJ=["high-to-low","above-and-below","centered-on","extremes"],TJ=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],SJ=["seconds","minutes","hours","days","months","years"];let Il=GV=class extends ye{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new GV({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:wJ,json:{write:!0}})],Il.prototype,"endTime",void 0),u([jt("endTime")],Il.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],Il.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],Il.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],Il.prototype,"minSliderValue",void 0),u([d({types:wJ,json:{write:!0}})],Il.prototype,"startTime",void 0),u([jt("startTime")],Il.prototype,"castStartTime",null),u([d({type:K3.apiValues,value:null,json:{type:K3.jsonValues,read:K3.read,write:K3.write}})],Il.prototype,"style",null),u([d({type:TJ,value:null,json:{type:TJ,origins:{"web-scene":{type:xJ,write:{writer:(e,t)=>{xJ.includes(e)&&(t.theme=e)}}}},write:!0}})],Il.prototype,"theme",null),u([d({type:eP.apiValues,json:{type:eP.jsonValues,read:eP.read,write:eP.write}})],Il.prototype,"type",void 0),u([d({type:SJ,json:{type:SJ,write:!0}})],Il.prototype,"units",void 0),Il=GV=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],Il);const n3e=Il;let tD=class extends ye{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],tD.prototype,"type",void 0),tD=u([P("esri.rest.support.ColorRamp")],tD);const zq=tD;var jV;let K_=jV=class extends zq{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new jV({fromColor:ie(this.fromColor),toColor:ie(this.toColor),algorithm:this.algorithm})}};u([ot({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],K_.prototype,"algorithm",void 0),u([d({type:qe,json:{type:[Lr],write:!0}})],K_.prototype,"fromColor",void 0),u([d({type:qe,json:{type:[Lr],write:!0}})],K_.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],K_.prototype,"type",void 0),K_=jV=u([P("esri.rest.support.AlgorithmicColorRamp")],K_);const Bq=K_;var HV;let rA=HV=class extends zq{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new HV({colorRamps:ie(this.colorRamps)})}};u([d({type:[Bq],json:{write:!0}})],rA.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],rA.prototype,"type",void 0),rA=HV=u([P("esri.rest.support.MultipartColorRamp")],rA);const bde=rA,o3e={key:"type",base:zq,typeMap:{algorithmic:Bq,multipart:bde}};function a3e(e){return e&&e.type?e.type==="algorithmic"?Bq.fromJSON(e):e.type==="multipart"?bde.fromJSON(e):null:null}var qV;const a_=new xi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),tP=new xi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),EJ=new xi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),CJ=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],l3e=["high-to-low","above-and-below","above","below","90-10"],c3e=["flow-line","wave-front"],u3e=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let on=qV=class extends ye{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return a3e(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new qV({classificationMethod:this.classificationMethod,colorRamp:ie(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:ie(this.field1),field2:ie(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:a_.apiValues,value:null,json:{type:a_.jsonValues,read:a_.read,write:a_.write,origins:{"web-document":{default:"manual",type:a_.jsonValues,read:a_.read,write:a_.write}}}})],on.prototype,"classificationMethod",null),u([d({types:o3e,json:{write:!0}})],on.prototype,"colorRamp",void 0),u([Pe("colorRamp")],on.prototype,"readColorRamp",null),u([d({type:[String],value:null,json:{write:!0}})],on.prototype,"fields",null),u([d({type:T0,value:null,json:{write:!0}})],on.prototype,"field1",null),u([d({type:T0,value:null,json:{write:!0}})],on.prototype,"field2",null),u([d({type:c3e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],on.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],on.prototype,"focus",null),u([d({type:Number,value:null,json:{type:Lr,write:!0}})],on.prototype,"numClasses",null),u([d({type:CJ,json:{type:CJ,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],on.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],on.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],on.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],on.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],on.prototype,"standardDeviationInterval",null),u([d({type:tP.apiValues,value:null,json:{type:tP.jsonValues,read:tP.read,write:tP.write,origins:{"web-scene":{type:EJ.jsonValues,write:{writer:EJ.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],on.prototype,"type",null),u([d({type:[n3e],json:{write:!0}})],on.prototype,"visualVariables",void 0),u([d({type:u3e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],on.prototype,"univariateSymbolStyle",null),u([d({type:l3e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],on.prototype,"univariateTheme",null),on=qV=u([P("esri.renderers.support.AuthoringInfo")],on);const wde=on,Fk=new xi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let sA=class extends ye{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:wde,json:{write:!0}})],sA.prototype,"authoringInfo",void 0),u([d({type:Fk.apiValues,readOnly:!0,json:{type:Fk.jsonValues,read:!1,write:{writer:Fk.write,ignoreOrigin:!0}}})],sA.prototype,"type",void 0),sA=u([P("esri.renderers.Renderer")],sA);const jg=sA;var WV;let fS=WV=class extends ye{constructor(){super(...arguments),this.title=null}clone(){return new WV({title:this.title})}};u([d({type:String,json:{write:!0}})],fS.prototype,"title",void 0),fS=WV=u([P("esri.renderers.support.LegendOptions")],fS);var XV;let iD=XV=class extends fS{constructor(){super(...arguments),this.showLegend=null}clone(){return new XV({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],iD.prototype,"showLegend",void 0),iD=XV=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],iD);const xde=iD,h3e=fe.getLogger("esri.renderers.visualVariables.VisualVariable"),Uk=new xi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let sd=class extends ye{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(h3e.error(".field: field must be a string value"),null):EM(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],sd.prototype,"index",void 0),u([d({type:Uk.apiValues,readOnly:!0,json:{read:Uk.read,write:Uk.write}})],sd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],sd.prototype,"field",void 0),u([jt("field")],sd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],sd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],sd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],sd.prototype,"arcadeRequired",null),u([d({type:xde,json:{write:!0}})],sd.prototype,"legendOptions",void 0),sd=u([P("esri.renderers.visualVariables.VisualVariable")],sd);const NM=sd;var YV;let e1=YV=class extends ye{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e==null?0:e}clone(){return new YV({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:qe,json:{type:[Lr],write:!0}})],e1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],e1.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],e1.prototype,"value",void 0),u([He("value")],e1.prototype,"writeValue",null),e1=YV=u([P("esri.renderers.visualVariables.support.ColorStop")],e1);const d3e=e1;var ZV;let t1=ZV=class extends NM{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new ZV({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],t1.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],t1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],t1.prototype,"normalizationField",void 0),u([d({type:[d3e],json:{write:!0}})],t1.prototype,"stops",null),t1=ZV=u([P("esri.renderers.visualVariables.ColorVariable")],t1);const Tde=t1;var QV;let Qy=QV=class extends ye{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return qS(t.transparency)}writeOpacity(e,t,i){t[i]=b4(e)}clone(){return new QV({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],Qy.prototype,"label",void 0),u([d({type:Number,json:{type:Lr,write:{target:"transparency"}}})],Qy.prototype,"opacity",void 0),u([Pe("opacity",["transparency"])],Qy.prototype,"readOpacity",null),u([He("opacity")],Qy.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],Qy.prototype,"value",void 0),Qy=QV=u([P("esri.renderers.visualVariables.support.OpacityStop")],Qy);const p3e=Qy;var JV;let i1=JV=class extends NM{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new JV({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],i1.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],i1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],i1.prototype,"normalizationField",void 0),u([d({type:[p3e],json:{write:!0}})],i1.prototype,"stops",null),i1=JV=u([P("esri.renderers.visualVariables.OpacityVariable")],i1);const Sde=i1;var KV;let wm=KV=class extends NM{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new KV({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],wm.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],wm.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],wm.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],wm.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],wm.prototype,"valueExpressionTitle",void 0),u([He("web-scene","valueExpressionTitle")],wm.prototype,"writeValueExpressionTitleWebScene",null),wm=KV=u([P("esri.renderers.visualVariables.RotationVariable")],wm);const Ede=wm;var e9;let qx=e9=class extends ye{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new e9({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],qx.prototype,"label",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],qx.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],qx.prototype,"value",void 0),qx=e9=u([P("esri.renderers.visualVariables.support.SizeStop")],qx);const f3e=qx;var t9;let rD=t9=class extends xde{constructor(){super(...arguments),this.customValues=null}clone(){return new t9({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],rD.prototype,"customValues",void 0),rD=t9=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],rD);const m3e=rD;var fg,Xn;function BT(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function cO(e){return e!=null&&!isNaN(e)&&isFinite(e)}function Cde(e){return e.valueExpression?fg.Expression:e.field&&typeof e.field=="string"?fg.Field:fg.Unknown}function g3e(e,t){const i=t||Cde(e),r=e.valueUnit||"unknown";return i===fg.Unknown?Xn.Constant:e.stops?Xn.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Xn.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Xn.Proportional:Xn.Additive:Xn.Identity:Xn.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(fg||(fg={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Xn||(Xn={}));let sD=class extends ye{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],sD.prototype,"type",void 0),sD=u([P("esri.popup.content.Content")],sD);const Rw=sD;var i9;let r1=i9=class extends Rw{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new i9({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],r1.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],r1.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],r1.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],r1.prototype,"type",void 0),r1=i9=u([P("esri.popup.content.AttachmentsContent")],r1);const uO=r1;var r9;let s1=r9=class extends Rw{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new r9({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ie(this.outFields):null})}};u([d()],s1.prototype,"creator",void 0),u([d()],s1.prototype,"destroyer",void 0),u([d()],s1.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],s1.prototype,"type",void 0),s1=r9=u([P("esri.popup.content.CustomContent")],s1);const y3e=s1;var s9;let Wx=s9=class extends ye{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new s9({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],Wx.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],Wx.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Wx.prototype,"returnType",void 0),Wx=s9=u([P("esri.popup.ElementExpressionInfo")],Wx);const Ade=Wx;var n9;let nA=n9=class extends Rw{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new n9({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:Ade,json:{write:!0}})],nA.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],nA.prototype,"type",void 0),nA=n9=u([P("esri.popup.content.ExpressionContent")],nA);const Vq=nA,hO=Ko()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});hO.toJSON.bind(hO);hO.fromJSON.bind(hO);const hp={year:"numeric",month:"numeric",day:"numeric"},OE={year:"numeric",month:"long",day:"numeric"},ME={year:"numeric",month:"short",day:"numeric"},PE={year:"numeric",month:"long",weekday:"long",day:"numeric"},qu={hour:"numeric",minute:"numeric"},Hh=ve(F({},qu),{second:"numeric"}),Gq={"short-date":hp,"short-date-short-time":F(F({},hp),qu),"short-date-short-time-24":ve(F(F({},hp),qu),{hour12:!1}),"short-date-long-time":F(F({},hp),Hh),"short-date-long-time-24":ve(F(F({},hp),Hh),{hour12:!1}),"short-date-le":hp,"short-date-le-short-time":F(F({},hp),qu),"short-date-le-short-time-24":ve(F(F({},hp),qu),{hour12:!1}),"short-date-le-long-time":F(F({},hp),Hh),"short-date-le-long-time-24":ve(F(F({},hp),Hh),{hour12:!1}),"long-month-day-year":OE,"long-month-day-year-short-time":F(F({},OE),qu),"long-month-day-year-short-time-24":ve(F(F({},OE),qu),{hour12:!1}),"long-month-day-year-long-time":F(F({},OE),Hh),"long-month-day-year-long-time-24":ve(F(F({},OE),Hh),{hour12:!1}),"day-short-month-year":ME,"day-short-month-year-short-time":F(F({},ME),qu),"day-short-month-year-short-time-24":ve(F(F({},ME),qu),{hour12:!1}),"day-short-month-year-long-time":F(F({},ME),Hh),"day-short-month-year-long-time-24":ve(F(F({},ME),Hh),{hour12:!1}),"long-date":PE,"long-date-short-time":F(F({},PE),qu),"long-date-short-time-24":ve(F(F({},PE),qu),{hour12:!1}),"long-date-long-time":F(F({},PE),Hh),"long-date-long-time-24":ve(F(F({},PE),Hh),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":qu,"long-time":Hh},dO=Ko()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});dO.apiValues;dO.toJSON.bind(dO);dO.fromJSON.bind(dO);const v3e={ar:"ar-u-nu-latn-ca-gregory"};let nD=new WeakMap,Rde=Gq["short-date-short-time"];function _3e(e){const t=e||Rde;if(!nD.has(t)){const i=du(),r=v3e[du()]||i;nD.set(t,new Intl.DateTimeFormat(r,t))}return nD.get(t)}function D4(e){return Gq[e]||null}function Mf(e,t){return _3e(t).format(e)}$q(()=>{nD=new WeakMap,Rde=Gq["short-date-short-time"]});const b3e={ar:"ar-u-nu-latn"};let oD=new WeakMap,Ode={};function w3e(e){const t=e||Ode;if(!oD.has(t)){const i=du(),r=b3e[du()]||i;oD.set(t,new Intl.NumberFormat(r,e))}return oD.get(t)}function Mde(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Pf(e,t){return e===-0&&(e=0),w3e(t).format(e)}$q(()=>{oD=new WeakMap,Ode={}});var o9;let n1=o9=class extends ye{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new o9({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Mf(e,F(F({},D4(this.dateFormat)),this.dateTimeFormatOptions)):Pf(e,Mde(this))}formatRasterPixelValue(e){let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(";")?(t=";",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,this)):this.format(Number(e))}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(s=>this.format(Number(s))).join(i):e}};u([ot(hO)],n1.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],n1.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],n1.prototype,"digitSeparator",void 0),u([d({type:Lr,json:{write:!0}})],n1.prototype,"places",void 0),n1=o9=u([P("esri.popup.support.FieldInfoFormat")],n1);const VT=n1;var a9;let nd=a9=class extends ye{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new a9({fieldName:this.fieldName,format:this.format?ie(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],nd.prototype,"fieldName",void 0),u([d({type:VT,json:{write:!0}})],nd.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],nd.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],nd.prototype,"label",void 0),u([ot(new xi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],nd.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],nd.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],nd.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],nd.prototype,"visible",void 0),nd=a9=u([P("esri.popup.FieldInfo")],nd);const FM=nd;var l9;let xm=l9=class extends Rw{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new l9(ie({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],xm.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],xm.prototype,"description",void 0),u([d({type:[FM]})],xm.prototype,"fieldInfos",void 0),u([He("fieldInfos")],xm.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],xm.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],xm.prototype,"type",void 0),xm=l9=u([P("esri.popup.content.FieldsContent")],xm);const ZS=xm;let o1=class extends ye{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],o1.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],o1.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],o1.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],o1.prototype,"type",void 0),o1=u([P("esri.popup.content.mixins.MediaInfo")],o1);const jq=o1;var c9;let Xx=c9=class extends Ee{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new c9({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],Xx.prototype,"fieldName",void 0),u([d()],Xx.prototype,"tooltip",void 0),u([d()],Xx.prototype,"value",void 0),Xx=c9=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],Xx);const Pde=Xx;var u9;let a1=u9=class extends ye{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new u9({fields:ie(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],a1.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],a1.prototype,"normalizeField",void 0),u([d({type:[Pde],json:{read:!1}})],a1.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],a1.prototype,"tooltipField",void 0),a1=u9=u([P("esri.popup.content.support.ChartMediaInfoValue")],a1);const x3e=a1;let oA=class extends jq{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],oA.prototype,"type",void 0),u([d({type:x3e,json:{write:!0}})],oA.prototype,"value",void 0),oA=u([P("esri.popup.content.mixins.ChartMediaInfo")],oA);const L4=oA,N4=Ko()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var h9;let aD=h9=class extends L4{constructor(e){super(e),this.type="bar-chart"}clone(){return new h9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:N4.write}})],aD.prototype,"type",void 0),aD=h9=u([P("esri.popup.content.BarChartMediaInfo")],aD);const Ide=aD;var d9;let lD=d9=class extends L4{constructor(e){super(e),this.type="column-chart"}clone(){return new d9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:N4.write}})],lD.prototype,"type",void 0),lD=d9=u([P("esri.popup.content.ColumnChartMediaInfo")],lD);const $de=lD;var p9;let aA=p9=class extends ye{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new p9({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],aA.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],aA.prototype,"sourceURL",void 0),aA=p9=u([P("esri.popup.content.support.ImageMediaInfoValue")],aA);const T3e=aA;var f9;let Yx=f9=class extends jq{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new f9({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],Yx.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Yx.prototype,"type",void 0),u([d({type:T3e,json:{write:!0}})],Yx.prototype,"value",void 0),Yx=f9=u([P("esri.popup.content.ImageMediaInfo")],Yx);const Dde=Yx;var m9;let cD=m9=class extends L4{constructor(e){super(e),this.type="line-chart"}clone(){return new m9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:N4.write}})],cD.prototype,"type",void 0),cD=m9=u([P("esri.popup.content.LineChartMediaInfo")],cD);const Lde=cD;var g9;let uD=g9=class extends L4{constructor(e){super(e),this.type="pie-chart"}clone(){return new g9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:N4.write}})],uD.prototype,"type",void 0),uD=g9=u([P("esri.popup.content.PieChartMediaInfo")],uD);const Nde=uD,Fde={base:jq,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Ide,"column-chart":$de,"line-chart":Lde,"pie-chart":Nde,image:Dde}};var y9;let od=y9=class extends Rw{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?Dde.fromJSON(t):t.type==="barchart"?Ide.fromJSON(t):t.type==="columnchart"?$de.fromJSON(t):t.type==="linechart"?Lde.fromJSON(t):t.type==="piechart"?Nde.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new y9(ie({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],od.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],od.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],od.prototype,"description",void 0),u([d({types:[Fde]})],od.prototype,"mediaInfos",void 0),u([Pe("mediaInfos")],od.prototype,"readMediaInfos",null),u([He("mediaInfos")],od.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],od.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],od.prototype,"type",void 0),od=y9=u([P("esri.popup.content.MediaContent")],od);const pO=od;var v9;let lA=v9=class extends Rw{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new v9({text:this.text})}};u([d({type:String,json:{write:!0}})],lA.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],lA.prototype,"type",void 0),lA=v9=u([P("esri.popup.content.TextContent")],lA);const QS=lA,S3e={base:null,key:"type",typeMap:{attachment:uO,media:pO,text:QS,expression:Vq,field:ZS}};var _9;let l1=_9=class extends ye{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new _9({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],l1.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],l1.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],l1.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],l1.prototype,"returnType",void 0),l1=_9=u([P("esri.popup.ExpressionInfo")],l1);const Ude=l1;var b9;let cA=b9=class extends ye{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new b9({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],cA.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],cA.prototype,"showNoDataRecords",void 0),cA=b9=u([P("esri.popup.LayerOptions")],cA);const E3e=cA;var w9;let uA=w9=class extends ye{constructor(e){super(e),this.field=null,this.order=null}clone(){return new w9({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],uA.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],uA.prototype,"order",void 0),uA=w9=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],uA);const kde=uA;var x9;let hA=x9=class extends ye{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new x9({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ie(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],hA.prototype,"showRelatedRecords",void 0),u([d({type:[kde],json:{write:!0}})],hA.prototype,"orderByFields",void 0),hA=x9=u([P("esri.popup.RelatedRecordsInfo")],hA);const C3e=hA;let A3e=0;const Hq=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+A3e++})}};return t=u([P("esri.core.Identifiable")],t),t};let AJ=class extends Hq(class{}){};AJ=u([P("esri.core.Identifiable")],AJ);var T9;let ad=T9=class extends Hq(Ee){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new T9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],ad.prototype,"active",void 0),u([d()],ad.prototype,"className",void 0),u([d()],ad.prototype,"disabled",void 0),u([d()],ad.prototype,"id",void 0),u([d()],ad.prototype,"indicator",void 0),u([d()],ad.prototype,"title",void 0),u([d()],ad.prototype,"type",void 0),u([d()],ad.prototype,"visible",void 0),ad=T9=u([P("esri.support.actions.ActionBase")],ad);const F4=ad;var S9;let hD=S9=class extends F4{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new S9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],hD.prototype,"image",void 0),hD=S9=u([P("esri.support.Action.ActionButton")],hD);const tE=hD;var E9;let dA=E9=class extends F4{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new E9({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],dA.prototype,"image",void 0),u([d()],dA.prototype,"value",void 0),dA=E9=u([P("esri.support.Action.ActionToggle")],dA);const zde=dA;var C9;const R3e=ft.ofType({key:"type",defaultKeyValue:"button",base:F4,typeMap:{button:tE,toggle:zde}}),O3e={base:Rw,key:"type",typeMap:{media:pO,custom:y3e,text:QS,attachments:uO,fields:ZS,expression:Vq}},Bde="esri.PopupTemplate",M3e=fe.getLogger(Bde),P3e=["attachments","fields","media","text","expression"];let yn=C9=class extends ye{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>tp(O3e,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Eu(e)?e:(M3e.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>P3e.includes(s.type)).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(r);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?ie(e.toArray()):[];return new C9({actions:t,content:Array.isArray(this.content)?ie(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?ie(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?ie(this.fieldInfos):null,layerOptions:this.layerOptions?ie(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?ie(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?ie(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),nO(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ie(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ie(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),pO.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),QS.fromJSON(s)):s.type==="attachments"?uO.fromJSON(s):s.type==="fields"?ZS.fromJSON(s):s.type==="expression"?Vq.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new QS({text:e})):r.push(new ZS),Array.isArray(t)&&t.length&&r.push(pO.fromJSON({mediaInfos:t})),i&&r.push(uO.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((r,s)=>[...r,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>yl(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:R3e})],yn.prototype,"actions",void 0),u([d()],yn.prototype,"content",void 0),u([jt("content")],yn.prototype,"castContent",null),u([Pe("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],yn.prototype,"readContent",null),u([He("content",{popupElements:{type:ft.ofType(S3e)},showAttachments:{type:Boolean},mediaInfos:{type:ft.ofType(Fde)},description:{type:String}})],yn.prototype,"writeContent",null),u([d({type:[Ude],json:{write:!0}})],yn.prototype,"expressionInfos",void 0),u([d({type:[FM]})],yn.prototype,"fieldInfos",void 0),u([He("fieldInfos")],yn.prototype,"writeFieldInfos",null),u([d({type:E3e})],yn.prototype,"layerOptions",void 0),u([He("layerOptions")],yn.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],yn.prototype,"lastEditInfoEnabled",void 0),u([d()],yn.prototype,"outFields",void 0),u([d()],yn.prototype,"overwriteActions",void 0),u([d()],yn.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],yn.prototype,"title",void 0),u([He("title")],yn.prototype,"writeTitle",null),u([d({type:C3e,json:{write:!0}})],yn.prototype,"relatedRecordsInfo",void 0),yn=C9=u([P(Bde)],yn);const iE=yn;function I3e(e){if(!e)return null;const t={};for(const i in e){const r=Og(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function $3e(e){if(!_(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let $l=class extends mc(ye){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:hl(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&_(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:$3e(this.aggregateGeometries),geometry:_(this.geometry)?this.geometry.toJSON():null,symbol:_(this.symbol)?this.symbol.toJSON():null,attributes:F({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){_(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:I3e}})],$l.prototype,"aggregateGeometries",null),u([d({value:null})],$l.prototype,"attributes",null),u([d({value:null,types:Tw,json:{read:Og}})],$l.prototype,"geometry",null),u([d({type:Boolean})],$l.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],$l.prototype,"layer",void 0),u([d({type:iE})],$l.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],$l.prototype,"sourceLayer",void 0),u([d({value:null,types:xb})],$l.prototype,"symbol",null),u([d({type:Boolean,value:!0})],$l.prototype,"visible",null),$l=u([P("esri.Graphic")],$l),function(e){e.generateUID=hl}($l||($l={}));const Pa=$l;function $_t(e){}function D3e(e){return()=>e}function qq(e){return new Ke({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const Vde=qq(Ai),pN=qq(vf),fN=qq(Rg),L3e=new Ke({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Ai.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function If(e){return e&&(zf(e)||e===pN)?pN:e&&(Bf(e)||e===fN)?fN:Vde}function wi(e){return e&&(zf(e)||e===pN)?vf:e&&(Bf(e)||e===fN)?Rg:Ai}function D_t(e){return qH(e)?vf:WH(e)?Rg:Ai}const Gde=39.37,N3e=Ai.radius*Math.PI/200,jde=/UNIT\[([^\]]+)\]\]$/i,Tb=L,Hde=/UNIT\[([^\]]+)\]/i,F3e=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),U3e=Ko()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),dp=e=>e*e,ay=e=>e*e*e,fO={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:dp(.001)},"square-centimeters":{inBaseUnits:dp(.01)},"square-decimeters":{inBaseUnits:dp(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:dp(1e3)},"square-inches":{inBaseUnits:dp(.0254)},"square-feet":{inBaseUnits:dp(.3048)},"square-yards":{inBaseUnits:dp(.9144)},"square-miles":{inBaseUnits:dp(1609.344)},"square-us-feet":{inBaseUnits:dp(1200/3937)},acres:{inBaseUnits:.0015625*dp(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*ay(.001)},"cubic-centimeters":{inBaseUnits:1e3*ay(.01)},"cubic-decimeters":{inBaseUnits:1e3*ay(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*ay(1e3)},"cubic-inches":{inBaseUnits:1e3*ay(.0254)},"cubic-feet":{inBaseUnits:1e3*ay(.3048)},"cubic-yards":{inBaseUnits:1e3*ay(.9144)},"cubic-miles":{inBaseUnits:1e3*ay(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},k3e=(()=>{const e={};for(const t in fO)for(const i in fO[t].units)e[i]=t;return e})();function z3e(e,t,i){return e*fO[i].units[t].inBaseUnits}function B3e(e,t,i){return e/fO[i].units[t].inBaseUnits}const V3e=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function A9(e){const t=k3e[e];if(!t)throw new Error("unknown type");return t}function RJ(e,t=null){return t=t||A9(e),fO[t].baseUnit===e}function Hs(e,t,i){if(t===i)return e;const r=A9(t);if(r!==A9(i))throw new Error("incompatible units");const s=RJ(t,r)?e:z3e(e,t,r);return RJ(i,r)?s:B3e(s,i,r)}function G3e(e,t){const i=Hs(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function j3e(e,t){const i=Hs(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function H3e(e,t){const i=Hs(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function q3e(e,t){const i=Hs(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function L_t(e,t){const i=Hs(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function N_t(e,t){const i=Hs(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function W3e(e,t,i){return Hs(e,t,"meters")/(i*Math.PI/180)}function qde(e){return U3e.fromJSON(e.toLowerCase())||null}function JS(e){if(e&&typeof e=="object"&&!iO(e))return 1;const t=gc(e);return t>1e5?1:t}function X3e(e){return gc(e)>=(e instanceof Ke?wi(e).metersPerDegree:1e5)?"meters":Wq(e)}function gc(e,t=Ai.metersPerDegree){return vt(Y3e(e,!0),t)}function Y3e(e,t=!1){let i,r,s=null;if(e!=null&&(typeof e=="object"?(i=e.wkid,r=e.wkt):typeof e=="number"?i=e:typeof e=="string"&&(r=e)),i){if(qH(i))return vf.metersPerDegree;if(WH(i))return Rg.metersPerDegree;s=Tb.values[Tb[i]],!s&&t&&F3e.has(i)&&(s=N3e)}else r&&(Yde(r)?s=OJ(jde.exec(r),s):Xde(r)&&(s=OJ(Hde.exec(r),s)));return s}function OJ(e,t){return e&&e[1]?Wde(e[1]):t}function Wde(e){return parseFloat(e.split(",")[1])}function Wq(e){let t,i,r=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,i=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(i=e)),t)r=Tb.units[Tb[t]];else if(i){const s=Yde(i)?jde:Xde(i)?Hde:null;if(s){const n=s.exec(i);n&&n[1]&&(r=Q3e(n[1]))}}return _(r)?qde(r):null}function F_t(e){const t=Wq(e);return A(t)||!V3e.includes(t)?null:t}function Xde(e){return/^GEOCCS/i.test(e)}function Yde(e){return/^PROJCS/i.test(e)}const Z3e=1e-7;function Q3e(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!Tb.units.includes(i)){const r=Wde(e);i=null;const s=Tb.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<Z3e){i=Tb.units[n];break}}return i}function J3e(e){const t=Wq(e);if(A(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function U_t(e){var s,n,o;const t="metric";if(A(e))return t;const i=e.map,r=i&&"portalItem"in i?(s=i.portalItem)==null?void 0:s.portal:null;if(r)switch((o=(n=r==null?void 0:r.user)==null?void 0:n.units)!=null?o:r.units){case t:return t;case"english":return"imperial"}return vt(J3e(e.spatialReference),t)}const Zde={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},Qde={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},K3e=Ko()(Zde),ePe=Ko()(Qde);Ko()(F(F({},Zde),Qde));const KS={inches:Hs(1,"meters","inches"),feet:Hs(1,"meters","feet"),"us-feet":Hs(1,"meters","us-feet"),yards:Hs(1,"meters","yards"),miles:Hs(1,"meters","miles"),"nautical-miles":Hs(1,"meters","nautical-miles"),millimeters:Hs(1,"meters","millimeters"),centimeters:Hs(1,"meters","centimeters"),decimeters:Hs(1,"meters","decimeters"),meters:Hs(1,"meters","meters"),kilometers:Hs(1,"meters","kilometers"),"decimal-degrees":1/W3e(1,"meters",Ai.radius)},Ev=fe.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),MJ=new Pa,dD=Math.PI,Jde=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function Kde(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Ev.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(A(i)||A(i.arcade))return void Ev.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,w=v.getViewInfo(y),b=v.createExecContext(n,w);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=Yq(a,c);if(y){const v=y[0],w=y[1],b=v===w?r.stops[v].color:qe.blendColors(r.stops[v].color,r.stops[w].color,y[2],_(i)?i.color:void 0);return new qe(b)}}}function epe(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Ev.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(A(i)||A(i.arcade))return void Ev.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,w=v.getViewInfo(y),b=v.createExecContext(n,w);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=Yq(a,c);if(y){const v=y[0],w=y[1];if(v===w)return r.stops[v].opacity;{const b=r.stops[v].opacity;return b+(r.stops[w].opacity-b)*y[2]}}}}function tpe(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Ev.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(A(i)||A(i.arcade))return void Ev.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(m),w=y.createExecContext(a,v);if(!p){const b=y.createSyntaxTree(r.valueExpression);p=y.createFunction(b),r.cache.compiledFunc=p}f=y.executeFunction(p,w)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function tPe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=_(i)?i.scale:void 0,p=_(i)?i.view:void 0;o=h==null||p==="3d"?iPe(e):h}else if(!r)switch(e.inputValueType){case fg.Expression:{if(A(i)||A(i.arcade))return void Ev.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(e.valueExpression);l=p.createFunction(y),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case fg.Field:n&&(o=n[e.field]);break;case fg.Unknown:o=null}if(!cO(o))return null;if(r||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return cO(c)&&c!==0?o/c:null}function iPe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function U4(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Ev.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=rpe(tPe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function ac(e,t,i){return e==null?null:BT(e)?U4(e,t,i):cO(e)?e:null}function ipe(e,t,i){return cO(i)&&e>i?i:cO(t)&&e<t?t:e}function rPe(e,t,i,r){return e+(ac(t.minSize,i,r)||t.minDataValue)}function sPe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),ac(s,t,i)}function nPe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=ac(t.minSize,i,r),o=ac(t.maxSize,i,r),a=_(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?dD*(n/2)**2:n*n,h=c+s*((l?dD*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/dD):Math.sqrt(h)}return n+s*(o-n)}function oPe(e,t,i,r){const s=_(r)?r.shape:void 0,n=e/t.minDataValue,o=ac(t.minSize,i,r),a=ac(t.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,ipe(l,o,a)}function aPe(e,t,i,r,s){const[n,o,a]=Yq(e,s);if(n===o)return ac(t.stops[n].size,i,r);{const l=ac(t.stops[n].size,i,r);return l+(ac(t.stops[o].size,i,r)-l)*a}}function lPe(e,t,i,r){const s=(_(r)&&r.resolution?r.resolution:1)*KS[t.valueUnit],n=ac(t.minSize,i,r),o=ac(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/dD)/s:a==="radius"||a==="distance"?2*e/s:e/s,ipe(l,n,o)}function rpe(e,t,i,r,s){switch(t.transformationType){case Xn.Additive:return rPe(e,t,i,r);case Xn.Constant:return sPe(t,i,r);case Xn.ClampedLinear:return nPe(e,t,i,r);case Xn.Proportional:return oPe(e,t,i,r);case Xn.Stops:return aPe(e,t,i,r,s);case Xn.RealWorldSize:return lPe(e,t,i,r);case Xn.Identity:return e;case Xn.Unknown:return null}}function cPe(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=ac(e.minSize,MJ,s),o=ac(e.maxSize,MJ,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function Xq(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=Kde(l,t,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=epe(l,t,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=tpe(l,t,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=U4(l,t,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function Yq(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function uPe(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":U4(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}var Zq=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAllSizes:uPe,getColor:Kde,getOpacity:epe,getRotationAngle:tpe,getSize:U4,getSizeForValue:rpe,getSizeFromNumberOrVariable:ac,getSizeRangeAtScale:cPe,getVisualVariableValues:Xq,viewScaleRE:Jde}),R9;const zw=fe.getLogger("esri.renderers.visualVariables.SizeVariable"),iP=new xi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),O9=new xi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function PJ(e){if(e!=null)return typeof e=="string"||typeof e=="number"?Ji(e):e.type==="size"?BT(e)?e:(delete(e=F({},e)).type,new tr(e)):void 0}function IJ(e,t,i){if(typeof e!="object")return e;const r=new tr;return r.read(e,i),r}let tr=R9=class extends NM{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:Jde.test(this.valueExpression)}}set expression(e){zw.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){BT(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),BT(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return Cde(this)}set maxDataValue(e){e&&this.stops&&(zw.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(zw.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return PJ(e)}readMaxSize(e,t,i){return IJ(e,t,i)}set minDataValue(e){e&&this.stops&&(zw.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(zw.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return PJ(e)}readMinSize(e,t,i){return IJ(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(zw.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return g3e(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?O9.read(e):null}clone(){return new R9({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:BT(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:BT(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Xn.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===Xn.Stops){const e=this.stops,t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],tr.prototype,"cache",null),u([d({type:iP.apiValues,json:{type:iP.jsonValues,origins:{"web-map":{read:!1}},read:iP.read,write:iP.write}})],tr.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],tr.prototype,"expression",null),u([d()],tr.prototype,"index",null),u([d({type:String,readOnly:!0})],tr.prototype,"inputValueType",null),u([d({type:m3e,json:{write:!0}})],tr.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],tr.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],tr.prototype,"maxSize",null),u([jt("maxSize")],tr.prototype,"castMaxSize",null),u([Pe("maxSize")],tr.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],tr.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],tr.prototype,"minSize",null),u([jt("minSize")],tr.prototype,"castMinSize",null),u([Pe("minSize")],tr.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],tr.prototype,"normalizationField",void 0),u([d({readOnly:!0})],tr.prototype,"arcadeRequired",null),u([d({type:String})],tr.prototype,"scaleBy",void 0),u([d({type:[f3e],value:null,json:{write:!0}})],tr.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],tr.prototype,"target",void 0),u([d({type:String,readOnly:!0})],tr.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],tr.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],tr.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],tr.prototype,"valueExpression",void 0),u([Pe("valueExpression",["valueExpression","expression"])],tr.prototype,"readValueExpression",null),u([He("web-scene","valueExpression")],tr.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],tr.prototype,"valueRepresentation",void 0),u([d({type:O9.apiValues,json:{write:O9.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],tr.prototype,"valueUnit",void 0),u([Pe("valueUnit")],tr.prototype,"readValueUnit",null),tr=R9=u([P("esri.renderers.visualVariables.SizeVariable")],tr);const spe=tr,hPe=fe.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),dPe={color:Tde,size:spe,opacity:Sde,rotation:Ede},pPe=new xi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),fPe=/^\[([^\]]+)\]$/i;let pD=class extends Ee{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(fPe),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=pPe.read(a.type),c=dPe[l];c||(hPe.warn(`Unknown variable type: ${l}`),i&&i.messages&&i.messages.push(new Ma("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:i})));const h=new c;return h.read(a,i),h})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],pD.prototype,"visualVariables",null),pD=u([P("esri.renderers.visualVariables.VisualVariableFactory")],pD);const mPe=pD,gPe={base:NM,key:"type",typeMap:{opacity:Sde,color:Tde,rotation:Ede,size:spe}},rE=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new mPe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Eh(i,r,n.field),n.normalizationField&&Eh(i,r,n.normalizationField),n.valueExpression&&await yl(i,r,n.valueExpression))}};return u([d({types:[gPe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([Pe("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([He("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([P("esri.renderers.mixins.VisualVariablesMixin")],t),t},IE={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function yPe(e,t=IE){var a,l;if(!e)return{symbol:null};const{retainId:i=IE.retainId,ignoreDrivers:r=IE.ignoreDrivers,hasLabelingContext:s=IE.hasLabelingContext,retainCIM:n=IE.retainCIM}=t;let o;if(YS(e)||e instanceof Aw)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new H("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():W0.fromCIMSymbol(e)}else if(e instanceof Uh)o=P4.fromSimpleLineSymbol(e);else if(e instanceof Xv)o=W0.fromSimpleMarkerSymbol(e);else if(e instanceof I4)o=W0.fromPictureMarkerSymbol(e);else if(e instanceof Wv)o=LM.fromSimpleFillSymbol(e);else{if(!(e instanceof eE))return{error:new H("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?M4.fromTextSymbol(e):W0.fromTextSymbol(e)}if(i&&o.type!=="cim"&&(o.id=e.id),r&&YS(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const vPe=["building-scene","integrated-mesh","point-cloud","scene"];function mN(e,t,i,r){const s=npe(e,{},{context:r,isLabelSymbol:!1});_(s)&&(t[i]=s)}function $J(e,t,i,r){const s=npe(e,{},{context:r,isLabelSymbol:!0});_(s)&&(t[i]=s)}function DJ(e){return e instanceof K2||e instanceof Aw}function npe(e,t,i){var a;if(A(e))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!DJ(e)){const l=yPe(e,{retainCIM:!0,hasLabelingContext:s});return _(l.symbol)?l.symbol.write(t,r):(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:l.error})),null)}return(n==="web-map"||n==="portal-item"&&!vPe.includes((a=r==null?void 0:r.layer)==null?void 0:a.type))&&DJ(e)?(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function k_t(e,t){return JMe(e,null,t)}const UM={types:yde,json:{write:{writer:mN},origins:{"web-scene":{types:_J,write:{writer:mN},read:{reader:X2({types:_J})}}}}},ope={types:{base:fc,key:"type",typeMap:{"simple-fill":xb.typeMap["simple-fill"],"picture-fill":xb.typeMap["picture-fill"],"polygon-3d":xb.typeMap["polygon-3d"]}},json:{write:{writer:mN},origins:{"web-scene":{type:LM,write:{writer:mN}}}}};var M9;let Jy=M9=class extends ye{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new M9({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],Jy.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],Jy.prototype,"label",void 0),u([d(UM)],Jy.prototype,"symbol",void 0),u([d({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],Jy.prototype,"value",void 0),u([jt("value")],Jy.prototype,"castValue",null),Jy=M9=u([P("esri.renderers.support.UniqueValueInfo")],Jy);const gN=Jy,_Pe=()=>!!he("enable-feature:force-wosr"),z_t=()=>!!he("enable-feature:direct-3d-object-feature-layer-display"),kk={};async function bPe(e,t){try{return{data:(await SPe(e,t)).data,baseUrl:WOe(e),styleUrl:e}}catch(i){return nc(i),null}}function wPe(e,t,i){const r=_(t.portal)?t.portal:Ro.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return kk[n]||(kk[n]=xPe(e,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl,styleName:e}))),kk[n]}function xPe(e,t,i){return t.load(i).then(()=>{const r=new ig({disableExtraQuery:!0,query:`owner:${LJ} AND type:${NJ} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords.some(a=>a.toLowerCase()===n)&&o.type===NJ&&o.owner===LJ){s=o;break}}if(!s)throw new H("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function TPe(e,t,i){return e.styleUrl?bPe(e.styleUrl,i):e.styleName?wPe(e.styleName,t,i):Promise.reject(new H("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function B_t(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function V_t(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!_Pe()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function SPe(e,t){const i=F({responseType:"json",query:{f:"json"}},t);return ai(Xd(e),i)}const LJ="esri_en",NJ="Style",G_t="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var pA;const l_=fe.getLogger("esri.renderers.UniqueValueRenderer"),EPe=Ds(gN);let xs=pA=class extends rE(jg){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(a=>a.value===i[n].value);o?s3e(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:EM(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new H("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):l_.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||Ro.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=qv(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Pg(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?l_.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void l_.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?EPe(e):new gN({value:e,symbol:vde(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)l_.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(A(t)||A(t.arcade))&&(i=ve(F({},i),{arcade:await Cf()})),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(A(t)||A(t.arcade)))return void l_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(A(i)||A(i.arcade))){const s=await Cf(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=ve(F({},i),{arcade:s})}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new pA({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ie(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ie(this.visualVariables),legendOptions:ie(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ie(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=ie(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(ie(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),yl(e,t,this.valueExpression)];Eh(e,t,this.field),Eh(e,t,this.field2),Eh(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return TPe(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const r=new Aw({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new gN({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=vt(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(i[t]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new pA(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||Ro.getDefault());const r=i.populateFromStyle();return r.catch(s=>{l_.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new pA(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{l_.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([d({readOnly:!0})],xs.prototype,"_cache",null),u([ot({uniqueValue:"unique-value"})],xs.prototype,"type",void 0),u([d(ope)],xs.prototype,"backgroundFillSymbol",void 0),u([d({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],xs.prototype,"field",void 0),u([jt("field")],xs.prototype,"castField",null),u([He("field")],xs.prototype,"writeField",null),u([d({type:String,json:{write:!0}})],xs.prototype,"field2",void 0),u([d({type:String,json:{write:!0}})],xs.prototype,"field3",void 0),u([d({type:String,json:{write:!0}})],xs.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],xs.prototype,"valueExpressionTitle",void 0),u([d({type:fS,json:{write:!0}})],xs.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],xs.prototype,"defaultLabel",void 0),u([d(gce(F({},UM),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],xs.prototype,"defaultSymbol",null),u([d({type:String,json:{write:!0}})],xs.prototype,"fieldDelimiter",void 0),u([d({type:Ro,readOnly:!0})],xs.prototype,"portal",void 0),u([Pe("portal",["styleName"])],xs.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],xs.prototype,"styleOrigin",void 0),u([Pe("styleOrigin",["styleName","styleUrl"])],xs.prototype,"readStyleOrigin",null),u([He("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],xs.prototype,"writeStyleOrigin",null),u([d({type:[gN],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],xs.prototype,"uniqueValueInfos",null),xs=pA=u([P("esri.renderers.UniqueValueRenderer")],xs);const Qq=xs;class Cv{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return De(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function Jq(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const CPe=Jq(new Cv(0,2*Math.PI)),Av=Jq(new Cv(-Math.PI,Math.PI)),Kq=Jq(new Cv(0,360));let Tm=class extends mc(ye){constructor(...e){super(...e),this.position=new nt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=hh(e.x||0),s.y=hh(e.y||0),s.z=e.hasZ?hh(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new nt;return i.read(e,t),i.x=hh(i.x||0),i.y=hh(i.y||0),i.z=i.hasZ?hh(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:nt,json:{write:{isRequired:!0}}})],Tm.prototype,"position",void 0),u([He("position")],Tm.prototype,"writePosition",null),u([Pe("position")],Tm.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),jt(e=>Kq.normalize(hh(e)))],Tm.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),jt(e=>De(hh(e),-180,180))],Tm.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Tm.prototype,"fov",void 0),Tm=u([P("esri.Camera")],Tm);const dc=Tm;var P9;let Ky=P9=class extends ye{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new P9({rotation:this.rotation,scale:this.scale,targetGeometry:_(this.targetGeometry)?this.targetGeometry.clone():null,camera:_(this.camera)?this.camera.clone():null})}};function zk(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:zk}}}}})],Ky.prototype,"rotation",void 0),u([jt("rotation")],Ky.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:zk}}}}})],Ky.prototype,"scale",void 0),u([d({types:Tw,json:{read:Og,write:!0,origins:{"web-scene":{read:Og,write:{overridePolicy:zk}}}}})],Ky.prototype,"targetGeometry",void 0),u([d({type:dc,json:{write:!0}})],Ky.prototype,"camera",void 0),Ky=P9=u([P("esri.Viewpoint")],Ky);const Oh=Ky;function k4(e){return typeof e=="string"?document.getElementById(e):e}function ape(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function FJ(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function UJ(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}function ae(e,t,i={}){return eW(e,t,i,lpe)}function _l(e,t,i={}){return eW(e,t,i,cpe)}function eW(e,t,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Js(s),t(o,a))}:(o,a)=>{r(o)&&t(o,a)};if(s=RCe(e,n,i.sync,i.equals),i.initial){const o=e();n(o,o)}return s}function fn(e,t,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&Js(o),i(h)}const c=ae(e,(h,p)=>{var f;a(),p4(h)&&(s=h,n=OM(h,t,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=Rh(()=>{c.remove(),a()}),o}function e2(e,t){return APe(e,cpe,t)}function APe(e,t,i){if(Xs(i))return Promise.reject(di());const r=e();if(t==null?void 0:t(r))return Promise.resolve(r);let s=null;function n(){s=Js(s)}return new Promise((o,a)=>{s=NS([Yo(i,()=>{n(),a(di())}),eW(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:lpe)])})}function lpe(e){return!0}function cpe(e){return!!e}const Vi={sync:!0},Ft={initial:!0},Ps={sync:!0,initial:!0};class I9{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}var dl;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(dl||(dl={}));let RPe=0;function upe(){return RPe++}function OPe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function yN(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function hpe(e,t,i,r){if(t.type===dl.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==dl.INVOKE&&t.type!==dl.RESPONSE)return void e.postMessage(t);let s;OPe(i)?(s=kJ(i.transferList),t.data=i.result):(s=kJ(r),t.data=i),s?e.postMessage(t,s):e.postMessage(t)}function mO(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function kJ(e){if(!e||!e.length)return null;if(he("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!MPe(i));return t.length?t:null}function MPe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const PPe={statsWorker:()=>import("./statsWorker.773efd6d.js"),geometryEngineWorker:()=>import("./geometryEngineWorker.6b706bcf.js"),CSVSourceWorker:()=>import("./CSVSourceWorker.2f2812fa.js"),EdgeProcessingWorker:()=>Promise.resolve().then(function(){return wft}),ElevationSamplerWorker:()=>import("./ElevationSamplerWorker.629ef205.js"),FeatureServiceSnappingSourceWorker:()=>import("./FeatureServiceSnappingSourceWorker.1abd0165.js"),GeoJSONSourceWorker:()=>import("./GeoJSONSourceWorker.512dd3c7.js"),LercWorker:()=>import("./LercWorker.6559e565.js"),MemorySourceWorker:()=>import("./MemorySourceWorker.b6700397.js"),PBFDecoderWorker:()=>import("./PBFDecoderWorker.6f42f65d.js"),Pipeline:()=>import("./Pipeline.5179ebc7.js").then(function(e){return e.P}),PointCloudWorker:()=>import("./PointCloudWorker.372bedba.js"),RasterWorker:()=>import("./RasterWorker.ccd9be62.js"),SceneLayerSnappingSourceWorker:()=>import("./SceneLayerSnappingSourceWorker.6dcdc126.js"),SceneLayerWorker:()=>import("./SceneLayerWorker.df1ea9e5.js").then(function(e){return e.S}),WFSSourceWorker:()=>import("./WFSSourceWorker.dea35385.js"),WorkerTileHandler:()=>import("./WorkerTileHandler.8d638b81.js")},{CLOSE:zJ,ABORT:BJ,INVOKE:VJ,RESPONSE:$E,OPEN_PORT:GJ,ON:IPe}=dl,$Pe=2;class DPe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===dl.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class Ql{constructor(t,i,r){this._port=t,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new DPe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new Ql(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),Ql.clients.set(s,r),i.port2}static loadWorker(t){const i=PPe[t];return i?i():Promise.resolve(null)}close(){this._post({type:zJ}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new H("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const o=upe();return new Promise((a,l)=>{if(Xs(s))return this._processWork(),void l(di());const c=Yo(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Js(p.abortHandle),this._post({type:BJ,jobId:o}),l(di()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:VJ,jobId:o,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:dl.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:dl.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:GJ,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=$Pe)return;const t=this._getNextJob();if(!t)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=t;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{Js(t.abortHandle),t.reject(di(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){_(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=mO(t);if(i)switch(i.type){case $E:this._onResponseMessage(i);break;case VJ:this._invokeQueue.push(i);break;case BJ:this._onAbortMessage(i);break;case zJ:this._onCloseMessage();break;case GJ:this._onOpenPortMessage(i);break;case IPe:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Ql.clients.get(this)===t&&t.destroy(),Ql.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:$E,jobId:r,error:yN(p)})}Eu(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:$E,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),jr(p)||this._post({type:$E,jobId:r,error:yN(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:$E,jobId:r},l)}_onOpenPortMessage(t){new Ql(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=OM(t.port,"message",n=>{mO(n).type===dl.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);this._processWork(),n.delete(i),Js(o.abortHandle),r?o.reject(H.fromJSON(JSON.parse(r))):o.resolve(s)}_post(t,i,r){return hpe(this._port,t,i,r)}}Ql.kernelInfo={revision:jhe,version:Hhe,buildDate:Ghe},Ql.clients=new Map;const LPe=fe.getLogger("esri.core.workers.Connection");class NPe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new I9}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const o=a=>{hi(i.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];Eu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Ql(c,i,()=>this._ongoingJobsQueue.pop()),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Ql(l,i,()=>this._ongoingJobsQueue.pop()),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(di(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,i,r){let s=null;Array.isArray(r)?(LPe.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=xv();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l.jobAdded())}return n.promise}on(t,i){return Promise.all(this._clientPromises).then(()=>NS(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{i[s]=n.openPort(),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const FPe=fe.getLogger("esri.assets");function UPe(e,t){return ai(Pi(e),t)}function Pi(e){if(!Di.assetsPath)throw FPe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new H("assets:path-not-set","config.assetsPath is not set");return vl(Di.assetsPath,e)}const dpe=fe.getLogger("esri.intl");function Sm(e,t,i={}){const{format:r={}}=i;return Ef(e,s=>kPe(s,t,r))}function kPe(e,t,i){let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=W2(r,t);if(o==null)return"";const a=i[s]||i[r];return a?zPe(o,a):s?BPe(o,s):tW(o)}function zPe(e,t){switch(t.type){case"date":return Mf(e,t.intlOptions);case"number":return Pf(e,t.intlOptions);default:return dpe.warn("missing format descriptor for key {key}"),tW(e)}}function BPe(e,t){switch(t.toLowerCase()){case"dateformat":return Mf(e);case"numberformat":return Pf(e);default:return dpe.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Mf(e):/^numberformat/i.test(t)?Pf(e):tW(e)}}function tW(e){switch(typeof e){case"string":return e;case"number":return Pf(e);case"boolean":return""+e;default:return e instanceof Date?Mf(e):""}}const jJ=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,VPe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function HJ(e){var t;return(t=VPe[e])!=null?t:!1}const fA=[],mS=new Map;function qJ(e){for(const t of mS.keys())fpe(e.pattern,t)&&mS.delete(t)}function GPe(e){return fA.includes(e)||(qJ(e),fA.unshift(e)),{remove(){const t=fA.indexOf(e);t>-1&&(fA.splice(t,1),qJ(e))}}}async function ppe(e){const t=du();mS.has(e)||mS.set(e,HPe(e,t));const i=mS.get(e);return await qPe.add(i),i}function jPe(e){if(!jJ.test(e))return null;const[,t,i]=jJ.exec(e),r=t+(i?"-"+i.toUpperCase():"");return HJ(r)?r:HJ(t)?t:null}async function HPe(e,t){const i=[];for(const r of fA)if(fpe(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new H("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new H("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function fpe(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}$q(()=>{mS.clear()});const qPe=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=xv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function WPe(e,t,i,r){const s=t.exec(i);if(!s)throw new H("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=jPe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await WJ(e(c))}catch(p){if(c===l)throw new H("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await WJ(e(l))}catch(f){throw new H("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function WJ(e){if(_(XJ.fetchBundleAsset))return XJ.fetchBundleAsset(e);const t=await ai(e,{responseType:"text"});return JSON.parse(t.data)}class XPe{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return WPe(this.getAssetUrl,this.matcher,t,i)}}function YPe(e){return new XPe(e)}const XJ={};GPe(YPe({pattern:"esri/",location:Pi}));const YJ={};function ZPe(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}function QPe(e){var i;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:F({},e.has),map:F({},e.map),packages:e.packages&&e.packages.concat()||[],paths:F({},e.paths)};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=YJ.baseUrl),(i=YJ.packages)==null||i.forEach(r=>{ZPe(t.packages,r)}),t}class JPe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class fD{constructor(){this._dispatcher=new JPe,this._workerPostMessage({type:dl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){US(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){US(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=mO(t);if(i&&i.type===dl.OPEN){const{modulePath:r,jobId:s}=i;let n=await Ql.loadWorker(r);n||(n=await import(r));const o=Ql.connect(n);this._workerPostMessage({type:dl.OPENED,jobId:s,data:o})}}}const $9=fe.getLogger("esri.core.workers"),{HANDSHAKE:KPe}=dl,eIe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let rP,sP;const ZJ="Failed to create Worker. Fallback to execute module in main thread";async function tIe(){if(!he("esri-workers")||(he("mozilla"),0))return QJ(new fD);if(!rP&&!sP)try{const t=eIe.replace('"{CONFIGURATION}"',`'${iIe()}'`);rP=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){sP=t||{}}let e;if(rP)try{e=new Worker(rP,{name:"esri-worker-"+rIe++})}catch{$9.warn(ZJ,sP),e=new fD}else $9.warn(ZJ,sP),e=new fD;return QJ(e)}async function QJ(e){return new Promise(t=>{function i(s){const n=mO(s);n&&n.type===KPe&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),$9.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new fD).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function iIe(){let e;if(Di.default!=null){const s=F({},Di);delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(Di));e.assetsPath=xh(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=du(),e.has={"esri-csp-restrictions":he("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":he("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":he("esri-2d-query-centroid-enabled"),"featurelayer-pbf":he("featurelayer-pbf"),"featurelayer-simplify-thresholds":he("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":he("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":he("featurelayer-simplify-mobile-factor"),"esri-atomics":he("esri-atomics"),"esri-shared-array-buffer":he("esri-shared-array-buffer"),"esri-tiles-debug":he("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":he("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":he("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=xh(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=xh(e.workers.workerPath):e.workers.workerPath=xh(Pi("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=Di.workers.loaderConfig,i=QPe({baseUrl:t==null?void 0:t.baseUrl,locale:du(),has:F({"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1},t==null?void 0:t.has),map:F({},t==null?void 0:t.map),paths:F({},t==null?void 0:t.paths),packages:(t==null?void 0:t.packages)||[]}),r={version:Hhe,buildDate:Ghe,revision:jhe};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let rIe=0;const sIe=fe.getLogger("esri.core.workers"),{ABORT:JJ,INVOKE:nIe,OPEN:oIe,OPENED:aIe,RESPONSE:DE}=dl;class iW{constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),sIe.error(r)})}static async create(t){const i=await tIe();return new iW(i,t)}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=upe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:VH(r,()=>{this._outJobs.delete(s),this._post({type:JJ,jobId:s})})};this._outJobs.set(s,a),this._post({type:oIe,jobId:s,modulePath:t})})}_onMessage(t){const i=mO(t);if(i)switch(i.type){case aIe:this._onOpenedMessage(i);break;case DE:this._onResponseMessage(i);break;case JJ:this._onAbortMessage(i);break;case nIe:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=pMe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:DE,jobId:r,error:yN(h)})}Eu(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:DE,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),jr(h)||this._post({type:DE,jobId:r,error:yN(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:DE,jobId:r},c)}_onOpenedMessage(t){const{jobId:i,data:r}=t,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Js(s.abortHandle),s.resolve(r))}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Js(n.abortHandle),r?n.reject(H.fromJSON(JSON.parse(r))):n.resolve(s))}_post(t,i,r){return hpe(this.worker,t,i,r)}}let ib=he("esri-workers-debug")?1:he("host-browser")?navigator.hardwareConcurrency-1:0;ib||(ib=he("safari")&&he("mac")||he("trident")?7:2);let KJ=0;const mD=[];function lIe(){gpe()}async function nP(e,t){const i=new NPe;return await i.open(e,t),i}async function mpe(e,t={}){if(typeof e!="string")throw new H("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(he("host-webworker")&&!he("esri-workers")&&(i="local"),i==="local"){let r=await Ql.loadWorker(e);r||(r=await import(e)),hi(t.signal);const s=t.client||r;return nP([Ql.connect(r)],ve(F({},t),{client:s}))}if(await gpe(),hi(t.signal),i==="dedicated"){const r=KJ++%ib;return nP([await mD[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,ib);if(r<ib){const s=new Array(r);for(let n=0;n<r;++n){const o=KJ++%ib;s[n]=mD[o].open(e,t)}return nP(s,t)}}return nP(mD.map(r=>r.open(e,t)),t)}let oP=null;async function gpe(){if(oP)return oP;new AbortController;const e=[];for(let t=0;t<ib;t++){const i=iW.create(t).then(r=>(mD[t]=r,r));e.push(i)}return oP=Promise.all(e),oP}let gD=class extends Ee{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!ft.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||ft.isCollection(e)?e.forEach(r=>this._isHandle(r)&&i.push(r)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||ft.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};u([d({readOnly:!0})],gD.prototype,"size",null),gD=u([P("esri.core.Handles")],gD);const Ht=gD;let _f=class extends Ee{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new Ht,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,ae)}addWhen(e,t,i={}){return this._installWatch(e,t,i,_l)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const s=++this.handleId;return this.handles.add([fn(e,"after-changes",this._createSyncUpdatingCallback(),Vi),fn(e,"change",t,{onListenerAdd:i?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:r?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this.handles.remove(s)}}addPromise(e){if(A(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(aP)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=ae(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(aP),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(Y2(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(aP))}),aP)}}};u([d({readOnly:!0})],_f.prototype,"updating",void 0),_f=u([P("esri.core.support.WatchUpdatingTracking")],_f);const aP=-42;var eK;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(eK||(eK={}));const Ow=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new Ht}get updatingHandles(){return this._get("updatingHandles")||new _f}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([P("esri.core.HandleOwner")],t),t};let t2=class extends Ow(Ee){};t2=u([P("esri.core.HandleOwner")],t2);fe.getLogger("esri.core.support.OwningCollection");let mR=class extends Ow(ft){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{A(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ft.ofType(this.itemType.Type))(e):new ft(e)}};function D9(e,t){return{type:e,cast:Vhe,set(i){const r=Gb(i,this._get(t),e);r.owner=this,this._set(t,r)}}}u([d()],mR.prototype,"owner",null),mR=u([P("esri.core.support.OwningCollection")],mR);var mA;const vN=Ko()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),ype=vN.jsonValues.slice();c4(ype,"orthometric");const gR=Ko()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let ld=mA=class extends ye{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return vN.write(e,t,i)}readHeightModel(e,t,i){return vN.read(e)||(i&&i.messages&&i.messages.push(cIe(e,{context:i})),null)}readHeightUnit(e,t,i){return gR.read(e)||(i&&i.messages&&i.messages.push(tK(e,{context:i})),null)}readHeightUnitService(e,t,i){return qde(e)||gR.read(e)||(i&&i.messages&&i.messages.push(tK(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new mA({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=X3e(t);return new mA({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t=F({origin:"web-scene"},t),super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new mA;return t.read(e,{origin:"web-scene"}),t}};function tK(e,t){return new Ma("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function cIe(e,t){return new Ma("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:vN.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:ype,default:"ellipsoidal"}}}})],ld.prototype,"heightModel",void 0),u([He("web-scene","heightModel")],ld.prototype,"writeHeightModel",null),u([Pe(["web-scene","service"],"heightModel")],ld.prototype,"readHeightModel",null),u([d({type:gR.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:gR.jsonValues,write:gR.write}}}})],ld.prototype,"heightUnit",void 0),u([Pe("web-scene","heightUnit")],ld.prototype,"readHeightUnit",null),u([Pe("service","heightUnit")],ld.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],ld.prototype,"vertCRS",void 0),u([Pe("service","vertCRS",["vertCRS","ellipsoid","geoid"])],ld.prototype,"readVertCRS",null),ld=mA=u([P("esri.geometry.HeightModelInfo")],ld);const Mw=ld;function gs(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function jf(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v,w){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=m,e[13]=y,e[14]=v,e[15]=w,e}function $f(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bl(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function us(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,C=r*l-s*a,O=r*c-n*a,I=s*c-n*l,N=h*v-p*y,D=h*w-f*y,z=h*b-m*y,B=p*w-f*v,k=p*b-m*v,Y=f*b-m*w;let Z=S*Y-T*k+E*B+C*z-O*D+I*N;return Z?(Z=1/Z,e[0]=(a*Y-l*k+c*B)*Z,e[1]=(s*k-r*Y-n*B)*Z,e[2]=(v*I-w*O+b*C)*Z,e[3]=(f*O-p*I-m*C)*Z,e[4]=(l*z-o*Y-c*D)*Z,e[5]=(i*Y-s*z+n*D)*Z,e[6]=(w*E-y*I-b*T)*Z,e[7]=(h*I-f*E+m*T)*Z,e[8]=(o*k-a*z+c*N)*Z,e[9]=(r*z-i*k-n*N)*Z,e[10]=(y*O-v*E+b*S)*Z,e[11]=(p*E-h*O-m*S)*Z,e[12]=(a*D-o*B-l*N)*Z,e[13]=(i*B-r*D+s*N)*Z,e[14]=(v*T-y*C-w*S)*Z,e[15]=(h*C-p*T+f*S)*Z,e):null}function uIe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15];return e[0]=a*(f*b-m*w)-p*(l*b-c*w)+v*(l*m-c*f),e[1]=-(r*(f*b-m*w)-p*(s*b-n*w)+v*(s*m-n*f)),e[2]=r*(l*b-c*w)-a*(s*b-n*w)+v*(s*c-n*l),e[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*b-m*w)-h*(l*b-c*w)+y*(l*m-c*f)),e[5]=i*(f*b-m*w)-h*(s*b-n*w)+y*(s*m-n*f),e[6]=-(i*(l*b-c*w)-o*(s*b-n*w)+y*(s*c-n*l)),e[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),e[8]=o*(p*b-m*v)-h*(a*b-c*v)+y*(a*m-c*p),e[9]=-(i*(p*b-m*v)-h*(r*b-n*v)+y*(r*m-n*p)),e[10]=i*(a*b-c*v)-o*(r*b-n*v)+y*(r*c-n*a),e[11]=-(i*(a*m-c*p)-o*(r*m-n*p)+h*(r*c-n*a)),e[12]=-(o*(p*w-f*v)-h*(a*w-l*v)+y*(a*f-l*p)),e[13]=i*(p*w-f*v)-h*(r*w-s*v)+y*(r*f-s*p),e[14]=-(i*(a*w-l*v)-o*(r*w-s*v)+y*(r*l-s*a)),e[15]=i*(a*f-l*p)-o*(r*f-s*p)+h*(r*l-s*a),e}function hIe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],m=e[12],y=e[13],v=e[14],w=e[15];return(t*o-i*n)*(p*w-f*v)-(t*a-r*n)*(h*w-f*y)+(t*l-s*n)*(h*v-p*y)+(i*a-r*o)*(c*w-f*m)-(i*l-s*o)*(c*v-p*m)+(r*l-s*a)*(c*y-h*m)}function Fr(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],m=t[10],y=t[11],v=t[12],w=t[13],b=t[14],S=t[15];let T=i[0],E=i[1],C=i[2],O=i[3];return e[0]=T*r+E*a+C*p+O*v,e[1]=T*s+E*l+C*f+O*w,e[2]=T*n+E*c+C*m+O*b,e[3]=T*o+E*h+C*y+O*S,T=i[4],E=i[5],C=i[6],O=i[7],e[4]=T*r+E*a+C*p+O*v,e[5]=T*s+E*l+C*f+O*w,e[6]=T*n+E*c+C*m+O*b,e[7]=T*o+E*h+C*y+O*S,T=i[8],E=i[9],C=i[10],O=i[11],e[8]=T*r+E*a+C*p+O*v,e[9]=T*s+E*l+C*f+O*w,e[10]=T*n+E*c+C*m+O*b,e[11]=T*o+E*h+C*y+O*S,T=i[12],E=i[13],C=i[14],O=i[15],e[12]=T*r+E*a+C*p+O*v,e[13]=T*s+E*l+C*f+O*w,e[14]=T*n+E*c+C*m+O*b,e[15]=T*o+E*h+C*y+O*S,e}function Ia(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],m=t[7],y=t[8],v=t[9],w=t[10],b=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=m,e[8]=y,e[9]=v,e[10]=w,e[11]=b,e[12]=o*r+h*s+y*n+t[12],e[13]=a*r+p*s+v*n+t[13],e[14]=l*r+f*s+w*n+t[14],e[15]=c*r+m*s+b*n+t[15]}return e}function z4(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function tc(e,t,i,r){let s,n,o,a,l,c,h,p,f,m,y,v,w,b,S,T,E,C,O,I,N,D,z,B,k=r[0],Y=r[1],Z=r[2],le=Math.sqrt(k*k+Y*Y+Z*Z);return le<Et?null:(le=1/le,k*=le,Y*=le,Z*=le,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],m=t[6],y=t[7],v=t[8],w=t[9],b=t[10],S=t[11],T=k*k*o+n,E=Y*k*o+Z*s,C=Z*k*o-Y*s,O=k*Y*o-Z*s,I=Y*Y*o+n,N=Z*Y*o+k*s,D=k*Z*o+Y*s,z=Y*Z*o-k*s,B=Z*Z*o+n,e[0]=a*T+p*E+v*C,e[1]=l*T+f*E+w*C,e[2]=c*T+m*E+b*C,e[3]=h*T+y*E+S*C,e[4]=a*O+p*I+v*N,e[5]=l*O+f*I+w*N,e[6]=c*O+m*I+b*N,e[7]=h*O+y*I+S*N,e[8]=a*D+p*z+v*B,e[9]=l*D+f*z+w*B,e[10]=c*D+m*z+b*B,e[11]=h*D+y*z+S*B,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function i2(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+h*r,e[6]=a*s+p*r,e[7]=l*s+f*r,e[8]=c*s-n*r,e[9]=h*s-o*r,e[10]=p*s-a*r,e[11]=f*s-l*r,e}function B4(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-h*r,e[2]=a*s-p*r,e[3]=l*s-f*r,e[8]=n*r+c*s,e[9]=o*r+h*s,e[10]=a*r+p*s,e[11]=l*r+f*s,e}function r2(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+h*r,e[2]=a*s+p*r,e[3]=l*s+f*r,e[4]=c*s-n*r,e[5]=h*s-o*r,e[6]=p*s-a*r,e[7]=f*s-l*r,e}function V4(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function dIe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _u(e,t,i){let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Et?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function vpe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pIe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _pe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bpe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,f=r*c,m=s*l,y=s*c,v=n*c,w=o*a,b=o*l,S=o*c;return e[0]=1-(m+v),e[1]=p+S,e[2]=f-b,e[3]=0,e[4]=p-S,e[5]=1-(h+v),e[6]=y+w,e[7]=0,e[8]=f+b,e[9]=y-w,e[10]=1-(h+m),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function fIe(e,t){const i=mIe,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),bpe(e,t,i),e}const mIe=M();function gIe(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function wpe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function yIe(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function vIe(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,v=n*h,w=o*h,b=a*l,S=a*c,T=a*h,E=r[0],C=r[1],O=r[2];return e[0]=(1-(y+w))*E,e[1]=(f+T)*E,e[2]=(m-S)*E,e[3]=0,e[4]=(f-T)*C,e[5]=(1-(p+w))*C,e[6]=(v+b)*C,e[7]=0,e[8]=(m+S)*O,e[9]=(v-b)*O,e[10]=(1-(p+y))*O,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function _Ie(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,v=o*h,w=o*p,b=a*p,S=l*c,T=l*h,E=l*p,C=r[0],O=r[1],I=r[2],N=s[0],D=s[1],z=s[2],B=(1-(v+b))*C,k=(m+E)*C,Y=(y-T)*C,Z=(m-E)*O,le=(1-(f+b))*O,ne=(w+S)*O,$=(y+T)*I,U=(w-S)*I,V=(1-(f+v))*I;return e[0]=B,e[1]=k,e[2]=Y,e[3]=0,e[4]=Z,e[5]=le,e[6]=ne,e[7]=0,e[8]=$,e[9]=U,e[10]=V,e[11]=0,e[12]=i[0]+N-(B*N+Z*D+$*z),e[13]=i[1]+D-(k*N+le*D+U*z),e[14]=i[2]+z-(Y*N+ne*D+V*z),e[15]=1,e}function bIe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,v=n*o,w=n*a,b=n*l;return e[0]=1-p-y,e[1]=h+b,e[2]=f-w,e[3]=0,e[4]=h-b,e[5]=1-c-y,e[6]=m+v,e[7]=0,e[8]=f+w,e[9]=m-v,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xpe(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function wIe(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}function xIe(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function rW(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function G4(e,t,i,r){let s,n,o,a,l,c,h,p,f,m;const y=t[0],v=t[1],w=t[2],b=r[0],S=r[1],T=r[2],E=i[0],C=i[1],O=i[2];return Math.abs(y-E)<Et&&Math.abs(v-C)<Et&&Math.abs(w-O)<Et?$f(e):(h=y-E,p=v-C,f=w-O,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=S*f-T*p,n=T*h-b*f,o=b*p-S*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*y+n*v+o*w),e[13]=-(a*y+l*v+c*w),e[14]=-(h*y+p*v+f*w),e[15]=1,e)}function Tpe(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],f=o-i[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,v=c*h-a*f,w=a*p-l*h;return m=y*y+v*v+w*w,m>0&&(m=1/Math.sqrt(m),y*=m,v*=m,w*=m),e[0]=y,e[1]=v,e[2]=w,e[3]=0,e[4]=p*w-f*v,e[5]=f*y-h*w,e[6]=h*v-p*y,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function TIe(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function SIe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function EIe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function Spe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function CIe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function AIe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function RIe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Epe(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],v=e[13],w=e[14],b=e[15],S=t[0],T=t[1],E=t[2],C=t[3],O=t[4],I=t[5],N=t[6],D=t[7],z=t[8],B=t[9],k=t[10],Y=t[11],Z=t[12],le=t[13],ne=t[14],$=t[15];return Math.abs(i-S)<=Et*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-T)<=Et*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(s-E)<=Et*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-C)<=Et*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-O)<=Et*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(a-I)<=Et*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-N)<=Et*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(c-D)<=Et*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(h-z)<=Et*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(p-B)<=Et*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(f-k)<=Et*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(m-Y)<=Et*Math.max(1,Math.abs(m),Math.abs(Y))&&Math.abs(y-Z)<=Et*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(v-le)<=Et*Math.max(1,Math.abs(v),Math.abs(le))&&Math.abs(w-ne)<=Et*Math.max(1,Math.abs(w),Math.abs(ne))&&Math.abs(b-$)<=Et*Math.max(1,Math.abs(b),Math.abs($))}function sW(e){const t=Et,i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const OIe=Fr,MIe=Spe;Object.freeze(Object.defineProperty({__proto__:null,copy:gs,set:jf,identity:$f,transpose:bl,invert:us,adjoint:uIe,determinant:hIe,multiply:Fr,translate:Ia,scale:z4,rotate:tc,rotateX:i2,rotateY:B4,rotateZ:r2,fromTranslation:V4,fromScaling:dIe,fromRotation:_u,fromXRotation:vpe,fromYRotation:pIe,fromZRotation:_pe,fromRotationTranslation:bpe,fromQuat2:fIe,getTranslation:gIe,getScaling:wpe,getRotation:yIe,fromRotationTranslationScale:vIe,fromRotationTranslationScaleOrigin:_Ie,fromQuat:bIe,frustum:xpe,perspective:wIe,perspectiveFromFieldOfView:xIe,ortho:rW,lookAt:G4,targetTo:Tpe,str:TIe,frob:SIe,add:EIe,subtract:Spe,multiplyScalar:CIe,multiplyScalarAndAdd:AIe,exactEquals:RIe,equals:Epe,isOrthoNormal:sW,mul:OIe,sub:MIe},Symbol.toStringTag,{value:"Module"}));let Bk,re=null;function Cpe(){return!!re}function PIe(){return!!he("esri-wasm")}function Ape(){return Bk||(Bk=import("./pe-wasm.41ba155b.js").then(e=>e.p).then(({default:e})=>e({locateFile:t=>Pi(`esri/geometry/support/${t}`)})).then(e=>{Ope(e)}),Bk)}var L9,ss,N9;(function(e){function t(n,o,a){re.ensureCache.prepare();const l=V1(a),c=a===l,h=re.ensureFloat64(l),p=re._pe_geog_to_proj(re.getPointer(n),o,h);return p&&D0(a,o,h,c),p}function i(n,o,a,l){switch(l){case ss.PE_TRANSFORM_P_TO_G:return r(n,o,a);case ss.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){re.ensureCache.prepare();const c=V1(a),h=a===c,p=re.ensureFloat64(c),f=re._pe_proj_to_geog_center(re.getPointer(n),o,p,l);return f&&D0(a,o,p,h),f}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(L9||(L9={})),function(e){function t(){e.PE_BUFFER_MAX=re.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=re.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=re.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=re.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=re.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=re.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=re.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=re.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=re.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=re.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=re.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=re.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=re.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=re.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=re.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=re.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=re.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=re.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=re.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=re.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=re.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=re.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=re.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=re.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=re.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=re.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=re.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=re.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=re.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=re.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(ss||(ss={})),function(e){const t={},i={},r=m=>{if(m){const y=m.getType();switch(y){case ss.PE_TYPE_GEOGCS:m=re.castObject(m,re.PeGeogcs);break;case ss.PE_TYPE_PROJCS:m=re.castObject(m,re.PeProjcs);break;case ss.PE_TYPE_GEOGTRAN:m=re.castObject(m,re.PeGeogtran);break;default:y&ss.PE_TYPE_UNIT&&(m=re.castObject(m,re.PeUnit))}}return m};function s(){re.PeFactory.prototype.initialize(null)}function n(m){return o(ss.PE_TYPE_COORDSYS,m)}function o(m,y){let v=null,w=t[m];if(w||(w={},t[m]=w),w.hasOwnProperty(String(y)))v=w[y];else{const b=re.PeFactory.prototype.factoryByType(m,y);re.compare(b,re.NULL)||(v=b,w[y]=v)}return v=r(v),v}function a(m,y){let v=null,w=i[m];if(w||(w={},i[m]=w),w.hasOwnProperty(y))v=w[y];else{const b=re.PeFactory.prototype.fromString(m,y);re.compare(b,re.NULL)||(v=b,w[y]=v)}return v=r(v),v}function l(m){return o(ss.PE_TYPE_GEOGCS,m)}function c(m){return o(ss.PE_TYPE_GEOGTRAN,m)}function h(m){return re.PeFactory.prototype.getCode(m)}function p(m){return o(ss.PE_TYPE_PROJCS,m)}function f(m){return o(ss.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(N9||(N9={}));let Rpe=null;var _N,F9,U9,k9,bN,z9,wN,xN,B9;function Ope(e){function t(n,o,a){n[o]=a(n[o])}re=e,ss.init(),_N.init(),bN.init(),wN.init(),xN.init(),Rpe=class extends re.PeGCSExtent{destroy(){re.destroy(this)}};const i=[re.PeDatum,re.PeGeogcs,re.PeGeogtran,re.PeObject,re.PeParameter,re.PePrimem,re.PeProjcs,re.PeSpheroid,re.PeUnit];for(const n of i)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(ss.PE_NAME_MAX))});for(const n of[re.PeGeogtran,re.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(ss.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=re.getValue(l,"*");a[c]=h?re.wrapPointer(h,re.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(re.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return D0(a,o,n.call(this)),a}),t(re.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=re._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!re.compare(l,re.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=re.getPointer(l);for(let p=1;p<c;p++)a.push(re.wrapPointer(h+o*p,re.PeGTlistExtendedGTs))}}return a}});const r=re._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!re.compare(l,re.NULL)){a=[l];const c=l.getNump();if(c>1){const h=re.getPointer(l);for(let p=1;p<c;p++)a.push(re.wrapPointer(h+r*p,re.PeHorizon))}}return o.set(n,a),a};t(re.PeProjcs.prototype,"horizonGcsGenerate",s),t(re.PeProjcs.prototype,"horizonPcsGenerate",s),re.PeObject.prototype.toString=function(n=ss.PE_STR_OPTS_NONE){re.ensureCache.prepare();const o=re.getPointer(this),a=re.ensureInt8(new Array(ss.PE_BUFFER_MAX));return re.UTF8ToString(re._pe_object_to_string_ext(o,n,a))}}function em(e){if(!e)return;const t=re.getClass(e);if(!t)return;const i=re.getCache(t);if(!i)return;const r=re.getPointer(e);r&&delete i[r]}function lP(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(re.ensureInt8(r));return i}function V1(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function D0(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=re.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=re.getValue(i,"double"),e[n][1]=re.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=re.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=re._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new re.PeInteger(c);try{const f=re.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=re.getPointer(f);for(let y=1;y<c;y++)h.push(re.wrapPointer(m+t*y,re.PeGTlistExtendedEntry))}}finally{re.destroy(p)}return h}e.init=i,e.getGTlist=r})(_N||(_N={})),function(e){function t(i){if(i&&i.length){for(const r of i)em(r),r.getEntries().forEach(s=>{em(s);const n=s.getGeogtran();em(n),n.getParameters().forEach(em),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{em(o);const a=o.getDatum();em(a),em(a.getSpheroid()),em(o.getPrimem()),em(o.getUnit())})});re.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(F9||(F9={})),function(e){function t(i,r,s,n,o){re.ensureCache.prepare();const a=V1(s),l=s===a,c=re.ensureFloat64(a);let h=0;n&&(h=re.ensureFloat64(n));const p=re._pe_geog_to_geog(re.getPointer(i),r,c,h,o);return p&&D0(s,r,c,l),p}e.geogToGeog=t}(U9||(U9={})),function(e){const t=(c,h,p,f,m,y)=>{let v,w;switch(re.ensureCache.prepare(),c){case"dd":v=re._pe_geog_to_dd,w=ss.PE_DD_MAX;break;case"ddm":v=re._pe_geog_to_ddm,w=ss.PE_DDM_MAX;break;case"dms":v=re._pe_geog_to_dms,w=ss.PE_DMS_MAX}let b=0;h&&(b=re.getPointer(h));const S=V1(f),T=re.ensureFloat64(S),E=lP(p,w),C=v(b,p,T,m,re.ensureInt32(E));if(C)for(let O=0;O<p;O++)y[O]=re.UTF8ToString(E[O]);return C},i=(c,h,p,f,m)=>{let y;switch(re.ensureCache.prepare(),c){case"dd":y=re._pe_dd_to_geog;break;case"ddm":y=re._pe_ddm_to_geog;break;case"dms":y=re._pe_dms_to_geog}let v=0;h&&(v=re.getPointer(h));const w=f.map(E=>re.ensureString(E)),b=re.ensureInt32(w),S=re.ensureFloat64(new Array(2*p)),T=y(v,p,b,S);return T&&D0(m,p,S),T};function r(c,h,p,f,m){return t("dms",c,h,p,f,m)}function s(c,h,p,f){return i("dms",c,h,p,f)}function n(c,h,p,f,m){return t("ddm",c,h,p,f,m)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,m){return t("dd",c,h,p,f,m)}function l(c,h,p,f){return i("dd",c,h,p,f)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(k9||(k9={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=re.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=re.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=re.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){re.ensureCache.prepare();let p=0;s&&(p=re.getPointer(s));const f=V1(o),m=re.ensureFloat64(f),y=lP(n,ss.PE_MGRS_MAX),v=re.ensureInt32(y),w=re._pe_geog_to_mgrs_extended(p,n,m,a,l,c,v);if(w)for(let b=0;b<n;b++)h[b]=re.UTF8ToString(y[b]);return w}function r(s,n,o,a,l){re.ensureCache.prepare();let c=0;s&&(c=re.getPointer(s));const h=o.map(y=>re.ensureString(y)),p=re.ensureInt32(h),f=re.ensureFloat64(new Array(2*n)),m=re._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&D0(l,n,f),m}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(bN||(bN={})),function(e){function t(r,s,n,o,a,l,c){re.ensureCache.prepare();let h=0;r&&(h=re.getPointer(r));const p=V1(n),f=re.ensureFloat64(p),m=lP(s,ss.PE_MGRS_MAX),y=re.ensureInt32(m),v=re._pe_geog_to_usng(h,s,f,o,a,l,y);if(v)for(let w=0;w<s;w++)c[w]=re.UTF8ToString(m[w]);return v}function i(r,s,n,o){re.ensureCache.prepare();let a=0;r&&(a=re.getPointer(r));const l=n.map(f=>re.ensureString(f)),c=re.ensureInt32(l),h=re.ensureFloat64(new Array(2*s)),p=re._pe_usng_to_geog(a,s,c,h);return p&&D0(o,s,h),p}e.geogToUsng=t,e.usngToGeog=i}(z9||(z9={})),function(e){function t(){e.PE_UTM_OPTS_NONE=re.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=re.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=re.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){re.ensureCache.prepare();let c=0;s&&(c=re.getPointer(s));const h=V1(o),p=re.ensureFloat64(h),f=lP(n,ss.PE_UTM_MAX),m=re.ensureInt32(f),y=re._pe_geog_to_utm(c,n,p,a,m);if(y)for(let v=0;v<n;v++)l[v]=re.UTF8ToString(f[v]);return y}function r(s,n,o,a,l){re.ensureCache.prepare();let c=0;s&&(c=re.getPointer(s));const h=o.map(y=>re.ensureString(y)),p=re.ensureInt32(h),f=re.ensureFloat64(new Array(2*n)),m=re._pe_utm_to_geog(c,n,p,a,f);return m&&D0(l,n,f),m}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(wN||(wN={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=re.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=re.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=re.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=re.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o,a;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=re.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=i,e.generate=r}(xN||(xN={})),function(e){function t(){return re.PeVersion.prototype.version_string()}e.versionString=t}(B9||(B9={}));const IIe=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return re},isLoaded:Cpe,isSupported:PIe,load:Ape,get PeCSTransformations(){return L9},get PeDefs(){return ss},get PeFactory(){return N9},get PeGCSExtent(){return Rpe},get PeGTlistExtended(){return _N},get PeGTlistExtendedEntry(){return F9},get PeGTTransformations(){return U9},get PeNotationDms(){return k9},get PeNotationMgrs(){return bN},get PeNotationUsng(){return z9},get PeNotationUtm(){return wN},get PePCSInfo(){return xN},get PeVersion(){return B9},_init:Ope},Symbol.toStringTag,{value:"Module"})),j_t=Math.PI/180,H_t=/SPHEROID\[([^\]]+)]/i,ly=Ai.radius,qh=Ai.eccentricitySquared,$Ie={a1:ly*qh,a2:ly*qh*ly*qh,a3:ly*qh*qh/2,a4:ly*qh*ly*qh*2.5,a5:ly*qh+ly*qh*qh/2,a6:1-qh},q_t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Ai.radius,f:Ai.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Rg.radius,f:Rg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:vf.radius,f:vf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:vf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let cP=0;class gS{constructor(t=null){this.uid=cP++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const i=new gS;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=cP++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=cP++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=cP++}getInverse(){const t=new gS;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class X0{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof gS?this.steps.push(i):this.steps.push(new gS({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new X0;let r="";for(const s of t.steps){const n=gS.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cached_projection={},i._gtlistentry=null,i._chain=r,i}getInverse(){const t=new X0;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cached_projection[X0.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const s=this._cached_projection[X0.cacheKey(t,i)];return s===void 0?null:s}}function Mpe(e,t,i){if(A(t)||A(i)||i.vcsWkid||pc(t,i))return null;const r=JS(t)/JS(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>DIe(s,r);case"polyline":case"esriGeometryPolyline":return s=>NIe(s,r);case"polygon":case"esriGeometryPolygon":return s=>LIe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>FIe(s,r);case"extent":case"esriGeometryExtent":return s=>UIe(s,r);default:return null}}function DIe(e,t){e&&e.z!=null&&(e.z*=t)}function LIe(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function NIe(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function FIe(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function UIe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let dv=null,TN=null,Vk=null,Gk={};const Ppe=new zhe;function nW(){return!!dv&&Cpe()}function SN(e){return A(Vk)&&(Vk=Promise.all([Ape(),import("./geometryEngineBase.f43341a0.js").then(t=>t.g),import("./hydrated.8a53cc4a.js")])),Vk.then(([,t,{hydratedAdapter:i}])=>{hi(e),TN=i,dv=t.default,dv._enableProjection(IIe),Ppe.notify()})}function kM(e,t,i=null,r=null){return Array.isArray(e)?e.length===0?[]:iK(TN,e,e[0].spatialReference,t,i,r):iK(TN,[e],e.spatialReference,t,i,r)[0]}function iK(e,t,i,r,s=null,n=null){if(A(i)||A(r))return t;if(Df(i,r,s))return t.map(o=>Ipe(o,i,r));if(A(s)){const o=X0.cacheKey(i,r);Gk[o]!==void 0?s=Gk[o]:(s=kIe(i,r,null),A(s)&&(s=new X0),Gk[o]=s)}if(A(dv))throw new oW;return _(n)?dv._project(e,t,i,r,s,n):dv._project(e,t,i,r,s)}function W_t(e,t){return A(e)?{pending:null,geometry:null}:pc(e.spatialReference,t)?{pending:null,geometry:e}:gl(e.spatialReference)&&gl(t)?Df(e.spatialReference,t)||nW()?{pending:null,geometry:zIe(e,t)}:(Zt(Ppe),{pending:SN(),geometry:null}):{pending:null,geometry:null}}function kIe(e,t,i=null){if(A(dv))throw new oW;if(A(e)||A(t))return null;const r=dv._getTransformation(TN,e,t,i,i==null?void 0:i.spatialReference);return r!==null?X0.fromGE(r):null}class oW extends H{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var Q;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(Q||(Q={}));function zIe(e,t){try{const i=kM(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=Mpe(i.type,e.spatialReference,t);return _(r)&&r(i),i}catch(i){if(!(i instanceof oW))throw i;return null}}function Df(e,t,i){return!i&&(!!pc(e,t)||gl(e)&&gl(t)&&!!uW(e,t,dW))}async function X_t(e,t,i,r){if(nW())return BQ(r);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!Df(s,n,o))return SN(r)}else if(!Df(e,t,i))return SN(r);return BQ(r)}function Y_t(e,t){switch(uW(e,t,dW)){case pr:return"copy3";case Z0:return"wgs84ToSphericalECEF";case jb:return"wgs84ToWebMercator";case Y0:return"wgs84ToPlateCarree";case J0:return"wgs84ToWGS84ECEF";case Sb:return"webMercatorToWGS84";case kpe:return"webMercatorToSphericalECEF";case zpe:return"webMercatorToWGS84ECEF";case Bpe:return"webMercatorToPlateCarree";case K0:return"wgs84ECEFToWGS84";case jpe:return"wgs84ECEFToSphericalECEF";case Hpe:return"wgs84ECEFToWebMercator";case Q0:return"sphericalECEFToWGS84";case Vpe:return"sphericalECEFToWebMercator";case H9:return"sphericalMarsPCPFToMars2000";case j9:return"sphericalMoonPCPFToMoon2000";case Gpe:return"sphericalECEFToWGS84ECEF";case G9:return"mars2000ToSphericalPCPF";case V9:return"moon2000ToSphericalPCPF";default:return null}}function Ipe(e,t,i){return e?"x"in e?$pe(e,t,new nt,i,0):"xmin"in e?jIe(e,t,new ri,i,0):"rings"in e?Lpe(e,t,new Ao,i,0):"paths"in e?GIe(e,t,new au,i,0):"points"in e?VIe(e,t,new xw,i,0):null:null}function BIe(e,t,i=t.spatialReference,r=0){return!A(i)&&_($pe(e,e.spatialReference,t,i,r))}function $pe(e,t,i,r,s){zi[0]=e.x,zi[1]=e.y;const n=e.z;return zi[2]=n!==void 0?n:s,lr(zi,t,0,zi,r,0,1)?(i.x=zi[0],i.y=zi[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=zi[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function VIe(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!lr(h,t,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function GIe(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return Fpe(n,o,a,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function Dpe(e,t,i=t.spatialReference,r=0){return _(i)&&_(Lpe(e,e.spatialReference,t,i,r))}function Lpe(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return Fpe(n,o,a,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function jIe(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return rK(n,o,c?e.zmin:s,t,zi,r)?(i.xmin=zi[0],i.ymin=zi[1],c&&(i.zmin=zi[2]),rK(a,l,c?e.zmax:s,t,zi,r)?(i.xmax=zi[0],i.ymax=zi[1],c&&(i.zmax=zi[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function Rv(e,t,i){if(A(t)||A(i))return null;const r=new nt({spatialReference:i});return lr(e,t,0,zi,i,0,1)?(r.x=zi[0],r.y=zi[1],r.z=zi[2],r):null}function Npe(e,t,i){return lr(e,t,0,zi,i.spatialReference,0,1)?(i.x=zi[0],i.y=zi[1],i.z=zi[2],i):null}function Pn(e,t,i,r=0){zi[0]=e.x,zi[1]=e.y;const s=e.z;return zi[2]=s!==void 0?s:r,lr(zi,e.spatialReference,0,t,i,0,1)}function rK(e,t,i,r,s,n){return Br[0]=e,Br[1]=t,Br[2]=i,lr(Br,r,0,s,n,0,1)}function Ks(e,t,i,r){return!(A(t)||A(r)||e.length<2)&&(e.length===2&&(Br[0]=e[0],Br[1]=e[1],Br[2]=0,e=Br),lr(e,t,0,i,r,0,1))}function HIe(e,t){zi[0]=e.x,zi[1]=e.y;const i=e.z;return zi[2]=i!==void 0?i:0,qIe(zi,e.spatialReference,t)}function qIe(e,t,i){return WIe(e,t,i)}function WIe(e,t,i){if(A(t))return!1;const r=Ov(t,H4),s=gf[r][Q.WGS84_COMPARABLE_LON_LAT];return!A(s)&&(s(e,0,Br,0),i!==Br&&(i[0]=Br[0],i[1]=Br[1],i.length>2&&(i[2]=Br[2])),!0)}function lr(e,t,i,r,s,n,o=1){const a=uW(t,s,dW);if(A(a))return!1;if(a===pr){if(e===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=e[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(e,c,r,h);return!0}function Z_t(e,t,i,r,s){se(zi,e),de(uP,e,t),Ks(zi,i,zi,s),Ks(uP,i,uP,s),pe(r,uP,zi),we(r,r)}function Fpe(e,t,i,r,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!lr(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&i?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function XIe(e,t,i,r){if(A(t)||A(r))return!1;const s=qpe(t,r,i$e);if(s.projector===pr)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(A(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===Q.WEB_MERCATOR){const a=gf[n.spatialReferenceId][Q.WGS84];return!A(a)&&(a(e,0,Td,0),jb(Td,0,i,0),i[3]=sK(Td[1],e[2],e[3],Ai.radius),!0)}if(n.spatialReferenceId!==Q.WGS84&&n.spatialReferenceId!==Q.CGCS2000||o.spatialReferenceId!==Q.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*n.metersPerUnit/o.metersPerUnit;else{const a=gf[n.spatialReferenceId][Q.SPHERICAL_ECEF],l=gf[Q.SPHERICAL_ECEF][Q.PLATE_CARREE];let c=e[3];_(a)&&_(l)&&(c=sK(e[1],e[2],e[3],Ai.radius)),s.projector(e,0,i,0),i[3]=c}return!0}function sK(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(Gd*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function j4(e,t,i,r){return e!=null&&(pc(t,r)?(Mg(i,e),!0):(Br[0]=e[0],Br[1]=e[1],Br[2]=0,!!lr(Br,t,0,Br,r,0,1)&&(i[0]=Br[0],i[1]=Br[1],Br[0]=e[2],Br[1]=e[3],Br[2]=0,!!lr(Br,t,0,Br,r,0,1)&&(i[2]=Br[0],i[3]=Br[1],!0))))}function Q_t(e,t,i,r){if(A(t)||A(r))return!1;const s=Ov(t,H4),n=Ov(r,Wpe);if(s===n&&s!==Q.UNKNOWN||pc(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===Q.SPHERICAL_ECEF){const o=Oe(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/Ai.radius;if(n===Q.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===Q.WGS84||n===Q.CGCS2000){const c=yR;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===Q.PLATE_CARREE){if(n===Q.WGS84||n===Q.CGCS2000)return i[0]=yR,i[1]=yR,i[2]=1,!0;if(n===Q.WEB_MERCATOR){const o=e[1]/Ai.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function bu(e,t,i,r){if(A(e)||A(r))return!1;const s=Ov(e,H4),n=Ov(r,Wpe);if(s===n&&!nK(n)&&(s!==Q.UNKNOWN||pc(e,r)))return V4(i,t),!0;if(nK(n)){const o=gf[s][Q.LON_LAT],a=gf[Q.LON_LAT][n];return!A(o)&&!A(a)&&(o(t,0,Td,0),a(Td,0,cy,0),Upe(Gd*Td[0],Gd*Td[1],i),i[12]=cy[0],i[13]=cy[1],i[14]=cy[2],!0)}if((n===Q.WEB_MERCATOR||n===Q.PLATE_CARREE)&&(s===Q.WGS84||s===Q.CGCS2000&&n===Q.PLATE_CARREE||s===Q.SPHERICAL_ECEF||s===Q.WEB_MERCATOR)){const o=gf[s][Q.LON_LAT],a=gf[Q.LON_LAT][n];return!A(o)&&!A(a)&&(o(t,0,Td,0),a(Td,0,cy,0),s===Q.SPHERICAL_ECEF?YIe(Gd*Td[0],Gd*Td[1],i):$f(i),i[12]=cy[0],i[13]=cy[1],i[14]=cy[2],!0)}return!1}function nK(e){return e===Q.SPHERICAL_ECEF||e===Q.SPHERICAL_MARS_PCPF||e===Q.SPHERICAL_MOON_PCPF}function Upe(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function YIe(e,t,i){return Upe(e,t,i),bl(i,i),i}function Ov(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=gc(e,1)),e.wkt===Vde.wkt?t.spatialReferenceId=Q.SPHERICAL_ECEF:rO(e)?t.spatialReferenceId=Q.WGS84:Nb(e)?t.spatialReferenceId=Q.WEB_MERCATOR:sO(e)?t.spatialReferenceId=Q.PLATE_CARREE:e.wkt===L3e.wkt?t.spatialReferenceId=Q.WGS84_ECEF:e.wkid===yh.CGCS2000?t.spatialReferenceId=Q.CGCS2000:e.wkt===pN.wkt?t.spatialReferenceId=Q.SPHERICAL_MARS_PCPF:e.wkt===fN.wkt?t.spatialReferenceId=Q.SPHERICAL_MOON_PCPF:zf(e)?t.spatialReferenceId=Q.GCSMARS2000:Bf(e)?t.spatialReferenceId=Q.GCSMOON2000:t.spatialReferenceId=Q.UNKNOWN)}function pr(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function Sb(e,t,i,r){i[r++]=s2*(e[t++]/Ai.radius),i[r++]=s2*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/Ai.radius))),i[r]=e[t]}function kpe(e,t,i,r){Sb(e,t,i,r),Z0(i,r,i,r)}function zpe(e,t,i,r){Sb(e,t,i,r),J0(i,r,i,r)}function aW(e,t,i,r,s){const n=.4999999*Math.PI,o=De(Gd*e[t+1],-n,n),a=Math.sin(o);i[r++]=Gd*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function jb(e,t,i,r){aW(e,t,i,r,Ai)}const oK=Ai.radius*Math.PI/180,yR=180/(Ai.radius*Math.PI);function Y0(e,t,i,r){i[r]=e[t]*oK,i[r+1]=e[t+1]*oK,i[r+2]=e[t+2]}function rb(e,t,i,r){i[r]=e[t]*yR,i[r+1]=e[t+1]*yR,i[r+2]=e[t+2]}function Bpe(e,t,i,r){Sb(e,t,i,r),Y0(i,r,i,r)}function ZIe(e,t,i,r){K0(e,t,i,r),Y0(i,r,i,r)}function QIe(e,t,i,r){Q0(e,t,i,r),Y0(i,r,i,r)}function JIe(e,t,i,r){rb(e,t,i,r),Z0(i,r,i,r)}function KIe(e,t,i,r){rb(e,t,i,r),jb(i,r,i,r)}function e$e(e,t,i,r){rb(e,t,i,r),J0(i,r,i,r)}function Hb(e){if(A(e))return!1;const t=Ov(e,H4);return!!gf[t][Q.WGS84_COMPARABLE_LON_LAT]}function LE(e,t,i,r){const s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}function lW(e,t,i,r,s){const n=s+e[t+2],o=Gd*e[t+1],a=Gd*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function V9(e,t,i,r){lW(e,t,i,r,Rg.radius)}function G9(e,t,i,r){lW(e,t,i,r,vf.radius)}function Z0(e,t,i,r){lW(e,t,i,r,Ai.radius)}function cW(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=rp(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=s2*h,i[r++]=s2*c,i[r]=l-s}function j9(e,t,i,r){cW(e,t,i,r,Rg.radius)}function H9(e,t,i,r){cW(e,t,i,r,vf.radius)}function Q0(e,t,i,r){cW(e,t,i,r,Ai.radius)}function Vpe(e,t,i,r){Q0(e,t,i,r),jb(i,r,i,r)}function Gpe(e,t,i,r){Q0(e,t,i,r),J0(i,r,i,r)}function t$e(e,t,i,r,s){const n=Gd*e[t],o=Gd*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function J0(e,t,i,r){t$e(e,t,i,r,Ai)}function K0(e,t,i,r){const s=$Ie,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,m,y,v,w,b,S,T,E,C,O,I,N,D,z,B,k;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),B=Math.atan2(o,n),m=a*a/p,y=c/p,C=s.a2/f,O=s.a3-s.a4/f,y>.3?(v=l/f*(1+y*(s.a1+C+m*O)/f),z=Math.asin(v),b=v*v,w=Math.sqrt(1-b)):(w=h/f*(1-m*(s.a5-C-y*O)/f),z=Math.acos(w),b=1-w*w,v=Math.sqrt(b)),S=1-Ai.eccentricitySquared*b,T=Ai.radius/Math.sqrt(S),E=s.a6*T,C=h-T*w,O=l-E*v,N=w*C+v*O,I=w*O-v*C,D=I/(E/S+N),z+=D,k=N+I*D/2,a<0&&(z=-z),i[r++]=s2*B,i[r++]=s2*z,i[r]=k}function jpe(e,t,i,r){K0(e,t,i,r),Z0(i,r,i,r)}function Hpe(e,t,i,r){K0(e,t,i,r),jb(i,r,i,r)}const gf={[Q.WGS84]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:pr,[Q.WGS84_COMPARABLE_LON_LAT]:pr,[Q.SPHERICAL_ECEF]:Z0,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:jb,[Q.PLATE_CARREE]:Y0,[Q.WGS84]:pr,[Q.WGS84_ECEF]:J0},[Q.CGCS2000]:{[Q.CGCS2000]:pr,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:pr,[Q.WGS84_COMPARABLE_LON_LAT]:pr,[Q.SPHERICAL_ECEF]:Z0,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:Y0,[Q.WGS84]:null,[Q.WGS84_ECEF]:J0},[Q.GCSMARS2000]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:pr,[Q.GCSMOON2000]:null,[Q.LON_LAT]:pr,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:G9,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.GCSMOON2000]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:pr,[Q.LON_LAT]:pr,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:V9,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.WEB_MERCATOR]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:Sb,[Q.WGS84_COMPARABLE_LON_LAT]:Sb,[Q.SPHERICAL_ECEF]:kpe,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:pr,[Q.PLATE_CARREE]:Bpe,[Q.WGS84]:Sb,[Q.WGS84_ECEF]:zpe},[Q.WGS84_ECEF]:{[Q.CGCS2000]:K0,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:K0,[Q.WGS84_COMPARABLE_LON_LAT]:K0,[Q.SPHERICAL_ECEF]:jpe,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:Hpe,[Q.PLATE_CARREE]:ZIe,[Q.WGS84]:K0,[Q.WGS84_ECEF]:pr},[Q.SPHERICAL_ECEF]:{[Q.CGCS2000]:Q0,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:Q0,[Q.WGS84_COMPARABLE_LON_LAT]:Q0,[Q.SPHERICAL_ECEF]:pr,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:Vpe,[Q.PLATE_CARREE]:QIe,[Q.WGS84]:Q0,[Q.WGS84_ECEF]:Gpe},[Q.SPHERICAL_MARS_PCPF]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:H9,[Q.GCSMOON2000]:null,[Q.LON_LAT]:H9,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:pr,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.SPHERICAL_MOON_PCPF]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:j9,[Q.LON_LAT]:j9,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:pr,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.UNKNOWN]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:null,[Q.WGS84_COMPARABLE_LON_LAT]:null,[Q.SPHERICAL_ECEF]:null,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:pr,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:null,[Q.WGS84]:null,[Q.WGS84_ECEF]:null},[Q.LON_LAT]:{[Q.CGCS2000]:pr,[Q.GCSMARS2000]:pr,[Q.GCSMOON2000]:pr,[Q.LON_LAT]:pr,[Q.WGS84_COMPARABLE_LON_LAT]:pr,[Q.SPHERICAL_ECEF]:Z0,[Q.SPHERICAL_MARS_PCPF]:G9,[Q.SPHERICAL_MOON_PCPF]:V9,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:jb,[Q.PLATE_CARREE]:Y0,[Q.WGS84]:pr,[Q.WGS84_ECEF]:J0},[Q.WGS84_COMPARABLE_LON_LAT]:{[Q.CGCS2000]:null,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:pr,[Q.WGS84_COMPARABLE_LON_LAT]:pr,[Q.SPHERICAL_ECEF]:Z0,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:null,[Q.PLATE_CARREE]:Y0,[Q.WGS84]:pr,[Q.WGS84_ECEF]:J0},[Q.PLATE_CARREE]:{[Q.CGCS2000]:rb,[Q.GCSMARS2000]:null,[Q.GCSMOON2000]:null,[Q.LON_LAT]:rb,[Q.WGS84_COMPARABLE_LON_LAT]:rb,[Q.SPHERICAL_ECEF]:JIe,[Q.SPHERICAL_MARS_PCPF]:null,[Q.SPHERICAL_MOON_PCPF]:null,[Q.UNKNOWN]:null,[Q.WEB_MERCATOR]:KIe,[Q.PLATE_CARREE]:pr,[Q.WGS84]:rb,[Q.WGS84_ECEF]:e$e}};function uW(e,t,i=hW()){return A(e)||A(t)?null:qpe(e,t,i).projector}function qpe(e,t,i){if(A(e)||A(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=Ov(e,i.source),s=Ov(t,i.dest);return r===Q.UNKNOWN&&s===Q.UNKNOWN?pc(e,t)?i.projector=pr:i.projector=null:i.projector=gf[r][s],i}function hW(){return{source:{spatialReference:null,spatialReferenceId:Q.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:Q.UNKNOWN,metersPerUnit:1},projector:pr}}const H4={spatialReference:null,spatialReferenceId:Q.UNKNOWN},Wpe={spatialReference:null,spatialReferenceId:Q.UNKNOWN},dW=hW(),i$e=hW(),Gd=$t(1),s2=hc(1),Br=M(),Td=M(),cy=M(),zi=M(),uP=M();class Hg{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&US(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*aK);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,aK));t++)this._items.push(this.allocator())}}const aK=1024;function Ae(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Eb(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function pW(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v){return[e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v]}function Xpe(e,t){return new Float64Array(e,t,16)}const en=Ae();Object.freeze(Object.defineProperty({__proto__:null,create:Ae,clone:Eb,fromValues:pW,createView:Xpe,IDENTITY:en},Symbol.toStringTag,{value:"Module"}));var pu;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(pu||(pu={}));function r$e(e){return 32+e.length}function s$e(){return 16}function Ype(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=r$e(r);break;case"number":t+=s$e();break;case"boolean":t+=4}}return t}function J_t(e,t){return 32+e.length*t}var n2;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(n2||(n2={}));function Sr(){return[1,0,0,0,1,0,0,0,1]}function n$e(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function o$e(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]}function Zpe(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Sr,clone:n$e,fromValues:o$e,createView:Zpe},Symbol.toStringTag,{value:"Module"}));function qg(){return[0,0,0,1]}function a$e(e){return[e[0],e[1],e[2],e[3]]}function l$e(e,t,i,r){return[e,t,i,r]}function Qpe(e,t){return new Float64Array(e,t,4)}const c$e=qg();Object.freeze(Object.defineProperty({__proto__:null,create:qg,clone:a$e,fromValues:l$e,createView:Qpe,IDENTITY:c$e},Symbol.toStringTag,{value:"Module"}));function tt(){return[0,0]}function gA(e){return[e[0],e[1]]}function Ii(e,t){return[e,t]}function Jpe(e){const t=tt(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Kpe(e,t){return new Float64Array(e,t,2)}function efe(){return tt()}function tfe(){return Ii(1,1)}function ife(){return Ii(1,0)}function rfe(){return Ii(0,1)}const Mh=efe(),sfe=tfe(),u$e=ife(),h$e=rfe();Object.freeze(Object.defineProperty({__proto__:null,create:tt,clone:gA,fromValues:Ii,fromArray:Jpe,createView:Kpe,zeros:efe,ones:tfe,unitX:ife,unitY:rfe,ZEROS:Mh,ONES:sfe,UNIT_X:u$e,UNIT_Y:h$e},Symbol.toStringTag,{value:"Module"}));function Gt(){return[0,0,0,0]}function q4(e){return[e[0],e[1],e[2],e[3]]}function gi(e,t,i,r){return[e,t,i,r]}function fW(e){const t=Gt(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function nfe(e,t){return new Float64Array(e,t,4)}function ofe(){return Gt()}function afe(){return gi(1,1,1,1)}function lfe(){return gi(1,0,0,0)}function cfe(){return gi(0,1,0,0)}function ufe(){return gi(0,0,1,0)}function hfe(){return gi(0,0,0,1)}const bf=ofe(),vh=afe(),d$e=lfe(),p$e=cfe(),f$e=ufe(),m$e=hfe();Object.freeze(Object.defineProperty({__proto__:null,create:Gt,clone:q4,fromValues:gi,fromArray:fW,createView:nfe,zeros:ofe,ones:afe,unitX:lfe,unitY:cfe,unitZ:ufe,unitW:hfe,ZEROS:bf,ONES:vh,UNIT_X:d$e,UNIT_Y:p$e,UNIT_Z:f$e,UNIT_W:m$e},Symbol.toStringTag,{value:"Module"}));class eu{constructor(t,i,r){this.itemByteSize=t,this.itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){this._itemsPtr===0&&US(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(i,r*this.itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=Bw){return new eu(16,Kpe,t)}static createVec3f64(t=Bw){return new eu(24,oq,t)}static createVec4f64(t=Bw){return new eu(32,nfe,t)}static createMat3f64(t=Bw){return new eu(72,Zpe,t)}static createMat4f64(t=Bw){return new eu(128,Xpe,t)}static createQuatf64(t=Bw){return new eu(32,Qpe,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const Bw=4*n2.KILOBYTES,K_t=eu.createVec2f64(),je=eu.createVec3f64(),mW=eu.createVec4f64();eu.createMat3f64();const gW=eu.createMat4f64(),e1t=eu.createQuatf64();function Hf(e){return e?{origin:$s(e.origin),vector:$s(e.vector)}:{origin:M(),vector:M()}}function g$e(e,t){const i=v$e.get();return i.origin=e,i.vector=t,i}function t1t(e,t=Hf()){return y$e(e.origin,e.vector,t)}function y$e(e,t,i=Hf()){return se(i.origin,e),se(i.vector,t),i}function Cb(e,t,i=Hf()){return se(i.origin,e),pe(i.vector,t,e),i}function yW(e,t){const i=pe(je.get(),t,e.origin),r=xe(e.vector,i),s=xe(e.vector,e.vector),n=De(r/s,0,1),o=pe(je.get(),oe(je.get(),e.vector,n),i);return xe(o,o)}function i1t(e,t,i){return q9(e,t,0,1,i)}function r1t(e,t,i){return de(i,e.origin,oe(i,e.vector,t))}function q9(e,t,i,r,s){const{vector:n,origin:o}=e,a=pe(je.get(),t,o),l=xe(n,a)/Sa(n);return oe(s,n,De(l,i,r)),de(s,s,e.origin)}function s1t(e,t){if(pfe(e,g$e(t.origin,t.direction),!1,EN)){const{tA:i,pB:r,distance2:s}=EN;if(i>=0&&i<=1)return s;if(i<0)return pn(e.origin,r);if(i>1)return pn(de(je.get(),e.origin,e.vector),r)}return null}function dfe(e,t,i){return!!pfe(e,t,!0,EN)&&(se(i,EN.pA),!0)}function pfe(e,t,i,r){const n=e.origin,o=de(je.get(),n,e.vector),a=t.origin,l=de(je.get(),a,t.vector),c=je.get(),h=je.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=je.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],w=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*v-m*m;if(Math.abs(w)<1e-6)return!1;let b=(f*m-y*v)/w,S=(f+m*b)/v;i&&(b=De(b,0,1),S=De(S,0,1));const T=je.get(),E=je.get();return T[0]=n[0]+b*p[0],T[1]=n[1]+b*p[1],T[2]=n[2]+b*p[2],E[0]=a[0]+S*h[0],E[1]=a[1]+S*h[1],E[2]=a[2]+S*h[2],r.tA=b,r.tB=S,r.pA=T,r.pB=E,r.distance2=pn(T,E),!0}const EN={tA:0,tB:0,pA:M(),pB:M(),distance2:0},v$e=new Hg(()=>({origin:null,vector:null}));function Qn(e){return e?{origin:$s(e.origin),direction:$s(e.direction)}:{origin:M(),direction:M()}}function n1t(e,t){return wv(e.origin,t.origin)&&wv(e.direction,t.direction)}function wu(e,t){const i=T$e.get();return i.origin=e,i.direction=t,i}function CN(e,t=Qn()){return ffe(e.origin,e.direction,t)}function _$e(e,t,i=Qn()){return se(i.origin,e),pe(i.direction,t,e),i}function ffe(e,t,i=Qn()){return se(i.origin,e),se(i.direction,t),i}function b$e(e,t){const i=lt(je.get(),we(je.get(),e.direction),pe(je.get(),t,e.origin));return xe(i,i)}function w$e(e,t,i){const r=xe(e.direction,pe(i,t,e.origin));return de(i,e.origin,oe(i,e.direction,r)),i}function x$e(){return{origin:null,direction:null}}const T$e=new Hg(x$e);function vR(e,t){return xe(e,t)/Oe(e)}function vW(e,t){const i=xe(e,t)/(Oe(e)*Oe(t));return-rn(i)}function S$e(e,t,i){we(hP,e),we(jk,t);const r=xe(hP,jk),s=rn(r),n=lt(hP,hP,jk);return xe(n,i)<0?2*Math.PI-s:s}const hP=M(),jk=M(),E$e=fe.getLogger("esri.geometry.support.sphere");function mn(){return Gt()}function o2(e,t=mn()){return kd(t,e)}function mfe(e,t){return gi(e[0],e[1],e[2],t)}function C$e(e){return e}function gfe(e){e[0]=e[1]=e[2]=e[3]=0}function W4(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function mg(e){return e[3]}function A$e(e){return e}function yfe(e,t,i,r){return gi(e,t,i,r)}function R$e(e,t,i){return e!==i&&se(i,e),i[3]=e[3]+t,i}function O$e(e,t,i){return E$e.error("sphere.setExtent is not yet supported"),e===i?i:o2(e,i)}function Yv(e,t,i){if(A(t))return!1;const{origin:r,direction:s}=t,n=M$e;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const M$e=M();function W9(e,t){return Yv(e,t,null)}function P$e(e,t,i){if(Yv(e,t,i))return i;const r=sE(e,t,je.get());return de(i,t.origin,oe(je.get(),t.direction,or(t.origin,r)/Oe(t.direction))),i}function sE(e,t,i){const r=je.get(),s=gW.get();lt(r,t.origin,t.direction);const n=mg(e);lt(i,r,t.origin),oe(i,i,1/Oe(i)*n);const o=bfe(e,t.origin),a=vW(t.origin,i);return _u(s,a+o,r),ke(i,i,s),i}function I$e(e,t,i){return Yv(e,t,i)?i:(w$e(t,e,i),vfe(e,i,i))}function vfe(e,t,i){const r=pe(je.get(),t,e),s=oe(je.get(),r,e[3]/Oe(r));return de(i,s,e)}function _fe(e,t){const i=pe(je.get(),t,e),r=Sa(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function bfe(e,t){const i=pe(je.get(),t,e),r=Oe(i),s=mg(e),n=s+Math.abs(s-r);return rn(s/n)}const Hk=M();function wfe(e,t,i,r){const s=pe(Hk,t,e);switch(i){case pu.X:{const n=tJ(s,Hk)[2];return te(r,-Math.sin(n),Math.cos(n),0)}case pu.Y:{const n=tJ(s,Hk),o=n[1],a=n[2],l=Math.sin(o);return te(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case pu.Z:return we(r,s);default:return}}function xfe(e,t){const i=pe(X9,t,e);return Oe(i)-e[3]}function $$e(e,t,i,r){const s=xfe(e,t),n=wfe(e,t,pu.Z,X9),o=oe(X9,n,i-s);return de(r,t,o)}function D$e(e,t){const i=pn(e,t),r=mg(e);return i<=r*r}const X9=M(),X4=mn(),L$e=Object.freeze(Object.defineProperty({__proto__:null,create:mn,copy:o2,fromCenterAndRadius:mfe,wrap:C$e,clear:gfe,fromRadius:W4,getRadius:mg,getCenter:A$e,fromValues:yfe,elevate:R$e,setExtent:O$e,intersectRay:Yv,intersectsRay:W9,intersectRayClosestSilhouette:P$e,closestPointOnSilhouette:sE,closestPoint:I$e,projectPoint:vfe,distanceToSilhouette:_fe,angleToSilhouette:bfe,axisAt:wfe,altitudeAt:xfe,setAltitudeAt:$$e,containsPoint:D$e,tmpSphere:X4},Symbol.toStringTag,{value:"Module"}));function qb(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function N$e(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return te(e,i,r,s),e}function o1t(e,t,i){i=i||e;const r=xe(e,t);te(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),we(i,i)}function a1t(e,t,i){Math.abs(e[0])>Math.abs(e[1])?te(t,0,1,0):te(t,1,0,0),lt(i,e,t),we(t,t),lt(t,i,e),we(i,i)}function dP(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function F$e(e,t,i,r=M()){const s=Oe(e),n=Oe(t),o=xe(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return oe(sb,e,c),oe(nb,t,h),de(r,sb,nb)}return tn(r,e,t,i)}function l1t(e,t,i,r=M(),s=M()){const n=Oe(e),o=Oe(t),a=xe(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,y=m/o*h;oe(sb,e,m/n*p),oe(nb,t,y),de(r,sb,nb)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+p*(-n+o));oe(sb,e,m);const y=1/o*(Math.cos(i*l)*l*f+h*(-n+o));oe(nb,t,y),de(s,sb,nb),oe(s,s,1/c)}return s}return tn(r,e,t,i),pe(s,t,e),we(s,s),s}function yD(e,t,i){e=we(sb,e),t=we(nb,t);const r=rn(xe(e,t));if(i){const s=lt(U$e,e,t);if(xe(s,i)<0)return-r}return r}function vD(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function c1t(e,t,i,r){pe(lK,t,e),pe(cK,i,e),lt(r,lK,cK),we(r,r),r[3]=-xe(e,r)}const lK=M(),cK=M(),U$e=M(),sb=M(),nb=M();function _i(e=yA){return[e[0],e[1],e[2],e[3]]}function k$e(e=yA[0],t=yA[1],i=yA[2],r=yA[3]){return _W(e,t,i,r,mW.get())}function Y4(e,t){return _W(t[0],t[1],t[2],t[3],e)}function _W(e,t,i,r,s=_i()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Tfe(e,t,i){return se(i,e),i[3]=t,i}function a2(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function Go(e,t,i,r=_i()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*y,r[1]=p*y,r[2]=f*y,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function Sfe(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,NE);let n=r,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,Vw),n++,o=!ll(NE,Vw);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,G1),n++,pe(pP,NE,Vw),we(pP,pP),pe(fP,Vw,G1),we(fP,fP),o=!ll(NE,G1)&&!ll(Vw,G1)&&Math.abs(xe(pP,fP))<z$e;return o?(Go(NE,Vw,G1,t),!0):(i!==0||r!==1||s!==2)&&Sfe(e,t,0,1,2)}const z$e=.99619469809,NE=M(),Vw=M(),G1=M(),pP=M(),fP=M();function Y9(e,t,i){return t!==e&&Y4(e,t),e[3]=-xe(e,i),e}function Z9(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function gO(e,t,i,r){return lt(G1,t,e),a2(i,G1,r)}function u1t(e,t,i,r){return Z4(e,t,pe(je.get(),i,t),W$e,r)}function Pw(e,t,i){return!!_(t)&&Z4(e,t.origin,t.direction,X$e,i)}function B$e(e,t,i){return Z4(e,t.origin,t.vector,wf.NONE,i)}function V$e(e,t,i){return Z4(e,t.origin,t.vector,wf.CLAMP,i)}function Efe(e,t){return sr(e,t)>=0}function G$e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function j$e(e,t){const i=xe(e,t.ray.direction),r=-sr(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function H$e(e,t){const i=xe(e,t.ray.direction),r=-sr(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function q$e(e,t,i){const r=oe(je.get(),e,-e[3]),s=Q9(e,pe(je.get(),t,r),je.get());return de(i,s,r),i}function Q9(e,t,i){const r=oe(je.get(),e,xe(e,t));return pe(i,t,r),i}function sr(e,t){return xe(e,t)+e[3]}function Z4(e,t,i,r,s){const n=xe(e,i);if(n===0)return!1;let o=-(xe(e,t)+e[3])/n;return r&wf.CLAMP&&(o=De(o,0,1)),!(!(r&wf.INFINITE_MIN)&&o<0||!(r&wf.INFINITE_MAX)&&o>1)&&(de(s,t,oe(s,i,o)),!0)}function h1t(e){return e}const yA=[0,0,1,0];var wf;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(wf||(wf={}));const W$e=wf.INFINITE_MIN|wf.INFINITE_MAX,X$e=wf.INFINITE_MAX,qk=fe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class Cfe{constructor(){this.plane=_i(),this.origin=M(),this.basis1=M(),this.basis2=M()}}function Zv(e=Ffe){return{plane:_i(e.plane),origin:$s(e.origin),basis1:$s(e.basis1),basis2:$s(e.basis2)}}function Y$e(e,t,i){const r=aDe.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=k$e(0,0,0,0),Q4(r),r}function Iw(e,t=Zv()){return bW(e.origin,e.basis1,e.basis2,t)}function Z$e(e,t){se(t.origin,e.origin),se(t.basis1,e.basis1),se(t.basis2,e.basis2),Y4(t.plane,e.plane)}function bW(e,t,i,r=Zv()){return se(r.origin,e),se(r.basis1,t),se(r.basis2,i),Q4(r),nDe(r,"fromValues()"),r}function Q4(e){gO(e.basis2,e.basis1,e.origin,e.plane)}function Afe(e,t,i){e!==i&&Iw(e,i);const r=oe(je.get(),$g(e),t);return de(i.origin,i.origin,r),i.plane[3]-=t,i}function Q$e(e,t,i){return Rfe(t,i),Afe(i,SW(e,e.origin),i),i}function Rfe(e,t=Zv()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return te(t.origin,e[0]+i,e[1]+r,0),te(t.basis1,i,0,0),te(t.basis2,0,r,0),_W(0,0,1,0,t.plane),t}function wW(e,t,i){return!!Pw(e.plane,t,i)&&Lfe(e,i)}function J$e(e,t,i){if(wW(e,t,i))return i;const r=Ofe(e,t,je.get());return de(i,t.origin,oe(je.get(),t.direction,or(t.origin,r)/Oe(t.direction))),i}function Ofe(e,t,i){const r=AN.get();Nfe(e,t,r,AN.get());let s=Number.POSITIVE_INFINITY;for(const n of CW){const o=EW(e,n,J4.get()),a=je.get();if(B$e(r,o,a)){const l=Vg(je.get(),t.origin,a),c=Math.abs(rn(xe(t.direction,l)));c<s&&(s=c,se(i,a))}}return s===Number.POSITIVE_INFINITY?Mfe(e,t,i):i}function Mfe(e,t,i){if(wW(e,t,i))return i;const r=AN.get(),s=AN.get();Nfe(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of CW){const a=EW(e,o,J4.get()),l=je.get();if(V$e(r,a,l)){const c=b$e(t,l);if(!Efe(s,l))continue;c<n&&(n=c,se(i,l))}}return xW(e,t.origin)<n&&Pfe(e,t.origin,i),i}function Pfe(e,t,i){const r=q$e(e.plane,t,je.get()),s=q9(uK(e,e.basis1),r,-1,1,je.get()),n=q9(uK(e,e.basis2),r,-1,1,je.get());return pe(i,de(je.get(),s,n),e.origin),i}function Ife(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=pe(je.get(),t,r),a=vR(s,o),l=vR(n,o),c=vR($g(e),o);return te(i,a,l,c)}function xW(e,t){const i=Ife(e,t,je.get()),{basis1:r,basis2:s}=e,n=Oe(r),o=Oe(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function K$e(e,t){return Math.sqrt(xW(e,t))}function eDe(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of CW){const s=EW(e,r,J4.get()),n=yW(s,t);n>i&&(i=n)}return Math.sqrt(i)}function TW(e,t){return Efe(e.plane,t)&&Lfe(e,t)}function tDe(e,t,i,r){return sDe(e,i,r)}function SW(e,t){const i=-e.plane[3];return vR($g(e),t)-i}function iDe(e,t,i,r){const s=SW(e,t),n=oe(oDe,$g(e),i-s);return de(r,t,n),r}function $fe(e,t){return ll(e.basis1,t.basis1)&&ll(e.basis2,t.basis2)&&ll(e.origin,t.origin)}function Dfe(e,t,i){return e!==i&&Iw(e,i),us(Gw,t),bl(Gw,Gw),ke(i.basis1,e.basis1,Gw),ke(i.basis2,e.basis2,Gw),ke(i.plane,e.plane,Gw),ke(i.origin,e.origin,t),Y9(i.plane,i.plane,i.origin),i}function rDe(e,t,i,r){return e!==r&&Iw(e,r),_u(Wk,t,i),ke(r.basis1,e.basis1,Wk),ke(r.basis2,e.basis2,Wk),Q4(r),r}function $g(e){return e.plane}function sDe(e,t,i){switch(t){case pu.X:se(i,e.basis1),we(i,i);break;case pu.Y:se(i,e.basis2),we(i,i);break;case pu.Z:se(i,$g(e))}return i}function Lfe(e,t){const i=pe(je.get(),t,e.origin),r=Sa(e.basis1),s=Sa(e.basis2),n=xe(e.basis1,i),o=xe(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function uK(e,t){const i=J4.get();return se(i.origin,e.origin),se(i.vector,t),i}function EW(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=oe(je.get(),r,t.origin[0]),a=oe(je.get(),s,t.origin[1]);de(i.origin,o,a),de(i.origin,i.origin,n);const l=oe(je.get(),r,t.direction[0]),c=oe(je.get(),s,t.direction[1]);return oe(i.vector,de(l,l,c),2),i}function nDe(e,t){Math.abs(xe(e.basis1,e.basis2)/(Oe(e.basis1)*Oe(e.basis2)))>1e-6&&qk.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(xe(e.basis1,$g(e)))>1e-6&&qk.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-xe($g(e),e.origin)-e.plane[3])>1e-6&&qk.warn(t,"Plane offset is not consistent with plane origin")}function Nfe(e,t,i,r){const s=$g(e);gO(s,t.direction,t.origin,i),gO(i,s,t.origin,r)}const Ffe={plane:_i(),origin:Ue(0,0,0),basis1:Ue(1,0,0),basis2:Ue(0,1,0)},AN=new Hg(_i),J4=new Hg(Hf),oDe=M(),aDe=new Hg(()=>({origin:null,basis1:null,basis2:null,plane:null})),CW=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Gw=Ae(),Wk=Ae(),lDe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Cfe,create:Zv,wrap:Y$e,copy:Iw,copyWithoutVerify:Z$e,fromValues:bW,updateUnboundedPlane:Q4,elevate:Afe,setExtent:Q$e,fromAABoundingRect:Rfe,intersectRay:wW,intersectRayClosestSilhouette:J$e,closestPointOnSilhouette:Ofe,closestPoint:Mfe,projectPoint:Pfe,projectPointLocal:Ife,distance2:xW,distance:K$e,distanceToSilhouette:eDe,extrusionContainsPoint:TW,axisAt:tDe,altitudeAt:SW,setAltitudeAt:iDe,equals:$fe,transform:Dfe,rotate:rDe,normal:$g,UP:Ffe},Symbol.toStringTag,{value:"Module"}));function cDe(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function uDe(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function hDe(e){return{operations:e,value:e.create()}}function Ufe(e,t,i=hDe(e)){return i.operations=e,e.copy(t,i.value),i}function dDe(e){return Ufe(L$e,yfe(0,0,0,wi(e).radius))}const hK=2**50;function pDe(){return Ufe(lDe,bW([0,0,0],[hK,0,0],[0,hK,0]))}function fDe(e,t,i){return e.operations.axisAt(e.value,t,pu.Z,i)}function mDe(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function gDe(e,t,i){return e.operations.intersectRay(e.value,t,i)}function yDe(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function vDe(e,t){return e.operations.altitudeAt(e.value,t)}function kfe(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function _De(e,t,i,r){return t!==r&&gs(r,t),te(jw,r[12],r[13],r[14]),kfe(e,jw,i,jw),r[12]=jw[0],r[13]=jw[1],r[14]=jw[2],r}function Xk(e,t,i){return e.operations.elevate(e.value,t,i.value)}const jw=M();function dK(e,t,i,r,s){return s[0]=xe(e,t),s[1]=xe(e,i),s[2]=xe(e,r),s}function J9(e,t,i,r,s){se(i,e),se(mP,t),we(mP,mP),lt(r,mP,i),lt(s,r,i)}function zfe(e,t){return e?If(t):t.isGeographic?Ke.PlateCarree:t}const mP=M(),Bfe=96;function d1t(e,t){const i=t||e.extent,r=e.width,s=gc(i&&i.spatialReference);return i&&r?i.width/r*s*Gde*Bfe:0}function Vfe(e,t){return e/(gc(t)*Gde*Bfe)}function _R(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function pK(e){return(e==null?void 0:e.type)==="voxel"}function fK(e){return(e==null?void 0:e.type)==="imagery-tile"}function Gfe(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function AW(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function p1t(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function K9(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function bDe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}const wDe=fe.getLogger("esri.support.AnalysesCollection");let l2=class extends mR{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{A(t.item)||t.item.parent===this.owner&&(wDe.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};l2=u([P("esri.support.AnalysesCollection")],l2);const _D={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},Yk={xsmall:544,small:768,medium:992,large:1200};function xDe(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function Zk(e,t){return t?_D[e].valueToClassName[t].split(" "):[]}const TDe=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new Ht,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=Yk}initialize(){this._breakpointsHandles.add(ae(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Ft))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=at(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=xDe(i);if(!r){const s=JSON.stringify(Yk,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:Yk,this._set("breakpoints",F({},i))}_updateClassNames(){if(!this.container)return;const i=Yl.acquire(),r=Yl.acquire();let s,n=!1;for(s in _D){const o=this[s],a=_D[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,Zk(s,o).forEach(l=>r.push(l)),Zk(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),Yl.release(i),Yl.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in _D)Zk(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([P("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var SDe="[object Object]";function EDe(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function CDe(e,t){return function(i){return e(t(i))}}var ADe=Function.prototype,jfe=Object.prototype,Hfe=ADe.toString,RDe=jfe.hasOwnProperty,ODe=Hfe.call(Object),MDe=jfe.toString,PDe=CDe(Object.getPrototypeOf,Object);function IDe(e){return!!e&&typeof e=="object"}function $De(e){if(!IDe(e)||MDe.call(e)!=SDe||EDe(e))return!1;var t=PDe(e);if(t===null)return!0;var i=RDe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&Hfe.call(i)==ODe}var DDe=$De,j1={exports:{}},Fs={},yO={exports:{}},$w={};function qfe(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function LDe(e,t,i){}function NDe(e,t,i){}var FDe=/javascript\s*\:/img;function UDe(e,t){return FDe.test(t)?"":t}$w.whiteList=qfe();$w.getDefaultWhiteList=qfe;$w.onAttr=LDe;$w.onIgnoreAttr=NDe;$w.safeAttrValue=UDe;var kDe={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},FE=kDe;function zDe(e,t){e=FE.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=FE.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=FE.trim(h.slice(0,p)),m=FE.trim(h.slice(p+1));if(f){var y=t(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return FE.trim(o)}var BDe=zDe,gP=$w,VDe=BDe;function mK(e){return e==null}function GDe(e){var t={};for(var i in e)t[i]=e[i];return t}function Wfe(e){e=GDe(e||{}),e.whiteList=e.whiteList||gP.whiteList,e.onAttr=e.onAttr||gP.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||gP.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||gP.safeAttrValue,this.options=e}Wfe.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=VDe(e,function(l,c,h,p,f){var m=r[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var v={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var w=s(h,p,v);return mK(w)?h+":"+p:w}else{var w=n(h,p,v);if(!mK(w))return w}}});return a};var jDe=Wfe;(function(e,t){var i=$w,r=jDe;function s(o,a){var l=new r(a);return l.process(o)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})(yO,yO.exports);var RW={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},HDe=yO.exports.FilterCSS,qDe=yO.exports.getDefaultWhiteList,RN=RW;function Xfe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Yfe=new HDe;function WDe(e,t,i){}function XDe(e,t,i){}function YDe(e,t,i){}function ZDe(e,t,i){}function Zfe(e){return e.replace(JDe,"&lt;").replace(KDe,"&gt;")}function QDe(e,t,i,r){if(i=ime(i),t==="href"||t==="src"){if(i=RN.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(yP.lastIndex=0,yP.test(i))return""}else if(t==="style"){if(gK.lastIndex=0,gK.test(i)||(yK.lastIndex=0,yK.test(i)&&(yP.lastIndex=0,yP.test(i))))return"";r!==!1&&(r=r||Yfe,i=r.process(i))}return i=rme(i),i}var JDe=/</g,KDe=/>/g,eLe=/"/g,tLe=/&quot;/g,iLe=/&#([a-zA-Z0-9]*);?/gim,rLe=/&colon;?/gim,sLe=/&newline;?/gim,yP=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,gK=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,yK=/u\s*r\s*l\s*\(.*/gi;function Qfe(e){return e.replace(eLe,"&quot;")}function Jfe(e){return e.replace(tLe,'"')}function Kfe(e){return e.replace(iLe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function eme(e){return e.replace(rLe,":").replace(sLe," ")}function tme(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return RN.trim(t)}function ime(e){return e=Jfe(e),e=Kfe(e),e=eme(e),e=tme(e),e}function rme(e){return e=Qfe(e),e=Zfe(e),e}function nLe(){return""}function oLe(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(o){return i?!0:RN.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return RN.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function aLe(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function lLe(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}Fs.whiteList=Xfe();Fs.getDefaultWhiteList=Xfe;Fs.onTag=WDe;Fs.onIgnoreTag=XDe;Fs.onTagAttr=YDe;Fs.onIgnoreTagAttr=ZDe;Fs.safeAttrValue=QDe;Fs.escapeHtml=Zfe;Fs.escapeQuote=Qfe;Fs.unescapeQuote=Jfe;Fs.escapeHtmlEntities=Kfe;Fs.escapeDangerHtml5Entities=eme;Fs.clearNonPrintableCharacter=tme;Fs.friendlyAttrValue=ime;Fs.escapeAttrValue=rme;Fs.onIgnoreTagStripAll=nLe;Fs.StripTagBody=oLe;Fs.stripCommentTag=aLe;Fs.stripBlankChar=lLe;Fs.cssFilter=Yfe;Fs.getDefaultCSSWhiteList=qDe;var K4={},S0=RW;function cLe(e){var t=S0.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=S0.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function uLe(e){return e.slice(0,2)==="</"}function hLe(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(e.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(e.slice(s,n)),h=e.slice(n,a+1),c=cLe(h),r+=t(n,r.length,c,h,uLe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var dLe=/[^a-zA-Z0-9_:\.\-]/gim;function pLe(e,t){var i=0,r=[],s=!1,n=e.length;function o(p,f){if(p=S0.trim(p),p=p.replace(dLe,"").toLowerCase(),!(p.length<1)){var m=t(p,f||"");m&&r.push(m)}}for(var a=0;a<n;a++){var l=e.charAt(a),c,h;if(s===!1&&l==="="){s=e.slice(i,a),i=a+1;continue}if(s!==!1&&a===i&&(l==='"'||l==="'")&&e.charAt(a-1)==="="){if(h=e.indexOf(l,a+1),h===-1)break;c=S0.trim(e.slice(i+1,h)),o(s,c),s=!1,a=h,i=a+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(h=fLe(e,a),h===-1){c=S0.trim(e.slice(i,a)),o(c),s=!1,i=a+1;continue}else{a=h-1;continue}else if(h=mLe(e,a-1),h===-1){c=S0.trim(e.slice(i,a)),c=vK(c),o(s,c),s=!1,i=a+1;continue}else continue}return i<e.length&&(s===!1?o(e.slice(i)):o(s,vK(S0.trim(e.slice(i))))),S0.trim(r.join(" "))}function fLe(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function mLe(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function gLe(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function vK(e){return gLe(e)?e.substr(1,e.length-2):e}K4.parseTag=hLe;K4.parseAttr=pLe;var yLe=yO.exports.FilterCSS,Sd=Fs,sme=K4,vLe=sme.parseTag,_Le=sme.parseAttr,bD=RW;function vP(e){return e==null}function bLe(e){var t=bD.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=bD.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=bD.trim(e.slice(0,-1))),{html:e,closing:i}}function wLe(e){var t={};for(var i in e)t[i]=e[i];return t}function nme(e){e=wLe(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Sd.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||Sd.whiteList,e.onTag=e.onTag||Sd.onTag,e.onTagAttr=e.onTagAttr||Sd.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Sd.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Sd.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Sd.safeAttrValue,e.escapeHtml=e.escapeHtml||Sd.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new yLe(e.css))}nme.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=Sd.stripBlankChar(e)),i.allowCommentTag||(e=Sd.stripCommentTag(e));var p=!1;if(i.stripIgnoreTagBody){var p=Sd.StripTagBody(i.stripIgnoreTagBody,n);n=p.onIgnoreTag}var f=vLe(e,function(m,y,v,w,b){var S={sourcePosition:m,position:y,isClosing:b,isWhite:r.hasOwnProperty(v)},T=s(v,w,S);if(!vP(T))return T;if(S.isWhite){if(S.isClosing)return"</"+v+">";var E=bLe(w),C=r[v],O=_Le(E.html,function(N,D){var z=bD.indexOf(C,N)!==-1,B=o(v,N,D,z);if(!vP(B))return B;if(z)return D=l(v,N,D,h),D?N+'="'+D+'"':N;var B=a(v,N,D,z);return vP(B)?void 0:B}),w="<"+v;return O&&(w+=" "+O),E.closing&&(w+=" /"),w+=">",w}else{var T=n(v,w,S);return vP(T)?c(w):T}},c);return p&&(f=p.remove(f)),f};var xLe=nme;(function(e,t){var i=Fs,r=K4,s=xLe;function n(l,c){var h=new s(c);return h.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var o in i)t[o]=i[o];for(var o in r)t[o]=r[o];function a(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=e.exports)})(j1,j1.exports);var TLe=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):j1.exports.safeAttrValue(n,o,a,l)}};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new j1.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i!=null?i:{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?j1.exports.escapeAttrValue(t):!n&&!s?j1.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):j1.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(DDe(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const e5=new Map;function ome(){e5.clear()}function SLe(e){return e5.get(e)}function ELe(e,t){e5.set(e,t)}function Qk(e){e5.delete(e)}var Wb,c2,CLe=function(e){if("WebkitTransition"in e.style)Wb="webkitTransitionEnd",c2="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");Wb="transitionend",c2="animationend"}},ame=function(e){Wb||CLe(e)},ALe=function(e,t){return t===void 0&&(t=e+"-active"),function(i){ame(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(Wb,s),i.removeEventListener(c2,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(Wb,s),i.addEventListener(c2,s),requestAnimationFrame(function(){i.classList.add(t)})}},RLe=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){ame(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(Wb,n),i.removeEventListener(c2,n),r())};i.classList.add(e),i.addEventListener(Wb,n),i.addEventListener(c2,n),requestAnimationFrame(function(){i.classList.add(t)})}};const OLe=fe.getLogger("esri.widgets.support.widgetUtils");function lme(e){const t=Yl.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const i=t.join(" ");return Yl.release(t),i}(()=>{const e=new Map,t=new ResizeObserver(i=>{ome();for(const r of i)e.get(r.target)(r)});return(i,r,s)=>(e.has(i)&&OLe.error("Already observing element",i),e.set(i,r),t.observe(i,s),Rh(()=>{t.unobserve(i),e.delete(i)}))})();function ev(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function _K(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function eG(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function MLe(e,t){return(e==="enter"?ALe:RLe)(t)}const PLe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],ILe=PLe.reduce((e,t)=>(e[t]=[],e),{}),$Le=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],cme=new TLe({whiteList:ILe,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if($Le.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function DLe(e){return e==="Enter"||e===" "}const ume="http://www.w3.org/",t5=`${ume}2000/svg`,hme=`${ume}1999/xlink`;let ON,bK=[],OW=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},MW=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),dme=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},LLe=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(MW(e[r],t))return r}return-1},Jk=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n?n.key===void 0?n.bind:n.key:void 0)){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(MW(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},NLe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},tG=[],iG=!1,pme=e=>{(e.children||[]).forEach(pme),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},wK=()=>{iG=!1,tG.forEach(pme),tG.length=0},xK=e=>{tG.push(e),iG||(iG=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(wK,{timeout:16}):setTimeout(wK,16))},TK=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),xK(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),xK(e))},FLe=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")rG(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(dme(m),i.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):i.namespace===t5?a==="href"?e.setAttributeNS(hme,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=cme.sanitize(l):e.setAttribute(a,l):e[a]=l}}},ULe=(e,t,i)=>{if(t)for(let r of t)GT(r,e,void 0,i)},fme=(e,t,i)=>{ULe(e,t.children,i),t.text&&(e.textContent=t.text),FLe(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},GT=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=OW(r,{namespace:t5})),r.namespace!==void 0?s=e.domNode=a.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}fme(s,e,r)}},rG=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},kLe=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=t[l];if(l==="class")h!==c&&(rG(e,h,!1),rG(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let v=f[y],w=!!c[v];w!==!!h[v]&&(s=!0,w?p.add(v):p.remove(v))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],v=c[y];v!==h[y]&&(s=!0,v?(dme(v),r.styleApplyer(e,y,v)):r.styleApplyer(e,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===t5?l==="href"?e.setAttributeNS(hme,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=cme.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},zLe=(e,t,i,r,s)=>{if(i===r)return!1;r=r||bK;let n,o=(i=i||bK).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&MW(p,f))h=ON(p,f,s)||h,l++;else{let m=LLe(i,f,l+1);if(m>=0){for(n=l;n<m;n++)TK(i[n]),Jk(i,n,e,"removed");h=ON(i[m],f,s)||h,l=m+1}else GT(f,t,l<o?i[l].domNode:void 0,s),NLe(f),Jk(r,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)TK(i[n]),Jk(i,n,e,"removed");return h};ON=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(o,r),t.domNode=o,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=OW(i,{namespace:t5})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=zLe(t,r,e.children,t.children,i)||n,n=kLe(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let UE=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,ON(r,i,t)},domNode:e.domNode});const BLe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let Zx=e=>OW(BLe,e),tv={create:(e,t)=>(t=Zx(t),GT(e,document.createElement("div"),void 0,t),UE(e,t)),append:(e,t,i)=>(i=Zx(i),GT(t,e,void 0,i),UE(t,i)),insertBefore:(e,t,i)=>(i=Zx(i),GT(t,e.parentNode,e,i),UE(t,i)),merge:(e,t,i)=>(i=Zx(i),t.domNode=e,fme(e,t,i),UE(t,i)),replace:(e,t,i)=>(i=Zx(i),GT(t,e.parentNode,e,i),e.parentNode.removeChild(e),UE(t,i))},mme,VLe=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};mme=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let GLe=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?mme(i.children,s=>s.domNode===r):void 0}),i},jLe=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),o=VLe(s.currentTarget,n.domNode);o.reverse();let a,l=GLe(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},sG=e=>{let t,i,r=Zx(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,v=()=>y;r.eventHandlerInterceptor=jLe(t,v,s),y=p(f,m(),r),a.push(y),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(tv.append,p,f)},insertBefore:(p,f)=>{c(tv.insertBefore,p,f)},merge:(p,f)=>{c(tv.merge,p,f)},replace:(p,f)=>{c(tv.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},e0=class extends Ee{constructor(){super(...arguments),this.items=new ft,this._watchUpdatingTracking=new _f,this._callbacks=new Map,this._projector=sG(),this._hiddenProjector=sG()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}};u([d({readOnly:!0})],e0.prototype,"surface",void 0),u([d({readOnly:!0})],e0.prototype,"items",void 0),u([d({readOnly:!0})],e0.prototype,"needsRender",null),u([d({readOnly:!0})],e0.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],e0.prototype,"updating",void 0),e0=u([P("esri.views.overlay.ViewOverlay")],e0);const SK=e0;function PW(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function ut(e,t){const i=t?ve(F({},t),{source:e}):e;return d({aliasOf:i})}const HLe="randomUUID"in crypto;function IW(){if(HLe)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const qLe={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},WLe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},XLe=e=>F(F({},WLe),e),YLe=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},ZLe=(e,t)=>e.find(t),EK=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{const o=(r==null?void 0:r.children)?ZLe(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==t.length-1||(r=o)}),r},QLe=e=>{let t;const i=F(F({},qLe),e),r=XLe(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var b;let v;r.eventHandlerInterceptor=(S,T,E,C)=>function(O){let I;s("domEvent",O);const N=YLe(O.currentTarget,v.domNode),D=N.some(B=>{var k;return customElements.get((k=B==null?void 0:B.tagName)==null?void 0:k.toLowerCase())});if(O.eventPhase===Event.CAPTURING_PHASE||!D)N.reverse(),I=EK(v.getLastRender(),N);else{const B=O.composedPath(),k=B.slice(B.indexOf(O.currentTarget),B.indexOf(v.domNode)).filter(Y=>Y.getRootNode()===Y.ownerDocument).reverse();I=EK(v.getLastRender(),k,!0)}let z;return I&&(z=i.handleInterceptedEvent(t,I,this,O)),s("domEventProcessed",O),z},(b=i.postProcessProjectionOptions)==null||b.call(i,r);const w=y();v=f(m,w,r),l.push(v),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(v,w)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{h(tv.append,f,m)},insertBefore:(f,m)=>{h(tv.insertBefore,f,m)},merge:(f,m)=>{h(tv.merge,f,m)},replace:(f,m)=>{h(tv.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Ci={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let Qx,gme,i5,yme=!1,MN=!1,$W=!1,jc=!1,CK=null,nG=!1;const nE=typeof window!="undefined"?window:{};Ci.cssVarShim&&nE.CSS;const Zd=nE.document||{head:{}},f1t=nE.HTMLElement||class{},Qo={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},PN=Ci.shadowDomShim&&Ci.shadowDom?(()=>(Zd.head.attachShadow+"").indexOf("[native")>-1)():!0,JLe=(()=>{let e=!1;try{Zd.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),KLe=e=>Promise.resolve(e),eNe=Ci.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,vme=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=iNe(e,s),l=tNe(t,o),c=rNe(s);Qo.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>Qo.rel(a,n,l,c))})},tNe=(e,t)=>i=>{try{Ci.lazyLoad||e.$hostElement$[t](i)}catch(r){zM(r)}},iNe=(e,t)=>t&4?Zd:t&8?nE:t&16?Zd.body:e,rNe=e=>JLe?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,AK="http://www.w3.org/1999/xlink",Xb=(e,t="")=>()=>{},RK=new WeakMap,sNe=(e,t,i)=>{let r=DN.get(e);eNe&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,DN.set(e,r)},nNe=(e,t,i,r)=>{let s=_me(t,i),n=DN.get(s);if(e=e.nodeType===11?e:Zd,n)if(typeof n=="string"){e=e.head||e;let o=RK.get(e),a;o||RK.set(e,o=new Set),o.has(s)||(a=Zd.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},oNe=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=Xb("attachStyles",t.$tagName$),n=nNe(PN&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},_me=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),aNe=e=>FNe.map(t=>t(e)).find(t=>!!t),OK={},lNe="http://www.w3.org/2000/svg",cNe="http://www.w3.org/1999/xhtml",uNe=e=>e!=null,DW=e=>(e=typeof e,e==="object"||e==="function"),bme=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!DW(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?IN(null,r):r),a=o)};if(c(i),t&&(Ci.isDev&&e==="input"&&fNe(t),Ci.vdomKey&&t.key&&(s=t.key),Ci.slotRelocation&&t.name&&(n=t.name),Ci.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Ci.isDev&&l.some(wme)&&NNe(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Ci.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,dNe);const h=IN(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Ci.vdomKey&&(h.$key$=s),Ci.slotRelocation&&(h.$name$=n),h},IN=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Ci.vdomAttribute&&(i.$attrs$=null),Ci.vdomKey&&(i.$key$=null),Ci.slotRelocation&&(i.$name$=null),i},hNe={},wme=e=>e&&e.$tag$===hNe,dNe={forEach:(e,t)=>e.map(MK).forEach(t),map:(e,t)=>e.map(MK).map(t).map(pNe)},MK=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),pNe=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),bme(e.vtag,i,...e.vchildren||[])}const t=IN(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},fNe=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&Pme('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},PK=(e,t,i,r,s,n)=>{if(i!==r){let o=LK(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=IK(i),h=IK(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):LK(nE,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&Qo.rel(e,t,i,!1),r&&Qo.ael(e,t,r,!1);else{const l=DW(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(AK,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(AK,t,r):e.setAttribute(t,r))}}},mNe=/\s/,IK=e=>e?e.split(mNe):[],xme=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||OK,o=t.$attrs$||OK;for(r in n)r in o||PK(s,r,n[r],void 0,i,t.$flags$);for(r in o)PK(s,r,n[r],o[r],i,t.$flags$)},$N=(e,t,i,r)=>{let s=t.$children$[i],n=0,o,a,l;if(yme||($W=!0,s.$tag$==="slot"&&(Qx&&r.classList.add(Qx+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Zd.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Zd.createTextNode("");else{if(jc||(jc=s.$tag$==="svg"),o=s.$elm$=Zd.createElementNS(jc?lNe:cNe,s.$flags$&2?"slot-fb":s.$tag$),jc&&s.$tag$==="foreignObject"&&(jc=!1),xme(null,s,jc),uNe(Qx)&&o["s-si"]!==Qx&&o.classList.add(o["s-si"]=Qx),s.$children$)for(n=0;n<s.$children$.length;++n)a=$N(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?jc=!1:o.tagName==="foreignObject"&&(jc=!0)}return o["s-hn"]=i5,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=gme,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&vO(e.$elm$,!1)),o},vO=(e,t)=>{Qo.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==i5&&s["s-ol"]&&(Eme(s).insertBefore(s,LW(s)),s["s-ol"].remove(),s["s-ol"]=void 0,$W=!0),t&&vO(s,t)}Qo.$flags$&=-2},Tme=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===i5&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=$N(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,LW(t))))},Sme=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,Rme(r),MN=!0,s["s-ol"]?s["s-ol"].remove():vO(s,!0),s.remove())},gNe=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],y,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(_P(c,f))Jx(c,f),c=t[++s],f=r[++n];else if(_P(h,m))Jx(h,m),h=t[--l],m=r[--p];else if(_P(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&vO(c.$elm$.parentNode,!1),Jx(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(_P(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&vO(h.$elm$.parentNode,!1),Jx(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?y=$N(t&&t[n],i,o,e):(Jx(v,f),t[o]=void 0,y=v.$elm$),f=r[++n]):(y=$N(t&&t[n],i,n,e),f=r[++n]),y&&Eme(c.$elm$).insertBefore(y,LW(c.$elm$))}s>l?Tme(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&Sme(t,s,l)},_P=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,LW=e=>e&&e["s-ol"]||e,Eme=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,Jx=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(jc=n==="svg"?!0:n==="foreignObject"?!1:jc,n==="slot"||xme(e,t,jc),r!==null&&s!==null?gNe(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),Tme(i,null,t,s,0,s.length-1)):r!==null&&Sme(r,0,r.length-1),jc&&n==="svg"&&(jc=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},Cme=e=>{let t=e.childNodes,i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}Cme(i)}},Md=[],Ame=e=>{let t,i,r,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&($K(i,s)?(n=Md.find(h=>h.$nodeToRelocate$===i),MN=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:Md.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&Md.map(h=>{$K(h.$nodeToRelocate$,i["s-sn"])&&(n=Md.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Md.some(h=>h.$nodeToRelocate$===i)||Md.push({$nodeToRelocate$:i}));t.nodeType===1&&Ame(t)}},$K=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Rme=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Rme)},yNe=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||IN(null,null),n=wme(t)?t:bme(null,null,t);i5=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,Qx=i["s-sc"],gme=i["s-cr"],yme=PN&&(r.$flags$&1)!==0,MN=!1,Jx(s,n);{if(Qo.$flags$|=1,$W){Ame(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Md.length;f++)o=Md[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=Zd.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Md.length;f++)if(o=Md[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}MN&&Cme(n.$elm$),Qo.$flags$&=-2,Md.length=0}},vNe=e=>Ci.lazyLoad?oE(e).$hostElement$:e,m1t=(e,t,i)=>{const r=vNe(e);return{emit:s=>(Ci.isDev&&!r.isConnected&&Pme(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),_Ne(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},_Ne=(e,t,i)=>{const r=Qo.ce(t,i);return e.dispatchEvent(r),r},bNe=(e,t)=>{},NW=(e,t)=>(e.$flags$|=16,bNe(e,e.$ancestorComponent$),zNe(()=>wNe(e,t))),wNe=(e,t)=>{const i=e.$hostElement$,r=Xb("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=yS(s,"componentWillLoad"):n=yS(s,"componentWillUpdate"),n=DK(n,()=>yS(s,"componentWillRender")),r(),DK(n,()=>xNe(e,s,t))},xNe=async(e,t,i)=>{const r=e.$hostElement$,s=Xb("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&oNe(e);const n=Xb("render",e.$cmpMeta$.$tagName$);TNe(e,t,r),n(),s(),SNe(e)},TNe=(e,t,i)=>{try{CK=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Ci.hasRenderFn||Ci.reflect)&&(Ci.vdomRender||Ci.reflect)&&(Ci.hydrateServerSide||yNe(e,t))}catch(a){zM(a,e.$hostElement$)}return CK=null,null},SNe=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=Xb("postUpdate",t),s=i;e.$ancestorComponent$,yS(s,"componentDidRender"),e.$flags$&64?(yS(s,"componentDidUpdate"),r()):(e.$flags$|=64,yS(s,"componentDidLoad"),r())},g1t=e=>{if(Ci.updatable){const t=oE(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&NW(t,!1),i}return!1},yS=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){zM(r)}},DK=(e,t)=>e&&e.then?e.then(t):t(),ENe=(e,t)=>e!=null&&!DW(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,CNe=(e,t)=>oE(e).$instanceValues$.get(t),ANe=(e,t,i,r)=>{const s=oE(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=ENe(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(m){zM(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;NW(s,!1)}}}},RNe=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return CNe(this,n)},set(a){ANe(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Qo.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},ONe=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=aNe(e)]);const a=_me(i,t.$modeName$);if(!DN.has(a)){const l=Xb("registerStyles",i.$tagName$);sNe(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>NW(t,!0))()},MNe=e=>{},PNe=e=>{if((Qo.$flags$&1)===0){const t=oE(e),i=t.$cmpMeta$,r=Xb("connectedCallback",i.$tagName$);t.$flags$&1?(vme(e,t,i.$listeners$),MNe(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&INe(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),ONe(e,t,i)),r()}},INe=e=>{const t=e["s-cr"]=Zd.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},$Ne=e=>{if((Qo.$flags$&1)===0){const t=oE(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},y1t=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};Ci.member&&(i.$members$=t[2]),Ci.hostListener&&(i.$listeners$=t[3]),Ci.watchCallback&&(i.$watchers$=e.$watchers$),Ci.reflect&&(i.$attrsToReflect$=[]),Ci.shadowDom&&!PN&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){LNe(this,i)},connectedCallback(){PNe(this),Ci.connectedCallback&&r&&r.call(this)},disconnectedCallback(){$Ne(this),Ci.disconnectedCallback&&s&&s.call(this)},__attachShadow(){PN?Ci.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,RNe(e,i)},v1t=e=>{const t=new URL(e,Qo.$resourcesUrl$);return t.origin!==nE.location.origin?t.href:t.pathname},DNe=e=>Qo.$resourcesUrl$=e,Ome=new WeakMap,oE=e=>Ome.get(e),LNe=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Ci.isDev&&(i.$renderCount$=0),Ci.method&&Ci.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),Ci.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),vme(e,i,t.$listeners$),Ome.set(e,i)},LK=(e,t)=>t in e,zM=(e,t)=>(0,console.error)(e,t),Mme=Ci.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],NNe=(...e)=>console.error(...Mme,...e),Pme=(...e)=>console.warn(...Mme,...e),DN=new Map,FNe=[],NK=[],Ime=[],UNe=(e,t)=>i=>{e.push(i),nG||(nG=!0,t&&Qo.$flags$&4?kNe(oG):Qo.raf(oG))},FK=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){zM(i)}e.length=0},oG=()=>{FK(NK),FK(Ime),(nG=NK.length>0)&&Qo.raf(oG)},kNe=e=>KLe().then(e),zNe=UNe(Ime,!0),_1t={isDev:!!Ci.isDev,isBrowser:!0,isServer:!1,isTesting:!!Ci.isTesting};let $me;function BNe(){DNe(xh(Pi($me)))}$me="components/assets";const Dme=Symbol("widget"),VNe=[],GNe={},LN=new WeakMap;function Lme(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=Lme(e,i[s]);else i=VNe;const r=t.vnodeSelector;if(FW(r)){const s=t.properties||GNe,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:jNe,afterUpdate:HNe,afterRemoved:Nme,parentWidget:e,widgetConstructor:r,widgetProperties:ve(F({},s),{key:n,children:i})},children:void 0,text:void 0,domNode:null}}return t}function jNe(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,LN.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),r._internalHandles.add(Rh(()=>Nme(e)))}function HNe(e,t,i,{widgetProperties:r}){var n;const s=LN.get(e);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,e))}function Nme(e){const t=LN.get(e);t&&(t.destroy(),LN.delete(e))}function FW(e){return typeof e=="function"&&e[Dme]}const UK=new Set;function qNe(e){UK.add(e),e.finally(()=>UK.delete(e))}const Fme="esri.widgets.Widget",WNe=fe.getLogger(Fme);let XNe=0;const YNe={widgetIcon:"esri-icon-checkbox-unchecked"};function Ume(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?Ume(e[i],t[i]):e[i]=t[i]);return e}const ZNe=QLe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,o)=>{const a=t(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(ome(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let Kk=!1,vn=class extends O4(Kr.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Ht,this._projector=ZNe,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=YNe.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=GH(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await Zo(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await ppe(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=Ume(ie(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&WNe.error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),BNe();const i="esri-widget-uid-"+IW(),r=this.render.bind(this);this._trackingTarget=new m4(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const n=r();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=i),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(FW(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),Lme(this,n)};this.render=()=>{if(Kk)return s();let n=SLe(this);if(n)return n;this._trackingTarget.clear(),Kk=!0;try{n=Ag(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{Kk=!1}return ELe(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),qNe(this._resourcesFetch)}normalizeCtorArgs(e,t){const i=F({},e);return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(O8)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(at(this._trackingTarget),at(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,Qk(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return k4(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+XNe++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(Qk(this),this._projector.scheduleRender())}classes(...e){return lme.apply(this,e)}renderNow(){Qk(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),((t=this._delegatedEventNames)==null?void 0:t.length)&&this._internalHandles.add(ae(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&p4(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>OM(i,s,n=>{this.emit(s,n)})),"delegated-events")},Ft)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(O8),this.scheduleRender()};this._internalHandles.add([$Me(e),ae(()=>this.uiStrings,e),_l(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};vn[Dme]=!0,u([d()],vn.prototype,"_readyForTrueRender",void 0),u([d({value:null})],vn.prototype,"container",null),u([jt("container")],vn.prototype,"castContainer",null),u([d({aliasOf:"container"})],vn.prototype,"domNode",void 0),u([d()],vn.prototype,"iconClass",void 0),u([d()],vn.prototype,"id",null),u([d()],vn.prototype,"label",void 0),u([d()],vn.prototype,"renderable",null),u([d()],vn.prototype,"uiStrings",void 0),u([d()],vn.prototype,"viewModel",void 0),u([d()],vn.prototype,"visible",void 0),u([d()],vn.prototype,"key",void 0),u([d()],vn.prototype,"children",void 0),u([d()],vn.prototype,"afterCreate",void 0),u([d()],vn.prototype,"afterUpdate",void 0),u([d()],vn.prototype,"afterRemoved",void 0),vn=u([P(Fme)],vn);const $a=vn;function QNe(e,t,i){return e.units[t][i]}function r5(e,t,i,r=2,s="abbr"){return`${Pf(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${QNe(e,i,s)}`}function b1t(e,t,i,r=2,s="abbr"){const n=G3e(t,i);return r5(e,Hs(t,i,n),n,r,s)}function w1t(e,t,i,r=2,s="abbr"){const n=j3e(t,i);return r5(e,Hs(t,i,n),n,r,s)}function x1t(e,t,i,r=2,s="abbr"){const n=H3e(t,i);return r5(e,Hs(t,i,n),n,r,s)}function T1t(e,t,i,r=2,s="abbr"){const n=q3e(t,i);return r5(e,Hs(t,i,n),n,r,s)}const kK=["B","kB","MB","GB","TB"];function JNe(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(n2.KILOBYTES));i=De(i,0,kK.length-1);const r=Pf(t/n2.KILOBYTES**i,{maximumFractionDigits:2});return Ef(e.units.bytes[kK[i]],{fileSize:r})}function KNe(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?eFe({tagName:r,tags:s.tags}):null}function eFe(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var aG;const tFe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Dl=aG=class extends ye{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=KNe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return tFe[t]||null}clone(){return new aG({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],Dl.prototype,"contentType",void 0),u([d()],Dl.prototype,"exifInfo",void 0),u([d({readOnly:!0})],Dl.prototype,"orientationInfo",null),u([d({type:Lr})],Dl.prototype,"id",void 0),u([d({type:String})],Dl.prototype,"globalId",void 0),u([d({type:String})],Dl.prototype,"keywords",void 0),u([d({type:String})],Dl.prototype,"name",void 0),u([d({json:{read:!1}})],Dl.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],Dl.prototype,"parentObjectId",void 0),u([d({type:Lr})],Dl.prototype,"size",void 0),u([d({json:{read:!1}})],Dl.prototype,"url",void 0),Dl=aG=u([P("esri.layers.support.AttachmentInfo")],Dl);const iFe=Dl;var lG;let po=lG=class extends ye{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new lG(ie({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],po.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],po.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],po.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],po.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],po.prototype,"globalIds",void 0),u([d({json:{write:!0}})],po.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],po.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],po.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],po.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],po.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],po.prototype,"start",void 0),u([He("start"),He("num")],po.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],po.prototype,"where",void 0),po=lG=u([P("esri.rest.support.AttachmentQuery")],po),po.from=Ds(po);const cG=po,rFe="esri.widgets.Feature.support.featureUtils",zK=fe.getLogger(rFe),sFe=/href=(""|'')/gi,nFe=/(\{([^\{\r\n]+)\})/g,oFe=/\'/g,kme=/^\s*expression\//i,aFe=/(\n)/gi,lFe=/[\u00A0-\u9999<>\&]/gim,cFe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,uFe=/^(?:mailto:|tel:)/,zme="relationships/",uG=D4("short-date-short-time");function Bme(e){if(!A(e))return e.get("sourceLayer")||e.get("layer")}async function NN(e,t){return typeof e=="function"?e.call(null,t):e}function Vme(e=""){if(e)return!uFe.test(e.trim().toLowerCase())}function Gme(e){return!!e&&kme.test(e)}function hFe(e,t){if(!Gme(t)||!e)return null;const i=t.replace(kme,"").toLowerCase();let r;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function jme(e,t){const i=hFe(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function dFe(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function pFe(e){return e.replace(sFe,"")}function FN(e,t){const i=UW(t,e);return i?i.name:e}function fFe(e,t){return e&&e.map(i=>FN(i,t))}function UW(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function Hme(e){return`${e}`.trim()}function ob({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?hG({formattedAttributes:t,template:vFe(r,F(F(F({},t),s),e),i),fieldInfoMap:n}):""}function hG({formattedAttributes:e,template:t,fieldInfoMap:i}){return Hme(pFe(Ef(Ef(t,r=>dFe(r,i)),e)))}function mFe(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(oFe,s);t[e]=n}}function gFe(e,t=!1){const i=F({},e);return Object.keys(i).forEach(r=>mFe(r,i,t)),i}function yFe(e,t,i){const r=(t=Hme(t))&&t[0]!=="{";return Ef(e,gFe(i,r))}function dG(e,t){return e.replace(nFe,(i,r,s)=>{const n=UW(t,s);return n?`{${n.name}}`:r})}function vFe(e,t,i){const r=dG(e,i);return r&&r.replace(cFe,(s,n,o)=>yFe(s,n||o,t))}function _Fe(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function bFe(e){return(e==null?void 0:e.type)==="feature"}function BK(e){return!!(e==null?void 0:e.layer)}function wFe(e){return(e==null?void 0:e.type)==="map-image"}function xFe(e,t){var c;const i=t.fieldInfos,r=t.fieldName,s=(c=qme(i,r))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=UW(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new VT;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!BK(o)&&bFe(o)&&o.datesInUnknownTimezone||BK(o)&&wFe(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&Bue(r)&&l?l.formatRasterPixelValue(e):typeof(e=_Fe(e,l))=="string"||e==null||l==null?BM(e):n?Pf(e,ve(F({},Mde(l)),{minimumFractionDigits:0,maximumFractionDigits:20})):l.format(e)}function qme(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function TFe({fieldName:e,graphic:t,layer:i}){if(og(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function SFe({fieldName:e,value:t,graphic:i,layer:r}){if(og(e)||!r||typeof r.getFieldDomain!="function")return null;const s=r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function EFe(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:Mf(o,uG),user:l}}const a=t[r];if(typeof a=="number"){const l=t[i];return{type:"create",date:Mf(a,uG),user:l}}return null}function CFe(e,t){const i=new Map;return e&&e.forEach(r=>{const s=FN(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function VK(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function kW(e){return e.replace(lFe,t=>`&#${t.charCodeAt(0)};`)}function BM(e){return typeof e=="string"?e.replace(aFe,'<br class="esri-text-new-line" />'):e}function Wme(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=SFe({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=TFe({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return xFe(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Mf(t,uG):BM(t)}function e6({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>PFe({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:i})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=Wme({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function AFe(e,t){var h,p;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return zK.warn(f,m),null}if(!((p=(h=i.capabilities)==null?void 0:h.operations)==null?void 0:p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return zK.warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=(s==null?void 0:s.length)?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}async function RFe(e){var r;if(!((r=e.expressionInfos)==null?void 0:r.length))return!1;const t=await Cf(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}async function OFe({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=JAe(a,e),c=l?[]:a,h=t.returnGeometry||await RFe(t);if(l&&!h)return;const p=await AFe({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes=F(F({},e.attributes),p.attributes)))}function og(e=""){return!!e&&e.includes(zme)}function MFe(e){return e?`${zme}${e.layerId}/${e.fieldName}`:""}function GK({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach(o=>{const a=MFe({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=Wme({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function PFe({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>GK({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>GK({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})))}const jK=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},Xme=({layer:e,method:t,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)==null?void 0:a.supportsCacheHint)||t==="attachments")return;const s=_(i.where)&&i.where,n=_(i.geometry)&&i.geometry;jK(r)||jK(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},IFe=({query:e,layer:t,method:i})=>{Xme({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},$Fe=({queryPayload:e,layer:t,method:i})=>{Xme({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},HK={editing:!1,operations:{add:!0,update:!0,delete:!0}},Yme=ft.ofType(iFe),DFe="graphic.layer.capabilities.operations.supportsResizeAttachments";let cd=class extends Ee{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=F({},HK),this.activeAttachmentInfo=null,this.attachmentInfos=new Yme,this.graphic=null,this.mode="view",this.own(ae(()=>this.graphic,()=>this._graphicChanged(),Ft))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return F(F({},HK),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(DFe)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new H("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new cG({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(a=>a[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new H("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new H("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new H("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then(a=>this._queryAttachment(a.objectId)),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new H("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new H("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new H("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new H("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new H("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new H("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex(c=>c===t);if(!i||typeof i.updateAttachment!="function")throw new H("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new H("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new cG({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then(s=>s[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=Bme(e);this._attachmentLayer=t?t.type==="scene"&&_(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],cd.prototype,"abilities",void 0),u([jt("abilities")],cd.prototype,"castAbilities",null),u([d()],cd.prototype,"activeAttachmentInfo",void 0),u([d({readOnly:!0,type:Yme})],cd.prototype,"attachmentInfos",void 0),u([d({type:Pa})],cd.prototype,"graphic",void 0),u([d()],cd.prototype,"mode",void 0),u([d({readOnly:!0})],cd.prototype,"state",null),u([d({readOnly:!0})],cd.prototype,"supportsResizeAttachments",null),cd=u([P("esri.widgets.Attachments.AttachmentsViewModel")],cd);const zW=cd;function LFe(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function NFe(e){const t=Pi("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function Ra(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var FFe=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},Zme=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?Zme(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=FFe(s)),t.push(s))}},UFe=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return Zme(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function ce(e,t,...i){return typeof e!="function"||FW(e)?UFe(e,t,...i):e(t,...i)}const qK={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},et={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},t6=window.CSS;let aa=class extends $a{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new zW,this.visibleElements=F({},qK),this._supportsImageOrientation=t6&&t6.supports&&t6.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([fn(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Ft)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return F(F({},qK),e)}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new H("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return ce("div",{class:this.classes(et.base,et.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?ce("div",{key:"error-message",class:et.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return ce("div",{class:et.loaderContainer,key:"loader"},ce("div",{class:et.loader}))}renderProgressBar(){return this.visibleElements.progressBar?ce("div",{class:et.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?ce("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(et.esriButton,et.esriButtonTertiary,et.esriButtonSmall,et.esriButtonHalf,e&&et.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?ce("button",{type:"submit",disabled:i,class:this.classes(et.esriButton,et.esriButtonSecondary,et.esriButtonSmall,et.esriButtonHalf,{[et.buttonDisabled]:i})},this.messages.add):null,n=t?ce("span",{key:"file-name",class:et.fileName},t.name):null,o=ce("form",{bind:this,afterCreate:eG,afterRemoved:_K,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},ce("fieldset",{class:et.fileFieldset},n,ce("label",{class:this.classes(et.fileLabel,et.esriButton,et.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,ce("input",{class:et.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return ce("div",{key:"add-form-container",class:et.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,c=s||!r,h=l.editing&&l.operations.delete&&t.deleteButton?ce("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:S=>this._submitDeleteAttachment(S,e),class:this.classes(et.esriButton,et.esriButtonSmall,et.esriButtonTertiary,et.deleteButton,{[et.buttonDisabled]:s})},this.messages.delete):null,p=l.editing&&l.operations.update&&t.updateButton?ce("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(et.esriButton,et.esriButtonSmall,et.esriButtonThird,{[et.buttonDisabled]:c})},this.messages.update):null,f=this.visibleElements.cancelUpdateButton?ce("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(et.esriButton,et.esriButtonSmall,et.esriButtonTertiary,et.esriButtonThird,{[et.buttonDisabled]:s})},this.messages.cancel):null,m=r?ce("span",{key:"file-name",class:et.fileName},r.name):null,y=l.editing&&l.operations.update?ce("fieldset",{key:"file",class:et.fileFieldset},m,ce("label",{class:this.classes(et.fileLabel,et.esriButton,et.esriButtonSecondary)},this.messages.changeFile,ce("input",{class:et.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,v=ce("fieldset",{key:"size",class:et.metadataFieldset},ce("label",null,JNe(this.messagesUnits,o))),w=ce("fieldset",{key:"content-type",class:et.metadataFieldset},ce("label",null,n)),b=ce("form",{bind:this,afterCreate:eG,afterRemoved:_K,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},ce("div",{class:et.metadata},v,w),y,ce("div",{class:et.actions},h,f,p));return ce("div",{key:"edit-form-container",class:et.formNode},ce("a",{class:et.itemLink,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),ce("div",{class:et.itemLinkOverlay},ce("span",{class:et.itemLinkOverlayIcon},ce("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},ce("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),ce("path",{fill:"none",d:"M0 0h32v32H0z"}))))),b)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&LFe(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",h=o?`${n}${c}w=${t}`:NFe(r),p={[et.itemMaskIcon]:!o},f={[et.itemImageResizable]:i};return ce("div",{class:this.classes(p,et.itemMask)},ce("img",{styles:l,alt:s,src:h,class:this.classes(f,et.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),a=r.editing?ce("span",{"aria-hidden":"true",class:this.classes(et.itemChevronIcon,ev(this.container)?et.iconLeft:et.iconRight)}):null,l=[o,ce("label",{class:et.itemLabel},ce("span",{class:et.itemFilename},s||this.messages.noTitle),a)],c=r.editing?ce("button",{key:"details-button",bind:this,class:et.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):ce("a",{key:"details-link",class:et.itemButton,href:n,target:"_blank"},l);return ce("li",{class:et.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={[et.containerList]:e!=="preview",[et.containerPreview]:e==="preview"},a=s.editing&&s.operations.add&&i.addButton?ce("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(et.esriButton,et.esriButtonTertiary,et.addAttachmentButton),type:"button"},ce("span",{"aria-hidden":"true",class:this.classes(et.itemAddIcon,et.iconPlus)}),this.messages.add):null,l=n?ce("ul",{class:et.items},r.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):ce("div",{class:et.empty},this.messages.noAttachments);return ce("div",{key:"attachments-container",class:this.classes(et.container,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([ut("viewModel.abilities")],aa.prototype,"abilities",void 0),u([d()],aa.prototype,"displayType",void 0),u([d({readOnly:!0})],aa.prototype,"effectiveDisplayType",null),u([ut("viewModel.graphic")],aa.prototype,"graphic",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],aa.prototype,"label",void 0),u([d(),Ra("esri/widgets/Attachments/t9n/Attachments")],aa.prototype,"messages",void 0),u([d(),Ra("esri/core/t9n/Units")],aa.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],aa.prototype,"selectedFile",void 0),u([d({readOnly:!0})],aa.prototype,"submitting",void 0),u([d({readOnly:!0})],aa.prototype,"error",void 0),u([d({type:zW})],aa.prototype,"viewModel",void 0),u([d()],aa.prototype,"visibleElements",void 0),u([jt("visibleElements")],aa.prototype,"castVisibleElements",null),aa=u([P("esri.widgets.Attachments")],aa);const kFe=aa;let vA=class extends zW{constructor(e){super(e),this.description=null,this.title=null}};u([d()],vA.prototype,"description",void 0),u([d()],vA.prototype,"title",void 0),vA=u([P("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],vA);const BW=vA,zFe={heading:"esri-widget__heading"};function VW(e,t){const i=BFe(e.level),r=`h${i}`;return delete e.level,ce(r,ve(F({},e),{class:lme(zFe.heading,e.class),role:"heading","aria-level":String(i)}),t)}function BFe(e){return De(Math.ceil(e),1,6)}const i6={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let Kx=class extends $a{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return ce("div",{class:i6.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?ce(VW,{level:this.headingLevel,class:i6.title},e):null}renderDescription(){const{description:e}=this;return e?ce("div",{key:"description",class:i6.description},e):null}};u([d()],Kx.prototype,"description",void 0),u([d()],Kx.prototype,"headingLevel",void 0),u([d()],Kx.prototype,"title",void 0),Kx=u([P("esri.widgets.Feature.support.FeatureElementInfo")],Kx);const GW=Kx,VFe={base:"esri-feature-attachments"};let kp=class extends $a{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new kFe,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new BW}initialize(){this._featureElementInfo=new GW,this.own([ae(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Ft),ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,Ft)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return ce("div",{class:VFe.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};u([d({readOnly:!0})],kp.prototype,"attachmentsWidget",void 0),u([ut("viewModel.description")],kp.prototype,"description",void 0),u([ut("attachmentsWidget.displayType")],kp.prototype,"displayType",void 0),u([ut("viewModel.graphic")],kp.prototype,"graphic",void 0),u([d()],kp.prototype,"headingLevel",void 0),u([ut("viewModel.title")],kp.prototype,"title",void 0),u([d({type:BW})],kp.prototype,"viewModel",void 0),kp=u([P("esri.widgets.Feature.FeatureAttachments")],kp);const GFe=kp;let t0=class extends Ow(Ee){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(ae(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},Ft))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(NN(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=NN(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};u([d({readOnly:!0})],t0.prototype,"created",void 0),u([d()],t0.prototype,"creator",void 0),u([d()],t0.prototype,"destroyer",void 0),u([d({type:Pa})],t0.prototype,"graphic",void 0),u([d({readOnly:!0})],t0.prototype,"state",null),t0=u([P("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],t0);const UN=t0;function Hc(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:HFe(e[t])}}}function jFe(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function HFe(e){return function(t,...i){jFe(t)?DLe(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function qFe(e){return e.split(",").map(t=>t.trim())}function Qme(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:qFe(e);i.push(...r)}}const Jme="calcite-theme-";function WFe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function Kme(){return WFe().startsWith("dark")}function XFe(){return`${Jme}${Kme()?"dark":"light"}`}function YFe(e){ZFe(e),e.classList.add(XFe())}function ZFe(e){Array.from(e.classList).forEach(t=>{t.startsWith(Jme)&&e.classList.remove(t)})}function ege(e){return e&&typeof e.render=="function"}function QFe(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const r6={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let eT=class extends $a{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{Vme(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}renderLoading(){return ce("div",{class:r6.loaderContainer,key:"loader"},ce("div",{class:r6.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?ce("div",{key:e,bind:e,afterCreate:this._attachToNode}):ege(e)?ce("div",{key:e},!e.destroyed&&e.render()):ce("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return ce("div",{class:r6.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([ut("viewModel.creator")],eT.prototype,"creator",void 0),u([ut("viewModel.graphic")],eT.prototype,"graphic",void 0),u([d({type:UN})],eT.prototype,"viewModel",void 0),eT=u([P("esri.widgets.Feature.FeatureContent")],eT);const wD=eT;let Em=class extends Ee{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=jme(s,e),i.push(s)}),i}};u([d()],Em.prototype,"attributes",void 0),u([d({type:[Ude]})],Em.prototype,"expressionInfos",void 0),u([d()],Em.prototype,"description",void 0),u([d({type:[FM]})],Em.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],Em.prototype,"formattedFieldInfos",null),u([d()],Em.prototype,"title",void 0),Em=u([P("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Em);const s5=Em,JFe=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function KFe(e){let t=null;return JFe.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function e4e(e,t){if(typeof t!="string"||!t)return t;const i=KFe(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=Ef(Ef(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const kE={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let ud=class extends $a{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new s5,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new GW,this.own(ae(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Ft))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):e4e(this.messagesURIUtils,n),l={[kE.fieldDataDate]:o};return ce("tr",{key:`fields-element-info-row-${r}-${t}`},ce("th",{key:`fields-element-info-row-header-${r}-${t}`,class:kE.fieldHeader,innerHTML:s}),ce("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(kE.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return(e==null?void 0:e.length)?ce("table",{class:kE.esriTable,summary:this.messages.fieldsSummary},ce("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return ce("div",{class:kE.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([ut("viewModel.attributes")],ud.prototype,"attributes",void 0),u([ut("viewModel.description")],ud.prototype,"description",void 0),u([ut("viewModel.expressionInfos")],ud.prototype,"expressionInfos",void 0),u([ut("viewModel.fieldInfos")],ud.prototype,"fieldInfos",void 0),u([ut("viewModel.title")],ud.prototype,"title",void 0),u([d({type:s5})],ud.prototype,"viewModel",void 0),u([d(),Ra("esri/widgets/Feature/t9n/Feature")],ud.prototype,"messages",void 0),u([d(),Ra("esri/widgets/support/t9n/uriUtils")],ud.prototype,"messagesURIUtils",void 0),ud=u([P("esri.widgets.Feature.FeatureFields")],ud);const tge=ud,t4e={maximumFractionDigits:20};function i4e(e){return Pf(e,t4e)}function n5(e,t,i){return Zo(e.map((r,s)=>t.apply(i,[r,s])))}async function r4e(e,t,i){return(await Zo(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}async function xu(e){if(A(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function S1t(e){try{return{ok:!0,value:await e}}catch(t){return nc(t),{ok:!1,error:t}}}function E1t(e){if(e.ok===!0)return e.value;throw e.error}function VM(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function s4e(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function n4e(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v){const w=new Float32Array(16);return w[0]=e,w[1]=t,w[2]=i,w[3]=r,w[4]=s,w[5]=n,w[6]=o,w[7]=a,w[8]=l,w[9]=c,w[10]=h,w[11]=p,w[12]=f,w[13]=m,w[14]=y,w[15]=v,w}function o4e(e,t){return new Float32Array(e,t,16)}const a4e=VM();Object.freeze(Object.defineProperty({__proto__:null,create:VM,clone:s4e,fromValues:n4e,createView:o4e,IDENTITY:a4e},Symbol.toStringTag,{value:"Module"}));const l4e=(e,t)=>{const i=jf(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return bl(i,i)},c4e=(e,t)=>{const i=jf(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return bl(i,i)},u4e=(e,t)=>{const i=1-t,r=jf(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return bl(r,r)},h4e=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=jf(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return bl(s,s)},d4e=(e,t)=>{const i=1-2*t,r=jf(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return bl(r,r)},p4e=(e,t)=>{const i=jf(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return bl(i,i)},f4e=(e,t)=>{const i=1-t,r=jf(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return bl(r,r)};class o5{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=ql(t.strength,i.strength,r),this.radius=ql(t.radius,i.radius,r),this.threshold=ql(t.threshold,i.threshold,r)}clone(){return new o5(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:bR(this.radius),strength:this.strength,threshold:this.threshold}}}class a5{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(ql(t.radius,i.radius,r))}clone(){return new a5(this.radius)}toJSON(){return{type:"blur",radius:bR(this.radius)}}}class _O{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=ql(t.amount,i.amount,r),this._updateMatrix()}clone(){return new _O(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||VM();switch(this.type){case"brightness":this._colorMatrix=l4e(t,this.amount);break;case"contrast":this._colorMatrix=c4e(t,this.amount);break;case"grayscale":this._colorMatrix=u4e(t,this.amount);break;case"invert":this._colorMatrix=d4e(t,this.amount);break;case"saturate":this._colorMatrix=p4e(t,this.amount);break;case"sepia":this._colorMatrix=f4e(t,this.amount)}}}class l5{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=ql(t.offsetX,i.offsetX,r),this.offsetY=ql(t.offsetY,i.offsetY,r),this.blurRadius=ql(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(ql(t.color[0],i.color[0],r)),this.color[1]=Math.round(ql(t.color[1],i.color[1],r)),this.color[2]=Math.round(ql(t.color[2],i.color[2],r)),this.color[3]=ql(t.color[3],i.color[3],r)}clone(){return new l5(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:bR(this.offsetX),yoffset:bR(this.offsetY),blurRadius:bR(this.blurRadius),color:t}}}class c5{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=ql(t.angle,i.angle,r),this._updateMatrix()}clone(){return new c5(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||VM();this._colorMatrix=h4e(t,this.angle)}}class u5{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=ql(t.amount,i.amount,r)}clone(){return new u5(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function ql(e,t,i){return e+(t-e)*i}function bR(e){return Math.round(1e3*yu(e))/1e3}function m4e(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new _O(e.type,0);case"saturate":case"brightness":case"contrast":return new _O(e.type,1);case"opacity":return new u5(1);case"hue-rotate":return new c5(0);case"blur":return new a5(0);case"drop-shadow":return new l5(0,0,0,[...nq("transparent")]);case"bloom":return new o5(0,0,1)}}var C1t=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function A1t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function R1t(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function g4e(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function y4e(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(m4e(i[s]))}function v4e(e){const t=e[0];return!!t&&"type"in t}var WK,XK,ige={exports:{}};function rge(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=YK(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new H("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:YK(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!g4e(t[i].effects,t[i+1].effects))throw new H("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});y4e(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function YK(e){let t;if(!e)return[];try{t=ige.exports.parse(e)}catch(i){throw new H("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>_4e(i))}function _4e(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return b4e(e);case"opacity":return w4e(e);case"hue-rotate":return x4e(e);case"blur":return T4e(e);case"drop-shadow":return S4e(e);case"bloom":return E4e(e)}}catch(t){throw t.details.filter=e,t}throw new H("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function b4e(e){let t=1;return aE(e.parameters,1),e.parameters.length===1&&(t=Cd(e.parameters[0])),new _O(e.name,t)}function w4e(e){let t=1;return aE(e.parameters,1),e.parameters.length===1&&(t=Cd(e.parameters[0])),new u5(t)}function x4e(e){let t=0;return aE(e.parameters,1),e.parameters.length===1&&(t=P4e(e.parameters[0])),new c5(t)}function T4e(e){let t=0;return aE(e.parameters,1),e.parameters.length===1&&(t=qW(e.parameters[0]),GM(t,e.parameters[0])),new a5(t)}function S4e(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new H("effect:type-error","Accepts only one color",{});i=I4e(r)}else{const s=qW(r);if(Object.isFrozen(t))throw new H("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&GM(s,r)}if(t.length<2||t.length>3)throw new H("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new l5(t[0],t[1],t[2]||0,i||sge("black"))}function E4e(e){let t=1,i=0,r=0;return aE(e.parameters,3),e.parameters[0]&&(t=Cd(e.parameters[0])),e.parameters[1]&&(i=qW(e.parameters[1]),GM(i,e.parameters[1])),e.parameters[2]&&(r=Cd(e.parameters[2])),new o5(t,i,r)}function aE(e,t){if(e.length>t)throw new H("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function h5(e){if(e.type==="color")return"<color>";if(e.unit){if(HW[e.unit])return"<length>";if(jW[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function GM(e,t){if(e<0)throw new H("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function C4e(e){if(e.type!=="quantity"||e.unit!==null)throw new H("effect:type-error",`Expected <double>, Actual: ${h5(e)}`,{term:e})}function A4e(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new H("effect:type-error",`Expected <double> or <percentage>, Actual: ${h5(e)}`,{term:e})}XK=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:gQ},h=gQ,p="none",f=")",m=",",y="(",v="%",w="px",b="cm",S="mm",T="in",E="pt",C="pc",O="deg",I="rad",N="grad",D="turn",z="#",B=".",k="e",Y=/^[ \t\n\r]/,Z=/^[a-z\-]/,le=/^[0-9a-fA-F]/,ne=/^[+\-]/,$=/^[0-9]/,U=Gh("none"),V=gn("none",!1),q=gn(")",!1),W=gn(",",!1),K=Gh("whitespace"),j=o_([" ","	",`
`,"\r"],!1,!1),ee=Gh("function"),ge=gn("(",!1),Te=Gh("identifier"),Fe=o_([["a","z"],"-"],!1,!1),_e=Gh("percentage"),me=gn("%",!1),Ce=Gh("length"),Ne=gn("px",!1),Mi=gn("cm",!1),Fi=gn("mm",!1),si=gn("in",!1),Ui=gn("pt",!1),li=gn("pc",!1),ki=Gh("angle"),Ur=gn("deg",!1),ts=gn("rad",!1),rt=gn("grad",!1),Er=gn("turn",!1),$n=Gh("number"),Na=Gh("color"),ea=gn("#",!1),Bh=o_([["0","9"],["a","f"],["A","F"]],!1,!1),Vh=o_(["+","-"],!1,!1),ta=o_([["0","9"]],!1,!1),i_=gn(".",!1),ak=gn("e",!1),lk=function(){return[]},x3=function(X,be){return{type:"function",name:X,parameters:be||[]}},T3=function(X,be){return be.length>0?D2e(X,be,3):[X]},S3=function(X){return{type:"quantity",value:X.value,unit:X.unit}},E3=function(X){return{type:"color",colorType:X.type,value:X.value}},ck=function(X){return X},uk=function(){return n_()},hk=function(X){return{value:X,unit:"%"}},dk=function(X){return{value:X,unit:"px"}},TE=function(X){return{value:X,unit:"cm"}},C3=function(X){return{value:X,unit:"mm"}},A3=function(X){return{value:X,unit:"in"}},R3=function(X){return{value:X,unit:"pt"}},Ri=function(X){return{value:X,unit:"pc"}},Mo=function(X){return{value:X,unit:"deg"}},no=function(X){return{value:X,unit:"rad"}},Sl=function(X){return{value:X,unit:"grad"}},r_=function(X){return{value:X,unit:"turn"}},O3=function(X){return{value:X,unit:null}},M3=function(){return{type:"hex",value:n_()}},P3=function(X){return{type:"function",value:X}},I3=function(){return{type:"named",value:n_()}},up=function(){return parseFloat(n_())},ue=0,Cr=0,kw=[{line:1,column:1}],Au=0,s_=[],ct=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function n_(){return s.substring(Cr,ue)}function gn(X,be){return{type:"literal",text:X,ignoreCase:be}}function o_(X,be,Me){return{type:"class",parts:X,inverted:be,ignoreCase:Me}}function $3(){return{type:"end"}}function Gh(X){return{type:"other",description:X}}function SE(X){var be,Me=kw[X];if(Me)return Me;for(be=X-1;!kw[be];)be--;for(Me={line:(Me=kw[be]).line,column:Me.column};be<X;)s.charCodeAt(be)===10?(Me.line++,Me.column=1):Me.column++,be++;return kw[X]=Me,Me}function D3(X,be){var Me=SE(X),mi=SE(be);return{source:l,start:{offset:X,line:Me.line,column:Me.column},end:{offset:be,line:mi.line,column:mi.column}}}function Xt(X){ue<Au||(ue>Au&&(Au=ue,s_=[]),s_.push(X))}function T2e(X,be,Me){return new t(t.buildMessage(X,be),X,be,Me)}function gQ(){var X;return(X=S2e())===a&&(X=E2e()),X}function S2e(){var X,be;return ct++,X=ue,oo(),s.substr(ue,4)===p?(be=p,ue+=4):(be=a,ct===0&&Xt(V)),be!==a?(oo(),Cr=X,X=lk()):(ue=X,X=a),ct--,X===a&&ct===0&&Xt(U),X}function E2e(){var X,be;if(X=[],(be=pk())!==a)for(;be!==a;)X.push(be),be=pk();else X=a;return X}function pk(){var X,be,Me,mi;return X=ue,oo(),(be=A2e())!==a?(oo(),(Me=C2e())===a&&(Me=null),oo(),s.charCodeAt(ue)===41?(mi=f,ue++):(mi=a,ct===0&&Xt(q)),mi!==a?(oo(),Cr=X,X=x3(be,Me)):(ue=X,X=a)):(ue=X,X=a),X}function C2e(){var X,be,Me,mi,Po,bs,Ou,L3;if(X=ue,(be=fk())!==a){for(Me=[],mi=ue,Po=oo(),s.charCodeAt(ue)===44?(bs=m,ue++):(bs=a,ct===0&&Xt(W)),bs===a&&(bs=null),Ou=oo(),(L3=fk())!==a?mi=Po=[Po,bs,Ou,L3]:(ue=mi,mi=a);mi!==a;)Me.push(mi),mi=ue,Po=oo(),s.charCodeAt(ue)===44?(bs=m,ue++):(bs=a,ct===0&&Xt(W)),bs===a&&(bs=null),Ou=oo(),(L3=fk())!==a?mi=Po=[Po,bs,Ou,L3]:(ue=mi,mi=a);Cr=X,X=T3(be,Me)}else ue=X,X=a;return X}function fk(){var X,be;return X=ue,(be=R2e())===a&&(be=O2e())===a&&(be=M2e())===a&&(be=P2e()),be!==a&&(Cr=X,be=S3(be)),(X=be)===a&&(X=ue,(be=I2e())!==a&&(Cr=X,be=E3(be)),X=be),X}function oo(){var X,be;for(ct++,X=[],Y.test(s.charAt(ue))?(be=s.charAt(ue),ue++):(be=a,ct===0&&Xt(j));be!==a;)X.push(be),Y.test(s.charAt(ue))?(be=s.charAt(ue),ue++):(be=a,ct===0&&Xt(j));return ct--,be=a,ct===0&&Xt(K),X}function A2e(){var X,be,Me;return ct++,X=ue,(be=yQ())!==a?(s.charCodeAt(ue)===40?(Me=y,ue++):(Me=a,ct===0&&Xt(ge)),Me!==a?(Cr=X,X=ck(be)):(ue=X,X=a)):(ue=X,X=a),ct--,X===a&&(be=a,ct===0&&Xt(ee)),X}function yQ(){var X,be,Me;if(ct++,X=ue,be=[],Z.test(s.charAt(ue))?(Me=s.charAt(ue),ue++):(Me=a,ct===0&&Xt(Fe)),Me!==a)for(;Me!==a;)be.push(Me),Z.test(s.charAt(ue))?(Me=s.charAt(ue),ue++):(Me=a,ct===0&&Xt(Fe));else be=a;return be!==a&&(Cr=X,be=uk()),ct--,(X=be)===a&&(be=a,ct===0&&Xt(Te)),X}function R2e(){var X,be,Me;return ct++,X=ue,oo(),(be=Ru())!==a?(s.charCodeAt(ue)===37?(Me=v,ue++):(Me=a,ct===0&&Xt(me)),Me!==a?(Cr=X,X=hk(be)):(ue=X,X=a)):(ue=X,X=a),ct--,X===a&&ct===0&&Xt(_e),X}function O2e(){var X,be,Me;return ct++,X=ue,oo(),(be=Ru())!==a?(s.substr(ue,2)===w?(Me=w,ue+=2):(Me=a,ct===0&&Xt(Ne)),Me!==a?(Cr=X,X=dk(be)):(ue=X,X=a)):(ue=X,X=a),X===a&&(X=ue,oo(),(be=Ru())!==a?(s.substr(ue,2)===b?(Me=b,ue+=2):(Me=a,ct===0&&Xt(Mi)),Me!==a?(Cr=X,X=TE(be)):(ue=X,X=a)):(ue=X,X=a),X===a&&(X=ue,oo(),(be=Ru())!==a?(s.substr(ue,2)===S?(Me=S,ue+=2):(Me=a,ct===0&&Xt(Fi)),Me!==a?(Cr=X,X=C3(be)):(ue=X,X=a)):(ue=X,X=a),X===a&&(X=ue,oo(),(be=Ru())!==a?(s.substr(ue,2)===T?(Me=T,ue+=2):(Me=a,ct===0&&Xt(si)),Me!==a?(Cr=X,X=A3(be)):(ue=X,X=a)):(ue=X,X=a),X===a&&(X=ue,oo(),(be=Ru())!==a?(s.substr(ue,2)===E?(Me=E,ue+=2):(Me=a,ct===0&&Xt(Ui)),Me!==a?(Cr=X,X=R3(be)):(ue=X,X=a)):(ue=X,X=a),X===a&&(X=ue,oo(),(be=Ru())!==a?(s.substr(ue,2)===C?(Me=C,ue+=2):(Me=a,ct===0&&Xt(li)),Me!==a?(Cr=X,X=Ri(be)):(ue=X,X=a)):(ue=X,X=a)))))),ct--,X===a&&ct===0&&Xt(Ce),X}function M2e(){var X,be,Me;return ct++,X=ue,(be=Ru())!==a?(s.substr(ue,3)===O?(Me=O,ue+=3):(Me=a,ct===0&&Xt(Ur)),Me!==a?(Cr=X,X=Mo(be)):(ue=X,X=a)):(ue=X,X=a),X===a&&(X=ue,(be=Ru())!==a?(s.substr(ue,3)===I?(Me=I,ue+=3):(Me=a,ct===0&&Xt(ts)),Me!==a?(Cr=X,X=no(be)):(ue=X,X=a)):(ue=X,X=a),X===a&&(X=ue,(be=Ru())!==a?(s.substr(ue,4)===N?(Me=N,ue+=4):(Me=a,ct===0&&Xt(rt)),Me!==a?(Cr=X,X=Sl(be)):(ue=X,X=a)):(ue=X,X=a),X===a&&(X=ue,(be=Ru())!==a?(s.substr(ue,4)===D?(Me=D,ue+=4):(Me=a,ct===0&&Xt(Er)),Me!==a?(Cr=X,X=r_(be)):(ue=X,X=a)):(ue=X,X=a)))),ct--,X===a&&(be=a,ct===0&&Xt(ki)),X}function P2e(){var X,be;return ct++,X=ue,oo(),(be=Ru())!==a?(Cr=X,X=O3(be)):(ue=X,X=a),ct--,X===a&&ct===0&&Xt($n),X}function I2e(){var X,be,Me,mi;if(ct++,X=ue,s.charCodeAt(ue)===35?(be=z,ue++):(be=a,ct===0&&Xt(ea)),be!==a){if(Me=[],le.test(s.charAt(ue))?(mi=s.charAt(ue),ue++):(mi=a,ct===0&&Xt(Bh)),mi!==a)for(;mi!==a;)Me.push(mi),le.test(s.charAt(ue))?(mi=s.charAt(ue),ue++):(mi=a,ct===0&&Xt(Bh));else Me=a;Me!==a?(Cr=X,X=M3()):(ue=X,X=a)}else ue=X,X=a;return X===a&&(X=ue,(be=pk())!==a&&(Cr=X,be=P3(be)),(X=be)===a&&(X=ue,(be=yQ())!==a&&(Cr=X,be=I3()),X=be)),ct--,X===a&&(be=a,ct===0&&Xt(Na)),X}function Ru(){var X,be,Me,mi,Po,bs,Ou;for(X=ue,ne.test(s.charAt(ue))?(s.charAt(ue),ue++):ct===0&&Xt(Vh),be=ue,Me=[],$.test(s.charAt(ue))?(mi=s.charAt(ue),ue++):(mi=a,ct===0&&Xt(ta));mi!==a;)Me.push(mi),$.test(s.charAt(ue))?(mi=s.charAt(ue),ue++):(mi=a,ct===0&&Xt(ta));if(s.charCodeAt(ue)===46?(mi=B,ue++):(mi=a,ct===0&&Xt(i_)),mi!==a){if(Po=[],$.test(s.charAt(ue))?(bs=s.charAt(ue),ue++):(bs=a,ct===0&&Xt(ta)),bs!==a)for(;bs!==a;)Po.push(bs),$.test(s.charAt(ue))?(bs=s.charAt(ue),ue++):(bs=a,ct===0&&Xt(ta));else Po=a;Po!==a?be=Me=[Me,mi,Po]:(ue=be,be=a)}else ue=be,be=a;if(be===a)if(be=[],$.test(s.charAt(ue))?(Me=s.charAt(ue),ue++):(Me=a,ct===0&&Xt(ta)),Me!==a)for(;Me!==a;)be.push(Me),$.test(s.charAt(ue))?(Me=s.charAt(ue),ue++):(Me=a,ct===0&&Xt(ta));else be=a;if(be!==a){if(Me=ue,s.charCodeAt(ue)===101?(mi=k,ue++):(mi=a,ct===0&&Xt(ak)),mi!==a){if(ne.test(s.charAt(ue))?(Po=s.charAt(ue),ue++):(Po=a,ct===0&&Xt(Vh)),Po===a&&(Po=null),bs=[],$.test(s.charAt(ue))?(Ou=s.charAt(ue),ue++):(Ou=a,ct===0&&Xt(ta)),Ou!==a)for(;Ou!==a;)bs.push(Ou),$.test(s.charAt(ue))?(Ou=s.charAt(ue),ue++):(Ou=a,ct===0&&Xt(ta));else bs=a;bs!==a?Me=mi=[mi,Po,bs]:(ue=Me,Me=a)}else ue=Me,Me=a;Me===a&&(Me=null),Cr=X,X=up()}else ue=X,X=a;return X}function $2e(X,be){return X.map(function(Me){return Me[be]})}function D2e(X,be,Me){return[X].concat($2e(be,Me))}if((o=h())!==a&&ue===s.length)return o;throw o!==a&&ue<s.length&&Xt($3()),T2e(s_,Au<s.length?s.charAt(Au):null,Au<s.length?D3(Au,Au+1):D3(Au,Au))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length),f=a[l.line-1],m=l.line===h.line?h.column:f.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1)+i("",m-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(v){return Array.isArray(v)?c(v[0])+"-"+c(v[1]):c(v)});return"["+(m.inverted?"^":"")+y+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,v,w=m.map(h);if(w.sort(),w.length>0){for(y=1,v=1;y<w.length;y++)w[y-1]!==w[y]&&(w[v]=w[y],v++);w.length=v}switch(w.length){case 1:return w[0];case 2:return w[0]+" or "+w[1];default:return w.slice(0,-1).join(", ")+", or "+w[w.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:r}},(WK=ige).exports&&(WK.exports=XK());const jW={deg:1,grad:.9,rad:180/Math.PI,turn:360};function R4e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&jW[e.unit]!=null))throw new H("effect:type-error",`Expected <angle>, Actual: ${h5(e)}`,{term:e})}const HW={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function O4e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&HW[e.unit]!=null))throw new H("effect:type-error",`Expected <length>, Actual: ${h5(e)}`,{term:e})}function Cd(e){A4e(e);const t=e.value;return GM(t,e),e.unit==="%"?.01*t:t}function M4e(e){return C4e(e),GM(e.value,e),e.value}function P4e(e){return R4e(e),e.value*jW[e.unit]||0}function qW(e){return O4e(e),e.value*HW[e.unit]||0}function I4e(e){switch(e.colorType){case"hex":return tRe(e.value);case"named":return sge(e.value);case"function":return L4e(e.value)}}function sge(e){if(!Vue(e))throw new H("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return eRe(e)}const $4e=/^rgba?/i,D4e=/^hsla?/i;function L4e(e){if(aE(e.parameters,4),$4e.test(e.name))return[Cd(e.parameters[0]),Cd(e.parameters[1]),Cd(e.parameters[2]),e.parameters[3]?Cd(e.parameters[3]):1];if(D4e.test(e.name))return Gue(M4e(e.parameters[0]),Cd(e.parameters[1]),Cd(e.parameters[2]),e.parameters[3]?Cd(e.parameters[3]):1);throw new H("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function WW(e,t,i){var r;try{return F4e(e)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function XW(e,t,i,r){try{const s=N4e(e);lc(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function N4e(e){const t=rge(e);return t?v4e(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function F4e(e){if(!e||e.length===0)return null;if(U4e(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:ZK(i.value)});return t}return ZK(e)}function U4e(e){const t=e[0];return!!t&&"scale"in t}function ZK(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[tm(i,"amount")];break;case"blur":r=[tm(i,"radius","pt")];break;case"hue-rotate":r=[tm(i,"angle","deg")];break;case"drop-shadow":r=[tm(i,"xoffset","pt"),tm(i,"yoffset","pt"),tm(i,"blurRadius","pt"),k4e(i,"color")];break;case"bloom":r=[tm(i,"strength"),tm(i,"radius","pt"),tm(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;rge(s),t.push(s)}return t.join(" ")}function tm(e,t,i){if(e[t]==null)throw new H("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function k4e(e,t){if(e[t]==null)throw new H("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const xD=-3;var Km;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(Km||(Km={}));class z4e{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class YW{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Vt,this._users=new Vt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,Km.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,Km.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,xD)-xD;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,Km.SOME);if(!(_(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>t[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(t["Priority "+(o+xD-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,Km.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,Km.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,Km.SOME);_(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class B4e{constructor(t,i){this._storage=new YW,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function V4e(e){return typeof e=="function"}function O1t(e,t,i,r){return V4e(e)?e(t,i,r):e}function M1t(e){return[e.r,e.g,e.b,e.a]}function P1t(e,t,i){const r=` /-,
`,s=l=>{let c=l.length;for(;c--;)if(!r.includes(l.charAt(c)))return!1;return!0},n=[];let o=0,a=-1;do if(a=t.indexOf("[",o),a>=o){if(a>o){const l=t.substr(o,a-o);n.push([l,null,s(l)])}if(o=a+1,a=t.indexOf("]",o),a>=o){if(a>o){const l=e[t.substr(o,a-o)];l&&n.push([null,l,!1])}o=a+1}}while(a!==-1);if(o<t.length-1){const l=t.substr(o);n.push([l,null,s(l)])}return l=>{let c="",h=null;for(const p of n){const[f,m,y]=p;if(f)y?h=f:(h&&(c+=h,h=null),c+=f);else{const v=l.attributes[m];v&&(h&&(c+=h,h=null),c+=v)}}return G4e(c,i)}}function G4e(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function I1t(e,t,i,r,s,n,o=!0){const a=t/s,l=i/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let y=0,v=0,w=0,b=0,S=0,T=0,E=0;const C=(p+.5)*l;for(let O=Math.floor(p*l);O<(p+1)*l;O++){const I=Math.abs(C-(O+.5))/h,N=(f+.5)*a,D=I*I;for(let z=Math.floor(f*a);z<(f+1)*a;z++){let B=Math.abs(N-(z+.5))/c;const k=Math.sqrt(D+B*B);k>=-1&&k<=1&&(y=2*k*k*k-3*k*k+1,y>0&&(B=4*(z+O*t),E+=y*e[B+3],w+=y,e[B+3]<255&&(y=y*e[B+3]/250),b+=y*e[B],S+=y*e[B+1],T+=y*e[B+2],v+=y))}}r[m]=b/v,r[m+1]=S/v,r[m+2]=T/v,r[m+3]=E/w}}function $1t(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function j4e(e){return e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices"}const D1t=e=>isNaN(e)||!e?0:e,L1t=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function N1t(){return import("./geometryEngineJSON.2762c1dd.js")}function nge(e,t,i,r){if(e.type!=="CIMTextSymbol"){if(i&&e.effects)for(const s of e.effects)W4e(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":H4e(s,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r==null?void 0:r.preserveOutlineWidth)&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":nge(s.lineSymbol,t,!0,ve(F({},r),{preserveOutlineWidth:!1})),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height*=t}function H4e(e,t,i){if(e.markerPlacement&&q4e(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,e.type==="CIMVectorMarker"&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||nge(r.symbol,t,!0,i)}function q4e(e,t){switch(j4e(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function W4e(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map(r=>r*t);e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}new B4e(1e3);new qe([128,128,128]);const QK=/\/resource\/(.*?)\.svg$/,X4e=new qe("white");function Y4e(e,t){const i=t.resource.href;return!he("esri-canvas-svg-support")&&e.styleOrigin&&QK.test(i)?i.replace(QK,"/resource/png/$1.png"):i}function Hw(e,t){if(!e)return null;let i=null;return YS(e)?i=Z4e(e):$4(e)&&(i=e.color?new qe(e.color):null),i?bO(i,t):null}function Z4e(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(r=>{r.type==="object"&&r.resource.href!=null||(i=r.type==="water"?r.color:_(r.material)?r.material.color:null)}),i?new qe(i):null}function bO(e,t){if(t==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new qe(i)}function Q4e(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{const o=_(n)?n:null;return bO(t=t||o||i!=null&&X4e,i)};r.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const o=_(n.material)?n.material.color:null,a=s(o);A(n.material)?n.material=new hu({color:a}):n.material.color=a,i!=null&&"outline"in n&&_(n.outline)&&_(n.outline.color)&&(n.outline.color=bO(n.outline.color,i))}})}function J4e(e,t,i){(t=t||e.color)&&(e.color=bO(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=bO(e.outline.color,i))}function s6(e,t,i){e&&(t||i!=null)&&(t&&(t=new qe(t)),YS(e)?Q4e(e,t,i):$4(e)&&J4e(e,t,i))}async function K4e(e,t){const i=e.symbolLayers;i&&await n5(i,async r=>e5e(r,t))}async function e5e(e,t){switch(e.type){case"extrude":i5e(e,t);break;case"icon":case"line":case"text":t5e(e,t);break;case"path":s5e(e,t);break;case"object":await r5e(e,t)}}function t5e(e,t){const i=oge(t);_(i)&&(e.size=i)}function oge(e){for(const t of e)if(typeof t=="number")return t;return null}function i5e(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function r5e(e,t){const{resourceSize:i,symbolSize:r}=await n5e(e),s=age(t,i,r);e.width=wR(t[0],r[0],i[0],s),e.depth=wR(t[1],r[1],i[1],s),e.height=wR(t[2],r[2],i[2],s)}function s5e(e,t){const i=age(t,mf,[e.width,void 0,e.height]);e.width=wR(t[0],e.width,1,i),e.height=wR(t[2],e.height,1,i)}function age(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return i[r]!=null?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function n5e(e){const t=await import("./symbolLayerUtils.18679bb7.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++)if(o[l]!=null){a=o[l]/i[l];break}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function wR(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function o5e(e,t){const i=oge(t);if(!A(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function a5e(e,t){if(e&&t)return YS(e)?K4e(e,t):void($4(e)&&o5e(e,t))}function l5e(e,t,i){if(e&&t!=null)if(YS(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else $4(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}const c5e="<",u5e=">",h5e=D4("short-date");function d5e(e,t,i,r){let s="";t===0?s=`${c5e} `:t===i&&(s=`${u5e} `);let n=null;return n=r?Mf(e,h5e):i4e(e),s+n}const p5e=new qe([64,64,64]);function f5e(e,t){const i=[],r=e.length-1;return e.length===5?i.push(0,2,4):i.push(0,r),e.map((s,n)=>i.includes(n)?d5e(s,n,r,t):null)}async function m5e(e,t,i){let r=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:f5e(s,i);return(await Promise.all(s.map(async(c,h)=>({value:c,color:e.type==="opacity"?await g5e(c,e,t):(await Promise.resolve().then(function(){return Zq})).getColor(e,c),label:r?n[h]:l[h]})))).reverse()}async function g5e(e,t,i=p5e){const r=new qe(i),s=(await Promise.resolve().then(function(){return Zq})).getOpacity(t,e);return s!=null&&(r.a=s),r}var pG;let _A=pG=class extends ye{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new pG({color:this.color,ratio:this.ratio})}};u([d({type:qe,json:{type:[Lr],default:null,write:!0}})],_A.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],_A.prototype,"ratio",void 0),_A=pG=u([P("esri.renderers.support.HeatmapColorStop")],_A);const xR=_A;function y5e(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=t.length-1;if(t&&t[0]){const r=t[i];r&&r.ratio!==1&&(t.push(new xR({ratio:1,color:r.color})),i++)}return t.map((r,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}fe.getLogger("esri.renderers.support.utils");function _c(e,t,i){$H(e,t,()=>[]).push(...i)}async function v5e(e){var i,r;const t=new Map;if("visualVariables"in e&&e.visualVariables){const s=e.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=n.field||n.valueExpression,a=(await m5e(n)).map(l=>l.color);_c(t,o,a)}}if(e.type==="heatmap"){const s=y5e(e).map(n=>n.color);_c(t,e.field,s)}else if(e.type==="pie-chart"){for(const s of e.attributes)_c(t,s.field,[s.color]);_c(t,null,[(i=e==null?void 0:e.othersCategory)==null?void 0:i.color,Hw(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const s of e.attributes)_c(t,s.field,[s.color]);_c(t,null,[e.backgroundColor])}else if(e.type==="unique-value")if(((r=e.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of e.uniqueValueInfos)_c(t,s.value.toString(),[Hw(s.symbol,null)]);else{const s=e.uniqueValueInfos.map(c=>Hw(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=e;(n||l)&&_c(t,n||l,s),o&&_c(t,o,s),a&&_c(t,a,s)}else if(e.type==="class-breaks"){const s=e.classBreakInfos.map(n=>Hw(n.symbol,null));_c(t,e.field||e.valueExpression,s)}else e.type==="simple"&&_c(t,null,[Hw(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&_c(t,null,[Hw(e.defaultSymbol,null)]),t.forEach((s,n)=>{const o=SM(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));t.set(n,o)}),t}var fG;let bA=fG=class extends ye{constructor(e){super(e),this.name=null,this.code=null}clone(){return new fG({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],bA.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],bA.prototype,"code",void 0),bA=fG=u([P("esri.layers.support.CodedValue")],bA);const _5e=new xi({inherited:"inherited",codedValue:"coded-value",range:"range"});let wA=class extends ye{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],wA.prototype,"name",void 0),u([ot(_5e)],wA.prototype,"type",void 0),wA=u([P("esri.layers.support.Domain")],wA);const d5=wA;var mG;let xA=mG=class extends d5{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new mG({codedValues:ie(this.codedValues),name:this.name})}};u([d({type:[bA],json:{write:!0}})],xA.prototype,"codedValues",void 0),u([ot({codedValue:"coded-value"})],xA.prototype,"type",void 0),xA=mG=u([P("esri.layers.support.CodedValueDomain")],xA);const lge=xA;var gG;let TD=gG=class extends d5{constructor(e){super(e),this.type="inherited"}clone(){return new gG}};u([ot({inherited:"inherited"})],TD.prototype,"type",void 0),TD=gG=u([P("esri.layers.support.InheritedDomain")],TD);const cge=TD;var yG;let tT=yG=class extends d5{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new yG({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],tT.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],tT.prototype,"minValue",void 0),u([ot({range:"range"})],tT.prototype,"type",void 0),tT=yG=u([P("esri.layers.support.RangeDomain")],tT);const uge=tT,hge={key:"type",base:d5,typeMap:{range:uge,"coded-value":lge,inherited:cge}};function ZW(e){if(!e||!e.type)return null;switch(e.type){case"range":return uge.fromJSON(e);case"codedValue":return lge.fromJSON(e);case"inherited":return cge.fromJSON(e)}return null}const b5e=new xi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var vG;const w5e=new xi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Wa=vG=class extends ye{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?w5e.fromJSON(i.fieldValueType):null}clone(){return new vG({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};u([d({type:String,json:{write:!0}})],Wa.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],Wa.prototype,"defaultValue",void 0),u([d()],Wa.prototype,"description",void 0),u([Pe("description")],Wa.prototype,"readDescription",null),u([d({types:hge,json:{read:{reader:ZW},write:!0}})],Wa.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Wa.prototype,"editable",void 0),u([d({type:Lr,json:{write:!0}})],Wa.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],Wa.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],Wa.prototype,"nullable",void 0),u([ot(b5e)],Wa.prototype,"type",void 0),u([d()],Wa.prototype,"valueType",void 0),u([Pe("valueType",["description"])],Wa.prototype,"readValueType",null),Wa=vG=u([P("esri.layers.support.Field")],Wa);const jM=Wa;var _G;let iT=_G=class extends ye{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new _G({mapLayerId:e,gdbVersion:t})}};u([ot({mapLayer:"map-layer"})],iT.prototype,"type",void 0),u([d({type:Lr,json:{write:!0}})],iT.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],iT.prototype,"gdbVersion",void 0),iT=_G=u([P("esri.layers.support.source.MapLayerSource")],iT);var bG;let Cm=bG=class extends ye{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:i,spatialReference:(o=r==null?void 0:r.clone())!=null?o:void 0,geometryType:s};return new bG(n)}};u([ot({queryTable:"query-table"})],Cm.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Cm.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Cm.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],Cm.prototype,"oidFields",void 0),u([d({type:Ke,json:{write:!0}})],Cm.prototype,"spatialReference",void 0),u([ot(Pue)],Cm.prototype,"geometryType",void 0),Cm=bG=u([P("esri.layers.support.source.QueryTableDataSource")],Cm);var wG;let rT=wG=class extends ye{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new wG({workspaceId:e,dataSourceName:t})}};u([ot({raster:"raster"})],rT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],rT.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],rT.prototype,"workspaceId",void 0),rT=wG=u([P("esri.layers.support.source.RasterDataSource")],rT);var xG;let c1=xG=class extends ye{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new xG({workspaceId:e,gdbVersion:t,dataSourceName:i})}};u([ot({table:"table"})],c1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],c1.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],c1.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],c1.prototype,"dataSourceName",void 0),c1=xG=u([P("esri.layers.support.source.TableDataSource")],c1);var TG,SG;const x5e=Ko()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Pc=TG=class extends ye{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return JK()(e,t,i)}castLeftTableSource(e){return tp(EG(),e)}readRightTableSource(e,t,i){return JK()(e,t,i)}castRightTableSource(e){return tp(EG(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=i==null?void 0:i.clone())!=null?o:void 0,rightTableSource:(a=r==null?void 0:r.clone())!=null?a:void 0,joinType:s};return new TG(n)}};u([ot({joinTable:"join-table"})],Pc.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Pc.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],Pc.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],Pc.prototype,"leftTableSource",void 0),u([Pe("leftTableSource")],Pc.prototype,"readLeftTableSource",null),u([jt("leftTableSource")],Pc.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],Pc.prototype,"rightTableSource",void 0),u([Pe("rightTableSource")],Pc.prototype,"readRightTableSource",null),u([jt("rightTableSource")],Pc.prototype,"castRightTableSource",null),u([ot(x5e)],Pc.prototype,"joinType",void 0),Pc=TG=u([P("esri.layers.support.source.JoinTableDataSource")],Pc);let n6=null;function JK(){return n6||(n6=X2({types:EG()})),n6}let o6=null;function EG(){return o6||(o6={key:"type",base:null,typeMap:{"data-layer":Ad,"map-layer":iT}}),o6}const T5e={key:"type",base:null,typeMap:{"join-table":Pc,"query-table":Cm,raster:rT,table:c1}};let Ad=SG=class extends ye{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new SG({fields:e,dataSource:t})}};u([ot({dataLayer:"data-layer"})],Ad.prototype,"type",void 0),u([d({type:[jM],json:{write:!0}})],Ad.prototype,"fields",void 0),u([d({types:T5e,json:{write:!0}})],Ad.prototype,"dataSource",void 0),Ad=SG=u([P("esri.layers.support.source.DataLayerSource")],Ad),Ad.from=Ds(Ad);function S5e(e,t){return t?ve(F({},t),{query:F(F({},e),t.query)}):{query:e}}function dge(e){return typeof e=="string"?Mn(e):ie(e)}function E5e(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=E5e(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=t?o:JSON.stringify(o)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}const bP={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new au({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ke.WebMercator}),minus180Line:new au({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:Ke.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new au({paths:[[[180,-180],[180,180]]],spatialReference:Ke.WGS84}),minus180Line:new au({paths:[[[-180,-180],[-180,180]]],spatialReference:Ke.WGS84})}};function ab(e,t){return Math.ceil((e-t)/(2*t))}function pge(e,t){const i=TR(e);for(const r of i)for(const s of r)s[0]+=t;return e}function TR(e){return _b(e)?e.rings:e.paths}async function C5e(e,t,i,r){const s=typeof e=="string"?Mn(e):e,n=t[0].spatialReference,o=ve(F({},r),{query:ve(F({},s.query),{f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:Z2(t[0]),geometries:t}),cutter:JSON.stringify(i)})}),a=await ai(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=Og(h);return p.spatialReference=n,p})}}async function A5e(e,t,i){const r=typeof e=="string"?Mn(e):e,s=t[0].spatialReference,n=Z2(t[0]),o=ve(F({},i),{query:ve(F({},r.query),{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(R5e(t))})});return O5e((await ai(r.path+"/simplify",o)).data,n,s)}function R5e(e){return{geometryType:Z2(e[0]),geometries:e.map(t=>t.toJSON())}}function O5e(e,t,i){const r=$ue(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}const fge=fe.getLogger("esri.geometry.support.normalizeUtils");function M5e(e){return e.type==="polygon"}function P5e(e){return e[0].type==="polygon"}function I5e(e){return e[0].type==="polyline"}function $5e(e,t){if(!(e instanceof au||e instanceof Ao)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw fge.error(s),new H(s)}const i=TR(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,y=p/t;if(y>1){for(let S=1;S<=y-1;S++){const T=S*t,E=m*T+a,C=f*T+l;n.push([E,C])}const v=(p+Math.floor(y-1)*t)/2,w=m*v+a,b=f*v+l;n.push([w,b])}n.push([c,h])}}return M5e(e)?new Ao({rings:r,spatialReference:e.spatialReference}):new au({paths:r,spatialReference:e.spatialReference})}function KK(e,t,i){if(t){const r=$5e(e,1e6);e=VC(r,!0)}return i&&(e=pge(e,i)),e}function eee(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=ab(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=ab(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=ab(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=ab(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function D5e(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=TR(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*ab(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===i){if(P5e(e))for(const a of TR(n))e[s]=e[s].addRing(a);else if(I5e(e))for(const a of TR(n))e[s]=e[s].addPath(a)}else i=s,e[s]=n}return e}async function mge(e,t,i){var E;if(!Array.isArray(e))return mge([e],t);t&&typeof t!="string"&&fge.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:(E=t==null?void 0:t.url)!=null?E:Di.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],y=[];for(const C of e)if(A(C))y.push(C);else if(s||(s=C.spatialReference,n=uv(s),o=s.isWebMercator,c=o?102100:4326,a=bP[c].maxX,l=bP[c].minX,h=bP[c].plus180Line,p=bP[c].minus180Line),n)if(C.type==="mesh")y.push(C);else if(C.type==="point")y.push(eee(C.clone(),a,l));else if(C.type==="multipoint"){const O=C.clone();O.points=O.points.map(I=>eee(I,a,l)),y.push(O)}else if(C.type==="extent"){const O=C.clone()._normalize(!1,!1,n);y.push(O.rings?new Ao(O):O)}else if(C.extent){const O=C.extent,I=ab(O.xmin,l)*(2*a);let N=I===0?C.clone():pge(C.clone(),I);O.offset(I,0),O.intersects(h)&&O.xmax!==a?(f=O.xmax>f?O.xmax:f,N=KK(N,o),m.push(N),y.push("cut")):O.intersects(p)&&O.xmin!==l?(f=O.xmax*(2*a)>f?O.xmax*(2*a):f,N=KK(N,o,360),m.push(N),y.push("cut")):y.push(N)}else y.push(C.clone());else y.push(C);let v=ab(f,a),w=-90;const b=v,S=new au;for(;v>0;){const C=360*v-180;S.addPath([[C,w],[C,-1*w]]),w*=-1,v--}if(m.length>0&&b>0){const C=D5e(m,await C5e(r,m,S,i)),O=[],I=[];for(let z=0;z<y.length;z++){const B=y[z];if(B!=="cut")I.push(B);else{const k=C.shift(),Y=e[z];_(Y)&&Y.type==="polygon"&&Y.rings&&Y.rings.length>1&&k.rings.length>=Y.rings.length?(O.push(k),I.push("simplify")):I.push(o?pg(k):k)}}if(!O.length)return I;const N=await A5e(r,O,i),D=[];for(let z=0;z<I.length;z++){const B=I[z];B!=="simplify"?D.push(B):D.push(o?pg(N.shift()):N.shift())}return D}const T=[];for(let C=0;C<y.length;C++){const O=y[C];if(O!=="cut")T.push(O);else{const I=m.shift();T.push(o===!0?pg(I):I)}}return T}function gge(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=gge(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}var E0;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(E0||(E0={}));const tee=4294967296,L5e=new TextDecoder("utf-8"),N5e=he("safari")||he("ios")?6:he("ff")?12:32;class Ab{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=E0.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}clone(){return new Ab(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*tee;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*tee;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),o=t(n,i,r,s);return n.release(),o}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=Ab.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){Ab.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case E0.varint:this._decodeVarint();break;case E0.fixed64:this._skip(8);break;case E0.delimited:this._skip(this._getLength());break;case E0.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i,r=this._pos,s=0;if(this._end-r>=10)do{if(i=t[r++],s|=127&i,(128&i)==0||(i=t[r++],s|=(127&i)<<7,(128&i)==0)||(i=t[r++],s|=(127&i)<<14,(128&i)==0)||(i=t[r++],s|=(127&i)<<21,(128&i)==0)||(i=t[r++],s+=268435456*(127&i),(128&i)==0)||(i=t[r++],s+=34359738368*(127&i),(128&i)==0)||(i=t[r++],s+=4398046511104*(127&i),(128&i)==0)||(i=t[r++],s+=562949953421312*(127&i),(128&i)==0)||(i=t[r++],s+=72057594037927940*(127&i),(128&i)==0)||(i=t[r++],s+=9223372036854776e3*(127&i),(128&i)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(i=t[r],(128&i)!=0);)++r,s+=(127&i)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=i*n}return this._pos=r,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==E0.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>N5e){const o=t.subarray(i,r);return L5e.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}Ab.pool=new vs(Ab,null,e=>{e._data=null,e._dataView=null});class pl{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}static fromRect(t){const[i,r,s,n]=t,o=s-i,a=n-r;return new pl([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new pl(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new pl(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class Lf{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new Lf(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function F5e(e){return!(A(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class F1t extends Lf{}class p5{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new p5;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const yge=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class U1t{constructor(t){this.options=t,this.geometryTypes=yge,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new p5}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||pc(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=JS(this.options.sourceSpatialReference)/JS(t.spatialReference);if(i!==1)for(const r of t.features){if(!F5e(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new Lf}createSpatialReference(){return{wkid:0}}createGeometry(){return new pl}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new pl}}const iee=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],ree=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],see=["upperLeft","lowerLeft"];function nee(e){return e>=iee.length?null:iee[e]}function U5e(e){return e>=ree.length?null:ree[e]}function oee(e){return e>=see.length?null:see[e]}function aee(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function k5e(e,t,i){const s=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),o=e.pos()+n;let a=0;for(;e.pos()<o;)t.addCoordinatePoint(s,e.getSInt64(),a++);break}default:e.skip()}return s}function z5e(e,t,i){const n=t.createGeometry(i),o=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(;e.pos()<l;)t.addLength(n,e.getUInt32(),c++);break}case 3:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),c++,c===o&&(c=0);break}default:e.skip()}return n}function B5e(e){const s=new pl;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.lengths.push(e.getUInt32());break}case 3:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.coords.push(e.getSInt64());break}case 1:n=yge[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function V5e(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function G5e(e){const a={type:nee(0)};for(;e.next();)switch(e.tag()){case 1:a.name=e.getString();break;case 2:a.type=nee(e.getEnum());break;case 3:a.alias=e.getString();break;case 4:a.sqlType=U5e(e.getEnum());break;case 5:e.skip();break;case 6:a.defaultValue=e.getString();break;default:e.skip()}return a}function j5e(e){const r={};for(;e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.isSystemMaintained=e.getBool();break;default:e.skip()}return r}function H5e(e,t,i,r){const a=t.createFeature(i);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=r[l++].name;a.attributes[c]=e.processMessage(V5e);break}case 2:a.geometry=e.processMessageWithArgs(z5e,t,i);break;case 4:a.centroid=e.processMessageWithArgs(k5e,t,i);break;default:e.skip()}return a}function q5e(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function W5e(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function X5e(e){const s={originPosition:oee(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=oee(e.getEnum());break;case 2:s.scale=e.processMessage(q5e);break;case 3:s.translate=e.processMessage(W5e);break;default:e.skip()}return s}function Y5e(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function Z5e(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function Q5e(e,t){const v=t.createFeatureResult();v.geometryType=aee(t,0);let w=!1;for(;e.next();)switch(e.tag()){case 1:v.objectIdFieldName=e.getString();break;case 3:v.globalIdFieldName=e.getString();break;case 4:v.geohashFieldName=e.getString();break;case 5:v.geometryProperties=e.processMessage(Y5e);break;case 7:v.geometryType=aee(t,e.getEnum());break;case 8:v.spatialReference=e.processMessageWithArgs(Z5e,t);break;case 10:v.hasZ=e.getBool();break;case 11:v.hasM=e.getBool();break;case 12:v.transform=e.processMessage(X5e);break;case 9:{const b=e.getBool();v.exceededTransferLimit=b;break}case 13:t.addField(v,e.processMessage(G5e));break;case 15:w||(t.prepareFeatures(v),w=!0),t.addFeature(v,e.processMessageWithArgs(H5e,t,v,v.fields));break;case 2:v.uniqueIdField=e.processMessage(j5e);break;default:e.skip()}return t.finishFeatureResult(v),v}function J5e(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(B5e);break;case 1:s.featureResult=e.processMessageWithArgs(Q5e,t);break;default:e.skip()}return _(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function K5e(e,t){try{const r=new Ab(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(J5e,t):r.skip();return s}catch(i){throw new H("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function eUe(e,t){const i=K5e(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function CG(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=Mpe(i.geometryType,t,e.outSpatialReference);if(!A(r))for(const s of i.features)r(s.geometry)}const lee="Layer does not support extent calculation.";function vge(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function _ge(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(_(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=Z2(i),s.geometry=vge(i,e.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&_(o)&&_(e.quantizationParameters)&&_(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c==null?"null":c},${h==null?"null":h}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&_(o)&&_(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function bge(e,t,i,r){const s=_(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await lE(e,t,"json",r);return CG(t,i,s.data),s}async function tUe(e,t,i,r){if(_(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await wge(e,t,r),n=s;return n.data=eUe(s.data,i),n}function wge(e,t,i){return lE(e,t,"pbf",i)}function iUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):lE(e,t,"json",i,{returnIdsOnly:!0})}function rUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):lE(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function sUe(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):lE(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(lee);if(s.hasOwnProperty("count"))throw new Error(lee);return r})}function lE(e,t,i,r={},s={}){const n=typeof e=="string"?Mn(e):e,o=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",mge(o,null,r).then(a=>{const l=a&&a[0];_(l)&&((t=t.clone()).geometry=l);const c=gge(F(F(ve(F({},n.query),{f:i}),s),_ge(t,s)));return ai(vl(n.path,"query"),ve(F({},r),{query:F(F({},c),r.query)}))})}var k1t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",encodeGeometry:vge,executeQuery:bge,executeQueryForCount:rUe,executeQueryForExtent:sUe,executeQueryForIds:iUe,executeQueryPBF:tUe,executeQueryPBFBuffer:wge,queryToQueryStringParameters:_ge,runQuery:lE}),AG;const RG=new xi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let fo=AG=class extends ye{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const i=Ke.fromJSON(t.spatialReference),r=[];for(let n=0;n<e.length;n++){const o=e[n],a=Pa.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;_(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&_(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;_(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(e,t,i,r){if(e)return void RG.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&_(n.geometry))return void RG.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=Og(e);return!i&&t.spatialReference&&(r.spatialReference=Ke.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&_(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new AG(this.cloneProperties())}cloneProperties(){return ie({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=c=>Math.round((c-r)/t),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)_(h)&&c(h);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=t(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=_b(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,i);c&&n.push(c)}return n.length>0?(_b(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=_b(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=i(o)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=i(o)}}:void 0}};u([d({type:String,json:{write:!0}})],fo.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],fo.prototype,"exceededTransferLimit",void 0),u([d({type:[Pa],json:{write:!0}})],fo.prototype,"features",void 0),u([Pe("features")],fo.prototype,"readFeatures",null),u([d({type:[jM],json:{write:!0}})],fo.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:RG.read}}})],fo.prototype,"geometryType",void 0),u([He("geometryType")],fo.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],fo.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],fo.prototype,"hasZ",void 0),u([d({types:Tw,json:{write:!0}})],fo.prototype,"queryGeometry",void 0),u([Pe("queryGeometry")],fo.prototype,"readQueryGeometry",null),u([d({type:Ke,json:{write:!0}})],fo.prototype,"spatialReference",void 0),u([He("spatialReference")],fo.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],fo.prototype,"transform",void 0),fo=AG=u([P("esri.rest.support.FeatureSet")],fo),fo.prototype.toJSON.isDefaultToJSON=!0;const f5=fo;var z1t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:f5});const cee={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},nUe={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function oUe(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function Rb(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=nUe[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=oUe(r.getFullYear(),r.getMonth()+t);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+t*a)}return r}function uee(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function aUe(e,t,i){return e===0?0:e*cee[t]/cee[i]}var hd;let Vc=hd=class extends ye{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return hee}static get empty(){return lUe}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(hd.allTime)}get isEmpty(){return this.equals(hd.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new hd({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=_(this.start)?this.start.getTime():this.start,i=_(this.end)?this.end.getTime():this.end,r=_(e.start)?e.start.getTime():e.start,s=_(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=qs(this.start,r=>uee(r,e)),i=qs(this.end,r=>Rb(uee(r,e),1,e));return new hd({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return hd.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Kc(this.start,-1/0,a=>a.getTime()),i=Kc(this.end,1/0,a=>a.getTime()),r=Kc(e.start,-1/0,a=>a.getTime()),s=Kc(e.end,1/0,a=>a.getTime());let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),!isNaN(n)&&!isNaN(o)){const a=new hd;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return hd.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new hd,{start:r,end:s}=this;return _(r)&&(i.start=Rb(r,e,t)),_(s)&&(i.end=Rb(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return hee.clone();const t=_(this.start)&&_(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=_(this.end)&&_(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new hd({start:t,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],Vc.prototype,"end",void 0),u([Pe("end")],Vc.prototype,"readEnd",null),u([He("end")],Vc.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],Vc.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],Vc.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],Vc.prototype,"start",void 0),u([Pe("start")],Vc.prototype,"readStart",null),u([He("start")],Vc.prototype,"writeStart",null),Vc=hd=u([P("esri.TimeExtent")],Vc);const hee=new Vc,lUe=new Vc({start:void 0,end:void 0}),qf=Vc;var OG;const dee=new xi({upperLeft:"upper-left",lowerLeft:"lower-left"});let u1=OG=class extends ye{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new OG(ie({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:ri,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],u1.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],u1.prototype,"mode",void 0),u([d({type:String,json:{read:dee.read,write:dee.write}})],u1.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],u1.prototype,"tolerance",void 0),u1=OG=u([P("esri.rest.support.QuantizationParameters")],u1);const cUe=u1;var MG;const pee=new xi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let dd=MG=class extends ye{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=ie(e))}clone(){return new MG({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ie(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],dd.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],dd.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],dd.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],dd.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],dd.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:pee.read},write:{target:"statisticType",writer:pee.write}}})],dd.prototype,"statisticType",void 0),u([d({type:Object})],dd.prototype,"statisticParameters",void 0),u([He("statisticParameters")],dd.prototype,"writeStatisticParameters",null),dd=MG=u([P("esri.rest.support.StatisticDefinition")],dd);const xge=dd;var vS;const uUe=new xi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),hUe=new xi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let At=vS=class extends ye{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return LS(vS,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new vS(ie({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:_(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};At.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],At.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],At.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],At.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],At.prototype,"datumTransformation",void 0),u([jt("datumTransformation")],At.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],At.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],At.prototype,"distance",void 0),u([d({type:Ad,json:{write:!0}})],At.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],At.prototype,"formatOf3DObjects",void 0),u([d({type:String,json:{write:!0}})],At.prototype,"gdbVersion",void 0),u([d({types:Tw,json:{read:Og,write:!0}})],At.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],At.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],At.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],At.prototype,"having",void 0),u([d({type:Date})],At.prototype,"historicMoment",void 0),u([He("historicMoment")],At.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],At.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>vS.MAX_MAX_RECORD_COUNT_FACTOR?vS.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],At.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],At.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],At.prototype,"num",void 0),u([d({json:{write:!0}})],At.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],At.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],At.prototype,"outFields",void 0),u([d({type:Ke,json:{name:"outSR",write:!0}})],At.prototype,"outSpatialReference",void 0),u([d({type:[xge],json:{write:{enabled:!0,overridePolicy(){return{enabled:_(this.outStatistics)&&this.outStatistics.length>0}}}}})],At.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],At.prototype,"parameterValues",void 0),u([He("parameterValues")],At.prototype,"writeParameterValues",null),u([d({type:nt,json:{write:!0}})],At.prototype,"pixelSize",void 0),u([d({type:cUe,json:{write:!0}})],At.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],At.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],At.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],At.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],At.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],At.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],At.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],At.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],At.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],At.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],At.prototype,"returnZ",void 0),u([d({type:Ke,json:{write:!0}})],At.prototype,"sourceSpatialReference",void 0),u([ot(uUe,{ignoreUnknown:!1,name:"spatialRel"})],At.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],At.prototype,"start",void 0),u([He("start"),He("num")],At.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],At.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],At.prototype,"text",void 0),u([d({type:qf,json:{write:!0}})],At.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],At.prototype,"timeReferenceUnknownClient",void 0),u([ot(hUe,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],At.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],At.prototype,"where",void 0),u([He("where")],At.prototype,"writeWhere",null),At=vS=u([P("esri.rest.support.Query")],At);const _h=At;async function a6(e,t,i){const r=await dUe(e,t,i);return f5.fromJSON(r)}async function dUe(e,t,i){const r=dge(e),s=F({},i),n=_h.from(t),{data:o}=await bge(r,n,n.sourceSpatialReference,s);return o}function Jo(e,t){return e?t?4:3:t?3:2}const HM=fe.getLogger("esri.layers.graphics.featureConversionUtils"),Tge={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},Sge=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},kN=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},pUe=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},Ege=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function QW(e,t,i,r){if(e){if(i)return t&&r?Ege:kN;if(t&&r)return pUe}else if(t&&r)return kN;return Sge}function l6({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function c6({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function fee({scale:e,translate:t},i){return i*e[0]+t[0]}function mee({scale:e,translate:t},i){return t[1]-i*e[1]}function B1t(e,t,i){return e?t?i?eX(e):JW(e):i?KW(e):m5(e):null}function m5(e){const t=e.coords;return{x:t[0],y:t[1]}}function Cge(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function JW(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function fUe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function KW(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function mUe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function eX(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function gUe(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function yUe(e,t,i,r){let s=m5;i&&r?s=eX:i?s=JW:r&&(s=KW);for(const n of t){const{geometry:o,attributes:a}=n,l=_(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function tX(e,t){return e&&t?gUe:e?fUe:t?mUe:Cge}function vUe(e,t,i,r,s){const n=tX(i,r);for(const o of t){const{geometry:a,attributes:l}=o;let c;a&&(c=n(new pl,a)),e.push(new Lf(c,l,null,l[s]))}return e}function V1t(e,t,i=tX(t.z!=null,t.m!=null)){return i(e,t)}function _Ue(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;n&&(a=Age(n,i,r)),e.push({attributes:o,geometry:a})}return e}function Age(e,t,i){if(A(e))return null;const r=Jo(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(e.coords[n+a]);s.push(o)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function bUe(e,t,i,r,s){const n=Jo(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=Rge(new pl,a,n)),e.push(new Lf(c,l,null,l[s]))}return e}function Rge(e,t,i=Jo(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let o=0;o<i;o++)r[s++]=n[o];return e}function wUe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;_(n)&&(a=Oge(n,i,r)),e.push({attributes:o,geometry:a})}return e}function Oge(e,t,i){if(!e)return null;const r=Jo(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function xUe(e,t,i,r,s){const n=Jo(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=Mge(new pl,a,n)),e.push(new Lf(c,l,null,l[s]))}return e}function Mge(e,t,i=Jo(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return e}function TUe(e,t,i,r){for(const s of t){const{geometry:n,attributes:o,centroid:a}=s;let l;if(_(n)&&(l=Pge(n,i,r)),_(a)){const c=m5(a);e.push({attributes:o,centroid:c,geometry:l})}else e.push({attributes:o,geometry:l})}return e}function Pge(e,t,i){if(!e)return null;const r=Jo(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function SUe(e,t,i,r,s){for(const n of t){const o=n.geometry,a=n.centroid,l=n.attributes;let c;o&&(c=Ige(new pl,o,i,r)),_(a)?e.push(new Lf(c,l,Cge(new pl,a),l[s])):e.push(new Lf(c,l,null,l[s]))}return e}function Ige(e,t,i=t.hasZ,r=t.hasM){return EUe(e,t.rings,i,r),e}function EUe(e,t,i,r){const s=Jo(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const _S=[],SR=[];function G1t(e,t,i,r,s){_S[0]=e;const[n]=$ge(SR,_S,t,i,r,s);return _S.length=SR.length=0,n}function $ge(e,t,i,r,s,n){if(e.length=0,!i){for(const o of t){const a=o.attributes[n];e.push(new Lf(null,o.attributes,null,a))}return e}switch(i){case"esriGeometryPoint":return vUe(e,t,r,s,n);case"esriGeometryMultipoint":return bUe(e,t,r,s,n);case"esriGeometryPolyline":return xUe(e,t,r,s,n);case"esriGeometryPolygon":return SUe(e,t,r,s,n);default:HM.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function j1t(e,t,i,r){SR[0]=e,Dge(_S,SR,t,i,r);const s=_S[0];return _S.length=SR.length=0,s}function CUe(e,t,i){if(A(e))return null;const r=new pl;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),iq(e)?tX(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):_b(e)?Ige(r,e,t,i):rq(e)?Mge(r,e,Jo(t,i)):tq(e)?Rge(r,e,Jo(t,i)):void HM.error("convertFromGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${e}'`))}function AUe(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(A(s))return null;switch(t){case"esriGeometryPoint":{let n=m5;return i&&r?n=eX:i?n=JW:r&&(n=KW),n(s)}case"esriGeometryMultipoint":return Age(s,i,r);case"esriGeometryPolyline":return Oge(s,i,r);case"esriGeometryPolygon":return Pge(s,i,r);default:return void HM.error("convertToGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${t}'`))}}function RUe(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function Dge(e,t,i,r,s){if(e.length=0,A(i))return RUe(e,t);switch(i){case"esriGeometryPoint":return yUe(e,t,r,s);case"esriGeometryMultipoint":return _Ue(e,t,r,s);case"esriGeometryPolyline":return wUe(e,t,r,s);case"esriGeometryPolygon":return TUe(e,t,r,s);default:HM.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${i}'`))}return e}function H1t(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,m={features:Dge([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:h,queryGeometry:AUe(p,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function q1t(e,t){const i=new p5,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(i.fields=p),i.geometryType=l,i.objectIdFieldName=o||t,i.spatialReference=a,i.objectIdFieldName?(n&&$ge(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(HM.error(new H("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function W1t(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)_(n.geometry)&&yee(n.geometry,n.geometry,r,s,t),_(n.centroid)&&yee(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function X1t(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new pl,gee(l.geometry,a.geometry,s,n,i,e),a.centroid&&(l.centroid=new pl,gee(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),r[o]=l}return t.transform=e,t}function gee(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),A(t)||!t.coords.length)return null;const l=Tge[s],{coords:c,lengths:h}=t,p=Jo(i,r),f=Jo(i&&o,r&&a),m=QW(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,l6(n,c[0]),c6(n,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y,v,w,b,S=0,T=0,E=T;for(const C of h){if(C<l)continue;let O=0;T=E,w=y=l6(n,c[S]),b=v=c6(n,c[S+1]),m(e.coords,c,T,S,w,b),O++,S+=p,T+=f;for(let I=1;I<C;I++,S+=p)w=l6(n,c[S]),b=c6(n,c[S+1]),w===y&&b===v||(m(e.coords,c,T,S,w-y,b-v),T+=f,O++,y=w,v=b);O>=l&&(e.lengths.push(O),E=T)}return e.coords.length=E,e.coords.length?e:null}function Y1t(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=Tge[s],{coords:c,lengths:h}=t,p=Jo(i,r),f=Jo(i&&o,r&&a),m=QW(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y=0;const v=n*n;for(const w of h){if(w<l){y+=w*p;continue}const b=e.coords.length/f,S=y,T=y+(w-1)*p;m(e.coords,c,e.coords.length,S,c[S],c[S+1]),PG(e.coords,c,p,v,m,S,T),m(e.coords,c,e.coords.length,T,c[T],c[T+1]);const E=e.coords.length/f-b;E>=l?e.lengths.push(E):e.coords.length=b*f,y+=w*p}return e.coords.length?e:null}function OUe(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function PG(e,t,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=OUe(t,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&PG(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&PG(e,t,i,r,s,c,o))}function Z1t(e,t,i,r){if(A(t)||!t.coords||!t.coords.length)return null;const s=Jo(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function yee(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?Ege:kN:r?kN:Sge,l=Jo(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,fee(s,n[0]),mee(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let p=0;for(let f=0;f<o.length;f++){const m=o[f];e.lengths[f]=m;let y=fee(s,n[p]),v=mee(s,n[p+1]);a(e.coords,n,p,p,y,v),p+=l;for(let w=1;w<m;w++,p+=l)y+=n[p]*c,v-=n[p+1]*h,a(e.coords,n,p,p,y,v)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function Q1t(e,t,i,r,s,n){const o=Jo(i,r),a=QW(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function MUe(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const l=n+e[r*(t+a)],c=o+e[r*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function J1t(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++)n+=MUe(i,s,r[o],t),s+=o;return Math.abs(n)}function K1t(e,t){if(A(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[t*n],c=r[t*n+1];for(let h=1;h<a;h++){const p=l+r[t*(n+h)],f=c+r[t*(n+h)+1];i.coords[t*(n+h)]=p,i.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return i}var IG;let hs=IG=class extends ye{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new IG(ie({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],hs.prototype,"cacheHint",void 0),u([d({type:Ad,json:{write:!0}})],hs.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],hs.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],hs.prototype,"geometryPrecision",void 0),u([d({type:Date})],hs.prototype,"historicMoment",void 0),u([He("historicMoment")],hs.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],hs.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],hs.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],hs.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],hs.prototype,"outFields",void 0),u([d({type:Ke,json:{read:{source:"outSR"},write:{target:"outSR"}}})],hs.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],hs.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],hs.prototype,"start",void 0),u([He("start"),He("num")],hs.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],hs.prototype,"num",void 0),u([d({json:{write:!0}})],hs.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],hs.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],hs.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],hs.prototype,"where",void 0),hs=IG=u([P("esri.rest.support.RelationshipQuery")],hs),hs.from=Ds(hs);const $G=hs;var DG;let sT=DG=class extends ye{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new DG({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],sT.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],sT.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],sT.prototype,"orderByFields",void 0),sT=DG=u([P("esri.rest.support.TopFilter")],sT);const PUe=sT;var LG;const vee=new xi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),_ee=new xi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Wr=LG=class extends ye{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new LG(ie({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],Wr.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Wr.prototype,"distance",void 0),u([d({types:Tw,json:{read:Og,write:!0}})],Wr.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Wr.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],Wr.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Wr.prototype,"num",void 0),u([d({json:{write:!0}})],Wr.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Wr.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Wr.prototype,"outFields",void 0),u([d({type:Ke,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Wr.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],Wr.prototype,"resultType",void 0),u([d({json:{write:!0}})],Wr.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Wr.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Wr.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Wr.prototype,"start",void 0),u([He("start"),He("num")],Wr.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:vee.read},write:{target:"spatialRel",writer:vee.write}}})],Wr.prototype,"spatialRelationship",void 0),u([d({type:qf,json:{write:!0}})],Wr.prototype,"timeExtent",void 0),u([d({type:PUe,json:{write:!0}})],Wr.prototype,"topFilter",void 0),u([d({type:String,json:{read:_ee.read,write:{writer:_ee.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Wr.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],Wr.prototype,"where",void 0),Wr=LG=u([P("esri.rest.support.TopFeaturesQuery")],Wr),Wr.from=Ds(Wr);const wP=Wr,IUe="esri.widgets.Feature.support.relatedFeatureUtils",bee=fe.getLogger(IUe),wee=new Map;function NG(e){if(!og(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function $Ue(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function DUe({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===e.id&&(r=s),!!r)),r}function LUe(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function NUe(e,t){const i=$Ue(e,t);if(!!i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function FUe(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function UUe(e,t,i,r){const s=new $G;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}function kUe(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function zUe(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t,p=DUe({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await UUe(e,p,i,r))[e.attributes[i.objectIdField]];if(!m)return null;const y=m.features.map(v=>v.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const v=new _h;v.where=kUe(n.objectIdField,y,1e3),v.outFields=a,v.outStatistics=l,v.sourceSpatialReference=h;const w={features:Promise.resolve(m),statsFeatures:a6(c,v)};return Zo(w)}}const f=p==null?void 0:p.keyField;if(f){const m=g4(HUe(n.fields,f)),y=LUe(e.attributes,o.keyField),v=m?`${f}=${y}`:`${f}='${y}'`,w=a6(c,new _h({where:v,outFields:t.relatedFields,sourceSpatialReference:h}),r),b=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?a6(c,new _h({where:v,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),r):null,S={features:w};return b&&(S.statsFeatures=b),Zo(S)}return null}function BUe(e,t){return ai(e,{query:{f:"json"},signal:t&&t.signal})}function VUe({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new H("relation-required","A relation is required on a layer to retrieve related records.");throw bee.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new H("A related table ID is required on a layer to retrieve related records.");throw bee.error(p),p}const l=`${t.url}/${a}`,c=wee.get(l),h=c||BUe(l,i);c||wee.set(l,h),r[n]=h}),Zo(r)}function GUe({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=zUe(e,n,i,r))}),Zo(s)}function jUe({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new xge({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}function HUe(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const xee={chartAnimation:!0};let Un=class extends Ee{constructor(e){super(e),this.abilities=F({},xee),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return F(F({},xee),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=ob({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.title}),a.caption=ob({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.caption}),a.altText=ob({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:i,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:i,layer:n}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const a=dG(o,s);i.sourceURL=hG({formattedAttributes:r,template:a,fieldInfoMap:t})}if(n){const a=dG(n,s);i.linkURL=hG({formattedAttributes:r,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=fFe(l,n),c&&(t.normalizeField=FN(c,n)),!l.some(p=>!!(r[p]!=null||og(p)&&a.size)))return;const h=o==null?void 0:o.fieldInfos;l.forEach(p=>{if(og(p))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:p,formattedAttributes:r,chartType:s,value:t})]);const f=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:p,fieldInfos:h});t.series.push(f)})}_getRelatedChartInfos(e){var y;const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n}=e,o=[],a=NG(i),{layerId:l,fieldName:c}=a,h=(y=this.relatedInfos)==null?void 0:y.get(l.toString());if(!h)return o;const{relatedFeatures:p,relation:f}=h;if(!f||!p)return o;const{cardinality:m}=f;return p.forEach(v=>{const{attributes:w}=v;w&&Object.keys(w).forEach(b=>{b===c&&o.push(this._getChartOption({value:n,attributes:w,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:b,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var T,E,C,O,I,N;const{value:t,attributes:i,formattedAttributes:r,fieldName:s,relatedFieldName:n,fieldInfos:o,chartType:a}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:h,tooltipField:p}=t,f=h?og(h)?i[NG(h).fieldName]:i[h]:null,m=n&&i[n]!==void 0?i[n]:i[s]!==void 0?i[s]:r[s],y=new Pde({fieldName:s,value:m===void 0?null:m&&f?m/f:m});if(og(s)){const D=c.get(s.toLowerCase()),z=c.get(p.toLowerCase()),B=(T=D==null?void 0:D.fieldName)!=null?T:s,k=(I=(O=(C=r[(E=z==null?void 0:z.fieldName)!=null?E:p])!=null?C:D==null?void 0:D.label)!=null?O:D==null?void 0:D.fieldName)!=null?I:n,Y=r[B];return y.tooltip=this._getTooltip({label:k,value:Y,chartType:a}),y}const v=qme(o,s),w=FN(s,l),b=p&&r[p]!==void 0?r[p]:jme(v||new FM({fieldName:w}),(N=this.popupTemplate)==null?void 0:N.expressionInfos),S=r[w];return y.tooltip=this._getTooltip({label:b,value:S,chartType:a}),y}};u([d()],Un.prototype,"abilities",void 0),u([jt("abilities")],Un.prototype,"castAbilities",null),u([d()],Un.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Un.prototype,"activeMediaInfo",null),u([d()],Un.prototype,"attributes",void 0),u([d()],Un.prototype,"description",void 0),u([d()],Un.prototype,"fieldInfoMap",void 0),u([d()],Un.prototype,"formattedAttributes",void 0),u([d()],Un.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Un.prototype,"formattedMediaInfos",null),u([d()],Un.prototype,"layer",void 0),u([d({readOnly:!0})],Un.prototype,"formattedMediaInfoCount",null),u([d()],Un.prototype,"mediaInfos",void 0),u([d()],Un.prototype,"popupTemplate",void 0),u([d()],Un.prototype,"relatedInfos",void 0),u([d()],Un.prototype,"title",void 0),Un=u([P("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Un);const lb=Un;var Tee=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],qUe=[].concat(Tee.slice(30,39),Tee.slice(28,30).reverse()),WUe=[{name:"default",colors:qUe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const See="en-us",iX=new Map([["ar",()=>import("./ar.be766ed0.js").then(e=>e.a)],["bg-bg",()=>import("./bg_BG.bab8dfd0.js").then(e=>e.b)],["bs-ba",()=>import("./bs_BA.1b9824a4.js").then(e=>e.b)],["ca-es",()=>import("./ca_ES.35c0cd53.js").then(e=>e.c)],["cs-cz",()=>import("./cs_CZ.2fa13e3f.js").then(e=>e.c)],["da-dk",()=>import("./da_DK.a523c83a.js").then(e=>e.d)],["de-de",()=>import("./de_DE.4fd2dbc8.js").then(e=>e.d)],["de-ch",()=>import("./de_CH.aca36460.js").then(e=>e.d)],["el-gr",()=>import("./el_GR.7aad1c64.js").then(e=>e.e)],["en-us",()=>import("./en_US.017ec516.js").then(e=>e.e)],["en-ca",()=>import("./en_CA.b5bedc87.js").then(e=>e.e)],["es-es",()=>import("./es_ES.dfb758e4.js").then(e=>e.e)],["et-ee",()=>import("./et_EE.a0925f4d.js").then(e=>e.e)],["fi-fi",()=>import("./fi_FI.68f45eaf.js").then(e=>e.f)],["fr-fr",()=>import("./fr_FR.936fbd5a.js").then(e=>e.f)],["he-il",()=>import("./he_IL.e56dfb3f.js").then(e=>e.h)],["hr-hr",()=>import("./hr_HR.f1730d22.js").then(e=>e.h)],["hu-hu",()=>import("./hu_HU.d767ed50.js").then(e=>e.h)],["id-id",()=>import("./id_ID.fd08b2a1.js").then(e=>e.i)],["it-it",()=>import("./it_IT.f362fe4c.js").then(e=>e.i)],["ja-jp",()=>import("./ja_JP.240491be.js").then(e=>e.j)],["ko-kr",()=>import("./ko_KR.07c99fba.js").then(e=>e.k)],["lt-lt",()=>import("./lt_LT.4c68cc17.js").then(e=>e.l)],["lv-lv",()=>import("./lv_LV.980df2ef.js").then(e=>e.l)],["nb-no",()=>import("./nb_NO.042d3087.js").then(e=>e.n)],["nl-nl",()=>import("./nl_NL.4c054a47.js").then(e=>e.n)],["pl-pl",()=>import("./pl_PL.4a226306.js").then(e=>e.p)],["pt-br",()=>import("./pt_BR.be8b8b4e.js").then(e=>e.p)],["pt-pt",()=>import("./pt_PT.c0ae0d69.js").then(e=>e.p)],["ro-ro",()=>import("./ro_RO.e052e0b1.js").then(e=>e.r)],["ru-ru",()=>import("./ru_RU.7e786f26.js").then(e=>e.r)],["sk-sk",()=>import("./sk_SK.ebf757f5.js").then(e=>e.s)],["sl-sl",()=>import("./sl_SL.1e979ea3.js").then(e=>e.s)],["sr-rs",()=>import("./sr_RS.ec0065e6.js").then(e=>e.s)],["sv-se",()=>import("./sv_SE.30db8686.js").then(e=>e.s)],["th-th",()=>import("./th_TH.5fc2868a.js").then(e=>e.t)],["tr-tr",()=>import("./tr_TR.179c22bf.js").then(e=>e.t)],["uk-ua",()=>import("./uk_UA.fc93a0d8.js").then(e=>e.u)],["vi-vn",()=>import("./vi_VN.76809a28.js").then(e=>e.v)],["zh-cn",()=>import("./zh_Hans.ec013246.js").then(e=>e.z)],["zh-hk",()=>import("./zh_Hant.b202ee8b.js").then(e=>e.z)],["zh-tw",()=>import("./zh_Hant.b202ee8b.js").then(e=>e.z)]]);function XUe(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of iX.keys())if(r.startsWith(t)){i=r;break}return i}function YUe(e){return e?iX.has(e.toLowerCase())?e.toLowerCase():XUe(e)||See:See}let qw,zE;async function ZUe(e=du()){if(e=YUe(e),qw&&e===zE)return qw;qw=import("./index.d1c1a64b.js").then(t=>t.i),zE=e;try{const[t,i]=await Promise.all([qw,iX.get(zE)()]);zE===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return qw=null,zE=null,null}return qw}function QUe(e,t="default"){const i=WUe.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const ws={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},u6=.05,h6=.95,d6=15,im="color",uy="tooltip",BE="value",Eee="default-line-value";let Ll=class extends $a{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new lb,this.messages=null,this._getChartDependencies=async i=>{const r=await ZUe(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(r);this._renderChart({chartDiv:i,mediaInfo:o,chartsModule:r,colorMap:a})}}initialize(){this._featureElementInfo=new GW,this.own([ae(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Ft),ae(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Ft)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return ce("div",{bind:this,class:ws.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?ce("div",{key:"media-element-container",class:ws.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=Vme(h)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,y=m?m.timestamp:0,v=m?m.sourceURL:c,w=ce("img",{alt:o||a,key:`media-${l}-${i}-${r}-${y}`,src:v});return(h?ce("a",{title:a,href:h,rel:f,target:p},w):null)||w}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return ce("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:ws.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?ce("div",{key:"media-title",class:ws.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?ce("div",{key:"media-caption",class:ws.mediaItemCaption,innerHTML:e.caption}):null;return ce("div",{key:"media-container",class:ws.mediaItemContainer},ce("div",{key:"media-item-container",class:ws.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(ws.mediaButton,ws.mediaPrevious):this.classes(ws.mediaButton,ws.mediaNext),s=t?this.classes(ws.mediaIcon,ws.mediaPreviousIconLTR,ws.iconLeftTriangleArrow):this.classes(ws.mediaIcon,ws.mediaNextIconLTR,ws.iconRightTriangleArrow),n=t?this.classes(ws.mediaIcon,ws.mediaPreviousIconRTL,ws.iconRightTriangleArrow):this.classes(ws.mediaIcon,ws.mediaNextIconRTL,ws.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return ce("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},ce("span",{"aria-hidden":"true",class:s}),ce("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var n;const{am4core:t}=e,i=(n=this.viewModel)==null?void 0:n.layer,r=new Map;if(!i)return r;const s=await v5e(i.renderer);return s.delete(null),Array.from(s.values()).every(o=>(o==null?void 0:o.length)===1)&&(r.set(Eee,t.color({r:50,g:50,b:50,a:1})),Array.from(s.keys()).forEach(o=>{o&&r.set(o,t.color(s.get(o)[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=U1(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=i,c=QUe(l);function h(m){m instanceof l.ColorSet&&c&&(m.list=c)}Kme()&&l.useTheme(i.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme(h);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[uy]:m.tooltip,[BE]:m.value,[im]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=ev(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=BE,o.dataFields.category=uy,this._customizeChartTooltip(o.tooltip,r),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",o.slices.template.propertyFields.fill=im,o.slices.template.propertyFields.stroke=im,n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=uy,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=u6,l.renderer.maxLabelPosition=h6,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueY=BE,h.dataFields.categoryX=uy,h.columns.template.propertyFields.fill=im,h.columns.template.propertyFields.stroke=im,e.cursor=new o.XYCursor,s.series.length>d6&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=uy,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=u6,l.renderer.maxLabelPosition=h6,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueX=BE,h.dataFields.categoryY=uy,h.columns.template.propertyFields.fill=im,h.columns.template.propertyFields.stroke=im,e.cursor=new o.XYCursor,s.series.length>d6&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r,colorMap:s}=t,{value:n}=r,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=uy,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new a.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=u6,c.renderer.maxLabelPosition=h6,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),h.wrap=!0;const p=e.series.push(new a.LineSeries);p.dataFields.categoryX=uy,p.dataFields.valueY=BE,p.strokeWidth=1;const f=s.get(Eee);f&&(p.stroke=f);const m=p.bullets.push(new a.CircleBullet);m.propertyFields.fill=im,m.propertyFields.stroke=im,e.cursor=new a.XYCursor,n.series.length>d6&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=ev(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};u([ut("viewModel.attributes")],Ll.prototype,"attributes",void 0),u([ut("viewModel.activeMediaInfoIndex")],Ll.prototype,"activeMediaInfoIndex",void 0),u([ut("viewModel.description")],Ll.prototype,"description",void 0),u([ut("viewModel.fieldInfoMap")],Ll.prototype,"fieldInfoMap",void 0),u([ut("viewModel.layer")],Ll.prototype,"layer",void 0),u([ut("viewModel.mediaInfos")],Ll.prototype,"mediaInfos",void 0),u([ut("viewModel.popupTemplate")],Ll.prototype,"popupTemplate",void 0),u([ut("viewModel.relatedInfos")],Ll.prototype,"relatedInfos",void 0),u([ut("viewModel.title")],Ll.prototype,"title",void 0),u([d({type:lb})],Ll.prototype,"viewModel",void 0),u([d(),Ra("esri/widgets/Feature/t9n/Feature")],Ll.prototype,"messages",void 0),Ll=u([P("esri.widgets.Feature.FeatureMedia")],Ll);const Lge=Ll;class JUe{constructor(t,i){this.definition=null,this.context=null,this.definition=t,this.context=i}}class Wf{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let i=0;i<this.length();i++)t.push(this.get(i));return t}}class Dw extends Wf{constructor(t,i,r,s,n,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=i,this._hasZ=r,this._hasM=s,this._cacheId=n,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const i=this._elements[t];if(i===void 0)return;const r=this._hasZ,s=this._hasM;let n=null;n=r&&!s?new nt(i[0],i[1],i[2],void 0,this._spRef):s&&!r?new nt(i[0],i[1],void 0,i[2],this._spRef):r&&s?new nt(i[0],i[1],i[2],i[3],this._spRef):new nt(i[0],i[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof Dw&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class rX extends Wf{constructor(t,i,r,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=i,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const i=this._elements[t];if(i===void 0)return;this._lazyPath[t]=new Dw(i,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof rX&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class Lw extends Error{}class KUe extends Lw{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class eke extends Lw{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class tke extends Lw{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class TA extends Lw{}class Nge extends Lw{constructor(t){super(`Invalid unit ${t}`)}}class dh extends Lw{}class hy extends Lw{constructor(){super("Zone is an abstract class")}}const Ye="numeric",op="short",fu="long",FG={year:Ye,month:Ye,day:Ye},Fge={year:Ye,month:op,day:Ye},ike={year:Ye,month:op,day:Ye,weekday:op},Uge={year:Ye,month:fu,day:Ye},kge={year:Ye,month:fu,day:Ye,weekday:fu},zge={hour:Ye,minute:Ye},Bge={hour:Ye,minute:Ye,second:Ye},Vge={hour:Ye,minute:Ye,second:Ye,timeZoneName:op},Gge={hour:Ye,minute:Ye,second:Ye,timeZoneName:fu},jge={hour:Ye,minute:Ye,hourCycle:"h23"},Hge={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23"},qge={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:op},Wge={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:fu},Xge={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye},Yge={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye,second:Ye},Zge={year:Ye,month:op,day:Ye,hour:Ye,minute:Ye},Qge={year:Ye,month:op,day:Ye,hour:Ye,minute:Ye,second:Ye},rke={year:Ye,month:op,day:Ye,weekday:op,hour:Ye,minute:Ye},Jge={year:Ye,month:fu,day:Ye,hour:Ye,minute:Ye,timeZoneName:op},Kge={year:Ye,month:fu,day:Ye,hour:Ye,minute:Ye,second:Ye,timeZoneName:op},eye={year:Ye,month:fu,day:Ye,weekday:fu,hour:Ye,minute:Ye,timeZoneName:fu},tye={year:Ye,month:fu,day:Ye,weekday:fu,hour:Ye,minute:Ye,second:Ye,timeZoneName:fu};function Wi(e){return typeof e=="undefined"}function Ob(e){return typeof e=="number"}function g5(e){return typeof e=="number"&&e%1===0}function ske(e){return typeof e=="string"}function nke(e){return Object.prototype.toString.call(e)==="[object Date]"}function iye(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function oke(e){return Array.isArray(e)?e:[e]}function Cee(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function ake(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function u2(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function ag(e,t,i){return g5(e)&&e>=t&&e<=i}function lke(e,t){return e-t*Math.floor(e/t)}function Cn(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function C0(e){if(!(Wi(e)||e===null||e===""))return parseInt(e,10)}function c_(e){if(!(Wi(e)||e===null||e===""))return parseFloat(e)}function sX(e){if(!(Wi(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function nX(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function qM(e){return e%4===0&&(e%100!==0||e%400===0)}function ER(e){return qM(e)?366:365}function zN(e,t){const i=lke(t-1,12)+1,r=e+(t-i)/12;return i===2?qM(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function oX(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function BN(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function UG(e){return e>99?e:e>60?1900+e:2e3+e}function rye(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o=F({timeZoneName:t},n),a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function y5(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function sye(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new dh(`Invalid unit value ${e}`);return t}function VN(e,t){const i={};for(const r in e)if(u2(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=sye(s)}return i}function CR(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${Cn(i,2)}:${Cn(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Cn(i,2)}${Cn(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function v5(e){return ake(e,["hour","minute","second","millisecond"])}const nye=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,cke=["January","February","March","April","May","June","July","August","September","October","November","December"],oye=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],uke=["J","F","M","A","M","J","J","A","S","O","N","D"];function aye(e){switch(e){case"narrow":return[...uke];case"short":return[...oye];case"long":return[...cke];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const lye=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],cye=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],hke=["M","T","W","T","F","S","S"];function uye(e){switch(e){case"narrow":return[...hke];case"short":return[...cye];case"long":return[...lye];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const hye=["AM","PM"],dke=["Before Christ","Anno Domini"],pke=["BC","AD"],fke=["B","A"];function dye(e){switch(e){case"narrow":return[...fke];case"short":return[...pke];case"long":return[...dke];default:return null}}function mke(e){return hye[e.hour<12?0:1]}function gke(e,t){return uye(t)[e.weekday-1]}function yke(e,t){return aye(t)[e.month-1]}function vke(e,t){return dye(t)[e.year<0?0:1]}function _ke(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Aee(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const bke={D:FG,DD:Fge,DDD:Uge,DDDD:kge,t:zge,tt:Bge,ttt:Vge,tttt:Gge,T:jge,TT:Hge,TTT:qge,TTTT:Wge,f:Xge,ff:Zge,fff:Jge,ffff:eye,F:Yge,FF:Qge,FFF:Kge,FFFF:tye};class ic{static create(t,i={}){return new ic(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return bke[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).formatToParts()}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return Cn(t,i);const r=F({},this.opts);return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(t,m,y),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>r?mke(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?yke(t,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?gke(t,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=ic.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(t,y):m},p=m=>r?vke(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(m)}};return Aee(ic.parseFormat(i),f)}formatDurationFromString(t,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=ic.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(r).filter(l=>l));return Aee(n,s(a))}}class jd{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class WM{get type(){throw new hy}get name(){throw new hy}get ianaName(){return this.name}get isUniversal(){throw new hy}offsetName(t,i){throw new hy}formatOffset(t,i){throw new hy}offset(t){throw new hy}equals(t){throw new hy}get isValid(){throw new hy}}let p6=null;class aX extends WM{static get instance(){return p6===null&&(p6=new aX),p6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return rye(t,i,r)}formatOffset(t,i){return CR(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let SD={};function wke(e){return SD[e]||(SD[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),SD[e]}const xke={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Tke(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function Ske(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=xke[n];n==="era"?r[a]=o:Wi(a)||(r[a]=parseInt(o,10))}return r}let xP={};class Dg extends WM{static create(t){return xP[t]||(xP[t]=new Dg(t)),xP[t]}static resetCache(){xP={},SD={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super();this.zoneName=t,this.valid=Dg.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return rye(t,i,r,this.name)}formatOffset(t,i){return CR(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=wke(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?Ske(r,i):Tke(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=oX({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let f6=null;class cl extends WM{static get utcInstance(){return f6===null&&(f6=new cl(0)),f6}static instance(t){return t===0?cl.utcInstance:new cl(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new cl(y5(i[1],i[2]))}return null}constructor(t){super();this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${CR(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${CR(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return CR(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class Eke extends WM{constructor(t){super();this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function L0(e,t){if(Wi(e)||e===null)return t;if(e instanceof WM)return e;if(ske(e)){const i=e.toLowerCase();return i==="local"||i==="system"?t:i==="utc"||i==="gmt"?cl.utcInstance:cl.parseSpecifier(i)||Dg.create(e)}else return Ob(e)?cl.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new Eke(e)}let Ree=()=>Date.now(),Oee="system",Mee=null,Pee=null,Iee=null,$ee;class qn{static get now(){return Ree}static set now(t){Ree=t}static set defaultZone(t){Oee=t}static get defaultZone(){return L0(Oee,aX.instance)}static get defaultLocale(){return Mee}static set defaultLocale(t){Mee=t}static get defaultNumberingSystem(){return Pee}static set defaultNumberingSystem(t){Pee=t}static get defaultOutputCalendar(){return Iee}static set defaultOutputCalendar(t){Iee=t}static get throwOnInvalid(){return $ee}static set throwOnInvalid(t){$ee=t}static resetCaches(){Os.resetCache(),Dg.resetCache()}}let Dee={};function Cke(e,t={}){const i=JSON.stringify([e,t]);let r=Dee[i];return r||(r=new Intl.ListFormat(e,t),Dee[i]=r),r}let kG={};function zG(e,t={}){const i=JSON.stringify([e,t]);let r=kG[i];return r||(r=new Intl.DateTimeFormat(e,t),kG[i]=r),r}let BG={};function Ake(e,t={}){const i=JSON.stringify([e,t]);let r=BG[i];return r||(r=new Intl.NumberFormat(e,t),BG[i]=r),r}let VG={};function Rke(e,t={}){const o=t,{base:i}=o,r=F3(o,["base"]),s=JSON.stringify([e,r]);let n=VG[s];return n||(n=new Intl.RelativeTimeFormat(e,t),VG[s]=n),n}let SA=null;function Oke(){return SA||(SA=new Intl.DateTimeFormat().resolvedOptions().locale,SA)}function Mke(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let i;const r=e.substring(0,t);try{i=zG(e).resolvedOptions()}catch{i=zG(r).resolvedOptions()}const{numberingSystem:s,calendar:n}=i;return[r,s,n]}}function Pke(e,t,i){return(i||t)&&(e+="-u",i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function Ike(e){const t=[];for(let i=1;i<=12;i++){const r=Jt.utc(2016,i,1);t.push(e(r))}return t}function $ke(e){const t=[];for(let i=1;i<=7;i++){const r=Jt.utc(2016,11,13+i);t.push(e(r))}return t}function TP(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function Dke(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class Lke{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const a=r,{padTo:s,floor:n}=a,o=F3(a,["padTo","floor"]);if(!i||Object.keys(o).length>0){const l=F({useGrouping:!1},r);r.padTo>0&&(l.minimumIntegerDigits=r.padTo),this.inf=Ake(t,l)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):nX(t,3);return Cn(i,this.padTo)}}}class Nke{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&Dg.create(a).valid?(s=a,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:Jt.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n=F({},this.opts);s&&(n.timeZone=s),this.dtf=zG(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class Fke{constructor(t,i,r){this.opts=F({style:"long"},r),!i&&iye()&&(this.rtf=Rke(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):_ke(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class Os{static fromOpts(t){return Os.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||qn.defaultLocale,o=n||(s?"en-US":Oke()),a=i||qn.defaultNumberingSystem,l=r||qn.defaultOutputCalendar;return new Os(o,a,l,n)}static resetCache(){SA=null,kG={},BG={},VG={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return Os.create(t,i,r)}constructor(t,i,r,s){const[n,o,a]=Mke(t);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=Pke(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Dke(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Os.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone(ve(F({},t),{defaultToEN:!0}))}redefaultToSystem(t={}){return this.clone(ve(F({},t),{defaultToEN:!1}))}months(t,i=!1,r=!0){return TP(this,t,r,aye,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=Ike(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return TP(this,t,r,uye,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=$ke(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return TP(this,void 0,t,()=>hye,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Jt.utc(2016,11,13,9),Jt.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return TP(this,t,i,dye,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[Jt.utc(-40,1,1),Jt.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(t={}){return new Lke(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new Nke(t,this.intl,i)}relFormatter(t={}){return new Fke(this.intl,this.isEnglish(),t)}listFormatter(t={}){return Cke(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function cE(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function uE(...e){return t=>e.reduce(([i,r,s],n)=>{const[o,a,l]=n(t,s);return[F(F({},i),o),a||r,l]},[{},null,1]).slice(0,2)}function hE(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function pye(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=C0(t[i+s]);return[r,null,i+s]}}const fye=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,Uke=`(?:${fye.source}?(?:\\[(${nye.source})\\])?)?`,lX=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,mye=RegExp(`${lX.source}${Uke}`),cX=RegExp(`(?:T${mye.source})?`),kke=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,zke=/(\d{4})-?W(\d\d)(?:-?(\d))?/,Bke=/(\d{4})-?(\d{3})/,Vke=pye("weekYear","weekNumber","weekDay"),Gke=pye("year","ordinal"),jke=/(\d{4})-(\d\d)-(\d\d)/,gye=RegExp(`${lX.source} ?(?:${fye.source}|(${nye.source}))?`),Hke=RegExp(`(?: ${gye.source})?`);function bS(e,t,i){const r=e[t];return Wi(r)?i:C0(r)}function qke(e,t){return[{year:bS(e,t),month:bS(e,t+1,1),day:bS(e,t+2,1)},null,t+3]}function dE(e,t){return[{hours:bS(e,t,0),minutes:bS(e,t+1,0),seconds:bS(e,t+2,0),milliseconds:sX(e[t+3])},null,t+4]}function XM(e,t){const i=!e[t]&&!e[t+1],r=y5(e[t+1],e[t+2]),s=i?null:cl.instance(r);return[{},s,t+3]}function YM(e,t){const i=e[t]?Dg.create(e[t]):null;return[{},i,t+1]}const Wke=RegExp(`^T?${lX.source}$`),Xke=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function Yke(e){const[t,i,r,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(c_(i)),months:f(c_(r)),weeks:f(c_(s)),days:f(c_(n)),hours:f(c_(o)),minutes:f(c_(a)),seconds:f(c_(l),l==="-0"),milliseconds:f(sX(c),p)}]}const Zke={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function uX(e,t,i,r,s,n,o){const a={year:t.length===2?UG(C0(t)):C0(t),month:oye.indexOf(i)+1,day:C0(r),hour:C0(s),minute:C0(n)};return o&&(a.second=C0(o)),e&&(a.weekday=e.length>3?lye.indexOf(e)+1:cye.indexOf(e)+1),a}const Qke=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Jke(e){const[,t,i,r,s,n,o,a,l,c,h,p]=e,f=uX(t,s,r,i,n,o,a);let m;return l?m=Zke[l]:c?m=0:m=y5(h,p),[f,new cl(m)]}function Kke(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const e6e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,t6e=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,i6e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Lee(e){const[,t,i,r,s,n,o,a]=e;return[uX(t,s,r,i,n,o,a),cl.utcInstance]}function r6e(e){const[,t,i,r,s,n,o,a]=e;return[uX(t,a,i,r,s,n,o),cl.utcInstance]}const s6e=cE(kke,cX),n6e=cE(zke,cX),o6e=cE(Bke,cX),a6e=cE(mye),yye=uE(qke,dE,XM,YM),l6e=uE(Vke,dE,XM,YM),c6e=uE(Gke,dE,XM,YM),u6e=uE(dE,XM,YM);function h6e(e){return hE(e,[s6e,yye],[n6e,l6e],[o6e,c6e],[a6e,u6e])}function d6e(e){return hE(Kke(e),[Qke,Jke])}function p6e(e){return hE(e,[e6e,Lee],[t6e,Lee],[i6e,r6e])}function f6e(e){return hE(e,[Xke,Yke])}const m6e=uE(dE);function g6e(e){return hE(e,[Wke,m6e])}const y6e=cE(jke,Hke),v6e=cE(gye),_6e=uE(dE,XM,YM);function b6e(e){return hE(e,[y6e,yye],[v6e,_6e])}const w6e="Invalid Duration",vye={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},x6e=F({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},vye),Pu=146097/400,Ww=146097/4800,T6e=F({years:{quarters:4,months:12,weeks:Pu/7,days:Pu,hours:Pu*24,minutes:Pu*24*60,seconds:Pu*24*60*60,milliseconds:Pu*24*60*60*1e3},quarters:{months:3,weeks:Pu/28,days:Pu/4,hours:Pu*24/4,minutes:Pu*24*60/4,seconds:Pu*24*60*60/4,milliseconds:Pu*24*60*60*1e3/4},months:{weeks:Ww/7,days:Ww,hours:Ww*24,minutes:Ww*24*60,seconds:Ww*24*60*60,milliseconds:Ww*24*60*60*1e3}},vye),h1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],S6e=h1.slice(0).reverse();function u_(e,t,i=!1){const r={values:i?t.values:F(F({},e.values),t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new ir(r)}function E6e(e){return e<0?Math.floor(e):Math.ceil(e)}function _ye(e,t,i,r,s){const n=e[s][i],o=t[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?E6e(o):Math.trunc(o);r[s]+=l,t[i]-=l*n}function C6e(e,t){S6e.reduce((i,r)=>Wi(t[r])?i:(i&&_ye(e,t,i,t,r),r),null)}class ir{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||Os.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i?T6e:x6e,this.isLuxonDuration=!0}static fromMillis(t,i){return ir.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new dh(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new ir({values:VN(t,ir.normalizeUnit),loc:Os.fromObject(i),conversionAccuracy:i.conversionAccuracy})}static fromDurationLike(t){if(Ob(t))return ir.fromMillis(t);if(ir.isDuration(t))return t;if(typeof t=="object")return ir.fromObject(t);throw new dh(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=f6e(t);return r?ir.fromObject(r,i):ir.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=g6e(t);return r?ir.fromObject(r,i):ir.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new dh("need to specify a reason the Duration is invalid");const r=t instanceof jd?t:new jd(t,i);if(qn.throwOnInvalid)throw new tke(r);return new ir({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new Nge(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r=ve(F({},i),{floor:i.round!==!1&&i.floor!==!1});return this.isValid?ic.create(this.loc,r).formatDurationFromString(this,t):w6e}toHuman(t={}){const i=h1.map(r=>{const s=this.values[r];return Wi(s)?null:this.loc.numberFormatter(ve(F({style:"unit",unitDisplay:"long"},t),{unit:r.slice(0,-1)})).format(s)}).filter(r=>r);return this.loc.listFormatter(F({type:"conjunction",style:t.listStyle||"narrow"},t)).format(i)}toObject(){return this.isValid?F({},this.values):{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=nX(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t=F({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},t);const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=ir.fromDurationLike(t),r={};for(const s of h1)(u2(i.values,s)||u2(this.values,s))&&(r[s]=i.get(s)+this.get(s));return u_(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=ir.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=sye(t(this.values[r],r));return u_(this,{values:i},!0)}get(t){return this[ir.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i=F(F({},this.values),VN(t,ir.normalizeUnit));return u_(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i}),n={loc:s};return r&&(n.conversionAccuracy=r),u_(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return C6e(this.matrix,t),u_(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>ir.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of h1)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;Ob(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)h1.indexOf(c)>h1.indexOf(o)&&_ye(this.matrix,s,c,i,o)}else Ob(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return u_(this,{values:i},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return u_(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of h1)if(!i(this.values[r],t.values[r]))return!1;return!0}}const VE="Invalid Interval";function A6e(e,t){return!e||!e.isValid?Bs.invalid("missing or invalid start"):!t||!t.isValid?Bs.invalid("missing or invalid end"):t<e?Bs.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Bs{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new dh("need to specify a reason the Interval is invalid");const r=t instanceof jd?t:new jd(t,i);if(qn.throwOnInvalid)throw new eke(r);return new Bs({invalid:r})}static fromDateTimes(t,i){const r=HE(t),s=HE(i),n=A6e(r,s);return n==null?new Bs({start:r,end:s}):n}static after(t,i){const r=ir.fromDurationLike(i),s=HE(t);return Bs.fromDateTimes(s,s.plus(r))}static before(t,i){const r=ir.fromDurationLike(i),s=HE(t);return Bs.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,o;try{n=Jt.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=Jt.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Bs.fromDateTimes(n,a);if(o){const c=ir.fromISO(s,i);if(c.isValid)return Bs.after(n,c)}else if(l){const c=ir.fromISO(r,i);if(c.isValid)return Bs.before(a,c)}}return Bs.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?Bs.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(HE).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Bs.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(t){const i=ir.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Bs.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:Bs.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return Bs.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Bs.fromDateTimes(i,l.time)),i=null);return Bs.merge(s)}difference(...t){return Bs.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:VE}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:VE}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:VE}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:VE}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:VE}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):ir.invalid(this.invalidReason)}mapEndpoints(t){return Bs.fromDateTimes(t(this.s),t(this.e))}}class SP{static hasDST(t=qn.defaultZone){const i=Jt.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return Dg.isValidZone(t)}static normalizeZone(t){return L0(t,qn.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Os.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Os.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Os.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Os.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Os.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return Os.create(i,null,"gregory").eras(t)}static features(){return{relative:iye()}}}function Nee(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(ir.fromMillis(r).as("days"))}function R6e(e,t,i){const r=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=Nee(a,l);return(c-c%7)/7}],["days",Nee]],s={};let n,o;for(const[a,l]of r)if(i.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function O6e(e,t,i,r){let[s,n,o,a]=R6e(e,t,i);const l=t-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=ir.fromObject(n,r);return c.length>0?ir.fromMillis(l,r).shiftTo(...c).plus(h):h}const hX={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Fee={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},M6e=hX.hanidec.replace(/[\[|\]]/g,"").split("");function P6e(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(hX.hanidec)!==-1)t+=M6e.indexOf(e[i]);else for(const s in Fee){const[n,o]=Fee[s];r>=n&&r<=o&&(t+=r-n)}}return parseInt(t,10)}else return t}function Wh({numberingSystem:e},t=""){return new RegExp(`${hX[e||"latn"]}${t}`)}const I6e="missing Intl.DateTimeFormat.formatToParts support";function dr(e,t=i=>i){return{regex:e,deser:([i])=>t(P6e(i))}}const $6e=String.fromCharCode(160),bye=`[ ${$6e}]`,wye=new RegExp(bye,"g");function D6e(e){return e.replace(/\./g,"\\.?").replace(wye,bye)}function Uee(e){return e.replace(/\./g,"").replace(wye," ").toLowerCase()}function Xh(e,t){return e===null?null:{regex:RegExp(e.map(D6e).join("|")),deser:([i])=>e.findIndex(r=>Uee(i)===Uee(r))+t}}function kee(e,t){return{regex:e,deser:([,i,r])=>y5(i,r),groups:t}}function m6(e){return{regex:e,deser:([t])=>t}}function L6e(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function N6e(e,t){const i=Wh(t),r=Wh(t,"{2}"),s=Wh(t,"{3}"),n=Wh(t,"{4}"),o=Wh(t,"{6}"),a=Wh(t,"{1,2}"),l=Wh(t,"{1,3}"),c=Wh(t,"{1,6}"),h=Wh(t,"{1,9}"),p=Wh(t,"{2,4}"),f=Wh(t,"{4,6}"),m=w=>({regex:RegExp(L6e(w.val)),deser:([b])=>b,literal:!0}),v=(w=>{if(e.literal)return m(w);switch(w.val){case"G":return Xh(t.eras("short",!1),0);case"GG":return Xh(t.eras("long",!1),0);case"y":return dr(c);case"yy":return dr(p,UG);case"yyyy":return dr(n);case"yyyyy":return dr(f);case"yyyyyy":return dr(o);case"M":return dr(a);case"MM":return dr(r);case"MMM":return Xh(t.months("short",!0,!1),1);case"MMMM":return Xh(t.months("long",!0,!1),1);case"L":return dr(a);case"LL":return dr(r);case"LLL":return Xh(t.months("short",!1,!1),1);case"LLLL":return Xh(t.months("long",!1,!1),1);case"d":return dr(a);case"dd":return dr(r);case"o":return dr(l);case"ooo":return dr(s);case"HH":return dr(r);case"H":return dr(a);case"hh":return dr(r);case"h":return dr(a);case"mm":return dr(r);case"m":return dr(a);case"q":return dr(a);case"qq":return dr(r);case"s":return dr(a);case"ss":return dr(r);case"S":return dr(l);case"SSS":return dr(s);case"u":return m6(h);case"uu":return m6(a);case"uuu":return dr(i);case"a":return Xh(t.meridiems(),0);case"kkkk":return dr(n);case"kk":return dr(p,UG);case"W":return dr(a);case"WW":return dr(r);case"E":case"c":return dr(i);case"EEE":return Xh(t.weekdays("short",!1,!1),1);case"EEEE":return Xh(t.weekdays("long",!1,!1),1);case"ccc":return Xh(t.weekdays("short",!0,!1),1);case"cccc":return Xh(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return kee(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return kee(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return m6(/[a-z_+-/]{1,256}?/i);default:return m(w)}})(e)||{invalidReason:I6e};return v.token=e,v}const F6e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function U6e(e,t,i){const{type:r,value:s}=e;if(r==="literal")return{literal:!0,val:s};const n=i[r];let o=F6e[r];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function k6e(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function z6e(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const o in i)if(u2(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function B6e(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Wi(e.z)||(i=Dg.create(e.z)),Wi(e.Z)||(i||(i=new cl(e.Z)),r=e.Z),Wi(e.q)||(e.M=(e.q-1)*3+1),Wi(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Wi(e.u)||(e.S=sX(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),i,r]}let g6=null;function V6e(){return g6||(g6=Jt.fromMillis(1555555555555)),g6}function G6e(e,t){if(e.literal)return e;const i=ic.macroTokenToFormatOpts(e.val);if(!i)return e;const n=ic.create(t,i).formatDateTimeParts(V6e()).map(o=>U6e(o,t,i));return n.includes(void 0)?e:n}function j6e(e,t){return Array.prototype.concat(...e.map(i=>G6e(i,t)))}function xye(e,t,i){const r=j6e(ic.parseFormat(i),e),s=r.map(o=>N6e(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[o,a]=k6e(s),l=RegExp(o,"i"),[c,h]=z6e(t,l,a),[p,f,m]=h?B6e(h):[null,null,void 0];if(u2(h,"a")&&u2(h,"H"))throw new TA("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function H6e(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=xye(e,t,i);return[r,s,n,o]}const Tye=[0,31,59,90,120,151,181,212,243,273,304,334],Sye=[0,31,60,91,121,152,182,213,244,274,305,335];function Th(e,t){return new jd("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function Eye(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function Cye(e,t,i){return i+(qM(e)?Sye:Tye)[t-1]}function Aye(e,t){const i=qM(e)?Sye:Tye,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function GG(e){const{year:t,month:i,day:r}=e,s=Cye(t,i,r),n=Eye(t,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=BN(a)):o>BN(t)?(a=t+1,o=1):a=t,F({weekYear:a,weekNumber:o,weekday:n},v5(e))}function zee(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=Eye(t,1,4),n=ER(t);let o=i*7+r-s-3,a;o<1?(a=t-1,o+=ER(a)):o>n?(a=t+1,o-=ER(t)):a=t;const{month:l,day:c}=Aye(a,o);return F({year:a,month:l,day:c},v5(e))}function y6(e){const{year:t,month:i,day:r}=e,s=Cye(t,i,r);return F({year:t,ordinal:s},v5(e))}function Bee(e){const{year:t,ordinal:i}=e,{month:r,day:s}=Aye(t,i);return F({year:t,month:r,day:s},v5(e))}function q6e(e){const t=g5(e.weekYear),i=ag(e.weekNumber,1,BN(e.weekYear)),r=ag(e.weekday,1,7);return t?i?r?!1:Th("weekday",e.weekday):Th("week",e.week):Th("weekYear",e.weekYear)}function W6e(e){const t=g5(e.year),i=ag(e.ordinal,1,ER(e.year));return t?i?!1:Th("ordinal",e.ordinal):Th("year",e.year)}function Rye(e){const t=g5(e.year),i=ag(e.month,1,12),r=ag(e.day,1,zN(e.year,e.month));return t?i?r?!1:Th("day",e.day):Th("month",e.month):Th("year",e.year)}function Oye(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=ag(t,0,23)||t===24&&i===0&&r===0&&s===0,o=ag(i,0,59),a=ag(r,0,59),l=ag(s,0,999);return n?o?a?l?!1:Th("millisecond",s):Th("second",r):Th("minute",i):Th("hour",t)}const v6="Invalid DateTime",Vee=864e13;function EP(e){return new jd("unsupported zone",`the zone "${e.name}" is not supported`)}function _6(e){return e.weekData===null&&(e.weekData=GG(e.c)),e.weekData}function GE(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new Jt(ve(F(F({},i),t),{old:i}))}function Mye(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Gee(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function ED(e,t,i){return Mye(oX(e),t,i)}function jee(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n=ve(F({},e.c),{year:r,month:s,day:Math.min(e.c.day,zN(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7}),o=ir.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=oX(n);let[l,c]=Mye(a,i,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function jE(e,t,i,r,s,n){const{setZone:o,zone:a}=i;if(e&&Object.keys(e).length!==0){const l=t||a,c=Jt.fromObject(e,ve(F({},i),{zone:l,specificOffset:n}));return o?c:c.setZone(a)}else return Jt.invalid(new jd("unparsable",`the input "${s}" can't be parsed as ${r}`))}function CP(e,t,i=!0){return e.isValid?ic.create(Os.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function b6(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=Cn(e.c.year,i?6:4),t?(r+="-",r+=Cn(e.c.month),r+="-",r+=Cn(e.c.day)):(r+=Cn(e.c.month),r+=Cn(e.c.day)),r}function Hee(e,t,i,r,s,n){let o=Cn(e.c.hour);return t?(o+=":",o+=Cn(e.c.minute),(e.c.second!==0||!i)&&(o+=":")):o+=Cn(e.c.minute),(e.c.second!==0||!i)&&(o+=Cn(e.c.second),(e.c.millisecond!==0||!r)&&(o+=".",o+=Cn(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=Cn(Math.trunc(-e.o/60)),o+=":",o+=Cn(Math.trunc(-e.o%60))):(o+="+",o+=Cn(Math.trunc(e.o/60)),o+=":",o+=Cn(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const Pye={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},X6e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},Y6e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Iye=["year","month","day","hour","minute","second","millisecond"],Z6e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],Q6e=["year","ordinal","hour","minute","second","millisecond"];function qee(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new Nge(e);return t}function Wee(e,t){const i=L0(t.zone,qn.defaultZone),r=Os.fromObject(t),s=qn.now();let n,o;if(Wi(e.year))n=s;else{for(const c of Iye)Wi(e[c])&&(e[c]=Pye[c]);const a=Rye(e)||Oye(e);if(a)return Jt.invalid(a);const l=i.offset(s);[n,o]=ED(e,l,i)}return new Jt({ts:n,zone:i,loc:r,o})}function Xee(e,t,i){const r=Wi(i.round)?!0:i.round,s=(o,a)=>(o=nX(o,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,i.units[i.units.length-1])}function Yee(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class Jt{constructor(t){const i=t.zone||qn.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new jd("invalid input"):null)||(i.isValid?null:EP(i));this.ts=Wi(t.ts)?qn.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const a=i.offset(this.ts);s=Gee(this.ts,a),r=Number.isNaN(s.year)?new jd("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=t.loc||Os.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new Jt({})}static local(){const[t,i]=Yee(arguments),[r,s,n,o,a,l,c]=i;return Wee({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,i]=Yee(arguments),[r,s,n,o,a,l,c]=i;return t.zone=cl.utcInstance,Wee({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,i={}){const r=nke(t)?t.valueOf():NaN;if(Number.isNaN(r))return Jt.invalid("invalid input");const s=L0(i.zone,qn.defaultZone);return s.isValid?new Jt({ts:r,zone:s,loc:Os.fromObject(i)}):Jt.invalid(EP(s))}static fromMillis(t,i={}){if(Ob(t))return t<-Vee||t>Vee?Jt.invalid("Timestamp out of range"):new Jt({ts:t,zone:L0(i.zone,qn.defaultZone),loc:Os.fromObject(i)});throw new dh(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(Ob(t))return new Jt({ts:t*1e3,zone:L0(i.zone,qn.defaultZone),loc:Os.fromObject(i)});throw new dh("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=L0(i.zone,qn.defaultZone);if(!r.isValid)return Jt.invalid(EP(r));const s=qn.now(),n=Wi(i.specificOffset)?r.offset(s):i.specificOffset,o=VN(t,qee),a=!Wi(o.ordinal),l=!Wi(o.year),c=!Wi(o.month)||!Wi(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Os.fromObject(i);if((h||a)&&p)throw new TA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new TA("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,v,w=Gee(s,n);m?(y=Z6e,v=X6e,w=GG(w)):a?(y=Q6e,v=Y6e,w=y6(w)):(y=Iye,v=Pye);let b=!1;for(const N of y){const D=o[N];Wi(D)?b?o[N]=v[N]:o[N]=w[N]:b=!0}const S=m?q6e(o):a?W6e(o):Rye(o),T=S||Oye(o);if(T)return Jt.invalid(T);const E=m?zee(o):a?Bee(o):o,[C,O]=ED(E,n,r),I=new Jt({ts:C,zone:r,o:O,loc:f});return o.weekday&&h&&t.weekday!==I.weekday?Jt.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${I.toISO()}`):I}static fromISO(t,i={}){const[r,s]=h6e(t);return jE(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=d6e(t);return jE(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=p6e(t);return jE(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(Wi(t)||Wi(i))throw new dh("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Os.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=H6e(o,t,i);return h?Jt.invalid(h):jE(a,l,r,`format ${i}`,t,c)}static fromString(t,i,r={}){return Jt.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=b6e(t);return jE(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new dh("need to specify a reason the DateTime is invalid");const r=t instanceof jd?t:new jd(t,i);if(qn.throwOnInvalid)throw new KUe(r);return new Jt({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?_6(this).weekYear:NaN}get weekNumber(){return this.isValid?_6(this).weekNumber:NaN}get weekday(){return this.isValid?_6(this).weekday:NaN}get ordinal(){return this.isValid?y6(this.c).ordinal:NaN}get monthShort(){return this.isValid?SP.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?SP.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?SP.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?SP.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return qM(this.year)}get daysInMonth(){return zN(this.year,this.month)}get daysInYear(){return this.isValid?ER(this.year):NaN}get weeksInWeekYear(){return this.isValid?BN(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=ic.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(cl.instance(t),i)}toLocal(){return this.setZone(qn.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=L0(t,qn.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),o=this.toObject();[s]=ED(o,n,t)}return GE(this,{ts:s,zone:t})}else return Jt.invalid(EP(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return GE(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=VN(t,qee),r=!Wi(i.weekYear)||!Wi(i.weekNumber)||!Wi(i.weekday),s=!Wi(i.ordinal),n=!Wi(i.year),o=!Wi(i.month)||!Wi(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new TA("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new TA("Can't mix ordinal dates with month/day");let c;r?c=zee(F(F({},GG(this.c)),i)):Wi(i.ordinal)?(c=F(F({},this.toObject()),i),Wi(i.day)&&(c.day=Math.min(zN(c.year,c.month),c.day))):c=Bee(F(F({},y6(this.c)),i));const[h,p]=ED(c,this.o,this.zone);return GE(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const i=ir.fromDurationLike(t);return GE(this,jee(this,i))}minus(t){if(!this.isValid)return this;const i=ir.fromDurationLike(t).negate();return GE(this,jee(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=ir.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?ic.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):v6}toLocaleString(t=FG,i={}){return this.isValid?ic.create(this.loc.clone(i),t).formatDateTime(this):v6}toLocaleParts(t={}){return this.isValid?ic.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=b6(this,o);return a+="T",a+=Hee(this,o,i,r,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?b6(this,t==="extended"):null}toISOWeekDate(){return CP(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Hee(this,o==="extended",i,t,r,n):null}toRFC2822(){return CP(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return CP(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?b6(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),CP(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():v6}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i=F({},this.c);return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return ir.invalid("created by diffing an invalid DateTime");const s=F({locale:this.locale,numberingSystem:this.numberingSystem},r),n=oke(i).map(ir.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=O6e(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",i={}){return this.diff(Jt.now(),t,i)}until(t){return this.isValid?Bs.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||Jt.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),Xee(i,this.plus(r),ve(F({},t),{numeric:"always",units:s,unit:n}))}toRelativeCalendar(t={}){return this.isValid?Xee(t.base||Jt.fromObject({},{zone:this.zone}),this,ve(F({},t),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...t){if(!t.every(Jt.isDateTime))throw new dh("min requires all arguments be DateTimes");return Cee(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(Jt.isDateTime))throw new dh("max requires all arguments be DateTimes");return Cee(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Os.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return xye(o,t,i)}static fromStringExplain(t,i,r={}){return Jt.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return FG}static get DATE_MED(){return Fge}static get DATE_MED_WITH_WEEKDAY(){return ike}static get DATE_FULL(){return Uge}static get DATE_HUGE(){return kge}static get TIME_SIMPLE(){return zge}static get TIME_WITH_SECONDS(){return Bge}static get TIME_WITH_SHORT_OFFSET(){return Vge}static get TIME_WITH_LONG_OFFSET(){return Gge}static get TIME_24_SIMPLE(){return jge}static get TIME_24_WITH_SECONDS(){return Hge}static get TIME_24_WITH_SHORT_OFFSET(){return qge}static get TIME_24_WITH_LONG_OFFSET(){return Wge}static get DATETIME_SHORT(){return Xge}static get DATETIME_SHORT_WITH_SECONDS(){return Yge}static get DATETIME_MED(){return Zge}static get DATETIME_MED_WITH_SECONDS(){return Qge}static get DATETIME_MED_WITH_WEEKDAY(){return rke}static get DATETIME_FULL(){return Jge}static get DATETIME_FULL_WITH_SECONDS(){return Kge}static get DATETIME_HUGE(){return eye}static get DATETIME_HUGE_WITH_SECONDS(){return tye}}function HE(e){if(Jt.isDateTime(e))return e;if(e&&e.valueOf&&Ob(e.valueOf()))return Jt.fromJSDate(e);if(e&&typeof e=="object")return Jt.fromObject(e);throw new dh(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const w6={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function $ye(e){e||(e=du());let t=e in w6;if(!t){const n=e.split("-");n.length>1&&n[0]in w6&&(e=n[0],t=!0),t||(e="en")}const[i,r,s="#,##0.###"]=w6[e];return{decimal:i,group:r,pattern:s}}function J6e(e,t){const i=$ye((t=F({},t)).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:K6e(e,r,t)}const Dye=/[#0,]*[#0](?:\.0*#*)?/;function K6e(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=Dye,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return i.fractional===!1&&(i.places=0),t.replace(a,eze(e,l[0],{decimal:s,group:r,places:i.places,round:i.round}))}function eze(e,t,i){(i=i||{}).places===!0&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s=typeof i.places=="string"&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const y=i.places!==void 0?i.places:r[1]&&r[1].lastIndexOf("0")+1;y>a.length&&(o[1]=a.padEnd(Number(y),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=r[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,f=r[0].lastIndexOf(",");if(f!==-1){h=r[0].length-f-1;const y=r[0].substr(0,f);f=y.lastIndexOf(","),f!==-1&&(p=y.length-f-1)}const m=[];for(let y=o[0];y;){const v=y.length-h;m.push(v>0?y.substr(v):y),y=v>0?y.slice(0,v):"",p&&(h=p,p=void 0)}return o[0]=m.reverse().join(i.group||","),o.join(i.decimal||".")}function tze(e){const t=$ye((e=e||{}).locale),i=e.pattern||t.pattern,r=t.group,s=t.decimal;let n=1;if(i.includes("%"))n/=100;else if(i.includes("\u2030"))n/=1e3;else if(i.includes("\xA4"))throw new Error("currency notation not supported");const o=i.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:wO(o,l=>(l="(?:"+_ce(l,".")+")").replace(Dye,c=>{const h={signed:!1,separator:e.strict?r:[r,""],fractional:e.fractional,decimal:s,exponent:!1},p=c.split(".");let f=e.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||f===0?h.fractional=!1:(f===void 0&&(f=e.pattern?p[1].lastIndexOf("0")+1:1/0),f&&e.fractional==null&&(h.fractional=!0),!e.places&&f<p[1].length&&(f+=","+p[1].length),h.places=f);const m=p[0].split(",");return m.length>1&&(h.groupSize=m.pop().length,m.length>1&&(h.groupSize2=m.pop().length)),"("+rze(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:s,factor:n}}function ize(e,t){const i=tze(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function rze(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=Zee(e),i=wO(e.fractional,s=>{let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+wO(e.exponent,s=>s?"([eE]"+Zee({signed:e.eSigned})+")":"")}function Zee(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",wO(e.signed,t=>t?"[-+]":"",!0)+wO(e.separator,t=>{if(!t)return"(?:\\d+)";(t=_ce(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const i=e.groupSize,r=e.groupSize2;if(r){const s="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})";return i-r>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0)}const wO=(e,t,i)=>{if(!(e instanceof Array))return t(e);const r=[];for(let s=0;s<e.length;s++)r.push(t(e[s]));return sze(r.join("|"),i)},sze=(e,t)=>"("+(t?"?:":"")+e+")";var Qee,Jee;function ebt(e){return jM.fromJSON(e.toJSON())}function nze(e){return e.toJSON?e.toJSON():e}function tbt(e){return typeof e=="string"||e instanceof String}function ibt(e){return typeof e=="number"}function Kee(e){return e instanceof Date}function rbt(e,t){return e===t||!(!Kee(e)||!Kee(t))&&e.getTime()===t.getTime()}function sbt(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function nbt(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new ri({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function obt(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(Qee||(Qee={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(Jee||(Jee={}));const abt=1e3,lbt={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},ete={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},cbt={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function ubt(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function hbt(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}class Lye{constructor(t){this.value=t}}class Nye{constructor(t){this.value=t}}class dX{constructor(t){this.fn=t}}class pX{constructor(t,i){this.paramCount=i,this.fn=t}}const oze=dX,aze=Nye,lze=Lye,cze=pX,Qc={type:"VOID"},uze={type:"BREAK"},hze={type:"CONTINUE"};function xO(e,t,i){return t===""||t==null||t===i||t===i?e:e=e.split(t).join(i)}function fX(e){return e instanceof dX||e instanceof JUe||e instanceof pX}function GN(e){return!!Vo(e)||!!sl(e)||!!wa(e)||!!rl(e)||e===null||e===Qc||typeof e=="number"}function dze(e,t){return e===void 0?t:e}function Vo(e){return typeof e=="string"||e instanceof String}function rl(e){return typeof e=="boolean"}function sl(e){return typeof e=="number"}function pze(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function Ph(e){return e instanceof Array}function fze(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function mze(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function gze(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function Yb(e){return e instanceof Wf}function wa(e){return e instanceof Date}function yze(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function vze(e){return e<0?-Math.round(-e):Math.round(e)}function _ze(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?i:3&i|8).toString(16)})}function mX(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=xO(t,"\u2030",""),t=xO(t,"\xA4",""),J6e(e,{pattern:t})):e.toString()}function _5(e,t){const i=Jt.fromJSDate(e);return t==null||t===""?i.toISO({suppressMilliseconds:!0}):i.toFormat(Fye(t),{locale:du(),numberingSystem:"latn"})}function Fye(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function vr(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function bze(e,t,i){if(e===null){if(t===null||t===Qc)return vr(null,null,i);if(sl(t))return vr(0,t,i);if(Vo(t)||rl(t))return vr(0,Cs(t),i);if(wa(t))return vr(0,t.getTime(),i)}if(e===Qc){if(t===null||t===Qc)return vr(null,null,i);if(sl(t))return vr(0,t,i);if(Vo(t)||rl(t))return vr(0,Cs(t),i);if(wa(t))return vr(0,t.getTime(),i)}else if(sl(e)){if(sl(t))return vr(e,t,i);if(rl(t))return vr(e,Cs(t),i);if(t===null||t===Qc)return vr(e,0,i);if(Vo(t))return vr(e,Cs(t),i);if(wa(t))return vr(e,t.getTime(),i)}else if(Vo(e)){if(Vo(t))return vr(pv(e),pv(t),i);if(wa(t))return vr(Cs(e),t.getTime(),i);if(sl(t))return vr(Cs(e),t,i);if(t===null||t===Qc)return vr(Cs(e),0,i);if(rl(t))return vr(Cs(e),Cs(t),i)}else if(wa(e)){if(wa(t))return vr(e,t,i);if(t===null||t===Qc)return vr(e.getTime(),0,i);if(sl(t))return vr(e.getTime(),t,i);if(rl(t)||Vo(t))return vr(e.getTime(),Cs(t),i)}else if(rl(e)){if(rl(t))return vr(e,t,i);if(sl(t))return vr(Cs(e),Cs(t),i);if(wa(t))return vr(Cs(e),t.getTime(),i);if(t===null||t===Qc)return vr(Cs(e),0,i);if(Vo(t))return vr(Cs(e),Cs(t),i)}return!!Uye(e,t)&&(i==="<="||i===">=")}function Uye(e,t){if(e===t||e===null&&t===Qc||t===null&&e===Qc)return!0;if(wa(e)&&wa(t))return e.getTime()===t.getTime();if(e instanceof rX||e instanceof Dw)return e.equalityTest(t);if(e instanceof nt&&t instanceof nt){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(i!=null)return i===r}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function pv(e,t){if(Vo(e))return e;if(e===null)return"";if(sl(e))return mX(e,t);if(rl(e))return e.toString();if(wa(e))return _5(e,t);if(e instanceof cc)return JSON.stringify(e.toJSON());if(Ph(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=jN(e[r]);return"["+i.join(",")+"]"}if(e instanceof Wf){const i=[];for(let r=0;r<e.length();r++)i[r]=jN(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():fX(e)?"object, Function":""}function wze(e){const t=[];if(Ph(e)===!1)return null;if(e instanceof Wf){for(let i=0;i<e.length();i++)t[i]=Cs(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=Cs(e[i]);return t}function CD(e,t){if(Vo(e))return e;if(e===null)return"";if(sl(e))return mX(e,t);if(rl(e))return e.toString();if(wa(e))return _5(e,t);if(e instanceof cc)return e instanceof ri?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+jG(e.spatialReference)+"}":jG(e.toJSON(),(i,r)=>i.key===r.key?0:i.key==="spatialReference"?1:r.key==="spatialReference"||i.key<r.key?-1:i.key>r.key?1:0);if(Ph(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=jN(e[r]);return"["+i.join(",")+"]"}if(e instanceof Wf){const i=[];for(let r=0;r<e.length();r++)i[r]=jN(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():fX(e)?"object, Function":""}function jN(e){if(e===null)return"null";if(rl(e)||sl(e)||Vo(e))return JSON.stringify(e);if(e instanceof cc||e instanceof Wf||e instanceof Array)return CD(e);if(e instanceof Date)return JSON.stringify(_5(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===Qc)return"null";return"null"}function Cs(e,t){return sl(e)?e:e===null||e===""?0:wa(e)?NaN:rl(e)?e?1:0:Ph(e)||e===""||e===void 0?NaN:t!==void 0&&Vo(e)?(t=xO(t,"\u2030",""),t=xO(t,"\xA4",""),ize(e,{pattern:t})):e===Qc?0:Number(e)}function xze(e){if(wa(e))return e;if(Vo(e)){const t=kye(e);if(t)return t.toJSDate()}return null}function Tze(e){return wa(e)?Jt.fromJSDate(e):Vo(e)?kye(e):null}function kye(e){const t=/ (\d\d)/;let i=Jt.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=Jt.fromISO(e),i.isValid)?i:null}function Sze(e){return rl(e)?e:Vo(e)?(e=e.toLowerCase())==="true":!!sl(e)&&e!==0&&!isNaN(e)}function Eze(e,t){return A(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function Cze(e){if(e===null)return null;if(e instanceof nt)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof Ao){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof au){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof xw?e.points.length===0?null:e:e instanceof ri?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function zye(e,t){if(!e||!e.domain)return t;let i=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=pv(t);else{if(t==null)return null;if(t==="")return t;t=Cs(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return i===null?t:i.name}function Bye(e,t){if(!e||!e.domain)return t;let i=null;t=pv(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return i===null?t:i.code}function b5(e,t,i=null,r=null){if(!t||!t.fields)return null;let s,n,o=null;for(let a=0;a<t.fields.length;a++){const l=t.fields[a];l.name.toLowerCase()===e.toString().toLowerCase()&&(o=l)}if(o===null)throw new Error("Field not found");return r===null&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),r!=null&&t.types.some(function(a){return a.id===r&&(s=a.domains&&a.domains[o.name],s&&s.type==="inherited"&&(s=tte(o.name,t),n=!0),!0)}),n||s||(s=tte(e,t)),{field:o,domain:s}}function tte(e,t){let i;return t.fields.some(function(r){return r.name.toLowerCase()===e.toLowerCase()&&(i=r.domain),!!i}),i}function jG(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}function Aze(e){if(e===null)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&i.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(i.geometry()):t.push(i);return t}function h2(e,t){if(!(t instanceof nt))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function Rze(e,t){if(Ph(e)||Yb(e)){let i=!1,r=!1,s=[],n=t;if(Ph(e)){for(const o of e)h2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof Dw)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!Yb(e))throw new Error("Invalid Argument");for(const o of e.toArray())h2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(QH(s,r,i)===!1&&(s=s.slice(0).reverse()),new Ao({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function Oze(e,t){if(Ph(e)||Yb(e)){let i=!1,r=!1,s=[],n=t;if(Ph(e)){for(const o of e)h2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof Dw)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(Yb(e)){for(const o of e.toArray())h2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new au({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function Mze(e,t){if(Ph(e)||Yb(e)){let i=!1,r=!1,s=[],n=t;if(Ph(e)){for(const o of e)h2(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof Dw)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(Yb(e)){for(const o of e.toArray())h2(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new xw({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function Pze(e,t=!1){const i=[];if(e===null)return i;if(Ph(e)===!0){for(let r=0;r<e.length;r++){const s=pv(e[r]);s===""&&t!==!0||i.push(s)}return i}if(e instanceof Wf){for(let r=0;r<e.length();r++){const s=pv(e.get(r));s===""&&t!==!0||i.push(s)}return i}if(GN(e)){const r=pv(e);return r===""&&t!==!0||i.push(r),i}return[]}let x6=0;function Ize(e){return x6++,x6%100==0?(x6=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function $ze(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function TO(e,t=null){return e==null?null:rl(e)||sl(e)||Vo(e)?e:e instanceof cc?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof Wf?e.toArray().map(i=>TO(i,t)):e instanceof Array?e.map(i=>TO(i,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function Dze(e,t,i,r,s){const n=await gX(e,t,i);s[r]=n}async function gX(e,t=null,i=null){if(e instanceof Wf&&(e=e.toArray()),e==null)return null;if(GN(e)||e instanceof cc||e instanceof Date)return TO(e,i);if(e instanceof Array){const r=[],s=[];for(const n of e)n===null||GN(n)||n instanceof cc||n instanceof Date?s.push(TO(n,i)):(s.push(null),r.push(Dze(n,t,i,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,i):null}function Lze(e,t,i){const r=e.fullSchema();return r===null||!r.fields?null:b5(t,r,e,i)}function Nze(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(i=>({name:i.name,code:i.id})):[]}:null}function Fze(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=b5(t,s,e,r);if(i===void 0)try{i=e.field(t)}catch{return null}return zye(n,i)}function Uze(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;if(i===void 0){try{i=e.field(t)}catch{return null}return i}return Bye(b5(t,s,e,r),i)}function kze(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const i=[];for(const r of t.fields)i.push(nze(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:ete[t.geometryType]===void 0?"":ete[t.geometryType],fields:i}}const dbt=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:Lye,ImplicitResultE:Nye,NativeFunctionE:dX,SizzleFunctionE:pX,NativeFunction:oze,ImplicitResult:aze,ReturnResult:lze,SizzleFunction:cze,voidOperation:Qc,breakResult:uze,continueResult:hze,multiReplace:xO,isFunctionParameter:fX,isSimpleType:GN,defaultUndefined:dze,isString:Vo,isBoolean:rl,isNumber:sl,isInteger:pze,isArray:Ph,isFeature:fze,isFeatureSet:mze,isFeatureSetCollection:gze,isImmutableArray:Yb,isDate:wa,pcCheck:yze,absRound:vze,generateUUID:_ze,formatNumber:mX,formatDate:_5,standardiseDateFormat:Fye,greaterThanLessThan:bze,equalityTest:Uye,toString:pv,toNumberArray:wze,toStringExplicit:CD,toNumber:Cs,toDate:xze,toDateTime:Tze,toBoolean:Sze,fixSpatialReference:Eze,fixNullGeometry:Cze,getDomainValue:zye,getDomainCode:Bye,getDomain:b5,stableStringify:jG,autoCastFeatureToGeometry:Aze,autoCastArrayOfPointsToPolygon:Rze,autoCastArrayOfPointsToPolyline:Oze,autoCastArrayOfPointsToMultiPoint:Mze,toStringArray:Pze,tick:Ize,binaryOperator:$ze,castAsJson:TO,castAsJsonAsync:gX,featureFullDomain:Lze,featureSubtypes:Nze,featureDomainValueLookup:Fze,featureDomainCodeLookup:Uze,featureSchema:kze},Symbol.toStringTag,{value:"Module"}));var HG;let i0=HG=class extends ye{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new HG({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],i0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],i0.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],i0.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],i0.prototype,"maxValue",void 0),u([d(UM)],i0.prototype,"symbol",void 0),i0=HG=u([P("esri.renderers.support.ClassBreakInfo")],i0);const HN=i0;var qG;const AP=fe.getLogger("esri.renderers.ClassBreaksRenderer"),Vye="log",AD="percent-of-total",RD="field",RP=new xi({esriNormalizeByLog:Vye,esriNormalizeByPercentOfTotal:AD,esriNormalizeByField:RD}),zze=Ds(HN);let _n=qG=class extends rE(jg){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new HN;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(AP.error(".field: field must be a string value"),null):EM(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&RD||i&&AD||null,t&&i&&AP.warn("warning: both normalizationField and normalizationTotal are set!")):e!==RD&&e!==AD||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new HN({minValue:e,maxValue:t,symbol:vde(i)}):zze(ie(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(A(t)||A(t.arcade))&&AP.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(A(t)||A(t.arcade))&&(i=ve(F({},i),{arcade:await Cf()}));const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(A(t)||A(t.arcade)))return void AP.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(A(t)||A(t.arcade))){const s=await Cf(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=ve(F({},i),{arcade:s})}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new qG({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ie(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ie(this.visualVariables),legendOptions:ie(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),yl(e,t,this.valueExpression)];Eh(e,t,this.field),Eh(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=vt(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,o=parseFloat(i[this.normalizationField]);if(r===Vye)s=Math.log(s)*Math.LOG10E;else if(r!==AD||isNaN(n)){if(r===RD&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};u([d(ope)],_n.prototype,"backgroundFillSymbol",void 0),u([d({type:[HN]})],_n.prototype,"classBreakInfos",void 0),u([Pe("classBreakInfos")],_n.prototype,"readClassBreakInfos",null),u([He("classBreakInfos")],_n.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],_n.prototype,"defaultLabel",void 0),u([d(UM)],_n.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],_n.prototype,"field",void 0),u([jt("field")],_n.prototype,"castField",null),u([d({type:Boolean})],_n.prototype,"isMaxInclusive",void 0),u([d({type:fS,json:{write:!0}})],_n.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],_n.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],_n.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>hh(e),json:{write:!0}})],_n.prototype,"normalizationTotal",void 0),u([d({type:RP.apiValues,value:null,json:{type:RP.jsonValues,read:RP.read,write:RP.write}})],_n.prototype,"normalizationType",null),u([ot({classBreaks:"class-breaks"})],_n.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],_n.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],_n.prototype,"valueExpressionTitle",void 0),_n=qG=u([P("esri.renderers.ClassBreaksRenderer")],_n);const Gye=_n;class Bze{constructor(t,i){this._storage=new YW,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const ite=fe.getLogger("esri.renderers.support.DictionaryLoader"),Vze={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class yX{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new Bze(100),this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(jr(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m];if(y&&t.attributes[y]!=null){const v=""+t.attributes[y];s[m]=v}else s[m]=""}const n=r(s,i);if(!n||typeof n!="string")return null;const o=IH(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const y=m.substr(3).split("|");if(y.length===3){const v=y[0],w=y[1];let b=y[2];if(w==="DashTemplate")b=b.split(" ").map(S=>Number(S));else if(w==="Color"){const S=new qe(b).toRgba();b=[S[0],S[1],S[2],255*S[3]]}else b=Number(b);h.push({primitiveName:v,propertyName:w,value:b})}}else if(m.includes("|")){for(const y of m.split("|"))if(this._itemNames.has(y)){c.push(y);break}}else this._itemNames.has(m)&&c.push(m);const p=!_(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void ite.error("no valid URL!");const i=ai(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:_(t)?t.signal:null}),[{data:r}]=await Promise.all([i,Cf()]);if(!r)throw this._dictionaryPromise=null,new H("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const l=this.config;for(const c in l)o[c]=l[c]}if(n.configuration)for(const l of n.configuration)o.hasOwnProperty(l.name)||(o[l.name]=l.value);const a=[];if(_(t)&&t.fields&&this.fieldMap)for(const l of this._symbolFields){const c=this.fieldMap[l],h=t.fields.filter(p=>p.name===c);h.length>0&&a.push(ve(F({},h[0]),{name:l}))}return this._dictionaryPromise=IAe(s,_(t)?t.spatialReference:null,a,o).then(l=>{const c={scale:0};return(h,p)=>{const f=l.repurposeFeature({geometry:null,attributes:h});return c.scale=_(p)?p.scale:void 0,l.evaluate({$feature:f,$view:c})}}).catch(l=>(ite.error("Creating dictinoary expression failed:",l),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;for(const l of o)jye(l,a);return new Q2({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=ai(r,F({responseType:"json",query:{f:"json"}},i));this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s=F({},t[0]);if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=Vze),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function jye(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&Gze(s,t)}}function Gze(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":jye(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var pbt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DictionaryLoader:yX}),WG;let pd=WG=class extends rE(jg){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new yX(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){(r==null?void 0:r.origin)||super.writeVisualVariables(e,t,i,r)}clone(){return new WG({config:ie(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ie(this.fieldMap),url:ie(this.url),visualVariables:ie(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await yl(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:yX})],pd.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],pd.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],pd.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],pd.prototype,"scaleExpression",void 0),u([He("scaleExpression")],pd.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],pd.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],pd.prototype,"url",void 0),u([He("visualVariables")],pd.prototype,"writeVisualVariables",null),pd=WG=u([P("esri.renderers.DictionaryRenderer")],pd);const jze=pd;var XG;const Hze=fe.getLogger("esri.renderers.support.AttributeColorInfo");let Am=XG=class extends ye{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(Hze.error(".field: field must be a string value"),null):EM(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new XG({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:qe,json:{type:[Number],write:!0}})],Am.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Am.prototype,"field",void 0),u([jt("field")],Am.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Am.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],Am.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Am.prototype,"valueExpressionTitle",void 0),Am=XG=u([P("esri.renderers.support.AttributeColorInfo")],Am);const Hye=Am;var YG;let OD=YG=class extends ye{constructor(){super(...arguments),this.unit=null}clone(){return new YG({unit:this.unit})}};u([d({type:String,json:{write:!0}})],OD.prototype,"unit",void 0),OD=YG=u([P("esri.renderers.support.DotDensityLegendOptions")],OD);const qze=OD;var ZG;let la=ZG=class extends rE(jg){constructor(e){super(e),this.attributes=null,this.backgroundColor=new qe([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Uh,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new Wv({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new ZG({attributes:ie(this.attributes),backgroundColor:ie(this.backgroundColor),dotBlendingEnabled:ie(this.dotBlendingEnabled),dotShape:ie(this.dotShape),dotSize:ie(this.dotSize),dotValue:ie(this.dotValue),legendOptions:ie(this.legendOptions),outline:ie(this.outline),referenceScale:ie(this.referenceScale),visualVariables:ie(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await yl(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[Hye],json:{write:!0}})],la.prototype,"attributes",void 0),u([d({type:qe,json:{write:!0}})],la.prototype,"backgroundColor",void 0),u([d({type:Boolean}),ut("dotBlendingEnabled")],la.prototype,"blendDots",void 0),u([d({type:Boolean,json:{write:!0}})],la.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],la.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],la.prototype,"dotSize",void 0),u([d({type:qze,json:{write:!0}})],la.prototype,"legendOptions",void 0),u([d({type:Uh,json:{default:null,write:!0}})],la.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],la.prototype,"dotValue",void 0),u([d({type:Number}),ut("dotValue")],la.prototype,"referenceDotValue",void 0),u([d({type:Number,json:{write:!0}})],la.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],la.prototype,"seed",void 0),u([ot({dotDensity:"dot-density"})],la.prototype,"type",void 0),la=ZG=u([P("esri.renderers.DotDensityRenderer")],la);const Wze=la;let nT=class extends mc(ye){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],nT.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],nT.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],nT.prototype,"title",void 0),nT=u([P("esri.renderers.support.HeatmapLegendOptions")],nT);const vX=2.4;function Xze(e){return yu(e*vX)}function Yze(e){return eo(e)/vX}function Zze(e,t,i,r){let{color:s,ratio:n}=t,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=De((r-n)/(a-n),0,1);_4(e,s.toArray(),o.toArray(),l)}function fbt(e){const i=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return i;let r=e[0],s=e[0],n=1;const o=Gt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)r=s,s=e[n++];Zze(o,r,s,l),i.set(o,4*a)}return i}function mbt(e,t,i,r){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round(eo(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=Jze(o,n),f=new Set;for(const m of e){const y=m.getCursor();for(;y.next();){const v=y.getObjectId();if(f.has(v))continue;f.add(v);const w=y.readLegacyPointGeometry(),b=128;if(w.x<-b||w.x>=i+b||w.y<-b||w.y>r+b)continue;const S=+p(y),T=Math.max(0,Math.round(w.x)-a),E=Math.max(0,Math.round(w.y)-a),C=Math.min(r,Math.round(w.y)+a),O=Math.min(i,Math.round(w.x)+a);for(let I=E;I<C;I++)for(let N=T;N<O;N++){const D=I*i+N,z=Qze(w.x-N,w.y-I,a);c=l[D]+=z*S,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function Qze(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function gbt(e,t){return typeof e=="function"?e:e?typeof t=="string"?i=>-1*+i[e]:i=>+i[e]+t:()=>1}function Jze(e,t){return e!=null?typeof t=="string"?i=>-1*+i.readAttribute(e):i=>+i.readAttribute(e)+t:i=>1}var QG;const Kze=fe.getLogger("esri.renderers.HeatmapRenderer");function rte(e){if(e!=null){const{maxDensity:i,minDensity:r,radius:s}=e;if(i!=null||r!=null||s!=null){const t=e,{blurRadius:n,maxPixelIntensity:o,minPixelIntensity:a}=t;return F3(t,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return e}let kn=QG=class extends jg{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new xR({ratio:0,color:new qe("rgba(255, 140, 0, 0)")}),new xR({ratio:.75,color:new qe("rgba(255, 140, 0, 1)")}),new xR({ratio:.9,color:new qe("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return rte(e)}get blurRadius(){return Yze(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",Xze(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(vX**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||Xo(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,Y2(()=>{nCe(Kze,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=rte(e),super.read(e,t)}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(this.radius*e,yu(256));return new Xv({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await Eh(e,t,i),r&&typeof r=="string"&&await yl(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new QG({colorStops:ie(this.colorStops),field:this.field,legendOptions:ie(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:wde,json:{write:!1}})],kn.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],kn.prototype,"blurRadius",null),u([d({type:[xR],json:{write:!0}})],kn.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],kn.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],kn.prototype,"fieldOffset",void 0),u([d({type:nT,json:{write:!0}})],kn.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],kn.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],kn.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],kn.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],kn.prototype,"minPixelIntensity",null),u([d({type:Number,cast:Ji,json:{write:!0}})],kn.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],kn.prototype,"referenceScale",void 0),u([ot({heatmap:"heatmap"})],kn.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],kn.prototype,"valueExpression",void 0),u([d({type:String})],kn.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],kn.prototype,"_pixelIntensityToDensity",null),kn=QG=u([P("esri.renderers.HeatmapRenderer")],kn);const qye=kn;let H1=class extends mc(ye){constructor(){super(...arguments),this.color=new qe([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:qe,json:{write:!0}})],H1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],H1.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],H1.prototype,"threshold",void 0),H1=u([P("esri.renderers.support.OthersCategory")],H1);let MD=class extends mc(ye){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],MD.prototype,"title",void 0),MD=u([P("esri.renderers.support.PieChartLegendOptions")],MD);let Ic=class extends rE(mc(jg)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new qe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new H1,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new Xv({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await yl(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[Hye],json:{write:!0}})],Ic.prototype,"attributes",void 0),u([d({type:Wv,json:{default:null,write:!0}})],Ic.prototype,"backgroundFillSymbol",void 0),u([d({type:qe,json:{write:!0}})],Ic.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],Ic.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Ic.prototype,"holePercentage",void 0),u([d({type:H1,json:{write:!0}})],Ic.prototype,"othersCategory",void 0),u([d({type:MD,json:{write:!0}})],Ic.prototype,"legendOptions",void 0),u([d({type:Uh,json:{default:null,write:!0}})],Ic.prototype,"outline",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Ic.prototype,"size",void 0),u([ot({pieChart:"pie-chart"})],Ic.prototype,"type",void 0),Ic=u([P("esri.renderers.PieChartRenderer")],Ic);const eBe=Ic;var JG;let d1=JG=class extends rE(jg){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new JG({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ie(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],d1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],d1.prototype,"label",void 0),u([d(UM)],d1.prototype,"symbol",void 0),u([ot({simple:"simple"})],d1.prototype,"type",void 0),d1=JG=u([P("esri.renderers.SimpleRenderer")],d1);const _X=d1,w5={key:"type",base:jg,typeMap:{heatmap:qye,simple:_X,"unique-value":Qq,"class-breaks":Gye,"dot-density":Wze,dictionary:jze,"pie-chart":eBe},errorContext:"renderer"},Wye={key:"type",base:jg,typeMap:{simple:_X,"unique-value":Qq,"class-breaks":Gye,heatmap:qye},errorContext:"renderer"},tBe=X2({types:w5});function iBe(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Ma("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):tBe(e,t,i):null}class bX{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(A8),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new bX,r=this._originStores[yi.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,ie(s),yi.DEFAULTS)});for(let s=yi.SERVICE;s<A8;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||i.set(a,ie(o),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=yi.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=yi.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||yi.DEFAULTS}forEach(t){this._values.forEach(t)}}const Xye=e=>{let t=class extends e{constructor(...i){super(...i);const r=Xo(this),s=r.store,n=new bX;r.store=n,rue(r,s,n)}read(i,r){nue(this,i,r)}getAtOrigin(i,r){const s=T6(this),n=ng(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return YL(this.originIdOf(i))}originIdOf(i){return T6(this).originOf(i)}revert(i,r){const s=T6(this),n=ng(r),o=Xo(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function T6(e){return Xo(e).store}let ste=class extends Xye(Ee){};ste=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],ste);const rBe=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return S6(this).delete(i,ng(r))}write(i={},r){return aue(this,i=i||{},r),i}setAtOrigin(i,r,s){Xo(this).setAtOrigin(i,r,ng(s))}removeOrigin(i){const r=S6(this),s=ng(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),yi.USER)}updateOrigin(i,r){const s=S6(this),n=ng(r),o=this.get(i);for(let a=n+1;a<A8;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return t=u([P("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function S6(e){return Xo(e).store}const x5=e=>{let t=class extends rBe(Xye(e)){constructor(...i){super(...i)}};return t=u([P("esri.core.MultiOriginJSONSupport")],t),t};let nte=class extends x5(Ee){};nte=u([P("esri.core.MultiOriginJSONSupport")],nte);async function sBe(e,t){const{WhereClause:i}=await import("./WhereClause.d6b5dcf7.js");return i.create(e,t)}function nBe(e,t){return _(e)?_(t)?`(${e}) AND (${t})`:e:t}var KG;let p1=KG=class extends ye{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new KG({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],p1.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],p1.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],p1.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],p1.prototype,"title",void 0),p1=KG=u([P("esri.form.ExpressionInfo")],p1);const oBe=p1;let f1=class extends ye{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],f1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],f1.prototype,"label",void 0),u([d()],f1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],f1.prototype,"visibilityExpression",void 0),f1=u([P("esri.form.elements.Element")],f1);const d2=f1;var e7;let PD=e7=class extends ye{constructor(e){super(e),this.type=null}clone(){return new e7({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],PD.prototype,"type",void 0),PD=e7=u([P("esri.form.elements.inputs.AttachmentInput")],PD);const aBe=PD;var t7;let m1=t7=class extends d2{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new t7({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],m1.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],m1.prototype,"editable",void 0),u([d({type:aBe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],m1.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],m1.prototype,"type",void 0),m1=t7=u([P("esri.form.elements.AttachmentElement")],m1);const ote=m1;let ID=class extends ye{constructor(e){super(e),this.type=null}};u([d()],ID.prototype,"type",void 0),ID=u([P("esri.form.elements.inputs.Input")],ID);const pE=ID;let EA=class extends pE{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],EA.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],EA.prototype,"minLength",void 0),EA=u([P("esri.form.elements.inputs.TextInput")],EA);const wX=EA;var i7;let $D=i7=class extends wX{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new i7({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],$D.prototype,"type",void 0),$D=i7=u([P("esri.form.elements.inputs.BarcodeScannerInput")],$D);const lBe=$D;var r7;let oT=r7=class extends pE{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new r7({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],oT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],oT.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],oT.prototype,"type",void 0),oT=r7=u([P("esri.form.elements.inputs.ComboBoxInput")],oT);const cBe=oT;var s7;function ate(e){return e!=null?new Date(e):null}function lte(e){return e?e.getTime():null}let fd=s7=class extends pE{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return ate(t.max)}writeMax(e,t){t.max=lte(e)}readMin(e,t){return ate(t.min)}writeMin(e,t){t.min=lte(e)}clone(){return new s7({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([d({type:Boolean,json:{write:!0}})],fd.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],fd.prototype,"max",void 0),u([Pe("max")],fd.prototype,"readMax",null),u([He("max")],fd.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],fd.prototype,"min",void 0),u([Pe("min")],fd.prototype,"readMin",null),u([He("min")],fd.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],fd.prototype,"type",void 0),fd=s7=u([P("esri.form.elements.inputs.DateTimePickerInput")],fd);const uBe=fd;var n7;let aT=n7=class extends pE{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new n7({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],aT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],aT.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],aT.prototype,"type",void 0),aT=n7=u([P("esri.form.elements.inputs.RadioButtonsInput")],aT);const hBe=aT;var o7;let lT=o7=class extends pE{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new o7({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],lT.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],lT.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],lT.prototype,"type",void 0),lT=o7=u([P("esri.form.elements.inputs.SwitchInput")],lT);const dBe=lT;var a7;let DD=a7=class extends wX{constructor(e){super(e),this.type="text-area"}clone(){return new a7({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],DD.prototype,"type",void 0),DD=a7=u([P("esri.form.elements.inputs.TextAreaInput")],DD);const pBe=DD;var l7;let LD=l7=class extends wX{constructor(e){super(e),this.type="text-box"}clone(){return new l7({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],LD.prototype,"type",void 0),LD=l7=u([P("esri.form.elements.inputs.TextBoxInput")],LD);const fBe=LD,mBe={base:pE,key:"type",typeMap:{"barcode-scanner":lBe,"combo-box":cBe,"datetime-picker":uBe,"radio-buttons":hBe,switch:dBe,"text-area":pBe,"text-box":fBe}};var c7;let Wu=c7=class extends d2{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new c7({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:hge,json:{read:{reader:ZW},write:!0}})],Wu.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],Wu.prototype,"editable",void 0),u([d({type:String,json:{write:!0}})],Wu.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],Wu.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],Wu.prototype,"hint",void 0),u([d({types:mBe,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Wu.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],Wu.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],Wu.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Wu.prototype,"valueExpression",void 0),Wu=c7=u([P("esri.form.elements.FieldElement")],Wu);const cte=Wu;var u7;let Rm=u7=class extends d2{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new u7({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:ie(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],Rm.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Rm.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],Rm.prototype,"editable",void 0),u([d({type:[kde],json:{write:!0}})],Rm.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],Rm.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],Rm.prototype,"type",void 0),Rm=u7=u([P("esri.form.elements.RelationshipElement")],Rm);const ute=Rm;function Yye(e){return{typesWithGroup:{base:d2,key:"type",typeMap:{attachment:ote,field:cte,group:e,relationship:ute}},typesWithoutGroup:{base:d2,key:"type",typeMap:{attachment:ote,field:cte,relationship:ute}}}}function Zye(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function Qye(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function Jye(e,t,i=!0){return e?e.map(r=>tp(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var h7;let ef=h7=class extends d2{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return Jye(e,E6,!1)}readElements(e,t){return Zye(t.formElements,E6,!1)}writeElements(e,t){t.formElements=Qye(e,E6,!1)}clone(){return new h7({description:this.description,elements:ie(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],ef.prototype,"elements",void 0),u([jt("elements")],ef.prototype,"castElements",null),u([Pe("elements",["formElements"])],ef.prototype,"readElements",null),u([He("elements")],ef.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],ef.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],ef.prototype,"type",void 0),ef=h7=u([P("esri.form.elements.GroupElement")],ef);const E6=Yye(ef),gBe=ef;var d7;const C6=Yye(gBe);let zp=d7=class extends ye{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return Jye(e,C6)}readElements(e,t){return Zye(t.formElements,C6)}writeElements(e,t){t.formElements=Qye(e,C6)}clone(){return new d7({description:this.description,expressionInfos:ie(this.expressionInfos),elements:ie(this.elements),title:this.title})}};u([d({type:String,json:{write:!0}})],zp.prototype,"description",void 0),u([d({json:{write:!0}})],zp.prototype,"elements",void 0),u([jt("elements")],zp.prototype,"castElements",null),u([Pe("elements",["formElements"])],zp.prototype,"readElements",null),u([He("elements")],zp.prototype,"writeElements",null),u([d({type:[oBe],json:{write:!0}})],zp.prototype,"expressionInfos",void 0),u([d({type:String,json:{write:!0}})],zp.prototype,"title",void 0),zp=d7=u([P("esri.form.FormTemplate")],zp);const yBe=zp,vBe=fe.getLogger("esri.layers.support.fromPortalItem");async function _Be(e){const t="portalItem"in e?e:{portalItem:e},i=await import("./portalLayers.1f3e50d0.js");try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Di.portalUrl;throw vBe.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let bBe=0,zn=class extends Kr.EventedMixin(Hq(Ig)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ri(-180,-90,180,90,Ke.WGS84),this.id=Date.now().toString(16)+"-layer-"+bBe++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Ke.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await import("./arcgisLayers.a576c95f.js")).fromUrl(t)}static fromPortalItem(e){return _Be(e)}initialize(){this.when().catch(e=>{var t,i;jr(e)||fe.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?Mn(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ai(e,{query:{f:"json"},responseType:"json"})).data;throw new H("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],zn.prototype,"attributionDataUrl",void 0),u([d({type:ri})],zn.prototype,"fullExtent",void 0),u([d({readOnly:!0})],zn.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],zn.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],zn.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],zn.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],zn.prototype,"opacity",void 0),u([d({clonable:!1})],zn.prototype,"parent",void 0),u([d({readOnly:!0})],zn.prototype,"parsedUrl",null),u([d({type:Boolean})],zn.prototype,"popupEnabled",void 0),u([d({type:Boolean})],zn.prototype,"attributionVisible",void 0),u([d({type:Ke})],zn.prototype,"spatialReference",void 0),u([d({type:String})],zn.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],zn.prototype,"type",void 0),u([d()],zn.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],zn.prototype,"visible",void 0),zn=u([P("esri.layers.Layer")],zn);const p2=zn;function hte(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function wBe(e,t,i){if(!e&&!t||!i)return;const r=JS(i);dte(e,i,r),dte(t,i,r)}function dte(e,t,i){if(e)for(const r of e)xBe(r.geometry,t,i)}function xBe(e,t,i){if(A(e)||!e.spatialReference||pc(e.spatialReference,t))return;const r=JS(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)hte(e,e.rings,r);else if("paths"in e)hte(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}let TBe=0;const A6=fe.getLogger("esri.layers.graphics.sources.MemorySource");let Hm=class extends Ig.LoadableMixin(O4(Ow(ft))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);CG(e,this.layer.spatialReference,i);const r=f5.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new H("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return CG(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:ri.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new H("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&r.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}wBe(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||A(e))return;const i=[];for(const{geometry:r}of e)!_(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new H("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!r&&_(o.geometry)&&(r=o.geometry.type),i[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return(i=(e=this.layer)==null?void 0:e.geometryType)!=null?i:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(TBe++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return A(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?Ao.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await mpe("MemorySourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{A6.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:QQ.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)A6.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&A6.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=QQ.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([Pq({Type:Pa,ensureType:Ds(Pa)})],Hm.prototype,"itemType",void 0),u([d()],Hm.prototype,"type",void 0),u([d({constructOnly:!0})],Hm.prototype,"layer",void 0),u([d({readOnly:!0})],Hm.prototype,"workerGeometryType",null),u([d()],Hm.prototype,"sourceJSON",void 0),Hm=u([P("esri.layers.graphics.sources.MemorySource")],Hm);function SBe(e){return"portalItem"in e}const xX=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):SBe(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([P("esri.layers.mixins.APIKeyMixin")],t),t},Kye={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},e0e=Object.values(Kye),t0e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${e0e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),EBe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${e0e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),CBe=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function ybt(e){return!!t0e.test(e)}function Zb(e){if(A(e))return null;const t=Mn(e),i=t.path.match(t0e)||t.path.match(EBe);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:T5(a!==-1?s.slice(a+1):s),serverType:Kye[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function ABe(e){const t=Mn(e).path.match(CBe);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function T5(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function i0e(e,t){const i=[];if(e){const r=Zb(e);_(r)&&r.title&&i.push(r.title)}if(t){const r=T5(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function r0e(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(i)||e.includes(r)||e.includes(s);return n&&o}function RBe(e,t){return e&&Lhe(Nhe(e,t))}function s0e(e){let{url:t}=e;if(!t)return{url:t};t=Nhe(t,e.logger);const i=Mn(t),r=Zb(i.path);let s;if(_(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=ABe(i.path);_(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:Lhe(t),layerId:s}}function n0e(e,t,i,r,s){Sv(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=vl(r.url,i,e.layerId.toString()))}function vbt(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}const TX=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=Zb(this.url);if(_(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",RBe(i,fe.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([P("esri.layers.mixins.ArcGISService")],t),t},pte={read:{reader:WW},write:{allowNull:!0,writer:XW}},OBe=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":pte,"portal-item":pte}}})],t.prototype,"effect",void 0),t=u([P("esri.layers.mixins.BlendLayer")],t),t},MBe=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([P("esri.layers.mixins.CustomParametersMixin")],t),t};var p7;const R6=new xi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),O6=new xi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Bp=p7=class extends ye{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new _h(F({geometry:ie(i),objectIds:ie(n),spatialRelationship:r,timeExtent:ie(s),where:t,units:o,distance:a},e))}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new p7({geometry:ie(t),objectIds:ie(s),spatialRelationship:i,timeExtent:ie(r),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],Bp.prototype,"where",void 0),u([d({types:Tw,json:{write:!0}})],Bp.prototype,"geometry",void 0),u([d({type:R6.apiValues,json:{name:"spatialRel",read:{reader:R6.read},write:{allowNull:!1,writer:R6.write,overridePolicy(){return{enabled:_(this.geometry)}}}}})],Bp.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Bp.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],Bp.prototype,"objectIds",void 0),u([d({type:O6.apiValues,json:{read:O6.read,write:{writer:O6.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Bp.prototype,"units",void 0),u([d({type:qf,json:{write:!0}})],Bp.prototype,"timeExtent",void 0),Bp=p7=u([P("esri.layers.support.FeatureFilter")],Bp);const PBe=Bp;var f7;const fte={read:{reader:WW},write:{writer:XW,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},mte={read:{reader:WW},write:{writer:XW,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},gte={name:"showExcludedLabels",default:!0};let g1=f7=class extends ye{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var r,s;const i=super.write(e,t);if(t==null?void 0:t.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new H("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new H("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new f7({filter:_(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:PBe,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?lc(i,s,t):lc(i,null,t)}}}})],g1.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":fte,"portal-item":fte}}})],g1.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":mte,"portal-item":mte}}})],g1.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":gte,"portal-item":gte}}})],g1.prototype,"excludedLabelsVisible",void 0),g1=f7=u([P("esri.layers.support.FeatureEffect")],g1);const IBe=g1,yte={write:{allowNull:!0}},$Be=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:IBe,json:{origins:{"web-map":yte,"portal-item":yte}}})],t.prototype,"featureEffect",void 0),t=u([P("esri.layers.mixins.FeatureEffectLayer")],t),t},DBe={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function LBe(e){if(!e)return e;const{start:t,end:i}=e;return new qf({start:_(t)?Rb(t,-t.getTimezoneOffset(),"minutes"):t,end:_(i)?Rb(i,-i.getTimezoneOffset(),"minutes"):i})}function NBe(e){if(!e)return e;const{start:t,end:i}=e;return new qf({start:_(t)?Rb(t,t.getTimezoneOffset(),"minutes"):t,end:_(i)?Rb(i,i.getTimezoneOffset(),"minutes"):i})}var m7;let CA=m7=class extends ye{async collectRequiredFields(e,t){return yl(e,t,this.expression)}clone(){return new m7({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([d({type:String,json:{write:!0}})],CA.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],CA.prototype,"title",void 0),CA=m7=u([P("esri.layers.support.FeatureExpressionInfo")],CA);const vte=CA;function FBe(e){return KS[e]!=null}function UBe(e){return 1/(KS[e]||1)}function kBe(){const e=Object.keys(KS);return e.sort(),e}const zBe=kBe();var g7;const OP=Ko()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),_te=new xi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Om=g7=class extends ye{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):_(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new g7({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&k2e(this.featureExpressionInfo,e.featureExpressionInfo)}};u([d({type:vte,json:{write:!0}})],Om.prototype,"featureExpressionInfo",void 0),u([Pe("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Om.prototype,"readFeatureExpressionInfo",null),u([He("featureExpressionInfo",{featureExpressionInfo:{type:vte},"featureExpression.value":{type:[0]}})],Om.prototype,"writeFeatureExpressionInfo",null),u([d({type:OP.apiValues,nonNullable:!0,json:{type:OP.jsonValues,read:OP.read,write:{writer:OP.write,isRequired:!0}}})],Om.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],Om.prototype,"offset",void 0),u([d({type:zBe,json:{type:String,read:_te.read,write:_te.write}})],Om.prototype,"unit",null),Om=g7=u([P("esri.layers.support.ElevationInfo")],Om);const BBe=Om,o0e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},S5={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},E5={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},a0e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Sv}}},l0e={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},SX={value:null,type:BBe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function _bt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const ND={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},VBe=ve(F({},ND),{json:ve(F({},ND.json),{origins:{"web-document":ve(F({},ND.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?qS(t.layerDefinition.drawingInfo.transparency):void 0:qS(t.drawingInfo.transparency)}})}),bbt={type:qf,readOnly:!0,get(){var a,l;if(!((a=this.layer)==null?void 0:a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=NBe(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=LBe(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},wbt={type:ri,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=ri.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=Ke.fromJSON(t.spatialReference)),i}}}},read:!1}},c0e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},GBe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},jBe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},u0e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},EX=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&kCe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i||"Layer"}read(i,r){r&&(r.layer=this),LCe(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r==null?void 0:r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=DBe[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new H("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,ve(F({},r),{layer:this})),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof H&&l.name==="web-document-write:property-required").length;return Tv(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new H("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(u0e)],t.prototype,"listMode",void 0),u([He("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([He("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(ND)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([He([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([P("esri.layers.mixins.OperationalLayer")],t),t};var y7;const M6=new xi({asc:"ascending",desc:"descending"});let cT=y7=class extends ye{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new y7({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],cT.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],cT.prototype,"valueExpression",void 0),u([d({type:M6.apiValues,json:{read:M6.read,write:M6.write}})],cT.prototype,"order",void 0),cT=y7=u([P("esri.layers.support.OrderByInfo")],cT);const h0e=cT;function HBe(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new h0e;return s.read(r,i),[s]}function qBe(e,t,i,r){const s=e.find(n=>!!n.field);s&&lc(i,[s.toJSON()],t)}const WBe=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[h0e],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:HBe},write:{target:"layerDefinition.orderBy",writer:qBe}}})],t.prototype,"orderBy",void 0),t=u([P("esri.layers.mixins.OrderedLayer")],t),t},XBe=fe.getLogger("esri.portal.PortalItemResource");let r0=class extends Ee{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?ve(F({},e),{path:this._normalizePath(e.path,e.portalItem)}):e}set path(e){_(e)&&oc(e)?XBe.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(A(i))throw new H("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:Tr(t,"signal")})}async update(e,t){return(await Promise.resolve().then(function(){return iR})).addOrUpdateResource(this,"update",e,t)}hasPath(){return _(this.path)}_normalizePath(e,t){return A(e)?e:(e=e.replace(/^\/+/,""),_(t)&&oc(e)&&(e=Cq(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],r0.prototype,"portalItem",void 0),u([d({type:String,value:null})],r0.prototype,"path",null),u([jt("path")],r0.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],r0.prototype,"url",null),u([d({type:String,readOnly:!0})],r0.prototype,"itemRelativeUrl",null),r0=u([P("esri.portal.PortalItemResource")],r0);const YBe=r0;let AA=class extends Ee{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],AA.prototype,"created",void 0),u([d()],AA.prototype,"rating",void 0),AA=u([P("esri.portal.PortalRating")],AA);const P6=AA;var uT;let ni=uT=class extends bw(Ig){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return LS(uT,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(i="Instant App"),i}readExtent(e){return e&&e.length?new ri(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",s?Pi(i+s+r+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Ro.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:_(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof P6&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new P6({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:ie(this.applicationProxies),avgRating:this.avgRating,categories:ie(this.categories),created:ie(this.created),culture:this.culture,description:this.description,extent:ie(this.extent),groupCategories:ie(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ie(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ie(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:ie(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ie(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new uT({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const i of["tags","typeKeywords","categories"])e[i]&&(e[i]=e[i].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",ve(F({responseType:e},t),{query:{token:this.apiKey}}))}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",F({query:{token:this.apiKey}},e)).then(t=>t.rating!=null?(t.created=new Date(t.created),new P6(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",F({query:ve(F({},e),{token:this.apiKey})},t),uT)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")Gf(t)?r.query={data:t}:r.query={url:xh(t)},_(i)&&(r.query.filename=i);else{const s=new FormData;_(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await Promise.resolve().then(function(){return iR})).fetchResources(this,e,t)}async addResource(e,t,i){const r=await Promise.resolve().then(function(){return iR});return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await Promise.resolve().then(function(){return iR});if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new H("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await Promise.resolve().then(function(){return iR})).removeAllResources(this,e)}resourceFromPath(e){return new YBe({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:ie(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:ie(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ie(this.typeKeywords),url:this.url};return hce(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new uT({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],ni.prototype,"access",void 0),u([d()],ni.prototype,"accessInformation",void 0),u([d({type:String})],ni.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],ni.prototype,"applicationProxies",void 0),u([d()],ni.prototype,"avgRating",void 0),u([d()],ni.prototype,"categories",void 0),u([d({type:Date})],ni.prototype,"created",void 0),u([d()],ni.prototype,"culture",void 0),u([d()],ni.prototype,"description",void 0),u([d({readOnly:!0})],ni.prototype,"displayName",null),u([d({type:ri})],ni.prototype,"extent",void 0),u([Pe("extent")],ni.prototype,"readExtent",null),u([d()],ni.prototype,"groupCategories",void 0),u([d({readOnly:!0})],ni.prototype,"iconUrl",null),u([d()],ni.prototype,"id",void 0),u([d({readOnly:!0})],ni.prototype,"isLayer",null),u([d()],ni.prototype,"itemControl",void 0),u([d({readOnly:!0})],ni.prototype,"itemUrl",null),u([d()],ni.prototype,"licenseInfo",void 0),u([d({type:Date})],ni.prototype,"modified",void 0),u([d()],ni.prototype,"name",void 0),u([d()],ni.prototype,"numComments",void 0),u([d()],ni.prototype,"numRatings",void 0),u([d()],ni.prototype,"numViews",void 0),u([d()],ni.prototype,"owner",void 0),u([d()],ni.prototype,"ownerFolder",void 0),u([d({type:Ro})],ni.prototype,"portal",void 0),u([d()],ni.prototype,"screenshots",void 0),u([d()],ni.prototype,"size",void 0),u([d()],ni.prototype,"snippet",void 0),u([d()],ni.prototype,"sourceJSON",void 0),u([d({type:String})],ni.prototype,"spatialReference",void 0),u([d()],ni.prototype,"tags",void 0),u([d()],ni.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ni.prototype,"thumbnailUrl",null),u([d()],ni.prototype,"title",void 0),u([d()],ni.prototype,"type",void 0),u([d()],ni.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var r;if(t.type!=="KML")return e;const i=(r=this.portal)==null?void 0:r.restUrl;return e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null),e}}})],ni.prototype,"url",void 0),u([d({readOnly:!0})],ni.prototype,"userItemUrl",null),ni=uT=u([P("esri.portal.PortalItem")],ni);const f2=ni;var d0e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:f2});const ZBe=fe.getLogger("esri.layers.mixins.PortalLayer"),CX=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var i;(i=this.portalItem)==null||i.destroy(),this.portalItem=null}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new f2({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await import("./layersLoader.20d74695.js").then(function(n){return n.l});return hi(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData},r)}catch(s){throw jr(s)||ZBe.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(nc(r),!0)))}async _fetchUserHasEditingPrivileges(i){const r=this.url?Zr==null?void 0:Zr.findCredential(this.url):null;if(!r)return!0;const s=MP.credential===r?MP.user:await this._fetchEditingUser(i);return MP.credential=r,MP.user=s,A(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const s=Zr.findServerInfo(this.url);if(!(s==null?void 0:s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Ro.getDefault();if(o&&o.loaded&&Xd(o.restUrl)===Xd(n))return o.user;const a=`${n}/community/self`,l=_(i)?i.signal:null,c=await xu(ai(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Dq.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Ro.getDefault());return s&&n&&!Phe(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new H("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,ve(F({},r),{layer:this}))}};return u([d({type:f2})],t.prototype,"portalItem",null),u([Pe("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([He("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([P("esri.layers.mixins.PortalLayer")],t),t},MP={credential:null,user:null},SO=new ft,AR=new WeakMap;function QBe(e){p0e(e)&&SO.push(e)}function JBe(e){p0e(e)&&SO.includes(e)&&SO.remove(e)}function p0e(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function f0e(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:f0e(t,e%t):0}let I6=0,PP=0;function KBe(){var t;const e=Date.now();for(const i of SO)i.refreshInterval&&e-((t=AR.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&(AR.set(i,e),i.refresh(e))}Jce(()=>{const e=Date.now();let t=0;for(const i of SO)t=f0e(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?AR.get(i)||AR.set(i,e):AR.delete(i);if(t!==PP){if(PP=t,clearInterval(I6),PP===0)return void(I6=0);I6=setInterval(KBe,PP)}});function e8e(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const t8e=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=GH(()=>this.hasDataChanged()),this.when().then(()=>{QBe(this)},()=>{})}destroy(){JBe(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){M8(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{fe.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([P("esri.layers.mixins.RefreshableLayer")],t),t},AX=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&i8e(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([P("esri.layers.mixins.ScaleRangeLayer")],t),t};function i8e(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const cb=Ko()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var v7;let RA=v7=class extends ye{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return aUe(this.value,this.unit,"milliseconds")}clone(){return new v7({value:this.value,unit:this.unit})}};u([d({type:Number,json:{write:!0},nonNullable:!0})],RA.prototype,"value",void 0),u([d({type:cb.apiValues,json:{type:cb.jsonValues,read:cb.read,write:cb.write},nonNullable:!0})],RA.prototype,"unit",void 0),RA=v7=u([P("esri.TimeInterval")],RA);const EO=RA;var _7;let hT=_7=class extends ye{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new _7({respectsDaylightSaving:e,timezone:t})}};u([d({type:Boolean,json:{write:!0}})],hT.prototype,"respectsDaylightSaving",void 0),u([Pe("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],hT.prototype,"readRespectsDaylightSaving",null),u([d({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],hT.prototype,"timezone",void 0),hT=_7=u([P("esri.layers.support.TimeReference")],hT);const r8e=hT;var b7;let ca=b7=class extends ye{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new qf({start:i,end:r})}writeFullTimeExtent(e,t){e&&_(e.start)&&_(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new EO({value:t.timeInterval,unit:cb.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new EO({value:t.defaultTimeInterval,unit:cb.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new b7({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:ie(n),fullTimeExtent:ie(o),trackIdField:a,useTime:l})}};u([d({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],ca.prototype,"cumulative",void 0),u([d({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],ca.prototype,"endField",void 0),u([d({type:qf,json:{write:{enabled:!0,allowNull:!0}}})],ca.prototype,"fullTimeExtent",void 0),u([Pe("fullTimeExtent",["timeExtent"])],ca.prototype,"readFullTimeExtent",null),u([He("fullTimeExtent")],ca.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],ca.prototype,"hasLiveData",void 0),u([d({type:EO,json:{write:{enabled:!0,allowNull:!0}}})],ca.prototype,"interval",void 0),u([Pe("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],ca.prototype,"readInterval",null),u([He("interval")],ca.prototype,"writeInterval",null),u([d({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],ca.prototype,"startField",void 0),u([d({type:r8e,json:{write:{enabled:!0,allowNull:!0}}})],ca.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],ca.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],ca.prototype,"useTime",void 0),ca=b7=u([P("esri.layers.support.TimeInfo")],ca);const m0e=ca,s8e=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=cb.fromJSON(s.timeOffsetUnits);return n&&o?new EO({value:n,unit:o}):null}set timeInfo(i){Due(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:qf,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:EO})],t.prototype,"timeOffset",void 0),u([Pe("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:m0e,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([P("esri.layers.mixins.TemporalLayer")],t),t};var w7;let qm=w7=class extends ye{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new w7({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};u([d({constructOnly:!0})],qm.prototype,"name",void 0),u([d({constructOnly:!0})],qm.prototype,"fields",void 0),u([d({constructOnly:!0})],qm.prototype,"isAscending",void 0),u([d({constructOnly:!0})],qm.prototype,"isUnique",void 0),u([d({constructOnly:!0})],qm.prototype,"description",void 0),qm=w7=u([P("esri.layers.support.FeatureIndex")],qm);let gg=class extends ye{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],gg.prototype,"type",void 0),gg=u([P("esri.layers.support.FeatureReduction")],gg);var x7;let dT=x7=class extends ye{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new x7({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};u([d({type:String,json:{write:!0}})],dT.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],dT.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],dT.prototype,"onStatisticValueExpression",void 0),dT=x7=u([P("esri.layers.support.OutStatistic")],dT);const n8e=dT;var T7;let OA=T7=class extends ye{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new T7({name:this.name,outStatistic:this.outStatistic.clone()})}};u([d({type:String,json:{write:!0}})],OA.prototype,"name",void 0),u([d({type:n8e,json:{write:!0}})],OA.prototype,"outStatistic",void 0),OA=T7=u([P("esri.layers.support.AggregateField")],OA);const g0e=OA,RX="__begin__",OX="__end__",o8e=new RegExp(RX,"ig"),a8e=new RegExp(OX,"ig"),bte=new RegExp("^"+RX,"i"),wte=new RegExp(OX+"$","i"),qN='"',l8e=qN+" + ",c8e=" + "+qN;function u8e(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function h8e(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function C5(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=u8e(e.labelExpression),t.type="conventional"),t}function d8e(e){const t=C5(e);if(!t)return null;switch(t.type){case"conventional":return S7(t.expression);case"arcade":return t.expression}return null}function p8e(e){const t=C5(e);if(!t)return null;switch(t.type){case"conventional":return m8e(t.expression);case"arcade":return MX(t.expression)}return null}function S7(e){let t;return e?(t=Ef(e,i=>RX+'$feature["'+i+'"]'+OX),t=bte.test(t)?t.replace(bte,""):qN+t,t=wte.test(t)?t.replace(wte,""):t+qN,t=t.replace(o8e,l8e).replace(a8e,c8e)):t='""',t}const f8e=/^\s*\{([^}]+)\}\s*$/i;function m8e(e){const t=e.match(f8e);return t&&t[1].trim()||null}const g8e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,y8e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,v8e=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function MX(e){if(!e)return null;let t=g8e.exec(e)||y8e.exec(e);return t?t[1]||t[3]:(t=v8e.exec(e),t?t[2]:null)}var E7;let s0=E7=class extends ye{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?S7(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=S7(this.value)),e!=null&&(t[i]=e)}clone(){return new E7({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],s0.prototype,"expression",void 0),u([Pe("expression",["expression","value"])],s0.prototype,"readExpression",null),u([He("expression")],s0.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],s0.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],s0.prototype,"value",void 0),s0=E7=u([P("esri.layers.support.LabelExpressionInfo")],s0);const y0e=s0,v0e=[252,146,31,255],xbt=[153,153,153,255],_8e={type:"esriSMS",style:"esriSMSCircle",size:6,color:v0e,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},b8e={type:"esriSLS",style:"esriSLSSolid",width:.75,color:v0e},w8e={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},x8e={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},T8e={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},S8e={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},E8e={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},Tbt=Xv.fromJSON(_8e),Sbt=Uh.fromJSON(b8e),Ebt=Wv.fromJSON(w8e),C8e=eE.fromJSON(x8e);Xv.fromJSON(T8e);Uh.fromJSON(S8e);Wv.fromJSON(E8e);var C7;const IP=new xi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function _0e(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function A8e(e){return(e==null?void 0:e.type)==="map-image"}function b0e(e){var t,i;return!!A8e(e)&&!!((i=(t=e.capabilities)==null?void 0:t.exportMap)==null?void 0:i.supportsArcadeExpressionForLabeling)}function R8e(e){return _0e(e)||b0e(e.layer)}let zs=C7=class extends ye{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=C8e,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],o=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=h8e(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=MX(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&_0e(r))e=new y0e({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return C5(this)}getLabelExpressionArcade(){return d8e(this)}getLabelExpressionSingleField(){return p8e(this)}hash(){return JSON.stringify(this)}clone(){return new C7({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ie(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ie(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],zs.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],zs.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],zs.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&b0e(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],zs.prototype,"labelExpression",void 0),u([Pe("labelExpression")],zs.prototype,"readLabelExpression",null),u([He("labelExpression")],zs.prototype,"writeLabelExpression",null),u([d({type:y0e,json:{write:{overridePolicy:(e,t,i)=>R8e(i)?{allowNull:!0}:{enabled:!1}}}})],zs.prototype,"labelExpressionInfo",void 0),u([He("labelExpressionInfo")],zs.prototype,"writeLabelExpressionInfo",null),u([d({type:IP.apiValues,json:{type:IP.jsonValues,read:IP.read,write:IP.write}})],zs.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],zs.prototype,"labelPosition",void 0),u([d({type:Number})],zs.prototype,"maxScale",void 0),u([He("maxScale")],zs.prototype,"writeMaxScale",null),u([d({type:Number})],zs.prototype,"minScale",void 0),u([He("minScale")],zs.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],zs.prototype,"repeatLabel",void 0),u([d({type:Number,cast:Ji,json:{write:!0,origins:{"web-scene":{write:!1}}}})],zs.prototype,"repeatLabelDistance",void 0),u([d({types:KMe,json:{origins:{"web-scene":{types:e3e,write:$J,default:null}},write:$J,default:null}})],zs.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],zs.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],zs.prototype,"where",void 0),zs=C7=u([P("esri.layers.support.LabelClass")],zs);const ZM=zs;var A7;let md=A7=class extends gg{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new A7({fields:ie(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ie(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:ie(this.popupTemplate),renderer:ie(this.renderer)})}};u([ot({binning:"binning"})],md.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],md.prototype,"fixedBinLevel",void 0),u([d({type:[ZM],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],md.prototype,"labelingInfo",void 0),u([d(E5)],md.prototype,"labelsVisible",void 0),u([d(S5)],md.prototype,"popupEnabled",void 0),u([d({type:iE,json:{name:"popupInfo",write:!0}})],md.prototype,"popupTemplate",void 0),u([d({type:[g0e],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],md.prototype,"fields",void 0),u([d({types:w5,json:{write:!0}})],md.prototype,"renderer",void 0),md=A7=u([P("esri.layers.support.FeatureReductionBinning")],md);const O8e=md;var R7;let Nl=R7=class extends ye{constructor(e){super(e),this.type="cluster",this.clusterRadius=Ji("80px"),this.clusterMinSize=Ji("12px"),this.clusterMaxSize=Ji("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new R7({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ie(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ie(this.fields),renderer:ie(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:ie(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Nl.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:Ji(e),json:{write:!0}})],Nl.prototype,"clusterRadius",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Nl.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:Ji,json:{write:!0}})],Nl.prototype,"clusterMaxSize",void 0),u([d(S5)],Nl.prototype,"popupEnabled",void 0),u([d({type:iE,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Nl.prototype,"popupTemplate",void 0),u([d({types:w5,json:{write:!0}})],Nl.prototype,"renderer",void 0),u([d({types:QMe})],Nl.prototype,"symbol",void 0),u([d({type:[ZM],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Nl.prototype,"labelingInfo",void 0),u([d(E5)],Nl.prototype,"labelsVisible",void 0),u([d({type:[g0e],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Nl.prototype,"fields",void 0),Nl=R7=u([P("esri.layers.support.FeatureReductionCluster")],Nl);const w0e=Nl;var O7;let FD=O7=class extends gg{constructor(e){super(e),this.type="selection"}clone(){return new O7}};u([d({type:["selection"]})],FD.prototype,"type",void 0),FD=O7=u([P("esri.layers.support.FeatureReductionSelection")],FD);const M7=FD,xte={key:"type",base:gg,typeMap:{selection:w0e}},M8e={types:{key:"type",base:gg,typeMap:{selection:M7,cluster:w0e,binning:O8e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:xte},"portal-item":{types:xte},"web-scene":{types:{key:"type",base:gg,typeMap:{selection:M7}}}}}},Tte=new xi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let n0=class extends mc(ye){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],n0.prototype,"name",void 0),u([d({json:{write:!0}})],n0.prototype,"description",void 0),u([d({json:{read:Tte.read,write:Tte.write}})],n0.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],n0.prototype,"prototype",void 0),u([d({json:{write:!0}})],n0.prototype,"thumbnail",void 0),n0=u([P("esri.layers.support.FeatureTemplate")],n0);const PX=n0;let Mm=class extends mc(ye){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=ZW(e[i]);return t}writeDomains(e,t){var r;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON());t.domains=i}};u([d({json:{write:!0}})],Mm.prototype,"id",void 0),u([d({json:{write:!0}})],Mm.prototype,"name",void 0),u([d({json:{write:!0}})],Mm.prototype,"domains",void 0),u([Pe("domains")],Mm.prototype,"readDomains",null),u([He("domains")],Mm.prototype,"writeDomains",null),u([d({type:[PX],json:{write:!0}})],Mm.prototype,"templates",void 0),Mm=u([P("esri.layers.support.FeatureType")],Mm);const x0e=Mm;function P8e(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function Ste(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function Ete(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class T0e{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const i=[];for(const r of t){const s=r&&r.name;if(s){const n=Cte(s);this._fieldsMap.set(s,r),this._fieldsMap.set(n,r),i.push(n),P8e(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):g4(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),Ste(r)||Ete(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)Ste(t)||Ete(t)||t.nullable||zAe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(Cte(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const i=this.get(t);if(i)return i.name}}function Cte(e){return e.toLowerCase().trim()}const I8e=fe.getLogger("esri.layers.support.fieldProperties");function S0e(){return{fields:{type:[jM],value:null},fieldsIndex:{readOnly:!0,get(){return new T0e(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||I8e.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return Lue(this.fieldsIndex,e)}}}}let pT=class extends mc(ye){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],pT.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],pT.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>K3e.read(e)||ePe.read(e)}})],pT.prototype,"units",void 0),pT=u([P("esri.layers.support.GeometryFieldsInfo")],pT);const $8e=pT,D8e=/\[([^\[\]]+)\]/gi;function WN(e,t,i){return e?e.map(r=>{const s=new ZM;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(D8e,(o,a)=>`[${L8e(a,n)}]`)}return s}):null}function L8e(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}var P7;let fT=P7=class extends ye{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ft}clone(){return new P7({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],fT.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],fT.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],fT.prototype,"viewAllLevelIds",void 0),fT=P7=u([P("esri.layers.support.LayerFloorInfo")],fT);const E0e=fT,Ate=new xi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Rte=new xi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Xu=class extends mc(ye){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:Ate.read,write:Ate.write}})],Xu.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],Xu.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],Xu.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],Xu.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],Xu.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],Xu.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],Xu.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],Xu.prototype,"relationshipTableId",void 0),u([d({json:{read:Rte.read,write:Rte.write}})],Xu.prototype,"role",void 0),Xu=u([P("esri.layers.support.Relationship")],Xu);const N8e=Xu,gd=[];function F8e(e,t){if(r0e(e.url))return!0;const{wkid:i}=t;for(const r of gd){if(e.version>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}gd.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),gd.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),gd.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),gd.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),gd.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),gd.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),gd.push([10.61,()=>new Set([102497])]),gd.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),gd.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),gd.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function C0e(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await xu(r.populateFromStyle());if(hi(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Ma("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const U8e=["oid","global-id"],k8e=["oid","global-id","guid"];function A0e({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=H8e({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=X8e({titleBase:s,fields:i,displayField:e}),l=W8e();return new iE({title:a,content:l,fieldInfos:o})}const z8e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],B8e=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!R0e(e.name,t)&&(!i||e.name!==i)&&!U8e.includes(e.type)&&!z8e.some(s=>s.test(e.name));function V8e(e,t){const i=e;return t&&(e=e.filter(r=>!t.includes(r.type))),e===i&&(e=e.slice()),e.sort(G8e),e}function G8e(e,t){return e.type==="oid"?-1:t.type==="oid"?1:Ote(e)?-1:Ote(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function R0e(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function j8e(e,t){return e.editable&&!k8e.includes(e.type)&&!R0e(e.name,t)}function H8e({editFieldsInfo:e,fields:t,objectIdField:i},r){return V8e(t,(r==null?void 0:r.ignoreFieldTypes)||Y8e).map(s=>new FM({fieldName:s.name,isEditable:j8e(s,e),label:s.alias,format:q8e(s),visible:B8e(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function q8e(e){switch(e.type){case"small-integer":case"integer":case"single":return new VT({digitSeparator:!0,places:0});case"double":return new VT({digitSeparator:!0,places:2});case"date":return new VT({dateFormat:"long-month-day-year"});default:return e.type==="string"&&Bue(e.name)?new VT({digitSeparator:!0,places:0}):null}}function W8e(){return[new ZS,new uO]}function X8e(e){const t=LAe(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}function Ote(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const Y8e=["geometry","blob","raster","guid","xml"],$6=new xi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Z8e={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},ks="FeatureLayer",Mte=fe.getLogger("esri.layers.FeatureLayer");function $P(e,t){return new H("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function Pte(e){return e&&e instanceof ft}function Lt(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function DP(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function Q8e(e){var i;const t=(i=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(t==null?void 0:t.includes("envelopeaggregate")),centroid:!!(t==null?void 0:t.includes("centroidaggregate")),convexHull:!!(t==null?void 0:t.includes("convexhullaggregate"))}}function qE(e,t){var r;const i=(r=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i==null?void 0:i.includes(t.toLowerCase()))}const D6=S0e();function L6(e,t,i){const r=!!(i==null?void 0:i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let $e=class extends $Be(OBe(WBe(s8e(AX(t8e(TX(EX(CX(x5(MBe(xX(mc(p2))))))))))))){constructor(...e){super(...e),this._handles=new Ht,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Ke.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(ft.ofType(qm)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=at(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}load(e){const t=_(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(r=>this._initLayerProperties(r)));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(nc).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(t);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new H("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:i.lastEditDate!=null?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){(r==null?void 0:r.writeLayerSchema)&&lc(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}get parsedUrl(){const e=this.url?Mn(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=vl(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=vl(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){rN(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const s=iBe(r,t,i)||void 0;return s||Mte.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),s}if(t.defaultSymbol)return t.types&&t.types.length?new Qq({defaultSymbol:N6(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:N6(s.symbol,s,i)}))}):new _X({symbol:N6(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(Pte(t)&&this._resetMemorySource(t),Pte(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof ft?new Hm({layer:this,items:e}):e:null}readSource(e,t){const i=f5.fromJSON(t.featureSet);return new Hm({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>PX.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?i0e(this.url,i):i;let n=i;if(!n&&this.url){const o=Zb(this.url);_(o)&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),T5(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=x0e.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}set url(e){const t=s0e({layer:this,url:e,nonStandardUrlAllowed:!0,logger:Mte});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){n0e(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new H(ks,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,i){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new H(ks,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)})}async applyEdits(e,t){const i=await import("./editingSupport.7f8682fa.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return A0e(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await aCe(import("./FeatureLayerSource.80151c4c.js"),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new _h,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"];const r=_(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,s=nBe(this.definitionExpression,r);e.where=s||"1=1";const{timeOffset:n,timeExtent:o}=this;return e.timeExtent=n!=null&&o!=null?o.offset(-n.value,n.unit):o||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new H(ks,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new H(ks,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=cG.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new H(ks,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:r,globalIds:s,num:n,size:o,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=r&&r.length>1,h=i&&i.length,p=s&&s.length,f=o&&o.length;if(c||h||p||f||n||a||l)throw new H(ks,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||l))throw new H(ks,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new H(ks,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(_h.from(e)||this.createQuery(),t)).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(_h.from(e)||this.createQuery(),t);throw new H(ks,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(_h.from(e)||this.createQuery(),t);throw new H(ks,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(_h.from(e)||this.createQuery(),t);throw new H(ks,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures($G.from(e),t);throw new H(ks,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount($G.from(e),t);throw new H(ks,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(wP.from(e),t).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i});throw new H(ks,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(wP.from(e),t);throw new H(ks,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(wP.from(e),t);throw new H(ks,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(wP.from(e),t);throw new H(ks,"Layer source does not support queryFeatureCount capability")})}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var n;t=ve(F({},t),{writeLayerSchema:(n=t==null?void 0:t.writeLayerSchema)!=null?n:this._hasMemorySource()});const{origin:i,layerContainerType:r,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push($P(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&r!=="tables")return s==null||s.push($P(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push($P(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&r==="tables")return s==null||s.push($P(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new H(ks,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||F8e(this,e))}async save(e){return(await import("./featureLayerUtils.68bb484a.js")).save(this,e)}async saveAs(e,t){return(await import("./featureLayerUtils.68bb484a.js")).saveAs(this,e,t)}_readEditingEnabled(e,t,i){var s;let r=(s=e.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){var s,n;if(!e){const o=((n=(s=this.capabilities)==null?void 0:s.operations)==null?void 0:n.supportsSync)?"Query,Sync":"Query";lc("layerDefinition.capabilities",o,t),i&&!(r==null?void 0:r.writeLayerSchema)&&(t.capabilities=o)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new H(ks,`feature is missing the identifying attribute ${i}`)):Promise.reject(new H(ks,"'attributes' are required on a feature to query attachments")):Promise.reject(new H(ks,"A feature is required to add/delete/update attachments")):Promise.reject(new H(ks,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return ai(this.url,{query:ve(F({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),rN(this.renderer,this.fieldsIndex),Due(this.timeInfo,this.fieldsIndex),C0e(this,{origin:"service"})}async hasDataChanged(){var e,t;if((e=this.source)==null?void 0:e.refresh)try{const{dataChanged:i,updates:r}=await((t=this.source)==null?void 0:t.refresh());if(_(r)&&(this.sourceJSON=F(F({},this.sourceJSON),r),this.read(r,{origin:"service",url:this.parsedUrl})),i)return!0}catch{}if(this.definitionExpression)try{return(await sBe(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var t;const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((t=this.fields)==null?void 0:t.some(i=>i.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new H("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new H("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:qE(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:qE(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:Lt(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(r=>{const s=Z8e[r.name];s&&(i[s]=!!r.isEnabled)}),i}_readDataCapabilities(e){return{isVersioned:Lt(e,"isDataVersioned",!1),supportsAttachment:Lt(e,"hasAttachments",!1),supportsM:Lt(e,"hasM",!1),supportsZ:Lt(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Lt(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map(p=>p.trim()):[],r=this.url?Zb(this.url):null,s=i.includes(_(r)&&r.serverType==="MapServer"?"data":"query"),n=i.includes("editing")&&!t.datesInUnknownTimezone;let o=n&&i.includes("create"),a=n&&i.includes("delete"),l=n&&i.includes("update");const c=i.includes("changetracking"),h=t.advancedQueryCapabilities;return n&&!(o||a||l)&&(o=a=l=!0),{supportsCalculate:Lt(t,"supportsCalculate",!1),supportsTruncate:Lt(t,"supportsTruncate",!1),supportsValidateSql:Lt(t,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:a,supportsEditing:n,supportsChangeTracking:c,supportsQuery:s,supportsQueryAnalytics:Lt(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:Lt(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Lt(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Lt(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:Lt(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var l;const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=(l=this.url)==null?void 0:l.includes("MapServer"),n=!he("mapserver-pbf-enabled")&&s&&this.version<10.81,o=r0e(this.url),a=(e.supportedQueryFormats||"").split(",").reduce((c,h)=>{const p=h.toLowerCase().trim();return p&&c.add(p),c},new Set);return{supportsStatistics:Lt(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Lt(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Lt(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:Q8e(t),supportsCentroid:Lt(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Lt(t,"supportsQueryWithDistance",!1),supportsDistinct:Lt(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Lt(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Lt(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Lt(t,"supportsHavingClause",!1),supportsOrderBy:Lt(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Lt(t,"supportsPagination",!1),supportsQuantization:Lt(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Lt(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Lt(e,"supportsReturningQueryGeometry",!1),supportsResultType:Lt(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Lt(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Lt(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Lt(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Lt(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Lt(i,"allowOthersToQuery",!0),supportsHistoricMoment:Lt(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!n&&a.has("pbf"),supportsDisjointSpatialRelationship:Lt(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Lt(t,"supportsQueryWithCacheHint",!1)||qE(t,"query"),supportsDefaultSpatialReference:Lt(t,"supportsDefaultSR",!1),supportsCompactGeometry:o,maxRecordCountFactor:DP(e,"maxRecordCountFactor",void 0),maxRecordCount:DP(e,"maxRecordCount",void 0),standardMaxRecordCount:DP(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:DP(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=Lt(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Lt(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:qE(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:qE(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Lt(e,"allowGeometryUpdates",!0),supportsGlobalId:Lt(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Lt(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Lt(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Lt(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Lt(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Lt(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Lt(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Lt(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Lt(t,"allowOthersToUpdate",!0)}}};u([d({readOnly:!0,json:{read:!1}})],$e.prototype,"capabilities",void 0),u([Pe("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],$e.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],$e.prototype,"charts",void 0),u([d({readOnly:!0})],$e.prototype,"createQueryVersion",null),u([d({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],$e.prototype,"copyright",void 0),u([d({type:Boolean})],$e.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],$e.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],$e.prototype,"definitionExpression",void 0),u([d({types:xb,readOnly:!0})],$e.prototype,"defaultSymbol",void 0),u([d({type:Ad})],$e.prototype,"dynamicDataSource",void 0),u([d({readOnly:!0})],$e.prototype,"editFieldsInfo",void 0),u([d({type:Boolean})],$e.prototype,"editingEnabled",null),u([Pe(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],$e.prototype,"readEditingEnabled",null),u([Pe("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],$e.prototype,"readEditingEnabledFromWebMap",null),u([He(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],$e.prototype,"writeEditingEnabled",null),u([He("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],$e.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],$e.prototype,"editingInfo",void 0),u([Pe("editingInfo")],$e.prototype,"readEditingInfo",null),u([d((()=>{const e=ie(SX),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],$e.prototype,"elevationInfo",void 0),u([d(M8e)],$e.prototype,"featureReduction",void 0),u([d(ve(F({},D6.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:L6}}}}}))],$e.prototype,"fields",void 0),u([d(D6.fieldsIndex)],$e.prototype,"fieldsIndex",void 0),u([d({type:E0e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],$e.prototype,"floorInfo",void 0),u([d({type:yBe,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],$e.prototype,"formTemplate",void 0),u([d({type:ri,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],$e.prototype,"fullExtent",void 0),u([d()],$e.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:$8e,json:{read:{source:"geometryProperties"}}})],$e.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:$6.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:L6,writer(e,t,i){const r=e?$6.toJSON(e):null;r&&lc(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:$6.read}}})],$e.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],$e.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],$e.prototype,"hasZ",void 0),u([d({readOnly:!0,type:Mw})],$e.prototype,"heightModelInfo",void 0),u([d({type:Date})],$e.prototype,"historicMoment",void 0),u([d(c0e)],$e.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],$e.prototype,"infoFor3D",void 0),u([d({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],$e.prototype,"isTable",void 0),u([Pe("service","isTable",["type","geometryType"]),Pe("isTable",["layerDefinition.type","layerDefinition.geometryType"])],$e.prototype,"readIsTable",null),u([He("web-map","isTable")],$e.prototype,"writeIsTable",null),u([d(E5)],$e.prototype,"labelsVisible",void 0),u([d({type:[ZM],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:WN},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:WN},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],$e.prototype,"labelingInfo",void 0),u([d((()=>{const e=ie(VBe);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,i,r){lc(r,b4(t),i)}}},e})())],$e.prototype,"opacity",void 0),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],$e.prototype,"layerId",void 0),u([d(l0e)],$e.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=ie(u0e.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],$e.prototype,"listMode",void 0),u([d(GBe)],$e.prototype,"minScale",void 0),u([Pe("service","minScale",["minScale","effectiveMinScale"])],$e.prototype,"readMinScale",null),u([d(jBe)],$e.prototype,"maxScale",void 0),u([Pe("service","maxScale",["maxScale","effectiveMaxScale"])],$e.prototype,"readMaxScale",null),u([d({type:String})],$e.prototype,"globalIdField",void 0),u([Pe("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Pe("service","globalIdField",["globalIdField","fields"])],$e.prototype,"readGlobalIdFieldFromService",null),u([d({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:L6}}}}})],$e.prototype,"objectIdField",void 0),u([Pe("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Pe("service","objectIdField",["objectIdField","fields"])],$e.prototype,"readObjectIdFieldFromService",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],$e.prototype,"operationalLayerType",void 0),u([d(D6.outFields)],$e.prototype,"outFields",void 0),u([d({readOnly:!0})],$e.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],$e.prototype,"path",void 0),u([d(S5)],$e.prototype,"popupEnabled",void 0),u([d({type:iE,json:{name:"popupInfo",write:!0}})],$e.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],$e.prototype,"defaultPopupTemplate",null),u([d({type:[N8e],readOnly:!0})],$e.prototype,"relationships",void 0),u([d({types:w5,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Wye,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],$e.prototype,"renderer",null),u([Pe("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Pe("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],$e.prototype,"readRenderer",null),u([d()],$e.prototype,"sourceJSON",void 0),u([d({type:Boolean})],$e.prototype,"returnM",void 0),u([d({type:Boolean})],$e.prototype,"returnZ",void 0),u([d((()=>{const e=ie(o0e);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],$e.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],$e.prototype,"source",null),u([jt("source")],$e.prototype,"castSource",null),u([Pe("portal-item","source",["featureSet"]),Pe("web-map","source",["featureSet"])],$e.prototype,"readSource",null),u([d({readOnly:!0})],$e.prototype,"serviceDefinitionExpression",void 0),u([Pe("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],$e.prototype,"readServiceDefinitionExpression",null),u([d({type:Ke,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],$e.prototype,"spatialReference",void 0),u([d({type:Number})],$e.prototype,"subtypeCode",void 0),u([d({type:String,json:{origins:{service:{read:!0}}}})],$e.prototype,"subtypeField",void 0),u([d({type:[PX]})],$e.prototype,"templates",void 0),u([Pe("templates",["editFieldsInfo","creatorField","editorField","templates"])],$e.prototype,"readTemplates",null),u([d({type:m0e})],$e.prototype,"timeInfo",void 0),u([d()],$e.prototype,"title",void 0),u([Pe("service","title",["name"]),Pe("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],$e.prototype,"readTitle",null),u([Pe("web-map","title",["layerDefinition.name","title"])],$e.prototype,"readTitleFromWebMap",null),u([d({type:String})],$e.prototype,"sublayerTitleMode",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],$e.prototype,"trackIdField",void 0),u([d({json:{read:!1}})],$e.prototype,"type",void 0),u([d({type:String})],$e.prototype,"typeIdField",void 0),u([Pe("service","typeIdField"),Pe("typeIdField",["layerDefinition.typeIdField"])],$e.prototype,"readTypeIdField",null),u([d({type:[x0e]})],$e.prototype,"types",void 0),u([Pe("service","types",["types"]),Pe("types",["layerDefinition.types"])],$e.prototype,"readTypes",null),u([d({readOnly:!0,json:{write:!1}})],$e.prototype,"serverGens",void 0),u([d({type:ft.ofType(qm),readOnly:!0})],$e.prototype,"indexes",void 0),u([d(a0e)],$e.prototype,"url",null),u([He("url")],$e.prototype,"writeUrl",null),u([d({readOnly:!0})],$e.prototype,"userIsAdmin",void 0),u([d({json:{origins:{service:{read:!0}},read:!1}})],$e.prototype,"version",void 0),u([Pe("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],$e.prototype,"readVersion",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],$e.prototype,"visible",void 0),u([Pe("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],$e.prototype,"readVisible",null),$e=u([P("esri.layers.FeatureLayer")],$e);const N6=X2({types:yde}),XN=$e;var Cbt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:XN});const J8e=["$datastore","$map","$layer","$aggregatedfeatures"],K8e="esri.widgets.Feature.support.arcadeFeatureUtils",eVe=fe.getLogger(K8e);function tVe(e){return typeof e=="string"?BM(kW(e)):Array.isArray(e)?iVe(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?rVe(e):e}function iVe(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?BM(kW(t)):t}</li>`).join("")}</ul>`}function rVe(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?BM(kW(i)):i}</td></tr>`}).join("")}</table>`}function sVe({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(r.vars[c]=t.convertMapToFeatureSetCollection(h)),c==="$layer"&&(r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(r.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:f,objectIdField:m,geometryType:y,spatialReference:v,displayField:w}=p,b=new XN(ve(F({fields:f,objectIdField:m,geometryType:y,spatialReference:v,displayField:w},p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null),{source:e}));r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:b,spatialReference:s.sr,interceptor:a})}})}function O0e(){return import("./arcadeUtils.b2e22eb8.js").then(function(e){return e.t})}async function nVe({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function M0e({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=J8e.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([nVe({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:r}),p=t.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,sVe({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>eVe.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function oVe({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await O0e(),a={};for(const h of e)a[`expression/${h.name}`]=M0e({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await Zo(a),c={};for(const h in l)c[h]=tVe(l[h].value);return c}const aVe=1;let $c=class extends Ow(Ee){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var r,s;const t=(r=this.contentElement)==null?void 0:r.type;(s=this.contentElementViewModel)==null||s.destroy();const i=t==="fields"?new s5:t==="media"?new lb:t==="text"?new UN:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=PW(this._compile,aVe,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const l=await O0e();if(a!==this._abortController)return;const c=await M0e({arcadeUtils:l,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await gX(c,a.signal),p=h==null?void 0:h.type,f=p==="media"?pO.fromJSON(h):p==="text"?QS.fromJSON(h):p==="fields"?ZS.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([ae(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Ft),ae(()=>[this.contentElement],()=>this._createVM(),Ft)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};u([d()],$c.prototype,"_abortController",void 0),u([d({type:Ade})],$c.prototype,"expressionInfo",void 0),u([d({type:Pa})],$c.prototype,"graphic",void 0),u([d({readOnly:!0})],$c.prototype,"contentElement",void 0),u([d({readOnly:!0})],$c.prototype,"contentElementViewModel",void 0),u([d()],$c.prototype,"interceptor",void 0),u([d()],$c.prototype,"spatialReference",null),u([d({readOnly:!0})],$c.prototype,"state",null),u([d()],$c.prototype,"map",null),u([d()],$c.prototype,"view",void 0),$c=u([P("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],$c);const IX=$c,LP={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let UD=class extends $a{constructor(e,t){super(e,t),this.viewModel=new IX}initialize(){this.own(ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Ft))}destroy(){this._destroyContentWidget()}renderLoading(){return ce("div",{key:"loading-container",class:LP.loadingSpinnerContainer},ce("span",{class:this.classes(LP.iconLoading,LP.spinner)}))}render(){var t;const{state:e}=this.viewModel;return ce("div",{class:LP.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new tge({viewModel:e}):i==="media"?new Lge({viewModel:e}):i==="text"?new wD({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};u([d({type:IX})],UD.prototype,"viewModel",void 0),UD=u([P("esri.widgets.Feature.FeatureExpression")],UD);const lVe=UD;class cVe{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var kD;const uVe=1,Ite="content-view-models",P0e="esri.widgets.FeatureViewModel",hVe=fe.getLogger(P0e),$te={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let ds=kD=class extends Ee{constructor(e){super(e),this._handles=new Ht,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=PW(this._graphicChanged,uVe,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=F({},$te),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&i.attachmentsContent||t.type==="custom"&&i.customContent||t.type==="fields"&&i.fieldsContent||t.type==="media"&&i.mediaContent||t.type==="text"&&i.textContent||t.type==="expression"&&i.expressionContent},this._handles.add(ae(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),Ft))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return _(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return CFe(VK(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Bme(this.graphic)}castAbilities(e){return F(F({},$te),e)}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof lb&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof lb&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof lb&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){jr(i)||(this._error=i,hVe.error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)):typeof e=="string"?this._compileText(new QS({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(Ite),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new IX({expressionInfo:i,graphic:r,interceptor:kD.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(ae(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),Ft),Ite),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new BW(F({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new UN({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:ob({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:ob({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=F(F({},r.global),r.content[t]),n=(c=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>Gme(h)||og(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=e;return F({attributes:s,expressionInfos:o,fieldInfos:n},this._compileTitleAndDesc({title:l,description:a}))}_compileFields(e,t){const i=e.clone(),r=new s5(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:h}=r,{description:p,mediaInfos:f,title:m}=e;return F({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,layer:l,fieldInfoMap:s,formattedAttributes:F(F({},n.global),n.content[t]),expressionAttributes:c,mediaInfos:f,popupTemplate:o,relatedInfos:a},this._compileTitleAndDesc({title:m,description:p}))}_compileMedia(e,t){const i=e.clone(),r=new lb(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=ob({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new UN(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?EFe(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r,o=this.formattedAttributes.global;return ob({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.title;return NN(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.content;return NN(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await Zo({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await OFe({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:h}}=await Zo({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:oVe({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:r,map:o,interceptor:kD.interceptor,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes=F(F({},r.attributes),h),this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=e6({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:F(F({},l),e.attributes),layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=e6({fieldInfos:e.fieldInfos,graphic:r,attributes:F(F({},a),e.attributes),layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:e6({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,VK(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=_(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter(c=>c&&og(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await VUe({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await GUe({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;FUe((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=NG(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||NUe(s,t);o&&(jUe({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};ds.interceptor=new cVe(IFe,$Fe),u([d()],ds.prototype,"_error",void 0),u([d()],ds.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],ds.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],ds.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],ds.prototype,"_sourceLayer",null),u([d()],ds.prototype,"abilities",void 0),u([jt("abilities")],ds.prototype,"castAbilities",null),u([d({readOnly:!0})],ds.prototype,"content",void 0),u([d({readOnly:!0})],ds.prototype,"contentViewModels",void 0),u([d({type:Boolean})],ds.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],ds.prototype,"state",null),u([d({readOnly:!0})],ds.prototype,"formattedAttributes",void 0),u([d({type:Pa,value:null})],ds.prototype,"graphic",null),u([d({readOnly:!0})],ds.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],ds.prototype,"relatedInfos",void 0),u([d()],ds.prototype,"spatialReference",null),u([d({readOnly:!0})],ds.prototype,"title",void 0),u([d()],ds.prototype,"map",null),u([d({readOnly:!0})],ds.prototype,"waitingForContent",null),u([d()],ds.prototype,"view",void 0),ds=kD=u([P(P0e)],ds);const $X=ds,I0e=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>ege(i)&&!i.destroyed?ce("div",{key:i},i.render()):i instanceof HTMLElement?ce("div",{key:i,bind:i,afterCreate:this._attachToNode}):QFe(i)?ce("div",{key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=u([P("esri.widgets.Feature.ContentMixin")],t),t},Io={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},Dte={title:!0,content:!0,lastEditedInfo:!0};let Uo=class extends I0e($a){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=F({},Dte),this.map=null,this.view=null,this.viewModel=new $X}initialize(){this.own(ae(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),Ft))}loadDependencies(){return import("./calcite-notice.26530719.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return F(F({},Dte),e)}render(){const{state:e}=this.viewModel,t=ce("div",{class:Io.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return ce("div",{class:this.classes(Io.base,Io.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return ce("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?ce("div",{key:"error-title",slot:"title"},e.errorMessage):null,ce("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return ce("div",{key:"loading-container",class:Io.loadingSpinnerContainer},ce("span",{class:this.classes(Io.iconLoading,Io.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?ce("div",{class:Io.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?ce(VW,{level:this.headingLevel,class:Io.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?ce("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:ce("div",{key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?ce("div",{key:this._buildKey("attachments-element",e),class:this.classes(Io.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ce("div",{key:this._buildKey("expression-element",e),class:Io.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?ce("div",{key:this._buildKey("custom-element",t),class:Io.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ce("div",{key:this._buildKey("fields-element",e),class:Io.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:ce("div",{key:this._buildKey("media-element",e),class:Io.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=Sm(n,{date:r,user:s});return ce("div",{key:"edit-info-element",class:this.classes(Io.lastEditedInfo,Io.contentElement)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?ce("div",{key:this._buildKey("text-element",t),class:this.classes(Io.contentElement,Io.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new GFe({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new tge({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new Lge({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new wD({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new wD({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new lVe({viewModel:r[n]}))},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new wD({viewModel:s}))}this.scheduleRender()}};u([ut("viewModel.graphic")],Uo.prototype,"graphic",void 0),u([ut("viewModel.defaultPopupTemplateEnabled")],Uo.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Uo.prototype,"headingLevel",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Uo.prototype,"label",void 0),u([d(),Ra("esri/widgets/Feature/t9n/Feature")],Uo.prototype,"messages",void 0),u([d(),Ra("esri/t9n/common")],Uo.prototype,"messagesCommon",void 0),u([d(),Ra("esri/widgets/support/t9n/uriUtils")],Uo.prototype,"messagesURIUtils",void 0),u([ut("viewModel.spatialReference")],Uo.prototype,"spatialReference",void 0),u([ut("viewModel.title")],Uo.prototype,"title",void 0),u([d()],Uo.prototype,"visibleElements",void 0),u([jt("visibleElements")],Uo.prototype,"castVisibleElements",null),u([ut("viewModel.map")],Uo.prototype,"map",void 0),u([ut("viewModel.view")],Uo.prototype,"view",void 0),u([d({type:$X})],Uo.prototype,"viewModel",void 0),Uo=u([P("esri.widgets.Feature")],Uo);const dVe=Uo;var $0e;const zD=Symbol("anchorHandles");let y1=class extends Kr.EventedAccessor{constructor(e){super(e),this[$0e]=new Ht,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[zD].add([_l(()=>qs(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),ae(()=>this.screenLocation,(t,i)=>{_(t)&&_(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[zD]=at(this[zD])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&_(e)&&_(t)&&t.ready?t.toScreen(e):null}};$0e=zD,u([d()],y1.prototype,"location",void 0),u([d()],y1.prototype,"screenLocation",null),u([d()],y1.prototype,"screenLocationEnabled",void 0),u([d()],y1.prototype,"view",void 0),y1=u([P("esri.widgets.support.AnchorElementViewModel")],y1);const D0e=y1,pVe="esri.widgets.CompassViewModel";let BD=class extends D0e{constructor(e){super(e),this.visible=!1}};u([d()],BD.prototype,"visible",void 0),BD=u([P(pVe)],BD);const L0e=BD,F6={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let v1=class extends $a{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new L0e,this.visible=!1}initialize(){this.own([ae(()=>this.visible,e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[F6.spinnerStart]:r,[F6.spinnerFinish]:s},o=this._getPositionStyles();return ce("div",{class:this.classes(F6.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=kS(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(A(t)||A(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([ut("viewModel.location")],v1.prototype,"location",void 0),u([ut("viewModel.view")],v1.prototype,"view",void 0),u([d({type:L0e})],v1.prototype,"viewModel",void 0),u([ut("viewModel.visible")],v1.prototype,"visible",void 0),v1=u([P("esri.widgets.Spinner")],v1);const fVe=v1;var Lte;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(Lte||(Lte={}));function mVe(e){return"r"in e&&"g"in e&&"b"in e}function N0e(e){return"h"in e&&"s"in e&&"v"in e}function F0e(e){return"l"in e&&"a"in e&&"b"in e}function U0e(e){return"l"in e&&"c"in e&&"h"in e}function gVe(e){return"x"in e&&"y"in e&&"z"in e}const yVe=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],vVe=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function k0e(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,o=e[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=e[r][s]*t[s];i.push(a)}return i}function z0e(e){const t=[e.r/255,e.g/255,e.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=k0e(yVe,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function DX(e){const t=k0e(vVe,[e.x/100,e.y/100,e.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function B0e(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function V0e(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function _Ve(e){const t=e.l,i=e.a,r=e.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}function bVe(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}function wVe(e){return B0e(z0e(e))}function xVe(e){return DX(V0e(e))}function TVe(e){return _Ve(B0e(z0e(e)))}function SVe(e){return DX(V0e(bVe(e)))}function EVe(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let o=s,a=n===0?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function CVe(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function LX(e){return mVe(e)?e:U0e(e)?SVe(e):F0e(e)?xVe(e):gVe(e)?DX(e):N0e(e)?CVe(e):e}function Abt(e){return N0e(e)?e:EVe(LX(e))}function Rbt(e){return F0e(e)?e:wVe(LX(e))}function Obt(e){return U0e(e)?e:TVe(LX(e))}function G0e(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function AVe(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function RVe(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function OVe(e,t){return new Float32Array(e,t,6)}function j0e(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function MVe(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)j0e(e,t,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:G0e,clone:AVe,fromValues:RVe,createView:OVe,transform:j0e,transformMany:MVe},Symbol.toStringTag,{value:"Module"}));function PVe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function IVe(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function $Ve(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e}function H0e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function DVe(e){return e[0]*e[3]-e[1]*e[2]}function q0e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],p=i[2],f=i[3],m=i[4],y=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*p+n*f,e[3]=s*p+o*f,e[4]=r*m+n*y+a,e[5]=s*m+o*y+l,e}function NX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function W0e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function FX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function LVe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function NVe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function UX(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function FVe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function UVe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function kVe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function X0e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function zVe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function BVe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function VVe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function GVe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],m=t[5];return Math.abs(i-l)<=Et*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Et*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=Et*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=Et*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=Et*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=Et*Math.max(1,Math.abs(a),Math.abs(m))}const jVe=q0e,HVe=X0e;Object.freeze(Object.defineProperty({__proto__:null,copy:PVe,identity:IVe,set:$Ve,invert:H0e,determinant:DVe,multiply:q0e,rotate:NX,scale:W0e,translate:FX,fromRotation:LVe,fromScaling:NVe,fromTranslation:UX,str:FVe,frob:UVe,add:kVe,subtract:X0e,multiplyScalar:zVe,multiplyScalarAndAdd:BVe,exactEquals:VVe,equals:GVe,mul:jVe,sub:HVe},Symbol.toStringTag,{value:"Module"}));const Nte=he("android");he("chrome")||Nte&&Nte>=4;sG();function Y0e(e){return e&&"opacity"in e?e.opacity*Y0e(e.parent):1}async function qVe(e,t){var w;if(!e)return;const i=e.sourceLayer,r=(w=_(t)&&t.useSourceLayer?i:e.layer)!=null?w:i,s=Y0e(r);if(_(e.symbol)&&(!_(t)||t.ignoreGraphicSymbol!==!0)){const b=e.symbol.type==="web-style"?await e.symbol.fetchSymbol(ve(F({},t),{cache:_(t)?t.webStyleCache:null})):e.symbol.clone();return s6(b,null,s),b}const n=_(t)&&t.renderer||r&&"renderer"in r&&r.renderer;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol(ve(F({},t),{cache:_(t)?t.webStyleCache:null})):o.clone(),!("visualVariables"in n)||!n.visualVariables||!n.visualVariables.length)return s6(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(A(t)||A(t.arcade))){const b=F({},t);b.arcade=await Cf(),t=b}const a=await Promise.resolve().then(function(){return Zq}),l=[],c=[],h=[],p=[];for(const b of n.visualVariables)switch(b.type){case"color":l.push(b);break;case"opacity":c.push(b);break;case"rotation":p.push(b);break;case"size":b.target||h.push(b)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,y=!!c.length&&c[c.length-1];let v=y?a.getOpacity(y,e,t):null;if(s!=null&&(v=v!=null?v*s:s),s6(o,m,v),h.length){const b=a.getAllSizes(h,e,t);await a5e(o,b)}for(const b of p)l5e(o,a.getRotationAngle(b,e,t),b.axis);return o}class Lg{constructor(t,i){this.owner=i,this.properties={},this.afterDispatchHandle=null;for(const r in t){const s=t[r],n=new Gce(s,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=tue(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const i=this.properties[t];for(const r of i.acquired)VQ(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this.properties=null,this.owner=null}get(t){const i=this.owner._get(t),r=this.properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this.properties){const i=this.properties[t];let r=0;for(const s of i.acquired)VQ(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}const WVe=he("mac")?"Meta":"Ctrl",A5={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)A5[e]=String.fromCharCode(e);for(let e=1;e<25;e++)A5[111+e]=`F${e}`;for(let e=65;e<91;e++)A5[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function XVe(e){if(e.key!==void 0)return U1(e);const t=A5[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function YVe(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class ZVe{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const Fte=fe.getLogger("esri.views.input.InputHandler");class Oo{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?Fte.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new ZVe(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new QVe(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new JVe(t,{onEmit:(r,s,n,o)=>{this._manager.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Fte.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const i=this._incoming[t.type];if(i){for(const r of i)if(r.match.matches(t)&&(r.callback(t),t.shouldStopPropagation()))break}}}class QVe{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class JVe{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class KVe extends Oo{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse",i.data.x,i.data.y)})}_setValue(t,i,r){t===this._value&&this._x===i&&this._y===r||(this._value=t,this._x=i,this._y=r,this._onChange(t,i,r))}}const U6=fe.getLogger("esri.views.input.InputManager");let o0=class extends Ee{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=WVe,this.latestPointerType="mouse",this._propertiesPool=new Lg({latestPointerLocation:t9e},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=fv.INTERNAL){if(this._nameToGroup[e])return void U6.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void U6.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(r,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):U6.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)YVe(o)||t.add(o)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const r=this._get("latestPointerLocation");if(A(r)||r.x!==t||r.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,i=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(r(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(r(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new KVe((e,t,i)=>this._setLatestPointer(e,t,i)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],fv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,fv.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new e9e(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new I9,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new I9;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.includes(n));if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],o0.prototype,"hasPendingInputs",null),u([d()],o0.prototype,"eventSource",void 0),u([d()],o0.prototype,"recognizers",void 0),u([d({readOnly:!0})],o0.prototype,"latestPointerType",void 0),u([d({readOnly:!0})],o0.prototype,"latestPointerLocation",void 0),o0=u([P("esri.views.input.InputManager")],o0);class e9e{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=A0.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=A0.STOPPED}shouldStopPropagation(){return(this._propagationState&A0.STOPPED)!=0}async(t){this._propagationState|=A0.PAUSED;const i=(r,s)=>{this._propagationState&=~A0.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&A0.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var A0;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(A0||(A0={}));const fv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class t9e{}function Ute(e){return e&&typeof e.highlight=="function"}function i9e(e){return e&&typeof e.maskOccludee=="function"}function Mbt(e,t,i){return A(e)||e>i&&(t===0||e<t)}function Pbt(e,t){return e>0||t>0}function Ibt(e){var i,r;const t=e.effectiveScaleRange;return{minScale:(i=t==null?void 0:t.minScale)!=null?i:0,maxScale:(r=t==null?void 0:t.maxScale)!=null?r:0}}const R5={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},ub=new tE({id:"zoom-to-feature",title:"{messages.zoom}",className:R5.iconZoom}),kte=new tE({id:"remove-selected-feature",title:"{messages.remove}",className:R5.iconTrash}),jT=new tE({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:R5.iconZoom}),HT=new tE({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:R5.iconBrowseClusteredFeatures}),r9e="esri.widgets.Popup.PopupViewModel",YN=fe.getLogger(r9e),s9e=e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new H("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new H("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new H("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new H("trigger-action:invalid-action","Action is disabled"));if(o===ub.id)return o9e(s.viewModel).catch(O8);if(o===jT.id)return a9e(s.viewModel);if(o===HT.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===kte.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new H(`trigger-action:${kte.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function Z0e(e){const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?t||i:e.get("selectedFeature.geometry")||i:null}function q1(e){var t,i;return(e==null?void 0:e.isAggregate)&&((i=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:i.type)==="cluster"}function n9e(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{r=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new H("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});YN.error(s)}),r}return!0}async function o9e(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=Z0e(e);if(!n){const c=new H("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw YN.error(c),c}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&n9e(i,r);ub.active=!0,ub.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{ub.active=!1,ub.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function a9e(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new H("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw YN.error(a),a}if(!q1(t)){const a=new H("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw YN.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],jT.active=!0,jT.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),jT.active=!1,jT.disabled=!1}async function l9e(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}async function c9e(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],HT.active=!0,HT.disabled=!0;const{features:o}=await s.queryFeatures(n);HT.active=!1,HT.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function u9e(e){const t=e.features.filter(i=>q1(i));t.length&&(e.features=t)}const kX=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([P("esri.widgets.support.GoTo")],t),t},RR=ft.ofType({key:"type",defaultKeyValue:"button",base:F4,typeMap:{button:tE,toggle:zde}}),h9e=()=>[ub.clone()],d9e=()=>[jT.clone(),HT.clone()],Q0e="esri.widgets.Popup.PopupViewModel",NP=fe.getLogger(Q0e);let Ti=class extends kX(D0e){constructor(e){super(e),this._handles=new Ht,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new RR,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Pa({symbol:new Wv({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([ae(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),ae(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),ae(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),ae(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),ae(()=>this.location,e=>this._locationChange(e)),ae(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),ae(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),ae(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),ae(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>s9e({event:e,view:this.view})),_l(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Vi),ae(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),ae(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),_l(()=>!this.visible,()=>this.browseClusterEnabled=!1),ae(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new RR;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new RR;return e.removeAll(),e.addMany(q1(this.selectedFeature)?d9e():h9e()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=pg(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=Z0e(this);if(!t){const i=new H("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return NP.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const r=new H("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return NP.error(r),Promise.reject(r)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t=ve(F({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){u9e(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?q1(t)?(await l9e(this),await c9e(this)):NP.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):NP.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(ub.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(q1(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),q1(e)?void 0:(e.symbol=await qVe(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(q1(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(r.some((h,p)=>(h&&h.graphic===n&&(a=h,r.splice(p,1)),!!a)),a)s[o]=a;else{const h=new $X({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},fv.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return r.popup.open({location:a||i,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return A(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:t}_getHighlightTarget(e,t){const i=t.type==="imagery"?void 0:"objectIdField"in t&&t.objectIdField,r=e.attributes;return r&&i&&r[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof p2))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&Ute(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof p2))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&Ute(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};u([d()],Ti.prototype,"featurePage",void 0),u([d()],Ti.prototype,"isLoadingFeature",null),u([d({type:RR})],Ti.prototype,"actions",void 0),u([d({readOnly:!0})],Ti.prototype,"active",null),u([d()],Ti.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Ti.prototype,"allActions",null),u([d({type:Boolean})],Ti.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Ti.prototype,"autoCloseEnabled",void 0),u([d()],Ti.prototype,"autoOpenEnabled",void 0),u([d()],Ti.prototype,"browseClusterEnabled",void 0),u([d()],Ti.prototype,"content",void 0),u([d({type:RR,readOnly:!0})],Ti.prototype,"defaultActions",null),u([d({readOnly:!0})],Ti.prototype,"featureCount",null),u([d()],Ti.prototype,"features",null),u([d()],Ti.prototype,"featuresPerPage",void 0),u([d()],Ti.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Ti.prototype,"featureViewModels",void 0),u([d()],Ti.prototype,"highlightEnabled",void 0),u([d()],Ti.prototype,"includeDefaultActions",void 0),u([d({type:nt})],Ti.prototype,"location",null),u([d({readOnly:!0})],Ti.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Ti.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Ti.prototype,"waitingForResult",null),u([d({readOnly:!0})],Ti.prototype,"promiseCount",null),u([d()],Ti.prototype,"promises",null),u([d({value:null,readOnly:!0})],Ti.prototype,"selectedFeature",null),u([d({value:-1})],Ti.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Ti.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Ti.prototype,"state",null),u([d()],Ti.prototype,"title",void 0),u([d()],Ti.prototype,"updateLocationEnabled",void 0),u([d()],Ti.prototype,"view",void 0),u([d()],Ti.prototype,"visible",void 0),u([d()],Ti.prototype,"zoomFactor",void 0),u([d()],Ti.prototype,"zoomToLocation",void 0),u([d()],Ti.prototype,"centerAtLocation",null),Ti=u([P(Q0e)],Ti);const J0e=Ti,zte="selected-index",p9e=0,Bte="popup-spinner",Ie={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},Vte={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Gte="esri-popup";function rm(e,t){return t===void 0?`${Gte}__${e}`:`${Gte}__${e}-${t}`}const K0e="esri.widgets.Popup",jte=fe.getLogger(K0e),Hte={closeButton:!0,featureNavigation:!0};let Tt=class extends I0e($a){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Ht,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([i])=>{(i==null?void 0:i.isIntersecting)&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=PW(()=>this._displaySpinner(),p9e),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new J0e,this.visible=null,this.visibleElements=F({},Hte),this._addSelectedFeatureIndexHandle(),this.own([ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),ae(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,r)=>{!!i!=!!r&&this.reposition()}),ae(()=>{var i,r,s,n,o,a;return[(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),ae(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),ae(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.size},(i,r)=>this._updateDockEnabledForViewSize(i,r)),ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,r)=>this._viewChange(i,r)),ae(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.ready},(i,r)=>this._viewReadyChange(i,r)),ae(()=>{var i,r;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(r=this.viewModel)==null?void 0:r.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),ae(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),ae(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),_l(()=>!this.collapsed,()=>{var i,r;((r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),fn(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),Ft),ae(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s,n,o;return!!(this.selectedFeatureWidget?((t=(e=this.selectedFeatureWidget)==null?void 0:e.viewModel)==null?void 0:t.waitingForContent)||((r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.state)==="error"||((n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.content):(o=this.viewModel)==null?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Vte}set dockOptions(e){const t=F({},Vte),i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s=F(F({},t),e),n=F(F({},t.breakpoint),r),{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint=F(F({},n),o)),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s=ve(F({},t),{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new dVe({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return F(F({},Hte),e)}blur(){const{active:e}=this.viewModel;e||jte.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||jte.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(zte);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var y,v,w,b;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:r,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=r,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(v=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:v.title,f=(b=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:b.id,m={[Ie.alignTopCenter]:s==="top-center",[Ie.alignBottomCenter]:s==="bottom-center",[Ie.alignTopLeft]:s==="top-left",[Ie.alignBottomLeft]:s==="bottom-left",[Ie.alignTopRight]:s==="top-right",[Ie.alignBottomRight]:s==="bottom-right",[Ie.isDocked]:c,[Ie.shadow]:h,[Ie.isDockedTopLeft]:n==="top-left",[Ie.isDockedTopCenter]:n==="top-center",[Ie.isDockedTopRight]:n==="top-right",[Ie.isDockedBottomLeft]:n==="bottom-left",[Ie.isDockedBottomCenter]:n==="bottom-center",[Ie.isDockedBottomRight]:n==="bottom-right",[Ie.isFeatureMenuOpen]:i,[Ie.isActionsMenuOpen]:l};return ce("div",{class:this.classes(Ie.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return ce("span",{"aria-hidden":"true",class:this.classes(Ie.icon,Ie.iconLoading,Ie.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?ce("div",{key:rm("loading-container"),role:"presentation",class:Ie.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=ev(this.container),t={[Ie.iconRightTriangleArrow]:e,[Ie.paginationPreviousIconRTL]:e,[Ie.iconLeftTriangleArrow]:!e,[Ie.paginationPreviousIconLTR]:!e};return ce("span",{"aria-hidden":"true",class:this.classes(Ie.icon,t)})}renderPreviousButton(){const{messages:e}=this;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ie.button,Ie.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=ev(this.container),t={[Ie.iconLeftTriangleArrow]:e,[Ie.paginationNextIconRTL]:e,[Ie.iconRightTriangleArrow]:!e,[Ie.paginationNextIconLTR]:!e};return ce("span",{"aria-hidden":"true",class:this.classes(Ie.icon,t)})}renderNextButton(){const{messages:e}=this;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ie.button,Ie.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ie.button,Ie.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[Ie.iconUndock]:e,[Ie.iconDock]:!e,[Ie.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[Ie.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[Ie.iconDockToTop]:!e&&t==="top-center",[Ie.iconDockToBottom]:!e&&t==="bottom-center"};return ce("span",{"aria-hidden":"true",class:this.classes(i,Ie.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,i=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,r=e?t.undock:t.dock;return i!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?ce("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ie.button,Ie.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[Ie.headerContainerButton]:i},o=ce(VW,{level:this.headingLevel,class:Ie.headerTitle,innerHTML:e}),a=i?ce("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ie.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):ce("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(Ie.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return ce("span",{"aria-hidden":"true",class:this.classes(Ie.icon,Ie.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?ce("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ie.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return ce("header",{class:Ie.header},this.renderTitle(),ce("div",{class:Ie.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?ce("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:Ie.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?ce("div",{key:rm("actions-menu-button"),class:this.classes(Ie.button,Ie.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},ce("span",{"aria-hidden":"true",class:Ie.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?ce("ul",{id:e,role:"menu","aria-labelledby":t,key:rm("actions"),class:Ie.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?ce("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:Ie.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?ce("section",{key:rm("navigation"),class:this.classes(Ie.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[Ie.footerHasPagination]:e,[Ie.footerHasActions]:s,[Ie.footerHasActionsMenu]:n};return e||s?ce("div",{key:rm("feature-buttons"),class:this.classes(Ie.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=Sm(e.selectedFeatures,{total:t.length});return ce("section",{key:rm("menu"),class:Ie.featureMenu},ce("strong",{class:Ie.featureMenuHeader},r),ce("nav",{bind:this,class:Ie.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:eG},this.renderFeatureMenu(),ce("div",{class:Ie.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?ce("div",{class:Ie.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:ce("div",{key:rm("pointer"),class:Ie.pointer,role:"presentation"},ce("div",{class:this.classes(Ie.pointerDirection,Ie.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",f={[Ie.shadow]:e,[Ie.isCollapsible]:n,[Ie.isCollapsed]:a};return ce("div",{class:this.classes(Ie.main,Ie.widget,f),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?ce("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return ce("span",{key:"text",class:Ie.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[Ie.iconLoading]:e.active,[Ie.rotating]:e.active,[Ie.icon]:!!t,[Ie.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),ce("span",{key:"icon","aria-hidden":"true",class:this.classes(Ie.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[Ie.action]:t.type!=="toggle",[Ie.actionToggle]:t.type==="toggle",[Ie.actionToggleOn]:t.type==="toggle"&&t.value,[Ie.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o=i==="menu-item"?ce("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(Ie.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):ce("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(Ie.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[Ie.featureMenuSelected]:o},l=o?ce("span",{key:rm(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:Ie.iconCheckMark}):null,c=ce("span",{innerHTML:e.title||r.untitled});return ce("li",{role:"menuitem",tabIndex:-1,key:rm(`feature-menu-feature-${s}`),class:this.classes(a,Ie.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},ce("span",{class:Ie.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?ce("ol",{class:Ie.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,o=s==="zoom-to-feature"?Sm(e.title,{messages:t}):s==="remove-selected-feature"?Sm(e.title,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?Sm(e.title,{messages:t}):e.title;return o&&n?Sm(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:Ie.iconDefaultAction;return n&&i?Sm(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?Sm(r,i):r}_createFeatureUpdatedAnimation(){return MLe("enter",Ie.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(ae(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new ft:t.slice(0,i),menuActions:r?new ft:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,r;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){U1(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){U1(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=U1(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=U1(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===r);if(!i)return;const o=i.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=U1(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await e2(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=ae(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,zte)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-t<o.top||s==="bottom"&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(A(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(T){return parseInt(T.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=i.getBoundingClientRect(),m=f+t,y=Math.max(p,c,h)+t,v=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"right",view:o}),w=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"left",view:o}),b=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"top",view:o}),S=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"bottom",view:o});return w?b?"bottom-right":"top-right":v?b?"bottom-left":"top-left":b?S?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return ev(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,i=ev(this.container)?"top-left":"top-right";if(!t)return i;const r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(A(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var a,l;const t=e.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&r<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Sm(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,Bte),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new fVe({view:e}),e.ui.add(this._spinner,{key:Bte,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],Tt.prototype,"actionsMenuId",null),u([d({readOnly:!0})],Tt.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],Tt.prototype,"featureMenuId",null),u([d({readOnly:!0})],Tt.prototype,"titleId",null),u([d({readOnly:!0})],Tt.prototype,"contentId",null),u([d({readOnly:!0})],Tt.prototype,"hasContent",null),u([d({readOnly:!0})],Tt.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],Tt.prototype,"collapsible",null),u([d({readOnly:!0})],Tt.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],Tt.prototype,"contentCollapsed",null),u([d({readOnly:!0})],Tt.prototype,"dividedActions",null),u([ut("viewModel.actions")],Tt.prototype,"actions",void 0),u([d()],Tt.prototype,"actionsMenuOpen",null),u([d()],Tt.prototype,"alignment",void 0),u([ut("viewModel.autoCloseEnabled")],Tt.prototype,"autoCloseEnabled",void 0),u([ut("viewModel.autoOpenEnabled")],Tt.prototype,"autoOpenEnabled",void 0),u([ut("viewModel.defaultPopupTemplateEnabled")],Tt.prototype,"defaultPopupTemplateEnabled",void 0),u([ut("viewModel.content")],Tt.prototype,"content",void 0),u([d()],Tt.prototype,"collapsed",void 0),u([d()],Tt.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],Tt.prototype,"currentAlignment",null),u([d({readOnly:!0})],Tt.prototype,"currentDockPosition",null),u([d()],Tt.prototype,"dockOptions",null),u([d()],Tt.prototype,"dockEnabled",void 0),u([ut("viewModel.featureCount")],Tt.prototype,"featureCount",void 0),u([d()],Tt.prototype,"featureMenuOpen",void 0),u([ut("viewModel.features")],Tt.prototype,"features",void 0),u([ut("viewModel.goToOverride")],Tt.prototype,"goToOverride",void 0),u([d()],Tt.prototype,"headingLevel",void 0),u([ut("viewModel.highlightEnabled")],Tt.prototype,"highlightEnabled",void 0),u([ut("viewModel.location")],Tt.prototype,"location",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Tt.prototype,"label",void 0),u([d()],Tt.prototype,"maxInlineActions",void 0),u([d(),Ra("esri/widgets/Popup/t9n/Popup")],Tt.prototype,"messages",void 0),u([d(),Ra("esri/t9n/common")],Tt.prototype,"messagesCommon",void 0),u([ut("viewModel.promises")],Tt.prototype,"promises",void 0),u([ut("viewModel.selectedFeature")],Tt.prototype,"selectedFeature",void 0),u([ut("viewModel.selectedFeatureIndex")],Tt.prototype,"selectedFeatureIndex",void 0),u([d({readOnly:!0})],Tt.prototype,"selectedFeatureWidget",null),u([d()],Tt.prototype,"spinnerEnabled",void 0),u([ut("viewModel.title")],Tt.prototype,"title",void 0),u([ut("viewModel.updateLocationEnabled")],Tt.prototype,"updateLocationEnabled",void 0),u([ut("viewModel.view")],Tt.prototype,"view",void 0),u([d({type:J0e}),Qme(["triggerAction","trigger-action"])],Tt.prototype,"viewModel",void 0),u([ut("viewModel.visible")],Tt.prototype,"visible",void 0),u([d()],Tt.prototype,"visibleElements",void 0),u([jt("visibleElements")],Tt.prototype,"castVisibleElements",null),u([Hc()],Tt.prototype,"_close",null),u([Hc()],Tt.prototype,"_toggleDockEnabled",null),u([Hc()],Tt.prototype,"_toggleFeatureMenu",null),u([Hc()],Tt.prototype,"_toggleActionsMenu",null),u([Hc()],Tt.prototype,"_triggerAction",null),u([Hc()],Tt.prototype,"_selectFeature",null),u([Hc()],Tt.prototype,"_next",null),u([Hc()],Tt.prototype,"_previous",null),Tt=u([P(K0e)],Tt);const qte=Tt,k6=[0,0];function f9e(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return k6[0]=i.left+t.pageXOffset,k6[1]=i.top+t.pageYOffset,k6}function Wte(e){e&&(ape(e),e.parentNode&&e.parentNode.removeChild(e))}function m9e(e){const t=document.createElement("div");return e.appendChild(t),t}const WE=16,FP=750,g9e=512,y9e=2,v9e=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:WE,time:FP},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([ae(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),ae(()=>this.interacting,r=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",r.toString())})])}initialize(){this.handles.add(ae(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(i){const r=this._get("container");if(r===i)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),Wte(this.root),this._set("root",null),UJ(this.userContent,r),Wte(this.userContent),this._set("userContent",null)),i){i.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",UJ(i,n),i.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",i.insertBefore(o,i.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new SK;o.appendChild(l.surface),this._set("overlay",l),ae(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=Lb({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(ae(()=>this.size,c=>{const[h,p]=c,f="esri-view-surface--inset-outline";h>=document.body.clientWidth||p>=document.body.clientHeight?a.classList.add(f):a.classList.remove(f)},Ft),s),this._set("container",i),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get popup(){return this._get("popup")||new qte({view:this})}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n[0],r-=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n[0],r+=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([ae(()=>this.root,r=>{i.container=r?m9e(r):null},Ft),ae(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},Ft)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=WE,i.time=FP,this.handles.add([(()=>{const r=()=>{i.freq=WE,i.time=FP};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),Lb({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=WE,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?WE:Math.min(FP,n.freq*y9e),!s&&n.freq>=g9e&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=f9e(i);return(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d({value:null,cast:i=>k4(i)})],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:qte})],t.prototype,"popup",null),u([d({type:SK})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([P("esri.views.DOMContainer")],t),t};function $bt(e){return e&&"focus"in e}const zX=fe.getLogger("esri.layers.support.ElevationSampler");class eve{queryElevation(t){return tve(t.clone(),this)}on(){return T9e}projectIfRequired(t,i){return ive(t,i)}}class _9e extends eve{constructor(t,i,r){super(),this.tile=t,this.noDataValue=r,this.extent=w4(t.tile.extent,i.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const s=gc(i.spatialReference),n=i.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return!A(i)&&this.containsAt(i.x,i.y)}containsAt(t,i){return vq(this.aaExtent,t,i)}elevationAt(t,i){if(!this.containsAt(t,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return zX.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return vt(this.tile.sample(t,i),this.noDataValue)}}class Dbt extends eve{constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(o=>new _9e(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=w4(Dt(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,i){for(const r of this.samplers)if(r.containsAt(t,i))return r.elevationAt(t,i);return zX.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler`),this.noDataValue}}function tve(e,t){const i=ive(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":b9e(e,i,t);break;case"polyline":w9e(e,i,t);break;case"multipoint":x9e(e,i,t)}return e}function ive(e,t){if(A(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=ww(e,t);return r||zX.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function b9e(e,t,i){e.z=i.elevationAt(t.x,t.y)}function w9e(e,t,i){hf.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];hf.x=c[0],hf.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(hf.x,hf.y)}}e.hasZ=!0}function x9e(e,t,i){hf.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];hf.x=o[0],hf.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(hf.x,hf.y)}e.hasZ=!0}const hf=new nt,T9e={remove(){}};var I7;let Vp=I7=class extends ye{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new I7({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Vp.prototype,"cols",void 0),u([d({type:Lr,json:{write:!0}})],Vp.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],Vp.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Vp.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],Vp.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Vp.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],Vp.prototype,"scale",void 0),Vp=I7=u([P("esri.layers.support.LOD")],Vp);const rve=Vp;var a0;const Xte=new xi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let Bn=a0=class extends ye{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=Ke.WebMercator,numLODs:n=24}=e;if(!gl(s)){const p=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];p.push({level:f,scale:m,resolution:m})}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift({level:m,scale:f,resolution:f}),f*=2}return new a0({dpi:96,lods:p,origin:new nt(0,0,s),size:[r,r],spatialReference:s})}const o=uv(s),a=e.origin?new nt({x:e.origin.x,y:e.origin.y,spatialReference:s}):new nt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(gc(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],m=f*c;h.push({level:p,scale:f,resolution:m})}else{let p=cue(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/t);h.push({level:0,scale:p,resolution:p*c});for(let m=1;m<f;m++){const y=p/2**t,v=y*c;h.push({level:m,scale:y,resolution:v}),p=y}}return new a0({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=uv(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return nt.fromJSON(F({spatialReference:t.spatialReference},e))}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(s=>{r.push(s.scale),t=s.scale>t?s.scale:t,i=s.scale<i?s.scale:i,this._levelToLOD[s.level]=s})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=i;else if(pc(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const c=ww(t,this.spatialReference);if(A(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:Dt()}),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=a0.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===a0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(i=o)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=Dt()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return a0.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*t;i.push(new rve({level:n.level,scale:n.scale,resolution:o}))}return new a0({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};u([d({type:Number,json:{write:!0}})],Bn.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],Bn.prototype,"dpi",void 0),u([d({type:String,json:{read:Xte.read,write:Xte.write,origins:{"web-scene":{read:!1,write:!1}}}})],Bn.prototype,"format",void 0),u([d({readOnly:!0})],Bn.prototype,"isWrappable",null),u([d({type:nt,json:{write:!0}})],Bn.prototype,"origin",void 0),u([Pe("origin")],Bn.prototype,"readOrigin",null),u([d({type:[rve],value:null,json:{write:!0}})],Bn.prototype,"lods",null),u([d({readOnly:!0})],Bn.prototype,"minScale",void 0),u([d({readOnly:!0})],Bn.prototype,"maxScale",void 0),u([d({readOnly:!0})],Bn.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],Bn.prototype,"size",void 0),u([Pe("size",["rows","cols"])],Bn.prototype,"readSize",null),u([He("size",{cols:{type:Lr},rows:{type:Lr}})],Bn.prototype,"writeSize",null),u([d({type:Ke,json:{write:!0}})],Bn.prototype,"spatialReference",void 0),Bn=a0=u([P("esri.layers.support.TileInfo")],Bn),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(Bn||(Bn={}));const VD=Bn,S9e=12;class Rr{constructor(t){const i=Rr.checkUnsupported(t);if(_(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Hb(this.spatialReference)||zf(this.spatialReference)||Bf(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Rr(this.toTileInfo())}toTileInfo(){return new VD({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=qQ(t[0]),i[1]=tN(t[1]),i[2]=qQ(t[2]),i[3]=tN(t[3])):this._isGCS&&(i[0]=$t(t[0]),i[1]=$t(t[1]),i[2]=$t(t[2]),i[3]=$t(t[3]))}getExtentGeometry(t,i,r,s=new ri){return this.getExtent(t,i,r,pp),s.spatialReference=this.spatialReference,s.xmin=pp[0],s.ymin=pp[1],s.xmax=pp[2],s.ymax=pp[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof Rr)){if(Rr.checkUnsupported(t))return!1;t=new Rr(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!uS(t.origin[0],this.origin[0],s)||!uS(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*S9e,uS(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(A(t)||n[0]===0||n[1]===0)return s;Rr.computeRowColExtent(t,n,this.origin,pp);let o=pp[1],a=pp[3],l=pp[0],c=pp[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return _(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!BRe(s.resolution,r/2**s.level))}static hasGapInLevels(t){const i=t.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return A(t)?BX():t.lods.length<1?new H("tilingscheme:generic","Tiling scheme must have at least one level"):Rr.isPowerOfTwo(t)?Rr.hasGapInLevels(t)?new H("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Rr.tileSizeSupported(t)?Rr.hasOriginPerLODs(t)?new H("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new H("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new H("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=gc(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new Rr(new VD({size:[a,a],origin:{x:t[0]-.5*(o-r),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const i=new Rr(Rr.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new Rr(new VD({size:[i,i],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function BX(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Rr.WebMercatorAuxiliarySphereTileInfo=new VD({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:Ke.WebMercator},spatialReference:Ke.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),Rr.WebMercatorAuxiliarySphere=Rr.makeWebMercatorAuxiliarySphere(19);const pp=Dt(),qT=64,$7=512,E9e=2.5,CO=VRe(j8/10),sve=4,C9e=4,GD=e=>e<4?3:C9e,nve=Dt();Rr.WebMercatorAuxiliarySphere.getExtent(0,0,0,nve);const A9e=Dt([-180,-90,180,90]),R9e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",O9e="Surface extent is too large for tile resolution at level 0.",ih=8,M9e=fe.getLogger("esri.views.support.GroundViewElevationSampler");let l0=class extends Kr.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=CO}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(A(e.extent)||!e.spatialReference)return null;const t=w4(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(A(this.extent)||!_a(this.extent,e,t)){const i=_(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return M9e.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return vt(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return tve(e.clone(),this)}};u([d({readOnly:!0})],l0.prototype,"demResolution",void 0),u([d({readOnly:!0})],l0.prototype,"extent",null),u([d({readOnly:!0})],l0.prototype,"noDataValue",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],l0.prototype,"spatialReference",void 0),u([d({constructOnly:!0})],l0.prototype,"view",void 0),l0=u([P("esri.views.support.GroundViewElevationSampler")],l0);const P9e=l0;let c0=class extends Ee{constructor(e){super(e),this.handles=new Ht,this.view=null,this.layerViews=new ft}initialize(){this.handles.add(_l(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new P9e({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>ae(()=>e.updating,()=>this._updateUpdating(),Vi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],c0.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],c0.prototype,"updating",null),u([d({constructOnly:!0})],c0.prototype,"view",void 0),u([d({type:ft,readOnly:!0})],c0.prototype,"layerViews",void 0),u([d({readOnly:!0})],c0.prototype,"suspended",null),c0=u([P("esri.views.GroundView")],c0);const I9e=c0,$9e=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:lCe([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:_(s)?s.event:null,signal:_(s)?s.signal:null,defaultPopupTemplateEnabled:!!_(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(_(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const{results:s,mapPoint:n}=await this.popupHitTest(i),o=s.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,r)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return _(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([P("esri.views.PopupView")],t),t};async function ove(e,t){return await e.load(),D9e(e,t)}async function D9e(e,t){const i=[],r=(...n)=>{for(const o of n)A(o)||(Array.isArray(o)?r(...o):ft.isCollection(o)?o.forEach(a=>r(a)):Ig.isLoadable(o)&&i.push(o))};t(r);let s=null;if(await r4e(i,async n=>{(await xu(L9e(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function L9e(e){return"loadAll"in e&&typeof e.loadAll=="function"}async function N9e(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await ppe("esri/t9n/basemaps");return i[e]||i[t]}const D7={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return Pi("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return Pi("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Pi("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return Pi("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return Pi("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return Pi("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return Pi("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return Pi("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return Pi("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return Pi("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return Pi("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return Pi("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return Pi("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return Pi("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return Pi("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return Pi("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},F9e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),U9e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function k9e(e){return e.layerContainerType==="basemap"?F9e:e.layerContainerType==="operational-layers"?U9e:null}function z9e(e,t){if(t.restrictedWebMapWriting){const i=k9e(t);return!_(i)||i.has(e.type)&&!AW(e)}return!0}function B9e(e,t){if(AW(e)){const i=W2("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&z6(e,r)}else e.type==="stream"?z6(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&z6(e,t)}function z6(e,t){"maxScale"in e&&(t.maxScale=XL(e.maxScale)),"minScale"in e&&(t.minScale=XL(e.minScale))}function V9e(e,t){if(B9e(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=XL(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(AW(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function Yte(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new H("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(z9e(e,i)){const r={};return e.write(r,i)?r:null}return _(t)&&V9e(e,t=ie(t)),t}var jD;let G9e=0;const B6=fe.getLogger("esri.Basemap");let Yu=jD=class extends bw(Ig){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+G9e++,this.baseLayers=new ft,this.referenceLayers=new ft;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&B6.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{B6.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const e=this.baseLayers.removeAll();for(const r of e)r.destroy();const t=this.referenceLayers.removeAll();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Gb(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i=ve(F({},i),{layerContainerType:"basemap"}),this.baseLayers.forEach(s=>{const n=Yte(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=Yte(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&(n.isReference=!0,r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",Gb(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return ove(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new jD({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t=F({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=ie(i);return r.url&&Of(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Of(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;hi(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push(N9e(n).then(o=>{o&&this.read({title:o},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await import("./layersCreator.60543a48.js"),a=[];if(hi(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const h=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(h)}await Zo(a)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=Mn(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||Ro.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Ro.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=D7[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),jce(B6,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return jD.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ft}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],Yu.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],Yu.prototype,"id",void 0),u([d({type:f2})],Yu.prototype,"portalItem",void 0),u([d()],Yu.prototype,"referenceLayers",null),u([d({readOnly:!0})],Yu.prototype,"resourceInfo",void 0),u([d({type:Ke})],Yu.prototype,"spatialReference",void 0),u([d()],Yu.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Yu.prototype,"title",void 0),u([He("title")],Yu.prototype,"writeTitle",null),Yu=jD=u([P("esri.Basemap")],Yu);const ZN=Yu;var j9e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:ZN}),L7;let HD=L7=class extends ye{constructor(e){super(e),this.type="none"}clone(){return new L7({type:this.type})}};u([ot({none:"none",stayAbove:"stay-above"})],HD.prototype,"type",void 0),HD=L7=u([P("esri.ground.NavigationConstraint")],HD);var N7;const Zte=fe.getLogger("esri.Ground");let Pm=N7=class extends bw(Ig){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ft;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&Zte.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{Zte.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set layers(e){this._set("layers",Gb(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r=ve(F({},r),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){const o={};D3e(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new H("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return ove(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.79a80371.js");hi(t);const r=new i,s=this.layers.filter(Qte).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.79a80371.js");hi(t);const r=new i,s=this.layers.filter(Qte).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:ie(this.surfaceColor),navigationConstraint:ie(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new N7({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return import("./layersCreator.60543a48.js").then(({populateOperationalLayers:o})=>{hi(i);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return Zo(a)}).then(()=>{})}};function H9e(e){return e&&"createElevationSampler"in e}function Qte(e){return e.type==="elevation"||H9e(e)}u([d({json:{read:!1}})],Pm.prototype,"layers",null),u([He("layers")],Pm.prototype,"writeLayers",null),u([d({readOnly:!0})],Pm.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Lr,read:{reader:qS,source:"transparency"},write:{writer:(e,t)=>{t.transparency=b4(e)},target:"transparency"}}})],Pm.prototype,"opacity",void 0),u([d({type:qe,json:{type:[Lr],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Pm.prototype,"surfaceColor",void 0),u([d({type:HD,json:{write:!0}})],Pm.prototype,"navigationConstraint",void 0),Pm=N7=u([P("esri.Ground")],Pm);const QN=Pm;let mT=class extends Ow(ft){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(Jce(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=_(this.getCollections)?this.getCollections():null;if(A(e))return void this.removeAll();let t=0;for(const i of e)_(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new ft(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],mT.prototype,"getCollections",void 0),u([d()],mT.prototype,"getChildrenFunction",void 0),u([d()],mT.prototype,"itemFilterFunction",void 0),mT=u([P("esri.core.CollectionFlattener")],mT);const m2=mT;function q9e(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const Jte=fe.getLogger("esri.support.basemapUtils");function W9e(){return{}}function X9e(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function Y9e(e,t){let i;if(typeof e=="string"){if(!(e in D7)){const r=Object.entries(D7).filter(([s,n])=>Di.apiKey&&!n.classic||!Di.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return Jte.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${r}`),null}t&&(i=t[e]),i||(i=ZN.fromId(e),t&&(t[e]=i))}else i=Ds(ZN,e);return(i==null?void 0:i.destroyed)&&(Jte.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function Z9e(e){return new m2({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return i&&"tables"in i&&i.tables.includes(t)}})}const Q9e=fe.getLogger("esri.support.groundUtils"),Kte={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function J9e(e){let t=null;if(typeof e=="string")if(e in Kte){const i=Kte[e];t=new QN({resourceInfo:{data:{layers:[i]}}})}else Q9e.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=Ds(QN,e);return t}function F7(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=F7(r.layers,t,i),s))return s}}const eie=fe.getLogger("esri.support.LayersMixin"),K9e=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new ft;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||eie.error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",Gb(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof p2){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Eu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):eie.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;r=s.getNextIndex(r),i.slice().forEach(n=>{n.parent!==this?(s.add(n,r),r+=1):this.reorder(n,r)})}findLayerById(i){return F7(this.layers,"id",i)}findLayerByUid(i){return F7(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],t.prototype,"layers",null),t=u([P("esri.support.LayersMixin")],t),t},ave="esri.support.TablesMixin",eGe=fe.getLogger(ave);function U7(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if((n==null?void 0:n.type)==="group"){const o=U7(n.tables,t,i);if(o)return o}}}const tGe=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new ft,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&eGe.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",Gb(i,this._get("tables")))}findTableById(i){return U7(this.tables,"id",i)}findTableByUid(i){return U7(this.tables,"uid",i)}};return u([d()],t.prototype,"tables",null),t=u([P(ave)],t),t};let Gp=class extends tGe(K9e(Kr.EventedMixin(Ee))){constructor(e){super(e),this.allLayers=new m2({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=Z9e(this),this.basemap=null,this.editableLayers=new m2({getCollections:()=>[this.allLayers],itemFilterFunction:q9e}),this.ground=new QN,this._basemapCache=W9e()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),X9e(this._basemapCache),this._basemapCache=null}castBasemap(e){return Y9e(e,this._basemapCache)}castGround(e){const t=J9e(e);return A(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],Gp.prototype,"allLayers",void 0),u([d({readOnly:!0})],Gp.prototype,"allTables",void 0),u([d({type:ZN})],Gp.prototype,"basemap",void 0),u([jt("basemap")],Gp.prototype,"castBasemap",null),u([d({readOnly:!0})],Gp.prototype,"editableLayers",void 0),u([d({type:QN,nonNullable:!0})],Gp.prototype,"ground",void 0),u([jt("ground")],Gp.prototype,"castGround",null),Gp=u([P("esri.Map")],Gp);const iGe=Gp;let OR=class extends mR{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([Pq({Type:Pa,ensureType:Ds(Pa)})],OR.prototype,"itemType",void 0),OR=u([P("esri.support.GraphicsCollection")],OR);let u0=class extends Ee{constructor(e){super(e),this.view=null,this.baseLayerViews=new ft,this.referenceLayerViews=new ft,this._loadingHandle=ae(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap},t=>{t&&t.load().catch(()=>{})},Ft)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,i;if(this.view&&this.view.suspended)return!1;const e=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],u0.prototype,"view",void 0),u([d({readOnly:!0})],u0.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],u0.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],u0.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],u0.prototype,"updating",null),u0=u([P("esri.views.BasemapView")],u0);const rGe=fe.getLogger("esri.views.LayerViewManager");class sGe{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=xv(),this._started=!1,this.done=!1,Yo(this._controller.signal,()=>{const s=new H("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:t}),"prefetchResources"in i&&await i.prefetchResources({signal:t}),i.createLayerView)o=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new H("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(i);hi(t),o="default"in h?new h.default({layer:i,view:r}):new h({layer:i,view:r})}const l=()=>{a=Js(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Yo(t,l),hi(t);try{await o.when()}catch(h){throw l(),h}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new H("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new H("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}}let Zu=class extends t2{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new _f,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const t=(i=this.view.map)==null?void 0:i.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(A(this._workPromise)&&(this._workPromise=xv()),this.handles.remove("reschedule"),this.handles.add(Y2(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var n,o,a;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),A(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const i=new m2({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!i)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of i)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)i.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const r=i.filter(l=>l.type==="group").map(l=>l.layers),s=[(n=t==null?void 0:t.ground)==null?void 0:n.layers,(o=t==null?void 0:t.basemap)==null?void 0:o.baseLayers,(a=t==null?void 0:t.basemap)==null?void 0:a.referenceLayers,t==null?void 0:t.layers,...r].filter(l=>!!l);this.handles.add(s.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([fn(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ae(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Ps)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||Ws(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new H("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new sGe(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(jr(i)||i.name==="cancelled:layerview-create")||rGe.error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],Zu.prototype,"_workPromise",void 0),u([d({readOnly:!0})],Zu.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],Zu.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],Zu.prototype,"_rootCollectionNames",null),u([d()],Zu.prototype,"layerViewImporter",void 0),u([d()],Zu.prototype,"supportsGround",void 0),u([d({readOnly:!0})],Zu.prototype,"updating",null),u([d({readOnly:!0})],Zu.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],Zu.prototype,"view",void 0),Zu=u([P("esri.views.LayerViewManager")],Zu);const nGe=Zu;let Dc=class extends Ee{constructor(e){super(e),this.factor=1.5,this.offset=sp(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],Dc.prototype,"factor",void 0),u([d({nonNullable:!0})],Dc.prototype,"offset",void 0),u([d()],Dc.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],Dc.prototype,"size",void 0),u([d()],Dc.prototype,"maskUrl",void 0),u([d()],Dc.prototype,"maskEnabled",void 0),u([d()],Dc.prototype,"overlayUrl",void 0),u([d()],Dc.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],Dc.prototype,"version",null),u([d({type:Boolean})],Dc.prototype,"visible",void 0),Dc=u([P("esri.views.Magnifier")],Dc);const lve=Dc;let qD=class extends Ee{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.push(new tie(r,s,e,t,i)))}unshift(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.unshift(new tie(r,s,e,t,i)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const i=Xs(t.signal);if(i&&!t.abortCallback)t.reject(di());else{const r=i?t.abortCallback(di()):t.callback(e);Eu(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=di();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};u([d()],qD.prototype,"running",void 0),qD=u([P("esri.layers.support.PromiseQueue")],qD);class tie{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let MA=class extends Ee{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],MA.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],MA.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),MA=u([P("esri.views.support.DebugFlags")],MA);const oGe=new MA,aGe=fe.getLogger("esri.views.support.Scheduler");function lGe(){return new JN.Scheduler}var yt;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(yt||(yt={}));const nf=0,iie=new Map([[yt.RESOURCE_CONTROLLER,nf],[yt.SLIDE,nf],[yt.STREAM_DATA_LOADER,nf],[yt.ELEVATION_QUERY,nf],[yt.TERRAIN_SURFACE,1],[yt.SURFACE_GEOMETRY_UPDATES,1],[yt.GRAPHICS_CORE,2],[yt.I3S_CONTROLLER,2],[yt.POINT_CLOUD_LAYER,2],[yt.FEATURE_TILE_FETCHER,2],[yt.OVERLAY,4],[yt.STAGE,4],[yt.GRAPHICS_DECONFLICTOR,4],[yt.FILTER_VISIBILITY,4],[yt.SCALE_VISIBILITY,4],[yt.FRUSTUM_VISIBILITY,4],[yt.POINT_OF_INTEREST_FREQUENT,6],[yt.POINT_OF_INTEREST_INFREQUENT,30],[yt.LABELER,8],[yt.FEATURE_QUERY_ENGINE,8],[yt.FEATURE_TILE_TREE,16],[yt.FEATURE_TILE_TREE_ACTIVE,nf],[yt.ELEVATION_ALIGNMENT,12],[yt.TEXT_TEXTURE_ATLAS,12],[yt.CLOUDS_GENERATOR,12],[yt.TEXTURE_UNLOAD,12],[yt.LINE_OF_SIGHT_TOOL,16],[yt.LINE_OF_SIGHT_TOOL_INTERACTIVE,nf],[yt.SNAPPING,nf],[yt.SHADOW_ACCUMULATOR,30]]);function rie(e){return iie.has(e)?iie.get(e):typeof e=="number"?e:1}var Tn;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Tn||(Tn={}));const sie=6.5,nie=1,cGe=30,oie=1e3/30,aie=100,lie=.9;var JN,h_;(function(e){let t=class extends Ee{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new cv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Tn.INTERACTING,this._tasks=new Vt,this._runQueue=new Vt,this._load=0,this._idleStateCallbacks=new Vt,this._idleUpdatesStartFired=!1,this._maxReschedule=UP,this._forceTask=!1,this._debug=!1,this._debugHandle=ae(()=>oGe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Ft);for(const o of Object.keys(yt))this.performanceInfo.tasks.set(yt[o],new cv(yt[o]));let s;const n=this;this._test={get state(){return vt(s,n._state)},set state(o){s=o},FRAME_SAFETY_BUDGET:sie,INTERACTING_BUDGET:oie,IDLE_BUDGET:aie,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Js(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=UP,this._schedule(),this.frame()))}))}registerTask(s,n){const o=rie(s),a=new i(this,s,n,o);return this._tasks.push(a),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new cv(s)),a}registerIdleStateCallbacks(s,n){const o={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(o),this.state===Tn.IDLE&&this._idleUpdatesStartFired&&o.idleBegin();const a=this;return{remove:()=>this._removeIdleStateCallbacks(o),set idleBegin(l){a._idleUpdatesStartFired&&(o.idleEnd(),a._state===Tn.IDLE&&l()),o.idleBegin=l},set idleEnd(l){o.idleEnd=l}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Tn.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return A(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=sie,o=s.frameDuration,a=nie;switch(this.state){case Tn.IDLE:n=0,o=Math.max(aie,s.frameDuration),a=cGe;break;case Tn.INTERACTING:o=Math.max(oie,s.frameDuration);case Tn.ANIMATING:}return o=o-s.elapsedFrameTime-n,this.state!==Tn.IDLE&&o<nie&&!this._forceTask?(this._forceTask=!0,!1):(o=Math.max(o,a),this._budget.reset(o,this.state),this._maxReschedule=UP,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Tn.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Tn.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(o=>o.name===s))return h_.SCHEDULED;let n=h_.IDLE;return this._tasks.forAll(o=>{o.name===s&&o.needsUpdate&&(o.schedulePriority<=1?n=h_.READY:n!==h_.READY&&(n=h_.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(o=>{o.name===s&&(n+=o.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(o=>{o.needsUpdate&&s.set(o.name,(s.get(o.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((o,a)=>{n+=o>1?` ${o}x ${a}`:` ${a}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,o)=>o.needsUpdate?++n:n,0);this._load=this._load*lie+s*(1-lie)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===nf&&s.needsUpdate&&!this._runQueue.includes(s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(o=>{o.needsUpdate&&o.schedulePriority!==0&&o.basePriority!==nf&&(s=!0,n=Math.max(n,o.basePriority),o.schedulePriority===1?(o.schedulePriority=0,this._runQueue.push(o)):--o.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===UP&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)}catch(l){aGe.error(`Exception in task "${o.name}"`,l)}o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",o.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(yt))this._frameTaskTimes.set(yt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,o)=>this.performanceInfo.tasks.get(o).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};u([d()],t.prototype,"updating",void 0),t=u([P("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends Ee{constructor(s,n,o,a){super({}),this._scheduler=s,this.name=n,this._basePriority=a,this.runtime=0,this._queue=new qD,this._handles=new Ht,this.schedulePriority=this._basePriority,this.task=_(o)?o:this._queue,this._handles.add(_l(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(fE),this._scheduler.removeTask(this),this.schedule=g2.schedule,this.reschedule=g2.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=rie(s);this._basePriority!==nf&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,o){return this._queue.push(s,n,o)}reschedule(s,n,o){return this._queue.unshift(s,n,o)}processQueue(s){this._queue.runTask(s)}};u([d({constructOnly:!0})],i.prototype,"task",void 0),u([d({readOnly:!0})],i.prototype,"updating",null),i=u([P("esri.views.support.SchedulerTask")],i);class r{constructor(){this._begin=typeof performance!="undefined"?performance.now():0,this._budget=0,this._state=Tn.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r})(JN||(JN={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(h_||(h_={}));const fE=(()=>{const e=new JN.Budget;return e.enabled=!1,e})();class uGe{remove(){}processQueue(){}schedule(t,i,r){try{if(Xs(i)){const s=di();return r?Promise.resolve(r(s)):Promise.reject(s)}return P8(t(fE))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const g2=new uGe,UP=Number.MAX_SAFE_INTEGER;let WT=class extends Ee{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(yt.TEXTURE_UNLOAD))!=null?i:g2}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return _(t)?`${e}.${t}px`:e}};u([d()],WT.prototype,"_frameTask",void 0),u([d()],WT.prototype,"updating",null),WT=u([P("esri.views.3d.support.TextureCollection")],WT);var cie;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(cie||(cie={}));const cve=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],uve={};function hve(e){return!!uve[e]}function hGe(e){for(const t of e)if(!hve(t))return!1;return!0}cve.forEach(e=>{uve[e]=!0});class dGe{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:i,priority:r},s)=>this.inputManager.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this.handlers.forEach((t,i)=>this.inputManager.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!hGe(n))return n.some(hve)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s!=null?s:fv.DEFAULT;const l=this._createUniqueGroupName(),c=new pGe(this.view,n,a,o);this.handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,i){if(this.handlers.has(t)){this.handlers.delete(t);for(const r of i){const s=this.handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this.handlerCounts.delete(r):this.handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class pGe extends Oo{constructor(t,i,r,s){super(!0),this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:sp(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(sp(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this.latestDragStart=i),!this.latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=t,f={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:hc(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var AO,uie,hie;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(AO||(AO={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(uie||(uie={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(hie||(hie={}));const fGe=fe.getLogger("esri.views.interactive.interactiveToolUtils");function mGe(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return fGe.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.visible=!1,i.active&&(i.view.activeTool=null),i.destroy()})]}function KN(e){return e.visible&&e.getEditableFlag(AO.USER)&&e.getEditableFlag(AO.MANAGER)}function jp(e){return sp(e.x,e.y)}function Lbt(e){return Vr(e.x,e.y)}function dve(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return sp(t.clientX-i.left,t.clientY-i.top)}function die(e,t){return t instanceof Event?dve(e,t):jp(t)}function pie(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class gGe{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":fie(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!mie(t))break;const s=jp(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(A(n))break;const o=this._findToolAndManipulatorByKey(n,i.forEachTool,kP),a=qs(o,c=>c.manipulator),l=qs(o,c=>c.tool);!(_(a)&&_(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(t)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,t),_(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(t)&&!a.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool!==n.tool&&(this._currentlyActiveTool=i.activeTool,this._revertToActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!mie(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),o=qs(s||n,({key:h})=>h),a=this._findManipulatorByKey(o,i.forEachTool);if(A(a))break;const l=jp(t);l.x=De(l.x,0,i.view.width),l.y=De(l.y,0,i.view.height);const c=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:o,start:c}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=jp(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findToolAndManipulatorByKey(n,i.forEachTool,kP);if(yGe(t)||i.forEachTool(h=>{if((!_(o)||o.tool!==h||h.automaticManipulatorSelection)&&h.manipulators){let p=!1;h.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,p=!0)}),p&&h.manipulatorSelectionChanged&&h.manipulatorSelectionChanged()}}),A(o))break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:r});break}case"click":{const s=jp(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(A(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{const s=jp(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(A(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=jp(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(A(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:jp(r)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===i&&i.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,i){const r=qs(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(r,i.forEachTool);_(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(i.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:jp(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,i){let r=null;return Ws(t,({key:s})=>{const n=this._findManipulatorByKey(s,i);return!!(_(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(r=n.cursor,!0)}),r}_onFocusChange(t){this._updateCursor(t),this._updateFocusedManipulatorTools(t)}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const i=new Set;this._grabbedManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),this._hoveredManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),t(r=>{r.hasFocusedManipulators=i.has(r)})}clearPointers(t,i,r=!0,s){const n=o=>o.tool===t&&(A(s)||o.manipulatorId===s);this._grabbedManipulators.forEach(({key:o,pointerType:a},l)=>{if(n(o)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(o,i);_(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}}),this._draggedManipulators.forEach(({key:o},a)=>{if(n(o)){this._draggedManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),r&&this._hoveredManipulators.forEach(({key:o},a)=>{if(n(o)){this._hoveredManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.hovering=!1)}}),this._onFocusChange(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!KN(n))return!1;const o=n.manipulators.intersect(t,i);return!A(o)&&(s={manipulatorId:o.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(sp(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!fie(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(jp(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){const n=this._intersect(t,r,s);let o=this._findManipulatorByKey(n,s);const a=qs(this._hoveredManipulators.get(i),({key:c})=>c),l=this._findManipulatorByKey(a,s);_(o)&&!o.interactive&&(o=null),l!==o&&(_(l)&&(l.hovering=!1),_(o)?(o.hovering=!0,this._hoveredManipulators.set(i,{key:n})):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_findManipulatorByKey(t,i){return this._findToolAndManipulatorByKey(t,i,kP)?kP.manipulator:null}_findToolAndManipulatorByKey(t,i,r){return A(t)?null:(r.tool=null,r.manipulator=null,i(s=>{if(s!==t.tool||s.manipulators==null||!KN(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!_(n)&&(r.manipulator=n,r.tool=s,!0)}),r.manipulator?r:null)}}function fie(e){return e==="mouse"}function mie(e){return e.pointerType!=="mouse"||e.button===0}function yGe(e){return!!e.native.shiftKey}const kP={manipulator:null,tool:null},vGe=fe.getLogger("esri.views.ToolViewManager"),gie="attached",V6="tools";let Im=class extends t2{constructor(e){super(e),this._manipulatorState=new gGe,this.tools=new ft,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(cve,e=>{this._handleInputEvent(e)},fv.TOOL),...mGe(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(_(e)&&!this.view.ready)return void vGe.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),_(t)&&t.deactivate(),_(e)&&e.activate(),this._removeIncompleteTools(e);const i=A(this.activeTool);for(const r of this.tools){r.setEditableFlag(AO.MANAGER,i||r===this.activeTool);const s=KN(r);!i&&s||this._manipulatorState.clearPointers(r,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new WT(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ae(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),Rh(()=>this._set("textures",at(this.textures)))],gie)):this.handles.add(ae(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){_(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(gie)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i=ve(F({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:r=>{this.activeTool=r},view:this.view}),!t&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(V6),this._forEachTool(e=>{if(e instanceof Ee){const t=ae(()=>[e.cursor,e.visible,e.editable],()=>{KN(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,V6)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:i})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,i)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),V6)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool(i=>!(!_(i.cursor)||!i.visible||!A(e)&&i.preferManipulatorCursor)&&(t=i.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter(t=>(A(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],Im.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],Im.prototype,"textures",void 0),u([d({value:null})],Im.prototype,"activeTool",null),u([d({readOnly:!0,type:ft})],Im.prototype,"tools",void 0),u([d({readOnly:!0})],Im.prototype,"cursor",void 0),u([d({readOnly:!0})],Im.prototype,"updating",null),Im=u([P("esri.views.ToolViewManager")],Im);const _Ge=Im;let gT=class extends Ee{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":bGe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return wGe[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],gT.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],gT.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],gT.prototype,"axisThreshold",null),gT=u([P("esri.views.input.gamepad.GamepadInputDevice")],gT);const bGe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),wGe={standard:.15,spacemouse:.025,unknown:0},VX=gT;let PA=class extends Ee{constructor(...e){super(...e),this.devices=new ft,this.enabledFocusMode="document"}};u([d({type:ft.ofType(VX),readOnly:!0})],PA.prototype,"devices",void 0),u([d({type:["document","view","none"]})],PA.prototype,"enabledFocusMode",void 0),PA=u([P("esri.views.input.gamepad.GamepadSettings")],PA);const xGe=PA;let WD=class extends Ee{constructor(){super(...arguments),this.gamepad=new xGe}};u([d({readOnly:!0})],WD.prototype,"gamepad",void 0),WD=u([P("esri.views.input.Input")],WD);const TGe=WD;let h0=class extends Ee{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],h0.prototype,"enabled",void 0),u([d({type:VX})],h0.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],h0.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],h0.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],h0.prototype,"velocityFactor",void 0),h0=u([P("esri.views.navigation.gamepad.GamepadSettings")],h0);const pve=h0;let _1=class extends Ee{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new pve,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],_1.prototype,"browserTouchPanEnabled",void 0),u([d({type:pve,nonNullable:!0})],_1.prototype,"gamepad",void 0),u([d({type:Boolean})],_1.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],_1.prototype,"mouseWheelZoomEnabled",void 0),_1=u([P("esri.views.navigation.Navigation")],_1);const fve=_1;function Nbt(e,t,i){const r=mve(e),s=t,n=SGe(r,s,i);if(r){const o=Mw.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new H("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!EGe(e)||n===Gl.Unsupported)return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Gl.Units:{const o=r.heightUnit||"unknown",a=s.heightUnit||"unknown",l=new H("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Gl.HeightModel:{const o=r.heightModel||"unknown",a=s.heightModel||"unknown",l=new H("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Gl.CRS:{const o=r.vertCRS||"unknown",a=s.vertCRS||"unknown",l=new H("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function SGe(e,t,i){if(!yie(e)||!yie(t))return Gl.Unsupported;if(e==null||t==null)return Gl.Ok;if(!i&&e.heightUnit!==t.heightUnit)return Gl.Units;if(e.heightModel!==t.heightModel)return Gl.HeightModel;switch(e.heightModel){case"gravity-related-height":return Gl.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?Gl.Ok:Gl.CRS;default:return Gl.Unsupported}}var Gl;function yie(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function EGe(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!vve(e)}function mve(e){const t=e.url&&Zb(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&_(t)&&t.serverType==="ImageServer")&&gve(e)&&e.heightModelInfo?e.heightModelInfo:vve(e)?Mw.deriveUnitFromSR(AGe,e.spatialReference):null}function gve(e){return"heightModelInfo"in e}function yve(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function vve(e){return yve(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):_ve(e)}function CGe(e){return e.layers!=null||_ve(e)||yve(e)||gve(e)}function _ve(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(Gl||(Gl={}));const AGe=new Mw({heightModel:"gravity-related-height"});var Ve;function vie(e){return e==="global"?Ve.Global:Ve.Local}function G6(e){return e===Ve.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Ve||(Ve={}));let k7,j6=null;async function RGe(e){j6||(j6=Promise.resolve().then(function(){return Olt}).then(t=>k7=t)),await j6,hi(e)}async function bve(e,t,i,r){if(!e)return null;const s=e.spatialReference;return nW()||Df(s,t)?kM(e,t):k7?k7.projectGeometry(e,t,i,r):(await Promise.race([RGe(r),SN(r)]),bve(e,t,i,r))}let Ar=class extends Ee{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Ah(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return _(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return A(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,r,s,n;const e=(i=this.map)==null?void 0:i.call(this),t=[];return _(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(r=e==null?void 0:e.basemap)==null?void 0:r.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);_(a)&&(i=a)}if(_(i)&&i.length===1)break}if(t&&(A(i)||i.length!==1))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:_(r)?r.spatialReference:null,viewingMode:_(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,r,s,n,o,a,l,c;if(!this.required.tileInfo)return(i=this._get("_tileInfoTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var i,r,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))==null?void 0:i.heightModelInfo))return(r=this._get("_heightModelInfoTask"))!=null?r:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(CGe(o)){const a=mve(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var r,s;if(this.suspended||!this.required.extent)return(r=this._get("_extentCandidatesTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(_(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)i.push({extent:c,layer:n})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(A(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:_(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(_(this._projectExtentTask.task)&&(this._projectExtentTask.task=Ah(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:MM(async s=>{try{const n=await bve(i.extent,r,i.layer.portalItem,s);this._projectExtentTask=ve(F({},this._projectExtentTask),{task:null,output:n})}catch{if(Xs(s))return;this._projectExtentTask=ve(F({},this._projectExtentTask),{task:null})}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(A(e))return t;const i=[],r=(s,n)=>_(s)?_(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=r(s.viewingMode,n.viewingMode);if(o!==!1){i.push({spatialReference:s.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return A(e)||e.length<1?_(t)?{spatialReference:t,viewingMode:null}:null:(_(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==Ve.Local)&&(e=e.filter(({viewingMode:i})=>i!==Ve.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(_(s)){const n=_(s.constraints)?s.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||A(this.userSpatialReference)||o.equals(this.userSpatialReference))&&i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};u([d()],Ar.prototype,"required",void 0),u([d({constructOnly:!0})],Ar.prototype,"map",void 0),u([d({constructOnly:!0})],Ar.prototype,"getSpatialReferenceSupport",void 0),u([d()],Ar.prototype,"defaultSpatialReference",void 0),u([d()],Ar.prototype,"userSpatialReference",void 0),u([d()],Ar.prototype,"sourcePreloadCount",void 0),u([d()],Ar.prototype,"priorityCollection",void 0),u([d()],Ar.prototype,"requiresExtentInSpatialReference",void 0),u([d()],Ar.prototype,"suspended",void 0),u([d({readOnly:!0})],Ar.prototype,"ready",null),u([d({readOnly:!0})],Ar.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],Ar.prototype,"spatialReference",null),u([d({readOnly:!0})],Ar.prototype,"extent",null),u([d({readOnly:!0})],Ar.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Ar.prototype,"vcsWkid",null),u([d({readOnly:!0})],Ar.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],Ar.prototype,"viewingMode",null),u([d({readOnly:!0})],Ar.prototype,"tileInfo",null),u([d({readOnly:!0})],Ar.prototype,"mapCollections",null),u([d({readOnly:!0})],Ar.prototype,"_allLayers",null),u([d({readOnly:!0})],Ar.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],Ar.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],Ar.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],Ar.prototype,"_extentCandidatesTask",null),u([d()],Ar.prototype,"_extentTask",null),u([d()],Ar.prototype,"_projectExtentTask",void 0),Ar=u([P("esri.views.support.DefaultsFromMap")],Ar);var XD;const zP=fe.getLogger("esri.views.View");let Ot=XD=class extends Ow(Kr.EventedMixin(O4(Ee))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new m2({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new OR,this.analyses=new l2,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ft,this.magnifier=new lve,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new TGe,this.navigation=new fve,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new dGe(this),this.persistableViewModels=new ft,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(ae(()=>this.preconditionsReady,t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,XD.views.add(this)):(this._currentSpatialReference=null,XD.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.layerViewManager)==null||i.clear(),(r=this.toolViewManager)==null||r.detach(),_(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),_(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Vi))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,e2(()=>this.ready)))),this.basemapView=new u0({view:this}),this.layerViewManager=new nGe({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new _Ge({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ae(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=ve(F({},this.defaultsFromMap.required),{extent:e}),{sync:!0,initial:!0}),ae(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),ae(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([ae(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(t&&!this.spatialReference&&i){if(_(e))return;const s=Rh(()=>e=Ah(e));e=MM(async n=>{try{await kS(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}zP.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=at(this.graphics),this.analyses=at(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),at(this.analysisViewManager),this.toolViewManager=at(this.toolViewManager),this.layerViewManager=at(this.layerViewManager),this.basemapView=at(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return zP.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Ar(F({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e)},this._defaultsFromMapSettings))}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||Ig.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)==null?void 0:e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&((e==null?void 0:e.destroyed)&&(zP.warn("#map","The provided map is already destroyed",{map:e}),e=null),Ig.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,i;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((i=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:i.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!pc(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return _(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(i=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?i:null}importLayerView(e){throw new H("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return _(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&zP.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(_l(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Ot.views=new ft,u([d()],Ot.prototype,"_userSpatialReference",void 0),u([ut("toolViewManager.activeTool")],Ot.prototype,"activeTool",void 0),u([d({readOnly:!0})],Ot.prototype,"allLayerViews",void 0),u([d()],Ot.prototype,"groundView",void 0),u([d()],Ot.prototype,"animation",void 0),u([d()],Ot.prototype,"basemapView",void 0),u([d({readOnly:!0})],Ot.prototype,"_defaultsFromMapSettings",null),u([d()],Ot.prototype,"defaultsFromMap",null),u([d()],Ot.prototype,"fatalError",void 0),u([d({type:ri})],Ot.prototype,"extent",void 0),u([d(D9(OR,"graphics"))],Ot.prototype,"graphics",void 0),u([d(D9(l2,"analyses"))],Ot.prototype,"analyses",void 0),u([d({readOnly:!0,type:Mw})],Ot.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Ot.prototype,"interacting",null),u([d({readOnly:!0})],Ot.prototype,"navigating",void 0),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Ot.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Ot.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:ft,readOnly:!0})],Ot.prototype,"layerViews",void 0),u([d({type:lve})],Ot.prototype,"magnifier",void 0),u([d({value:null,type:iGe})],Ot.prototype,"map",null),u([d()],Ot.prototype,"padding",void 0),u([d({readOnly:!0})],Ot.prototype,"ready",void 0),u([d({type:Ke})],Ot.prototype,"spatialReference",null),u([d()],Ot.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Ot.prototype,"stationary",null),u([d({readOnly:!0})],Ot.prototype,"supportsGround",void 0),u([d({type:qf})],Ot.prototype,"timeExtent",void 0),u([ut("toolViewManager.tools")],Ot.prototype,"tools",void 0),u([d()],Ot.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Ot.prototype,"type",void 0),u([d({type:Number})],Ot.prototype,"scale",void 0),u([d({readOnly:!0})],Ot.prototype,"updating",void 0),u([d({readOnly:!0})],Ot.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Ot.prototype,"initialExtent",null),u([d()],Ot.prototype,"cursor",null),u([d({readOnly:!0})],Ot.prototype,"input",void 0),u([d({type:fve,nonNullable:!0})],Ot.prototype,"navigation",void 0),u([d()],Ot.prototype,"layerViewManager",void 0),u([d()],Ot.prototype,"analysisViewManager",void 0),u([d()],Ot.prototype,"width",void 0),u([d()],Ot.prototype,"height",void 0),u([d({readOnly:!0})],Ot.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Ot.prototype,"size",null),u([d({readOnly:!0})],Ot.prototype,"suspended",void 0),u([d({readOnly:!0})],Ot.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Ot.prototype,"persistableViewModels",void 0),u([d()],Ot.prototype,"_isValid",void 0),u([d()],Ot.prototype,"_readyCycleForced",void 0),u([d()],Ot.prototype,"_currentSpatialReference",void 0),Ot=XD=u([P("esri.views.View")],Ot);const OGe=Ot;let d0=class extends dN{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new H("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=Eu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],d0.prototype,"done",null),u([d({readOnly:!0,type:String})],d0.prototype,"state",void 0),u([d()],d0.prototype,"target",void 0),d0=u([P("esri.views.ViewAnimation")],d0),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(d0||(d0={}));const y2=d0,XE=()=>import("./TileLayerView3D.b221ee1a.js"),_ie=()=>import("./ElevationLayerView3D.8c75d0f9.js"),bie={"base-dynamic":()=>import("./BaseDynamicLayerView3D.2a18e6a7.js"),"base-elevation":_ie,"base-tile":XE,"bing-maps":XE,"building-scene":()=>import("./BuildingSceneLayerView3D.3b64553e.js"),csv:()=>import("./CSVLayerView3D.9a7157eb.js"),elevation:_ie,feature:()=>import("./FeatureLayerView3D.be8dafc7.js"),geojson:()=>import("./GeoJSONLayerView3D.65149ffd.js"),graphics:()=>import("./GraphicsLayerView3D.99a21965.js"),group:()=>import("./GroupLayerView.fe9551ed.js"),imagery:()=>import("./ImageryLayerView3D.d6678c2d.js"),"integrated-mesh":()=>import("./IntegratedMeshLayerView3D.bf274b6a.js"),"line-of-sight":()=>import("./LineOfSightLayerView3D.b099c22f.js"),"map-image":()=>import("./MapImageLayerView3D.9d471f98.js"),media:()=>import("./MediaLayerView3D.c10f85f5.js"),"ogc-feature":()=>import("./OGCFeatureLayerView3D.a014a73f.js"),"open-street-map":XE,"point-cloud":()=>import("./PointCloudLayerView3D.7ff2717d.js").then(function(e){return e.P}),voxel:()=>import("./VoxelLayerView3D.27a3d277.js"),route:()=>import("./RouteLayerView3D.15145064.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./SceneLayerView3D.8134e391.js"):import("./SceneLayerGraphicsView3D.57f8fafc.js"),stream:()=>import("./StreamLayerView3D.75f6bc64.js"),tile:XE,"imagery-tile":()=>import("./ImageryTileLayerView3D.26ae9e6c.js"),"vector-tile":()=>import("./VectorTileLayerView3D.4e6b9b8d.js"),wcs:()=>import("./ImageryTileLayerView3D.26ae9e6c.js"),"web-tile":XE,wfs:()=>import("./WFSLayerView3D.b5f2af83.js"),wms:()=>import("./WMSLayerView3D.07042493.js"),wmts:()=>import("./WMTSLayerView3D.2bd25f37.js"),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function MGe(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new H(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const wie={hasLayerViewModule:e=>_(bie[e.type]),importLayerView:e=>{const t=bie[e.type];if(A(t))throw MGe(e);return t(e)}},PGe=fe.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),xie="analyses-owner-handles";var XT,W1;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(XT||(XT={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(W1||(W1={}));let b1=class extends t2{constructor(e){super(e),this._allAnalysisViews=new ft,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=ip(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(di("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(di()),this._attachedToViewResolver=ip(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(A(t)||t.state.list===W1.REMOVED)throw new H("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),xie)}_disconnectOwners(){this.handles.remove(xie),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:XT.PENDING,list:W1.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=MM(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=W1.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=W1.REMOVED,this._scheduleUpdate()):PGe.error("Trying to remove analysis which was not added")}_scheduleUpdate(){_(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=Y2(()=>this._update()))}_update(){this._scheduledUpdateHandle=Js(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===W1.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case XT.PENDING:e.createAnalysisViewTask=Ah(e.createAnalysisViewTask);break;case XT.CREATED:_(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=at(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,A(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(Xs(t))throw this._creatingViewCount-=1,di("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(Xs(t))throw this._creatingViewCount-=1,n.destroy(),di("AnalysisView creation aborted");return e.view=n,e.state.view=XT.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./AreaMeasurementAnalysisView3D.7bac61e2.js").then(function(t){return t.A});case"dimensioning":return import("./DimensioningAnalysisView3D.4a6a180a.js").then(function(t){return t.D});case"direct-line-measurement":return import("./DirectLineMeasurementAnalysisView3D.60a1cef8.js").then(function(t){return t.D});case"line-of-sight":return import("./LineOfSightAnalysisView3D.ec4b8841.js");case"slice":return import("./SliceAnalysisView3D.6619ac2c.js").then(function(t){return t.S})}}};u([d()],b1.prototype,"updating",null),u([d({constructOnly:!0})],b1.prototype,"view",void 0),u([d()],b1.prototype,"_allAnalysisViews",void 0),u([d()],b1.prototype,"_creatingViewCount",void 0),b1=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],b1);const IGe=b1,$Ge=fe.getLogger("esri.views.3d.state.Constraints");let $m=class extends Ee{constructor(e){super(e),this.collision=new IA,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===Ve.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ve.Local?this._set("altitude",e):$Ge.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?De(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return De(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ve.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=H6)=>(i.min=_o.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?vD([[4e3,_o.max],[1e4,$t(88)],[6e6,$t(88)]]):()=>_o.max;return(t,i=H6)=>(i.min=_o.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?vD([[4e3,_o.max],[5e4,$t(88)],[6e6,$t(88)],[2e7,_o.min]]):vD([[3e5,_o.max],[3e6,$t(88)],[6e6,$t(88)],[2e7,_o.min]]);return(t,i=H6)=>(i.min=_o.min,i.max=e(t),i)}};function DGe(e){return{min:-2e5,max:4*e.radius}}u([d()],$m.prototype,"altitude",null),u([d({readOnly:!0})],$m.prototype,"collision",void 0),u([d()],$m.prototype,"distance",void 0),u([d({readOnly:!0})],$m.prototype,"minimumPoiDistance",void 0),u([d()],$m.prototype,"tilt",void 0),u([d({constructOnly:!0})],$m.prototype,"mode",void 0),$m=u([P("esri.views.3d.state.Constraints")],$m);const Tie=DGe(Ai),_o={min:$t(.5),max:$t(179.5)},H6={min:0,max:0};let IA=class extends Ee{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],IA.prototype,"enabled",void 0),u([d({type:Number})],IA.prototype,"elevationMargin",void 0),IA=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],IA);let YT=class extends Ee{constructor(){super(...arguments),this.min=Tie.min,this.max=Tie.max}};u([d({type:Number})],YT.prototype,"min",void 0),u([d({type:Number})],YT.prototype,"max",void 0),YT=u([P("esri.views.3d.constraints.AltitudeConstraint")],YT);let Wm=class extends Ee{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],Wm.prototype,"near",null),u([jt("near")],Wm.prototype,"castNear",null),u([d({type:Number,value:1e-8})],Wm.prototype,"far",null),u([jt("far")],Wm.prototype,"castFar",null),u([d({type:["auto","manual"]})],Wm.prototype,"mode",void 0),Wm=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],Wm);const z7={min:hc(_o.min),max:hc(_o.max)};let X1=class extends Ee{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return De(e,z7.min,z7.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],X1.prototype,"mode",void 0),u([d({type:Number,value:z7.max})],X1.prototype,"max",null),u([jt("max")],X1.prototype,"castMax",null),X1=u([P("esri.views.3d.constraints.TiltConstraint")],X1);let Y1=class extends Ee{constructor(){super(...arguments),this.tilt=new X1,this.altitude=new YT,this.clipDistance=new Wm}};u([d({type:X1})],Y1.prototype,"tilt",void 0),u([d({type:YT})],Y1.prototype,"altitude",void 0),u([d({type:Wm})],Y1.prototype,"clipDistance",void 0),Y1=u([P("esri.views.3d.constraints.Constraints")],Y1);var B7;let Qu=B7=class extends ye{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new B7(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],Qu.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],Qu.prototype,"date",void 0),u([Pe("date",["datetime"])],Qu.prototype,"readDate",null),u([He("date")],Qu.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Qu.prototype,"directShadowsEnabled",void 0),u([Pe("directShadowsEnabled",["directShadows"])],Qu.prototype,"readDirectShadowsEnabled",null),u([He("directShadowsEnabled")],Qu.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],Qu.prototype,"displayUTCOffset",void 0),u([He("displayUTCOffset")],Qu.prototype,"writeDisplayUTCOffset",null),Qu=B7=u([P("esri.webscene.SunLighting")],Qu);const RO=Qu;var yT;let Hp=yT=class extends Kr.EventedMixin(RO){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new yT(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=yT.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=yT.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(q6.target=this,q6.timezoneOffset=s,this.emit("timezone-will-change",q6)),e!=null)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new yT(ve(F({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};u([d({type:Boolean})],Hp.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],Hp.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],Hp.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],Hp.prototype,"defaultDate",null),u([d({type:Date})],Hp.prototype,"date",null),Hp=yT=u([P("esri.views.3d.environment.SunLighting")],Hp),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(Hp||(Hp={}));const q6={target:null,timezoneOffset:0},p0=Hp;var V7;let $A=V7=class extends ye{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new V7(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],$A.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],$A.prototype,"directShadowsEnabled",void 0),$A=V7=u([P("esri.webscene.VirtualLighting")],$A);const O5=$A;var YD;let DA=YD=class extends Kr.EventedMixin(O5){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new YD(ve(F({},this.cloneConstructProperties()),{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}))}static fromWebsceneLighting(e){return new YD(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};u([d({type:Boolean})],DA.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],DA.prototype,"waterReflectionEnabled",void 0),DA=YD=u([P("esri.views.3d.environment.VirtualLighting")],DA);const LA=DA,LGe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:p0,virtual:LA}};var G7;let MR=G7=class extends Ee{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new G7({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],MR.prototype,"quality",null),MR=G7=u([P("esri.views.3d.environment.SceneViewAtmosphere")],MR);var j7;let NA=j7=class extends ye{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new j7({cloudCover:this.cloudCover})}};u([ot({sunny:"sunny"})],NA.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],NA.prototype,"cloudCover",void 0),NA=j7=u([P("esri.views.3d.environment.SunnyWeather")],NA);const H7=NA;var q7;let FA=q7=class extends ye{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new q7({cloudCover:this.cloudCover})}};u([ot({cloudy:"cloudy"})],FA.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],FA.prototype,"cloudCover",void 0),FA=q7=u([P("esri.views.3d.environment.CloudyWeather")],FA);const NGe=FA;var W7;let UA=W7=class extends ye{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new W7({fogStrength:this.fogStrength})}};u([ot({foggy:"foggy"})],UA.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],UA.prototype,"fogStrength",void 0),UA=W7=u([P("esri.views.3d.environment.FoggyWeather")],UA);const FGe=UA;var X7;let vT=X7=class extends ye{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new X7({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([ot({rainy:"rainy"})],vT.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],vT.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],vT.prototype,"precipitation",void 0),vT=X7=u([P("esri.views.3d.environment.RainyWeather")],vT);const UGe=vT;var Y7;let w1=Y7=class extends ye{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Y7({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([ot({snowy:"snowy"})],w1.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w1.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w1.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],w1.prototype,"snowCover",void 0),w1=Y7=u([P("esri.views.3d.environment.SnowyWeather")],w1);const kGe=w1,wve={key:"type",base:H7,typeMap:{sunny:H7,cloudy:NGe,rainy:UGe,snowy:kGe,foggy:FGe}},zGe=Object.keys(wve.typeMap);function BGe(e,t){return!!zGe.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const lh=1e4,VGe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:RO,virtual:O5}};let ZD=class extends ye{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],ZD.prototype,"type",void 0),ZD=u([P("esri.webscene.background.Background")],ZD);const xve=ZD;var Z7;const GGe=ve(F({},Gg),{nonNullable:!0});let kA=Z7=class extends xve{constructor(e){super(e),this.type="color",this.color=new qe([0,0,0,1])}clone(){return new Z7(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([ot({color:"color"},{readOnly:!0})],kA.prototype,"type",void 0),u([d(GGe)],kA.prototype,"color",void 0),kA=Z7=u([P("esri.webscene.background.ColorBackground")],kA);const Tve=kA,Sie={base:xve,key:"type",typeMap:{color:Tve}};function jGe(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const HGe={types:Sie,json:{read:jGe(Sie),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var Q7;const qGe=fe.getLogger("esri.webscene.Environment"),Eie=(e,t,i)=>({enabled:!i||!i.isPresentation});let f0=Q7=class extends ye{constructor(e){super(e),this.lighting=new RO,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){BGe(e==null?void 0:e.type,qGe)&&this._set("weather",e)}clone(){return new Q7(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?O5.prototype.clone.call(this.lighting):RO.prototype.clone.call(this.lighting),background:ie(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:VGe,nonNullable:!0,json:{write:!0}})],f0.prototype,"lighting",void 0),u([d(HGe)],f0.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Eie}}})],f0.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Eie}}})],f0.prototype,"starsEnabled",void 0),u([d({types:wve,nonNullable:!0,json:{write:!0},value:new H7})],f0.prototype,"weather",null),f0=Q7=u([P("esri.webscene.Environment")],f0);const Sve=f0;var zA;let _T=zA=class extends Sve{constructor(e){super(e),this.atmosphere=new MR,this.lighting=new p0}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new zA(ve(F({},t),{lighting:t.lighting.type==="virtual"?LA.fromWebsceneLighting(t.lighting):p0.fromWebsceneLighting(t.lighting)}))}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof p0||e instanceof LA?e:e instanceof RO?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e):new p0(e.cloneConstructProperties()):e instanceof O5?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new LA(e.cloneConstructProperties()):tp(LGe,e):new p0}clone(){return new zA({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ie(this.background)})}cloneWithWebsceneEnvironment(e){return new zA(ve(F({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ie(this.background)},e.cloneConstructProperties()),{lighting:this._getLighting(e)}))}_getLighting(e){return e.lighting.type==="sun"?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):p0.fromWebsceneLighting(e.lighting):e.lighting.type==="virtual"?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):LA.fromWebsceneLighting(e.lighting):p0.fromWebsceneLighting(e.lighting)}};u([d({type:MR,json:{read:!1},nonNullable:!0})],_T.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],_T.prototype,"lighting",void 0),u([jt("lighting")],_T.prototype,"castLighting",null),_T=zA=u([P("esri.views.3d.environment.SceneViewEnvironment")],_T);const bT=_T;function ro(e,t){return e[0]=t[0],e[1]=t[1],e}function pi(e,t,i){return e[0]=t,e[1]=i,e}function Rd(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function df(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function Eve(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function Cve(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function WGe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function XGe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function YGe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function ZGe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function QGe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Jl(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function JGe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function GX(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function eF(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function jX(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function Ave(e){const t=e[0],i=e[1];return t*t+i*i}function HX(e,t){return e[0]=-t[0],e[1]=-t[1],e}function KGe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function OO(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function Vs(e,t){return e[0]*t[0]+e[1]*t[1]}function e7e(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function wT(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function t7e(e,t){t=t||1;const i=2*Ud()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function J7(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function x1(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function i7e(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function r7e(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function s7e(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function n7e(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function o7e(e){return"vec2("+e[0]+", "+e[1]+")"}function Rve(e,t){return e[0]===t[0]&&e[1]===t[1]}function a7e(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=Et*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=Et*Math.max(1,Math.abs(r),Math.abs(n))}function l7e(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const c7e=jX,u7e=df,h7e=Eve,d7e=Cve,Ove=GX,p7e=eF,f7e=Ave;Object.freeze(Object.defineProperty({__proto__:null,copy:ro,set:pi,add:Rd,subtract:df,multiply:Eve,divide:Cve,ceil:WGe,floor:XGe,min:YGe,max:ZGe,round:QGe,scale:Jl,scaleAndAdd:JGe,distance:GX,squaredDistance:eF,length:jX,squaredLength:Ave,negate:HX,inverse:KGe,normalize:OO,dot:Vs,cross:e7e,lerp:wT,random:t7e,transformMat2:J7,transformMat2d:x1,transformMat3:i7e,transformMat4:r7e,rotate:s7e,angle:n7e,str:o7e,exactEquals:Rve,equals:a7e,projectAndScale:l7e,len:c7e,sub:u7e,mul:h7e,div:d7e,dist:Ove,sqrDist:p7e,sqrLen:f7e},Symbol.toStringTag,{value:"Module"}));function Mve(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const K7=1e4,Xw=Ue(5802e-9,13558e-9,331e-7),W6=3,X6=Ue(65e-8*W6,1881e-9*W6,85e-9*W6),m7e=3996e-9,g7e=.085,QD=1e5;class Us{}function x(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(x||(x={}));var R;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(R||(R={}));var Zs;function yg(e,t){switch(t.textureCoordinateType){case Zs.Default:return e.attributes.add(R.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Zs.Atlas:return e.attributes.add(R.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(R.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case Zs.None:return void e.vertex.code.add(x`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case Zs.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(Zs||(Zs={}));function yc(e){e.code.add(x`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Tu(e){e.include(yc),e.code.add(x`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function M5(e){e.fragment.code.add(x`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Li;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(Li||(Li={}));class Hr{constructor(t,i,r,s,n=null){this.name=t,this.type=i,this.arraySize=n,this.bind={[Li.Pass]:null,[Li.Draw]:null},_(r)&&_(s)&&(this.bind[r]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class fi extends Hr{constructor(t,i){super(t,"vec2",Li.Pass,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class vg extends Hr{constructor(t){super(t,"vec2")}}class xt extends Hr{constructor(t,i){super(t,"vec3",Li.Pass,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class ul extends Hr{constructor(t){super(t,"vec3")}}class Ca extends Hr{constructor(t){super(t,"vec4")}}class $i extends Hr{constructor(t){super(t,"float")}}class yr extends Hr{constructor(t,i){super(t,"mat4",Li.Pass,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}const y7e=fe.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class Pve{constructor(){this.includedModules=new Map}include(t,i){if(this.includedModules.has(t)){const r=this.includedModules.get(t);if(r!==i){y7e.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))r[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${t[n]}`))}}else this.includedModules.set(t,i),t(this.builder,i)}}class Hi extends Pve{constructor(){super(...arguments),this.vertex=new Cie,this.fragment=new Cie,this.attributes=new b7e,this.varyings=new w7e,this.extensions=new v2,this.constants=new ps}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?T7e:x7e,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a)=>{for(let l=0;l<n;++l)s[l](i,o,a)}}}class v7e{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const i of t)this._add(i)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new H(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>_(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class _7e{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class Cie extends Pve{constructor(){super(...arguments),this.uniforms=new v7e,this.code=new _7e,this.constants=new ps}get builder(){return this}}class b7e{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class w7e{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class v2{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?v2.ALLOWLIST_VERTEX:v2.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}v2.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],v2.ALLOWLIST_VERTEX=[];class ps{constructor(){this._entries=new Set}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=ps._numberToFloatStr(r);break;case"int":s=ps._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${ps._numberToFloatStr(r[0])},                            ${ps._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${ps._numberToFloatStr(r[0])},                            ${ps._numberToFloatStr(r[1])},                            ${ps._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${ps._numberToFloatStr(r[0])},                            ${ps._numberToFloatStr(r[1])},                            ${ps._numberToFloatStr(r[2])},                            ${ps._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${ps._numberToIntStr(r[0])},                             ${ps._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${ps._numberToIntStr(r[0])},                             ${ps._numberToIntStr(r[1])},                             ${ps._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${ps._numberToIntStr(r[0])},                             ${ps._numberToIntStr(r[1])},                             ${ps._numberToIntStr(r[2])},                             ${ps._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>ps._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const x7e=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,T7e=`precision highp float;
precision highp sampler2D;`;class $r extends Hr{constructor(t){super(t,"sampler2D")}}function S7e(e){const t=new Hi;t.attributes.add(R.POSITION,"vec2"),t.include(yg,{textureCoordinateType:Zs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new yr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new yr("inverseViewMatrix",(s,n)=>us(E7e,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new xt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new vg("radii"),new $i("scaleHeight"),new ul("cameraPosition"),new Ca("heightParameters"),new $i("innerFadeDistance"),new $i("altitudeFade"),new $r("depthTex"),new ul("betaRayleigh"),new ul("betaCombined"),new $i("betaMie"),new $i("hazeStrength")]),t.include(M5),e.haze&&(r.include(Tu),r.uniforms.add(new fi("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(x`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(x`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?x`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?x``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":x`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?x`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?x`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:x`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?x`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:x`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":x`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const E7e=Ae(),C7e=Object.freeze(Object.defineProperty({__proto__:null,build:S7e},Symbol.toStringTag,{value:"Module"}));class Ki{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var Zi,Pt,Re,Ng,wt,Hd,_2,ht,hr,Jr,Je,bt,pt,ze,mt,St,xa,bi,tu,Sn,Qr,Ei;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Zi||(Zi={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Pt||(Pt={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Re||(Re={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Ng||(Ng={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(wt||(wt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Hd||(Hd={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(_2||(_2={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(ht||(ht={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(hr||(hr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(Jr||(Jr={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Je||(Je={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(bt||(bt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(pt||(pt={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(ze||(ze={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(mt||(mt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(St||(St={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(xa||(xa={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(bi||(bi={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(tu||(tu={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Sn||(Sn={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(Qr||(Qr={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Ei||(Ei={}));const Y6=33984;var dn,Gc;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(dn||(dn={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Gc||(Gc={}));const Aie=33306;var Yr,Rie,Oie,Mie,tF,ej,Pie;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Yr||(Yr={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Rie||(Rie={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Oie||(Oie={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(Mie||(Mie={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(tF||(tF={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(ej||(ej={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Pie||(Pie={}));class cr{constructor(t,i,r){this.release=r,i&&(this.initializeConfiguration(t,i),this._configuration=i.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=Xe(this._program),this._pipeline=this._configuration=null}reload(t){Xe(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,i){this.program.bindPass(t,i)}bindDraw(t,i){this.program.bindDraw(t,i),this.program.rebindTextures()}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return Pt.TRIANGLES}getPipelineState(t,i){return this._pipeline}initializeConfiguration(t,i){}}const Ni=new Map([[R.POSITION,0],[R.NORMAL,1],[R.UV0,2],[R.COLOR,3],[R.SIZE,4],[R.TANGENT,4],[R.AUXPOS1,5],[R.SYMBOLCOLOR,5],[R.AUXPOS2,6],[R.FEATUREATTRIBUTE,6],[R.INSTANCEFEATUREATTRIBUTE,6],[R.INSTANCECOLOR,7],[R.MODEL,8],[R.MODELNORMAL,12],[R.MODELORIGINHI,11],[R.MODELORIGINLO,15]]),A7e=fe.getLogger("esri/views/webgl");function R7e(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const Ive=!!he("enable-feature:webgl-debug");function rh(){return Ive}function MO(){return Ive}function iv(e){if(rh()){const t=e.getError();if(t){const i=R7e(e,t),r=new Error().stack;A7e.error(new H("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class er{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Vt({deallocator:null}),this._glProgram=t.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(Li.Pass,this),this.bindDraw=i.generateBind(Li.Draw,this),this._fragmentUniforms=rh()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform2f(t,i,r){this._glProgram.setUniform2f(t,i,r)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform3f(t,i,r,s){this._glProgram.setUniform3f(t,i,r,s)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform4f(t,i,r,s,n){this._glProgram.setUniform4f(t,i,r,s,n)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(A(i)||i.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let r=this._textures.get(t);return r==null?(r=this._allocTextureUnit(i),this._textures.set(t,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),_(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var ar,Qb,Z1,gt,Ms,Wl,fl,b2,Fg,ml,mv,w2,nr,Jb;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(ar||(ar={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(Qb||(Qb={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(Z1||(Z1={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(gt||(gt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(Ms||(Ms={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(Wl||(Wl={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(fl||(fl={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(b2||(b2={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(Fg||(Fg={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(ml||(ml={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(mv||(mv={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(w2||(w2={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(nr||(nr={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(Jb||(Jb={}));function Xf(e,t,i=Ng.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function so(e,t,i,r,s=Ng.ADD,n=Ng.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const qX={face:Hd.BACK,mode:_2.CCW},$ve={face:Hd.FRONT,mode:_2.CCW},P5=e=>e===ar.Back?qX:e===ar.Front?$ve:null,wl={zNear:0,zFar:1},Kt={r:!0,g:!0,b:!0,a:!0};function O7e(e){return F7e.intern(e)}function M7e(e){return U7e.intern(e)}function P7e(e){return k7e.intern(e)}function I7e(e){return z7e.intern(e)}function $7e(e){return B7e.intern(e)}function D7e(e){return V7e.intern(e)}function L7e(e){return G7e.intern(e)}function N7e(e){return j7e.intern(e)}function Ut(e){return H7e.intern(e)}class Wg{constructor(t,i){this.makeKey=t,this.makeRef=i,this.interns=new Map}intern(t){if(!t)return null;const i=this.makeKey(t),r=this.interns;return r.has(i)||r.set(i,this.makeRef(t)),r.get(i)}}function Xg(e){return"["+e.join(",")+"]"}const F7e=new Wg(Dve,e=>F({__tag:"Blending"},e));function Dve(e){return e?Xg([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const U7e=new Wg(Lve,e=>F({__tag:"Culling"},e));function Lve(e){return e?Xg([e.face,e.mode]):null}const k7e=new Wg(Nve,e=>F({__tag:"PolygonOffset"},e));function Nve(e){return e?Xg([e.factor,e.units]):null}const z7e=new Wg(Fve,e=>F({__tag:"DepthTest"},e));function Fve(e){return e?Xg([e.func]):null}const B7e=new Wg(Uve,e=>F({__tag:"StencilTest"},e));function Uve(e){return e?Xg([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const V7e=new Wg(kve,e=>F({__tag:"DepthWrite"},e));function kve(e){return e?Xg([e.zNear,e.zFar]):null}const G7e=new Wg(zve,e=>F({__tag:"ColorWrite"},e));function zve(e){return e?Xg([e.r,e.g,e.b,e.a]):null}const j7e=new Wg(Bve,e=>F({__tag:"StencilWrite"},e));function Bve(e){return e?Xg([e.mask]):null}const H7e=new Wg(q7e,e=>({blending:O7e(e.blending),culling:M7e(e.culling),polygonOffset:P7e(e.polygonOffset),depthTest:I7e(e.depthTest),stencilTest:$7e(e.stencilTest),depthWrite:D7e(e.depthWrite),colorWrite:L7e(e.colorWrite),stencilWrite:N7e(e.stencilWrite)}));function q7e(e){return e?Xg([Dve(e.blending),Lve(e.culling),Nve(e.polygonOffset),Fve(e.depthTest),Uve(e.stencilTest),kve(e.depthWrite),zve(e.colorWrite),Bve(e.stencilWrite)]):null}class W7e{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class PO extends cr{initializeProgram(t){const i=PO.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return this.configuration.haze?Ut({blending:so(Re.ONE,Re.ZERO,Re.ONE_MINUS_SRC_COLOR,Re.ONE),colorWrite:Kt}):Ut({blending:so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:hr.LEQUAL},colorWrite:Kt})}}PO.shader=new Ki(C7e,()=>import("./ChapmanAtmosphere.glsl.86e1f8fe.js"));class Da{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function G(e={}){return(t,i)=>{var r,s;if(t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i),e.constValue!=null)Object.defineProperty(t,i,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw"Configuration value for "+i+" must be boolean or number, got "+typeof f}})}}}class Vve extends Da{constructor(){super(...arguments),this.haze=!1}}u([G()],Vve.prototype,"haze",void 0);class to{constructor(t,i,r,s,n,o=!1,a=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new to(R.POSITION,3,ht.FLOAT,0,12);new to(R.POSITION,3,ht.FLOAT,0,20),new to(R.UV0,2,ht.FLOAT,12,20);new to(R.POSITION,3,ht.FLOAT,0,32),new to(R.NORMAL,3,ht.FLOAT,12,32),new to(R.UV0,2,ht.FLOAT,24,32);new to(R.POSITION,3,ht.FLOAT,0,16),new to(R.COLOR,4,ht.UNSIGNED_BYTE,12,16);const WX=[new to(R.POSITION,2,ht.FLOAT,0,8)],QM=[new to(R.POSITION,2,ht.FLOAT,0,16),new to(R.UV0,2,ht.FLOAT,8,16)];var ui;function X7e(e,t,i={}){const r=Gve(e);for(;r.length>1;){const s=iF(t,r.shift(),i);if(_(s))return s}return Y7e(t,r.shift(),i)}function Gve(e){const t=he("esri-force-webgl");if(t===ui.WEBGL1||t===ui.WEBGL2)return[t];switch(e){case"2d":return he("mac")&&he("chrome")?[ui.WEBGL1,ui.WEBGL2]:[ui.WEBGL2,ui.WEBGL1];case"3d":return[ui.WEBGL2,ui.WEBGL1]}}function Y7e(e,t,i={}){if(!window.WebGLRenderingContext)return Iie(e,Z7e),null;const r=iF(e,t,i);return A(r)&&Iie(e,Q7e),r}function iF(e,t,i={}){const r=t===ui.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function Iie(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(ui||(ui={}));const Z7e='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Q7e=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,bc=fe.getLogger("esri.views.webgl.BufferObject");function J7e(e){return V2e(e)}class ii{constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(dn.BufferObject,this),this._glName=this._context.gl.createBuffer(),iv(this._context.gl),s&&this.setData(s)}static createIndex(t,i,r){return new ii(t,wt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new ii(t,wt.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==ui.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new ii(t,wt.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=bi.STREAM_READ,r){if(t.type!==ui.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new ii(t,wt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=bi.STREAM_DRAW,r){if(t.type!==ui.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new ii(t,wt.PIXEL_UNPACK_BUFFER,i,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER?this._indexType===ht.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===wt.ELEMENT_ARRAY_BUFFER||this.bufferType===wt.ARRAY_BUFFER}dispose(){var t;((t=this._context)==null?void 0:t.gl)?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(dn.BufferObject,this),this._context=null):this._glName&&bc.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&bc.error("Buffer size needs to be positive!"),this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&_(i))switch(this._indexType=i,i){case ht.UNSIGNED_SHORT:t*=2;break;case ht.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(kL(t)&&(i/=2,this._indexType=ht.UNSIGNED_SHORT),zL(t)&&(i/=4,this._indexType=ht.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;_(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),iv(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i=0,r=0,s=t.byteLength){if(!t)return;(i<0||i>=this._size)&&bc.error("offset is out of range!");let n=i,o=r,a=s,l=t.byteLength;this.bufferType===wt.ELEMENT_ARRAY_BUFFER&&(kL(t)?(l/=2,n*=2,o*=2,a*=2):zL(t)&&(l/=4,n*=4,o*=4,a*=4)),s===void 0&&(s=l-1),r>=s&&bc.error("end must be bigger than start!"),i+r-s>this._size&&bc.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(t)?t.buffer:t,f=o===0&&a===t.byteLength?p:p.slice(o,a);h.bufferSubData(this.bufferType,n,f),iv(h),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,i,r,s){if(!t)return;(i<0||i>=this._size)&&bc.error("offset is out of range!"),r>=s&&bc.error("end must be bigger than start!"),i+r-s>this._size&&bc.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===ui.WEBGL2)o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const a=r===0&&s===t.length?t:t.subarray(r,s);o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,a)}iv(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==ui.WEBGL2)return void bc.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void bc.error("Problem getting subdata: offset and length were less than zero!");const n=J7e(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void bc.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&bc.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,wt.COPY_READ_BUFFER),o.getBufferSubData(wt.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer(wt.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===ui.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):bc.error("Get buffer subdata is supported in WebGL2 only!")}}function An(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const $ie=4;class st{constructor(t,i,r=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(dn.Texture,this),this._descriptor=F({target:pt.TEXTURE_2D,samplingMode:Je.LINEAR,wrapMode:bt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},i),t.type!==ui.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),d_(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===pt.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(dn.Texture,this))}release(){this.dispose()}resize(t,i){const r=this._descriptor;if(r.width!==t||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=t,r.height=i,this._descriptor.target===pt.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let i=pt.TEXTURE_CUBE_MAP_POSITIVE_X;i<=pt.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(t,i)}setData(t){this._setData(t)}_setData(t,i){var c;if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),t===void 0&&(t=null);const s=this._descriptor;i!=null||(i=s.target);const n=d_(i);t===null&&(s.width=s.width||$ie,s.height=s.height||$ie,n&&(s.depth=(c=s.depth)!=null?c:1));const o=this._context.bindTexture(this,st.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(st.TEXTURE_UNIT_FOR_UPDATES),st._validateTexture(this._context,s),this._configurePixelStorage();const a=s.pixelFormat;let l=s.internalFormat?s.internalFormat:this._deriveInternalFormat(a,s.dataType);if(Z6(t)){let h=t.width,p=t.height;const f=1;t instanceof HTMLVideoElement&&(h=t.videoWidth,p=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),this._texImage(i,0,l,h,p,f,t),iv(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),n&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:p,depth:f}=s;if(h!=null&&p!=null||console.error("Width and height must be specified!"),n&&f==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),r.DEPTH24_STENCIL8&&l===r.DEPTH_STENCIL&&(l=r.DEPTH24_STENCIL8),JD(t)){const m=t.levels,y=Die(i,h,p,f),v=Math.min(y-1,m.length-1);An(r)?r.texParameteri(s.target,r.TEXTURE_MAX_LEVEL,v):s.hasMipmap=s.hasMipmap&&y===m.length;const w=l;if(!eje(w))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((b,S,T,E)=>{const C=m[Math.min(b,m.length-1)];this._compressedTexImage(i,b,w,S,T,E,C)},v)}else _(t)?(this._texImage(i,0,l,h,p,f,t),iv(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,y,v,w)=>{this._texImage(i,m,l,y,v,w,null),iv(r)})}st._applySamplingMode(r,this._descriptor),st._applyWrapMode(r,this._descriptor),st._applyAnisotropicFilteringParameters(this._context,this._descriptor),iv(r),this._context.bindTexture(o,st.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,i,r,s,n,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:h,dataType:p,isImmutable:f,target:m}=l;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const y=this._context.bindTexture(this,st.TEXTURE_UNIT_FOR_UPDATES);(i<0||r<0||s>l.width||n>l.height||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),Z6(o)?a.texSubImage2D(m,t,i,r,c,p,o):JD(o)?a.compressedTexSubImage2D(m,t,i,r,s,n,h,o.levels[t]):a.texSubImage2D(m,t,i,r,s,n,c,p,o),this._context.bindTexture(y,st.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!An(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:y,internalFormat:v}=h;if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");d_(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const w=this._context.bindTexture(this,st.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(st.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),JD(l))l=l.levels[t],c.compressedTexSubImage3D(y,t,i,r,s,n,o,a,v,l);else{const b=l;c.texSubImage3D(y,t,i,r,s,n,o,a,p,f,b)}this._context.bindTexture(w,st.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,st._validateTexture(this._context,t)}t.samplingMode===Je.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=Je.LINEAR_MIPMAP_NEAREST):t.samplingMode===Je.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=Je.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,st.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(st.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(i,st.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,st._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(st._applySamplingMode(t,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(st._applyWrapMode(t,i),this._wrapModeDirty=!1)}_deriveInternalFormat(t,i){if(this._context.type===ui.WEBGL1)return t;switch(i){case St.FLOAT:switch(t){case ze.RGBA:return mt.RGBA32F;case ze.RGB:return mt.RGB32F;default:throw new Error("Unable to derive format")}case St.UNSIGNED_BYTE:switch(t){case ze.RGBA:return mt.RGBA8;case ze.RGB:return mt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,i,r,s,n,o){const a=this._context.gl;if(!An(a))throw new Error("Immutable textures are not supported in WebGL1");if(!K7e(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Die(t,s,n,o):1;d_(t)?a.texStorage3D(t,l,i,s,n,o):a.texStorage2D(t,l,i,s,n),this._wasImmutablyAllocated=!0}_texImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===ui.WEBGL2,p=d_(t),{isImmutable:f,pixelFormat:m,dataType:y}=this._descriptor;if(h&&(c=l),h||!Z6(a))if(f){if(_(a)){const v=a;p?c.texSubImage3D(t,i,0,0,0,s,n,o,m,y,v):l.texSubImage2D(t,i,0,0,s,n,m,y,v)}}else{const v=a;p?c.texImage3D(t,i,r,s,n,o,0,m,y,v):l.texImage2D(t,i,r,s,n,0,m,y,v)}else l.texImage2D(t,0,r,m,y,a)}_compressedTexImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=d_(t),p=this._descriptor.isImmutable;if(h){if(this._context.type!==ui.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}p?_(a)&&(h?c.compressedTexSubImage3D(t,i,0,0,0,s,n,o,r,a):l.compressedTexSubImage2D(t,i,0,0,s,n,r,a)):h?c.compressedTexImage3D(t,i,r,s,n,o,0,a):l.compressedTexImage2D(t,i,r,s,n,0,a)}_forEachMipmapLevel(t,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===pt.TEXTURE_3D;for(let c=0;t(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,i){(i.width<0||i.height<0||i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=An(t.gl),s=jS(i.width)&&jS(i.height);r||!i.isImmutable&&!d_(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==bt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===bt.CLAMP_TO_EDGE&&i.wrapMode.t===bt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,i){let r=i.samplingMode,s=i.samplingMode;r===Je.LINEAR_MIPMAP_NEAREST||r===Je.LINEAR_MIPMAP_LINEAR?(r=Je.LINEAR,i.hasMipmap||(s=Je.LINEAR)):r!==Je.NEAREST_MIPMAP_NEAREST&&r!==Je.NEAREST_MIPMAP_LINEAR||(r=Je.NEAREST,i.hasMipmap||(s=Je.NEAREST)),t.texParameteri(i.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(i.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,i){typeof i.wrapMode=="number"?(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode)):(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode.s),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,i){var s;const r=t.capabilities.textureFilterAnisotropic;!r||t.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,(s=i.maxAnisotropy)!=null?s:1)}}function K7e(e){return e in mt}function eje(e){return e in Yr}function JD(e){return _(e)&&"type"in e&&e.type==="compressed"}function tje(e){return _(e)&&"byteLength"in e}function Z6(e){return _(e)&&!JD(e)&&!tje(e)}function d_(e){return e===pt.TEXTURE_3D||e===pt.TEXTURE_2D_ARRAY}function Die(e,t,i,r=1){let s=Math.max(t,i);return e===pt.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}st.TEXTURE_UNIT_FOR_UPDATES=0;function Lie(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function xo(e,t){return e.vertexBuffers[t].size/ije(e.layout[t])}function ije(e){return e[0].stride}function XX(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function YX(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(wt.ARRAY_BUFFER)}function jve(e){switch(e){case ze.ALPHA:case ze.LUMINANCE:case ze.RED:case ze.RED_INTEGER:case mt.R8:case mt.R8I:case mt.R8UI:case mt.R8_SNORM:case xa.STENCIL_INDEX8:return 1;case ze.LUMINANCE_ALPHA:case ze.RG:case ze.RG_INTEGER:case mt.RGBA4:case mt.R16F:case mt.R16I:case mt.R16UI:case mt.RG8:case mt.RG8I:case mt.RG8UI:case mt.RG8_SNORM:case mt.RGB565:case mt.RGB5_A1:case xa.DEPTH_COMPONENT16:return 2;case ze.DEPTH_COMPONENT:case ze.RGB:case ze.RGB_INTEGER:case mt.RGB8:case mt.RGB8I:case mt.RGB8UI:case mt.RGB8_SNORM:case mt.SRGB8:case xa.DEPTH_COMPONENT24:return 3;case ze.DEPTH_STENCIL:case ze.RGBA:case ze.RGBA_INTEGER:case mt.RGBA8:case mt.R32F:case mt.R11F_G11F_B10F:case mt.RG16F:case mt.R32I:case mt.R32UI:case mt.RG16I:case mt.RG16UI:case mt.RGBA8I:case mt.RGBA8UI:case mt.RGBA8_SNORM:case mt.SRGB8_ALPHA8:case mt.RGB9_E5:case mt.RGB10_A2UI:case mt.RGB10_A2:case xa.DEPTH_STENCIL:case xa.DEPTH_COMPONENT32F:case xa.DEPTH24_STENCIL8:return 4;case xa.DEPTH32F_STENCIL8:return 5;case mt.RGB16F:case mt.RGB16I:case mt.RGB16UI:return 6;case mt.RG32F:case mt.RG32I:case mt.RG32UI:case mt.RGBA16F:case mt.RGBA16I:case mt.RGBA16UI:return 8;case mt.RGB32F:case mt.RGB32I:case mt.RGB32UI:return 12;case mt.RGBA32F:case mt.RGBA32I:case mt.RGBA32UI:return 16;case Yr.COMPRESSED_RGB_S3TC_DXT1_EXT:case Yr.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Yr.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Yr.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Yr.COMPRESSED_R11_EAC:case Yr.COMPRESSED_SIGNED_R11_EAC:case Yr.COMPRESSED_RGB8_ETC2:case Yr.COMPRESSED_SRGB8_ETC2:case Yr.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Yr.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Yr.COMPRESSED_RG11_EAC:case Yr.COMPRESSED_SIGNED_RG11_EAC:case Yr.COMPRESSED_RGBA8_ETC2_EAC:case Yr.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Kb(e){if(A(e))return 0;if("descriptor"in e)return e.glName?Kb(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return jve(t)*r*i}const p_=fe.getLogger("esri.views.webgl.VertexArrayObject");class Ns{constructor(t,i,r,s,n=null){this._context=t,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(dn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,i)=>t+this._buffers[i].size,_(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var i,r;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&p_.warn("Leaked WebGL VAO"));if(this._glName){const s=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):p_.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=Xe(this._indexBuffer)}this._context.instanceCounter.decrement(dn.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const i=t.createVertexArray();t.bindVertexArray(i),this._bindLayout(),t.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:r}=this;t||p_.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||p_.error("Vertex buffer is uninitialized!");const a=i[n];a||p_.error("Vertex element descriptor is empty!"),XX(this._context,this._locations,o,a)}_(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||p_.error("Vertex buffer dictionary is empty!");for(const r in t){const s=t[r];s||p_.error("Vertex buffer is uninitialized!");const n=i[r];YX(this._context,this._locations,s,n)}_(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function La(e,t=WX,i=Ni,r=-1,s=1){let n=null;return t===QM?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new Ns(e,i,{geometry:t},{geometry:ii.createVertex(e,bi.STATIC_DRAW,n)})}function rje(e,t=WX,i=Ni){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Ns(e,i,{geometry:t},{geometry:ii.createVertex(e,bi.STATIC_DRAW,r)})}const Hve=4;function qve(e,t=Hve){return new st(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:t,height:t})}function sje(e,t,i=Hve){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new st(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:i,height:i},r)}function Wve(e){return new st(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class Nie{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=M(),this._heightParameters=Gt(),this._betasRayleigh=M(),this._betasCombined=M(),this._scaleHeight=0,this._radii=tt(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=Ai.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(Ai.radius)}destroy(){this._atmosphereTechnique=Yi(this._atmosphereTechnique),this._atmosphereHazeTechnique=Yi(this._atmosphereHazeTechnique),this._vao=Xe(this._vao),this._handles=at(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx,r=this._handles=new Ht,s=this._view.basemapTerrain;_(s.rootTiles)&&this._updateElevation({spatialReference:s.spatialReference,tile:s.rootTiles[0],extent:s.rootTiles[0].extent,context:"ground"}),r.add(fn(()=>this._view.basemapTerrain,"elevation-change",o=>this._updateElevation(o),{onListenerAdd:()=>this._updateElevation()})),r.add(fn(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const n=new Vve;n.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(PO,n),n.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(PO,n),this._vao=La(i,QM),this._scaleHeight=g7e*QD,te(this._betasRayleigh,Xw[0],Xw[1],Xw[2]),te(this._betasCombined,Xw[0]+X6[0],Xw[1]+X6[1],Xw[2]+X6[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._darkenHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){this._update(t.bindParameters.camera);const s=t.rctx.bindTechnique(i,nje,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture("depthTex",r),this._renderCommon(i.program,t)})}_renderCommon(t,i){if(A(this._vao))return;const r=i.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",m7e),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Pt.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const i=t?t.tile:vt(this._view.basemapTerrain.rootTiles,[null])[0];if(A(i)||i.level!==0)return;const r=this._adjustRadiusForTesselation(Ai.radius+i.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(Ai.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,pi(this._radii,t,t+QD),this._innerFadeDistance=2*Math.sqrt((2*t-K7)*K7)}_update(t){if(A(t))return;this._cameraHeight=Oe(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const i=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/QD));this._heightParameters=gi(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,i),se(this._cameraPosition,t.eye),this._altitudeFade=Mve(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?qt(.6,1,HS(9500,10500,this._cameraHeight-Ai.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const nje=new Us;function oje(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Xve(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function Yve(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Et?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function ZX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-r*c,e[2]=n*h+o*c+r*l-s*a,e[3]=o*h-r*a-s*l-n*c,e}function aje(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e}function lje(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e}function cje(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function uje(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function KD(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,m=i[0],y=i[1],v=i[2],w=i[3];return c=s*m+n*y+o*v+a*w,c<0&&(c=-c,m=-m,y=-y,v=-v,w=-w),1-c>Et?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),e[0]=p*s+f*m,e[1]=p*n+f*y,e[2]=p*o+f*v,e[3]=p*a+f*w,e}function hje(e){const t=Ud(),i=Ud(),r=Ud(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function dje(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function Ug(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Zve(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+o]-t[3*o+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[o]=(t[3*o+s]+t[3*s+o])*r}return e}function pje(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function fje(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const JM=kd,mje=Xi,gje=hq,yje=ZX,vje=IM,_je=ihe,bje=_4,Qve=dq,wje=Qve,Jve=pq,xje=Jve,QX=the,Tje=oO,Sje=rhe;function Eje(e,t,i){const r=xe(t,i);return r<-.999999?(lt(fp,Cje,t),uq(fp)<1e-6&&lt(fp,Aje,t),we(fp,fp),Xve(e,fp,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(lt(fp,t,i),e[0]=fp[0],e[1]=fp[1],e[2]=fp[2],e[3]=1+r,QX(e,e))}const fp=M(),Cje=Ue(1,0,0),Aje=Ue(0,1,0);function Rje(e,t,i,r,s,n){return KD(Fie,t,s,n),KD(Uie,i,r,n),KD(e,Fie,Uie,2*n*(1-n)),e}const Fie=qg(),Uie=qg();function Oje(e,t,i,r){const s=Mje;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],QX(e,Zve(e,s))}const Mje=Sr();Object.freeze(Object.defineProperty({__proto__:null,identity:oje,setAxisAngle:Xve,getAxisAngle:Yve,multiply:ZX,rotateX:aje,rotateY:lje,rotateZ:cje,calculateW:uje,slerp:KD,random:hje,invert:dje,conjugate:Ug,fromMat3:Zve,fromEuler:pje,str:fje,copy:JM,set:mje,add:gje,mul:yje,scale:vje,dot:_je,lerp:bje,length:Qve,len:wje,squaredLength:Jve,sqrLen:xje,normalize:QX,exactEquals:Tje,equals:Sje,rotationTo:Eje,sqlerp:Rje,setAxes:Oje},Symbol.toStringTag,{value:"Module"}));function mE(e=Ije){return[e[0],e[1],e[2],e[3]]}function IO(e,t){return Pje(e[0],e[1],e[2],t,mW.get())}function Pje(e,t,i,r,s=mE()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function $O(e,t,i=mE()){return lt(i,e,t),we(i,i),i[3]=vW(e,t),i}const Ije=[0,0,1,0];class $je{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=M(),this.parallax={anchorPointClouds:M(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.parallaxNew={anchorPointClouds:M(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:Hn.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:sh.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:gv.FINISHED,factor:-1}}}var sh,Hn,gv;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(sh||(sh={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(Hn||(Hn={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(gv||(gv={}));function Si(){return new Float32Array(3)}function rF(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Oi(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function Kve(e,t){return new Float32Array(e,t,3)}function JX(){return Si()}function e_e(){return Oi(1,1,1)}function t_e(){return Oi(1,0,0)}function i_e(){return Oi(0,1,0)}function r_e(){return Oi(0,0,1)}const Dje=JX(),Lje=e_e(),Nje=t_e(),Fje=i_e(),Uje=r_e();Object.freeze(Object.defineProperty({__proto__:null,create:Si,clone:rF,fromValues:Oi,createView:Kve,zeros:JX,ones:e_e,unitX:t_e,unitY:i_e,unitZ:r_e,ZEROS:Dje,ONES:Lje,UNIT_X:Nje,UNIT_Y:Fje,UNIT_Z:Uje},Symbol.toStringTag,{value:"Module"}));function s_e(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function KX(e,t){switch(e.include(yg,t),e.fragment.code.add(x`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case Zs.Default:return void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case Zs.Atlas:return e.include(s_e),void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case Zs.None:case Zs.COUNT:return}}class Oa extends Hr{constructor(t,i){super(t,"vec3",Li.Draw,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class eY extends Hr{constructor(t,i){super(t,"vec2",Li.Draw,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class tY extends Hr{constructor(t,i){super(t,"sampler2D",Li.Draw,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function PR(e,t,i){const r=[new tY(e,t)];if(i){const s=e+"Size";r.push(new eY(s,(n,o)=>{const a=t(n,o);return _(a)?pi(kje,a.descriptor.width,a.descriptor.height):Mh}))}return r}const kje=tt();class zt extends Hr{constructor(t,i){super(t,"sampler2D",Li.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function eL(e,t,i){const r=[new zt(e,t)];if(i){const s=e+"Size";r.push(new fi(s,(n,o)=>{const a=t(n,o);return _(a)?pi(zje,a.descriptor.width,a.descriptor.height):Mh}))}return r}const zje=tt();class Qv{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,i,r=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(r,i),this._technique),this._technique}ensureResources(t){return Wl.LOADED}}class iY extends Qv{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=Yi(this._texture),this._textureNormal=Yi(this._textureNormal),this._textureEmissive=Yi(this._textureEmissive),this._textureOcclusion=Yi(this._textureOcclusion),this._textureMetallicRoughness=Yi(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?Wl.LOADED:Wl.LOADING}get textureBindParameters(){return new n_e(_(this._texture)?this._texture.glTexture:null,_(this._textureNormal)?this._textureNormal.glTexture:null,_(this._textureEmissive)?this._textureEmissive.glTexture:null,_(this._textureOcclusion)?this._textureOcclusion.glTexture:null,_(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(A(this._texture)||t!==this._texture.id)&&(this._texture=Yi(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}_acquire(t,i){if(A(t))return void i(null);const r=this._textureRepository.acquire(t);if(Eu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Yi(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class n_e extends Us{constructor(t=null,i=null,r=null,s=null,n=null){super(),this.texture=t,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const Fbt=Oi(0,.6,.2);var Rt;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(Rt||(Rt={}));function rY(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Rt.Normal&&r&&e.include(KX,t),t.pbrMode!==Rt.Schematic)if(t.pbrMode!==Rt.Disabled){if(t.pbrMode===Rt.Normal){i.code.add(x`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(n===Li.Pass?eL("texMetallicRoughness",o=>o.textureMetallicRoughness,s):PR("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(x`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(n===Li.Pass?eL("texEmission",o=>o.textureEmissive,s):PR("texEmission",o=>o.textureEmissive,s)),i.code.add(x`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(n===Li.Pass?eL("texOcclusion",o=>o.textureOcclusion,s):PR("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(x`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(x`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===Li.Pass?[new xt("emissionFactor",o=>o.emissiveFactor),new xt("mrrFactors",o=>o.mrrFactors)]:[new Oa("emissionFactor",o=>o.emissiveFactor),new Oa("mrrFactors",o=>o.mrrFactors)]),i.code.add(x`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(x`float getBakedOcclusion() { return 1.0; }`);else i.code.add(x`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}class ti extends Hr{constructor(t,i){super(t,"vec4",Li.Pass,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}function sY(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new xt("lightingAmbientSH0",(s,n)=>te(kie,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new ti("lightingAmbientSH_R",(s,n)=>Xi(sm,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new ti("lightingAmbientSH_G",(s,n)=>Xi(sm,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new ti("lightingAmbientSH_B",(s,n)=>Xi(sm,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new xt("lightingAmbientSH0",(s,n)=>te(kie,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new ti("lightingAmbientSH_R1",(s,n)=>Xi(sm,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new ti("lightingAmbientSH_G1",(s,n)=>Xi(sm,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new ti("lightingAmbientSH_B1",(s,n)=>Xi(sm,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new ti("lightingAmbientSH_R2",(s,n)=>Xi(sm,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new ti("lightingAmbientSH_G2",(s,n)=>Xi(sm,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new ti("lightingAmbientSH_B2",(s,n)=>Xi(sm,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Rt.Normal&&t.pbrMode!==Rt.Schematic||i.code.add(x`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const kie=M(),sm=Gt();class We extends Hr{constructor(t,i){super(t,"float",Li.Pass,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function nY(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new We("lightingFixedFactor",(r,s)=>(1-s.lighting.groundLightingFactor)*(1-s.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new xt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection),new xt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(x`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function I5(e){e.vertex.code.add(x`const float PI = 3.141592653589793;`),e.fragment.code.add(x`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}class ew extends Hr{constructor(t,i){super(t,"bool",Li.Pass,(r,s,n)=>r.setUniform1b(t,i(s,n)))}}class Bje extends Hr{constructor(t,i){super(t,"samplerCube",Li.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function o_e(e){const t=e.fragment;t.uniforms.add([new yr("rotationMatrixClouds",(i,r)=>r.clouds.parallax.transform),new yr("rotationMatrixCloudsCrossFade",(i,r)=>r.clouds.parallaxNew.transform),new xt("anchorPosition",(i,r)=>r.clouds.parallax.anchorPointClouds),new xt("anchorPositionCrossFade",(i,r)=>r.clouds.parallaxNew.anchorPointClouds),new fi("cloudVariables",(i,r)=>_(r.clouds.data)?pi(Vje,r.clouds.data.coverage,r.clouds.data.absorption):Mh),new We("cloudsHeight",(i,r)=>r.clouds.parallax.cloudsHeight),new We("radiusCurvatureCorrectionFactor",(i,r)=>r.clouds.parallax.radiusCurvatureCorrectionFactor),new We("totalFadeInOut",(i,r)=>r.clouds.fadeInOut.stage===Hn.FINISHED?r.clouds.fadeInOutHeight.factor+Math.max(De(r.clouds.fadeIn.factor,0,1)):r.clouds.fadeInOutHeight.factor+Math.max(De(r.clouds.fadeInOut.factor,0,1))),new We("crossFadeAnchorFactor",(i,r)=>De(r.clouds.crossFade.factor,0,1)),new Bje("cubeMap",(i,r)=>_(r.clouds.data)?r.clouds.data.cubeMap.colorTexture:null),new ew("crossFade",(i,r)=>r.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",Ai.radius),t.code.add(x`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(x`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(x`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new xt("lightingMainDirection",(i,r)=>r.lighting.lightingMainDirection),new xt("lightingMainIntensity",(i,r)=>r.lighting.mainLight.intensity)]),t.code.add(x`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(x`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(x`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(x`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(x`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const Vje=tt();function Yf(e){e.code.add(x`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function Gje(){const e=new Hi;e.attributes.add(R.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new yr("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new yr("inverseViewMatrix",(r,s)=>us(jje,s.camera.viewMatrix))]),t.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(Yf),i.include(yc),e.include(sY,{pbrMode:Rt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(I5),e.include(M5),e.include(nY,{isGround:!1}),e.include(o_e,{instancedDoublePrecision:!1,isGround:!1}),i.uniforms.add([new xt("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(x`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const jje=Ae(),Hje=Object.freeze(Object.defineProperty({__proto__:null,build:Gje},Symbol.toStringTag,{value:"Module"}));class $5 extends cr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=$5.shader.get().build();return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:Xf(Re.ONE,Re.SRC_ALPHA),depthTest:{func:hr.LEQUAL},colorWrite:Kt})}}$5.shader=new Ki(Hje,()=>import("./CloudsComposition.glsl.99cc4188.js"));function qje(e){return _(e)&&_(e.cubeMap)&&e.coverage>0}function zie(e){return _(e)&&!e.running}let T1=class extends Ee{constructor(e){super(e),this._technique=new $5(e),this._vao=La(e.rctx)}destroy(){this._technique=Yi(this._technique),this._vao=Xe(this._vao)}render(e,t){const i=e.bindParameters.clouds;if(A(this._vao)||A(i.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(i,e.bindParameters.camera.eye,t);const r=e.rctx.bindTechnique(this._technique,Jje,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Pt.TRIANGLE_STRIP,0,4),Qje(i)&&this.requestRender()}_setFadeInStage(e,t){const i=performance.now(),r=e.parallax.anchorPointClouds;e.fadeIn.stage===sh.FINISHED&&(e.fadeIn.factor=1,se(r,mp),e.fadeIn.stage=sh.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=Hn.FINISHED);const s=Gie(e,t);e.fadeIn.stage===sh.CHANGE_ANCHOR&&s&&zie(e.data)&&(se(r,mp),e.fadeIn.stage=sh.FADE_IN,e.startTime=i),e.fadeIn.factor>0&&e.fadeIn.stage===sh.FADE_IN&&(e.fadeIn.factor=1-(i-e.startTime)/Vie),e.fadeIn.factor<=0&&e.fadeIn.stage===sh.FADE_IN&&(e.fadeIn.stage=sh.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:i}=e,r=e.parallax.anchorPointClouds;e.crossFade.enabled||(se(e.parallaxNew.anchorPointClouds,mp),e.startTime=t,i.factor=0,e.crossFade.enabled=!0),i.factor<1&&e.crossFade.enabled&&(i.factor=(t-e.startTime)/Yje),i.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,i.factor=1,se(r,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const i=performance.now(),{fadeInOut:r,crossFade:s}=e;r.stage===Hn.FINISHED&&(e.startTime=i,r.factor=0,r.stage=Hn.FADE_OUT),r.factor<1&&r.stage===Hn.FADE_OUT&&(r.factor=(i-e.startTime)/Xje),r.factor>=1&&r.stage===Hn.FADE_OUT&&(r.factor=1,se(e.parallax.anchorPointClouds,mp)),r.factor>=1&&r.stage===Hn.FADE_OUT&&Gie(e,t)&&(r.factor=1,r.stage=Hn.SWITCH,e.crossFade.enabled=!1,s.factor=1),zie(e.data)&&r.stage===Hn.SWITCH&&(e.startTime=i,r.factor=1,r.stage=Hn.FADE_IN,se(e.parallax.anchorPointClouds,mp),e.crossFade.enabled=!1,s.factor=1),r.factor>0&&r.stage===Hn.FADE_IN&&(r.factor=1-(i-e.startTime)/Vie),r.factor<=0&&r.stage===Hn.FADE_IN&&(r.stage=Hn.FINISHED,r.factor=0)}_setFadeInOutHeight(e,t){const i=performance.now(),r=e.fadeInOutHeight,s=(i-(r.stage===gv.FINISHED?i:e.startTimeHeightFade))/Zje;r.factor+=t?-s:s,e.startTimeHeightFade=i,r.factor=De(r.factor,0,1),r.stage=gv.HEIGHT_FADE}_setParallaxParameters(e,t,i){const{parallax:r}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=Oe(t)-this.planetRadius>lh?1:0),we(mp,t),oe(mp,mp,this.planetRadius),r.anchorPointClouds[0]===0&&r.anchorPointClouds[1]===0&&r.anchorPointClouds[2]===0&&se(r.anchorPointClouds,mp);const s=Oe(pe(Wje,r.anchorPointClouds,mp));let n=!0;s>e.fadeIn.distanceThresholdFactor*r.cloudsHeight||e.fadeIn.stage!==sh.FINISHED?this._setFadeInStage(e,t):s>e.fadeInOut.distanceThresholdFactor*r.cloudsHeight||e.fadeInOut.stage!==Hn.FINISHED?this._setFadeInOutStage(e,t):s>e.crossFade.distanceThresholdFactor*r.cloudsHeight&&!i||e.crossFade.enabled?this._setCrossFadingStage(e):n=!1;const o=Oe(t),a=o-this.planetRadius;if((a>1.7*lh||a<-lh)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(a>lh||a<-.35*lh)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):a<lh&&a>-.35*lh&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=gv.FINISHED,r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-this.planetRadius*this.planetRadius,0))/o,$O(Bie,r.anchorPointClouds,Yw),r.transform=Ae(),tc(r.transform,r.transform,Yw[3],Yw),n){const{parallaxNew:l}=e;$O(Bie,l.anchorPointClouds,Yw),l.transform=Ae(),tc(l.transform,l.transform,Yw[3],Yw)}se(e.cameraPositionLastFrame,t)}};u([d({constructOnly:!0})],T1.prototype,"rctx",void 0),u([d({constructOnly:!0})],T1.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],T1.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],T1.prototype,"requestRender",void 0),T1=u([P("esri.views.3d.environment.CloudsComposition")],T1);const Bie=Ue(0,0,1),Yw=mE(),mp=M(),Wje=M(),Vie=500,Xje=250,Yje=500,Zje=500;function Qje(e){return e.crossFade.enabled||e.fadeInOut.stage!==Hn.FINISHED||e.fadeIn.stage!==sh.FINISHED||e.fadeInOutHeight.stage!==gv.FINISHED}function Gie(e,t){return Bb(e.cameraPositionLastFrame,t)}const Jje=new Us;function Ih(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Kje(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function oY(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function aY(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function $h(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Nw(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=i*p+r*f+s*m;return y?(y=1/y,e[0]=p*y,e[1]=(-h*r+s*c)*y,e[2]=(a*r-s*o)*y,e[3]=f*y,e[4]=(h*i-s*l)*y,e[5]=(-a*i+s*n)*y,e[6]=m*y,e[7]=(-c*i+r*l)*y,e[8]=(o*i-r*n)*y,e):null}function eHe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-r*h,e[2]=r*a-s*o,e[3]=a*l-n*h,e[4]=i*h-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e}function tHe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function D5(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1],y=i[2],v=i[3],w=i[4],b=i[5],S=i[6],T=i[7],E=i[8];return e[0]=f*r+m*o+y*c,e[1]=f*s+m*a+y*h,e[2]=f*n+m*l+y*p,e[3]=v*r+w*o+b*c,e[4]=v*s+w*a+b*h,e[5]=v*n+w*l+b*p,e[6]=S*r+T*o+E*c,e[7]=S*s+T*a+E*h,e[8]=S*n+T*l+E*p,e}function sF(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*r+m*o+c,e[7]=f*s+m*a+h,e[8]=f*n+m*l+p,e}function lY(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(i),m=Math.cos(i);return e[0]=m*r+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*r,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function cY(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function iHe(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function rHe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function sHe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function nHe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function oHe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function L5(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,v=n*o,w=n*a,b=n*l;return e[0]=1-p-y,e[3]=h-b,e[6]=f+w,e[1]=h+b,e[4]=1-c-y,e[7]=m-v,e[2]=f-w,e[5]=m+v,e[8]=1-c-p,e}function a_e(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=i*p+r*f+s*m;if(!y)return null;const v=1/y;return e[0]=p*v,e[1]=(-h*r+s*c)*v,e[2]=(a*r-s*o)*v,e[3]=f*v,e[4]=(h*i-s*l)*v,e[5]=(-a*i+s*n)*v,e[6]=m*v,e[7]=(-c*i+r*l)*v,e[8]=(o*i-r*n)*v,e}function x2(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,C=r*l-s*a,O=r*c-n*a,I=s*c-n*l,N=h*v-p*y,D=h*w-f*y,z=h*b-m*y,B=p*w-f*v,k=p*b-m*v,Y=f*b-m*w;let Z=S*Y-T*k+E*B+C*z-O*D+I*N;return Z?(Z=1/Z,e[0]=(a*Y-l*k+c*B)*Z,e[1]=(l*z-o*Y-c*D)*Z,e[2]=(o*k-a*z+c*N)*Z,e[3]=(s*k-r*Y-n*B)*Z,e[4]=(i*Y-s*z+n*D)*Z,e[5]=(r*z-i*k-n*N)*Z,e[6]=(v*I-w*O+b*C)*Z,e[7]=(w*E-y*I-b*T)*Z,e[8]=(y*O-v*E+b*S)*Z,e):null}function aHe(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function lHe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function cHe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function uHe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function l_e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function hHe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function dHe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function pHe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function fHe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],m=t[2],y=t[3],v=t[4],w=t[5],b=t[6],S=t[7],T=t[8];return Math.abs(i-p)<=Et*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=Et*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=Et*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=Et*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-v)<=Et*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-w)<=Et*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-b)<=Et*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-S)<=Et*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=Et*Math.max(1,Math.abs(h),Math.abs(T))}function uY(e){const t=Et,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const mHe=D5,gHe=l_e;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Ih,copy:Kje,set:oY,identity:aY,transpose:$h,invert:Nw,adjoint:eHe,determinant:tHe,multiply:D5,translate:sF,rotate:lY,scale:cY,scaleByVec2:iHe,fromTranslation:rHe,fromRotation:sHe,fromScaling:nHe,fromMat2d:oHe,fromQuat:L5,normalFromMat4Legacy:a_e,normalFromMat4:x2,projection:aHe,str:lHe,frob:cHe,add:uHe,subtract:l_e,multiplyScalar:hHe,multiplyScalarAndAdd:dHe,exactEquals:pHe,equals:fHe,isOrthoNormal:uY,mul:mHe,sub:gHe},Symbol.toStringTag,{value:"Module"}));function hY(){return new Float32Array(2)}function yHe(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function Ta(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function vHe(e,t){return new Float32Array(e,t,2)}function c_e(){return hY()}function u_e(){return Ta(1,1)}function h_e(){return Ta(1,0)}function d_e(){return Ta(0,1)}const _He=c_e(),bHe=u_e(),wHe=h_e(),xHe=d_e();Object.freeze(Object.defineProperty({__proto__:null,create:hY,clone:yHe,fromValues:Ta,createView:vHe,zeros:c_e,ones:u_e,unitX:h_e,unitY:d_e,ZEROS:_He,ONES:bHe,UNIT_X:wHe,UNIT_Y:xHe},Symbol.toStringTag,{value:"Module"}));var Ld;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(Ld||(Ld={}));class p_e extends Da{constructor(){super(...arguments),this.steps=Ld.SIXTEEN}}u([G({count:Ld.COUNT})],p_e.prototype,"steps",void 0);const ch=he("esri-mobile")?64:128,THe=ch/128,wd=Math.ceil(Math.sqrt(ch)),Pd=(ch+2)*wd,SHe=1e5,Q6=128,EHe=Pd/1560;function Jv(e,t=!0){e.attributes.add(R.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(x`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?x`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class DO extends Hr{constructor(t,i){super(t,"mat3",Li.Draw,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class f_e extends Us{constructor(){super(...arguments),this.viewMatrix=Sr()}}function CHe(e){const t=new Hi;return t.include(Jv,!1),t.fragment.uniforms.add(new $i("cloudRadius")),t.fragment.uniforms.add(new $i("halfCubeMapSize")),t.fragment.uniforms.add(new $i("power")),t.fragment.uniforms.add(new $i("sigmaE")),t.fragment.uniforms.add(new $i("density")),t.fragment.uniforms.add(new $i("cloudSize")),t.fragment.uniforms.add(new $i("detailSize")),t.fragment.uniforms.add(new $i("smoothness")),t.fragment.uniforms.add(new $i("cloudHeight")),t.fragment.uniforms.add(new $i("coverage")),t.fragment.uniforms.add(new DO("view",i=>i.viewMatrix)),t.fragment.uniforms.add(new $r("cloudShapeTexture")),t.fragment.code.add(x`
    const int STEPS = ${e.steps===Ld.SIXTEEN?x`16`:e.steps===Ld.HUNDRED?x`100`:x`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(x`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${x.float(Pd)};
      const float dataWidth = ${x.float(Pd)};
      const float tileRows = ${x.float(wd)};
      const vec3 atlasDimensions = vec3(${x.float(ch)}, ${x.float(ch)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${x.float(THe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${x.float(EHe)} * p) / ${x.float(Pd)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(x`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(x`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(x`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(x`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(x`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const AHe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:f_e,build:CHe},Symbol.toStringTag,{value:"Module"}));class YE{constructor(t,i,r,s,n,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingStepType=l,this.median=c}}const m_e={sunny:new YE([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Ld.SIXTEEN),cloudy:new YE([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Ld.TWOHUNDRED,.6),rainy:new YE([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Ld.TWOHUNDRED,.4),snowy:new YE([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Ld.HUNDRED,.65),foggy:new YE([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Ld.SIXTEEN)};class N5 extends cr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=N5.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:so(Re.ONE,Re.ONE,Re.ZERO,Re.ZERO),depthTest:{func:hr.LEQUAL},colorWrite:Kt})}}N5.shader=new Ki(AHe,()=>import("./Clouds.glsl.ed0f4240.js"));var su;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(su||(su={}));class tj extends Da{constructor(){super(...arguments),this.mode=su.Full}}u([G({count:su.COUNT})],tj.prototype,"mode",void 0);function RHe(e){const t=new Hi;return t.include(Jv,!1),t.fragment.code.add(x`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new vg("weatherTile")),e.mode===su.Full&&t.fragment.code.add(x`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${x.float(wd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${x.float(8)});

      float worley0 = worley(p, ${x.float(2)} * 2.0);
      float worley1 = worley(p, ${x.float(2)} * 8.0);
      float worley2 = worley(p, ${x.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${x.float(2)});
      float worley1 = worley(p, ${x.float(2)} * 2.0);
      float worley2 = worley(p, ${x.float(2)} * 4.0);
      float worley3 = worley(p, ${x.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.code.add(x`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${x.float(Q6)});

      // Get global coordinates of p
      p += weatherTile * ${x.float(Q6)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${x.float(SHe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(x`void main() {`),e.mode===su.Full&&t.fragment.code.add(x`
        float padWidth = 1.0;
        float paddedSize = ${x.float(ch)} + 2.0 * padWidth;
        float tileCount = ${x.float(wd)} * ${x.float(wd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${x.float(ch)};
          }

          if (startPadY) {
            pixel.y += ${x.float(ch)};
          }

          if (endPadX) {
            pixel.x -= ${x.float(ch)};
          }

          if (endPadY) {
            pixel.y -= ${x.float(ch)};
          }

          uv = vec2(pixel.xy / ${x.float(ch)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${x.float(ch)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${x.float(wd)} * ${x.float(wd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${x.float(wd)} * ${x.float(wd)});
        p = p_;
        p.z /= (${x.float(wd)} * ${x.float(wd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(x`
      vec2 mapUV = ${x.float(Q6)} * (gl_FragCoord.xy / ${x.float(Pd)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===su.Full?x`gl_FragColor.ba = vec2(0.0, map);`:x`gl_FragColor = vec4(map);`};
    }
  `),t}const OHe=Object.freeze(Object.defineProperty({__proto__:null,build:RHe},Symbol.toStringTag,{value:"Module"}));class LO extends cr{initializeProgram(t){const i=LO.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:this.configuration.mode===su.Full?Xf(Re.ONE,Re.ZERO):so(Re.ZERO,Re.ONE,Re.ONE,Re.ZERO),depthTest:{func:hr.ALWAYS},colorWrite:Kt})}}LO.shader=new Ki(OHe,()=>import("./NoiseTextureAtlas.glsl.ad4e47b9.js"));class xT{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(dn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==ui.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(dn.Renderbuffer,this),this._context=null)}}const MHe=fe.getLogger("esri.views.webgl.FrameBufferObject");class wr{constructor(t,i,r=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=F({},i),t.instanceCounter.increment(dn.FramebufferObject,this),_(r)){Array.isArray(r)||(r=[r]);for(let o=0;o<r.length;++o){const a=r[o],l=Gc.COLOR_ATTACHMENT0+o;let c;Hie(a)?(Dm(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new st(this._context,c))),BP(c,this._desc)):(jie(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new xT(this._context,c))),J6(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(_(s)){let o,a;if(Hie(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),Dm(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new st(this._context,a)),BP(a,this._desc);else{jie(s)?(a=s.descriptor,o=s):(a=s,o=new xT(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Ei.DEPTH_STENCIL_RENDER_BUFFER;l===Ei.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Ei.DEPTH_RENDER_BUFFER||l===Ei.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),J6(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(dn.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(Gc.COLOR_ATTACHMENT0);return t&&Dm(t)?t:null}get colorAttachment(){return this._colorAttachments.get(Gc.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+Kb(r),0)+Kb(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&Dm(i)?i:null}attachColorTexture(t,i=Gc.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),BP(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=Gc.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(Dm(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=Gc.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);Dm(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(A(t))return;const i=t.descriptor;i.pixelFormat!==ze.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==St.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),BP(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Ei.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Ei.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,Aie)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Aie)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(A(t))return;const i=t.descriptor;if(i.internalFormat!==xa.DEPTH_STENCIL&&i.internalFormat!==xa.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),J6(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===xa.DEPTH_STENCIL?Ei.DEPTH_STENCIL_RENDER_BUFFER:Ei.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Ei.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(Sn.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Ei.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Sn.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,o,a){(t<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==pt.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,st.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(st.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(pt.TEXTURE_2D,0,n,o,t,i,r,s),h.bindTexture(p,st.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,o,a)}async readPixelsAsync(t,i,r,s,n,o,a){if(this._context.type!==ui.WEBGL2)return rh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,o,a);const l=this._context.gl,c=ii.createPixelPack(this._context,bi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,i,r,s,n,o,0),this._context.unbindBuffer(wt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(!this._initialized)return r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=Sn.FRAMEBUFFER){var h,p,f,m;const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(t,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:Qr.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(i.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===Qr.TEXTURE||o===Qr.CUBEMAP)this._colorAttachments.set(Gc.COLOR_ATTACHMENT0,PHe(r,n,this.descriptor.colorTarget===Qr.CUBEMAP?pt.TEXTURE_CUBE_MAP:pt.TEXTURE_2D));else{const y=new xT(r,{internalFormat:mt.RGBA4,width:a,height:l});this._colorAttachments.set(Gc.COLOR_ATTACHMENT0,y)}this._colorAttachments.forEach((y,v)=>{y&&(Dm(y)?this._framebufferTexture2D(y.glName,v,qie(y),t):i.framebufferRenderbuffer(t,v,i.RENDERBUFFER,y.glName))});const c=(m=n.depthStencilTarget)!=null?m:Ei.NONE;switch(c){case Ei.DEPTH_RENDER_BUFFER:case Ei.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new xT(r,{internalFormat:n.depthStencilTarget===Ei.DEPTH_RENDER_BUFFER?xa.DEPTH_COMPONENT16:xa.DEPTH_STENCIL,width:a,height:l}));const y=c===Ei.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(t,y,i.RENDERBUFFER,this._depthAttachment.glName);break}case Ei.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new xT(r,{internalFormat:xa.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(t,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Ei.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const y={target:pt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:St.UNSIGNED_INT_24_8,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new st(r,y)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,qie(this._depthStencilTexture),t)}MO()&&i.checkFramebufferStatus(t)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,i=Gc.COLOR_ATTACHMENT0,r=pt.TEXTURE_2D,s=Sn.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){rh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return Dm(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(Sn.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Ei.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Sn.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(Sn.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(wr._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;wr._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else wr._MAX_COLOR_ATTACHMENTS=1}const i=t-Gc.COLOR_ATTACHMENT0;i+1>wr._MAX_COLOR_ATTACHMENTS&&MHe.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${wr._MAX_COLOR_ATTACHMENTS} color attachments`)}}function Dm(e){return"type"in e&&e.type==="texture"}function jie(e){return"type"in e&&e.type==="renderbuffer"}function Hie(e){return Dm(e)||"pixelFormat"in e}function PHe(e,t,i){return new st(e,{target:i,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function BP(e,t){e.target!==pt.TEXTURE_2D&&e.target!==pt.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function J6(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function qie(e){return e.descriptor.target===pt.TEXTURE_CUBE_MAP?pt.TEXTURE_CUBE_MAP_POSITIVE_X:pt.TEXTURE_2D}wr._MAX_COLOR_ATTACHMENTS=-1;class g_e extends Ee{constructor(t){let i;super(t),this._weatherTile=Ta(0,0),this._needsRender=!0,this._frameBuffer=new wr(t.context.renderContext.rctx,{colorTarget:Qr.TEXTURE,width:Pd,height:Pd},{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,hasMipmap:!1,width:Pd,height:Pd}),this._vao=La(t.context.renderContext.rctx),this._shaderTechniqueRepository=t.context.shaderTechniqueRepository,this._ensureRendered=()=>(_(i)?_(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(i=this._render(t.context.renderContext.rctx,su.WeatherMap)):_(this.fullTechnique)&&this.fullTechnique.compiled&&(i=this._render(t.context.renderContext.rctx,su.Full)),i)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(t){this._weatherTile[0]===t[0]&&this._weatherTile[1]===t[1]||(this._weatherTile=t,this._setDirty())}destroy(){this._fullTechnique=Yi(this._fullTechnique),this._weatherMapTechnique=Yi(this._weatherMapTechnique),this._frameBuffer=Xe(this._frameBuffer),this._vao=Xe(this._vao)}get fullTechnique(){if(A(this._fullTechnique)){const t=new tj;t.mode=su.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(LO,t)}return this._fullTechnique}get weatherMapTechnique(){if(A(this._weatherMapTechnique)){const t=new tj;t.mode=su.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(LO,t)}return this._weatherMapTechnique}_render(t,i){if(A(this._vao)||A(this._frameBuffer))return null;const r=i===su.Full?this.fullTechnique:this.weatherMapTechnique;if(A(r))return null;const s=t.getViewport();t.setViewport(0,0,Pd,Pd),t.bindFramebuffer(this._frameBuffer);const n=t.bindTechnique(r);return n.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),t.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}}u([d({constructOnly:!0})],g_e.prototype,"context",void 0);function y_e(e){e.include(Tu),e.uniforms.add([new zt("geometryDepthTexture",(t,i)=>i.multipassGeometry.linearDepthTexture),new fi("nearFar",(t,i)=>i.camera.nearFar)]),e.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class IHe{constructor(){this.enabled=!1}}function Su(e,t){t.hasMultipassTerrain&&(e.fragment.include(Tu),e.fragment.uniforms.add(new zt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new fi("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.uniforms.add(new fi("inverseViewport",(i,r)=>r.inverseViewport)),e.fragment.code.add(x`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class $He{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function DHe(e,t){const i=e.fragment.uniforms;i.add(new fi("nearFar",(r,s)=>s.camera.nearFar)),i.add(new zt("depthMap",(r,s)=>s.linearDepthTexture)),i.add(new yr("view",(r,s)=>s.ssr.camera.viewMatrix)),i.add(new yr("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.add(new We("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.add(new zt("lastFrameColorMap",(r,s)=>s.ssr.lastFrameColorTexture)),i.add(new yr("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),e.fragment.include(Tu),e.fragment.code.add(x`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class LHe{constructor(){this.reprojectionMatrix=Ae()}}var Se;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Se||(Se={}));class dY{constructor(t=M()){this.intensity=t}}class v_e{constructor(t=M(),i=Ue(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class ij{constructor(t=M(),i=Ue(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class __e{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function NHe(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function K6(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function wS(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function b_e(e){return(e+1)*(e+1)}function FHe(e){return De(Math.floor(Math.sqrt(e)-1),0,2)}function w_e(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=b_e(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function UHe(e,t){const i=b_e(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function kHe(e,t){const i=FHe(t.r.length);for(const r of e)Wo(rj,r.direction),w_e(rj,i,rg),NHe(rg,tL),K6(rg,r.intensity[0],Zw),wS(t.r,Zw),K6(rg,r.intensity[1],Zw),wS(t.g,Zw),K6(rg,r.intensity[2],Zw),wS(t.b,Zw);return t}function zHe(e,t){w_e(rj,0,rg);for(const i of e)t.r[0]+=rg[0]*tL[0]*i.intensity[0]*4*Math.PI,t.g[0]+=rg[0]*tL[0]*i.intensity[1]*4*Math.PI,t.b[0]+=rg[0]*tL[0]*i.intensity[2]*4*Math.PI;return t}function BHe(e,t,i,r){UHe(t,r),te(i.intensity,0,0,0);let s=!1;const n=VHe,o=GHe,a=jHe;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof ij&&!s?(se(i.direction,l.direction),se(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof ij||l instanceof v_e?n.push(l):l instanceof dY?o.push(l):l instanceof __e&&a.push(l);kHe(n,r),zHe(o,r);for(const l of a)wS(r.r,l.r),wS(r.g,l.g),wS(r.b,l.b)}const VHe=[],GHe=[],jHe=[],rg=[0],Zw=[0],rj=M(),tL=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],gE=.4;class HHe{constructor(){this._shOrder=2,this._oldSunlight={direction:M(),ambient:{color:M(),intensity:1},diffuse:{color:M(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new __e,this._mainLight={intensity:M(),direction:Ue(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){BHe(t,this._shOrder,this._mainLight,this._sphericalHarmonics),se(this._oldSunlight.direction,this._mainLight.direction);const i=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,oe(this._oldSunlight.diffuse.color,this._mainLight.intensity,i),se(VP,this._oldSunlight.diffuse.color),oe(VP,VP,gE*this.globalFactor),de(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,VP)}get old(){return this._oldSunlight}}const VP=M();class F5{constructor(t,i,r){this.shadowMap=t,this.ssaoHelper=i,this.slicePlane=r,this.slot=Se.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=tt(),this.lighting=new HHe,this.ssr=new LHe,this.multipassTerrain=new $He,this.multipassGeometry=new IHe,this.clouds=new $je,this.overlays=[]}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let ua=class extends Ee{constructor(e){super(e),this._frameTask=null,this._handles=new Ht,this._cubeMapSize=he("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new p_e,this._bindParameters=new F5(null,null,null),this._drawParameters=new f_e,this._weatherTile=Ta(0,0),this._weatherTileCount=128,this.coverage=qt(Fa.coverage[0],Fa.coverage[1],.5),this.density=qt(Fa.density[0],Fa.density[1],.5),this.absorption=qt(Fa.absorption[0],Fa.absorption[1],.5),this.cloudSize=qt(Fa.cloudSize[0],Fa.cloudSize[1],.5),this.detailSize=qt(Fa.detailSize[0],Fa.detailSize[1],.5),this.smoothness=qt(Fa.smoothness[0],Fa.smoothness[1],.5),this.cloudHeight=qt(Fa.cloudHeight[0],Fa.cloudHeight[1],.5),this.raymarchingStepType=Fa.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Ae(),this._cameraPositionLastFrame=M(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new N5({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let i=Ta((e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*i[0]-1));i=Ta(Math.floor(2*this._weatherTileCount*i[0]),Math.floor(4*(this._weatherTileCount-r)*i[1]));let s=0,n=0;if(_(this.view.environment)&&this.view.environment.lighting.type==="sun"&&_(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}return i[0]=(i[0]+s)%(2*this._weatherTileCount),i[1]=(i[1]+n%100)%(4*this._weatherTileCount),i}initialize(){this._vao=La(this.context.renderContext.rctx);const e=wi(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(ae(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),Ft))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Yi(e)),this._techniques=null,this._frameBufferCube=Xe(this._frameBufferCube),this._vao=Xe(this._vao),this._noiseTexture=at(this._noiseTexture)}_ensureNoiseTexture(){if(A(this._noiseTexture)){const e=this.context;this._noiseTexture=new g_e({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();_(this._noiseTexture)&&_(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if(A(this._frameBufferCube)){const e={target:pt.TEXTURE_CUBE_MAP,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new wr(this.context.renderContext.rctx,{colorTarget:Qr.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===Hn.FADE_OUT||e.fadeInOutHeight.stage!==gv.FINISHED}applyPreset(e,t){const i=e.median,r=s=>{const n=qt(s[0],s[1],i);return t<.5?qt(s[0],n,2*t):qt(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||A(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!Bb(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void se(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const i=this._ensureNoiseTexture();if(A(i))return;const r=this.context.renderContext.rctx,s=r.bindTechnique(t),n=1+this.absorption,o=qt(35,120,this.absorption);s.bindTexture("cloudShapeTexture",i),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",qt(0,.3,this.density)),s.setUniform1f("cloudSize",qt(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",qt(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",qt(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",qt(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=r.getViewport();r.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),r.bindFramebuffer(this.frameBufferCube);for(let l=0;l<5;l++){const c=qHe[l],h=WHe[l];Tpe(this._viewMatrix,XHe,c,h),Ih(this._drawParameters.viewMatrix,this._viewMatrix);const p=pt.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush()}this.running=!1,r.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),e.madeProgress()}};u([d({constructOnly:!0})],ua.prototype,"context",void 0),u([d({constructOnly:!0})],ua.prototype,"view",void 0),u([d({constructOnly:!0})],ua.prototype,"requestRender",void 0),u([d()],ua.prototype,"_frameTask",void 0),u([d()],ua.prototype,"coverage",void 0),u([d()],ua.prototype,"density",void 0),u([d()],ua.prototype,"absorption",void 0),u([d()],ua.prototype,"cloudSize",void 0),u([d()],ua.prototype,"detailSize",void 0),u([d()],ua.prototype,"smoothness",void 0),u([d()],ua.prototype,"cloudHeight",void 0),u([d()],ua.prototype,"raymarchingStepType",void 0),u([d()],ua.prototype,"running",void 0),ua=u([P("esri.views.3d.environment.CloudsGenerator")],ua);const qHe=[Oi(1,0,0),Oi(-1,0,0),Oi(0,1,0),Oi(0,-1,0),Oi(0,0,1)],WHe=[Oi(0,1,0),Oi(0,1,0),Oi(0,0,-1),Oi(0,0,1),Oi(0,1,0)],XHe=JX(),Fa=m_e.sunny;function YHe(e){const t=new Hi;t.attributes.add(R.POSITION,"vec2"),t.include(yg,{textureCoordinateType:Zs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new yr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new yr("inverseViewMatrix",(s,n)=>us(ZHe,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new $i("atmosphereC")),r.uniforms.add(new ul("cameraPosition")),r.uniforms.add(new fi("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new $r("depthTex")),r.uniforms.add(new $i("fogStrength")),r.uniforms.add(new $i("fogAmount")),r.uniforms.add(new ul("fogColor")),t.include(M5),r.include(Tu),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(x`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?x`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const ZHe=Ae(),QHe=Object.freeze(Object.defineProperty({__proto__:null,build:YHe},Symbol.toStringTag,{value:"Module"}));class NO extends cr{initializeProgram(t){const i=NO.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return this.configuration.haze?Ut({blending:so(Re.ONE,Re.ZERO,Re.ONE_MINUS_SRC_COLOR,Re.ONE),colorWrite:Kt}):Ut({blending:so(Re.SRC_ALPHA,Re.ZERO,Re.ONE_MINUS_SRC_ALPHA,Re.ONE),colorWrite:Kt})}}NO.shader=new Ki(QHe,()=>import("./Fog.glsl.dd47a990.js"));class sj extends Da{constructor(){super(...arguments),this.haze=!1}}u([G()],sj.prototype,"haze",void 0);let BA=class extends Ee{constructor(e){super(e),this._fogColor=Si(),this._fogColorAtNight=Si(),this._cameraDirection=Si(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=La(t,QM);const i=wi(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+QD}destroy(){this._hazeFogTechnique=Yi(this._hazeFogTechnique),this._thickFogTechnique=Yi(this._thickFogTechnique),this._vao=Xe(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(A(this._thickFogTechnique)){const e=new sj;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(NO,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(A(this._hazeFogTechnique)){const e=new sj;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(NO,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,i),this._fogAmount<=0))return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(r,JHe,e.bindParameters);s.renderDepthDetached(()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e)})}_renderFog(e,t){if(A(this._vao))return!1;const i=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Pt.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){const r=e.bindParameters.camera,s=t?.1:0;i?te(this._fogColor,.5,.5,.5):t?te(this._fogColor,1.5,1.5,1.5):te(this._fogColor,.24,.44,.8),oe(this._fogColorAtNight,this._fogColor,s),we(this._cameraDirection,r.eye);const n=Math.max(0,xe(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));tn(this._fogColor,this._fogColorAtNight,this._fogColor,n);const o=Oe(r.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-HS(this._foggyFadeStart*lh,this._foggyFadeEnd*lh,Math.abs(o-this._planetRadius)):1-HS(this._hazeFadeStart*lh,this._hazeFadeEnd*lh,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],BA.prototype,"context",void 0),u([d({constructOnly:!0})],BA.prototype,"view",void 0),BA=u([P("esri.views.3d.environment.Fog")],BA);const JHe=new Us;async function ap(e,t){const{data:i}=await ai(e,F({responseType:"image"},t));return i}var Nf;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(Nf||(Nf={}));class nF extends Da{constructor(){super(...arguments),this.geometry=Nf.Cone}}u([G({count:Nf.COUNT})],nF.prototype,"geometry",void 0);function To(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class Mv extends Hr{constructor(t){super(t,"mat4")}}class pY extends Us{}function KHe(e){const t=new Hi,{vertex:i,fragment:r}=t;if(e.geometry===Nf.Underground)t.attributes.add(R.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new xt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new ul("cameraPosition"),new $i("undergroundFadeAlpha")]),i.code.add(x`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(x`void main() {
gl_FragColor = color;
}`);else{t.include(To),t.attributes.add(R.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===Nf.Cylinder;i.uniforms.add([new yr("proj",(a,l)=>l.camera.projectionMatrix),new Mv("view"),new xt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)]),s||(t.varyings.add("innerFactor","float"),i.uniforms.add(new ul("silCircleCenter")),i.uniforms.add(new ul("silCircleV1")),i.uniforms.add(new ul("silCircleV2")),i.uniforms.add(new vg("texV")),i.uniforms.add(new $i("innerScale")));const n=6.2831853,o=1/128;i.code.add(x`
		void main(void) {
      ${s?x`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:x`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${x.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${x.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new zt("tex",a=>a.texture)),s||r.uniforms.add(new $i("altitudeFade")),r.code.add(x`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?x`gl_FragColor = atmosphereColor;`:x`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const eqe=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:pY,build:KHe},Symbol.toStringTag,{value:"Module"}));class T2 extends cr{initializeProgram(t){const i=T2.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return this.configuration.geometry===Nf.Cylinder?Ut({blending:so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),culling:qX,depthTest:{func:hr.LEQUAL},colorWrite:Kt}):Ut({blending:so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:hr.LEQUAL},colorWrite:Kt})}}T2.shader=new Ki(eqe,()=>import("./SimpleAtmosphere.glsl.6c100dae.js"));const x_e="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function vc(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=tqe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new to(r,n,o,a,i,l,t)})}function tqe(e){const t=iqe[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const iqe={u8:ht.UNSIGNED_BYTE,u16:ht.UNSIGNED_SHORT,u32:ht.UNSIGNED_INT,i8:ht.BYTE,i16:ht.SHORT,i32:ht.INT,f32:ht.FLOAT};class fY{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}fY.ElementCount=9;class mY{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}mY.ElementCount=16;class Yg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}Yg.ElementCount=1;class Zg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,pi(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Zg.ElementCount=2;class Qg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,te(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Qg.ElementCount=3;class Jg{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,Xi(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}Jg.ElementCount=4;class KM extends Yg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new KM(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}KM.ElementType="f32";class Dh extends Zg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Dh,t,i)}static fromTypedArray(t,i){return new Dh(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Dh.ElementType="f32";class ji extends Qg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(ji,t,i)}static fromTypedArray(t,i){return new ji(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ji.ElementType="f32";class In extends Jg{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(In,t,i)}static fromTypedArray(t,i){return new In(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}In.ElementType="f32";class lp extends fY{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(lp,t,i)}static fromTypedArray(t,i){return new lp(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}lp.ElementType="f32";class Pv extends fY{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Pv,t,i)}static fromTypedArray(t,i){return new Pv(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Pv.ElementType="f64";class S2 extends mY{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(S2,t,i)}static fromTypedArray(t,i){return new S2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}S2.ElementType="f32";class Iv extends mY{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Iv,t,i)}static fromTypedArray(t,i){return new Iv(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Iv.ElementType="f64";class E2 extends Yg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(E2,t,i)}static fromTypedArray(t,i){return new E2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}E2.ElementType="f64";class C2 extends Zg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(C2,t,i)}static fromTypedArray(t,i){return new C2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}C2.ElementType="f64";class _s extends Qg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(_s,t,i)}static fromTypedArray(t,i){return new _s(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}_s.ElementType="f64";class tw extends Jg{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(tw,t,i)}static fromTypedArray(t,i){return new tw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}tw.ElementType="f64";class kg extends Yg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(kg,t,i)}static fromTypedArray(t,i){return new kg(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}kg.ElementType="u8";class iw extends Zg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(iw,t,i)}static fromTypedArray(t,i){return new iw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}iw.ElementType="u8";class $v extends Qg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer($v,t,i)}static fromTypedArray(t,i){return new $v(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}$v.ElementType="u8";class xl extends Jg{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(xl,t,i)}static fromTypedArray(t,i){return new xl(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}xl.ElementType="u8";class rw extends Yg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(rw,t,i)}static fromTypedArray(t,i){return new rw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}rw.ElementType="u16";class A2 extends Zg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(A2,t,i)}static fromTypedArray(t,i){return new A2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}A2.ElementType="u16";class sw extends Qg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(sw,t,i)}static fromTypedArray(t,i){return new sw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}sw.ElementType="u16";class Dv extends Jg{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Dv,t,i)}static fromTypedArray(t,i){return new Dv(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Dv.ElementType="u16";class nw extends Yg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(nw,t,i)}static fromTypedArray(t,i){return new nw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}nw.ElementType="u32";class R2 extends Zg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(R2,t,i)}static fromTypedArray(t,i){return new R2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}R2.ElementType="u32";class FO extends Qg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(FO,t,i)}static fromTypedArray(t,i){return new FO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}FO.ElementType="u32";class UO extends Jg{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(UO,t,i)}static fromTypedArray(t,i){return new UO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}UO.ElementType="u32";class O2 extends Yg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(O2,t,i)}static fromTypedArray(t,i){return new O2(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}O2.ElementType="i8";class ow extends Zg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(ow,t,i)}static fromTypedArray(t,i){return new ow(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ow.ElementType="i8";class kO extends Qg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(kO,t,i)}static fromTypedArray(t,i){return new kO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}kO.ElementType="i8";class zO extends Jg{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(zO,t,i)}static fromTypedArray(t,i){return new zO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}zO.ElementType="i8";class BO extends Yg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(BO,t,i)}static fromTypedArray(t,i){return new BO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}BO.ElementType="i16";class aw extends Zg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(aw,t,i)}static fromTypedArray(t,i){return new aw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}aw.ElementType="i16";class VO extends Qg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(VO,t,i)}static fromTypedArray(t,i){return new VO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}VO.ElementType="i16";class GO extends Jg{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(GO,t,i)}static fromTypedArray(t,i){return new GO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}GO.ElementType="i16";class jO extends Yg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(jO,t,i)}static fromTypedArray(t,i){return new jO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}jO.ElementType="i32";class HO extends Zg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(HO,t,i)}static fromTypedArray(t,i){return new HO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}HO.ElementType="i32";class qO extends Qg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(qO,t,i)}static fromTypedArray(t,i){return new qO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}qO.ElementType="i32";class WO extends Jg{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(WO,t,i)}static fromTypedArray(t,i){return new WO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}WO.ElementType="i32";function T_e(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function rqe(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function sqe(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function nqe(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class oF{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new oF(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}}class gY{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,Dh,i),this}vec2f64(t,i){return this._appendField(t,C2,i),this}vec3f(t,i){return this._appendField(t,ji,i),this}vec3f64(t,i){return this._appendField(t,_s,i),this}vec4f(t,i){return this._appendField(t,In,i),this}vec4f64(t,i){return this._appendField(t,tw,i),this}mat3f(t,i){return this._appendField(t,lp,i),this}mat3f64(t,i){return this._appendField(t,Pv,i),this}mat4f(t,i){return this._appendField(t,S2,i),this}mat4f64(t,i){return this._appendField(t,Iv,i),this}vec4u8(t,i){return this._appendField(t,xl,i),this}f32(t,i){return this._appendField(t,KM,i),this}f64(t,i){return this._appendField(t,E2,i),this}u8(t,i){return this._appendField(t,kg,i),this}u16(t,i){return this._appendField(t,rw,i),this}i8(t,i){return this._appendField(t,O2,i),this}vec2i8(t,i){return this._appendField(t,ow,i),this}vec2i16(t,i){return this._appendField(t,aw,i),this}vec2u8(t,i){return this._appendField(t,iw,i),this}vec4u16(t,i){return this._appendField(t,Dv,i),this}u32(t,i){return this._appendField(t,nw,i),this}_appendField(t,i,r){const s=i.ElementCount*T_e(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new oF(this,t)}createView(t){return new oF(this,t)}clone(){const t=new gY;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function es(){return new gY}var nj;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(nj||(nj={}));const ia=Gt();class oqe{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function dt(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new oqe(t)}function Qw(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function Wie(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function GP(e,t,i,r,s,n=tt()){const o=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),a=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function Xie(e,t,i,r,s){s||(s=e),ia[0]=e[0],ia[1]=e[1],ia[2]=e[2],ia[3]=1,lu(ia,ia,t),s.length>2&&(s[2]=-ia[2]),lu(ia,ia,i),dt(ia[3]!==0),s[0]=ia[0]/ia[3],s[1]=ia[1]/ia[3],s[2]=ia[2]/ia[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function aqe(e,t){return Math.log(e)/Math.log(t)}function S_e(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function E_e(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function lqe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function cqe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function uqe(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function hqe(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}class U5{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this.center=M(),dt(t.length>=1),dt(r.length%this._numIndexPerPrimitive==0),dt(r.length>=t.length*this._numIndexPerPrimitive),dt(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*r[this._numIndexPerPrimitive*t[0]];f_.clear(),f_.push(l),this.bbMin=Ue(n[l],n[l+1],n[l+2]),this.bbMax=$s(this.bbMin);for(let h=0;h<a;++h){const p=this._numIndexPerPrimitive*t[h];for(let f=0;f<this._numIndexPerPrimitive;++f){l=o*r[p+f],f_.push(l);let m=n[l];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=n[l+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=n[l+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}}tn(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let h=0;h<f_.length;++h){l=f_.getItemAt(h);const p=n[l]-this.center[0],f=n[l+1]-this.center[1],m=n[l+2]-this.center[2],y=p*p+f*f+m*m;if(y<=c)continue;const v=Math.sqrt(y),w=.5*(v-this.radius);this.radius=this.radius+w,c=this.radius*this.radius;const b=w/v;this.center[0]+=p*b,this.center[1]+=f*b,this.center[2]+=m*b}f_.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(pn(this.bbMin,this.bbMax)>1){const t=tn(M(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],v=n[f+2];for(let w=1;w<this._numIndexPerPrimitive;++w){f=o*this.indices[p+w];const b=n[f],S=n[f+1],T=n[f+2];b<m&&(m=b),S<y&&(y=S),T<v&&(v=T)}m<t[0]&&(h|=1),y<t[1]&&(h|=2),v<t[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new U5(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){f_.prune()}}const f_=new Vt({deallocator:null});class e3{constructor(){this.id=hl()}unload(){}}var cp;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(cp||(cp={}));function Yie(e,t,i){const r=t[0]-e[0],s=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return .5*Math.abs(r*o-s*n)}function dqe(e,t,i){return pe(ez,t,e),pe(Zie,i,e),Oe(lt(ez,ez,Zie))/2}new Hg(Hf);new Hg(()=>({p0:null,p1:null,p2:null}));const ez=M(),Zie=M();let R0=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const C_e=new Uint16Array([0]),aF=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function M2(e){if(e===1)return C_e;if(e<aF.length)return new Uint16Array(aF.buffer,0,e);if(e>R0.length){const t=Math.max(2*R0.length,e);R0=new Uint32Array(t);for(let i=0;i<R0.length;i++)R0[i]=i}return new Uint32Array(R0.buffer,0,e)}function Ubt(e){if(e===1)return new Uint16Array(C_e);if(e<aF.length)return new Uint16Array(aF.slice(0,e));if(e>R0.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(R0.slice(0,e))}function A_e(e,t,i){if(!e)return!1;const{size:r,data:s}=e;te(i,0,0,0),te(nh,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*r,c=t[a+1]*r,h=t[a+2]*r;te(En,s[l+0],s[l+1],s[l+2]),te(sg,s[c+0],s[c+1],s[c+2]),te(jP,s[h+0],s[h+1],s[h+2]);const p=dqe(En,sg,jP);p?(de(En,En,sg),de(En,En,jP),oe(En,En,1/3*p),de(i,i,En),n+=p):(de(nh,nh,En),de(nh,nh,sg),de(nh,nh,jP),o+=3)}return(o!==0||n!==0)&&(n!==0?(oe(i,i,1/n),!0):o!==0&&(oe(i,nh,1/o),!0))}function R_e(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;te(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&oe(i,i,1/o),o>0}function yY(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;te(r,0,0,0),te(nh,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(t?t[p]:p)*s,y=(t?t[f]:f)*s;En[0]=n[m+0],En[1]=n[m+1],En[2]=n[m+2],sg[0]=n[y+0],sg[1]=n[y+1],sg[2]=n[y+2],oe(En,de(En,En,sg),.5);const v=lq(En,sg);v>0?(de(r,r,oe(En,En,v)),o+=v):(de(nh,nh,En),a++)}return o!==0?(oe(r,r,1/o),!0):a!==0&&(oe(r,nh,1/a),!0)}const En=M(),sg=M(),jP=M(),nh=M();class Mr extends e3{constructor(t,i=[],r=ml.Triangle,s=-1){super(),this._primitiveType=r,this.edgeIndicesLength=s,this.type=cp.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,F({},o));if(i==null||i.length===0){const n=pqe(this._vertexAttributes),o=M2(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const a of this._vertexAttributes.keys())this._indices.set(a,o)}else for(const[n,o]of i)o&&(this._indices.set(n,fqe(o)),n===R.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new Mr([],void 0,this._primitiveType,void 0),{_vertexAttributes:i,_indices:r}=t;return this._vertexAttributes.forEach((s,n)=>{i.set(n,s)}),this._indices.forEach((s,n)=>{r.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i.data=Array.from(i.data),i.exclusive=!0),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return A(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===ml.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(R.POSITION),r=this.vertexAttributes.get(R.POSITION);return A_e(r,i,t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(R.POSITION),r=this.vertexAttributes.get(R.POSITION);return R_e(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(R.POSITION);if(t.length===0)return null;const i=this.primitiveType===ml.Triangle?3:1;dt(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const r=M2(t.length/i),s=this.vertexAttributes.get(R.POSITION);return new U5(r,i,t,s)}}function pqe(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function fqe(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const Jw=nj;var tz,iz,rz,oj;(function(e){const i=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let c=0;c<6;c++)for(let h=0;h<6;h++)o[6*c+h]=c;const a=new Uint16Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const h=new Array(24);for(let p=0;p<8;p++)h[3*p]=i[p][0]*c[0],h[3*p+1]=i[p][1]*c[1],h[3*p+2]=i[p][2]*c[2];return new Mr([[R.POSITION,{size:3,data:h,exclusive:!0}],[R.NORMAL,{size:3,data:r}],[R.UV0,{size:2,data:s}]],[[R.POSITION,n],[R.NORMAL,o],[R.UV0,a]])}e.createGeometry=l})(tz||(tz={})),function(e){const i=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=i[c][0]*a[0],l[3*c+1]=i[c][1]*a[1],l[3*c+2]=i[c][2]*a[2];return new Mr([[R.POSITION,{size:3,data:l,exclusive:!0}],[R.NORMAL,{size:3,data:r}]],[[R.POSITION,s],[R.NORMAL,n]])}e.createGeometry=o}(iz||(iz={})),function(e){const r=Oi(-.5,0,-.5),s=Oi(.5,0,-.5),n=Oi(0,0,.5),o=Oi(0,0+.5,0),a=Si(),l=Si(),c=Si(),h=Si(),p=Si();pe(a,r,o),pe(l,r,s),lt(c,a,l),we(c,c),pe(a,s,o),pe(l,s,n),lt(h,a,l),we(h,h),pe(a,n,o),pe(l,n,r),lt(p,a,l),we(p,p);const f=[r,s,n,o],m=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function w(b){Array.isArray(b)||(b=[b,b,b]);const S=new Array(12);for(let T=0;T<4;T++)S[3*T]=f[T][0]*b[0],S[3*T+1]=f[T][1]*b[1],S[3*T+2]=f[T][2]*b[2];return new Mr([[R.POSITION,{size:3,data:S,exclusive:!0}],[R.NORMAL,{size:3,data:m}]],[[R.POSITION,new Uint16Array(y)],[R.NORMAL,new Uint16Array(v)]])}e.createGeometry=w}(rz||(rz={})),function(e){function t(T,E,C,O={uv:!0}){const I=-Math.PI,N=2*Math.PI,D=-Math.PI/2,z=Math.PI,B=Math.max(3,Math.floor(E)),k=Math.max(2,Math.floor(C)),Y=(B+1)*(k+1),Z=new Float32Array(3*Y),le=new Float32Array(3*Y),ne=new Float32Array(2*Y),$=[];let U=0;for(let K=0;K<=k;K++){const j=[],ee=K/k,ge=D+ee*z,Te=Math.cos(ge);for(let Fe=0;Fe<=B;Fe++){const _e=Fe/B,me=I+_e*N,Ce=Math.cos(me)*Te,Ne=Math.sin(ge),Mi=-Math.sin(me)*Te;Z[3*U]=Ce*T,Z[3*U+1]=Ne*T,Z[3*U+2]=Mi*T,le[3*U]=Ce,le[3*U+1]=Ne,le[3*U+2]=Mi,ne[2*U]=_e,ne[2*U+1]=ee,j.push(U),++U}$.push(j)}const V=new Uint32Array(2*B*(k-1)*3);U=0;for(let K=0;K<k;K++)for(let j=0;j<B;j++){const ee=$[K][j],ge=$[K][j+1],Te=$[K+1][j+1],Fe=$[K+1][j];K===0?(V[U++]=ee,V[U++]=Te,V[U++]=Fe):K===k-1?(V[U++]=ee,V[U++]=ge,V[U++]=Te):(V[U++]=ee,V[U++]=ge,V[U++]=Te,V[U++]=Te,V[U++]=Fe,V[U++]=ee)}const q=[[R.POSITION,V],[R.NORMAL,V]],W=[[R.POSITION,{size:3,data:Z,exclusive:!0}],[R.NORMAL,{size:3,data:le,exclusive:!0}]];return O.uv&&(W.push([R.UV0,{size:2,data:ne,exclusive:!0}]),q.push([R.UV0,V])),O.offset&&(q[0][0]=R.OFFSET,W[0][0]=R.OFFSET,q.push([R.POSITION,new Uint32Array(V.length)]),W.push([R.POSITION,{size:3,data:Float64Array.from(O.offset),exclusive:!0}])),new Mr(W,q)}function i(T,E,C){const O=T;let I,N;if(C)I=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],N=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const Z=O*(1+Math.sqrt(5))/2;I=[-O,Z,0,O,Z,0,-O,-Z,0,O,-Z,0,0,-O,Z,0,O,Z,0,-O,-Z,0,O,-Z,Z,0,-O,Z,0,O,-Z,0,-O,-Z,0,O],N=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let Z=0;Z<I.length;Z+=3)Jw.scale(I,Z,T/Jw.length(I,Z));let D={};function z(Z,le){Z>le&&([Z,le]=[le,Z]);const ne=Z.toString()+"."+le.toString();if(D[ne])return D[ne];let $=I.length;return I.length+=3,Jw.add(I,3*Z,I,3*le,I,$),Jw.scale(I,$,T/Jw.length(I,$)),$/=3,D[ne]=$,$}for(let Z=0;Z<E;Z++){const le=N.length,ne=new Uint32Array(4*le);for(let $=0;$<le;$+=3){const U=N[$],V=N[$+1],q=N[$+2],W=z(U,V),K=z(V,q),j=z(q,U),ee=4*$;ne[ee]=U,ne[ee+1]=W,ne[ee+2]=j,ne[ee+3]=V,ne[ee+4]=K,ne[ee+5]=W,ne[ee+6]=q,ne[ee+7]=j,ne[ee+8]=K,ne[ee+9]=W,ne[ee+10]=K,ne[ee+11]=j}N=ne,D={}}const B=new Float32Array(I);for(let Z=0;Z<B.length;Z+=3)Jw.normalize(B,Z);const k=[[R.POSITION,N],[R.NORMAL,N]],Y=[[R.POSITION,{size:3,data:new Float32Array(I),exclusive:!0}],[R.NORMAL,{size:3,data:B,exclusive:!0}]];return new Mr(Y,k)}function r(T,E,C,O,I,N,D){const z=E?[E[0],E[1],E[2]]:[0,0,0],B=T?[T[0],T[1],T[2]]:[0,0,1];N=N||[0,0];const k=C?[255*C[0],255*C[1],255*C[2],C.length>3?255*C[3]:255]:[255,255,255,255],Y=O!=null&&O.length===2?O:[1,1],Z=[[R.POSITION,{size:3,data:z,exclusive:!0}],[R.NORMAL,{size:3,data:B,exclusive:!0}],[R.UV0,{size:N.length,data:N}],[R.COLOR,{size:4,data:k,exclusive:!0}],[R.SIZE,{size:2,data:Y}]];if(I!=null){const le=new Float32Array([I[0],I[1],I[2],I[3]]);Z.push([R.AUXPOS1,{size:4,data:le}])}if(D!=null){const le=new Float32Array([D[0],D[1],D[2],D[3]]);Z.push([R.AUXPOS2,{size:4,data:le}])}return new Mr(Z,null,ml.Point)}function s(T,E,C,O,I,N,D,z){if(T!=null){const{data:B}=z.getMutableAttribute(R.NORMAL);B[0]=T[0],B[1]=T[1],B[2]=T[2]}if(E!=null){const{data:B}=z.getMutableAttribute(R.POSITION);B[0]=E[0],B[1]=E[1],B[2]=E[2]}if(C!=null){const{data:B}=z.getMutableAttribute(R.COLOR);B[0]=C[0],B[1]=C[1],B[2]=C[2],B[3]=C[3]}if(O!=null){const{data:B}=z.getMutableAttribute(R.SIZE);B[0]=O[0],B[1]=O[1]}if(I!=null){const{data:B}=z.getMutableAttribute(R.AUXPOS1);B[0]=I[0],B[1]=I[1],B[2]=I[2],B[3]=I[3]}if(N!=null){const{data:B}=z.getMutableAttribute(R.UV0);B[0]=N[0],B[1]=N[1]}if(D!=null){const{data:B}=z.getMutableAttribute(R.AUXPOS2);B[0]=D[0],B[1]=D[1],B[2]=D[2],B[3]=D[3]}}function n(T,E){const C=new Float32Array(3*T.length),O=new Float32Array(E?3*T.length:3),I=new Uint32Array(T.length),N=new Uint32Array(T.length);for(let k=0;k<T.length;k++)C[3*k]=T[k][0],C[3*k+1]=T[k][1],C[3*k+2]=T[k][2],E&&(O[3*k]=E[k][0],O[3*k+1]=E[k][1],O[3*k+2]=E[k][2]),I[k]=k,N[k]=0;E||(O[0]=0,O[1]=1,O[2]=0);const D=[0,0],z=[[R.POSITION,I],[R.NORMAL,E?I:N],[R.UV0,N]],B=[[R.POSITION,{size:3,data:C,exclusive:!0}],[R.NORMAL,{size:3,data:O,exclusive:!0}],[R.UV0,{size:2,data:D,exclusive:!0}]];return new Mr(B,z,ml.Point)}function o(){const T=[0,0,0,0,0,100,100,0,0],E=new Uint16Array([0,1,2]),C=[0,1,0],O=new Uint16Array([0,0,0]),I=[0,0],N=new Uint16Array([0,0,0]),D=[[R.POSITION,E],[R.NORMAL,O],[R.UV0,N]],z=[[R.POSITION,{size:3,data:T,exclusive:!0}],[R.NORMAL,{size:3,data:C,exclusive:!0}],[R.UV0,{size:2,data:I,exclusive:!0}]];return new Mr(z,D)}e.createBoxGeometry=tz.createGeometry,e.createDiamondGeometry=iz.createGeometry,e.createTetrahedronGeometry=rz.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=o;const a=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(T=a){const E=new Array(12);for(let k=0;k<4;k++)for(let Y=0;Y<3;Y++)E[3*k+Y]=T[k][Y];const C=new Uint32Array([0,1,2,2,3,0]),O=[0,0,1],I=new Uint32Array([0,0,0,0,0,0]),N=[0,0,1,0,1,1,0,1],D=[255,255,255,255],z=[[R.POSITION,C],[R.NORMAL,I],[R.UV0,C],[R.COLOR,I]],B=[[R.POSITION,{size:3,data:E,exclusive:!0}],[R.NORMAL,{size:3,data:O,exclusive:!0}],[R.UV0,{size:2,data:N,exclusive:!0}],[R.COLOR,{size:4,data:D,exclusive:!0}]];return new Mr(B,z)}function c(T,E,C,O,I=!0,N=!0){let D=0;const z=E,B=T;let k=Oi(0,D,0),Y=Oi(0,D+B,0),Z=Oi(0,-1,0),le=Oi(0,1,0);O&&(D=B,Y=Oi(0,0,0),k=Oi(0,D,0),Z=Oi(0,1,0),le=Oi(0,-1,0));const ne=[Y,k],$=[Z,le],U=C+2,V=Math.sqrt(B*B+z*z);if(O)for(let _e=C-1;_e>=0;_e--){const me=_e*(2*Math.PI/C),Ce=Oi(Math.cos(me)*z,D,Math.sin(me)*z);ne.push(Ce);const Ne=Oi(B*Math.cos(me)/V,-z/V,B*Math.sin(me)/V);$.push(Ne)}else for(let _e=0;_e<C;_e++){const me=_e*(2*Math.PI/C),Ce=Oi(Math.cos(me)*z,D,Math.sin(me)*z);ne.push(Ce);const Ne=Oi(B*Math.cos(me)/V,z/V,B*Math.sin(me)/V);$.push(Ne)}const q=new Uint32Array(2*(C+2)*3),W=new Uint32Array(2*(C+2)*3);let K=0,j=0;if(I){for(let _e=3;_e<ne.length;_e++)q[K++]=1,q[K++]=_e-1,q[K++]=_e,W[j++]=0,W[j++]=0,W[j++]=0;q[K++]=ne.length-1,q[K++]=2,q[K++]=1,W[j++]=0,W[j++]=0,W[j++]=0}if(N){for(let _e=3;_e<ne.length;_e++)q[K++]=_e,q[K++]=_e-1,q[K++]=0,W[j++]=_e,W[j++]=_e-1,W[j++]=1;q[K++]=0,q[K++]=2,q[K++]=ne.length-1,W[j++]=1,W[j++]=2,W[j++]=$.length-1}const ee=new Float32Array(3*U);for(let _e=0;_e<U;_e++)ee[3*_e]=ne[_e][0],ee[3*_e+1]=ne[_e][1],ee[3*_e+2]=ne[_e][2];const ge=new Float32Array(3*U);for(let _e=0;_e<U;_e++)ge[3*_e]=$[_e][0],ge[3*_e+1]=$[_e][1],ge[3*_e+2]=$[_e][2];const Te=[[R.POSITION,q],[R.NORMAL,W]],Fe=[[R.POSITION,{size:3,data:ee,exclusive:!0}],[R.NORMAL,{size:3,data:ge,exclusive:!0}]];return new Mr(Fe,Te)}function h(T,E,C,O,I,N){const D=O?rF(O):Oi(1,0,0),z=I?rF(I):Oi(0,0,0);N=N==null||N;const B=Si();we(B,D);const k=Si();oe(k,B,Math.abs(T));const Y=Si();oe(Y,k,-.5),de(Y,Y,z);const Z=Oi(0,1,0);Math.abs(1-xe(B,Z))<.2&&te(Z,0,0,1);const le=Si();lt(le,B,Z),we(le,le),lt(Z,le,B);const ne=2*C+(N?2:0),$=C+(N?2:0),U=new Float32Array(3*ne),V=new Float32Array(3*$),q=new Float32Array(2*ne),W=new Uint32Array(3*C*(N?4:2)),K=new Uint32Array(3*C*(N?4:2));N&&(U[3*(ne-2)+0]=Y[0],U[3*(ne-2)+1]=Y[1],U[3*(ne-2)+2]=Y[2],q[2*(ne-2)]=0,q[2*(ne-2)+1]=0,U[3*(ne-1)+0]=U[3*(ne-2)+0]+k[0],U[3*(ne-1)+1]=U[3*(ne-2)+1]+k[1],U[3*(ne-1)+2]=U[3*(ne-2)+2]+k[2],q[2*(ne-1)]=1,q[2*(ne-1)+1]=1,V[3*($-2)+0]=-B[0],V[3*($-2)+1]=-B[1],V[3*($-2)+2]=-B[2],V[3*($-1)+0]=B[0],V[3*($-1)+1]=B[1],V[3*($-1)+2]=B[2]);const j=(me,Ce,Ne)=>{W[me]=Ce,K[me]=Ne};let ee=0;const ge=Si(),Te=Si();for(let me=0;me<C;me++){const Ce=me*(2*Math.PI/C);oe(ge,Z,Math.sin(Ce)),oe(Te,le,Math.cos(Ce)),de(ge,ge,Te),V[3*me+0]=ge[0],V[3*me+1]=ge[1],V[3*me+2]=ge[2],oe(ge,ge,E),de(ge,ge,Y),U[3*me+0]=ge[0],U[3*me+1]=ge[1],U[3*me+2]=ge[2],q[2*me+0]=me/C,q[2*me+1]=0,U[3*(me+C)+0]=U[3*me+0]+k[0],U[3*(me+C)+1]=U[3*me+1]+k[1],U[3*(me+C)+2]=U[3*me+2]+k[2],q[2*(me+C)+0]=me/C,q[2*me+1]=1;const Ne=(me+1)%C;j(ee++,me,me),j(ee++,me+C,me),j(ee++,Ne,Ne),j(ee++,Ne,Ne),j(ee++,me+C,me),j(ee++,Ne+C,Ne)}if(N){for(let me=0;me<C;me++){const Ce=(me+1)%C;j(ee++,ne-2,$-2),j(ee++,me,$-2),j(ee++,Ce,$-2)}for(let me=0;me<C;me++){const Ce=(me+1)%C;j(ee++,me+C,$-1),j(ee++,ne-1,$-1),j(ee++,Ce+C,$-1)}}const Fe=[[R.POSITION,W],[R.NORMAL,K],[R.UV0,W]],_e=[[R.POSITION,{size:3,data:U,exclusive:!0}],[R.NORMAL,{size:3,data:V,exclusive:!0}],[R.UV0,{size:2,data:q,exclusive:!0}]];return new Mr(_e,Fe)}function p(T,E,C,O,I){C=C||10,O=O==null||O,dt(T.length>1);const N=[[0,0,0]],D=[],z=[];for(let B=0;B<C;B++){D.push([0,-B-1,-(B+1)%C-1]);const k=B/C*2*Math.PI;z.push([Math.cos(k)*E,Math.sin(k)*E])}return e.createPathExtrusionGeometry(z,T,N,D,O,I)}function f(T,E,C,O,I,N=Oi(0,0,0)){const D=T.length,z=new Float32Array(E.length*D*3+(6*C.length||0)),B=new Float32Array(E.length*D*3+(C?6:0)),k=(E.length-1)*D*6+3*O.length*2,Y=new Uint32Array(k),Z=new Uint32Array(k);let le=0,ne=0,$=0,U=0;const V=Si(),q=Si(),W=Si(),K=Si(),j=Si(),ee=Si(),ge=Si(),Te=M(),Fe=Si(),_e=Si(),me=Si(),Ce=Si(),Ne=Si(),Mi=_i();te(Fe,0,1,0),pe(q,E[1],E[0]),we(q,q),I?(de(Te,E[0],N),we(W,Te)):te(W,0,0,1),S(q,W,Fe,Fe,j,W,Qie),se(K,W),se(Ce,j);for(let rt=0;rt<C.length;rt++)oe(ee,j,C[rt][0]),oe(Te,W,C[rt][2]),de(ee,ee,Te),de(ee,ee,E[0]),z[le++]=ee[0],z[le++]=ee[1],z[le++]=ee[2];B[ne++]=-q[0],B[ne++]=-q[1],B[ne++]=-q[2];for(let rt=0;rt<O.length;rt++)Y[$++]=O[rt][0]>0?O[rt][0]:-O[rt][0]-1+C.length,Y[$++]=O[rt][1]>0?O[rt][1]:-O[rt][1]-1+C.length,Y[$++]=O[rt][2]>0?O[rt][2]:-O[rt][2]-1+C.length,Z[U++]=0,Z[U++]=0,Z[U++]=0;let Fi=C.length;const si=C.length-1;for(let rt=0;rt<E.length;rt++){let Er=!1;rt>0&&(se(V,q),rt<E.length-1?(pe(q,E[rt+1],E[rt]),we(q,q)):Er=!0,de(_e,V,q),we(_e,_e),de(me,E[rt-1],K),a2(E[rt],_e,Mi),Pw(Mi,wu(me,V),Te)?(pe(Te,Te,E[rt]),we(W,Te),lt(j,_e,W),we(j,j)):S(_e,K,Ce,Fe,j,W,Qie),se(K,W),se(Ce,j)),I&&(de(Te,E[rt],N),we(Ne,Te));for(let $n=0;$n<D;$n++)if(oe(ee,j,T[$n][0]),oe(Te,W,T[$n][1]),de(ee,ee,Te),we(ge,ee),B[ne++]=ge[0],B[ne++]=ge[1],B[ne++]=ge[2],de(ee,ee,E[rt]),z[le++]=ee[0],z[le++]=ee[1],z[le++]=ee[2],!Er){const Na=($n+1)%D;Y[$++]=Fi+$n,Y[$++]=Fi+D+$n,Y[$++]=Fi+Na,Y[$++]=Fi+Na,Y[$++]=Fi+D+$n,Y[$++]=Fi+D+Na;for(let ea=0;ea<6;ea++)Z[U++]=Y[$-6+ea]-si}Fi+=D}const Ui=E[E.length-1];for(let rt=0;rt<C.length;rt++)oe(ee,j,C[rt][0]),oe(Te,W,C[rt][1]),de(ee,ee,Te),de(ee,ee,Ui),z[le++]=ee[0],z[le++]=ee[1],z[le++]=ee[2];const li=ne/3;B[ne++]=q[0],B[ne++]=q[1],B[ne++]=q[2];const ki=Fi-D;for(let rt=0;rt<O.length;rt++)Y[$++]=O[rt][0]>=0?Fi+O[rt][0]:-O[rt][0]-1+ki,Y[$++]=O[rt][2]>=0?Fi+O[rt][2]:-O[rt][2]-1+ki,Y[$++]=O[rt][1]>=0?Fi+O[rt][1]:-O[rt][1]-1+ki,Z[U++]=li,Z[U++]=li,Z[U++]=li;const Ur=[[R.POSITION,Y],[R.NORMAL,Z]],ts=[[R.POSITION,{size:3,data:z,exclusive:!0}],[R.NORMAL,{size:3,data:B,exclusive:!0}]];return new Mr(ts,Ur)}function m(T,E,C){dt(T.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),dt(T[0].length===3,"createPolylineGeometry(): malformed vertex"),dt(E==null||E.length===T.length,"createPolylineGeometry: need same number of points and normals"),dt(E==null||E[0].length===3,"createPolylineGeometry(): malformed normal");const O=new Float64Array(3*T.length),I=new Uint32Array(2*(T.length-1));let N=0,D=0;for(let k=0;k<T.length;k++){for(let Y=0;Y<3;Y++)O[N++]=T[k][Y];k>0&&(I[D++]=k-1,I[D++]=k)}const z=[],B=[];if(z.push([R.POSITION,I]),B.push([R.POSITION,{size:3,data:O,exclusive:!0}]),E){const k=new Float32Array(3*E.length);let Y=0;for(let Z=0;Z<T.length;Z++)for(let le=0;le<3;le++)k[Y++]=E[Z][le];z.push([R.NORMAL,I]),B.push([R.NORMAL,{size:3,data:k,exclusive:!0}])}return C&&(B.push([R.COLOR,{size:4,data:C}]),z.push([R.COLOR,M2(C.length/4)])),new Mr(B,z,ml.Line)}function y(T,E,C,O,I=0){const N=new Array(18),D=[[-E,I,O/2],[C,I,O/2],[0,T+I,O/2],[-E,I,-O/2],[C,I,-O/2],[0,T+I,-O/2]],z=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let B=0;B<6;B++)N[3*B]=D[B][0],N[3*B+1]=D[B][1],N[3*B+2]=D[B][2];return new Mr([[R.POSITION,{size:3,data:N,exclusive:!0}]],[[R.POSITION,z]])}function v(T,E){const C=T.getMutableAttribute(R.POSITION).data;for(let O=0;O<C.length;O+=3){const I=C[O],N=C[O+1],D=C[O+2];te(Kw,I,N,D),ke(Kw,Kw,E),C[O]=Kw[0],C[O+1]=Kw[1],C[O+2]=Kw[2]}}function w(T,E=T){const C=T.vertexAttributes,O=C.get(R.POSITION).data,I=C.get(R.NORMAL).data;if(I){const N=E.getMutableAttribute(R.NORMAL).data;for(let D=0;D<I.length;D+=3){const z=I[D+1];N[D+1]=-I[D+2],N[D+2]=z}}if(O){const N=E.getMutableAttribute(R.POSITION).data;for(let D=0;D<O.length;D+=3){const z=O[D+1];N[D+1]=-O[D+2],N[D+2]=z}}return E}function b(T,E,C,O,I){return!(Math.abs(xe(E,T))>I)&&(lt(C,T,E),we(C,C),lt(O,C,T),we(O,O),!0)}function S(T,E,C,O,I,N,D){return b(T,E,I,N,D)||b(T,C,I,N,D)||b(T,O,I,N,D)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=h,e.createTubeGeometry=p,e.createPathExtrusionGeometry=f,e.createPolylineGeometry=m,e.createExtrudedTriangle=y,e.transformInPlace=v,e.cgToGIS=w,e.makeOrthoBasisDirUp=b,e.makeOrthoBasisDirUpFallback=S}(oj||(oj={}));const Qie=.99619469809,Kw=Si(),jl=oj,mqe=fe.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class gqe{constructor(){this.type="panoramic",this._techniqueConfig=new nF,this._passParameters=new pY,this._readyResolver=ip(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=Xe(this._passParameters.texture),this._vao=Xe(this._vao),this._readyController=Ah(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=Nf.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(T2,this._techniqueConfig);const i=t.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=xo(this._vao,"geometry"),ap(x_e,{signal:this._readyController.signal}).then(r=>{this._passParameters.texture=new st(i,{pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!0},r),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(r=>{jr(r)||mqe.error("Unable to initialize atmosphere: image request failed",r),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const i=t.rctx,r=i.bindTechnique(this._technique,this._passParameters,t.bindParameters);yqe(Jie,t.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",Jie),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Pt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=jl.createPolySphereGeometry(1,2,!1),r=i.indices.get(R.POSITION);for(let a=0;a<r.length;a+=3){const l=r[a];r[a]=r[a+2],r[a+2]=l}const s=i.vertexAttributes.get(R.POSITION).data,n=Kie.createBuffer(r.length),o=n.position;for(let a=0;a<r.length;++a){const l=3*r[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new Ns(t,Ni,{geometry:vc(Kie)},{geometry:ii.createVertex(t,bi.STATIC_DRAW,n.buffer)})}}function yqe(e,t){gs(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const Jie=Ae(),Kie=es().vec3f(R.POSITION);var Lv;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(Lv||(Lv={}));class aj extends Da{constructor(){super(...arguments),this.type=Lv.Rain}}u([G({count:Lv.COUNT})],aj.prototype,"type",void 0);function vqe(e){const t=new Hi;return t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new ul("cameraPosition")),t.vertex.uniforms.add(new ul("offset")),t.vertex.uniforms.add(new $i("width")),t.vertex.uniforms.add(new yr("proj",(i,r)=>r.camera.projectionMatrix)),t.vertex.uniforms.add(new Mv("view")),t.vertex.uniforms.add(new $i("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(x`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===Lv.Rain?x`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:x`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new $i("opacity")),t.fragment.uniforms.add(new ul("particleColor")),t.fragment.code.add(x`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===Lv.Rain?x`d = 0.35 * smoothstep(0.5, 0.0, d);`:x`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const _qe=Object.freeze(Object.defineProperty({__proto__:null,build:vqe},Symbol.toStringTag,{value:"Module"}));class bqe extends Us{constructor(){super(...arguments),this.time=0,this.radius=1}}class lg extends cr{initializeProgram(t){const i=lg.shader.get().build(this.configuration);return new er(t.rctx,i,lg.attributeLocation)}initializePipeline(){return Ut({blending:so(Re.ONE,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:hr.LEQUAL},colorWrite:Kt})}}lg.shader=new Ki(_qe,()=>import("./Precipitation.glsl.b98c4ba1.js")),lg.attributeLocation=new Map([[R.POSITION,0],[R.INSTANCEFEATUREATTRIBUTE,1]]);class O_e{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return _(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let S1=class extends Ee{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=M(),this._tile=M(),this._particleColor=Si(),this._particleColorAtNight=Si(),this._nightMultiplier=.7,this._cameraDirection=Si(),this._renderParameters=new bqe,this._animation=new O_e,this._updatingTracking=new _f,this._renderParameters.time=0,this._renderParameters.radius=wi(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=Yi(this._snowTechnique),this._rainTechnique=Yi(this._rainTechnique),this._vao=Xe(this._vao),this._instanceIdBuffer=Xe(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(A(this._rainTechnique)){const e=new aj;e.type=Lv.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(lg,e)}return this._rainTechnique}get snowTechnique(){if(A(this._snowTechnique)){const e=new aj;e.type=Lv.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(lg,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const r=i==="rainy",s=r?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),A(s)||A(this._vao)||A(this._instanceIdBuffer)||(_(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;const o=.35;t=t<.5?qt(0,o,2*t):qt(o,1,2*(t-.5));const a=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(r?this._rainSpeed:this._snowSpeed)*jH(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(a,i,e),n.bindVAO(this._vao);const l=lg.attributeLocation;a.assertCompatibleVertexAttributeLocations(this._vao),XX(n,l,this._instanceIdBuffer,ere,0),n.capabilities.instancing.drawArraysInstanced(Pt.TRIANGLES,0,3,this._numParticles*t),YX(n,l,this._instanceIdBuffer,ere)}_update(e,t,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",r.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,i.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?te(this._particleColor,.85,.85,.85):te(this._particleColor,1,1,1),oe(this._particleColorAtNight,this._particleColor,this._nightMultiplier),we(this._cameraDirection,s);const n=Math.max(0,xe(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));tn(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){A(this._vao)&&(this._vao=this._createVertexArrayObject(e)),A(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return ii.createVertex(e,bi.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Ns(e,lg.attributeLocation,{geometry:vc(wqe)},{geometry:ii.createVertex(e,bi.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],S1.prototype,"context",void 0),u([d({constructOnly:!0})],S1.prototype,"view",void 0),u([d({readOnly:!0})],S1.prototype,"updating",null),u([d()],S1.prototype,"_updatingTracking",void 0),S1=u([P("esri.views.3d.environment.Precipitation")],S1);const wqe=es().vec3f(R.POSITION),ere=vc(es().f32(R.INSTANCEFEATUREATTRIBUTE),1),xqe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",Tqe=fe.getLogger("esri.views.3d.environment.SimpleAtmosphere"),HP=128,tre=-K7,ire=0,sz=50,Sqe=()=>1-511/512,Eqe=vD([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class Cqe{constructor(t){this.view=t,this.type="simple",this._renderData={texV:tt(),silCircleCenter:M(),silCircleV1:M(),silCircleV2:M(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new pY,this._fadeVaoCount=0,this._readyResolver=ip(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=zf(t.spatialReference);const i=wi(t.spatialReference);this.planetRadius=i.radius,this.outerRimWidth=i.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+tre)/this.planetRadius,this.middleRimFactor=(this.planetRadius+ire)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=ire/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=Js(this._cameraChangeHandle),this._passParameters.texture=Xe(this._passParameters.texture),this._fadeVao=Xe(this._fadeVao),this._vao=Xe(this._vao),this._readyController=Ah(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const i=t.renderContext.rctx;this._cameraChangeHandle=ae(()=>{var n;return(n=this.view.state)==null?void 0:n.camera},()=>t.requestRender(),Ps),this._vao=this._createRibbon(i),this._vaoCount=xo(this._vao,"geometry"),this._fadeVao=La(i),this._fadeVaoCount=xo(this._fadeVao,"geometry");const r=this.isOnMars?xqe:x_e,s=this._readyController.signal;try{const n=await ap(r,{signal:s});hi(s),this._passParameters.texture=new st(i,{pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){jr(n)||Tqe.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(A(this._coneTechnique)){const t=new nF;t.geometry=Nf.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(T2,t)}return this._coneTechnique}get undergroundTechnique(){if(A(this._undergroundTechnique)){const t=new nF;t.geometry=Nf.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(T2,t)}return this._undergroundTechnique}render(t){const i=t.bindParameters.camera;this._update(i);const r=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const s=r.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);s.setUniformMatrix4fv("proj",i.projectionMatrix),s.setUniformMatrix4fv("view",i.viewMatrix),s.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),s.setUniform3fv("silCircleV1",this._renderData.silCircleV1),s.setUniform3fv("silCircleV2",this._renderData.silCircleV2),s.setUniform2fv("texV",this._renderData.texV),s.setUniform1f("altitudeFade",this._renderData.altitudeFade),s.setUniform1f("innerScale",this._renderData.innerScale),r.bindVAO(this._vao),r.drawArrays(Pt.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const s=r.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);s.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),s.setUniform3fv("cameraPosition",i.eye),r.bindVAO(this._fadeVao),r.drawArrays(Pt.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const i=M(),r=this.planetRadius,s=Oe(t.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=m}else this._renderData.undergroundFadeAlpha=0;const o=Math.max(sz,n),a=r+tre;this._renderData.innerScale=Aqe(r+o,r,a)-1,this._renderData.altitudeFade=Mve(n),oe(i,t.eye,(r+sz)/s),rre(i,t.center,t.up,r,this._renderData);const l=this._computeScreenRimWidth(t,i,t.up,this._renderData),c=Sqe(),h=Eqe(n);let p=this.texV0+c*this.texVScale,f=this.texV0+l*h*this.texVScale;if(n>sz){rre(t.eye,t.center,t.up,r,this._renderData);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),y=De((m-1.5)/(l-1.5),0,1);p=this.texV0+y*c*this.texVScale,f=this.texV0+qt(this.texV1,l*h,y)*this.texVScale}pi(this._renderData.texV,p,f)}_createRibbon(t){const i=new Float32Array(3+3*HP*3),r=new Uint32Array(3*HP*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<HP;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this.innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this.middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this.outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===HP-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=sre.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Ns(t,Ni,{geometry:vc(sre)},{geometry:ii.createVertex(t,bi.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return de(ZE,s.silCircleCenter,s.silCircleV2),oe(oz,ZE,this.outerRimFactor),G4(nz,i,ZE,r),Xie(ZE,nz,t.projectionMatrix,t.viewport),Xie(oz,nz,t.projectionMatrix,t.viewport),or(ZE,oz)/t.height}}function rre(e,t,i,r,s){const n=Oe(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.silCircleV1,c=s.silCircleV2;return oe(s.silCircleCenter,e,a/n),lt(l,e,t),Sa(l)<1&&lt(l,e,i),oe(l,l,o/Oe(l)),lt(c,l,e),oe(c,c,o/Oe(c)),o}const nz=Ae(),ZE=M(),oz=M();function Aqe(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const sre=es().vec3f(R.POSITION);function vY(e){const t=x`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=x`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function Rqe(){const e=new Hi;return e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.COLOR,"vec4"),e.attributes.add(R.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new yr("transform",(t,i)=>Oqe(t,i)),new ti("viewport",(t,i)=>i.camera.fullViewport),new We("pixelRatio",(t,i)=>i.camera.pixelRatio)]),e.include(vY),e.vertex.code.add(x`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(x`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function Oqe(e,t){return gs(dy,t.camera.projectionMatrix),dy[10]=24e-8-1,dy[11]=-1,dy[14]=(24e-8-2)*t.camera.near,Fr(dy,dy,t.camera.viewMatrix),Fr(dy,dy,e.modelMatrix)}const dy=Ae(),Mqe=Object.freeze(Object.defineProperty({__proto__:null,build:Rqe},Symbol.toStringTag,{value:"Module"}));class Pqe extends Us{constructor(){super(...arguments),this.modelMatrix=Ae()}}class k5 extends cr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=k5.shader.get().build();return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:hr.LEQUAL},colorWrite:Kt})}}k5.shader=new Ki(Mqe,()=>import("./Stars.glsl.17923586.js"));const Iqe=fe.getLogger("esri.views.3d.environment.Stars");let m0=class extends Ee{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new Pqe,this._updatingTracking=new _f}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return _(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Ah(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Yi(this._technique),this._vao=Xe(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),A(this._technique)||A(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Pt.POINTS,0,this._numPoints)}_ensureResources(e){if(_(this._technique)||A(ex))return;this._technique=new k5({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=ex.byteLength/nre;const t=new Float32Array(ex,0,2*this._numPoints),i=new Uint8Array(ex,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type==="sun"?this.view.environment.lighting.date:null,r=>this._update(r),Ft)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=gs(this._renderParameter.modelMatrix,Lqe);r2(r,r,-i*Math.PI),Fr(r,Dqe,r),r2(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=ore.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[l]),f=this._hexToRGB($qe[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new Ns(e,Ni,{geometry:vc(ore)},{geometry:ii.createVertex(e,bi.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(_(ex))return null;const e=MM(async t=>{const{data:i}=await UPe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),ex=i});return e.promise.catch(t=>{jr(t)||Iqe.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new H("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/nre;if(t%1!=0||t>5e4||t<5e3)throw new H("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],m0.prototype,"view",void 0),u([d({constructOnly:!0})],m0.prototype,"requestRender",void 0),u([d({readOnly:!0})],m0.prototype,"updating",null),u([d()],m0.prototype,"_loadDataTask",void 0),u([d()],m0.prototype,"_updatingTracking",void 0),m0=u([P("esri.views.3d.environment.Stars")],m0);const $qe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],Dqe=pW(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),Lqe=pW(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),nre=9,ore=es().vec3f(R.POSITION).vec4u8(R.COLOR).f32(R.SIZE);let ex=null;var Ge;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(Ge||(Ge={}));var VA;const Nqe=[Se.POSTPROCESSING_ENVIRONMENT_OPAQUE,Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let are,ha=VA=class extends Ee{constructor(e){super(e),this._handles=new Ht,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(Nqe,this)}destroy(){var e;this._pendingAtmosphere=at(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=at(this._handles),this._set("view",null)}get atmosphereType(){return _(this._pendingAtmosphere)?this._pendingAtmosphere.type:_(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!!((e=this.view.basemapTerrain)==null?void 0:e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!_(this._precipitation)&&this._precipitation.update(e)}get updating(){return _(this._pendingAtmosphere)||_(this._stars)&&this._stars.updating||_(this._clouds)&&this._clouds.running}get weatherVisible(){return Oe(this.view.state.camera.eye)-wi(this.view.spatialReference).radius<=lh}get _stars(){var r,s;const e=this.view,t=(s=(r=e.environment)==null?void 0:r.starsEnabled)!=null?s:!1,i=this._get("_stars");return!t||A(this._context)?(at(i),null):_(i)?i:new m0({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||A(this._context))return at(e),null;const t=this.view,i=this._context;return _(e)&&e.context===i?e:(at(e),new S1({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||A(this._context))return at(e),null;if(_(e))return e;const t=this.view,i=this._context;return at(e),new ua({context:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||A(this._context))return at(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=wi(this.view.spatialReference).radius;return _(e)&&e.viewingMode===t&&e.planetRadius===r?e:(at(e),new T1({rctx:i,viewingMode:t,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||A(this._context))return at(e),null;if(_(e))return e;const t=this.view,i=this._context;return at(e),new BA({context:i,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)==null?void 0:t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([_l(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),Ps),ae(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),Ps),ae(()=>this._stars,()=>this._setNeedsRender()),ae(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),Ft),ae(()=>this._precipitation,()=>this._setNeedsRender()),ae(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),Ft),ae(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},Ps)])}uninitializeRenderContext(){this._context=null,this._atmosphere=at(this._atmosphere),this._set("_stars",at(this._stars)),this._set("_precipitation",at(this._precipitation)),this._set("_clouds",at(this._clouds)),this._set("_cloudsComposition",at(this._cloudsComposition)),this._set("_fog",at(this._fog))}prepareRender(e){e.bindParameters.clouds.data=qje(this._clouds)?this._clouds:null}render(e){if(e.pass===Ge.MATERIAL)switch(e.bindParameters.slot){case Se.POSTPROCESSING_ENVIRONMENT_OPAQUE:_(this._stars)&&this._stars.render(e),_(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),_(this._cloudsComposition)&&_(e.bindParameters.clouds.data)&&(this.weatherVisible&&_(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,_(this.view.animation))));break;case Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(_(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),_(this._fog)){const i=t==="foggy"||t==="rainy"||t==="snowy";(i||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,i,t==="rainy")}if(_(this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return A(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){A(e)||A(this._clouds)||(this._clouds.applyPreset(m_e[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){_(this._context)&&this._context.requestRender()}_updateFog(e){if(!A(this._fog)&&!A(e))switch(e.type){case"foggy":this._fog.strength=qt(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=qt(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;_(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return _(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);_(this._context)&&i.initializeRenderContext(this._context),A(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{_(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return Nie;case"panoramic":return gqe;case"simple":return Cqe;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||t==null||Bf(this.view.spatialReference)?"none":i==="local"?"panoramic":t==="high"&&_(this._context)&&Nie.isSupported(this._context)&&iO(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=_(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{are=VA.prototype._getAtmosphereClass,VA.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{VA.prototype._getAtmosphereClass=are}}}};u([d({constructOnly:!0})],ha.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],ha.prototype,"updating",null),u([d({readOnly:!0})],ha.prototype,"weatherVisible",null),u([d()],ha.prototype,"_context",void 0),u([d()],ha.prototype,"_pendingAtmosphere",void 0),u([d({readOnly:!0})],ha.prototype,"_stars",null),u([d({readOnly:!0})],ha.prototype,"_precipitation",null),u([d({readOnly:!0})],ha.prototype,"_clouds",null),u([d({readOnly:!0})],ha.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],ha.prototype,"_fog",null),u([d({readOnly:!0})],ha.prototype,"weatherEnabled",null),u([d({readOnly:!0})],ha.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],ha.prototype,"_weatherUpdateParameters",null),ha=VA=u([P("esri.views.3d.environment.EnvironmentRenderer")],ha);function lre(e,t,i){return Fqe(e,t.longitude,t.latitude,i.longitude,i.latitude)}function Fqe(e,t,i,r,s){const n=$t(i),o=$t(s),a=n-o,l=$t(t)-$t(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*rp(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function Uqe(e,t,i){const r=t.spatialReference,s=wi(r),n=new nt(t.x,e.y,r),o=new nt(i.x,e.y,r),a=new nt(e.x,t.y,r),l=new nt(e.x,i.y,r);return{lon:lre(s.radius,n,o),lat:lre(s.radius,a,l)}}function kqe(e,t,i){const r=t/i,s=$t(e),n=Math.sin(r/2),o=Math.cos(s),a=2*rp(Math.sqrt(n*n/(o*o)));return hc(a)}function zqe(e,t){let i=e/15;return t||(i=Math.round(i)),i}function cre(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=zqe(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var ure,hre,dre,M_e={exports:{}};ure=M_e,hre=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f($){return $.valueOf()/l-.5+c}function m($){return new Date(($+.5-c)*l)}function y($){return f($)-h}var v=23.4397*a;function w($,U){return n(t($)*i(v)-r(U)*t(v),i($))}function b($,U){return s(t(U)*i(v)+i(U)*t(v)*t($))}function S($,U,V){return n(t($),i($)*t(U)-r(V)*i(U))}function T($,U,V){return s(t(U)*t(V)+i(U)*i(V)*i($))}function E($,U){return a*(280.16+360.9856235*$)-U}function C($){return a*(357.5291+.98560028*$)}function O($){return a*(1.9148*t($)+.02*t(2*$)+3e-4*t(3*$))}function I($,U){return $+U+102.9372*a+e}function N($,U){var V=C($),q=I(V,O(V));return U||(U={dec:0,ra:0}),U.dec=b(q,0),U.ra=w(q,0),U}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function($,U,V,q){var W=a*-V,K=a*U,j=y($),ee=N(j,p),ge=E(j,W)-ee.ra;return q||(q={azimuth:0,altitude:0}),q.azimuth=S(ge,K,ee.dec),q.altitude=T(ge,K,ee.dec),q}},z=[[-.83,"sunrise","sunset"]];D.addTime=function($,U,V){z.push([$,U,V])};var B=9e-4;function k($,U){return Math.round($-B-U/(2*e))}function Y($,U,V){return B+($+U)/(2*e)+V}function Z($,U,V){return h+$+.0053*t(U)-.0069*t(2*V)}function le($,U,V){return o((t($)-t(U)*t(V))/(i(U)*i(V)))}function ne($){var U=a*(134.963+13.064993*$),V=a*(93.272+13.22935*$),q=a*(218.316+13.176396*$)+6.289*a*t(U),W=5.128*a*t(V),K=385001-20905*i(U);return{ra:w(q,W),dec:b(q,W),dist:K}}return D.getTimes=function($,U,V){var q=a*-V,W=a*U,K=k(y($),q),j=Y(0,q,K),ee=C(j),ge=O(ee),Te=I(ee,ge),Fe=b(Te,0),_e=Z(j,ee,Te);function me(ki){return Z(Y(le(ki,W,Fe),q,K),ee,Te)}function Ce(ki){var Ur=(t(ki)-t(W)*t(Fe))/(i(W)*i(Fe));return Ur<-1?D.PolarException.MIDNIGHT_SUN:Ur>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var Ne,Mi,Fi,si,Ui,li={solarNoon:m(_e),nadir:m(_e-.5),polarException:D.PolarException.NORMAL};for(Ne=0,Mi=z.length;Ne<Mi;Ne+=1)Ui=_e-((si=me((Fi=z[Ne])[0]*a))-_e),li[Fi[1]]=m(Ui),li[Fi[2]]=m(si);return li.polarException=Ce(z[0][0]*a),li},D.getMoonPosition=function($,U,V){var q=a*-V,W=a*U,K=y($),j=ne(K),ee=E(K,q)-j.ra,ge=T(ee,W,j.dec);return ge+=.017*a/r(ge+10.26*a/(ge+5.1*a)),{azimuth:S(ee,W,j.dec),altitude:ge,distance:j.dist}},D.getMoonFraction=function($){var U=y($),V=N(U),q=ne(U),W=149598e3,K=o(t(V.dec)*t(q.dec)+i(V.dec)*i(q.dec)*i(V.ra-q.ra)),j=n(W*t(K),q.dist-W*i(K));return(1+i(j))/2},D},(dre=hre())!==void 0&&(ure.exports=dre);const lw=M_e.exports,of={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function Bqe(e,t,i,r,s,n,o){te(o.ambient.color,1,1,1),o.ambient.intensity=of.global.ambient,te(o.direct.color,1,1,1),o.direct.intensity=of.global.direct;const a=t[2],l=De((Math.abs(a)-of.local.altitude)/(of.global.altitude-of.local.altitude),0,1);let c;if(o.globalFactor=l,n==="sun"&&(c=lw.getTimes(e,t[1],t[0])),l<1){let h;if(n==="sun")h=Yqe(e,c,r);else{const p=I_e(r);h={direct:{intensity:of.local.directAtNoon*p.direct,color:Ue(1,1,1)},ambient:{intensity:of.local.ambientAtNoon*p.ambient,color:Ue(1,1,1)},timeOfDay:"early afternoon"}}tn(o.ambient.color,h.ambient.color,o.ambient.color,l),o.ambient.intensity=qt(h.ambient.intensity,o.ambient.intensity,l),tn(o.direct.color,h.direct.color,o.direct.color,l),o.direct.intensity=qt(h.direct.intensity,o.direct.intensity,l),o.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,o.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}o.noonFactor=n==="sun"?Xqe(e,c):1,n==="sun"?Gqe(e,t,i,o.direct.directionToLightSource):Vqe(s,i,o.direct.directionToLightSource)}function Vqe(e,t,i){t===Ve.Global?we(az,e.eye):te(az,0,0,1),oe(lz,e.viewForward,-1);const r=yD(lz,az),s=Math.max(r-2*cz,0),n=.85*s/(s+1),o=Math.max(cz,r-cz-n);_u(fre,-o,e.viewRight),ke(i,lz,fre),de(i,i,oe(Zqe,e.viewRight,Qqe)),we(i,i)}function Gqe(e,t,i,r){const s=Wqe,n=$f(qqe);if(i===Ve.Global)lw.getPosition(e,0,0,s),te(r,0,0,-1),i2(n,n,-s.azimuth),B4(n,n,-s.altitude),ke(r,r,n);else{const o=of.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=De(c,0,1),c<1?(lw.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),te(r,0,-1,0),r2(n,n,-s.azimuth),i2(n,n,-s.altitude),ke(r,r,n)}}function jqe(e,t){if(t===Ve.Global)return!0;const i=of.planarDirection;return Math.abs(e)<i.localAltitude}const Hqe=Ue(.5773502691896258,-.5773502691896258,.5773502691896258);class P_e{constructor(){this.ambient={color:Ue(1,1,1),intensity:.55},this.direct={color:Ue(1,1,1),intensity:.55,directionToLightSource:$s(Hqe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const qqe=Ae(),Wqe={azimuth:0,altitude:0};function Xqe(e,t){const i=e.valueOf();let r,s;t.polarException===lw.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===lw.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-De(Math.abs(i-n)/432e5,0,1)}function I_e(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function pre(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function Yqe(e,t,i){const r=e.valueOf();let s,n;t.polarException===lw.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===lw.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,v=n+p/2,w=of.local,b=[.01,w.ambientAtNight],S=[.8,.8,1],T=[.01,.01,.01],E=[w.directAtTwilight,w.ambientAtTwilight],C=[1,.6,.5],O=[.8,.8,1],I=[.9*w.directAtNoon,w.ambientAtNoon],N=[1,.98,.98],D=[.98,.98,1],z=[w.directAtNoon,w.ambientAtNoon],B=[1,1,1],k=[1,1,1],Y=I,Z=N,le=D,ne=E,$=C,U=O;let V,q,W=[0,0],K=[0,0,0],j=[0,0,0];r<f||r>v?(W=b,K=T,j=S,q="night"):r<m?(V=m-f,W=lo(r-f,V,b,E),K=lo(r-f,V,T,C),j=lo(r-f,V,S,O),q="sun rising"):r<c?(V=c-m,W=lo(r-m,V,E,I),K=lo(r-m,V,C,N),j=lo(r-m,V,O,D),q="early morning"):r<a?(V=a-c,W=lo(r-c,V,I,z),K=lo(r-c,V,N,B),j=lo(r-c,V,D,k),q="late morning"):r<h?(V=h-a,W=lo(r-a,V,z,Y),K=lo(r-a,V,B,Z),j=lo(r-a,V,k,le),q="early afternoon"):r<y?(V=y-h,W=lo(r-h,V,Y,ne),K=lo(r-h,V,Z,$),j=lo(r-h,V,le,U),q="late afternoon"):r<v&&(V=v-y,W=lo(r-y,V,ne,b),K=lo(r-y,V,$,T),j=lo(r-y,V,U,S),q="sun setting");let ee=0;switch(i){case"rainy":case"foggy":ee=.9;case"snowy":ee=.5}ee>0&&(K=pre(K,ee),j=pre(j,ee));const ge=Ue(K[0],K[1],K[2]),Te=Ue(j[0],j[1],j[2]),Fe=I_e(i);return{direct:{intensity:W[0]*Fe.direct,color:ge},ambient:{intensity:W[1]*Fe.ambient,color:Te},timeOfDay:q}}function lo(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const fre=Ae(),az=M(),lz=M(),Zqe=M(),cz=.25,Qqe=.2;let yd=class extends Kr.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ht,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new ij,this._ambientLight=new dY,this._moonLight=new v_e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)==null?void 0:e.updating))}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(t=this._view)==null?void 0:t.state)==null?void 0:i.viewingMode)===Ve.Global&&iO(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new ha({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([ae(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Vi),ae(()=>e.environment.lighting.type==="sun"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Vi),ae(()=>e.stationary,()=>this._interactingStationaryHandler()),ae(()=>e.environment.lighting.directShadowsEnabled,t,Vi),ae(()=>e.environment.lighting.ambientOcclusionEnabled,t,Vi),ae(()=>e.environment.lighting.waterReflectionEnabled,t,Vi),ae(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,Vi),ae(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Vi),ae(()=>e.environment.weather.type,r,Vi),ae(()=>this.weatherEnabled,r,Vi),ae(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Ps),ae(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Ps),ae(()=>e.state.camera,i,Ps),ae(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=at(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type==="sun"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!Hb(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),_(this._referencePosWGS84Comparable)){const r=cre(this._referencePosWGS84Comparable,mre);_(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=iO(this._view.spatialReference);if(i&&!Hb(this._view.spatialReference))return!1;const r=e.position;return A(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=M()),i?HIe(r,this._referencePosWGS84Comparable):te(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||(t.environment.lighting.type==="sun"?t.environment.lighting.date:null),r=this._referencePosWGS84Comparable,s=_(r)?Jqe:Kqe;if(_(r)){const h=this.weatherVisible?t.environment.weather.type:"disabled";Bqe(i,r,t.state.viewingMode,h,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;oe(n.intensity,o.color,o.intensity*Math.PI),se(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;oe(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;tn(l.intensity,tWe,iWe,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));oe(l.intensity,l.intensity,c),se(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||A(e))return!1;const i=eWe;i.setTime((t||this._view.environment.lighting.date).getTime());const r=cre(e,mre);if(A(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=Kc(this._referencePosWGS84Comparable,!0,s=>jqe(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof Tve?{type:"color",color:fW(qe.toUnitRGBA(i.color))}:{type:"color",color:gi(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=kS(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=kS(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],yd.prototype,"updating",null),u([d()],yd.prototype,"disableQueries",void 0),u([d()],yd.prototype,"_disableWeather",void 0),u([d()],yd.prototype,"weatherEnabled",null),u([d()],yd.prototype,"weatherVisible",null),u([d()],yd.prototype,"referencePositionWGS84Comparable",null),u([d()],yd.prototype,"_renderer",void 0),u([d()],yd.prototype,"_referencePosWGS84Comparable",void 0),yd=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],yd);const Jqe=new P_e,Kqe=new P_e,eWe=new Date,mre={hours:0,minutes:0,seconds:0},tWe=Ue(.22,.22,.33),iWe=Ue(.22,.22,.22);function XO(e,t){return(e&t)!=0}function lF(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var kt,mr,On;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(kt||(kt={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(mr||(mr={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(On||(On={}));const Nv={selection:mr.NONE,interactionType:kt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:On.TUMBLE};function $_e(e,t,i,r){return t=t||e.viewForward,se(r,t),oe(r,r,Math.sign(xe(t,i))),r}function rWe(e,t,i,r){return lWe(e,t,i,oWe(r,t,i,!0))}function sWe(e,t,i,r){const s=xe(i,pe(e,r,t));return de(e,t,oe(e,i,s))}const nWe={dir:M(),len:0,clip:tt()};function oWe(e,t,i,r){const s=nWe;return e?(i&&r&&(s.len=or(t,i)),se(s.dir,e)):r?(s.len=or(t,i),pe(s.dir,i,t),oe(s.dir,s.dir,1/s.len)):(pe(s.dir,i,t),we(s.dir,s.dir)),s}function aWe(e,t,i){const r=xe(e,i.dir),s=-sr(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function lWe(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!aWe(e[s],t,r))return!1;return!0}function cWe(e,t,i=Nv){const r=_Y(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=$_e(t,i.interactionDirection,dWe(e,t,Math.sign(r),gWe),mWe),a=se(yWe,t.viewForward),l=s.intersectInfiniteManifold(wu(t.eye,o),n,uz);return t.eye=_(l)?l:s.setAltitude(uz,n,t.eye),t.center=sWe(uz,t.eye,a,t.center),!0}function _Y(e,t,i=Nv){if(!uWe(e,i))return 0;const r=pWe(e.state.constraints.altitude,fWe);hWe(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=De(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function uWe(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==kt.TUMBLE||!XO(t.selection,mr.TILT))}function hWe(e,t,i){const r=t.interactionType;if(r===kt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===kt.TUMBLE||r===kt.ZOOM,c=_Y(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,lF(c,h,l,a,.05*h,i)}function dWe(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),oe(r,r,i),r}function pWe(e,t){return t.min=e.min,t.max=e.max,t}const fWe={min:0,max:0},mWe=M(),gWe=M(),yWe=M(),uz=M();function bY(e,t,i=Nv){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;qP.min=0,qP.max=r,_We(e,i,qP);const s=wY(e,t),n=qP.max-s;return n>=-1e-6?0:n}function vWe(e,t,i=Nv){const r=bY(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=wY(e,t)+r,o=se(wWe,t.eye),a=$_e(t,i.interactionDirection,bWe(e,t,SWe),TWe);if(!Yv(mfe(s.renderLocation,n),wu(t.eye,a),WP))return!1;t.eye=WP;const l=pe(xWe,t.eye,o);t.center=de(WP,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,WP);return _(h)&&(t.center=h),!0}function _We(e,t,i){const r=t.interactionType;if(r===kt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===kt.ZOOM||r===kt.PAN,c=bY(e,o),h=c===0?0:wY(e,o);i.min=s,i.max=n,lF(c,h,l,a,.05*h,i)}function wY(e,t){const i=e.pointsOfInterest.surfaceOrigin;return or(t.eye,i.renderLocation)}function bWe(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return Vg(i,t.eye,r.renderLocation)}const qP={min:0,max:0},wWe=M(),xWe=M(),TWe=M(),SWe=M(),WP=M();var Dr,io;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(Dr||(Dr={}));class EWe{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=io.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(io||(io={}));function Zf(e){return _(e)&&_(e.dist)}function gre(e){return(t,i,r)=>(tn(yre,t,i,r),!TW(e,yre))}function z5(e){return Zf(e)&&e.intersector===Dr.OBJECT&&!!e.target}function B5(e){return Zf(e)&&e.intersector===Dr.HUD&&!!e.target&&_(e.target.center)}const yre=M();class CWe{constructor(){this._transform=Ae(),this._transformInverse=new XP({value:this._transform},us,Ae),this._transformInverseTranspose=new XP(this._transformInverse,bl,Ae),this._transformTranspose=new XP({value:this._transform},bl,Ae),this._transformInverseRotation=new XP({value:this._transform},a_e,Sr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){gs(this._transform,t)}multiplyTransform(t){Fr(this._transform,this._transform,t)}set(t){gs(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class XP{constructor(t,i,r){this.original=t,this.update=i,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class AWe{constructor(t=0){this.offset=t,this.tmpVertex=M()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)py[n]=t[0+n]+this.localOrigin[n],YP[n]=t[3+n]+this.localOrigin[n],tx[n]=py[n];const i=this.applyToVertex(py[0],py[1],py[2]);for(let n=0;n<3;++n)t[n]=i[n],t[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)tx[o]=(n&1<<o)==0?py[o]:YP[o];r(tx)}let s=0;for(let n=0;n<3;++n)py[n]*YP[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?tx[o]=0:tx[o]=(n&1<<o)!=0?py[o]:YP[o];r(tx)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const py=M(),YP=M(),tx=M();class RWe{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=M(),this._mbs=mn(),this._obb={center:M(),halfSize:Si(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=i<0?this._totalOffset:0,t[1]-=r<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(i),Math.abs(n)),m=Math.max(Math.abs(r),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),v=Math.sqrt(f*f+m*m+y*y),w=this._totalOffset/v,b=this._totalOffset/p;return t[0]+=i*(i>0?w:b),t[1]+=r*(r>0?w:b),t[2]+=s*(s>0?w:b),t[3]+=n*(n<0?w:b),t[4]+=o*(o<0?w:b),t[5]+=a*(a<0?w:b),t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this._totalOffset/i;return this._mbs[0]=t[0]+t[0]*r,this._mbs[1]=t[1]+t[1]*r,this._mbs[2]=t[2]+t[2]*r,this._mbs[3]=t[3]+t[3]*this._totalOffset/i,this._mbs}applyToObb(t){const i=t.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,uu(this._obb.halfSize,t.halfSize,t.quaternion),de(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,pe(this._obb.halfSize,this._obb.halfSize,t.center),Ug(wre,t.quaternion),uu(this._obb.halfSize,this._obb.halfSize,wre),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class OWe{constructor(t=0){this.offset=t,this.sphere=mn(),this.tmpVertex=M()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],o=s[1]*t+s[5]*i+s[9]*r+s[13],a=s[2]*t+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const vre=new OWe;function lj(e){return _(e)?(vre.offset=e,vre):null}const _re=new RWe;function MWe(e){return _(e)?(_re.offset=e,_re):null}const bre=new AWe;function PWe(e){return _(e)?(bre.offset=e,bre):null}const Nd="terrain",wre=qg();function cj(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function IWe(e,t){const i=e.length;for(let r=0;r<i;++r)ZT[0]=e[r],t[r]=ZT[0];return t}function $We(e,t){const i=e.length;for(let r=0;r<i;++r)ZT[0]=e[r],ZT[1]=e[r]-ZT[0],t[r]=ZT[1];return t}const ZT=new Float32Array(2);function uj(e,t){return A(e)&&(e=[]),e.push(t),e}function hj(e,t){if(A(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function t3(e){return!!_(e)&&!e.visible}function DWe(e,t,i){const r=e.origin.vec3;S_e(hz,-r[0],-r[1],-r[2]),_(e.transformation)?Fr(t,hz,e.transformation):gs(t,hz),i&&(us(i,t),bl(i,i))}function LWe(e,t,i,r,s){ZP[0]=e.get(t,0),ZP[1]=e.get(t,1),ZP[2]=e.get(t,2),cj(ZP,m_,3),i.set(s,0,m_[0]),r.set(s,0,m_[1]),i.set(s,1,m_[2]),r.set(s,1,m_[3]),i.set(s,2,m_[4]),r.set(s,2,m_[5])}const ZP=new Float64Array(3),m_=new Float32Array(6),hz=Ae(),P2=1e-5;class NWe{constructor(t){this.options=new EWe,this._results=new FWe,this.transform=new CWe,this.tolerance=P2,this.verticalOffset=null,this._ray=Qn(),this._rayEnd=M(),this._rayBeginTransformed=M(),this._rayEndTransformed=M(),this.viewingMode=t==null?Ve.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(_$e(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&CN(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ve.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,de(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r==null?P2:r;const o=lj(this.verticalOffset);if(_(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();_(c)?(_(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const i=t.geometryRecords;if(!i)return;const r=t.transformation,s=lj(this.verticalOffset);for(const n of i){const{geometry:o,material:a,instanceParameters:l}=n;if(t3(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(r,n.getShaderTransformation()),ke(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ke(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;_(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,f,m,y,v,w)=>{if(p>=0){if(_(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const b=y?this._results.hud:this._results,S=y?T=>{const E={object:t,geometryId:c,triangleNr:m,center:_(w)?[w[0],w[1],w[2]]:null};T.set(Dr.HUD,E,p,f,en,v)}:T=>T.set(Dr.OBJECT,{object:t,geometryId:c,triangleNr:m},p,f,h,v);if((b.min.drapedLayerOrder==null||v>=b.min.drapedLayerOrder)&&(b.min.dist==null||p<b.min.dist)&&S(b.min),this.options.store!==io.MIN&&(b.max.drapedLayerOrder==null||v<b.max.drapedLayerOrder)&&(b.max.dist==null||p>b.max.dist)&&S(b.max),this.options.store===io.ALL)if(y){const T=new dj(this._ray);S(T),this._results.hud.all.push(T)}else{const T=new xS(this._ray);S(T),this._results.all.push(T)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((i,r)=>i.dist!==r.dist?vt(i.dist,0)-vt(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?vt(i.drapedLayerOrder,Number.MAX_VALUE)-vt(r.drapedLayerOrder,Number.MAX_VALUE):vt(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-vt(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function Lh(e){return new NWe(e)}class FWe{constructor(){this.min=new xS(Qn()),this.max=new xS(Qn()),this.hud={min:new dj(Qn()),max:new dj(Qn()),all:new Array},this.ground=new xS(Qn()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class xS{constructor(t){this.intersector=Dr.OBJECT,this.normal=M(),this.transformation=Ae(),this._ray=Qn(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return _(this.dist)?(oe(QP,this.ray.direction,this.dist),Oe(QP)):null}getIntersectionPoint(t){return!!Zf(this)&&(oe(QP,this.ray.direction,this.dist),de(t,this.ray.origin,QP),!0)}getTransformedNormal(t){return se(QE,this.normal),QE[3]=0,lu(QE,QE,this.transformation),se(t,QE),we(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Dr.OBJECT,CN(t,this._ray)}set(t,i,r,s,n,o,a){this.intersector=t,this.dist=r,se(this.normal,vt(s,Xue)),gs(this.transformation,vt(n,en)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){CN(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,se(this.normal,t.normal),gs(this.transformation,t.transformation)}}class dj extends xS{constructor(){super(...arguments),this.intersector=Dr.HUD}}function xY(e){return new xS(e)}const QP=M(),QE=Gt();function D_e(e,t,i,r){return _(e.renderCoordsHelper.fromRenderCoords(t.eye,cF,r))&&yhe(i,cF)}function V5(e,t){return e.elevationProvider?vt(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function Fw(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),UWe(e,s.ray,fy)||se(fy,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(pn(s.eye,fy)<o){const a=n.collision.enabled;se(g_,s.viewForward),oe(g_,g_,o),a?s.eye=pe(cF,fy,g_):de(fy,s.eye,g_);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(pe(g_,fy,s.eye),s.eye=l.setAltitude(cF,h,s.eye),de(fy,s.eye,g_))}return s.center=fy,s}function xre(e,t,i){if(!e.state.isGlobal)return!1;const r=V5(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,zWe),o=n*n;return pn(t,i)>o}function UWe(e,t,i){let r=Tre[e.viewingMode];r||(r=Lh(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Tre[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||xre(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||xre(e,t.origin,i))||!!s&&kWe(t,i,wi(e.spatialReference).radius)}function kWe(e,t,i){const r=xe(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return oe(t,e.direction,s/Oe(e.direction)),de(t,t,e.origin),!0}const Tre={},cF=M(),fy=M(),g_=M(),zWe={near:0,far:0};function yE(e,t,i=Sh.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=V5(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Oe(t.eye);if(pe(JP,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(BWe,o,t.eye),i===Sh.EYE_AND_CENTER)t.center=de(JP,t.eye,JP);else if(i===Sh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=oe(JP,t.center,l)}return!0}var Sh;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Sh||(Sh={}));const JP=M(),BWe=M();function Fv(e,t,i){e.worldUpAtPosition(t,Sre),pe(dz,i,t);const r=Oe(dz);return r===0?0:rn(xe(dz,Sre)/r)}const Sre=M(),dz=M();function L_e(e,t,i=Nv,r=!0){JE.eyeCenterDistance=0,JE.requiresTwoSteps=!1;const s=TY(e,t,i,void 0,JE);if(s===0)return!1;switch(_u(KP,-s,t.viewRight),i.tiltMode){case On.LOOK_AROUND:ke(my,t.viewForward,KP),oe(my,my,JE.eyeCenterDistance),t.center=de(N0,t.eye,my);break;case On.TUMBLE:pe(my,t.center,t.eye),ke(my,my,KP),t.eye=pe(N0,t.center,my);break;default:i.tiltMode}return t.up=ke(N0,t.up,KP),!JE.requiresTwoSteps||!r||L_e(e,t,i,!1)}function TY(e,t,i=Nv,r=Nv,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,QWe);return ZWe(e,i,o),r.interactionType===kt.TUMBLE&&XO(r.selection,mr.ALTITUDE)&&N_e(e,r.interactionStartCamera,o),i.tiltMode===On.LOOK_AROUND||r.tiltMode===On.LOOK_AROUND?GWe(e,t,o,s):VWe(e,t,o)}function VWe(e,t,i){const r=Fv(e.renderCoordsHelper,t.center,t.eye),s=r-De(r,i.min,i.max);return YO(s)?s:0}function GWe(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return HWe(e,t,i,r);case"local":return jWe(e,t,i,r);default:return void(e.viewingMode,void 0)}}function jWe(e,t,i,r){const s=Fv(e.renderCoordsHelper,t.center,t.eye),n=De(s,i.min,i.max),o=s-n;if(!YO(o))return 0;if(r){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function HWe(e,t,i,r){const s=qWe(e,t,JWe),n=De(s.tiltAtCenter,i.min,i.max);if(!YO(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=WWe(s),a=XWe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=YWe(s,o)),r&&(r.eyeCenterDistance=pj(s,o)),a}function qWe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+wi(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,N0);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,_(n)?(i.eyeCenterDistance=or(t.eye,n),i.tiltAtCenter=Fv(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=Fv(e.renderCoordsHelper,t.center,t.eye):(sE(W4(X4,s),t.ray,N0),i.eyeCenterDistance=or(t.eye,N0),i.tiltAtCenter=rn(-xe(t.viewForward,we(N0,N0)))),i.radius=s,i.eyeRadius=Oe(t.eye),i.constraints=e.state.constraints,i}function YO(e){return Math.abs(e)>1e-9}function WWe(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=pj(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&YO(n-s);){const l=(s+n)/2,c=pj(e,l);YO(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function pj(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-De(t,0,Math.PI),r=rp(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function XWe(e,t){const i=rp(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=rp(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function YWe(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function ZWe(e,t,i){if(t.interactionType===kt.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:o}=i,a=TY(e,r,Nv,t),l=a===0?0:Fv(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===kt.TUMBLE?(XO(t.selection,mr.ALTITUDE)&&N_e(e,r,i),lF(a,l,!0,s,Ere,i)):lF(a,l,!1,s,Ere,i)}function N_e(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=Sa(t.center),n=Math.sqrt(s),o=t.distance,a=wi(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-rn(p),i.max)),i.max=Math.min(i.max,Math.PI-rn(h))}const my=M(),KP=Ae(),N0=M(),Ere=$t(5),QWe={min:0,max:0},JWe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},JE={eyeCenterDistance:0,requiresTwoSteps:!1};function KWe(e){return e}const G5=e=>e*e,SY=e=>1-G5(1-e),eXe=e=>e<.5?G5(2*e)/2:(SY(2*(e-.5))+1)/2,EY=e=>e*e*e,F_e=e=>1-EY(1-e),U_e=e=>e<.5?EY(2*e)/2:(F_e(2*(e-.5))+1)/2,CY=e=>e*e*e*e,k_e=e=>1-CY(1-e),tXe=e=>e<.5?CY(2*e)/2:(k_e(2*(e-.5))+1)/2,AY=e=>e*e*e*e*e,z_e=e=>1-AY(1-e),iXe=e=>e<.5?AY(2*e)/2:(z_e(2*(e-.5))+1)/2,RY=e=>1-Math.cos(e*Math.PI/2),B_e=e=>1-RY(1-e),rXe=e=>e<.5?RY(2*e)/2:(B_e(2*(e-.5))+1)/2,OY=e=>2**(10*(e-1)),i3=e=>1-OY(1-e),sXe=e=>e<.5?OY(2*e)/2:(i3(2*(e-.5))+1)/2,MY=e=>-(Math.sqrt(1-e*e)-1),V_e=e=>1-MY(1-e),nXe=e=>e<.5?MY(2*e)/2:(V_e(2*(e-.5))+1)/2;function kh(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function zh(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const oXe=zh(kh(1),1),aXe=zh(kh(1),0),G_e=zh(kh(1),.5),lXe=zh(kh(2),1),cXe=zh(kh(2),0),uXe=zh(kh(2),.5),hXe=zh(kh(3),1),dXe=zh(kh(3),0),pXe=zh(kh(3),.5),fXe=zh(kh(4),1),mXe=zh(kh(4),0),gXe=zh(kh(4),.5),yXe={linear:KWe,"in-quad":G5,"out-quad":SY,"in-out-quad":eXe,"in-coast-quad":oXe,"out-coast-quad":aXe,"in-out-coast-quad":G_e,"in-cubic":EY,"out-cubic":F_e,"in-out-cubic":U_e,"in-coast-cubic":lXe,"out-coast-cubic":cXe,"in-out-coast-cubic":uXe,"in-quart":CY,"out-quart":k_e,"in-out-quart":tXe,"in-coast-quart":hXe,"out-coast-quart":dXe,"in-out-coast-quart":pXe,"in-quint":AY,"out-quint":z_e,"in-out-quint":iXe,"in-coast-quint":fXe,"out-coast-quint":mXe,"in-out-coast-quint":gXe,"in-sine":RY,"out-sine":B_e,"in-out-sine":rXe,"in-expo":OY,"out-expo":i3,"in-out-expo":sXe,"in-circ":MY,"out-circ":V_e,"in-out-circ":nXe};function ls(e,t,i=wXe,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let a=0;a<xXe;a++){let l=0;for(const c of bXe)if(XO(i.selection,c.type)){const h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=XO(i.selection,mr.COLLISION),o=vXe(i.interactionType,e);return n&&yE(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function vXe(e,t){switch(e){case kt.PAN:return Sh.EYE_AND_CENTER;case kt.ASCEND:return t.state.isGlobal?Sh.EYE_AND_CENTER_SCALE:Sh.EYE_AND_CENTER;default:return Sh.EYE}}function Id(e,t){const i=typeof e=="number"?e:GX(e,t),r=Math.min(1,i/150);return U_e(r)}function _Xe(e,t,i){return TY(e,t,i)*t.distance}const bXe=[{type:mr.TILT,error:_Xe,apply:L_e},{type:mr.ALTITUDE,error:_Y,apply:cWe},{type:mr.DISTANCE,error:bY,apply:vWe}],wXe={selection:mr.ALL,interactionType:kt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:On.TUMBLE},xXe=5,wc=M(),El=M(),gy=M(),$o=M(),y_=M(),TXe=M(),xc={upward:Ue(0,0,1),forward:Ue(0,1,0),sideway:Ue(1,0,0)},Cre=Sr();class Are{constructor(t=Ve.Global){this.viewingMode=t,this.center=M(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=$s(xc.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ve.Global){const n=(Oe(this.center)+Oe(t.center))/2;i.pan=yD(this.center,t.center)*n}else i.pan=or(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===Ve.Global?F$e(t.center,i.center,r.pan,this.center):tn(this.center,t.center,i.center,r.pan),this.distance=qt(t.distance,i.distance,r.zoom),this.pitch=qt(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=qt(s,n,r.rotate)}copyFrom(t){se(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,se(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,Cre);se(this.center,t.center),pe($o,t.center,t.eye),ec($o,$o,i),ec(y_,t.up,i),this.distance=Oe($o),$o[0]/=this.distance,$o[1]/=this.distance,$o[2]/=this.distance,this.pitch=this._eyeUpToPitch($o),this.yaw=this._eyeUpToYaw($o,y_),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,Cre);$h(i,i),this._axisAngleVec3(xc.sideway,this.pitch-Math.PI/2,xc.forward,$o),this._axisAngleVec3(xc.upward,this.yaw,$o),this._axisAngleVec3(xc.sideway,this.pitch-Math.PI/2,xc.upward,y_),this._axisAngleVec3(xc.upward,this.yaw,y_),oe($o,$o,this.distance),ec($o,$o,i),ec(y_,y_,i),t.center=this.center,t.eye=pe($o,this.center,$o),t.up=y_}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return oe(wc,r,n),lt(El,t,r),oe(El,El,o),oe(gy,t,(1-n)*xe(t,r)),de(s,de(s,wc,El),gy)}_lookAtOrientation(t,i=Sr()){return this._upAtLookAt(t,gy),lt(wc,this.lookAtDirection,gy),we(wc,wc),wc[0]===0&&wc[1]===0&&wc[2]===0&&se(wc,xc.sideway),lt(El,gy,wc),we(El,El),i[0]=wc[0],i[1]=El[0],i[2]=gy[0],i[3]=wc[1],i[4]=El[1],i[5]=gy[1],i[6]=wc[2],i[7]=El[2],i[8]=gy[2],i}_upAtLookAt(t,i){return this.viewingMode===Ve.Local?se(i,xc.upward):we(i,t)}_eyeUpToPitch(t){return Math.PI-yD(xc.upward,t)}_eyeUpToYaw(t,i){const r=TXe;return Math.abs(i[2])<.5?(se(r,i),t[2]>0&&oe(r,r,-1)):se(r,t),lt(El,r,xc.upward),we(El,El),yD(xc.sideway,El,xc.upward)}}function PY(e){return e?{ray:Qn(e.ray),c0:e.c0,c1:e.c1}:{ray:Qn(),c0:0,c1:Number.MAX_VALUE}}function SXe(e,t=PY()){return CN(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function EXe(e,t,i=PY()){const r=Oe(e.vector);return ffe(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function kbt(e,t){return j_e(e,e.c0,t)}function zbt(e,t){return j_e(e,e.c1,t)}function j_e(e,t,i){return de(i,e.ray.origin,oe(i,e.ray.direction,t))}new Hg(()=>({c0:0,c1:0,ray:null}));function ZO(e){return e?[_i(e[0]),_i(e[1]),_i(e[2]),_i(e[3]),_i(e[4]),_i(e[5])]:[_i(),_i(),_i(),_i(),_i(),_i()]}function H_e(){return[M(),M(),M(),M(),M(),M(),M(),M()]}function uF(e,t){for(let i=0;i<zg.NUM;i++)Y4(e[i],t[i])}function q_e(e,t,i,r=PXe){const s=Fr(gW.get(),t,e);us(s,s);for(let n=0;n<fj.NUM;++n){const o=lu(mW.get(),MXe[n],s);te(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}W_e(i,r)}function W_e(e,t){Go(t[Qe.FAR_BOTTOM_LEFT],t[Qe.NEAR_BOTTOM_LEFT],t[Qe.NEAR_TOP_LEFT],e[rr.LEFT]),Go(t[Qe.NEAR_BOTTOM_RIGHT],t[Qe.FAR_BOTTOM_RIGHT],t[Qe.FAR_TOP_RIGHT],e[rr.RIGHT]),Go(t[Qe.FAR_BOTTOM_LEFT],t[Qe.FAR_BOTTOM_RIGHT],t[Qe.NEAR_BOTTOM_RIGHT],e[rr.BOTTOM]),Go(t[Qe.NEAR_TOP_LEFT],t[Qe.NEAR_TOP_RIGHT],t[Qe.FAR_TOP_RIGHT],e[rr.TOP]),Go(t[Qe.NEAR_BOTTOM_LEFT],t[Qe.NEAR_BOTTOM_RIGHT],t[Qe.NEAR_TOP_RIGHT],e[rr.NEAR]),Go(t[Qe.FAR_BOTTOM_RIGHT],t[Qe.FAR_BOTTOM_LEFT],t[Qe.FAR_TOP_LEFT],e[rr.FAR])}function rv(e,t){for(let i=0;i<zg.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function CXe(e,t){return Y_e(e,SXe(t,Z_e.get()))}function Bbt(e,t){for(let i=0;i<zg.NUM;i++){const r=e[i];if(!H$e(r,t))return!1}return!0}function AXe(e,t,i){return Y_e(e,EXe(t,i,Z_e.get()))}function X_e(e,t){for(let i=0;i<zg.NUM;i++)if(sr(e[i],t)>0)return!1;return!0}function RXe(e,t){for(let i=0;i<zg.NUM;i++)if(G$e(e[i],t))return!1;return!0}function Y_e(e,t){for(let i=0;i<zg.NUM;i++)if(!j$e(e[i],t))return!1;return!0}var rr,Qe;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(rr||(rr={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Qe||(Qe={}));const OXe={bottom:[Qe.FAR_BOTTOM_RIGHT,Qe.NEAR_BOTTOM_RIGHT,Qe.NEAR_BOTTOM_LEFT,Qe.FAR_BOTTOM_LEFT],near:[Qe.NEAR_BOTTOM_LEFT,Qe.NEAR_BOTTOM_RIGHT,Qe.NEAR_TOP_RIGHT,Qe.NEAR_TOP_LEFT],far:[Qe.FAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_LEFT,Qe.FAR_TOP_LEFT,Qe.FAR_TOP_RIGHT],right:[Qe.NEAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_RIGHT,Qe.FAR_TOP_RIGHT,Qe.NEAR_TOP_RIGHT],left:[Qe.FAR_BOTTOM_LEFT,Qe.NEAR_BOTTOM_LEFT,Qe.NEAR_TOP_LEFT,Qe.FAR_TOP_LEFT],top:[Qe.FAR_TOP_LEFT,Qe.NEAR_TOP_LEFT,Qe.NEAR_TOP_RIGHT,Qe.FAR_TOP_RIGHT]};var zg,fj;(function(e){e[e.NUM=6]="NUM"})(zg||(zg={})),function(e){e[e.NUM=8]="NUM"}(fj||(fj={}));const MXe=[gi(-1,-1,-1,1),gi(1,-1,-1,1),gi(1,1,-1,1),gi(-1,1,-1,1),gi(-1,-1,1,1),gi(1,-1,1,1),gi(1,1,1,1),gi(-1,1,1,1)],Z_e=new Hg(PY),PXe=H_e(),IXe=fe.getLogger("esri.views.3d.webgl-engine.lib.Camera");class Qi{constructor(t=null,i=null,r=null){this._viewUp=M(),this._viewForward=M(),this._viewRight=M(),this._ray=Qn(),this._viewport=gi(0,0,1,1),this._padding=gi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Ii(1,1e3),this._viewDirty=!0,this._viewMatrix=Ae(),this._projectionDirty=!0,this._projectionMatrix=Ae(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ae(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ae(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=ZO(),this._fullViewport=Gt(),this._pixelRatio=1,this.relativeElevation=0,_(t)&&se(this._ray.origin,t),this._center=_(i)?$s(i):M(),this._up=_(r)?$s(r):Ue(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return pe(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){gs(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[Ct.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[Ct.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[Ct.RIGHT]+this._padding[Ct.LEFT]}set fullWidth(t){this.width=t-(this._padding[Ct.RIGHT]+this._padding[Ct.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Ct.TOP]+this._padding[Ct.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Ct.TOP]+this._padding[Ct.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Ct.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Ct.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[Ct.TOP]===t[Ct.TOP]&&this._padding[Ct.RIGHT]===t[Ct.RIGHT]&&this._padding[Ct.BOTTOM]===t[Ct.BOTTOM]&&this._padding[Ct.LEFT]===t[Ct.LEFT]||(this._viewport[0]+=t[Ct.LEFT]-this._padding[Ct.LEFT],this._viewport[1]+=t[Ct.BOTTOM]-this._padding[Ct.BOTTOM],this._viewport[2]-=t[Ct.RIGHT]+t[Ct.LEFT]-(this._padding[Ct.RIGHT]+this._padding[Ct.LEFT]),this._viewport[3]-=t[Ct.TOP]+t[Ct.BOTTOM]-(this._padding[Ct.TOP]+this._padding[Ct.BOTTOM]),kd(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Fr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,r=this.near*Math.tan(this.fovY/2),s=r*this.aspect;xpe(this._projectionMatrix,-s*(1+2*this._padding[Ct.LEFT]/t),s*(1+2*this._padding[Ct.RIGHT]/t),-r*(1+2*this._padding[Ct.BOTTOM]/i),r*(1+2*this._padding[Ct.TOP]/i),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return A(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Ae()),this._inverseProjectionDirty&&us(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){gs(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return uqe(this._fov,this.width,this.height)}set fovX(t){this._fov=lqe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return hqe(this._fov,this.width,this.height)}set fovY(t){this._fov=cqe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return or(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(us(this._viewInverseTransposeMatrix,this.viewMatrix),bl(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){se(this._ray.origin,t.eye),se(this._center,t.center),se(this._up,t.up),kd(this._viewport,t.viewport),kd(this._padding,t.padding),ro(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(gs(this._viewMatrix,t.viewMatrix),se(this._viewRight,t.viewRight),se(this._viewUp,t.viewUp),se(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(gs(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(uF(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(gs(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),kd(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Qi().copyFrom(this)}equals(t){return ll(this.eye,t.eye)&&ll(this._center,t.center)&&ll(this._up,t.up)&&oO(this._viewport,t.viewport)&&oO(this._padding,t.padding)&&Rve(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const i=5e-4,r=1-1e-10;uc(Do,t.eye,t.center),uc(pz,this.eye,this._center);const s=xe(Do,pz),n=V8(Do),o=V8(pz);return s*s>=r*n*o&&cq(t.eye,this.eye)<Math.max(n,o)*i*i&&lN(t.padding,this._padding)<.5&&lN(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(vR(this.viewForward,pe(Do,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=Vr()){return t[0]=(this.padding[Ct.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[Ct.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,i=.5,r=.5){return t[0]=this.padding[Ct.LEFT]+this.width*i,t[1]=this.padding[Ct.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const i=this.viewport,r=this.padding;t.setViewport(i[0]-r[3],i[1]-r[2],i[2]+r[1]+r[3],i[3]+r[0]+r[2])}applyProjection(t,i){t!==Bt&&se(Bt,t),Bt[3]=1,lu(Bt,Bt,this.projectionMatrix);const r=Math.abs(Bt[3]);oe(Bt,Bt,1/r);const s=this.fullViewport;i[0]=qt(0,s[0]+s[2],.5+.5*Bt[0]),i[1]=qt(0,s[1]+s[3],.5+.5*Bt[1]),i[2]=.5*(Bt[2]+1),i[3]=r}unapplyProjection(t,i){const r=this.fullViewport;Bt[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Bt[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Bt[2]=(2*t[2]-1)*t[3],Bt[3]=t[3],lu(Bt,Bt,this.inverseProjectionMatrix),i[0]=Bt[0],i[1]=Bt[1],i[2]=Bt[2]}projectToScreen(t,i){this.projectToRenderScreen(t,fz),this.renderToScreen(fz,i)}projectToRenderScreen(t,i){if(Bt[0]=t[0],Bt[1]=t[1],Bt[2]=t[2],Bt[3]=1,lu(Bt,Bt,this.viewProjectionMatrix),Bt[3]===0)return null;oe(Bt,Bt,1/Math.abs(Bt[3]));const r=this.fullViewport;return"x"in i?(i.x=qt(0,r[0]+r[2],.5+.5*Bt[0]),i.y=qt(0,r[1]+r[3],.5+.5*Bt[1])):(i[0]=qt(0,r[0]+r[2],.5+.5*Bt[0]),i[1]=qt(0,r[1]+r[3],.5+.5*Bt[1]),i.length>2&&(i[2]=.5*(Bt[2]+1))),i}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,fz),i)}unprojectFromRenderScreen(t,i){if(Fr(eI,this.projectionMatrix,this.viewMatrix),!us(eI,eI))return null;const r=this.fullViewport;return Bt[0]=2*(t[0]-r[0])/r[2]-1,Bt[1]=2*(t[1]-r[1])/r[3]-1,Bt[2]=2*t[2]-1,Bt[3]=1,lu(Bt,Bt,eI),Bt[3]===0?null:(i[0]=Bt[0]/Bt[3],i[1]=Bt[1]/Bt[3],i[2]=Bt[2]/Bt[3],i)}constrainWindowSize(t,i,r,s=r){const n=t*this._pixelRatio,o=i*this._pixelRatio,a=Math.max(n-r/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-r/2,0),h=-Math.min(this.fullHeight-o-s/2,0);return[a,l,r-c- -Math.min(this.fullWidth-n-r/2,0),s-h- -Math.min(o-s/2,0)]}computeUp(t){t===Ve.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,i){const r=t[0]*this._pixelRatio,s=this.fullHeight-t[1]*this._pixelRatio;return i[0]=r,i[1]=s,i}renderToScreen(t,i){const r=t[0]/this._pixelRatio,s=(this.fullHeight-t[1])/this._pixelRatio;i[0]=r,i[1]=s}_computeUpGlobal(){pe(Do,this.center,this.eye);const t=Oe(this.center);t<1?(te(this._up,0,0,1),this._markViewDirty()):Math.abs(xe(Do,this.center))>.9999*Oe(Do)*t||(lt(this._up,Do,this.center),lt(this._up,this._up,Do),we(this._up,this._up),this._markViewDirty())}_computeUpLocal(){Vg(Do,this.eye,this.center),Math.abs(Do[2])<=.9999&&(oe(Do,Do,Do[2]),te(this._up,-Do[0],-Do[1],1-Do[2]),we(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,i){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?ll(t,i)||(se(i,t),this._markViewDirty()):IXe.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(q_e(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(G4(this._viewMatrix,this.eye,this._center,this._up),te(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),te(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),te(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const Bt=Gt(),eI=Ae(),Do=M(),pz=M(),fz=wo();var Ct;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Ct||(Ct={}));const hF={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class IY{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:hF.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new IY(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:hF.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class $Xe{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,i)=>t+i.time,0)}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),t*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){i=this.segmentInterpolateComponentsAt(a,t/a.time,i),n.hasPan?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1;const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?i.zoom=(c-h)/(p-h):i.zoom=1,i}t-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,i,r){return t.interpolateComponentsAt(i,r)}}class mz{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function DXe(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function LXe(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function NXe(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function FXe(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function UXe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function kXe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function zXe(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function BXe(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function VXe(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function GXe(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function jXe(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function HXe(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function qXe(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function WXe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function XXe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function YXe(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function ZXe(e,t){let i=QXe(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?FXe:DXe,a=s?UXe:LXe,l=s?kXe:NXe,c=n?qXe:GXe,h=n?WXe:jXe,p=n?XXe:HXe,f=E=>o(e,E,r)+zXe(e,E,r)+c(e,E,r),m=E=>a(e,E,r)+BXe(e,E,r)+h(e,E,r),y=E=>l(e,E,r)+VXe(e,E,r)+p(e,E,r);let v=f(i);const w=YXe(e);let b;const S=t.maximumIterations||20,T=t.maximumDistance!=null?t.maximumDistance:1/0;for(b=0;b<S;b++){const C=(m(i)+1e-6)/y(i);if(isNaN(C)||i>=T&&C<0){if(!isFinite(T))return null;i=T,v=f(i);break}if(i-=C,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const O=f(i);if(Math.abs(O-v)/v<=.005)break;v=O}return v>w*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function QXe(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class JXe extends $Xe{constructor(t,i){super(),this._preallocSegments=[new mz,new mz,new mz],this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=ZXe(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=SY(r.zoom):t===this._descensionSegment&&(r.zoom=G5(r.zoom)),r}_updateWithApex(t,i){const[r,s,n]=this._preallocSegments,o=i.ascensionFactor!=null?i.ascensionFactor:.5,a=Math.min(1-o,i.ascensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const KXe={zoom:0,pan:0,rotate:0};class eYe{constructor(t){this.createCamera=t,this._time=0,this.definition=new IY(t),this.path=new JXe}get time(){return this._time}update(t,i,r){this.definition.update(t,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(qce(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?G_e:i3}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const r=this.path.interpolateComponentsAt(t,KXe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(t){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(t,this._time)-i)/(r-i)}_applyTimeSettings(t,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?t=i.duration:i.speedFactor!=null&&(t=t/r);const s=i.minDuration!=null?i.minDuration:hF.minDuration/r,n=i.maxDuration!=null?i.maxDuration:hF.maxDuration/r;return Math.min(Math.max(s,t),n)}}const tYe=M();class iYe{constructor(t){this.currentTime=0,this._animation=new eYe(()=>new Are(t)),this._current=new Are(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=pe(tYe,i.center,t.center),a=Oe(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),se(s.lookAtDirection,o),se(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new Qi,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+qce(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var Ir;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(Ir||(Ir={}));let hb=class extends Ee{constructor(){super(...arguments),this.state=Ir.Ready}get active(){return this.state===Ir.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ir.Stopped,!0)}finishController(){this.state=Ir.Finished}get steppingFinished(){return!1}};u([d({readOnly:!0})],hb.prototype,"active",null),u([d()],hb.prototype,"state",void 0),hb=u([P("esri.views.3d.state.controllers.CameraController")],hb);let QO=class extends hb{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(di()),this._asyncResult=null),this.state===Ir.Finished||this.state===Ir.Stopped?this.state===Ir.Finished?e.resolve():e.reject(di()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ir.Running,_(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!_(this.viewAnimation)||this.state!==Ir.Ready&&this.state!==Ir.Running||(this.viewAnimation.state===y2.State.FINISHED?this.finish():this.viewAnimation.state===y2.State.STOPPED&&(this.state=Ir.Stopped))}onControllerEnd(){_(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Ir.Finished?this.viewAnimation.finish():this.state===Ir.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ir.Finished?this._asyncResult.resolve():this._asyncResult.reject(di()))}finish(){this.finishController()}};QO=u([P("esri.views.3d.state.controllers.AnimationController")],QO);let cg=class extends QO{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new iYe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new y2}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);tI.copyFrom(this.view.state.camera);const r=Lh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(tI.ray,r,Rre)&&(tI.center=Rre),this.animation.update(tI,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return ve(F({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?yXe[e.easing]:e.easing})}};u([d({constructOnly:!0})],cg.prototype,"view",void 0),u([d({constructOnly:!0})],cg.prototype,"mode",void 0),cg=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],cg);const tI=new Qi,Rre=M();function Q_e(e,t,i){return rYe(e,e.screenToRender(t,je.get()),i)}function rYe(e,t,i){const r=ro(je.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=ro(je.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,je.get());return A(n)?null:(pe(i.direction,n,i.origin),i)}function vE(e,t,i){return $Y(e,e.screenToRender(t,je.get()),i)}function $Y(e,t,i){se(i.origin,e.eye);const r=te(je.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,je.get());return A(s)?null:(pe(i.direction,s,i.origin),i)}function DY(e,t,i,r){const s=vE(t,i,sYe);return Yv(e,s,r)}const sYe=Qn();var I2;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(I2||(I2={}));const J_e=30,dF=[1,3e8],K_e=70;function Mb(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function mj(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function Uv(e,t,i){const r=_u(gW.get(),i[3],i);A(r)||(pe(Bi,e.eye,t),ke(Bi,Bi,r),e.eye=de(Bi,Bi,t),pe(Bi,e.center,t),ke(Bi,Bi,r),e.center=de(Bi,Bi,t),e.up=ke(Bi,e.up,r))}function nYe(e,t,i,r){return Pw(e,Q_e(t,i,FY),r)}function gj(e,t,i,r){return Pw(e,vE(t,i,FY),r)}function LY(e,t,i,r){const s=je.get();let n=1-i;pe(s,t,e.eye);const o=Oe(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(oe(s,s,n),e.eye=de(Bi,e.eye,s),e.center=tn(Bi,e.center,t,n))}function e1e(e,t,i){t.getScreenCenter(Ore),DY(e,t,Ore,Bi)&&(t.center=Bi);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=oe(je.get(),t.viewForward,s);t.eye=pe(Bi,t.center,n)}const Ore=Vr();function gz(e,t){te(t,0,0,0);for(const i of e)de(t,t,i);oe(t,t,1/e.length)}function iL(e,t,i,r){return Math.sin(e/Oe(t))*(i+r.radius)}function Mre(e,t,i,r){return iL(Math.PI/2,t,i,r)+(e-Math.PI/2)}var Jn;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(Jn||(Jn={}));const Pre={Elevation:3e4,Angle:$t(6)},IR={Pole:.95,Angle:$t(18),Tilt:45},t1e=$t(80);function i1e(e,t,i,r,s,n){const o=M(),a=mn();let l=!0,c=!0;return e.intersectScreen(i,o,n)?a[3]=Oe(o):(c=!1,t.aboveGround&&s!==I2.Ellipsoid?a[3]=Math.max(Oe(t.center),.9*r.radius):a[3]=Oe(t.eye)-t.relativeElevation,s===I2.Silhouette?JO(a,t,i,o):l=DY(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function j5(e,t,i,r){return Oe(e.eye)-r.radius>Pre.Elevation?Jn.Horizontal:i?(vE(e,t,kre),-Math.sign(e.relativeElevation)*(.5*Math.PI+vW(e.eye,kre.direction))<Pre.Angle?Jn.Vertical:Jn.Horizontal):Jn.Vertical}function r1e(e,t,i){pe(yz,i,t),e.eye=pe(Bi,e.eye,yz),e.center=pe(Bi,e.center,yz)}const yz=M();function JO(e,t,i,r){const s=vE(t,i,FY);return!A(s)&&(sE(e,s,iI),Yv(e,s,r)?!(pn(iI,s.origin)<pn(r,s.origin))||(se(r,iI),!1):(pe(ix,t.eye,t.center),we(ix,ix),Tfe(ix,-xe(we(ix,ix),iI),Ire),Pw(Ire,s,r),!1))}const iI=M(),ix=M(),Ire=_i();function s1e(e,t,i,r,s,n){let o;if(lt(mF,e,t),pe(oI,e,t),Oe(e)<=s||!r.aboveGround){lt(i,oI,r.eye);const a=xe(e,t)/(Oe(e)*Oe(t)),l=Math.cos(De(Av.normalize($t(n)),0,t1e));o=-rn(a)-Math.max(0,Oe(t)-s)/(l*s)}else pe($re,r.eye,r.center),lt(i,oI,$re),o=-Oe(oI)/s;return we(i,i),oe(i,i,Oe(mF)),o}const $re=M();function Dre(e,t,i,r){let s,n;const o=Math.cos(De(Av.normalize($t(r)),0,t1e));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):rn(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):rn(e/i),(n-s)*i}function oYe(e,t,i,r,s,n,o,a,l,c){const h=Dre(e[2],t[2],o[3],l),p=c?Dre(e[0],t[0],o[3],180):t[0]-e[0],f=Math.sin(a)*p-Math.cos(a)*h,m=Math.cos(a)*p+Math.sin(a)*h;we(Bi,s);const y=c?f/Math.sqrt(Math.abs(o[3]**2-xe(i,Bi)**2)):f/o[3],v=m/Math.sqrt(Math.abs(o[3]**2-xe(i,r)**2));pi(n,y,v)}function n1e(e,t,i,r,s,n,o,a,l,c){lt(mF,e,t),J9(n.up,n.eye,rI,sI,nI),J9([0,0,1],n.eye,_g,yv,c1e),se(i,yv),se(r,_g),we(i,i),oe(i,i,Oe(mF)),dK(e,we(sI,sI),we(nI,nI),we(rI,rI),Lre),dK(t,sI,nI,rI,Nre),oYe(Lre,Nre,e,_g,yv,s,o,a,l,c)}function aYe(e,t,i,r,s,n,o){_u(pF,s,r),_u(fF,o,n),Fr(QT,pF,fF),pe(t,e,i),ke(t,t,QT),de(t,t,i)}function o1e(e,t,i,r,s,n){_u(pF,r,i),_u(fF,n,s),Fr(QT,pF,fF),pe(Bi,e.eye,t),ke(Bi,Bi,QT),e.eye=de(Bi,Bi,t),pe(Bi,e.center,t),ke(Bi,Bi,QT),e.center=de(Bi,Bi,t),pe(Bi,e.up,t),ke(Bi,Bi,QT),e.up=de(Bi,Bi,t)}function NY(e,t,i,r,s,n,o=IR.Pole,a=IR.Angle){const l=Math.abs(r)>Math.PI-a||Math.abs(r)<a,c=Math.abs(e[2])<i*o||Math.abs(t)>i;return!!(l&&c&&n.aboveGround&&s<IR.Tilt)}function a1e(e,t,i,r,s,n){if(n)$O(i,r,Fre),Uv(t,e,Fre);else{const o=s1e(i,r,Ure,t,e[3],s);Uv(t,e,IO(Ure,o))}}function l1e(e,t,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;se(v_,r),aI.copyFrom(t);for(let p=0;p<a&&pn(i,v_)>l&&(c=pn(i,v_),n1e(i,v_,yv,_g,KE,aI,e,s,n,o),o1e(aI,e,_g,KE[1],yv,KE[0]),aYe(v_,v_,e,_g,KE[1],yv,KE[0]),h=pn(i,v_),h<c||p===0);p++)t.copyFrom(aI)}function lYe(e,t,i,r,s,n,o){NY(i,xe(t.up,i),e[3],-Av.normalize($t(s)),n,t,IR.Pole,IR.Angle)?l1e(e,t,i,r,-Av.normalize($t(s)),n,o):a1e(e,t,i,r,n,o)}function cYe(e,t,i,r,s,n){const{eye:o}=e;J9([0,0,1],o,_g,yv,c1e);const a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-xe(e.center,_g)**2/Oe(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(tc(r.pan.matrix,r.pan.matrix,h,_g),r.pan.enabled=!0,s.mode){case"pan":tc(r.pan.matrix,r.pan.matrix,p,yv),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function uYe(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=lt(je.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(tc(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*i.pan;c!==0&&(tc(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function hYe(e,t,i,r,s,n,o,a,l){NY(e.center,xe(e.up,e.center),Oe(e.center),-Av.normalize($t(n)),o,t)?cYe(t,i,r,a,l,-Av.normalize($t(s))):uYe(t,i,r,a,l)}const _g=M(),yv=M(),c1e=M(),rI=M(),sI=M(),nI=M(),Lre=M(),Nre=M(),KE=tt(),Fre=mE(),pF=Ae(),fF=Ae(),QT=Ae(),v_=M(),Bi=M(),oI=M(),aI=new Qi,mF=M(),Ure=M(),FY={origin:M(),direction:M()},kre={origin:M(),direction:M()},zre=.6,vz=4,dYe=12,pYe=60,fYe=200;let gF=class extends cg{constructor(){super(...arguments),this.zoomLocation=M(),this.tmpCamera=new Qi,this.tmpViewDir=M(),this.tmpRayDir={origin:M(),direction:M()},this.targetOnSphere=M(),this.tmpCenter=M(),this.constraintOptions={selection:mr.ALL_EXCEPT_COLLISION,interactionType:kt.ZOOM,interactionFactor:null,interactionStartCamera:new Qi,interactionDirection:null,tiltMode:On.TUMBLE},this.sphere=mn()}initialize(){this.intersector=Lh(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,this.view.map.ground.opacity===0?mYe:{})&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:se(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:i3}}_updateCamera(e,t,i,r,s){const n=wi(this.view.spatialReference),o=j5(e,r,s,n);let a;this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z)),we(cI,e.eye),oe(cI,cI,-1),vE(e,r,this.tmpRayDir),we(this.tmpRayDir.direction,this.tmpRayDir.direction);const l=Math.max(Math.min(dYe,1/Math.abs(xe(cI,this.tmpRayDir.direction)))*a,fYe);if(o===Jn.Horizontal){let c=zre**t;this.sphere[3]=Oe(i),pe(this.tmpViewDir,e.center,e.eye);const h=Math.min(Oe(this.tmpViewDir),l);let p=h*c;if(c<=1&&p<vz&&(p=vz,c=p/h),Math.abs(h-p)<1e-6)return;const f=Oe(e.center);if(this.sphere[3]!==f){const m=this.sphere[3]+c*(f-this.sphere[3]);e.center=oe(lI,e.center,m/f)}oe(this.tmpViewDir,this.tmpViewDir,-c),e.eye=de(lI,e.center,this.tmpViewDir),ls(this.view,e,this.constraintOptions),pn(i,e.center)>1e-12&&DY(this.sphere,e,r,this.targetOnSphere)&&lYe(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=zre**Math.abs(t);const h=t>0?1:-1;pe(this.tmpViewDir,i,e.eye);const p=Oe(this.tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,pYe);let m=f?Math.min(l,f):l;m=s?Math.min(m,p):m,oe(this.tmpRayDir.direction,this.tmpRayDir.direction,m),de(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let y=m*c;const v=Math.max(vz,1.01*e.nearFar[0]);if(t>0&&y<v&&(y=v,c=y/m),Math.abs(m-y)<1e-6)return;oe(this.tmpRayDir.direction,this.tmpRayDir.direction,h*(1-c)),e.eye=de(lI,e.eye,this.tmpRayDir.direction),e.center=de(lI,e.center,this.tmpRayDir.direction)}yE(this.view,e)}};gF=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],gF);const lI=M(),cI=M(),mYe={exclude:new Set([Nd])},gYe=.6,yYe=4,vYe=60,_Ye=14,bYe=200;let yF=class extends cg{constructor(){super(...arguments),this.zoomLocation=M(),this.tmpCamera=new Qi,this.tmpRayDir=M(),this.tmpCenter=M(),this.constraintOptions={selection:mr.ALL,interactionType:kt.ZOOM,interactionFactor:null,interactionStartCamera:new Qi,interactionDirection:null,tiltMode:On.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=Lh(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,xYe):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:se(this.zoomLocation,this.tmpCamera.center);const n=gYe**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,vYe);pe(uI,this.tmpCamera.eye,this.zoomLocation),we(uI,uI);const a=Math.max(Math.min(_Ye,1/Math.abs(xe(wYe,uI)))*Math.abs(this.view.camera.position.z),bYe);if(o=o?Math.min(o,a):a,o){const l=M();pe(l,this.zoomLocation,this.tmpCamera.eye),o<Oe(l)&&(we(l,l),de(this.zoomLocation,this.tmpCamera.eye,oe(l,l,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:i3}}_updateCamera(e,t,i){pe(this.tmpRayDir,i,e.eye);const r=Oe(this.tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(yYe,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(oe(this.tmpRayDir,this.tmpRayDir,t),e.eye=pe(Bre,i,this.tmpRayDir),e.center=tn(Bre,e.center,i,1-t),ls(this.view,e,this.constraintOptions))}};yF=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],yF);const Bre=M(),wYe=Ue(0,0,1),uI=M(),xYe={exclude:new Set([Nd])};function TYe(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function UY(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class SYe extends Oo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(TYe(i,"primary")){const r=this.view.state.isGlobal?new gF({view:this.view,mode:"animation"}):new yF({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Vr(i.x,i.y)),t.stopPropagation()}}}let kv=class extends hb{constructor(){super(...arguments),this.startCamera=new Qi,this.currentCamera=new Qi}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Ir.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};kv=u([P("esri.views.3d.state.controllers.InteractiveController")],kv);var Hl;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(Hl||(Hl={}));const EYe=7,_z=90;let JT=class extends kv{constructor(e){super(e),this.view=null,this.pivot=Hl.CENTER,this.lastPoint=tt(),this.tmpWorldUp=M(),this.tmpViewDir=M(),this.tmpRotCurPoint=tt(),this.tmpTransf=Ae(),this.tmpAxis=M(),this.tmpPivotPoint=M(),this.pivotPos=M(),this.constraintOptions={selection:mr.ALL,interactionType:kt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:On.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===Hl.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Hl.EYE:se(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=kt.LOOK_AROUND,this.constraintOptions.tiltMode=On.LOOK_AROUND,this.constraintOptions.selection=mr.NONE;break;case Hl.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||se(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=kt.TUMBLE,this.constraintOptions.tiltMode=On.TUMBLE,this.constraintOptions.selection=mr.ALL&~mr.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,Mb(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=M();pe(r,this.pivotPos,i.eye);const s=Oe(r);let n=Math.min(s,EYe*Math.abs(this.view.camera.position.z));const o=wi(this.view.spatialReference),a=Vr(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=j5(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*_z,_z),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,_z);c===void 0&&h===void 0||(c=c===void 0?h:c,h=h===void 0||l===Jn.Horizontal?c:h,n=c>h?h:c,n=t?Math.min(n,s):n),we(r,r),se(this.pivotPos,de(this.tmpPivotPoint,i.eye,oe(this.tmpPivotPoint,r,n)))}update(e){if(this.active){switch(this.pivot){case Hl.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case Hl.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}ls(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),Mb(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;pe(this.tmpViewDir,i,r);const o=Oe(this.tmpViewDir),a=rn(xe(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===Hl.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=De(s+a,_o.min,_o.max)-a,lt(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===Hl.CENTER&&(n=-n),_u(this.tmpTransf,n,this.tmpWorldUp),tc(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),ke(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=ke(bz,e.up,this.tmpTransf),de(bz,r,this.tmpViewDir),ro(this.lastPoint,this.tmpRotCurPoint),bz}};u([d({constructOnly:!0})],JT.prototype,"view",void 0),u([d()],JT.prototype,"pivot",void 0),JT=u([P("esri.views.3d.state.controllers.RotateController")],JT);const bz=M();class wz extends Oo{constructor(t,i,r,s){super(!0),this.view=t,this.pointerAction=i,this.pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!UY(t.data,this.pointerAction))return;const r=Vr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new JT({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let rL=class extends kv{constructor(e){super(e),this.view=null,this.pickPoint=M(),this.tmpP0=tt(),this.panAxisAngle=mE(),this.tmpRayDir=M(),this.tmpRayDirPick=M(),this.targetOnSphere=M(),this.tmpRay={origin:M(),direction:M()},this.dragBeginPoint=Vr(),this.normalizedAnchorPoint=tt(),this.constraintOptions={selection:mr.ALL_EXCEPT_COLLISION,interactionType:kt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:On.TUMBLE},this.sphere=mn(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;ro(this.dragBeginPoint,e),Mb(this.startCamera,e,this.normalizedAnchorPoint);const t=wi(this.view.spatialReference),i=i1e(this.intersectionHelper,this.startCamera,e,t,I2.Ellipsoid,this.view.map.ground.opacity===0?CYe:{});if(this.navMode=j5(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===Jn.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let r,s;vE(this.startCamera,e,this.tmpRay),we(this.tmpRay.direction,this.tmpRay.direction),i.scenePickPoint&&(pe(this.tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Oe(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let n=De(J_e*r,dF[0],dF[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,K_e);n=o?Math.min(n,o):n,n=i.scenePickPoint?Math.min(n,s):n,this.hasPickPoint=!0,oe(this.tmpRay.direction,this.tmpRay.direction,n),de(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===Jn.Horizontal){pe(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Oe(this.tmpRayDir);Mb(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this.sphere[3]/Oe(this.currentCamera.center));this.currentCamera.center=oe(hI,this.currentCamera.center,n)}oe(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=de(hI,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=Id(this.dragBeginPoint,e),ls(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(JO(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),$O(this.pickPoint,this.targetOnSphere,this.panAxisAngle),Uv(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Oe(this.tmpRay.direction);Mb(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;oe(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=de(hI,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=de(hI,this.currentCamera.center,this.tmpRayDir)}yE(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],rL.prototype,"view",void 0),rL=u([P("esri.views.3d.state.controllers.global.ZoomController")],rL);const hI=M(),CYe={exclude:new Set([Nd])};let sL=class extends kv{constructor(e){super(e),this.view=null,this.tmpP=M(),this.tmpDir=M(),this.tmpN=M(),this.tmpP0=tt(),this.tmpPoi=M(),this.tmpRayDir=M(),this.dragBeginPoint=Vr(),this.normalizedAnchorPoint=tt(),this.constraintOptions={selection:mr.ALL,interactionType:kt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:M(),tiltMode:On.TUMBLE},this.plane=_i()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;ro(this.dragBeginPoint,e),Mb(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,this.view.map.ground.opacity===0?AYe:{});pe(this.tmpDir,this.tmpP,this.startCamera.eye);const i=Oe(this.tmpDir);let r;we(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=De(J_e*r,dF[0],dF[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,K_e);s=n?Math.min(s,n):s,s=t?Math.min(s,i):s,oe(this.tmpDir,this.tmpDir,s),de(this.tmpP,this.startCamera.eye,this.tmpDir),pe(this.tmpN,this.startCamera.eye,this.startCamera.center),we(this.tmpN,this.tmpN),this.tmpN[1]<0&&Wo(this.tmpN,this.tmpN),a2(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;nYe(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||se(this.tmpPoi,this.currentCamera.center),Mb(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);ro(this.normalizedAnchorPoint,this.tmpP0),pe(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=Oe(this.tmpRayDir);let r=i*(1-t);se(this.constraintOptions.interactionDirection,this.tmpRayDir),oe(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(oe(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=de(__,this.currentCamera.eye,this.tmpRayDir),tn(__,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?__[2]=Math.max(this.startCamera.center[2],__[2]):__[2]=Math.min(this.startCamera.center[2],__[2]),this.currentCamera.center=__,this.constraintOptions.interactionFactor=Id(this.dragBeginPoint,e),ls(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],sL.prototype,"view",void 0),sL=u([P("esri.views.3d.state.controllers.local.ZoomController")],sL);const __=M(),AYe={exclude:new Set([Nd])};class RYe extends Oo{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!UY(t.data,this.pointerAction))return;const r=Vr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new rL({view:this.view}):this.cameraController=new sL({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const OYe=M(),dI=M();function kY(){return{direction:M(),up:M()}}function u1e(e,t,i,r,s){let n=we(OYe,e),o=xe(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(xe(t,r)),o<.99?(se(n,t),a&&oe(n,n,-1)):n=null);let l=0;if(n){oe(dI,r,xe(r,n)),pe(n,n,dI);const h=xe(n,s)/(Oe(n)*Oe(s));lt(dI,n,s),l=(xe(dI,r)>0?1:-1)*hc(rn(h))}const c=hc(rn(-xe(r,e)/Oe(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const h1e=Ue(0,1,0),d1e=Ue(0,0,1),eC=Ae(),nm=M(),om=M();function p1e(e,t,i,r=kY()){const{direction:s,up:n}=r;return _pe(eC,-$t(t)),i2(eC,eC,$t(i)),ke(s,d1e,eC),oe(s,s,-1),ke(n,h1e,eC),r}function MYe(e,t,i,r){return u1e(t,i,r,d1e,h1e)}function PYe(e,t,i,r){const s=p1e(e,i,r),n=M();return oe(n,s.direction,-t),de(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function IYe(e){return hc(e)}function $Ye(e){return $t(e)}function f1e(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return Pn(t,nm,n),Pn(t,om,n),nm[0]-=i/2,om[0]+=i/2,nm[1]-=r/2,om[1]+=r/2,Ks(nm,n,nm,o),Ks(om,n,om,o),s?(s.xmin=nm[0],s.ymin=nm[1],s.xmax=om[0],s.ymax=om[1],s.spatialReference=o):s=new ri(nm[0],nm[1],om[0],om[1],o),s}const DYe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:p1e,directionToHeadingTilt:MYe,eyeForCenterWithHeadingTilt:PYe,lookAtTiltToEyeTilt:IYe,eyeTiltToLookAtTilt:$Ye,toExtent:f1e},Symbol.toStringTag,{value:"Module"})),m1e=Ue(0,0,1),g1e=we(M(),Ue(1,1,1)),LYe=new Cv(-180,180),tC=Ae(),O0=M(),rx=M();function y1e(e,t,i,r=kY()){lt(O0,e,m1e),xe(O0,O0)===0&&lt(O0,e,g1e),_u(tC,-$t(t),e),tc(tC,tC,-$t(i),O0);const{up:s,direction:n}=r;return lt(s,O0,e),we(s,s),ke(s,s,tC),we(n,e),Wo(n,n),ke(n,n,tC),r}function NYe(e,t,i,r){const s=O0,n=rx;return we(s,e),lt(rx,s,m1e),xe(rx,rx)===0&&lt(rx,s,g1e),lt(n,rx,s),u1e(t,i,r,s,n)}function FYe(e,t,i,r){const s={eye:M(),up:null,tilt:r,heading:i},n=O0;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=$t(i),l=$t(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Oe(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const ne=m/p,$=rp(o/ne),U=Math.PI-l-$;y=ne*Math.sin(U)}const v=f*o,w=o*o*(p*p),b=h*h*w,S=y-v,T=S*S,E=b*(b+T-n[1]*n[1]);if(E<0)return oe(s.eye,n,y/m),s.tilt=0,s;const C=Math.sqrt(E),O=n[1]*S,I=b+T;let N;if(N=h>0?-C+O:C+O,Math.abs(I)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):oe(s.eye,n,y/m),s.tilt=0,xz(s.eye),Tz(s,e);s.eye[1]=N/I;const D=c*c*w,z=p*o,B=h*z*s.eye[1],k=s.eye[1]*s.eye[1],Y=1-k,Z=Math.sqrt(Y),le=b*k+D-2*B*Z*S+Y*T;return Math.abs(le)<1e-8?(oe(s.eye,n,y/m),s.tilt=0,xz(s.eye),Tz(s,e)):(s.eye[0]=(Y*(y*n[0]-v*n[0])-z*Z*(n[0]*s.eye[1]*h+n[2]*c))/le,s.eye[2]=(Y*(y*n[2]-v*n[2])-z*Z*(n[2]*s.eye[1]*h-n[0]*c))/le,oe(s.eye,s.eye,y),xz(s.eye),Tz(s,e))}function xz(e){const t=e[1];e[1]=-e[2],e[2]=t}function Tz(e,t){const i=y1e(t,e.heading,e.tilt);return e.up=i.up,e}function UYe(e,t,i){const r=Oe(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=rp(i/(s/Math.sin(e)));return hc(e-n)}function kYe(e,t,i){const r=$t(e),s=Oe(t);return rp(i/(s/Math.sin(r)))+r}function v1e(e,t,i,r,s){let n,o,a,l;const c=t.latitude,h=wi(e.spatialReference).radius,p=t.longitude,f=kqe(c,i,h)/2;n=p-f,o=p+f;const m=$t(c),y=(1+Math.sin(m))/(1-Math.sin(m)),v=(y+1)*Math.tan(r/h/2),w=v*v;function b(T){const E=Math.PI/2;return(T=CPe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*y+w))),l=a+r/h,a=b(a),l=b(l),l<a){const T=l;l=a,a=T}if(a=Math.max(hc(a),-90),l=Math.min(hc(l),90),o=LYe.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const S=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:Ke.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=S):s=new ri(n,a,o,l,S),e.spatialReference&&e.spatialReference.isWebMercator&&pg(s,!1,s),s}const zYe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:y1e,directionToHeadingTilt:NYe,eyeForCenterWithHeadingTilt:FYe,lookAtTiltToEyeTilt:UYe,eyeTiltToLookAtTilt:kYe,toExtent:v1e},Symbol.toStringTag,{value:"Module"}));function vF(e){return e.type==="point"}class _1e{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function b1e(e){return"array"in e}function yf(e,t,i="ground"){if(vF(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(b1e(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,vt(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function _F(e,t){return e!=null&&(t==null||(t===Ve.Local?!e.isGeographic||e.isWGS84||e.wkid===yh.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===yh.CGCS2000||e.wkid===yh.GCSMARS2000||e.wkid===yh.GCSMARS2000_SPHERE||e.wkid===yh.GCSMOON2000))}const w1e=fe.getLogger("esri.views.3d.support.cameraUtils"),x1e=39.37,T1e=96,yj=1,BYe=8,VYe=5,S1e=1,Vre=M(),pI=M(),GYe={heading:0,tilt:0},eg=new nt,jYe=new Cv(-20037508342788905e-9,20037508342788905e-9),HYe=new Cv(-180,180);var So;function r3(e){return e.spatialReference||Ke.WGS84}function _E(e){return e.viewingMode==="global"?zYe:DYe}function qYe(e,t,i,r,s){return _E(e).headingTiltToDirectionUp(t,i,r,s)}function Xm(e,t){if(A(t))return null;const i=e.renderSpatialReference,r=_E(e).headingTiltToDirectionUp,s=M();if(!Pn(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);oe(n.direction,n.direction,e.state.camera.distance),de(n.direction,n.direction,s);const o=Fw(e,s,n.direction,n.up);return o.fov=$t(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(So||(So={}));const sx=M();function $2(e,t,i){const r=e.renderSpatialReference,s=H5(e,t.eye,t.viewForward,t.up,GYe);let n=r3(e);return Ks(t.eye,r,sx,n)||(n=Ke.WGS84,Ks(t.eye,r,sx,n)),A(i)?new dc(new nt(sx,n),s.heading,s.tilt,hc(t.fov)):(i.position.x=sx[0],i.position.y=sx[1],i.position.z=sx[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=hc(t.fov),i)}function zY(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===Ve.Global&&i!=null&&(t*=Math.cos($t(i))),t/=e.renderCoordsHelper.unitInMeters,s/(T1e*x1e/t)/Math.tan(r.fovX/2)}function cw(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=T1e*x1e/(n/s);return e.renderCoordsHelper.viewingMode===Ve.Global&&(o/=Math.cos($t(i))),o*=e.renderCoordsHelper.unitInMeters,o}function E1e(e,t,i,r,s,n){return C1e(e,t,zY(e,i,t.latitude),r,s,n)}function C1e(e,t,i,r,s,n){if(Pb(n)){const a=new bE(n.signal);return KO(e,r.heading,r.tilt,t,i,s,a),void a.resolver.promise.then(l=>{const c=wF(e,l,r.fov);if(!A(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=KO(e,r.heading,r.tilt,t,i,s);return wF(e,o,r.fov,n)}function H5(e,t,i,r,s){return _E(e).directionToHeadingTilt(t,i,r,s)}function WYe(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,eg,e.spatialReference)&&vt(yf(e.elevationProvider,eg),0)>eg.z-S1e)}async function XYe(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,eg,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(eg.x,eg.y,eg.z,eg.spatialReference,"ground",i);return vt(r,0)>eg.z-S1e}async function YYe(e,t,i){const r=M();if(t)if(t instanceof nt){if(Pn(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return _(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else se(r,t);else se(r,e.state.camera.center);return r}function ZYe(e,t){const i=M();if(t&&t instanceof nt){if(Pn(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const r=yf(e.elevationProvider,t);_(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else se(i,t||e.state.camera.center);return i}function KO(e,t,i,r,s,n,o){const a=r&&r instanceof nt?r:null;if(Pb(o))return YYe(e,r,o.signal).then(c=>{vj(e,t,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=ZYe(e,r);return vj(e,t,i,a,l,s,n,o)}function vj(e,t,i,r,s,n,o,a){if(A(r)){const p=e.renderSpatialReference;if(r=Rv(s,p,r3(e)),A(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=KYe(e,t,i,s,n,o),c=(0,_E(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===So.ADJUST&&e.viewingMode==="global"&&i>0){const p=()=>{const m=A1e(e,s,n,tZe(e,n,i,s));return o=i-m<1?So.LOCKED:So.ADJUST,vj(e,t,m,r,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(WYe(e,c.eye))return p();if(Pb(a))return XYe(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:$s(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||Pb(a)?{center:M(),eye:M(),up:M(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=$s(s),h.heading=c.heading,h.tilt=c.tilt,Pb(a)&&a.resolver.resolve(h),h}function $R(e,t,i,r,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!_F(t.spatialReference,Ve.Global))return Pb(n)&&n.resolver.reject(),null;const b=new nt(t.xmin,t.ymin,t.spatialReference),S=new nt(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?HYe:jYe;a=new nt({x:T.center(b.x,S.x),y:(S.y+b.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const E=wi(t.spatialReference),C=Uqe(a,b,S);l=C.lon,c=C.lat,T.diff(b.x,S.x)>T.range/2&&(l+=E.halfCircumference),l=Math.min(l,E.halfCircumference),c=Math.min(c,E.halfCircumference)}else{const b=vt(e.renderSpatialReference,t.spatialReference);b.equals(t.spatialReference)||(t=kM(t,b)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const S=o?(t.zmax+t.zmin)/2:null;a=new nt({x:t.xmin+.5*l,y:t.ymin+.5*c,z:S,spatialReference:b})}const h=o?t.zmax-t.zmin:0,p=e.state.camera,f=1/Math.tan(p.fovX/2),m=1/Math.tan(p.fovY/2),y=1/Math.tan(p.fov/2),v=Math.max(.5*l*f,.5*c*m,.5*h*y)/yj;if(Pb(n)){const b=new bE(n.signal);return KO(e,i,r,a,v,s,b),void b.resolver.promise.then(S=>{const T=wF(e,S,e.camera.fov);if(!A(T))return n.resolver.resolve(T);n.resolver.reject()},S=>n.resolver.reject(S))}const w=KO(e,i,r,a,v,s);return wF(e,w,e.camera.fov,n)}function QYe(e,t,i){const r=e.renderSpatialReference,s=Rv(i,r,r3(e));if(A(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=lq(t.eye,i),l=2*a*n*yj,c=2*a*o*yj;return e.viewingMode==="global"?v1e(e,s,l,c):f1e(e,s,l,c)}function JYe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>BYe)return!0;const s=e.renderSpatialReference,n=r3(e),o=Rv(t,s,n),a=Rv(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(A(o)||A(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>VYe}function KYe(e,t,i,r,s,n){let o=0;return n===So.ADJUST&&JYe(e,r,s)?(t=0,o=eZe(e,s,i,r)):o=BY(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=A1e(e,r,s,o)}}const bF=.7;function eZe(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-bF)+s.max*bF,o=BY(e,r,t,i);return Math.min(o,n)}function tZe(e,t,i,r){const s=e.state.constraints.tilt(t);let n=BY(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-bF)+n*bF}function A1e(e,t,i,r){return _E(e).lookAtTiltToEyeTilt(r,t,i)}function BY(e,t,i,r){return _E(e).eyeTiltToLookAtTilt(r,t,i)}function wF(e,t,i,r){if(A(t))return null;const s=e.renderSpatialReference,n=Rv(t.eye,s,r3(e));return A(n)?null:_(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new dc(n,t.heading,t.tilt,i)}function R1e(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(t);w1e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function O1e(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(t);w1e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function iZe(e,t){return e.spatialReference?Vfe(t,e.spatialReference):void 0}function M1e(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=Ke.WGS84;return t instanceof dc?(s=t.position.latitude,Pn(t.position,Vre,r),Pn(i,pI,r),n=or(Vre,pI)):(Ks(t.center,r,pI,o),s=pI[1],n=t.distance),cw(e,n,s)}class bE{constructor(t){this.signal=t,this.resolver=ip()}}function Pb(e){return e&&"resolver"in e}function Yh(e){let t=e*e;return e<0&&(t*=-1),t}function Gre(e,t,i){const r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=Yh(s.axes[0]),r.translation[1]=Yh(s.axes[1]),r.translation[2]=Yh(s.buttons[7])-Yh(s.buttons[6]),r.heading=Yh(s.axes[2]),r.tilt=Yh(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*Yh(s.axes[0]),r.translation[1]=1.2*Yh(s.axes[1]),r.translation[2]=2*-Yh(s.axes[2]),r.heading=1.2*Yh(s.axes[5]),r.tilt=1.2*Yh(s.axes[3])),r.tilt*=o,oe(r.translation,r.translation,a),r}function jre(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function Sz(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let F0=class extends kv{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new Qi,this.constraintOptions={selection:mr.ALL,interactionType:kt.NONE,interactionStartCamera:new Qi,interactionFactor:0,interactionDirection:null,tiltMode:On.LOOK_AROUND}}handleEventGamepad(e){const t=Gre(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||Sz(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,jre(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=jre(this.keysButtonState,this.transformation);Sz(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,b_),this._applyDisabledMovementTypes(b_),this._applyPan(b_.pan),this._applyRotate(b_.rotate),this._applyZoom(b_.zoom),this._applyAscend(b_.ascend),this.constraintOptions.interactionType=kt.NONE,this.constraintOptions.selection=mr.COLLISION,ls(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;pe(Ua,t.center,t.eye),ke(Ua,Ua,e.matrix),t.center=de(Ua,Ua,t.eye),t.up=ke(Ua,t.up,e.matrix),this.constraintOptions.interactionType=kt.LOOK_AROUND,this.constraintOptions.selection=mr.ALL_EXCEPT_COLLISION,ls(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=ke(Ua,t.eye,e.matrix),t.center=ke(Ua,t.center,e.matrix),this.view.state.isGlobal&&(t.up=ke(Ua,t.up,e.matrix)),this.constraintOptions.interactionType=kt.PAN,this.constraintOptions.selection=mr.ALL,ls(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=de(Ua,this.currentCamera.eye,oe(je.get(),t,e)),se(iC,t),Wo(iC,iC),this.constraintOptions.interactionDirection=iC,this.constraintOptions.interactionType=kt.ZOOM,this.constraintOptions.selection=mr.ALL_EXCEPT_COLLISION,ls(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,je.get());if(this.constraintOptions.interactionDirection=se(iC,t),this.view.state.isGlobal){const i=Oe(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=oe(Ua,this.currentCamera.eye,r),this.currentCamera.center=oe(Ua,this.currentCamera.center,r)}else{const i=oe(je.get(),t,e);this.currentCamera.eye=de(Ua,this.currentCamera.eye,i),this.currentCamera.center=de(Ua,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=kt.ASCEND,this.constraintOptions.selection=mr.COLLISION,ls(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=mr.ALL_EXCEPT_COLLISION,ls(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){cZe(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Ua)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=te(je.get(),s[0],s[1],0);we(a,a);const l=n.translation[0]*e.pan;if(l!==0){const y=oe(je.get(),r,l);Ia(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const v=oe(je.get(),a,y);Ia(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(tc(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,je.get())),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=Fv(this.view.renderCoordsHelper,t.center,t.eye),m=De(f+p,_o.min,_o.max)-f;m&&(tc(i.rotate.matrix,i.rotate.matrix,m,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=lt(je.get(),s,r);we(a,a),Wo(a,a),hYe(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(b_.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(tc(i.rotate.matrix,i.rotate.matrix,h,this.tmpCamera.eye),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(tc(i.rotate.matrix,i.rotate.matrix,f,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=wi(this.view.spatialReference),s=iL(_o.min,t.origin,i,r);let n=0,o=0;const a=je.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){const l=Fv(this.view.renderCoordsHelper,a,t.origin);n=iL(l,t.origin,i,r),o=iL(_o.max,t.origin,i,r)}else{sE(W4(X4,i+r.radius),t,a);const l=rn(-xe(t.direction,we(a,a)));n=Mre(l,t.origin,i,r),o=Mre(_o.max,t.origin,i,r)}return De(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=qYe(this.view,t,0,P1e,lZe),n=i.intersectManifoldClosestSilhouette(wu(t,s),e,je.get()),o=or(t,n),a=i.intersectManifoldClosestSilhouette(wu(t,Vg(je.get(),t,r.center)),e,je.get()),l=or(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,je.get());if(s){const o=pe(je.get(),e,n),a=Oe(o);oe(o,o,1/a);const l=we(je.get(),e),c=rn(xe(l,o));return a*Math.sin(Math.min(sZe,c))}{const o=se(je.get(),e);return t.setAltitude(o,this.filteredSurfaceElevation),or(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:nZe}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+wi(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=je.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=Hre*r.width,h=Hre*r.width,p=a*Math.tan(.5*r.fovX)/l,f=p/i,m=p/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*y-y),zoom:2**(c*e/l)*a-a,rotate:De(m*h,oZe,aZe)*e}}_applyDisabledMovementTypes(e){!_(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&$f(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&$f(e.rotate.matrix))}static activatesFor(e,t){const i=Gre(t,e.navigation.gamepad,rZe);return!(t.action==="end"||Sz(i))}};u([d({constructOnly:!0})],F0.prototype,"view",void 0),u([d({constructOnly:!0})],F0.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],F0.prototype,"disableMovements",void 0),F0=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],F0);const rZe={translation:[0,0,0],heading:0,tilt:0,zoom:0},P1e=80,sZe=$t(P1e),Hre=.75,nZe=5,oZe=$t(30),aZe=$t(80),b_={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ae()},rotate:{enabled:!1,matrix:Ae()}},Ua=M(),iC=M(),lZe=kY();function cZe(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,$f(e.pan.matrix),e.rotate.enabled=!1,$f(e.rotate.matrix)}class uZe extends Oo{constructor(t){super(!0),this.view=t,this.watchHandles=new Ht,this.handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([ae(()=>this.view.navigation.gamepad.enabled,i=>{i?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},Ft),ae(()=>this.view.navigation.gamepad.device,i=>{this.cameraControllerGamepad&&i&&this.cameraControllerGamepad.gamepadDevice!==i&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this.view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||F0.activatesFor(this.view,t.data)){if(!r){const s=new F0({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var kl;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(kl||(kl={}));class hZe extends Oo{constructor(t,i){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ve.Local},this.keyToNumber={[i.left]:kl.LEFT,[i.right]:kl.RIGHT,[i.forward]:kl.FORWARD,[i.backward]:kl.BACKWARD,[i.up]:kl.UP,[i.down]:kl.DOWN,[i.headingLeft]:kl.HEADINGLEFT,[i.headingRight]:kl.HEADINGRIGHT,[i.tiltUp]:kl.TILTUP,[i.tiltDown]:kl.TILTDOWN,[i.zoomIn]:kl.ZOOMIN,[i.zoomOut]:kl.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new F0({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class dZe extends Oo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new gF({view:this.view,mode:"interaction"}):new yF({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,Vr(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class xF{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let vv=class extends QO{constructor(e){super(e),this.view=null,this.beginCamera=new Qi,this.elapsedTimeSec=0,this.constraintOptions={selection:mr.ALL,interactionType:kt.PAN,interactionFactor:0,interactionStartCamera:new Qi,interactionDirection:null,tiltMode:On.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new y2}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),ls(this.view,t,this.constraintOptions)}};u([d({constructOnly:!0})],vv.prototype,"view",void 0),vv=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],vv);let DR=class extends vv{constructor(e){super(e),this.interactionType=kt.PAN,this.tmpPan=M()}momentumStep(e,t){const i=this.momentum.value(e);oe(this.tmpPan,this.momentum.direction,i),t.eye=pe(qre,t.eye,this.tmpPan),t.center=pe(qre,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};u([d({constructOnly:!0})],DR.prototype,"momentum",void 0),DR=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],DR);const qre=M(),pZe=M(),fI=M();let nL=class extends vv{constructor(e){super(e),this.interactionType=kt.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);se(fI,t.eye),we(fI,fI),lt(this.momentum.axis2,fI,this.momentum.axis1),o1e(t,pZe,this.momentum.axis1,i,this.momentum.axis2,r)}};u([d({constructOnly:!0})],nL.prototype,"momentum",void 0),nL=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],nL);let Q1=class extends vv{constructor(e){super(e),this.interactionType=kt.TUMBLE}set center(e){this._set("center",$s(e))}set axis(e){this._set("axis",$s(e))}momentumStep(e,t){const i=this.momentum.value(e);Uv(t,this.center,IO(this.axis,i))}};u([d({constructOnly:!0})],Q1.prototype,"momentum",void 0),u([d({constructOnly:!0})],Q1.prototype,"center",null),u([d({constructOnly:!0})],Q1.prototype,"axis",null),Q1=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Q1);let KT=class extends vv{constructor(e){super(e),this.interactionType=kt.ZOOM,this.constraintOptions.interactionDirection=M()}set zoomCenter(e){this._set("zoomCenter",$s(e))}momentumStep(e,t){se(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);LY(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=Vg(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([d({constructOnly:!0})],KT.prototype,"momentum",void 0),u([d({constructOnly:!0})],KT.prototype,"zoomCenter",null),KT=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],KT);let E1=class extends vv{constructor(e){super(e),this.interactionType=kt.ZOOM,this.radius=0,this.tmpSceneCenter=M(),this.tmpZoomAxisAngle=mE(),this.sphere=mn()}set screenCenter(e){this._set("screenCenter",Vr(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",$s(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);e1e(this.sphere,t,i),this.constraintOptions.interactionType=kt.ZOOM,ls(this.view,t,this.constraintOptions),JO(this.sphere,t,this.screenCenter,this.tmpSceneCenter),$O(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),Uv(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=kt.PAN}};u([d({constructOnly:!0})],E1.prototype,"momentum",void 0),u([d({constructOnly:!0})],E1.prototype,"screenCenter",null),u([d({constructOnly:!0})],E1.prototype,"sceneCenter",null),u([d({constructOnly:!0})],E1.prototype,"radius",void 0),E1=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],E1);class $d{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class q5{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class fZe extends q5{constructor(t,i,r,s,n){super(t,i,r),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class I1e{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new $d(.6),this.screen=[new $d(.4),new $d(.4)],this.scene=[new $d(.6),new $d(.6),new $d(.6)],this.tmpDirection=M()}add(t,i,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(i[0]),this.scene[1].update(i[1]),this.scene[2].update(i[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){te(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=Oe(this.tmpDirection);s>0&&oe(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new fZe(t,i,r,n,this.tmpDirection)}}class Wre{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const Xre=1e-5;class mZe extends q5{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class gZe{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.tmpAxis1=M(),this.tmpAxis2=M(),this.tmpAngles=tt(),this.time=new $d(.3),this.screen=[new $d(.4),new $d(.4)],this.angle1=new Wre(.6),this.angle2=new Wre(.6),this.axis1=M(),this.axis2=M(),this.lastScene=M()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let a=s1e(this.lastScene,i,this.tmpAxis2,s,n,o);this.angle2.update(0),Sa(this.tmpAxis2)<Xre?a=0:we(this.axis1,this.tmpAxis2),this.angle1.update(a),se(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;n1e(this.lastScene,i,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,o,a,!1),Sa(this.tmpAxis2)<Xre?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),we(this.axis1,this.tmpAxis1),we(this.axis2,this.tmpAxis2)),se(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new mZe(t,i,r,s,this.axis1,n,this.axis2)}}class $1e{constructor(t=2.5,i=.01,r=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=s,this.enabled=!0,this.value=new $d(.8),this.time=new $d(.3)}add(t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=De(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,i,r){return new q5(t,i,r)}}class D1e extends $1e{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){if(this.value.hasLastValue){const r=this.value.lastValue;let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class yZe extends q5{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class L1e extends $1e{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new yZe(t,i,r)}}let oL=class extends kv{constructor(e){super(e),this.view=null,this.smoothRotation=new xF(.05),this.rotationAxis=M(),this.panningPlane=_i(),this.smoothScaling=new xF(.05),this.zoomCenterScreen=Vr(),this.zoomMomentumEstimator=new L1e,this.rotationMomentumEstimator=new D1e,this.panSphericalMomentumEstimator=new gZe,this.panPlanarMomentumEstimator=new I1e,this.adjustedSphere=mn(),this.tmp3d=M(),this.tmpScreenPointArray=Vr(),this.beginScreenPoint=Vr(),this.beginScenePoint=M(),this.screenPickPoint=Vr(),this.navMode=Jn.Horizontal,this.tmpInteractionDirection=M(),this.constraintOptions={selection:mr.ALL,interactionType:kt.NONE,interactionFactor:0,interactionStartCamera:new Qi,interactionDirection:null,tiltMode:On.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-Av.normalize($t(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),tg(e.center,this.screenPickPoint),ro(this.beginScreenPoint,this.screenPickPoint);const i=wi(this.view.spatialReference),r=i1e(this.intersectionHelper,this.startCamera,this.screenPickPoint,i,I2.Silhouette);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,se(this.beginScenePoint,this.scenePickPoint),this.navMode=j5(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===Jn.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=Wo(this.tmp3d,this.startCamera.viewForward);a2(this.scenePickPoint,t,this.panningPlane);const i=Vr(this.screenPickPoint[0],0),r=M(),s=Oe(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],JO(this.adjustedSphere,this.startCamera,i,r);const n=wo();this.startCamera.projectToRenderScreen(r,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&a2(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=M(),c=M(),h=M(),p=80,f=5,m=50;pe(l,this.scenePickPoint,this.currentCamera.eye);const y=Oe(l);we(l,l);const v=f*Math.max(Math.abs(this.view.camera.position.z),m),w=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,p);let b=w?Math.min(w,v):v;b=a?Math.min(b,y):b,se(h,de(c,this.currentCamera.eye,oe(c,l,b))),this.panningPlane[3]=-xe(this.panningPlane,h),this.startCamera.center=de(c,this.startCamera.eye,oe(c,this.startCamera.viewForward,b));const S=tg(e.center,this.tmpScreenPointArray);gj(this.panningPlane,this.startCamera,S,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===Jn.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===Jn.Horizontal?new E1({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new KT({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Q1({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===Jn.Horizontal){const r=this.panSphericalMomentumEstimator.evaluateMomentum();if(r)return new nL({view:this.view,momentum:r})}else{const r=this.panPlanarMomentumEstimator.evaluateMomentum();if(r)return new DR({view:this.view,momentum:r})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),e1e(this.sphere,this.currentCamera,this.smoothScaling.value),tg(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=kt.ZOOM,this.constraintOptions.interactionFactor=Id(e.radius-this.beginRadius),ls(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=tg(e.center,this.tmpScreenPointArray);JO(this.sphere,this.currentCamera,t,this.tmp3d),NY(this.beginScenePoint,xe(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(l1e(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(a1e(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=kt.PAN,this.constraintOptions.interactionFactor=Id(this.screenPickPoint,t),ls(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){we(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||Wo(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+mj(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),Uv(this.currentCamera,this.sphere,IO(this.rotationAxis,s)),this.constraintOptions.interactionType=kt.TUMBLE,this.constraintOptions.interactionFactor=Id(e.radius*i),ls(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=tg(e.center,this.tmpScreenPointArray);gj(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(r1e(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=kt.PAN,this.constraintOptions.interactionFactor=Id(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),ls(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),LY(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=kt.ZOOM,this.constraintOptions.interactionFactor=Id(e.radius-this.beginRadius),ls(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){se(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||Wo(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=mj(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),Uv(this.currentCamera,this.sphere,IO(this.rotationAxis,n)),this.constraintOptions.interactionType=kt.TUMBLE,this.constraintOptions.interactionFactor=Id(e.radius*n),ls(this.view,this.currentCamera,this.constraintOptions)}};u([d({constructOnly:!0})],oL.prototype,"view",void 0),oL=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],oL);const Yre=Ue(0,0,1),vZe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},_Ze=80;let aL=class extends kv{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new xF(.05),this.scalingValueSmooth=new xF(.05),this.planeHorizontal=_i(),this.planeVertical=_i(),this.rotationMomentumEstimator=new D1e,this.panMomentumEstimator=new I1e(300,12,.9),this.zoomMomentumEstimator=new L1e,this.beginCenter=M(),this.tmpPoints=[],this.beginCenterScreen=Vr(),this.tmpCentroid3d=M(),this.tmpCentroid2d=Vr(),this.tmp2d=Vr(),this.constraintOptions={selection:mr.ALL,interactionType:kt.NONE,interactionFactor:0,interactionStartCamera:new Qi,interactionDirection:null,tiltMode:On.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),tg(e.center,this.beginCenterScreen),Tfe(Yre,0,this.planeHorizontal);const i=M(),r=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i),s=M();Wo(s,this.startCamera.viewForward);const n=M();se(n,Yre);const o=xe(s,n),a=rp(o<0?-o:o);if(this.panMode=a>=vZe.ANGLE_THRESHOLD?Jn.Horizontal:Jn.Vertical,Y9(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||Z9(this.planeHorizontal,this.planeHorizontal),this.panMode===Jn.Vertical){oe(n,n,o),pe(this.planeVertical,s,n),we(this.planeVertical,this.planeVertical),Y9(this.planeVertical,this.planeVertical,i);const l=M(),c=M(),h=M();pe(l,i,this.currentCamera.eye);const p=Oe(l);we(l,l);const f=5*Math.max(Math.abs(this.view.camera.position.z),50),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,_Ze);let y=m?Math.min(m,f):f;y=r?Math.min(y,p):y,se(h,de(c,this.currentCamera.eye,oe(c,l,y))),this.planeVertical[3]=-xe(this.planeVertical,h),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),gz(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),gz(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===Jn.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),LY(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=kt.ZOOM,this.constraintOptions.interactionFactor=Id(Math.abs(e.radius-this.beginRadius)),ls(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),gz(this.tmpPoints,this.tmpCentroid3d),tg(e.center,this.tmpCentroid2d),r1e(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=kt.PAN,this.constraintOptions.interactionFactor=Id(this.beginCenterScreen,this.tmpCentroid2d),ls(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=r,o=this.rotationValueSmooth.value,a=o+mj(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(a);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),Uv(this.currentCamera,n,IO(s,c)),this.constraintOptions.interactionType=kt.TUMBLE,this.constraintOptions.interactionFactor=Id(Math.abs(e.radius*c)),ls(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new KT({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Q1({view:this.view,momentum:i,center:this.beginCenter,axis:this.planeHorizontal});const r=this.panMomentumEstimator.evaluateMomentum();return r?new DR({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=M()),gj(t,i,s,r[n]),n+=1}),r}};u([d({constructOnly:!0})],aL.prototype,"view",void 0),aL=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],aL);class Zre extends Oo{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!UY(t.data,this.pointerAction))return;const i=t.timestamp-this.lastEndTimestamp,r=40,s=this.momentum&&this.momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const r=this.controller.end(t.data);i&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new oL({view:this.view}):new aL({view:this.view})}}class bZe extends Oo{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class N1e extends Oo{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class wZe extends N1e{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class xZe extends N1e{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class TZe extends Oo{constructor(t,i=!1){super(!0),this.view=t,this.invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var s,n,o;const i=this.invert?-1:1,r=Vr(0,t.data.delta*i);switch(t.data.action){case"begin":(s=this.cameraController)==null||s.end(),this.cameraController=new JT({view:this.view,pivot:Hl.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":(n=this.cameraController)==null||n.update(r);break;case"end":(o=this.cameraController)==null||o.end(),this.cameraController=null}}}function Qre(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>CZe(i,e.axisThreshold))}:{buttons:[],axes:[]}}function SZe(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function EZe(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function CZe(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class AZe{constructor(t,i){this.element=t,this.input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this.inputDevices[a];l&&(this._emitGamepadEvent(o,Qre(l),!1),this.inputDevices.splice(a,1),this.latestUpdate.splice(a,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const i=new VX(t);i.deviceType!=="unknown"&&(this.inputDevices[t.index]=i,this.input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=Lb({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this.element.contains(document.activeElement),r=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const o=this.latestUpdate[s.index],a=Qre(n),l=r||EZe(a);o&&(o.timestamp===s.timestamp||!o.active&&l||SZe(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this.callback&&this.callback({device:this.inputDevices[t.index],state:i,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const Jre=he("trident"),Kre=he("edge"),RZe=he("chrome"),OZe=he("ff"),MZe=he("safari"),nx={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class W5{constructor(t,i){this.input=i,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new AZe(t,this.input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener(Ez[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&Ez[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(Ez[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?nx.touchNone:nx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?nx.touchPan:nx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(nx.touchNone),this._element.classList.remove(nx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=dve(this._element,t);return W5.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=XVe(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:(Jre||Kre)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}Jre||Kre?r*=.7:RZe||MZe?r*=.6:OZe&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,o)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}W5.test={disableSubpixelCoordinates:!1};const Ez={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class PZe extends Oo{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function F1e(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function IZe(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function $Ze(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:sp()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[T,E]=e,[C,O]=[E.x-T.x,E.y-T.y];return t.radius=Math.sqrt(C*C+O*O)/2,t.center.x=(T.x+E.x)/2,t.center.y=(T.y+E.y)/2,t}let i=0,r=0;for(let T=0;T<e.length;T++)i+=e[T].x,r+=e[T].y;i/=e.length,r/=e.length;const s=e.map(T=>T.x-i),n=e.map(T=>T.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<s.length;T++){const E=s[T],C=n[T],O=E*E,I=C*C;o+=O,a+=I,l+=E*C,c+=O*E,h+=I*C,p+=E*I,f+=C*O}const m=.5*(c+p),y=.5*(h+f),v=o*a-l*l,w=(m*a-y*l)/v,b=(o*y-l*m)/v,S=sp(w+i,b+r);return{radius:Math.sqrt(w*w+b*b+(o+a)/e.length),center:S}}class DZe extends Oo{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:i.buttons,timestamp:s,pointers:LZe(this.activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=mI(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(i,s);const n=lL(s,U1e(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this.activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=mI(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=mI(this.activePointerMap);this.activePointerMap.forEach(r=>{r.initialAngle=lL(r,i)-t,r.lastAngle=lL(r,i)-t})}_emitEvent(t,i,r){const s=mI(this.activePointerMap);this.drag.emit(this._createPayload(t,i,s,r),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this.activePointerMap.get(i)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this.isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(r),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function U1e(e){const t=[];return e.forEach(i=>{t.push(sp(i.event.x,i.event.y))}),$Ze(t)}function mI(e){const t=U1e(e);let i=0;return e.forEach(r=>{let s=lL(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function LZe(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function lL(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var ese;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(ese||(ese={}));const sv={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class NZe extends Oo{constructor(t=sv.maximumDoubleClickDelay,i=sv.maximumDoubleClickDistance,r=sv.maximumDoubleTouchDelay,s=sv.maximumDoubleTouchDistance,n=d4){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=Js(t.doubleClickTimeout))}get hasPendingInputs(){return Ws(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_handleImmediateClick(t){const i=t.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s){const n=i.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;F1e(s.event.data,i)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(t)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const i=this._pointerId(t.data),r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(i,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(i),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const i=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(i,!0)}_handleDrag(t){const i=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(i,!0)}_clearDoubleClickTimeout(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,i&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class FZe extends Oo{constructor(t=sv.maximumDoubleClickDelay,i=sv.maximumDoubleClickDistance,r=sv.maximumDoubleTouchDelay,s=sv.maximumDoubleTouchDistance,n=d4){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=this._pointerId(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerLoss(t,i){const r=t.data,s=this._pointerId(r),n=this._pointerState.get(s);if(n&&i==="pointer-up"&&n.downButton===r.native.button){const o=n.immediateDoubleClick;if(o){o.timeoutHandle.remove();const a=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;F1e(o,t.data)>a?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,o.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_removeState(t){const i=this._pointerId(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const rC={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class UZe extends Oo{constructor(t=rC.maximumClickDelay,i=rC.movementUntilMouseDrag,r=rC.movementUntilPenDrag,s=rC.movementUntilTouchDrag,n=rC.holdDelay,o=d4){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):IZe(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class kZe{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this.currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class zZe extends Oo{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new kZe({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this.dragEventSeparator.handle(r))}get failed(){return this.state==="failed"}_observeStart(t,i){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;i.pointers.forEach(v=>{r=Math.max(r,v.x),s=Math.min(s,v.x),n=Math.max(n,v.y),o=Math.min(o,v.y)});let a=-1/0,l=1/0,c=-1/0,h=1/0;t.pointers.forEach(v=>{a=Math.max(a,v.x),l=Math.min(l,v.x),c=Math.max(c,v.y),h=Math.min(h,v.y)});const p=r-s,f=n-o,m=a-l,y=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}}let qp=class extends Ee{constructor(){super(...arguments),this._handles=new Ht}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new W5(this.view.surface,e.input);const t=[new FZe,new UZe,new NZe,new DZe(this.view.navigation),new zZe],i=new o0({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new PZe],fv.INTERNAL),this._modeDragPan=new Zre(e,"primary"),this._modeDragRotate=new wz(e,"secondary",Hl.CENTER),this._modeDragZoom=new RYe(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new bZe(e),new SYe(e),new uZe(e),new hZe(e,r.pan),new dZe(e),new xZe(e,r.resetTilt),new wZe(e,r.resetHeading),new wz(e,"primary",Hl.EYE,[r.lookAround]),new wz(e,"secondary",Hl.CENTER,[r.lookAround]),new Zre(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new TZe(e)],fv.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ae(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Ft))}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=_j.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],qp.prototype,"view",void 0),u([d({value:"pan"})],qp.prototype,"primaryDragAction",null),u([d({value:"default"})],qp.prototype,"mode",null),u([d({readOnly:!0})],qp.prototype,"hasPendingInputs",null),u([d()],qp.prototype,"latestPointerType",null),u([d()],qp.prototype,"latestPointerLocation",null),u([d()],qp.prototype,"_inputManager",void 0),qp=u([P("esri.views.3d.input.SceneInputManager")],qp);const _j=new Map,Cz=new Map,Az=new Map;Cz.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Cz.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),Az.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),Az.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),_j.set("default",Cz),_j.set("pro",Az);const BZe=qp;let rs=class extends Ee{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],rs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],rs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],rs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],rs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],rs.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],rs.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],rs.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],rs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],rs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],rs.prototype,"SHOW_POI",void 0),u([d()],rs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],rs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],rs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],rs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],rs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],rs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],rs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],rs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],rs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],rs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],rs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],rs.prototype,"LINE_WIREFRAMES",void 0),rs=u([P("esri.views.3d.support.DebugFlags")],rs);const Gi=new rs;let qc,TS,bj=!1,wj=!1,xj=!1,Tj=!1,LR=null;function VZe(e,t){if(!wj||!TS)return;k1e();const i=TS;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),z1e(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function GZe(e){xj=Gi.DECONFLICTOR_SHOW_VISIBLE,Tj=Gi.DECONFLICTOR_SHOW_INVISIBLE,bj=xj||Tj,wj=Gi.DECONFLICTOR_SHOW_GRID,LR=null,bj||wj?LR=()=>jZe(e):qc&&(qc.parentElement.removeChild(qc),qc=null)}function k1e(){LR&&(LR(),LR=null)}function jZe(e){qc==null&&(qc=document.createElement("canvas"),qc.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(qc));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;qc.setAttribute("width",`${o}px`),qc.setAttribute("height",`${a}px`),qc.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),TS=qc.getContext("2d"),TS.clearRect(0,0,s,n),TS.font="12px Arial"}function z1e(e,t,i,r,s){k1e();const n=qc.height,o=TS;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function HZe(e,t){bj&&(t&&xj||!t&&Tj)&&z1e(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Yn,nu;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(Yn||(Yn={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(nu||(nu={}));function B1e(e,t){return new X5(e,H1e,t)}function qZe(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=H1e;return new X5(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:Rz.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:Rz.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:Rz.minPixelSize},t)}function WZe(e){return Math.abs(e*e*e)}function V1e(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return sC.scale=Math.min(r.divisor/(t-r.offset),1),sC.factor=WZe(e),sC.minPixelSize=r.minPixelSize,sC.paddingPixels=s,sC}function G1e(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function VY(e,t){return Math.max(qt(e*t.scale,e,t.factor),G1e(e,t))}function XZe(e,t,i){const r=V1e(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,VY(1,r)}function tse(e,t,i,r){r.scale=XZe(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function j1e(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,G1e(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function YZe(e,t,i,r){return VY(e,V1e(t,i,r))}class X5{constructor(t,i,r,s=ZZe(),n){this.viewingMode=t,this.description=i,this.ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===Ve.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new X5(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this.description,{fovY:a,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,i),h=this.coverageCompensation(t,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),v=m/Math.cos(y),w=y+a*n*h,b=(v-f*(m/Math.cos(w)))/(1-f);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=b,r.divisor=v-b,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(t,i,r=ise){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=ise){const s=this.description.curvatureDependent,n=1+t.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=De((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=qt(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=qt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}}const H1e={curvatureDependent:{min:{curvature:$t(10),tiltAngle:$t(12),scaleFallOffFactor:.5},max:{curvature:$t(70),tiltAngle:$t(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},Rz={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function ZZe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const sC={scale:0,factor:0,minPixelSize:0,paddingPixels:0},ise={tiltAngle:0,scaleFallOffFactor:0};function QZe(e){return e instanceof Float32Array&&e.length>=16}function JZe(e){return Array.isArray(e)&&e.length>=16}function KZe(e){return QZe(e)||JZe(e)}var J;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(J||(J={}));function GY(e){e.vertex.code.add(x`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(x`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(x`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(x`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(x`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(x`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(x`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function eQe(e){e.uniforms.add(new ti("screenSizePerspective",t=>q1e(t.screenSizePerspective)))}function Y5(e){e.uniforms.add(new ti("screenSizePerspectiveAlignment",t=>q1e(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function q1e(e){return Xi(tQe,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const tQe=Gt();class Sj extends Hr{constructor(t,i){super(t,"mat4",Li.Draw,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}function Ff(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",Aa):e.uniforms.add(new Oa("cameraPosition",(i,r)=>te(W1e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function mu(e,t){if(e.vertex.uniforms.add(new yr("proj",(r,s)=>s.camera.projectionMatrix)),t.instancedDoublePrecision){const r=(n,o)=>te(W1e,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new yr("view",(n,o)=>Ia(rse,o.camera.viewMatrix,r(n,o))));const s=new xt("localOrigin",r);return e.vertex.uniforms.add(s),s}e.vertex.uniforms.add(new Sj("view",(r,s)=>Ia(rse,s.camera.viewMatrix,r.origin)));const i=new Oa("localOrigin",r=>r.origin);return e.vertex.uniforms.add(i),i}const rse=VM(),W1e=M();function X1e(e,t){const i=e.vertex;t.hasVerticalOffset?(Y1e(i),t.hasScreenSizePerspective&&(e.include(GY),Y5(i),Ff(e.vertex,t)),i.code.add(x`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?x`vec3 worldNormal = normalize(worldPos + localOrigin);`:x`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?x`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:x`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(x`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const iQe=Gt();function Y1e(e){e.uniforms.add(new ti("verticalOffset",(t,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Xi(iQe,n*a,o,r,s)}))}var oh;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(oh||(oh={}));var al;function Z1e(e,t){e.include(GY),e.attributes.add(R.POSITION,"vec3"),e.attributes.add(R.NORMAL,"vec3"),e.attributes.add(R.AUXPOS1,"vec4");const i=e.vertex;mu(e,t),Ff(i,t),i.uniforms.add([new ti("viewport",(r,s)=>s.camera.fullViewport),new We("polygonOffset",r=>r.shaderPolygonOffset),new We("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new We("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===oh.Occluded?1:s.renderTransparentlyOccludedHUD===oh.NotOccluded?0:.75),new zt("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&Y1e(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(x`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(x`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new yr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),t.isDraped||(i.uniforms.add(new We("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(x`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===al.Screen&&i.uniforms.add(new We("pixelRatio",(r,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&Y5(i),i.code.add(x`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===al.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?x`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==al.Screen?x`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===al.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===al.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(x`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(al||(al={}));const gI=Ls();function Z5(e,t,i,r,s,n,o){if(!t3(t))if(e.boundingInfo){dt(e.primitiveType===ml.Triangle);const a=i.tolerance;Q1e(e.boundingInfo,r,s,a,n,o)}else{const a=e.indices.get(R.POSITION),l=e.vertexAttributes.get(R.POSITION);s3(r,s,0,a.length/3,a,l,void 0,n,o)}}const rQe=M();function Q1e(e,t,i,r,s,n){if(A(e))return;const o=K1e(t,i,rQe);if(bhe(gI,e.getBBMin()),whe(gI,e.getBBMax()),_(s)&&s.applyToAabb(gI),HY(gI,t,o,r)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>lQe){const p=e.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&Q1e(p[f],t,i,r,s,n);return}}s3(t,i,0,h,l,c,a,s,n)}}const J1e=M();function s3(e,t,i,r,s,n,o,a,l){if(o)return sQe(e,t,i,r,s,n,o,a,l);const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],y=t[0]-p,v=t[1]-f,w=t[2]-m;for(let b=i,S=3*i;b<r;++b){let T=h*s[S++],E=c[T++],C=c[T++],O=c[T];T=h*s[S++];let I=c[T++],N=c[T++],D=c[T];T=h*s[S++];let z=c[T++],B=c[T++],k=c[T];_(a)&&([E,C,O]=a.applyToVertex(E,C,O,b),[I,N,D]=a.applyToVertex(I,N,D,b),[z,B,k]=a.applyToVertex(z,B,k,b));const Y=I-E,Z=N-C,le=D-O,ne=z-E,$=B-C,U=k-O,V=v*U-$*w,q=w*ne-U*y,W=y*$-ne*v,K=Y*V+Z*q+le*W;if(Math.abs(K)<=Number.EPSILON)continue;const j=p-E,ee=f-C,ge=m-O,Te=j*V+ee*q+ge*W;if(K>0){if(Te<0||Te>K)continue}else if(Te>0||Te<K)continue;const Fe=ee*le-Z*ge,_e=ge*Y-le*j,me=j*Z-Y*ee,Ce=y*Fe+v*_e+w*me;if(K>0){if(Ce<0||Te+Ce>K)continue}else if(Ce>0||Te+Ce<K)continue;const Ne=(ne*Fe+$*_e+U*me)/K;Ne>=0&&l(Ne,jY(Y,Z,le,ne,$,U,J1e),b,!1)}}function sQe(e,t,i,r,s,n,o,a,l){const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],y=t[0]-p,v=t[1]-f,w=t[2]-m;for(let b=i;b<r;++b){const S=o[b];let T=3*S,E=h*s[T++],C=c[E++],O=c[E++],I=c[E];E=h*s[T++];let N=c[E++],D=c[E++],z=c[E];E=h*s[T];let B=c[E++],k=c[E++],Y=c[E];_(a)&&([C,O,I]=a.applyToVertex(C,O,I,b),[N,D,z]=a.applyToVertex(N,D,z,b),[B,k,Y]=a.applyToVertex(B,k,Y,b));const Z=N-C,le=D-O,ne=z-I,$=B-C,U=k-O,V=Y-I,q=v*V-U*w,W=w*$-V*y,K=y*U-$*v,j=Z*q+le*W+ne*K;if(Math.abs(j)<=Number.EPSILON)continue;const ee=p-C,ge=f-O,Te=m-I,Fe=ee*q+ge*W+Te*K;if(j>0){if(Fe<0||Fe>j)continue}else if(Fe>0||Fe<j)continue;const _e=ge*ne-le*Te,me=Te*Z-ne*ee,Ce=ee*le-Z*ge,Ne=y*_e+v*me+w*Ce;if(j>0){if(Ne<0||Fe+Ne>j)continue}else if(Ne>0||Fe+Ne<j)continue;const Mi=($*_e+U*me+V*Ce)/j;Mi>=0&&l(Mi,jY(Z,le,ne,$,U,V,J1e),S,!1)}}const sse=M(),nse=M();function jY(e,t,i,r,s,n,o){return te(sse,e,t,i),te(nse,r,s,n),lt(o,sse,nse),we(o,o),o}function K1e(e,t,i){return te(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function HY(e,t,i,r){return qY(e,t,i,r,1/0)}function qY(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-r-t[2])*i[2],f=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function ebe(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;_(s)&&(n=YZe(n,r,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return De(o*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function tbe(e,t){const i=t?tbe(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=aQe(s)),s==null&&r in i||(i[r]=s)}return i}function nQe(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?e[r]===null?(e[r]=s.slice(),i=!0):RH(e[r],s)&&(i=!0):e[r]!==s&&(i=!0,e[r]=s))}return i}function oQe(e,t,i,r,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(R.POSITION).data,a=e.vertexAttributes.get(R.SIZE),l=a&&a.data[0],c=r[0],h=r[1],p=((l+s)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],w=o[y+1],b=c-v,S=h-w,T=o[y+3]-v,E=o[y+4]-w,C=De((T*b+E*S)/(T*T+E*E),0,1),O=T*C-b,I=E*C-S,N=O*O+I*I;N<f&&(f=N,m=y/3)}f<p*p&&n(i.dist,i.normal,m,!1)}function aQe(e){const t=[];return e.forEach(i=>t.push(i)),t}const ibe={multiply:1,ignore:2,replace:3,tint:4},lQe=1e3;class Qf extends e3{constructor(t,i){super(),this.type=cp.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Ni,this._parameters=tbe(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,i=!0){nQe(this._parameters,t)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){_(this.repository)&&this.repository.materialChanged(this)}}var Or;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(Or||(Or={}));class wE extends Us{constructor(){super(...arguments),this.renderOccluded=Or.Occlude}}function Vbt(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=t[e[l]],r+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function cQe(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const l=2*e[a];s[r]=t[l],s[r+1]=t[l+1],r+=n}}function rbe(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}}function D2(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}}function Q5(e,t,i,r,s,n=1){if(!i)return void rbe(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,c=i[0],h=i[1],p=i[2],f=i[4],m=i[5],y=i[6],v=i[8],w=i[9],b=i[10],S=i[12],T=i[13],E=i[14];if(s*=a,n===1)for(let C=0;C<l;++C){const O=3*e[C],I=t[O],N=t[O+1],D=t[O+2];o[s]=c*I+f*N+v*D+S,o[s+1]=h*I+m*N+w*D+T,o[s+2]=p*I+y*N+b*D+E,s+=a}else for(let C=0;C<l;++C){const O=3*e[C],I=t[O],N=t[O+1],D=t[O+2],z=c*I+f*N+v*D+S,B=h*I+m*N+w*D+T,k=p*I+y*N+b*D+E;for(let Y=0;Y<n;++Y)o[s]=z,o[s+1]=B,o[s+2]=k,s+=a}}function WY(e,t,i,r,s,n=1){if(!i)return void rbe(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],v=o[6],w=o[8],b=o[9],S=o[10],T=!sW(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let O=0;O<c;++O){const I=3*e[O],N=t[I],D=t[I+1],z=t[I+2];let B=h*N+m*D+w*z,k=p*N+y*D+b*z,Y=f*N+v*D+S*z;if(T){const Z=B*B+k*k+Y*Y;if(Z<C&&Z>E){const le=1/Math.sqrt(Z);B*=le,k*=le,Y*=le}}a[s+0]=B,a[s+1]=k,a[s+2]=Y,s+=l}else for(let O=0;O<c;++O){const I=3*e[O],N=t[I],D=t[I+1],z=t[I+2];let B=h*N+m*D+w*z,k=p*N+y*D+b*z,Y=f*N+v*D+S*z;if(T){const Z=B*B+k*k+Y*Y;if(Z<C&&Z>E){const le=1/Math.sqrt(Z);B*=le,k*=le,Y*=le}}for(let Z=0;Z<n;++Z)a[s+0]=B,a[s+1]=k,a[s+2]=Y,s+=l}}function uQe(e,t,i,r,s,n=1){if(!i)return void D2(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],v=o[6],w=o[8],b=o[9],S=o[10],T=!sW(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let O=0;O<c;++O){const I=4*e[O],N=t[I],D=t[I+1],z=t[I+2],B=t[I+3];let k=h*N+m*D+w*z,Y=p*N+y*D+b*z,Z=f*N+v*D+S*z;if(T){const le=k*k+Y*Y+Z*Z;if(le<C&&le>E){const ne=1/Math.sqrt(le);k*=ne,Y*=ne,Z*=ne}}a[s+0]=k,a[s+1]=Y,a[s+2]=Z,a[s+3]=B,s+=l}else for(let O=0;O<c;++O){const I=4*e[O],N=t[I],D=t[I+1],z=t[I+2],B=t[I+3];let k=h*N+m*D+w*z,Y=p*N+y*D+b*z,Z=f*N+v*D+S*z;if(T){const le=k*k+Y*Y+Z*Z;if(le<C&&le>E){const ne=1/Math.sqrt(le);k*=ne,Y*=ne,Z*=ne}}for(let le=0;le<n;++le)a[s+0]=k,a[s+1]=Y,a[s+2]=Z,a[s+3]=B,s+=l}}function TF(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,n===1){if(i===4)for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else if(i===4)for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}function J5(e,t,i,r,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case R.POSITION:{dt(a.size===3);const c=s.getField(o,ji);c&&Q5(l,a.data,i,c,n);break}case R.NORMAL:{dt(a.size===3);const c=s.getField(o,ji);c&&WY(l,a.data,r,c,n);break}case R.UV0:{dt(a.size===2);const c=s.getField(o,Dh);c&&cQe(l,a.data,c,n);break}case R.COLOR:{dt(a.size===3||a.size===4);const c=s.getField(o,xl);c&&TF(l,a.data,a.size,c,n);break}case R.SYMBOLCOLOR:{dt(a.size===3||a.size===4);const c=s.getField(o,xl);c&&TF(l,a.data,a.size,c,n);break}case R.TANGENT:{dt(a.size===4);const c=s.getField(o,In);c&&uQe(l,a.data,r,c,n);break}}}}function eM(e,t,i=0){const r=De(e,0,pQe);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*fQe(r*hQe[s]))}function XY(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*dQe[r];return i}const hQe=[1,256,65536,16777216],dQe=[1/256,1/65536,1/16777216,1/4294967296],pQe=XY(new Uint8ClampedArray([255,255,255,255]));function fQe(e){return e-Math.floor(e)}function mQe(){if(A(Oz)){const e=t=>Pi(`esri/libs/basisu/${t}`);Oz=import("./basis_transcoder.50353ba0.js").then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return Oz}let Oz;var J1;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(J1||(J1={}));let Qd=null,yI=null;async function sbe(){return A(yI)&&(yI=mQe(),Qd=await yI),yI}function gQe(e,t){if(A(Qd))return e.byteLength;const i=new Qd.BasisFile(new Uint8Array(e)),r=obe(i)?nbe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function yQe(e,t){if(A(Qd))return e.byteLength;const i=new Qd.KTX2File(new Uint8Array(e)),r=abe(i)?nbe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function nbe(e,t,i,r,s){const n=jve(t?Yr.COMPRESSED_RGBA8_ETC2_EAC:Yr.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function obe(e){return e.getNumImages()>=1&&!e.isUASTC()}function abe(e){return e.getFaces()>=1&&e.isETC1S()}async function vQe(e,t,i){A(Qd)&&(Qd=await sbe());const r=new Qd.BasisFile(new Uint8Array(i));if(!obe(r))return null;r.startTranscoding();const s=lbe(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function _Qe(e,t,i){A(Qd)&&(Qd=await sbe());const r=new Qd.KTX2File(new Uint8Array(i));if(!abe(r))return null;r.startTranscoding();const s=lbe(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function lbe(e,t,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?r?[J1.ETC2_RGBA,Yr.COMPRESSED_RGBA8_ETC2_EAC]:[J1.ETC1_RGB,Yr.COMPRESSED_RGB8_ETC2]:c?r?[J1.BC3_RGBA,Yr.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[J1.BC1_RGB,Yr.COMPRESSED_RGB_S3TC_DXT1_EXT]:[J1.RGBA32,ze.RGBA],f=t.hasMipmap?i:Math.min(1,i),m=[];for(let b=0;b<f;b++)m.push(new Uint8Array(o(b,h))),a(b,h,m[b]);const y=m.length>1,v=y?Je.LINEAR_MIPMAP_LINEAR:Je.LINEAR,w=ve(F({},t),{samplingMode:v,hasMipmap:y,internalFormat:p,width:s,height:n});return new st(e,w,{type:"compressed",levels:m})}const nC=fe.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),bQe=542327876,wQe=131072,xQe=4;function YY(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function TQe(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const SQe=YY("DXT1"),EQe=YY("DXT3"),CQe=YY("DXT5"),AQe=31,RQe=0,OQe=1,MQe=2,PQe=3,IQe=4,$Qe=7,DQe=20,LQe=21;function NQe(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=FQe(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?Je.LINEAR_MIPMAP_LINEAR:Je.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new st(e,t,r)}function FQe(e,t){const i=new Int32Array(e,0,AQe);if(i[RQe]!==bQe)return nC.error("Invalid magic number in DDS header"),null;if(!(i[DQe]&xQe))return nC.error("Unsupported format, must contain a FourCC code"),null;const r=i[LQe];let s,n;switch(r){case SQe:s=8,n=Yr.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case EQe:s=16,n=Yr.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case CQe:s=16,n=Yr.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return nC.error("Unsupported FourCC code:",TQe(r)),null}let o=1,a=i[IQe],l=i[PQe];(3&a)==0&&(3&l)==0||(nC.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[MQe]&wQe&&t!==!1&&(o=Math.max(1,i[$Qe])),o===1||jS(a)&&jS(l)||(nC.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[OQe]+4;const y=[];for(let v=0;v<o;++v)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}class Rs extends e3{constructor(t,i){super(),this.data=t,this.type=cp.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new Kr,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:bt.REPEAT,t:bt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||mv.STRETCH,this.estimatedTexMemRequired=Rs._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;A(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(Tv(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const i=!t.paused;if(t.src=t.src,i&&t.autoplay){const r=()=>{t.removeEventListener("canplay",r),t.play()};t.addEventListener("canplay",r)}}}_startPreloadImageElement(t){Gf(t.src)||Tv(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(A(t))return 0;if(EE(t)||F1(t))return i.encoding===Rs.KTX2_ENCODING?yQe(t,i.mipmap):i.encoding===Rs.BASIS_ENCODING?gQe(t,i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Rs._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?Je.LINEAR_MIPMAP_LINEAR:Je.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(_(this._glTexture))return this._glTexture;if(_(this._loadingPromise))return this._loadingPromise;const r=this.data;return A(r)?(this._glTexture=new st(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):(EE(r)||F1(r))&&this.params.encoding===Rs.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):(EE(r)||F1(r))&&this.params.encoding===Rs.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):(EE(r)||F1(r))&&this.params.encoding===Rs.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):F1(r)?this._loadFromPixelData(t,r):EE(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this.data instanceof HTMLVideoElement)||A(this._glTexture)||this.data.readyState<NR.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(_(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this.data),this._drawStretchedTexture(t,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this.data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(t,i){return this._glTexture=NQe(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>_Qe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>vQe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){dt(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?ze.LUMINANCE:this.params.components===3?ze.RGB:ze.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new st(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await ap(r,{signal:s});return hi(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await Whe(r,r.src,!1,s);return hi(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=NR.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),Js(h)},l=()=>{r.readyState>=NR.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,r,i)))},c=p=>{a(),o(p||new H("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=Yo(s,()=>c(di()))}))}_loadFromImage(t,i,r){const s=Rs._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?ze.RGB:ze.RGBA,!this._requiresPowerOfTwo(t,n)||jS(s.width)&&jS(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new st(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=bt.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return!An(t.gl)&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:o,height:a}=r,l=GS(o),c=GS(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case mv.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new st(t,s),h.updateData(0,0,0,o,a,i);break;case mv.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,i,r,s){const n=new st(t,r),o=new wr(t,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},n),a=new st(t,{target:pt.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=La(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,i,r,s,n,o){t.bindFramebuffer(r);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height);const l=t.bindTechnique(i);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",n),t.bindVAO(s),t.drawArrays(Pt.TRIANGLE_STRIP,0,xo(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height)}unload(){if(_(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(_(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),_(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var NR;Rs.DDS_ENCODING="image/vnd-ms.dds",Rs.KTX2_ENCODING="image/ktx2",Rs.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(NR||(NR={}));const tM=128,ZY=.5;function cbe(e,t=tM,i=t*ZY,r=0){const s=UQe(e,t,i,r);return new Rs(s,{mipmap:!1,wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function UQe(e,t=tM,i=t*ZY,r=0){switch(e){case"circle":default:return kQe(t,i);case"square":return zQe(t,i);case"cross":return VQe(t,i,r);case"x":return GQe(t,i,r);case"kite":return BQe(t,i);case"triangle":return jQe(t,i);case"arrow":return HQe(t,i)}}function kQe(e,t){const i=e/2-.5;return n3(e,dbe(i,i,t/2))}function zQe(e,t){return ube(e,t,!1)}function BQe(e,t){return ube(e,t,!0)}function VQe(e,t,i=0){return hbe(e,t,!1,i)}function GQe(e,t,i=0){return hbe(e,t,!0,i)}function jQe(e,t){return n3(e,pbe(e/2,t,t/2))}function HQe(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=dbe(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=pbe(s,i,r);return n3(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function ube(e,t,i){return i&&(t/=Math.SQRT2),n3(e,(r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function hbe(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return n3(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function dbe(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function pbe(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function n3(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let o=t(s,r);o=o/e+.5,eM(o,i,4*n)}return i}class Gbt extends Us{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function qQe(e,t){fbe(e,t,[new xt("slicePlaneOrigin",(i,r)=>vbe(t,i,r)),new xt("slicePlaneBasis1",(i,r)=>{var s;return SF(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new xt("slicePlaneBasis2",(i,r)=>{var s;return SF(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function cs(e,t){fbe(e,t,[new Oa("slicePlaneOrigin",(i,r)=>vbe(t,i,r)),new Oa("slicePlaneBasis1",(i,r)=>{var s;return SF(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Oa("slicePlaneBasis2",(i,r)=>{var s;return SF(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function fbe(e,t,i){if(!t.hasSlicePlane){const o=x`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=x`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=x`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?x`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:x`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function mbe(e,t,i){return e.instancedDoublePrecision?te(WQe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function gbe(e,t){return _(e)?pe(EF,t.origin,e):t.origin}function ybe(e,t,i){return e.hasSliceTranslatedView?_(t)?Ia(XQe,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function vbe(e,t,i){if(A(i.slicePlane))return Aa;const r=mbe(e,t,i),s=gbe(r,i.slicePlane),n=ybe(e,r,i);return _(n)?ke(EF,s,n):s}function SF(e,t,i,r){if(A(r)||A(i.slicePlane))return Aa;const s=mbe(e,t,i),n=gbe(s,i.slicePlane),o=ybe(e,s,i);return _(o)?(de(oC,r,n),ke(EF,n,o),ke(oC,oC,o),pe(oC,oC,EF)):r}const WQe=M(),EF=M(),oC=M(),XQe=Ae();function YQe(e,t){const{vertex:i,fragment:r}=e;t.hasMultipassGeometry&&i.include(y_e),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(x`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?x`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&r.include(Tu),t.hasMultipassTerrain&&r.uniforms.add([new zt("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new fi("nearFar",(s,n)=>n.camera.nearFar),new fi("inverseViewport",(s,n)=>n.inverseViewport)]),r.include(yc),r.code.add(x`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?x`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const ZQe=gi(1,1,0,1),_be=gi(1,0,1,1);function Kg(e){e.fragment.uniforms.add(new zt("depthTex",(t,i)=>i.highlightDepthTexture)),e.fragment.uniforms.add(new fi("highlightViewportPixelSz",(t,i)=>i.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",ZQe).add("unoccludedHighlightFlag","vec4",_be),e.fragment.code.add(x`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class K5 extends Hr{constructor(t,i,r){super(t,"vec4",Li.Pass,(s,n,o)=>s.setUniform4fv(t,i(n,o)),r)}}class Ho extends Hr{constructor(t,i,r){super(t,"float",Li.Pass,(s,n,o)=>s.setUniform1fv(t,i(n,o)),r)}}class o3 extends Hr{constructor(t,i){super(t,"mat3",Li.Pass,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class QY extends wE{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ue(1,1,1),this.vvSizeMaxSize=Ue(100,100,100),this.vvSizeOffset=Ue(0,0,0),this.vvSizeFactor=Ue(1,1,1),this.vvSizeValue=Ue(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Sr()}}const Jd=8;function SS(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(R.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new xt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new xt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new xt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new xt("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new o3("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new xt("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(x`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(x`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?x`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(x`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",Jd),t.hasVvInstancing&&i.uniforms.add([new Ho("vvColorValues",r=>r.vvColorValues,Jd),new K5("vvColorColors",r=>r.vvColorColors,Jd)]),i.code.add(x`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?x`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(x`vec4 vvColor() { return vec4(1.0); }`)}const CF=.1,Eo=.001;function QQe(e){const t=new Hi,i=e.signedDistanceFieldEnabled;if(t.include(vY),t.include(Z1e,e),t.include(cs,e),e.output===J.Occlusion)return t.include(YQe,e),t;const{vertex:r,fragment:s}=t;t.include(GY),s.include(yc),s.include(Yf),t.include(SS,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),r.uniforms.add([new ti("viewport",(c,h)=>h.camera.fullViewport),new fi("screenOffset",(c,h)=>pi(bbe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new fi("anchorPosition",c=>AF(c)),new ti("materialColor",c=>c.color),new We("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new ti("outlineColor",c=>c.outlineColor)),s.uniforms.add([new ti("outlineColor",c=>ose(c)?c.outlineColor:bf),new We("outlineSize",c=>ose(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(eQe(r),Y5(r)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.COLOR,"vec4"),t.attributes.add(R.SIZE,"vec2"),t.attributes.add(R.AUXPOS2,"vec4"),r.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?x`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=x`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?i?x`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x`posProj += quadOffset;`;e.vvColor&&r.uniforms.add([new K5("vvColorColors",c=>c.vvColorColors,Jd),new Ho("vvColorValues",c=>c.vvColorValues,Jd)]),r.uniforms.add(new fi("textureCoordinateScaleFactor",c=>_(c.texture)&&_(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:sfe)),r.code.add(x`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${x.float(Eo)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.float(Eo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?x`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new zt("tex",c=>c.texture));const a=e.debugDrawLabelBorder?x`(isBorder > 0.0 ? 0.0 : ${x.float(CF)})`:x.float(CF),l=x`
    ${e.debugDrawLabelBorder?x`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?x`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${x.float(tM)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.float(Eo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?x`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===J.Alpha&&s.code.add(x`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===J.Color&&s.code.add(x`
    void main() {
      ${l}
      ${e.transparencyPassType===gt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===J.Highlight&&(t.include(Kg),s.code.add(x`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?x`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function ose(e){return e.outlineColor[3]>0&&e.outlineSize>0}function AF(e,t=bbe){return e.textureIsSignedDistanceField?JQe(e.anchorPosition,e.distanceFieldBoundingBox,t):ro(t,e.anchorPosition),t}function JQe(e,t,i){_(t)?pi(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):pi(i,0,0)}const bbe=tt(),KQe=Object.freeze(Object.defineProperty({__proto__:null,build:QQe,calculateAnchorPosForRendering:AF},Symbol.toStringTag,{value:"Module"})),gu=so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),eJe=Xf(Re.ONE,Re.ONE),wbe=Xf(Re.ZERO,Re.ONE_MINUS_SRC_ALPHA);function ey(e){return e===gt.FrontFace?null:e===gt.Alpha?wbe:eJe}function eU(e){return e===gt.FrontFace?wl:null}const tU=5e5,iU={factor:-1,units:-2};function rU(e){return e?iU:null}function Kv(e,t=hr.LESS){return e===gt.NONE||e===gt.FrontFace?t:hr.LEQUAL}class a3 extends cr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global}initializeProgram(t){const i=a3.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace,n=this.configuration.hasPolygonOffset&&tJe,o=(r||s)&&i.output!==J.Highlight?(i.depthEnabled||i.output===J.Occlusion)&&wl:null;return Ut({blending:i.output===J.Color||i.output===J.Alpha||i.output===J.Highlight?r?iJe:ey(t):null,depthTest:{func:hr.LEQUAL},depthWrite:o,colorWrite:Kt,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===J.Occlusion?Pt.POINTS:Pt.TRIANGLES}}a3.shader=new Ki(KQe,()=>import("./HUDMaterial.glsl.aecd8f3b.js"));const tJe={factor:0,units:-4},iJe=Xf(Re.ONE,Re.ONE_MINUS_SRC_ALPHA);class qo extends Da{}u([G({constValue:!0})],qo.prototype,"hasSliceHighlight",void 0),u([G({constValue:!1})],qo.prototype,"hasSliceInVertexProgram",void 0),u([G({constValue:!1})],qo.prototype,"instancedDoublePrecision",void 0),u([G({constValue:!1})],qo.prototype,"isGround",void 0),u([G({constValue:Li.Pass})],qo.prototype,"pbrTextureBindType",void 0);class Ts extends qo{constructor(){super(...arguments),this.output=J.Color,this.screenCenterOffsetUnitsEnabled=al.World,this.transparencyPassType=gt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([G({count:J.COUNT})],Ts.prototype,"output",void 0),u([G({count:al.COUNT})],Ts.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([G({count:gt.COUNT})],Ts.prototype,"transparencyPassType",void 0),u([G()],Ts.prototype,"spherical",void 0),u([G()],Ts.prototype,"occlusionTestEnabled",void 0),u([G()],Ts.prototype,"signedDistanceFieldEnabled",void 0),u([G()],Ts.prototype,"vvSize",void 0),u([G()],Ts.prototype,"vvColor",void 0),u([G()],Ts.prototype,"hasVerticalOffset",void 0),u([G()],Ts.prototype,"hasScreenSizePerspective",void 0),u([G()],Ts.prototype,"debugDrawLabelBorder",void 0),u([G()],Ts.prototype,"binaryHighlightOcclusionEnabled",void 0),u([G()],Ts.prototype,"hasSlicePlane",void 0),u([G()],Ts.prototype,"hasPolygonOffset",void 0),u([G()],Ts.prototype,"depthEnabled",void 0),u([G()],Ts.prototype,"pixelSnappingEnabled",void 0),u([G()],Ts.prototype,"isDraped",void 0),u([G()],Ts.prototype,"hasMultipassGeometry",void 0),u([G()],Ts.prototype,"hasMultipassTerrain",void 0),u([G()],Ts.prototype,"cullAboveGround",void 0),u([G({constValue:!0})],Ts.prototype,"hasSliceInVertexProgram",void 0),u([G({constValue:!1})],Ts.prototype,"hasVvInstancing",void 0);class L2 extends Qf{constructor(t){super(t,new dJe),this.techniqueConfig=new Ts}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?al.Screen:al.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===J.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===J.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=i.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,i,r,s,a,l)}_intersectDrapedHudGeometry(t,i,r,s,n){const o=t.vertexAttributes.get(R.POSITION),a=t.vertexAttributes.get(R.SIZE),l=this.parameters,c=AF(l);let h=1,p=1;if(_(s)){const m=s(cse);h=m[0],p=m[5]}h*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const f=uJe*t.screenToWorldRatio;for(let m=0;m<o.data.length/o.size;m++){const y=m*o.size,v=o.data[y],w=o.data[y+1],b=m*a.size;let S;yy[0]=a.data[b]*h,yy[1]=a.data[b+1]*p,l.textureIsSignedDistanceField&&(S=l.outlineSize*t.screenToWorldRatio/2),ase(i,v,w,yy,f,S,l,c)&&r(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,i,r,s,n,o){if(!s.options.selectionMode||!s.options.hud||t3(i))return;const a=this.parameters;let l=1,c=1;if(Ih(Pz,r),_(o)){const S=o(cse);l=S[0],c=S[5],nJe(Pz)}const h=t.vertexAttributes.get(R.POSITION),p=t.vertexAttributes.get(R.SIZE),f=t.vertexAttributes.get(R.NORMAL),m=t.vertexAttributes.get(R.AUXPOS1);dt(h.size>=3);const y=s.point,v=s.camera,w=AF(a);l*=v.pixelRatio,c*=v.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let S=0;S<h.data.length/h.size;S++){const T=S*h.size;te(Lo,h.data[T],h.data[T+1],h.data[T+2]),ke(Lo,Lo,r);const E=S*p.size;yy[0]=p.data[E]*l,yy[1]=p.data[E+1]*c,ke(Lo,Lo,v.viewMatrix);const C=S*m.size;if(te(Tc,m.data[C+0],m.data[C+1],m.data[C+2]),!b&&(Lo[0]+=Tc[0],Lo[1]+=Tc[1],Tc[2]!==0)){const I=Tc[2];we(Tc,Lo),pe(Lo,Lo,oe(Tc,Tc,I))}const O=S*f.size;if(te(aC,f.data[O],f.data[O+1],f.data[O+2]),this._normalAndViewAngle(aC,Pz,v,Iz),this._applyVerticalOffsetTransformationView(Lo,Iz,v,Mz),v.applyProjection(Lo,ra),ra[0]>-1){ra[0]=Math.floor(ra[0]),ra[1]=Math.floor(ra[1]),b&&(Tc[0]||Tc[1])&&(ra[0]+=Tc[0],Tc[1]!==0&&(ra[1]+=VY(Tc[1],Mz.factorAlignment)),v.unapplyProjection(ra,Lo)),ra[0]+=this.parameters.screenOffset[0],ra[1]+=this.parameters.screenOffset[1],j1e(yy,Mz.factor,yy);const I=cJe*v.pixelRatio;let N;if(a.textureIsSignedDistanceField&&(N=a.outlineSize*v.pixelRatio/2),ase(y,ra[0],ra[1],yy,I,N,a,w)){const D=s.ray;if(ke(lse,Lo,us(lJe,v.viewMatrix)),ra[0]=y[0],ra[1]=y[1],v.unprojectFromRenderScreen(ra,Lo)){const z=M();se(z,D.direction);const B=1/Oe(z);oe(z,z,B),n(or(D.origin,Lo)*B,z,-1,!0,1,lse)}}}}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(R.POSITION),n=t.indices.get(R.POSITION);return R_e(s,n,i)}createBufferWriter(){return new fJe(this)}_normalAndViewAngle(t,i,r,s){return KZe(i)&&(i=Ih(aJe,i)),ec(s.normal,t,i),ke(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=xe(Tbe,hJe),s}_updateScaleInfo(t,i,r){const s=this.parameters;_(s.screenSizePerspective)?tse(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),_(s.screenSizePerspectiveAlignment)?tse(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,Iz);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),_(n)&&se(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return se(n,t);const c=De(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return oe(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=Oe(t),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=oe(Lo,i.normal,o*a);return de(s,t,l),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Oe(t);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Oe(t),a=vt(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=ebe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),oe(i.normal,i.normal,l),de(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&se(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(we(aC,r),de(r,r,oe(aC,aC,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&se(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&se(s,t),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(t){if(t===Se.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:r}=this.parameters;return t===(i?Se.LABEL_MATERIAL:Se.HUD_MATERIAL)||r&&t===Se.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===J.Color||t.output===J.Alpha?new rJe(t):t.output===J.Highlight?new xbe(t):null}calculateRelativeScreenBounds(t,i,r=Dt()){return sJe(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class xbe extends iY{constructor(t){super(F(F({},t),t.material.parameters))}selectProgram(t){return this.ensureTechnique(a3,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}class rJe extends xbe{_isOcclusionSlot(t){return t.slot===Se.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===J.Color||this._output===J.Alpha)}selectProgram(t){return this.ensureTechnique(a3,t,this._isOcclusionSlot(t)?J.Occlusion:this._output)}}function sJe(e,t,i,r=oJe){return ro(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function nJe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function ase(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&_(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const Mz={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},oJe=tt(),Lo=M(),aC=M(),ra=Gt(),Tbe=M(),lse=M(),Pz=Sr(),aJe=Sr(),lJe=Ae(),Tc=M(),Iz={normal:Tbe,cosAngle:0},cse=Ae(),cJe=1,uJe=2,yy=[0,0],hJe=Ue(0,0,1);class dJe extends n_e{constructor(){super(...arguments),this.renderOccluded=Or.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Ii(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const pJe=es().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4u8(R.COLOR).vec2f(R.SIZE).vec4f(R.AUXPOS1).vec4f(R.AUXPOS2);class fJe{constructor(t){this.material=t,this.vertexBufferLayout=pJe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(R.POSITION).length}write(t,i,r,s){Q5(i.indices.get(R.POSITION),i.vertexAttributes.get(R.POSITION).data,t.transformation,r.position,s,6),WY(i.indices.get(R.NORMAL),i.vertexAttributes.get(R.NORMAL).data,t.invTranspTransformation,r.normal,s,6);{const n=i.vertexAttributes.get(R.UV0).data;let o,a,l,c;if(n==null||n.length<4){const m=this.material.parameters;o=0,a=0,l=m.texCoordScale[0],c=m.texCoordScale[1]}else o=n[0],a=n[1],l=n[2],c=n[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const h=i.indices.get(R.POSITION).length,p=r.uv0;let f=s;for(let m=0;m<h;++m)p.set(f,0,o),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,a),f+=1}TF(i.indices.get(R.COLOR),i.vertexAttributes.get(R.COLOR).data,4,r.color,s,6);{const n=i.indices.get(R.SIZE),o=i.vertexAttributes.get(R.SIZE).data,a=n.length,l=r.size;let c=s;for(let h=0;h<a;++h){const p=o[2*n[h]],f=o[2*n[h]+1];for(let m=0;m<6;++m)l.set(c,0,p),l.set(c,1,f),c+=1}}i.indices.get(R.AUXPOS1)&&i.vertexAttributes.get(R.AUXPOS1)&&D2(i.indices.get(R.AUXPOS1),i.vertexAttributes.get(R.AUXPOS1).data,r.auxpos1,s,6),i.indices.get(R.AUXPOS2)&&i.vertexAttributes.get(R.AUXPOS2)&&D2(i.indices.get(R.AUXPOS2),i.vertexAttributes.get(R.AUXPOS2).data,r.auxpos2,s,6)}}const gp=M(),ox=Gt(),lC=Gt(),$z=M(),mJe=Ae(),gJe=mn(),Dz=Qn(),yJe=M(),vJe=Dt();class _Je{constructor(){this.aabr=Dt(),this.distance=0,this.culled=!1,this.visible=!1}}class bJe{constructor(t,i,r={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info=r}}class wJe{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class xJe{}class TJe{constructor(){this.sortArray=new Vt({allocator:t=>t||new xJe})}}var Bl;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(Bl||(Bl={}));class Sbe{constructor(){this.camera=new Qi,this.slicePlane=Zv(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),Iw(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let eS=class extends Ee{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new Sbe,this._state=Bl.Idle,this.graphics=new wJe,this.iterators=new TJe,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Bl.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/Bl.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case Bl.Idle:this._startUpdate(),e.madeProgress();case Bl.Process:if(this._state=Bl.Process,!this._processActiveGraphics(e))return;case Bl.Sort:if(this._state=Bl.Sort,!this._sortVisibleGraphics(e))return;case Bl.Deconflict:if(this._state=Bl.Deconflict,!this._deconflictVisibleGraphics(e))return;default:VZe(this,this.graphics.visible),this._state=Bl.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(A(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof L2}_startUpdate(){GZe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new _Je,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),SJe(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=us(mJe,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?gJe:null;let s=0;for(_(r)&&(ke(r,Aa,this._runningViewState.camera.viewMatrix),r[3]=wi(this.view.spatialReference).radius,s=_fe(r,Aa));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Yn.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),HZe(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=use(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=use(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=EJe(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(Yn.GRAPHIC,nu.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);vu(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(A(a)){if(a=this._getProjectionInfo(l,t,RJe),a.isOutsideScreen||this._isCulledBySlice(e,gp)||_(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!Gi.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}A(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;ke(gp,a,r.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(R.NORMAL).data,h=l.get(R.AUXPOS1).data;return o.applyShaderOffsetsView(gp,c,s.transformation,h,r,i.scaleInfo,gp),Xi(ox,gp[0],gp[1],gp[2],1),lu(lC,ox,r.projectionMatrix),oe(i.positionNDC,lC,1/lC[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,$z),i.distanceWithoutPolygonOffset=r.depthNDCToWorld($z[2]),i.distance=$z[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Xi(lC,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),lu(ox,lC,t),IM(ox,ox,1/ox[3]),te(i.positionView,gp[0],gp[1],gp[2]),i}_isCulledByHorizon(e,t,i){return se(Dz.direction,e.positionView),te(Dz.origin,0,0,0),!!Yv(t,Dz,yJe)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&TW(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(CJe);j1e(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=cN(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,vJe),qt(0,n.fullWidth,.5+.5*r[0]),qt(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(ru(a),np(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}bb(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let s=Math.floor(i.aabr[1]/this.accBinsSizeY);s<=Math.floor(i.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,$M(l.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const r=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)r.push(new Vt)}}else for(let i=0;i<this.accBinsNumX;i++)for(let r=0;r<this.accBinsNumY;r++)this.accBins[i][r].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this.accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this.accBinsNumY||this.accBins[o][a].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(nu.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===Yn.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function SJe(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(nu.DECONFLICTION,t)}function*use(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*EJe(e,t,i){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],eS.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],eS.prototype,"updating",null),eS=u([P("esri.views.3d.layers.graphics.Deconflictor")],eS);const CJe=tt();class AJe{constructor(){this.positionView=M(),this.positionNDC=M(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const RJe=new AJe,OJe=2e3;let cL=class extends eS{constructor(){super(...arguments),this.visibilityGroup=Yn.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===Tn.IDLE||t-this._lastDeconfliction>OJe)&&(super.runTask(e),this.state===Bl.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([d({constructOnly:!0})],cL.prototype,"parent",void 0),cL=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],cL);let Ej=class extends eS{constructor(){super(...arguments),this._handles=new Ht,this._contexts=new Map,this._viewState=new Sbe,this.visibilityGroup=Yn.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ae(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),ae(()=>{var e,t,i;return(i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:i.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),ae(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Ft)]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.GRAPHICS_DECONFLICTOR,this),this._labels=new cL({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&Lz(e));t.setVisibilityFlag(nu.DECONFLICTION,i,Yn.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;_(e)&&Dfe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=_(e)}_slicePlaneChanged(){Ws(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new bJe(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),Lz(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=Lz(e);i||MJe(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function Lz(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function MJe(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag(nu.DECONFLICTION))}Ej=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Ej);const JY=(e,t,i)=>[t,i],N2=(e,t,i)=>[t,i,e[2]],KY=(e,t,i)=>[t,i,e[2],e[3]];function jbt(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:_(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function PJe({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function IJe({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function Ebe({scale:e,translate:t},i){return i*e[0]+t[0]}function Cbe({scale:e,translate:t},i){return t[1]-i*e[1]}function Abe(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=Ebe(e,i[0][0]),a=Cbe(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=t(c,o,a)}return r}function Rbe(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=Abe(e,t,i[s]);return r}function $Je(e,t,i,r){return Abe(e,i?r?KY:N2:r?N2:JY,t)}function DJe(e,t,i,r){return Rbe(e,i?r?KY:N2:r?N2:JY,t)}function LJe(e,t,i,r){return Rbe(e,i?r?KY:N2:r?N2:JY,t)}function Hbt(e,t,i,r,s){return t.x=PJe(e,i.x),t.y=IJe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function Obe(e,t,i,r,s){return _(i)&&(t.points=$Je(e,i.points,r,s)),t}function Mbe(e,t,i,r,s){return A(i)||(t.x=Ebe(e,i.x),t.y=Cbe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function Pbe(e,t,i,r,s){return _(i)&&(t.rings=LJe(e,i.rings,r,s)),t}function Ibe(e,t,i,r,s){return _(i)&&(t.paths=DJe(e,i.paths,r,s)),t}function $be(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],s=t[i];if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==s[n])return!1}return!0}function Dbe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!$be(e[i],t[i]))return!1;return!0}function NJe(e,t){return!!l3(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function FJe(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!l3(e.spatialReference,t.spatialReference)&&Dbe(e.paths,t.paths)}function UJe(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!l3(e.spatialReference,t.spatialReference)&&Dbe(e.rings,t.rings)}function kJe(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!l3(e.spatialReference,t.spatialReference)&&$be(e.points,t.points)}function zJe(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!l3(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function l3(e,t){return e===t||e&&t&&e.equals(t)}function BJe(e,t){if(e===t)return!0;if(A(e)||A(t)||e.type!==t.type)return!1;switch(e.type){case"point":return NJe(e,t);case"extent":return zJe(e,t);case"polyline":return FJe(e,t);case"polygon":return UJe(e,t);case"multipoint":return kJe(e,t);case"mesh":return!1;default:return}}function VJe(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i)if(e[s]!==t[s])return!1;return!0}function qbt(e,t){return e===t||e!=null&&t!=null&&e.objectId===t.objectId&&!!BJe(e.geometry,t.geometry)&&!!VJe(e.attributes,t.attributes)}class Wbt{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function Xbt(e){return _(e.geometry)}class Ybt{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function Zbt(e){const t=Pue.fromJSON(e.geometryType),i=Ke.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(n=>{const o=GJe(n,t,i,e.objectIdFieldName),a=o.geometry;if(_(a)&&r)switch(a.type){case"point":o.geometry=Mbe(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=Obe(r,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=Pbe(r,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=Ibe(r,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(n=>jM.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function GJe(e,t,i,r){return{uid:hl(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:jJe(e.geometry,t,i),visible:!0}}function jJe(e,t,i){if(A(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function ty(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function HJe(e){if(A(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=U3(e.vertexAttributes.position),t+=U3(e.vertexAttributes.normal),t+=U3(e.vertexAttributes.uv),t+=U3(e.vertexAttributes.tangent)}return t}function Qbt(e){let t=32;return t+=Ype(e.attributes),t+=3,t+=8+HJe(e.geometry),t}function qJe(e){if(A(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function Jbt(e){if(A(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function Kbt(e,t){switch(ur(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Ak(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Ak(t,e.rings[i],e.hasZ);break;case"multipoint":Ak(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function WJe(e,t){switch(vu(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Ck(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Ck(t,e.rings[i]);break;case"multipoint":Ck(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function ewt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}Ls();Dt();function Lbe(e){return"declaredClass"in e}function hse(e){return"declaredClass"in e}function XJe(e){return"declaredClass"in e}function YJe(e,t){if(!e)return null;if(XJe(e))return e;const i=new Pa({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=ie(e.symbol),i.attributes=ie(e.attributes),i.geometry=Nbe(e.geometry),i}function Nbe(e){return A(e)?null:Lbe(e)?e:Og(ZJe(e))}function ZJe(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:dse(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:dse(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:Ube(i)?Fbe(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}function dse(e){return QJe(e)?e.map(t=>Fbe(t)):e}function Fbe(e){return e.map(t=>Q2e(t))}function QJe(e){for(const t of e)if(t.length!==0)return Ube(t);return!1}function Ube(e){return e.length&&(cce(e[0])||uce(e[0]))}function JJe(e,t){if(!e)return null;let i;if(hse(e)){if(t==null)return e.clone();if(hse(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=ty(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}const Nz=fe.getLogger("esri.layers.support.labelFormatUtils"),pse={type:"simple",evaluate:()=>null},KJe={getAttribute:(e,t)=>e.field(t)};async function kbe(e,t,i){if(!e||!e.symbol)return pse;const r=e.where,s=C5(e),n=r?await import("./WhereClause.d6b5dcf7.js"):null;let o;if(s.type==="arcade"){const a=await MAe(s.expression,i,t);o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{Nz.error(new H("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>MX(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":zbe(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,t)}catch(c){return Nz.error(new H("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),pse}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:KJe;try{if(a.testFeature(c,h))return l(c)}catch(p){Nz.error(new H("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function zbe(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=Mf(r,D4("short-date")):g4(t)&&(r=Pf(+r)),r||""}var twt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createLabelFunction:kbe,formatField:zbe});function eZ(e,t){if(e.type==="point")return vy(e,t,!1);if(Lbe(e))switch(e.type){case"extent":return vy(e.center,t,!1);case"polygon":return vy(e.centroid,t,!1);case"polyline":return vy(fse(e),t,!0);case"mesh":return vy(e.origin,t,!1)}else switch(e.type){case"extent":return vy(eKe(e),t,!0);case"polygon":return vy(tKe(e),t,!0);case"polyline":return vy(fse(e),t,!0)}}function fse(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=gue(t,mue(t)/2);return ty(i[0],i[1],i[2],e.spatialReference)}function eKe(e){const t=isFinite(e.zmin);return ty(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function tKe(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=yue(e.rings,e.hasZ);return ty(i[0],i[1],i[2],e.spatialReference)}function vy(e,t,i){const r=i?e:JJe(e);return t&&e?BIe(e,r,t)?r:null:r}function iwt(e,t,i,r=0){if(e){t||(t=Dt());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Xi(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function Bbe(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(R.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function FR(e,t){const i=q4(vh);return _(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),_(t)?i[3]=t:_(e)&&e.length>3&&(i[3]=e[3]),i}function rwt(e,t,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)_(e)&&e[o]!=null?n[o]=e[o]:_(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return _(t)?n[3]=t:_(r)?n[3]=r:n[3]=s[3],n}function mse(e=mf,t,i,r=1){const s=new Array(3);if(A(t)||A(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return il(s)}function iKe(e){return e.isPrimitive!=null}function sU(e){return iKe(e)&&(e=[e.width,e.depth,e.height]),RF(e)?null:"Symbol sizes may not be negative values"}function RF(e){if(Array.isArray(e)){for(const t of e)if(!RF(t))return!1;return!0}return e==null||e>=0}function rKe(e,t,i,r=Ae()){const s=e||0,n=t||0,o=i||0;return s!==0&&r2(r,r,-s/180*Math.PI),n!==0&&i2(r,r,n/180*Math.PI),o!==0&&B4(r,r,o/180*Math.PI),r}function tZ(e,t){return t.minDemResolution!=null?t.minDemResolution:T4(e)?t.minDemResolutionForPoints:.01*dOe(e)}function Vbe(e,t,i,r,s,n,o,a,l,c,h){const p=hKe[h.mode];let f,m,y=0;if(lr(e,t,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),lr(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function Bg(e,t,i,r,s){const n=(vF(e)?e.z:b1e(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const o=vt(yf(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=vt(yf(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=vt(yf(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=vt(yf(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return i.mode,void(s.z=0)}}function sKe(e,t,i,r){return Bg(e,t,i,r,tS),tS.z}function c3(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?Gr.UPDATE:e.onTheGroundChanged}function Nh(e){return e==="relative-to-ground"||e==="relative-to-scene"}function zv(e){return e!=="absolute-height"}function nKe(e,t,i,r,s){Bg(t,i,s,r,tS),Bbe(e,tS.verticalDistanceToGround);const n=tS.sampledElevation,o=gs(dKe,e.transformation);return vI[0]=t.x,vI[1]=t.y,vI[2]=tS.z,bu(t.spatialReference,vI,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function oKe(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=vt(n.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,t+=3,r+=3}return o/s}function aKe(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],v=e[t+2],w=vt(n.getElevation(m,y,v,p,"ground"),0);l+=w,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?v+w+c:w+c,t+=3,r+=3}return l/s}function lKe(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],v=e[t+2],w=vt(n.getElevation(m,y,v,p,"scene"),0);l+=w,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?v+w+c:w+c,t+=3,r+=3}return l/s}function cKe(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function uKe(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],m=e[t+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?m+l:l,t+=3,r+=3}return 0}class u3{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var Gr;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(Gr||(Gr={}));const hKe={"absolute-height":{applyElevationAlignmentBuffer:uKe,requiresAlignment:cKe},"on-the-ground":{applyElevationAlignmentBuffer:oKe,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:aKe,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:lKe,requiresAlignment:()=>!0}},dKe=Ae(),tS=new u3,vI=M();function Gbe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=Hbe(a,t,i,r);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function iM(e,t,i,r){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(Bg(n,i,t,r,ol),Bbe(s,ol.verticalDistanceToGround),o=ol.sampledElevation):(Bg(n,i,t,r,ol),t.mode!=="absolute-height"&&(o=ol.sampledElevation));const a=gs(pKe,s.transformation),l=te(jbe,a[12],a[13],a[14]);Gi.TESTS_DISABLE_OPTIMIZATIONS?(nl[0]=n.x,nl[1]=n.y,nl[2]=ol.z,bu(n.spatialReference,nl,a,r.spatialReference)&&(s.transformation=a)):r.setAltitudeOfTransformation(ol.z,a);const c=iZ/r.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const pKe=Ae();function fKe(e,t,i,r){const s=e.graphics3DSymbolLayer.lodRenderer;if(A(s))return 0;const n=t.centerPointInElevationSR;Bg(n,i,t,r,ol);const o=t.mode!=="absolute-height"?ol.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=gKe;a.getGlobalTransform(l,c);const h=te(jbe,c[12],c[13],c[14]);Gi.TESTS_DISABLE_OPTIMIZATIONS?(nl[0]=n.x,nl[1]=n.y,nl[2]=ol.z,bu(n.spatialReference,nl,c,r.spatialReference)&&a.setGlobalTransform(l,c)):r.setAltitudeOfTransformation(ol.z,c);const p=iZ/r.unitInMeters;return(Gi.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&a.setGlobalTransform(l,c),o}function mKe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const h of n){const p=h.geometry.vertexAttributes.get(R.POSITION);if(p!==a){const{update:f,averageGeometrySampledElevation:m}=Hbe(h,t,i,r);l=m,a=p,c=f}c&&s.geometryVertexAttrsUpdated(h),o+=l}return o/n.length}const iZ=.01,nl=M(),Iu=M(),ax=M(),gKe=Ae(),jbe=M(),ol=new u3;function Hbe(e,t,i,r){let s=!1;const n=i.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;Iu[0]=a[12],Iu[1]=a[13],Iu[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(R.POSITION),h=c.data,p=o.vertexAttributes.get(R.MAPPOS).data,f=c.size,m=h.length/f,y=new _1e(p,n);let v=0,w=0;for(let b=0;b<m;b++){if(ax[0]=h[v],ax[1]=h[v+1],ax[2]=h[v+2],Bg(y,i,t,r,ol),l&&(w+=ol.sampledElevation),Gi.TESTS_DISABLE_OPTIMIZATIONS)h[v]=y.array[y.offset],h[v+1]=y.array[y.offset+1],h[v+2]=ol.z,lr(h,n,v,h,r.spatialReference,v,1),h[v]-=Iu[0],h[v+1]-=Iu[1],h[v+2]-=Iu[2],s=!0;else{nl[0]=h[v]+Iu[0],nl[1]=h[v+1]+Iu[1],nl[2]=h[v+2]+Iu[2],r.setAltitude(nl,ol.z),h[v]=nl[0]-Iu[0],h[v+1]=nl[1]-Iu[1],h[v+2]=nl[2]-Iu[2];const S=iZ/r.unitInMeters;(Math.abs(ax[0]-h[v])>=S||Math.abs(ax[1]-h[v+1])>=S||Math.abs(ax[2]-h[v+2])>=S)&&(s=!0)}v+=f,y.offset+=3}return w/=m,{update:s,averageGeometrySampledElevation:w}}const yKe=fe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function vKe(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function swt(e){const t=e&&e.expression;if(typeof t=="string"){const i=Xbe(t);if(i!=null)return{cachedResult:i}}return null}async function nwt(e,t,i){const r=e&&e.expression;if(typeof r!="string")return null;const s=Xbe(r);if(s!=null)return{cachedResult:s};const n=await Cf(),o=n.arcadeUtils,a=o.createSyntaxTree(r);return o.dependsOnView(a)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function qbe(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function rZ(e,t){if(e!=null&&!Wbe(e)){if(!t||!e.arcade)return void yKe.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=Nbe(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function _Ke(e){if(e!=null){if(Wbe(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function owt(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i}const bKe={cachedResult:0};function Wbe(e){return e.cachedResult!=null}function Xbe(e){return e==="0"?0:null}class Cu{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=UBe(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=_Ke(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=FBe(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=vt(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(A(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&_(i)&&_(r)?(this._featureExpressionInfoContext=vKe(t),rZ(this._featureExpressionInfoContext,qbe(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new Cu;return _(t)&&i.setFromElevationInfo(t),i}}var It;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(It||(It={}));class Jf{constructor(t,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=i}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),_(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(A(this._edgeState))return;const r=gse(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){A(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!i),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),_(this._edgeState))){const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){this.elevationAligner!=null&&(_(r)&&rZ(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,i),this._resetEdgeObject(s))}getCenterObjectSpace(t=M()){return se(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=Ls()){const i=this.stageObject.boundingVolumeObjectSpace;return bhe(t,i.min),whe(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometryRecords)i.computeAttachmentOrigin(am)&&(ke(am,am,this.stageObject.transformation),de(t.render.origin,t.render.origin,am),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=wKe,l=T4(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];_y[0]=o[p[0]],_y[1]=o[p[1]],_y[2]=o[p[2]],ke(_y,_y,this.stageObject.transformation),w_[3*h+0]=_y[0],w_[3*h+1]=_y[1],w_[3*h+2]=_y[2]}if(!t(w_,0,l))return null;ur(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],w_[h+p]),o[p+3]=Math.max(o[p+3],w_[h+p]);c&&r.push({location:w_.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){zd(o,am);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=vt(i.service.getElevation(am[0],am[1],h),0);else try{const f=tZ(o,i);p=vt(await i.service.queryElevation(am[0],am[1],s,f,h),0)}catch{}_he(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,i){t===Fg.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===Fg.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(A(this._edgeState))return;const i=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(A(r))return;const s=gse(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function gse(e){return e.isVisible?e.parameters.transparent?It.TRANSPARENT:It.OPAQUE:It.INVISIBLE}const w_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_y=M(),am=M(),wKe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var Qs;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(Qs||(Qs={}));class sZ{constructor(t){this.schedule=t,this._loadStatus=Jc.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===Jc.LOADED?(t&&t(),this._loader):this._loadStatus===Jc.FAILED?(i&&i(this._loadError),this._loader):(A(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Jc.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Jc.FAILED,!jr(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){_(this._abortController)?this._abortController=Ah(this._abortController):this._loadStatus===Jc.LOADING&&(this._loadStatus=Jc.FAILED),this._loader=null}}var Jc;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(Jc||(Jc={}));function xKe(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Ybe(e,t){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&jl.cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>jl.createPolySphereGeometry(.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>jl.createBoxGeometry(1));case"cone":return i(Fz,r=>jl.createConeGeometry(1,.5,r,!1),!0);case"inverted-cone":return i(Fz,r=>jl.createConeGeometry(1,.5,r,!0),!0);case"cylinder":return i(Fz,r=>jl.createCylinderGeometry(1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>jl.createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>jl.createDiamondGeometry(1),!0);default:return}}const Fz=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function TKe(e){return e.type==="fill"}function SKe(e){return e.type==="extrude"}function EKe(e){return e&&e.enabled&&(SKe(e)||TKe(e))&&_(e.edges)}function CKe(e){return e&&e.enabled&&e.edges||null}function Zbe(e,t){return Qbe(CKe(e),t)}function Qbe(e,t){if(A(e))return null;const i=_(e.color)?fW(qe.toUnitRGBA(e.color)):gi(0,0,0,0),r=eo(e.size),s=eo(e.extensionLength);switch(e.type){case"solid":return Jbe(F({color:i,size:r,extensionLength:s},t));case"sketch":return AKe(F({color:i,size:r,extensionLength:s},t));default:return}}function Jbe(e){return ve(F(F({},RKe),e),{type:"solid"})}function AKe(e){return ve(F(F({},OKe),e),{type:"sketch"})}const RKe={color:gi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:It.OPAQUE,hasSlicePlane:!1},OKe={color:gi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:It.OPAQUE,hasSlicePlane:!1};function _I(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.material)})}),SM(t)}function MKe(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{r.textures&&t.push(...r.textures)})}),SM(t)}function nZ(e){const t=[];return e.components.forEach(i=>{t.push(i.geometry)}),SM(t)}function PKe(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),SM(t)}function IKe(e){return nZ(e).reduce((t,i)=>t+i.indexCount/3,0)}const oZ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function awt(e){return e.type==="web-style"?oZ:aZ(e.symbolLayers.toArray().map(t=>Kbe(e,t)))}function aZ(e){let t=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)A(a)||(t+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function lwt(e){const t=aZ(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const yse={};function Kbe(e,t){const i=ewe(e,t),r=EKe(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:_(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:ve(F({},$Ke(t.resource&&t.resource.primitive||Khe)),{memory:i});case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,h=a*l*2;let p=-2*h-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:h+c,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function ewe(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?ka.EXTRUDE_EDGES:ka.EXTRUDE;case"fill":return _(t.outline)&&t.outline.size>0?ka.FILL_OUTLINE:ka.FILL;case"water":return ka.FILL;case"line":return t.join==="round"?ka.LINE_ROUND:ka.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return ka.PATH_ROUND_CIRCLE;case"quad":return ka.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return ka.PATH_MITER_CIRCLE;case"quad":return ka.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return i?ka.OBJECT_POINT:ka.OBJECT_POLYGON;case"icon":case"text":return i?ka.ICON_POINT:ka.ICON_POLYGON;default:return}}function $Ke(e){let t=yse[e];if(t)return t;const i=Ybe(e,null);return t={primitivesPerFeature:nZ(i.levels[0]).reduce((r,s)=>r+s.indices.get(R.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},yse[e]=t,t}const ka={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},bI=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Kf extends sZ{constructor(t,i,r,s){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=bI,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=i,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Cu,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=vse(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=vse(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!i.length||i.length===1&&!i[0].length?l=`${a} (no ${r} were defined)`:Array.isArray(i)&&Array.isArray(i[0])?o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (${r} should be defined as a 2D array)`:l=`${a} (failed to project geometry to view spatial reference)`,l&&bI.warnOncePerTick(l)}_validateGeometry(t,i=null,r=null){if(_(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return bI.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return DKe}_defaultElevationInfoZ(){return LKe}_updateElevationContext(){_(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=vt(this._elevationContext.meterUnitOffset,vt(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?bKe:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,i=_se){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(_(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=_se){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return FR(null,r);const s=_(t)?qe.toUnitRGB(t):mf;return FR(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=FR(r,s);return _(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Kbe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Gr.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=Gr.UPDATE;return t.forEach(n=>{const o=i(n);if(_(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Gr.RECREATE}),s}applyRendererDiff(t,i){return Qs.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?bg(i.size.field,t):0,s=i.color?bg(i.color.field,t):0,n=i.opacity?bg(i.opacity.field,t):0;return gi(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&bI.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var i,r,s,n,o,a,l,c,h,p,f,m,y,v,w,b;return{size:(n=(s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(b=(w=(v=(y=this._fastUpdates)==null?void 0:y.visualVariables)==null?void 0:v.rotation)==null?void 0:w.field)!=null?b:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function bg(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function vse(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const DKe={mode:"on-the-ground",offset:0,unit:"meters"},LKe={mode:"absolute-height",offset:0,unit:"meters"},_se={hasIntrinsicColor:!1};class uw{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,i,r,s,n,o){this.id=hl(),this.geometry=t,this.material=i,this.transformation=r,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return _(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(ke(t,t,this.getStaticTransformation()),!0)}}uw.pool=new vs(uw);class OF{constructor(t){this.channel=t,this.id=hl()}}class iy extends e3{constructor(t={}){super(),this.type=cp.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Ae(),this._bvObjectSpace=new bse,this._bvWorldSpace=new bse,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new twe),this.transformation=Ae();const{geometries:i,materials:r,transformations:s,origins:n}=t;if(Array.isArray(i)){dt(r.length===i.length,"Object3D: materials don't match geometries"),dt(s.length===i.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=i.length,this._geometries.length=i.length;for(let o=0;o<i.length;o++)this._geometries[o]=i[o],this._geometryRecords[o]=uw.pool.acquire(i[o],r[o],Eb(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){gs(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){dt(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,i,r,s,n){r=r||en,this._geometries.push(t);const o=uw.pool.acquire(t,i,r,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||_(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const i=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=_(i.shaderTransformation)?this._geometryRecords.some(r=>_(r.shaderTransformation)):this._hasVolatileTransformation,i.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:i}),this._invalidateBoundingVolume(),i}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometryRecords)i.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new OF(Fg.MaskOccludee);for(const i of this._geometryRecords)i.instanceParameters.occludees=uj(i.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometryRecords)i.instanceParameters.occludees=hj(i.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new OF(Fg.Highlight);for(const i of this._geometryRecords)i.instanceParameters.highlights=uj(i.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometryRecords)i.instanceParameters.highlights=hj(i.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return Fr(vt(i,Ae()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,i){return i=i||Ae(),Fr(i,this.transformation,t.getShaderTransformation()),i}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;_(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}tn(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),tn(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=M(),i=M(),r=qb(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(A(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=qb(o);ke(t,n.getCenter(),o);const l=or(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),ke(i,t,this.transformation);const h=or(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,i,r){const s=t.getBBMin(),n=t.getBBMax(),o=$s(s),a=$s(n);ke(o,o,r),ke(a,a,r);for(let l=0;l<3;++l)i.min[l]=Math.min(i.min[l],o[l],a[l]),i.max[l]=Math.max(i.max[l],o[l],a[l]);for(let l=0;l<3;++l){se(o,s),se(a,n),o[l]=n[l],a[l]=s[l],ke(o,o,r),ke(a,a,r);for(let c=0;c<3;++c)i.min[c]=Math.min(i.min[c],o[c],a[c]),i.max[c]=Math.max(i.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,_(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){_(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.includes(i),getGeometryIndex:i=>t._geometries.indexOf(i)}}}class twe{constructor(){this.min=Ue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class bse extends twe{constructor(){super(...arguments),this.bounds=mn()}init(){te(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),te(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),gfe(this.bounds)}}const nv=M();function lZ(e,t,i,r,s,n,o,a){const l=i?i.length:0,c=e.clippingExtent;if(Pn(t,nv,e.elevationProvider.spatialReference),_(c)&&!_q(c,nv))return null;Pn(t,nv,e.renderCoordsHelper.spatialReference);const h=e.localOriginFactory.getOrigin(nv),p=new iy({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let f=0;f<l;f++){const m=en;p.addGeometry(i[f],r[f],m,h,a)}return{object:p,sampledElevation:nKe(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function rM(e,t,i){const r=e.elevationContext,s=i.spatialReference;Pn(t,nv,s),r.centerPointInElevationSR=ty(nv[0],nv[1],t.hasZ?nv[2]:0,s)}function sM(e){switch(e.type){case"point":return e;case"polygon":case"extent":return eZ(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=gue(t,mue(t)/2);return ty(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function NKe(e){const t=new Hi;t.include(vY),t.include(Z1e,e),t.include(cs,e),t.attributes.add(R.UV0,"vec2");const{vertex:i,fragment:r}=t;return i.uniforms.add([new ti("viewport",(s,n)=>n.camera.fullViewport),new We("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new fi("pixelToNDC",(s,n)=>pi(xse,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new We("borderSize",(s,n)=>_(s.borderColor)?n.camera.pixelRatio:0),new fi("screenOffset",(s,n)=>pi(xse,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&Y5(i),i.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?x`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?x`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?x`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?x`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new ti("uColor",s=>wse(s.color)),new ti("borderColor",s=>wse(s.borderColor))]),e.hasMultipassGeometry&&(r.include(y_e,e),r.uniforms.add(new fi("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(x`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?x`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function wse(e){return _(e)?e:bf}const xse=tt(),FKe=Object.freeze(Object.defineProperty({__proto__:null,build:NKe},Symbol.toStringTag,{value:"Module"}));class nU extends cr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global}initializeProgram(t){const i=nU.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}setPipelineState(t){const i=t?hr.ALWAYS:hr.LESS;return this.configuration.depthHudEnabled?Ut({depthTest:{func:i},depthWrite:wl}):Ut({blending:so(Re.ONE,Re.SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:Kt})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}nU.shader=new Ki(FKe,()=>import("./LineCallout.glsl.3b6c026b.js"));class Ju extends qo{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=al.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([G({count:al.COUNT})],Ju.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([G()],Ju.prototype,"spherical",void 0),u([G()],Ju.prototype,"occlusionTestEnabled",void 0),u([G()],Ju.prototype,"hasVerticalOffset",void 0),u([G()],Ju.prototype,"hasScreenSizePerspective",void 0),u([G()],Ju.prototype,"depthHudEnabled",void 0),u([G()],Ju.prototype,"depthHudAlignStartEnabled",void 0),u([G()],Ju.prototype,"hasSlicePlane",void 0),u([G()],Ju.prototype,"hasMultipassGeometry",void 0),u([G({constValue:!0})],Ju.prototype,"hasSliceInVertexProgram",void 0),u([G({constValue:!1})],Ju.prototype,"isDraped",void 0);class db extends Qf{constructor(t){super(t,new kKe),this.techniqueConfig=new Ju,this._uniqueMaterialIdentifier=db.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,i){const r=(i==null?void 0:i.slot)!==Se.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?al.Screen:al.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!i&&i.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case Se.LINE_CALLOUTS:case Se.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===J.Color?new UKe(t):null}createBufferWriter(){return new BKe}validateParameters(t){const i=db.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class UKe extends Qv{beginSlot(t){return this.ensureTechnique(nU,t)}}class kKe extends wE{constructor(){super(...arguments),this.screenOffset=Mh,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const zKe=es().vec3f(R.POSITION).vec3f(R.NORMAL).vec2f(R.UV0).vec4f(R.AUXPOS1),Tse=[Ta(0,0),Ta(1,0),Ta(0,1),Ta(1,0),Ta(1,1),Ta(0,1)];class BKe{constructor(){this.vertexBufferLayout=zKe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(R.POSITION).length}write(t,i,r,s){Q5(i.indices.get(R.POSITION),i.vertexAttributes.get(R.POSITION).data,t.transformation,r.position,s,6),WY(i.indices.get(R.NORMAL),i.vertexAttributes.get(R.NORMAL).data,t.invTranspTransformation,r.normal,s,6),D2(i.indices.get(R.AUXPOS1),i.vertexAttributes.get(R.AUXPOS1).data,r.auxpos1,s,6);for(let n=0;n<Tse.length;++n)r.uv0.setVec(s+n,Tse[n])}}class oU extends Kf{constructor(t,i){super(t,null,i,jKe),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new db(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this.materialParameters;return i.screenOffset=t.screenOffset||Mh,i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get materialParameters(){const t=this.symbol,i=t.callout,r=_(i.color)?qe.toUnitRGBA(i.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const s=eo(i.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:f,maxWorldLength:m}=t.verticalOffset;n={screenLength:eo(p),minWorldLength:f||0,maxWorldLength:m!=null?m:1/0}}const o=_(i.border)&&_(i.border.color)?qe.toUnitRGBA(i.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,h=t.type==="label-3d";return{color:r,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:Or.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return GKe}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new Cu,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!nde(l)))return null;const a=eZ(r.geometry);return A(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){return A(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=c3(oU.elevationModeChangeTypes,r,s);return n!==Gr.UPDATE||t.forEach(o=>{const a=i(o);_(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return A(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=Nh(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:oZ.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=i?{size:3,data:[i[0],i[1],i[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[R.POSITION,s],[R.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[R.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=db.uniqueMaterialIdentifier(i);if(_(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(r);return A(s)&&(s=new db(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new db(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=[new Mr(this._createVertexData(r),VKe,ml.Point)],o=this._getOrCreateMaterial(r),a=lZ(this._context,t,n,[o.material],i,this._context.layer.uid,s);if(a===null)return null;const l=new Jf(this,a.object,n,o.isUnique?[o.material]:null,null,iM,i);return l.metadata={elevationOffset:r.elevationOffset||0},l.alignedSampledElevation=a.sampledElevation,l.needsElevationUpdates=Nh(i.mode),rM(l,t,this._context.elevationProvider),l}}oU.elevationModeChangeTypes={definedChanged:Gr.UPDATE,staysOnTheGround:Gr.UPDATE,onTheGroundChanged:Gr.RECREATE};const Uz=new Uint16Array([0]),VKe=[[R.POSITION,Uz],[R.NORMAL,Uz],[R.AUXPOS1,Uz]],GKe={mode:"relative-to-ground",offset:0},jKe={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Sse=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function HKe(e,t){if(!Uq(e))return Sse.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=qKe[e.callout.type];return i?new i(e,t):(Sse.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const qKe={line:oU};class WKe{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}const Ese=new vs(Array,e=>x4(e,xhe),null,10,5),XKe=Dt();class YKe{constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=ZKe(Yn._COUNT,nu._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?qbe(n,t,s):null;for(const o of r)_(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,i){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,i,r){this._labelGraphics.push(t),t.initialize(i,r),t.setVisibility(this.isVisible(Yn.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=Yn.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===Yn.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Yn.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,i=Yn.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(A(i))return!1;this._extent=Dt(),WJe(i,this._extent);const r=i.spatialReference;if(!r.equals(t)&&!j4(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return _(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Ao.fromExtent(s.type==="mesh"?s.extent:s)),CUe(s,i,r)}get usedMemory(){let t=Ype(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(A(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=qJe(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:M(),num:0},draped:{origin:tt(),num:0}};for(const i of this.graphics)A(i)||i.computeAttachmentOrigin(t);return t.render.num&&oe(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&Jl(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?ur(n.boundingBox):n.boundingBox=ur(),n.requiresDrapedElevation=!1,await n5(this.graphics,async o=>{if(A(o))return;const a=o.type==="draped"?i:t,l=Ese.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&WS(n.boundingBox,l),Ese.release(l)}),hOe(n.boundingBox)||tV(bq(n.boundingBox,XKe))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(_(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function ZKe(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var Cse,Ase,Rse,iwe={exports:{}};Cse=iwe,Ase=function(){function e($,U,V){V=V||2;var q,W,K,j,ee,ge,Te,Fe=U&&U.length,_e=Fe?U[0]*V:$.length,me=t($,0,_e,V,!0),Ce=[];if(!me||me.next===me.prev)return Ce;if(Fe&&(me=l($,U,me,V)),$.length>80*V){q=K=$[0],W=j=$[1];for(var Ne=V;Ne<_e;Ne+=V)(ee=$[Ne])<q&&(q=ee),(ge=$[Ne+1])<W&&(W=ge),ee>K&&(K=ee),ge>j&&(j=ge);Te=(Te=Math.max(K-q,j-W))!==0?1/Te:0}return r(me,Ce,V,q,W,Te),Ce}function t($,U,V,q,W){var K,j;if(W===ne($,U,V,q)>0)for(K=U;K<V;K+=q)j=Y(K,$[K],$[K+1],j);else for(K=V-q;K>=U;K-=q)j=Y(K,$[K],$[K+1],j);if(j&&C(j,j.next)){var ee=j.next;Z(j),j=ee}return j}function i($,U){if(!$)return $;U||(U=$);var V,q=$;do if(V=!1,q.steiner||!C(q,q.next)&&E(q.prev,q,q.next)!==0)q=q.next;else{var W=q.prev;if(Z(q),(q=U=W)===q.next)break;V=!0}while(V||q!==U);return U}function r($,U,V,q,W,K,j){if($){!j&&K&&y($,q,W,K);for(var ee,ge,Te=$;$.prev!==$.next;)if(ee=$.prev,ge=$.next,K?n($,q,W,K):s($))U.push(ee.i/V),U.push($.i/V),U.push(ge.i/V),Z($),$=ge.next,Te=ge.next;else if(($=ge)===Te){j?j===1?r($=o(i($),U,V),U,V,q,W,K,2):j===2&&a($,U,V,q,W,K):r(i($),U,V,q,W,K,1);break}}}function s($){var U=$.prev,V=$,q=$.next;if(E(U,V,q)>=0)return!1;for(var W=$.next.next;W!==$.prev;){if(S(U.x,U.y,V.x,V.y,q.x,q.y,W.x,W.y)&&E(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function n($,U,V,q){var W=$.prev,K=$,j=$.next;if(E(W,K,j)>=0)return!1;for(var ee=W.x<K.x?W.x<j.x?W.x:j.x:K.x<j.x?K.x:j.x,ge=W.y<K.y?W.y<j.y?W.y:j.y:K.y<j.y?K.y:j.y,Te=W.x>K.x?W.x>j.x?W.x:j.x:K.x>j.x?K.x:j.x,Fe=W.y>K.y?W.y>j.y?W.y:j.y:K.y>j.y?K.y:j.y,_e=w(ee,ge,U,V,q),me=w(Te,Fe,U,V,q),Ce=$.prevZ,Ne=$.nextZ;Ce&&Ce.z>=_e&&Ne&&Ne.z<=me;){if(Ce!==$.prev&&Ce!==$.next&&S(W.x,W.y,K.x,K.y,j.x,j.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,Ne!==$.prev&&Ne!==$.next&&S(W.x,W.y,K.x,K.y,j.x,j.y,Ne.x,Ne.y)&&E(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;Ce&&Ce.z>=_e;){if(Ce!==$.prev&&Ce!==$.next&&S(W.x,W.y,K.x,K.y,j.x,j.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;Ne&&Ne.z<=me;){if(Ne!==$.prev&&Ne!==$.next&&S(W.x,W.y,K.x,K.y,j.x,j.y,Ne.x,Ne.y)&&E(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function o($,U,V){var q=$;do{var W=q.prev,K=q.next.next;!C(W,K)&&O(W,q,q.next,K)&&z(W,K)&&z(K,W)&&(U.push(W.i/V),U.push(q.i/V),U.push(K.i/V),Z(q),Z(q.next),q=$=K),q=q.next}while(q!==$);return i(q)}function a($,U,V,q,W,K){var j=$;do{for(var ee=j.next.next;ee!==j.prev;){if(j.i!==ee.i&&T(j,ee)){var ge=k(j,ee);return j=i(j,j.next),ge=i(ge,ge.next),r(j,U,V,q,W,K),void r(ge,U,V,q,W,K)}ee=ee.next}j=j.next}while(j!==$)}function l($,U,V,q){var W,K,j,ee=[];for(W=0,K=U.length;W<K;W++)(j=t($,U[W]*q,W<K-1?U[W+1]*q:$.length,q,!1))===j.next&&(j.steiner=!0),ee.push(b(j));for(ee.sort(c),W=0;W<ee.length;W++)V=i(V=p(ee[W],V),V.next);return V}function c($,U){return $.x-U.x}function h($){if($.next.prev===$)return $;let U=$;for(;;){const V=U.next;if(V.prev===U||V===U||V===$)break;U=V}return U}function p($,U){var V=f($,U);if(!V)return U;var q=k(V,$),W=i(V,V.next);let K=h(q);return i(K,K.next),W=h(W),h(U===V?W:U)}function f($,U){var V,q=U,W=$.x,K=$.y,j=-1/0;do{if(K<=q.y&&K>=q.next.y&&q.next.y!==q.y){var ee=q.x+(K-q.y)*(q.next.x-q.x)/(q.next.y-q.y);if(ee<=W&&ee>j){if(j=ee,ee===W){if(K===q.y)return q;if(K===q.next.y)return q.next}V=q.x<q.next.x?q:q.next}}q=q.next}while(q!==U);if(!V)return null;if(W===j)return V;var ge,Te=V,Fe=V.x,_e=V.y,me=1/0;q=V;do W>=q.x&&q.x>=Fe&&W!==q.x&&S(K<_e?W:j,K,Fe,_e,K<_e?j:W,K,q.x,q.y)&&(ge=Math.abs(K-q.y)/(W-q.x),z(q,$)&&(ge<me||ge===me&&(q.x>V.x||q.x===V.x&&m(V,q)))&&(V=q,me=ge)),q=q.next;while(q!==Te);return V}function m($,U){return E($.prev,$,U.prev)<0&&E(U.next,$,$.next)<0}function y($,U,V,q){var W=$;do W.z===null&&(W.z=w(W.x,W.y,U,V,q)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==$);W.prevZ.nextZ=null,W.prevZ=null,v(W)}function v($){var U,V,q,W,K,j,ee,ge,Te=1;do{for(V=$,$=null,K=null,j=0;V;){for(j++,q=V,ee=0,U=0;U<Te&&(ee++,q=q.nextZ);U++);for(ge=Te;ee>0||ge>0&&q;)ee!==0&&(ge===0||!q||V.z<=q.z)?(W=V,V=V.nextZ,ee--):(W=q,q=q.nextZ,ge--),K?K.nextZ=W:$=W,W.prevZ=K,K=W;V=q}K.nextZ=null,Te*=2}while(j>1);return $}function w($,U,V,q,W){return($=1431655765&(($=858993459&(($=252645135&(($=16711935&(($=32767*($-V)*W)|$<<8))|$<<4))|$<<2))|$<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U=32767*(U-q)*W)|U<<8))|U<<4))|U<<2))|U<<1))<<1}function b($){var U=$,V=$;do(U.x<V.x||U.x===V.x&&U.y<V.y)&&(V=U),U=U.next;while(U!==$);return V}function S($,U,V,q,W,K,j,ee){return(W-j)*(U-ee)-($-j)*(K-ee)>=0&&($-j)*(q-ee)-(V-j)*(U-ee)>=0&&(V-j)*(K-ee)-(W-j)*(q-ee)>=0}function T($,U){return $.next.i!==U.i&&$.prev.i!==U.i&&!D($,U)&&(z($,U)&&z(U,$)&&B($,U)&&(E($.prev,$,U.prev)||E($,U.prev,U))||C($,U)&&E($.prev,$,$.next)>0&&E(U.prev,U,U.next)>0)}function E($,U,V){return(U.y-$.y)*(V.x-U.x)-(U.x-$.x)*(V.y-U.y)}function C($,U){return $.x===U.x&&$.y===U.y}function O($,U,V,q){var W=N(E($,U,V)),K=N(E($,U,q)),j=N(E(V,q,$)),ee=N(E(V,q,U));return W!==K&&j!==ee||!(W!==0||!I($,V,U))||!(K!==0||!I($,q,U))||!(j!==0||!I(V,$,q))||!(ee!==0||!I(V,U,q))}function I($,U,V){return U.x<=Math.max($.x,V.x)&&U.x>=Math.min($.x,V.x)&&U.y<=Math.max($.y,V.y)&&U.y>=Math.min($.y,V.y)}function N($){return $>0?1:$<0?-1:0}function D($,U){var V=$;do{if(V.i!==$.i&&V.next.i!==$.i&&V.i!==U.i&&V.next.i!==U.i&&O(V,V.next,$,U))return!0;V=V.next}while(V!==$);return!1}function z($,U){return E($.prev,$,$.next)<0?E($,U,$.next)>=0&&E($,$.prev,U)>=0:E($,U,$.prev)<0||E($,$.next,U)<0}function B($,U){var V=$,q=!1,W=($.x+U.x)/2,K=($.y+U.y)/2;do V.y>K!=V.next.y>K&&V.next.y!==V.y&&W<(V.next.x-V.x)*(K-V.y)/(V.next.y-V.y)+V.x&&(q=!q),V=V.next;while(V!==$);return q}function k($,U){var V=new le($.i,$.x,$.y),q=new le(U.i,U.x,U.y),W=$.next,K=U.prev;return $.next=U,U.prev=$,V.next=W,W.prev=V,q.next=V,V.prev=q,K.next=q,q.prev=K,q}function Y($,U,V,q){var W=new le($,U,V);return q?(W.next=q.next,W.prev=q,q.next.prev=W,q.next=W):(W.prev=W,W.next=W),W}function Z($){$.next.prev=$.prev,$.prev.next=$.next,$.prevZ&&($.prevZ.nextZ=$.nextZ),$.nextZ&&($.nextZ.prevZ=$.prevZ)}function le($,U,V){this.i=$,this.x=U,this.y=V,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ne($,U,V,q){for(var W=0,K=U,j=V-q;K<V;K+=q)W+=($[j]-$[K])*($[K+1]+$[j+1]),j=K;return W}return e.deviation=function($,U,V,q){var W=U&&U.length,K=W?U[0]*V:$.length,j=Math.abs(ne($,0,K,V));if(W)for(var ee=0,ge=U.length;ee<ge;ee++){var Te=U[ee]*V,Fe=ee<ge-1?U[ee+1]*V:$.length;j-=Math.abs(ne($,Te,Fe,V))}var _e=0;for(ee=0;ee<q.length;ee+=3){var me=q[ee]*V,Ce=q[ee+1]*V,Ne=q[ee+2]*V;_e+=Math.abs(($[me]-$[Ne])*($[Ce+1]-$[me+1])-($[me]-$[Ce])*($[Ne+1]-$[me+1]))}return j===0&&_e===0?0:Math.abs((_e-j)/j)},e.flatten=function($){for(var U=$[0][0].length,V={vertices:[],holes:[],dimensions:U},q=0,W=0;W<$.length;W++){for(var K=0;K<$[W].length;K++)for(var j=0;j<U;j++)V.vertices.push($[W][K][j]);W>0&&(q+=$[W-1].length,V.holes.push(q))}return V},e},(Rse=Ase())!==void 0&&(Cse.exports=Rse);const F2=iwe.exports,aU=fe.getLogger("esri.views.3d.support.buffer.math");function h3(e,t,i){if(e.count!==t.count)return void aU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],m=i[12],y=i[13],v=i[14],w=e.typedBuffer,b=e.typedBufferStride,S=t.typedBuffer,T=t.typedBufferStride;for(let E=0;E<r;E++){const C=E*b,O=E*T,I=S[O],N=S[O+1],D=S[O+2];w[C]=s*I+a*N+h*D+m,w[C+1]=n*I+l*N+p*D+y,w[C+2]=o*I+c*N+f*D+v}}function Bv(e,t,i){if(e.count!==t.count)return void aU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,w=t.typedBufferStride;for(let b=0;b<r;b++){const S=b*y,T=b*w,E=v[T],C=v[T+1],O=v[T+2];m[S]=s*E+a*C+h*O,m[S+1]=n*E+l*C+p*O,m[S+2]=o*E+c*C+f*O}}function Cj(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function cZ(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function QKe(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:h3,transformMat3:Bv,scale:Cj,normalize:cZ,shiftRight:QKe},Symbol.toStringTag,{value:"Module"}));function lU(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&_(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function JKe(e,t){if(_(e.symbol))return e.symbol;const i=lU(e,t);return _(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function cwt(e,t){const i=lU(e,t),r=JKe(e,t);if(A(r))return null;const s={renderer:i,symbol:r};if(A(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=Xq(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function KKe(e,t){if(_(e.symbol))return e.symbol;const i=lU(e,t);return _(i)&&i.getSymbolAsync(e,t)}async function uwt(e,t){const i=lU(e,t),r=await KKe(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=Xq(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=qe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function eet(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function tet(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function rwe(e,t,i){var C;const r=e.byteLength/(4*t),s=new Uint32Array(e,0,r*t);let n=new Uint32Array(r);const o=(C=i==null?void 0:i.minReduction)!=null?C:0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let O=0;O<c.length-1;O++){const I=c[O+1]-c[O];I>h&&(h=I)}else h=r;const p=Math.floor(1.1*h)+1;(yp==null||yp.length<2*p)&&(yp=new Uint32Array(GS(2*p)));for(let O=0;O<2*p;O++)yp[O]=0;let f=0;const m=!!c&&!!a,y=m?l:r,v=m?new Uint32Array(l):null,w=1.96;let b=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,S=1,T=c?c[1]:y;for(let O=0;O<y;O++){if(O===b){const k=1-f/O;if(k+w*Math.sqrt(k*(1-k)/O)<o)return null;b*=2}if(O===T){for(let k=0;k<2*p;k++)yp[k]=0;if(a)for(let k=c[S-1];k<c[S];k++)v[k]=n[a[k]];T=c[++S]}const I=m?a[O]:O,N=I*t,D=set(s,N,t);let z=D%p,B=f;for(;yp[2*z+1]!==0;){if(yp[2*z]===D){const k=yp[2*z+1]-1;if(iet(s,N,k*t,t)){B=n[k];break}}z++,z>=p&&(z-=p)}B===f&&(yp[2*z]=D,yp[2*z+1]=I+1,f++),n[I]=B}if(o!==0&&1-f/r<o)return null;if(m){for(let O=c[S-1];O<v.length;O++)v[O]=n[a[O]];n=v}const E=new Uint32Array(t*f);f=0;for(let O=0;O<y;O++)n[O]===f&&(ret(s,(m?a[O]:O)*t,E,f*t,t),f++);if(a&&!m){const O=new Uint32Array(l);for(let I=0;I<O.length;I++)O[I]=n[a[I]];n=O}return{buffer:E.buffer,indices:n,uniqueCount:f}}function iet(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function ret(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function set(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let yp=null;function hwt(e){const t=d3(e.rings,e.hasZ,Uf.CCW_IS_HOLE),i=[];let r=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(F2(h,p,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=net(i,r,s),o=rwe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function net(e,t,i){if(e.length===1)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function d3(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=e[m].length;const p=new Float64Array(3*h);let f=0;for(let m=r-1;m>=0;m--){const y=e[m],v=i===Uf.CCW_IS_HOLE&&oet(y);if(v&&r!==1)s[a++]=y;else{let w=y.length;for(let S=0;S<a;++S)w+=s[S].length;const b={index:f,pathLengths:new Array(a+1),count:w,holeIndices:new Array(a)};b.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=v?wI(y,y.length-1,-1,p,f,y.length,t):wI(y,0,1,p,f,y.length,t);for(let S=0;S<a;++S){const T=s[S];b.holeIndices[S]=f,b.pathLengths[S+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=wI(T,0,1,p,f,T.length,t)}a=0,b.count>0&&(n[l++]=b)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=wI(y,0,1,p,f,y.length,t)}return l<r&&(n.length=l),c<r&&(o.length=c),{position:p,polygons:n,outlines:o}}function wI(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,t+=i}return s/3}function oet(e){return!QH(e,!1,!1)}var Uf;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Uf||(Uf={}));var UR,Aj;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(UR||(UR={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(Aj||(Aj={}));var Pr,ph,Nt,U2,fs,Rn;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(Pr||(Pr={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(ph||(ph={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(Nt||(Nt={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(U2||(U2={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(fs||(fs={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(Rn||(Rn={}));class aet{constructor(t,i){this.vec3=t,this.id=i}}function kR(e,t,i,r){return new aet(Ue(e,t,i),r)}var ba;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(ba||(ba={}));class Ose{constructor(t,i){this.index=t,this.renderTargets=i,this._extent=Dt(),this.resolution=0,this.renderLocalOrigin=kR(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new uet,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===ba.ColorAndWater?this.renderTargets.getTarget(fs.Color):t===ba.Highlight?this.renderTargets.getTarget(fs.Highlight):this.renderTargets.getTarget(fs.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(fs.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(fs.Color):null}getNormalTexture(t){const i=t===ba.ColorAndWater?this.renderTargets.getTarget(fs.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==fs.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?w2.CHANGED:w2.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[fs.Color]|+t[fs.ColorNoRasterImage]<<1|+t[fs.Highlight]<<2|+t[fs.Water]<<3|+t[fs.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this._extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];cN(this._extent,t.range,0,r)}if(this._extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];cN(this._extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Mg(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===Pr.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function cet(e,t,i){return Math.min(GS(Math.max(e,t)+256),i)}class uet{constructor(){this.extents=[Dt(),Dt(),Dt()],this.numViews=0}}class swe{constructor(t,i){this.size=hY(),this._fbo=null,this._fbo=new wr(t,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Xe(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this.size[0]=t,this.size[1]=i,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0}}class het{constructor(t){const i=(r,s,n=!0)=>({type:s,fbo:new swe(t,n),renderPass:r,valid:!1,lastUsed:1/0});this.renderTargets=[i(Ge.MATERIAL,fs.Color),i(Ge.MATERIAL,fs.ColorNoRasterImage),i(Ge.MATERIAL_HIGHLIGHT,fs.Highlight,!1),i(Ge.MATERIAL_NORMAL,fs.Water),i(Ge.MATERIAL,fs.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>det)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const det=1e3;class uZ{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}class nwe{constructor(t){this._context=t,this._perConstructorInstances=new uZ,this._frameCounter=0,this._keepAliveFrameCount=Mse}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(A(s)){const n=new t(this._context,i,()=>this.release(n));s=new pet(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(_(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(A(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);A(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Mse&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>{l.technique.reload(this._context)}))};t.push(s(i,r))}),await Promise.all(t)}}class pet{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const Mse=-1,cU=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var r;for(const s of(r=this._managedDisposables)!=null?r:[]){const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class uU extends cU(class{}){}function go(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(r=(i=e._managedDisposables)==null?void 0:i.slice())!=null?r:[]),e._managedDisposables.unshift(t)}}const fet=fe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class owe{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new uZ}dispose(){this._textureRepository.dispose()}acquire(t,i){this._ownMaterial(t);let r=this._id2glMaterialRef.get(i,t.id);if(A(r)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});r=new met(s),this._id2glMaterialRef.set(i,t.id,r)}return r.ref(),r.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);_(r)&&(r.unref(),r.referenced||(Xe(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){_(t.repository)&&t.repository!==this&&fet.error("Material is already owned by a different material repository"),t.repository=this}}class met{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,dt(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const get={orderedRepackingEnabled:!1},yet={rootOrigin:null},vet=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class k2{constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Xr,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),Xr.clearPool(),Rj[0]=null,x_.prune(),C1.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=Xr.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}Xr.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=Xr.acquire();for(const s of t){const n=_(i)?i:o2(this._objectToBoundingSphere(s),Tet);GA(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}Xr.release(r),this._shrink()}update(t,i){if(!GA(i[3])&&this._isDegenerate(t))return;const r=xet(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=wu(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=wu(t,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=kz(t,i),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!rv(r,f))return;const m=M0(t,i,f),y=m-f[3],v=m+f[3];y<o&&(o=y,a=v,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!rv(r,p.bounds)||(oe($u,c,p.halfSize),de($u,$u,p.bounds),M0(t,i,$u)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},t,i),l}forEachInDepthRange(t,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:v=>{r===k2.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,v.near),c=Math.min(c,v.far)):(l=Math.max(l,-v.far),c=Math.min(c,-v.near))}};h.setRange(s);const p=M0(i,r,t),f=kz(i,r),m=kz(i,-r),y=v=>{if(!a(v))return;const w=this._objectToBoundingSphere(v),b=w,S=M0(i,r,b)-p,T=S-w[3],E=S+w[3];T>c||E<l||!rv(o,w)||n(v,h)};this._forEachNodeDepthOrdered(this._root,v=>{if(!rv(o,v.bounds)||(oe($u,f,v.halfSize),de($u,$u,v.bounds),M0(i,r,$u)-p>c)||(oe($u,m,v.halfSize),de($u,$u,v.bounds),M0(i,r,$u)-p<l))return!1;const w=v.node;return w.terminals.forAll(b=>y(b)),w.residents!==null&&w.residents.forAll(b=>y(b)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}forEachNeighbor(t,i){const r=mg(i),s=i,n=o=>{const a=this._objectToBoundingSphere(o),l=mg(a),c=r+l;pn(a,s)-c*c<=0&&t(o)};this._forEachNode(this._root,o=>{const a=mg(o.bounds),l=r+a;if(pn(o.bounds,s)-l*l>0)return!1;const c=o.node;return c.terminals.forAll(h=>n(h)),c.residents!==null&&c.residents.forAll(h=>n(h)),!0}),this.forEachDegenerateObject(n)}_intersectsNode(t,i){return xI(i.bounds,2*-i.halfSize,Wc),xI(i.bounds,2*i.halfSize,Xc),Wie(t.origin,t.direction,Wc,Xc)}_intersectsNodeWithOffset(t,i,r){return xI(i.bounds,2*-i.halfSize,Wc),xI(i.bounds,2*i.halfSize,Xc),r.applyToMinMax(Wc,Xc),Wie(t.origin,t.direction,Wc,Xc)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||W9(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||W9(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=Xr.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(Xr.acquire().init(r).advance(n));Xr.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=k2.DepthOrder.FRONT_TO_BACK){let n=Xr.acquire().init(t);const o=[n];for(wet(r,s,$se);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=$se[a];n.node.children[l]&&o.push(Xr.acquire().init(n).advance(l))}Xr.release(n)}}_remove(t,i,r){x_.clear();const s=r.advanceTo(i,(n,o)=>{x_.push(n.node),x_.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=x_.length-2;n>=0;n-=2){const o=x_.data[n],a=x_.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Vt({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=Xr.acquire().init(t);this._add(i.getItemAt(r),s),Xr.release(s)}}_grow(t,i){if(i!==0&&(Pse(t,i,r=>this._objectToBoundingSphere(r),vp),GA(vp[3])&&!this._fitsInsideTree(vp)))if(this._nodeIsEmpty(this._root.node))o2(vp,this._root.bounds),this._root.halfSize=1.25*vp[3];else{const r=this._rootBoundsForRootAsSubNode(vp);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(vp,r):this._growRootAsSubNode(r),Xr.release(r)}}_rebuildTree(t,i){se(Bz,i.bounds),Bz[3]=i.halfSize,Pse([t,Bz],2,s=>s,Vz);const r=Xr.acquire().init(this._root);this._root.initFrom(null,Vz,1.25*Vz[3]),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),Xr.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(r[a]-i),c=r[a]+i-(n[a]+o),h=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),TI[a].min=h,TI[a].max=p}for(let a=0;a<3;a++){let l=TI[a].min,c=TI[a].max;const h=(s-(l+c))/2;l+=Math.ceil(h),c+=Math.floor(h);const p=n[a]-o-l*o*2;zz[a]=p+(c+l)*o}return zz[3]=s*o*lwe,Xr.acquire().initFrom(null,zz,s*o,0)}_growRootAsSubNode(t){const i=this._root.node;se(vp,this._root.bounds),vp[3]=this._root.halfSize,this._root.init(t),t.advanceTo(vp,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!GA(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class Xr{constructor(){this.bounds=mn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=_(t)?t:Xr.createEmptyNode(),_(i)&&o2(i,this.bounds),this.halfSize=r,this.depth=s,this}advance(t){let i=this.node.children[t];i||(i=Xr.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=awe[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*lwe,this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Vt({shrink:!0}),residents:new Vt({shrink:!0})}}static acquire(){return Xr._pool.acquire()}static release(t){Xr._pool.release(t)}static clearPool(){Xr._pool.prune()}}function _et(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function bet(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function xI(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function Pse(e,t,i,r){if(t===1){const s=i(e[0]);o2(s,r)}else{Wc[0]=1/0,Wc[1]=1/0,Wc[2]=1/0,Xc[0]=-1/0,Xc[1]=-1/0,Xc[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);GA(n[3])&&(_et(Wc,n),bet(Xc,n))}tn(r,Wc,Xc,.5),r[3]=Math.max(Xc[0]-Wc[0],Xc[1]-Wc[1],Xc[2]-Wc[2])/2}}function wet(e,t,i){if(!C1.length)for(let r=0;r<8;++r)C1.push({index:0,distance:0});for(let r=0;r<8;++r){const s=awe[r];C1.data[r].index=r,C1.data[r].distance=M0(e,t,s)}C1.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=C1.data[r].index}function kz(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=M0(e,t,Ise[s]);n<i&&(i=n,r=Ise[s])}return r}function M0(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function GA(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}Xr._pool=new vs(Xr),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(k2||(k2={}));const awe=[Ue(-1,-1,-1),Ue(1,-1,-1),Ue(-1,1,-1),Ue(1,1,-1),Ue(-1,-1,1),Ue(1,-1,1),Ue(-1,1,1),Ue(1,1,1)],Ise=[Ue(-1,-1,-1),Ue(-1,-1,1),Ue(-1,1,-1),Ue(-1,1,1),Ue(1,-1,-1),Ue(1,-1,1),Ue(1,1,-1),Ue(1,1,1)],lwe=Math.sqrt(3),Rj=[null];function xet(e){return Rj[0]=e,Rj}const zz=mn(),$u=M(),Wc=M(),Xc=M(),x_=new Vt,Tet=mn(),vp=mn(),Bz=mn(),Vz=mn(),TI=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],C1=new Vt,$se=[0,0,0,0,0,0,0,0],qd=k2;class cwe extends e3{constructor(t,i=""){var r,s,n;super(),this.apiLayerUid=i,this.type=cp.Layer,this.events=new Kr,this.isSliceable=!1,this._objects=new Vt,this._stageHandles=new Ht,this.apiLayerUid=i,this.isVisible=(r=t==null?void 0:t.isVisible)!=null?r:!0,this.isPickable=(s=t==null?void 0:t.isPickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:b2.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of vet)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),_(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),_(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),_(this._octree)&&this._octree.add(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),_(this._octree)&&this._octree.remove(i)}}sync(){_(this._stage)&&this.updatePolicy!==b2.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){_(this._octree)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return A(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=at(this._octree)}_createOctree(){this._octree=new qd(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function MF(e){return _(e)&&e.type===cp.Layer}class uwe{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{_(t)&&this._repository.release(this._material,hw(i))})}load(t,i){this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,hw(i)));const r=this._map.get(i);if(_(r)){if(r.ensureResources(t)===Wl.LOADED)return r;this._repository.requestRender()}return null}}function hw(e){switch(e){case Ge.MATERIAL:return J.Color;case Ge.MATERIAL_ALPHA:return J.Alpha;case Ge.MATERIAL_DEPTH:return J.Depth;case Ge.MATERIAL_NORMAL:return J.Normal;case Ge.MATERIAL_DEPTH_SHADOWMAP_ALL:return J.Shadow;case Ge.MATERIAL_HIGHLIGHT:return J.Highlight;case Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return J.Shadow}}const Dse=8;function hwe(e,t){const i=e.vertex;i.uniforms.add(new We("intrinsicWidth",r=>r.width)),t.vvSize?(e.attributes.add(R.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new xt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new xt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new xt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new xt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(R.SIZE,"float"),i.code.add(x`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(R.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new Ho("vvOpacityValues",r=>r.vvOpacityValues,Dse),new Ho("vvOpacityOpacities",r=>r.vvOpacityOpacities,Dse)]),i.code.add(x`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(x`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(R.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",Jd),i.uniforms.add(new Ho("vvColorValues",r=>r.vvColorValues,Jd)),i.uniforms.add(new K5("vvColorColors",r=>r.vvColorColors,Jd)),i.code.add(x`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(R.COLOR,"vec4"),i.code.add(x`vec4 getColor(){
return applyOpacity(color);
}`))}function e_(e,t){e.fragment.include(yc),t.output===J.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===J.Depth&&e.fragment.code.add(x`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function Eet(e){return A(e)?bf:e.length===4?e:Xi(Cet,e[0],e[1],e[2],1)}const Cet=Gt();function dwe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?Aet(e,t):Ret(e)}function Aet(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:r,fragment:s}=e;s.include(yc),r.uniforms.add(new $i("stipplePatternPixelSize")),t.draped||(Ff(r,t),r.uniforms.add(new We("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(x`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),r.code.add(x`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Oet};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(x`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(x`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new We("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(x`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?x`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new $r("stipplePatternTexture")),s.uniforms.add(new $i("stipplePatternSDFNormalizer")),s.uniforms.add(new $i("stipplePatternTextureSize")),s.uniforms.add(new $i("stipplePatternPixelSizeInv")),s.code.add(x`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),s.code.add(x`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?x`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:x`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?x`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?x`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:x`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?x`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:x`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new ti("stippleOffColor",n=>Eet(n.stippleOffColor))),s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Ret(e){e.fragment.code.add(x`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const Oet=x.float(.4);var Ch;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(Ch||(Ch={}));class kr extends qo{constructor(){super(...arguments),this.output=J.Color,this.capType=Ch.BUTT,this.transparencyPassType=gt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}u([G({count:J.COUNT})],kr.prototype,"output",void 0),u([G({count:Ch.COUNT})],kr.prototype,"capType",void 0),u([G({count:gt.COUNT})],kr.prototype,"transparencyPassType",void 0),u([G()],kr.prototype,"occluder",void 0),u([G()],kr.prototype,"hasSlicePlane",void 0),u([G()],kr.prototype,"hasPolygonOffset",void 0),u([G()],kr.prototype,"writeDepth",void 0),u([G()],kr.prototype,"draped",void 0),u([G()],kr.prototype,"stippleEnabled",void 0),u([G()],kr.prototype,"stippleOffColorEnabled",void 0),u([G()],kr.prototype,"stippleScaleWithLineWidth",void 0),u([G()],kr.prototype,"stipplePreferContinuous",void 0),u([G()],kr.prototype,"roundJoins",void 0),u([G()],kr.prototype,"vvSize",void 0),u([G()],kr.prototype,"vvColor",void 0),u([G()],kr.prototype,"vvOpacity",void 0),u([G()],kr.prototype,"falloffEnabled",void 0),u([G()],kr.prototype,"innerColorEnabled",void 0),u([G()],kr.prototype,"hasOccludees",void 0),u([G()],kr.prototype,"hasMultipassTerrain",void 0),u([G()],kr.prototype,"cullAboveGround",void 0),u([G()],kr.prototype,"wireframe",void 0),u([G({constValue:!0})],kr.prototype,"stippleRequiresClamp",void 0),u([G({constValue:!0})],kr.prototype,"stippleRequiresStretchMeasure",void 0),u([G({constValue:!0})],kr.prototype,"hasVvInstancing",void 0),u([G({constValue:!0})],kr.prototype,"hasSliceTranslatedView",void 0);const PF=1;function Met(e){const t=new Hi,i=e.hasMultipassTerrain&&(e.output===J.Color||e.output===J.Alpha);t.include(I5),t.include(hwe,e),t.include(dwe,e),e.output===J.Depth&&t.include(e_,e),mu(t,e);const{vertex:r,fragment:s}=t;r.uniforms.add([new yr("inverseProjectionMatrix",(f,m)=>m.camera.inverseProjectionMatrix),new fi("nearFar",(f,m)=>m.camera.nearFar),new We("miterLimit",f=>f.join!=="miter"?0:f.miterLimit),new ti("viewport",(f,m)=>m.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.SUBDIVISIONFACTOR,"float"),t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.AUXPOS1,"vec3"),t.attributes.add(R.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const n=e.capType===Ch.ROUND,o=e.stippleEnabled&&e.stippleScaleWithLineWidth||n;o&&t.varyings.add("vLineWidth","float");const a=e.stippleEnabled&&e.stippleScaleWithLineWidth;a&&t.varyings.add("vLineSizeInv","float");const l=e.innerColorEnabled||n;l&&t.varyings.add("vLineDistance","float");const c=e.stippleEnabled&&n,h=e.falloffEnabled||c;h&&t.varyings.add("vLineDistanceNorm","float"),n&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(x`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new We("pixelRatio",(f,m)=>m.camera.pixelRatio)),r.code.add(x`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${o?x`vLineWidth = lineWidth;`:""}
      ${a?x`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||n)&&r.code.add(x`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${n?x`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(x`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(x`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?x`min(1.0, subdivisionFactor * ${x.float((PF+2)/(PF+1))})`:x`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(x`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=e.capType!==Ch.BUTT;return r.code.add(x`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?x`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(x`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${h||l?x`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${l?x`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${h?x`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),n&&r.code.add(x`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new We("worldToScreenRatio",(f,m)=>1/m.screenToPCSRatio)):r.code.add(x`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(x`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(x`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(x`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.code.add(x`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(x`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(Su,e),t.include(cs,e),s.include(Yf),s.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?s.code.add(x`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(n&&s.code.add(x`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${x.float(Eo)}) {
        discard;
      }
    `),c?s.code.add(x`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${x.float(Eo)}, stippleCoverage);
      `):s.code.add(x`float stippleAlpha = getStippleAlpha();`),s.uniforms.add(new ti("intrinsicColor",f=>f.color)),s.code.add(x`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(s.uniforms.add(new ti("innerColor",f=>vt(f.innerColor,f.color))),s.uniforms.add(new We("innerWidth",(f,m)=>f.innerWidth*m.camera.pixelRatio)),s.code.add(x`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),s.code.add(x`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(s.uniforms.add(new We("falloff",f=>f.falloff)),s.code.add(x`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),s.code.add(x`
    if (finalColor.a < ${x.float(Eo)}) {
      discard;
    }

    ${e.output===J.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===J.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===J.Color&&e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===J.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===J.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const Pet=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:PF,build:Met},Symbol.toStringTag,{value:"Module"})),hZ={func:hr.LESS},IF={func:hr.ALWAYS},kf={mask:255},pwe={mask:0},Iet=e=>({function:{func:hr.NOTEQUAL,ref:e,mask:e},operation:{fail:Jr.KEEP,zFail:Jr.KEEP,zPass:Jr.KEEP}}),$et=e=>({function:{func:hr.ALWAYS,ref:e,mask:e},operation:{fail:Jr.KEEP,zFail:Jr.KEEP,zPass:Jr.REPLACE}}),t_={function:{func:hr.ALWAYS,ref:fl.OutlineVisualElementMask,mask:fl.OutlineVisualElementMask},operation:{fail:Jr.KEEP,zFail:Jr.KEEP,zPass:Jr.ZERO}},Vv={function:{func:hr.ALWAYS,ref:fl.OutlineVisualElementMask,mask:fl.OutlineVisualElementMask},operation:{fail:Jr.KEEP,zFail:Jr.KEEP,zPass:Jr.REPLACE}},fwe={function:{func:hr.EQUAL,ref:fl.OutlineVisualElementMask,mask:fl.OutlineVisualElementMask},operation:{fail:Jr.KEEP,zFail:Jr.KEEP,zPass:Jr.KEEP}},mwe={function:{func:hr.NOTEQUAL,ref:fl.OutlineVisualElementMask,mask:fl.OutlineVisualElementMask},operation:{fail:Jr.KEEP,zFail:Jr.KEEP,zPass:Jr.KEEP}},gwe=new Map([[R.POSITION,0],[R.SUBDIVISIONFACTOR,1],[R.UV0,2],[R.AUXPOS1,3],[R.AUXPOS2,4],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.OPACITYFEATUREATTRIBUTE,7]]);class hU extends cr{constructor(t,i,r){super(t,i,r),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const i=hU.shader.get().build(this.configuration);return new er(t.rctx,i,gwe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}_makePipelineState(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:r.output===J.Color||r.output===J.Alpha?s?gu:ey(t):null,depthTest:{func:Kv(t)},depthWrite:s?r.writeDepth&&wl:eU(t),colorWrite:Kt,stencilWrite:r.hasOccludees?kf:null,stencilTest:r.hasOccludees?i?Vv:t_:null,polygonOffset:s||n?r.hasPolygonOffset&&Lse:iU})}initializePipeline(){const t=this.configuration;if(t.occluder){const i=t.hasPolygonOffset&&Lse;this._occluderPipelineTransparent=Ut({blending:gu,polygonOffset:i,depthTest:IF,depthWrite:null,colorWrite:Kt,stencilWrite:null,stencilTest:mwe}),this._occluderPipelineOpaque=Ut({blending:gu,polygonOffset:i,depthTest:IF,depthWrite:null,colorWrite:Kt,stencilWrite:pwe,stencilTest:fwe}),this._occluderPipelineMaskWrite=Ut({blending:null,polygonOffset:i,depthTest:hZ,depthWrite:null,colorWrite:null,stencilWrite:kf,stencilTest:Vv})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Pt.LINES:Pt.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Se.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Se.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}hU.shader=new Ki(Pet,()=>import("./RibbonLine.glsl.b8bfc370.js"));const Lse={factor:0,units:-4},Det=fe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var zl;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(zl||(zl={}));class iS extends Qf{constructor(t){super(t,new Net),this._vertexAttributeLocations=gwe,this.techniqueConfig=new kr,this.layout=this.createLayout()}isClosed(t,i){return ywe(this.parameters,t,i)}getConfiguration(t,i){this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Se.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern)&&t!==J.Highlight;return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&_(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===Or.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectDrapedLineGeometry(t,i,r,s,n){if(!i.options.selectionMode)return;const o=t.vertexAttributes.get(R.POSITION).data,a=t.vertexAttributes.get(R.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const y=t.vertexAttributes.get(R.SIZEFEATUREATTRIBUTE).data[0];l*=De(this.parameters.vvSizeOffset[0]+y*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],h=s[1],p=(l/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],w=o[y+1],b=c-v,S=h-w,T=o[y+3]-v,E=o[y+4]-w,C=De((T*b+E*S)/(T*T+E*E),0,1),O=T*C-b,I=E*C-S,N=O*O+I*I;N<f&&(f=N,m=y/3)}f<p*p&&n(r.dist,r.normal,m,!1)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||t3(i))return;if(!E_e(r))return void Det.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(R.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const b=o.get(R.SIZEFEATUREATTRIBUTE).data[0];l*=De(this.parameters.vvSizeOffset[0]+b*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(R.SIZE)&&(l*=o.get(R.SIZE).data[0]);const c=s.camera,h=Uet;ro(h,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;te(cC[0],h[0]-p,h[1]+p,0),te(cC[1],h[0]+p,h[1]+p,0),te(cC[2],h[0]+p,h[1]-p,0),te(cC[3],h[0]-p,h[1]-p,0);for(let b=0;b<4;b++)if(!c.unprojectFromRenderScreen(cC[b],lm[b]))return;Go(c.eye,lm[0],lm[1],jz),Go(c.eye,lm[1],lm[2],Hz),Go(c.eye,lm[2],lm[3],qz),Go(c.eye,lm[3],lm[0],Wz);let f=Number.MAX_VALUE,m=0;const y=Oj(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let b=0;b<y;b+=3){za[0]=a[b]+r[12],za[1]=a[b+1]+r[13],za[2]=a[b+2]+r[14];const S=(b+3)%a.length;if(Ba[0]=a[S]+r[12],Ba[1]=a[S+1]+r[13],Ba[2]=a[S+2]+r[14],sr(jz,za)<0&&sr(jz,Ba)<0||sr(Hz,za)<0&&sr(Hz,Ba)<0||sr(qz,za)<0&&sr(qz,Ba)<0||sr(Wz,za)<0&&sr(Wz,Ba)<0)continue;if(c.projectToRenderScreen(za,S_),c.projectToRenderScreen(Ba,E_),S_[2]<0&&E_[2]>0){pe(_p,za,Ba);const E=c.frustum,C=-sr(E[rr.NEAR],za)/xe(_p,E[rr.NEAR]);oe(_p,_p,C),de(za,za,_p),c.projectToRenderScreen(za,S_)}else if(S_[2]>0&&E_[2]<0){pe(_p,Ba,za);const E=c.frustum,C=-sr(E[rr.NEAR],Ba)/xe(_p,E[rr.NEAR]);oe(_p,_p,C),de(Ba,Ba,_p),c.projectToRenderScreen(Ba,E_)}else if(S_[2]<0&&E_[2]<0)continue;S_[2]=0,E_[2]=0;const T=yW(Cb(S_,E_,Use),h);T<f&&(f=T,se(Nse,za),se(Fse,Ba),m=b/3)}const v=s.rayBegin,w=s.rayEnd;if(f<p*p){let b=Number.MAX_VALUE;if(dfe(Cb(Nse,Fse,Use),Cb(v,w,ket),T_)){pe(T_,T_,v);const S=Oe(T_);oe(T_,T_,1/S),b=S/or(v,w)}n(b,T_,m,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=t.indices,n=r.get(R.POSITION);return yY(n,s?s.get(R.POSITION):null,s&&Oj(this.parameters,r,s),i)}createLayout(){const t=es().vec3f(R.POSITION).f32(R.SUBDIVISIONFACTOR).vec2f(R.UV0).vec3f(R.AUXPOS1).vec3f(R.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(R.SIZEFEATUREATTRIBUTE):t.f32(R.SIZE),this.parameters.vvColorEnabled?t.f32(R.COLORFEATUREATTRIBUTE):t.vec4f(R.COLOR),this.parameters.vvOpacityEnabled&&t.f32(R.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Fet(this.layout,this.parameters)}requiresSlot(t,i){if(t===Se.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Or.OccludeAndTransparentStencil)return t===Se.OPAQUE_MATERIAL||t===Se.OCCLUDER_MATERIAL||t===Se.TRANSPARENT_OCCLUDER_MATERIAL;const r=hw(i);return r===J.Color||r===J.Alpha?t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Se.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===J.Color||t.output===J.Alpha||t.output===J.Highlight||t.output===J.Depth?new Let(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class Let extends Qv{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==J.Color&&this._output!==J.Alpha||this._updateOccludeeState(t),this.ensureTechnique(hU,t)}}class Net extends QY{constructor(){super(...arguments),this.width=0,this.color=vh,this.join="miter",this.cap=Ch.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Fet{constructor(t,i){this.parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=PF+r}}_isClosed(t){return Oj(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(R.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s){var k;const n=zet,o=Bet,a=Vet,l=i.vertexAttributes.get(R.POSITION).data,c=i.indices&&i.indices.get(R.POSITION),h=(k=i.vertexAttributes.get(R.DISTANCETOSTART))==null?void 0:k.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,f=0;this.parameters.vvSizeEnabled?f=i.vertexAttributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(R.SIZE)&&(p=i.vertexAttributes.get(R.SIZE).data[0]);let m=[1,1,1,1],y=0;this.parameters.vvColorEnabled?y=i.vertexAttributes.get(R.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(R.COLOR)&&(m=i.vertexAttributes.get(R.COLOR).data);let v=0;this.parameters.vvOpacityEnabled&&(v=i.vertexAttributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const w=l.length/3,b=t.transformation,S=new Float32Array(r.buffer),T=this.vertexBufferLayout.stride/4;let E=s*T;const C=E;let O=0;const I=h?(Y,Z,le)=>O=h[le]:(Y,Z,le)=>O+=or(Y,Z),N=(Y,Z,le,ne,$,U,V)=>{if(S[E++]=Z[0],S[E++]=Z[1],S[E++]=Z[2],S[E++]=ne,S[E++]=V,S[E++]=$,S[E++]=Y[0],S[E++]=Y[1],S[E++]=Y[2],S[E++]=le[0],S[E++]=le[1],S[E++]=le[2],this.parameters.vvSizeEnabled?S[E++]=f:S[E++]=p,this.parameters.vvColorEnabled)S[E++]=y;else{const q=Math.min(4*U,m.length-4);S[E++]=m[q+0],S[E++]=m[q+1],S[E++]=m[q+2],S[E++]=m[q+3]}this.parameters.vvOpacityEnabled&&(S[E++]=v)};E+=T,te(o,l[0],l[1],l[2]),b&&ke(o,o,b);const D=this._isClosed(i);if(D){const Y=l.length-3;te(n,l[Y],l[Y+1],l[Y+2]),b&&ke(n,n,b)}else te(a,l[3],l[4],l[5]),b&&ke(a,a,b),N(o,o,a,1,zl.LEFT_CAP_START,0,0),N(o,o,a,1,zl.RIGHT_CAP_START,0,0),se(n,o),se(o,a);const z=D?0:1,B=D?w:w-1;for(let Y=z;Y<B;Y++){const Z=(Y+1)%w*3;te(a,l[Z+0],l[Z+1],l[Z+2]),b&&ke(a,a,b),I(n,o,Y),N(n,o,a,0,zl.LEFT_JOIN_END,Y,O),N(n,o,a,0,zl.RIGHT_JOIN_END,Y,O);const le=this.numJoinSubdivisions;for(let ne=0;ne<le;++ne){const $=(ne+1)/(le+1);N(n,o,a,$,zl.LEFT_JOIN_END,Y,O),N(n,o,a,$,zl.RIGHT_JOIN_END,Y,O)}N(n,o,a,1,zl.LEFT_JOIN_START,Y,O),N(n,o,a,1,zl.RIGHT_JOIN_START,Y,O),se(n,o),se(o,a)}D?(te(a,l[3],l[4],l[5]),b&&ke(a,a,b),O=I(n,o,B),N(n,o,a,0,zl.LEFT_JOIN_END,z,O),N(n,o,a,0,zl.RIGHT_JOIN_END,z,O)):(O=I(n,o,B),N(n,o,o,0,zl.LEFT_CAP_END,B,O),N(n,o,o,0,zl.RIGHT_CAP_END,B,O)),Gz(S,C+T,S,C,T),E=Gz(S,E-T,S,E,T),this.parameters.wireframe&&this._addWireframeVertices(r,C,E,T)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=Gz(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function Gz(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function Oj(e,t,i){return ywe(e,t.get(R.POSITION).data,i?i.get(R.POSITION):null)}function ywe(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const za=M(),Ba=M(),_p=M(),T_=M(),Uet=M(),S_=wo(),E_=wo(),Nse=M(),Fse=M(),Use=Hf(),ket=Hf(),zet=M(),Bet=M(),Vet=M(),cC=[wo(),wo(),wo(),wo()],lm=[M(),M(),M(),M()],jz=_i(),Hz=_i(),qz=_i(),Wz=_i();class dZ{constructor(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+hl()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){const h=yet.rootOrigin;if(_(h))return this._origins.set(this._rootOriginId,kR(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=kR(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),o=Math.round(t[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(pe(Dn,t,i.vec3),Dn[0]=Math.abs(Dn[0]),Dn[1]=Math.abs(Dn[1]),Dn[2]=Math.abs(Dn[2]),Dn[0]<c&&Dn[1]<c&&Dn[2]<c){if(l){const h=Math.max(...Dn);if(pe(Dn,t,l.vec3),Dn[0]=Math.abs(Dn[0]),Dn[1]=Math.abs(Dn[1]),Dn[2]=Math.abs(Dn[2]),Math.max(...Dn)<h)return l}return i}return l||(l=kR(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(t,i=gi(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new iS({width:2,color:i}),s.add(this._material);const m=new cwe({isPickable:!1}),y=new iy({castShadow:!1});s.add(y),m.add(y),s.add(m),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Uint16Array(2*(l-1)),p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&(h[2*m+0]=m-1,h[2*m+1]=m);lr(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Mr([[R.POSITION,{size:3,data:c,exclusive:!0}]],[[R.POSITION,h]],ml.Line);s.add(f),o.addGeometry(f,this._material,en)}}const Dn=M();class vwe{constructor(t,i,r,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new Qi,this.pass=Ge.MATERIAL,this.renderOccludedMask=kse,this.bindParameters=new F5(i,r,_(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=kse}get isHighlightPass(){return this.pass===Ge.MATERIAL_HIGHLIGHT}}class Get extends vwe{constructor(t,i,r,s,n){super(t,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n}}const kse=Or.Occlude|Or.OccludeAndTransparent|Or.OccludeAndTransparentStencil;var z2;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(z2||(z2={}));class SI{constructor(){this.camera=new Qi,this.lightMat=Ae()}}class pZ{constructor(t,i,r=0){this.rctx=t,this.viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Gt(),this._cascades=[new SI,new SI,new SI,new SI],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=r}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return Xi(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=De(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&_(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const i=this._snapshots.length;if(t>i){const r=t-i;this._snapshots.length=t;for(let s=0;s<r;++s)this._snapshots[i+s]=null}else if(t<this.snapshotCount){const r=i-t;for(let s=0;s<r;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)Yz[t]=this._cascades[t];return Yz.length=this.numCascades,Yz}start(t,i,r){dt(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,a,o,i);this.lastOrigin=null,this.clear()}finish(t){dt(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!ll(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||M(),se(this.lastOrigin,t);for(let i=0;i<this.numCascades;++i){Ia(Yse,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)Zse[16*i+r]=Yse[r]}}return Zse}takeCascadeSnapshotTo(t,i){dt(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this.rctx,n=s.bindTexture(r,st.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(pt.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,st.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(Zi.COLOR_BUFFER_BIT|Zi.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(_(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new st(this.rctx,t),this._fbo=new wr(this.rctx,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let i=this._snapshots[t];if(_(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(t);const r={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new st(this.rctx,r),this._snapshots[t]=i,i}_discardDepthTexture(){this._fbo=Xe(this._fbo),this._depthTexture=Xe(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=Xe(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,i,r,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);dt(l<c);for(let p=0;p<8;++p){Xi(Gse,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),lu(Fl[p],Gse,Vse);for(let f=0;f<3;++f)Fl[p][f]/=Fl[p][3]}Wo(Xz,Fl[0]),Ia(zse,Xse,Xz),n.camera.viewMatrix=zse;for(let p=0;p<8;++p)ke(Fl[p],Fl[p],n.camera.viewMatrix);se(bp,Fl[0]),se(wp,Fl[0]);for(let p=1;p<8;++p)for(let f=0;f<3;++f)bp[f]=Math.min(bp[f],Fl[p][f]),wp[f]=Math.max(wp[f],Fl[p][f]);bp[2]-=200,wp[2]+=200,n.camera.near=-wp[2],n.camera.far=-bp[2],this.warp?this._constructTrapezoidalProjection(r,s,n):this._constructOrthogonalProjection(n),Fr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:h,n.camera.viewport[1]=Math.floor(t/2)===0?0:h,n.camera.viewport[2]=h,n.camera.viewport[3]=h}_constructOrthogonalProjection(t){rW(t.camera.projectionMatrix,bp[0],wp[0],bp[1],wp[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,i,r){const s=1/Fl[0][3],n=1/Fl[4][3];dt(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(rn(t[2]*i[0]+t[6]*i[1]+t[10]*i[2]));o/=a,Het(Fl,o,a,jse,Hse,jet,qse,Wse),qet(jse,Hse,qse,Wse,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(bp[2]-wp[2]),r.camera.projectionMatrix[14]=-(bp[2]+wp[2])/(bp[2]-wp[2])}_setupMatrices(t,i){Fr(Bse,t.projectionMatrix,t.viewMatrix),us(Vse,Bse);const r=this.viewingMode===Ve.Global?t.eye:te(Xz,0,0,1);G4(Xse,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this.numCascades=Math.min(1+Math.floor(aqe(t/i,4)),this.maxNumCascades);const r=(t-i)/this.numCascades,s=(t/i)**(1/this.numCascades);let n=i,o=i;for(let a=0;a<this.numCascades+1;++a)this._cascadeDistances[a]=qt(n,o,this.splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+Kb(s),(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){t.splitSchemeLambda=i},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(i){t.warp=i},get warp(){return t.warp}}}}const zse=Ae(),Bse=Ae(),Vse=Ae(),Gse=Gt(),Fl=[];for(let e=0;e<8;++e)Fl.push(Gt());const bp=M(),wp=M(),jse=tt(),Hse=tt(),jet=tt(),qse=tt(),Wse=tt(),Xse=Ae(),Xz=M(),Yz=[],Yse=Ae(),Zse=new Float32Array(64),Sc=tt(),lx=tt(),C_=[tt(),tt(),tt(),tt()],sn=tt(),Zz=tt(),by=tt(),uC=tt(),cx=tt(),ux=tt(),EI=tt();function Het(e,t,i,r,s,n,o,a){pi(Sc,0,0);for(let C=0;C<4;++C)Rd(Sc,Sc,e[C]);Jl(Sc,Sc,.25),pi(lx,0,0);for(let C=4;C<8;++C)Rd(lx,lx,e[C]);Jl(lx,lx,.25),wT(C_[0],e[4],e[5],.5),wT(C_[1],e[5],e[6],.5),wT(C_[2],e[6],e[7],.5),wT(C_[3],e[7],e[4],.5);let l=0,c=eF(C_[0],Sc);for(let C=1;C<4;++C){const O=eF(C_[C],Sc);O<c&&(c=O,l=C)}df(sn,C_[l],e[l+4]);const h=sn[0];let p,f;sn[0]=-sn[1],sn[1]=h,df(Zz,lx,Sc),Vs(Zz,sn)<0&&HX(sn,sn),wT(sn,sn,Zz,i),OO(sn,sn),p=f=Vs(df(by,e[0],Sc),sn);for(let C=1;C<8;++C){const O=Vs(df(by,e[C],Sc),sn);O<p?p=O:O>f&&(f=O)}ro(r,Sc),Jl(by,sn,p-t),Rd(r,r,by);let m=-1,y=1,v=0,w=0;for(let C=0;C<8;++C){df(uC,e[C],r),OO(uC,uC);const O=sn[0]*uC[1]-sn[1]*uC[0];O>0?O>m&&(m=O,v=C):O<y&&(y=O,w=C)}Qw(m>0,"leftArea"),Qw(y<0,"rightArea"),Jl(cx,sn,p),Rd(cx,cx,Sc),Jl(ux,sn,f),Rd(ux,ux,Sc),EI[0]=-sn[1],EI[1]=sn[0];const b=GP(r,e[w],ux,Rd(by,ux,EI),1,s),S=GP(r,e[v],ux,by,1,n),T=GP(r,e[v],cx,Rd(by,cx,EI),1,o),E=GP(r,e[w],cx,by,1,a);Qw(b,"rayRay"),Qw(S,"rayRay"),Qw(T,"rayRay"),Qw(E,"rayRay")}function ci(e,t){return 3*t+e}const Qse=tt();function Cl(e,t){return pi(Qse,e[t],e[t+3]),Qse}const Va=tt(),Ze=Sr();function qet(e,t,i,r,s){df(Va,i,r),Jl(Va,Va,.5),Ze[0]=Va[0],Ze[1]=Va[1],Ze[2]=0,Ze[3]=Va[1],Ze[4]=-Va[0],Ze[5]=0,Ze[6]=Va[0]*Va[0]+Va[1]*Va[1],Ze[7]=Va[0]*Va[1]-Va[1]*Va[0],Ze[8]=1,Ze[ci(0,2)]=-Vs(Cl(Ze,0),e),Ze[ci(1,2)]=-Vs(Cl(Ze,1),e);let n=Vs(Cl(Ze,0),i)+Ze[ci(0,2)],o=Vs(Cl(Ze,1),i)+Ze[ci(1,2)],a=Vs(Cl(Ze,0),r)+Ze[ci(0,2)],l=Vs(Cl(Ze,1),r)+Ze[ci(1,2)];n=-(n+a)/(o+l),Ze[ci(0,0)]+=Ze[ci(1,0)]*n,Ze[ci(0,1)]+=Ze[ci(1,1)]*n,Ze[ci(0,2)]+=Ze[ci(1,2)]*n,n=1/(Vs(Cl(Ze,0),i)+Ze[ci(0,2)]),o=1/(Vs(Cl(Ze,1),i)+Ze[ci(1,2)]),Ze[ci(0,0)]*=n,Ze[ci(0,1)]*=n,Ze[ci(0,2)]*=n,Ze[ci(1,0)]*=o,Ze[ci(1,1)]*=o,Ze[ci(1,2)]*=o,Ze[ci(2,0)]=Ze[ci(1,0)],Ze[ci(2,1)]=Ze[ci(1,1)],Ze[ci(2,2)]=Ze[ci(1,2)],Ze[ci(1,2)]+=1,n=Vs(Cl(Ze,1),t)+Ze[ci(1,2)],o=Vs(Cl(Ze,2),t)+Ze[ci(2,2)],a=Vs(Cl(Ze,1),i)+Ze[ci(1,2)],l=Vs(Cl(Ze,2),i)+Ze[ci(2,2)],n=-.5*(n/o+a/l),Ze[ci(1,0)]+=Ze[ci(2,0)]*n,Ze[ci(1,1)]+=Ze[ci(2,1)]*n,Ze[ci(1,2)]+=Ze[ci(2,2)]*n,n=Vs(Cl(Ze,1),t)+Ze[ci(1,2)],o=Vs(Cl(Ze,2),t)+Ze[ci(2,2)],a=-o/n,Ze[ci(1,0)]*=a,Ze[ci(1,1)]*=a,Ze[ci(1,2)]*=a,s[0]=Ze[0],s[1]=Ze[1],s[2]=0,s[3]=Ze[2],s[4]=Ze[3],s[5]=Ze[4],s[6]=0,s[7]=Ze[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Ze[6],s[13]=Ze[7],s[14]=0,s[15]=Ze[8]}class _we{constructor(){this.adds=new Vt,this.removes=new Vt,this.updates=new Vt({allocator:t=>t||new Wet,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class Wet{}class Xet{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var Qt;(function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"})(Qt||(Qt={}));function bwe(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new Xet,t.set(r,s)),s};return e.removes.forAll(r=>{Qz(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{Qz(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{Qz(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function Qz(e){return e.data.indexCount>=1}function Yet(e){const t=x`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function dU(e,t){t.normalType===xr.Attribute&&(e.attributes.add(R.NORMAL,"vec3"),e.vertex.code.add(x`vec3 normalModel() {
return normal;
}`)),t.normalType===xr.CompressedAttribute&&(e.include(Yet),e.attributes.add(R.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(x`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===xr.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var xr;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(xr||(xr={}));function pU(e){e.attributes.add(R.POSITION,"vec3"),e.vertex.code.add(x`vec3 positionModel() { return position; }`)}function $F({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(x`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(x`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function p3(e){return!!he("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function ES(e,t){e.include(pU);const i=e.vertex;i.include($F,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new xt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new xt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new o3("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new yr("transformProjFromView",r=>r.transformProjFromView),new DO("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Oa("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Oa("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(x`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(x`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?x`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:x`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new xt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class wwe extends Us{constructor(){super(...arguments),this.transformWorldFromViewTH=M(),this.transformWorldFromViewTL=M(),this.transformViewFromCameraRelativeRS=Sr(),this.transformProjFromView=Ae()}}class xwe extends Us{constructor(){super(...arguments),this.transformWorldFromModelRS=Sr(),this.transformWorldFromModelTH=Si(),this.transformWorldFromModelTL=Si()}}function fU(e,t){t.normalType===xr.Attribute||t.normalType===xr.CompressedAttribute?(e.include(dU,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new DO("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new o3("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),e.vertex.code.add(x`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===xr.Ground?(e.include(ES,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(x`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?x`normalize(vPositionWorldCameraRelative);`:x`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(x`void forwardNormal() {}`)}class Twe extends wwe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Sr()}}class Swe extends xwe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Sr(),this.toMapSpace=Gt()}}class Mj extends Swe{constructor(t=M()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function f3(e,t){t.output===J.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(x`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===J.Depth||t.output===J.Shadow?(e.include(ES,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new fi("nearFar",(i,r)=>r.camera.nearFar)),e.vertex.code.add(x`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(x`void forwardLinearDepth() {}`)}function ov(e,t){t.spherical?e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class m3 extends Hr{constructor(t,i){super(t,"int",Li.Pass,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}class Ewe extends Hr{constructor(t,i,r,s){switch(i){case Li.Pass:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s);case Li.Draw:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s)}}}class Cwe extends Us{constructor(){super(...arguments),this.origin=M()}}function mU(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new Ewe("shadowMapMatrix",Li.Pass,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),Awe(e))}function dw(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new Ewe("shadowMapMatrix",Li.Draw,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),Awe(e))}function Awe(e){const t=e.fragment;t.include(yc),t.uniforms.add([new zt("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new m3("numCascades",(i,r)=>r.shadowMap.numCascades),new ti("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances),new We("depthHalfPixelSz",(i,r)=>.5/r.shadowMap.textureSize)]),t.code.add(x`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function Zet(e){e.fragment.code.add(x`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Qet(e){e.fragment.code.add(x`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function Jet(e){const t=e.fragment.code;t.add(x`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(x`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(x`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function gU(e,t){const i=e.fragment.code;e.include(I5),t.pbrMode===Rt.Water||t.pbrMode===Rt.WaterOnIntegratedMesh?(i.add(x`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(x`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(x`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(x`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(x`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==Rt.Normal&&t.pbrMode!==Rt.Schematic||(e.include(Jet),i.add(x`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(x`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(x`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(x`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(x`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(x`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function Rwe(e,t){e.include(gU,t),e.include(M5),e.include(Qet),t.hasCloudsReflections&&e.include(o_e,t),t.hasScreenSpaceReflections&&e.include(DHe,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(x`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new We("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new We("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(x`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(x`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(x`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(x`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor;
}`)}function Jse(e){e.fragment.uniforms.add(new $r("texWaveNormal")),e.fragment.uniforms.add(new $r("texWavePerturbation")),e.fragment.uniforms.add([new ti("waveParams",t=>Xi(Ket,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new fi("waveDirection",t=>pi(ett,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(Zet),e.fragment.code.add(x`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Ket=Gt(),ett=tt();function ttt(e){const t=new Hi,{vertex:i,fragment:r}=t,s=mu(t,e);return t.include(To),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.UV0,"vec2"),i.uniforms.add(new ti("waterColor",n=>n.color)),e.output!==J.Color&&e.output!==J.Alpha||(t.include(ov,e),t.include(f3,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),r.uniforms.add(s),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Eo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===J.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(Su,e),e.output===J.Alpha&&(t.include(cs,e),r.uniforms.add(new Ca("waterColor")),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===J.Color&&(t.include(nY,{isGround:!1}),t.include(sY,{pbrMode:Rt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(Jse),t.include(cs,e),t.include(dw,e),t.include(Rwe,e),r.uniforms.add([new Ca("waterColor"),new xt("lightingMainDirection",(n,o)=>o.lighting.lightingMainDirection),new xt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity),new We("timeElapsed",n=>n.timeElapsed),new Mv("view")]),Ff(r,e),r.include(Yf),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?x`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===J.Normal&&(t.include(ov,e),t.include(Jse,e),t.include(cs,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Eo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new We("timeElapsed",n=>n.timeElapsed)),r.code.add(x`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===J.Draped&&(t.varyings.add("vpos","vec3"),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Eo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Ca("waterColor")),r.code.add(x`void main() {
gl_FragColor = waterColor;
}`)),e.output===J.Highlight&&(t.include(Kg),t.varyings.add("vpos","vec3"),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Eo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(cs,e),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const itt=Object.freeze(Object.defineProperty({__proto__:null,build:ttt},Symbol.toStringTag,{value:"Module"}));class yU extends cr{constructor(t,i,r){super(t,i,r),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global,i.doublePrecisionRequiresObfuscation=p3(t.rctx)}initializeProgram(t){const i=yU.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}bindPass(t,i){this.program.bindPass(t,i),this.configuration.output!==J.Color&&this.configuration.output!==J.Normal||this._textureRepository.bind(this.program)}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace;return Ut({blending:i.output!==J.Normal&&i.output!==J.Highlight&&i.transparent?r?gu:ey(t):null,depthTest:{func:Kv(t)},depthWrite:r?i.writeDepth&&wl:eU(t),colorWrite:Kt,polygonOffset:r||s?null:rU(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}yU.shader=new Ki(itt,()=>import("./WaterSurface.glsl.47023e7e.js"));class Vn extends qo{constructor(){super(...arguments),this.output=J.Color,this.transparencyPassType=gt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([G({count:J.COUNT})],Vn.prototype,"output",void 0),u([G({count:gt.COUNT})],Vn.prototype,"transparencyPassType",void 0),u([G()],Vn.prototype,"spherical",void 0),u([G()],Vn.prototype,"receiveShadows",void 0),u([G()],Vn.prototype,"hasSlicePlane",void 0),u([G()],Vn.prototype,"transparent",void 0),u([G()],Vn.prototype,"enableOffset",void 0),u([G()],Vn.prototype,"writeDepth",void 0),u([G()],Vn.prototype,"hasScreenSpaceReflections",void 0),u([G()],Vn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([G()],Vn.prototype,"hasCloudsReflections",void 0),u([G()],Vn.prototype,"isDraped",void 0),u([G()],Vn.prototype,"hasMultipassTerrain",void 0),u([G()],Vn.prototype,"cullAboveGround",void 0),u([G({constValue:Rt.Water})],Vn.prototype,"pbrMode",void 0),u([G({constValue:!0})],Vn.prototype,"useCustomDTRExponentForWater",void 0),u([G({constValue:!0})],Vn.prototype,"highStepCount",void 0),u([G({constValue:!1})],Vn.prototype,"useFillLights",void 0);class Kse extends Qv{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const i=_(t.clouds.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(t){const i=this._techniqueRepository.constructionContext.waterTextureRepository;return i.resourceState===Wl.NOT_LOADED&&i.loadTextures(t),i.resourceState}beginSlot(t){return this._output===J.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this.ensureTechnique(yU,t)}}const rtt=es().vec3f(R.POSITION),stt=es().vec3f(R.POSITION).vec2f(R.UV0),Owe=es().vec3f(R.POSITION).vec4u8(R.COLOR);class vU{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(R.POSITION).length}write(t,i,r,s){J5(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}class Mwe extends Qf{constructor(t){super(t,new Pwe),this._techniqueConfig=new Vn,this.animation=new O_e}getConfiguration(t,i){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=i.transparencyPassType,this._techniqueConfig.enableOffset=i.camera.relativeElevation<tU,this._techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<ntt;const r=this.animation.advance(t);return this.setParameters({timeElapsed:jH(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}intersect(t,i,r,s,n,o,a){Z5(t,i,s,n,o,void 0,a)}requiresSlot(t,i){switch(hw(i)){case J.Normal:return t===Se.DRAPED_WATER;case J.Color:if(this.parameters.isDraped)return t===Se.DRAPED_MATERIAL;break;case J.Highlight:return t===Se.OPAQUE_MATERIAL||t===Se.DRAPED_MATERIAL}let r=Se.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){if(t.output===J.Color&&this.parameters.isDraped)return t.output=J.Draped,new Kse(t);switch(t.output){case J.Color:case J.Normal:case J.Highlight:case J.Alpha:return new Kse(t)}return null}createBufferWriter(){return new vU(stt)}}class Pwe extends wE{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Ii(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=gi(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const ntt=35e3;class ene{constructor(t){this.first=t.from,this.count=t.to-t.from}}class TT{constructor(t=0,i=0){this.from=t,this.to=i}}class ott extends TT{constructor(t,i,r,s,n,o){super(i,r),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function tne(e){return Array.from(e.values()).sort(att)}function att(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function CI(e,t){if(e.length===0)return void e.push(new ene(t));const i=e[e.length-1];if(ltt(i,t)){const r=t.from-i.first+t.to-t.from;i.count=r}else e.push(new ene(t))}function ltt(e,t){return e.first+e.count>=t.from}class ctt{constructor(t,i){this._pool=t,this._size=0,this._buffer=t.newBuffer(Pj(i))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,i){let r;const s=utt(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);i&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.byteLength)),r=this._buffer,this._buffer=o}const n=this._size;return this._size=t,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(o,a,l)=>this._buffer.array.set(r.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,i){this._buffer.array.fill(0,t,i)}}const ine=65536;function Pj(e){return Math.ceil(e/ine)*ine}function utt(e,t,i){return t<=i?e>=i?e:Pj(Math.max(2*e,i)):e<=2*i?e:Pj(i)}class htt{constructor(t,i,r,s){this.vao=new Ns(t,i,{geometry:r},{geometry:ii.createVertex(t,bi.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const dtt=xD+1;class ptt{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${hl()}`,ftt)}dispose(){this._cache.destroy()}newBuffer(t){const i=t.toString(),r=this._cache.pop(i);if(_(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,s.array.byteLength*r.length,dtt),s}return new htt(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const i=t.array.byteLength,r=t.array.length.toString(),s=this._cache.pop(r);return _(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function ftt(e,t){if(t===Km.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}class Iwe{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new Vt,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new uwe(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new ptt(t,r.vertexAttributeLocations,vc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof Mwe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==Or.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,i){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=gtt(t,i);o.forEach((a,l)=>{o.delete(l);const c=a.toAdd.reduce((b,S)=>b+r.elementCount(S.data),0);let h=n.get(l);if(h==null)dt(a.toRemove.length===0),h=new vtt(a.origin,new ctt(this._bufferPool,c*s)),n.set(l,h);else if(a.toAdd.length===0&&h.instances.size===a.toRemove.length)return h.buffer.dispose(),void n.delete(l);let p=0;h.instances.forEach(b=>p+=b.to-b.from);const f=a.toRemove.reduce((b,S)=>b+r.elementCount(S.data),0),m=h.buffer.size,y=(p+c-f)*s,v=btt;if(y<m/2?this._removeAndRebuild(h,a.toRemove,s,y,v):a.toRemove.length>0&&this._remove(h,a.toRemove,s,v),a.toAdd.length>0){const b=wtt;S_e(b,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(h,a.toAdd,s,b,v)}const w=h.buffer.vao.vertexBuffers.geometry;nne(v),v.forAll(({from:b,to:S})=>{if(b<S){const T=h.buffer.array,E=4,C=b*E,O=S*E;w.setSubData(T,C,C,O)}}),v.clear(),h.drawCommandsDirty=!0})}_updateGeometries(t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&Qt.State.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(Qt.State.HIGHLIGHTS|Qt.State.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&Qt.State.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(Qt.State.VERTEXATTRS|Qt.State.TRANSFORMATION)){const{array:c,vao:h}=o.buffer;DWe(n,Jz,hC),i.write({transformation:Jz,invTranspTransformation:hC},n.data,i.vertexBufferLayout.createView(c.buffer),a.from),dt(a.from+i.elementCount(n.data)===a.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(c,a.from*r*4,a.from*r*4,a.to*r*4)}o.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(i=>{i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Ws(i.instances,r=>(r.isVisible?(r.hasHighlights&&(this._hasHighlights=!0,i.hasHighlights=!0),r.hasOccludees&&(this._hasOccludees=!0,i.hasOccludees=!0)):i.hasHiddenInstances=!0,i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees))});const t=i=>{if(i.drawCommandsDefault=null,i.drawCommandsHighlight=null,i.drawCommandsOccludees=null,i.drawCommandsShadowHighlightRest=null,i.instances.size===0)return;if(!sne(i)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*i.buffer.size/s;return void(i.drawCommandsDefault=[{first:0,count:n}])}const r=tne(i.instances);i.drawCommandsDefault=[],i.drawCommandsHighlight=[],i.drawCommandsOccludees=[],i.drawCommandsShadowHighlightRest=[];for(const s of r)s.isVisible&&(s.hasOccludees?CI(i.drawCommandsOccludees,s):CI(i.drawCommandsDefault,s),s.hasHighlights?CI(i.drawCommandsHighlight,s):CI(i.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(i=>{i.drawCommandsDirty&&(t(i),i.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,i){return t==null||this._material.requiresSlot(t,i)}render(t,i){if(!this.requiresSlot(i.slot,t))return!1;const r=t===Ge.MATERIAL_HIGHLIGHT||t===Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(r&&!this._hasHighlights)return!1;const s=t===Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(r||s);if(this._dataByOrigin.forEach(c=>{if(r&&!c.hasHighlights)return;const h=(r?c.drawCommandsHighlight:s&&sne(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,p=n&&c.drawCommandsOccludees||null;(_(h)||_(p))&&this._renderCommandData.push(new _tt(c.origin,c.buffer,h,p))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(A(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(i);return o.bindTechnique(l,this._material.parameters,i,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,i);const{buffer:h,renderCommands:p,occludeeCommands:f}=c;l.ensureAttributeLocations(h.vao),o.bindVAO(h.vao);const m=l.primitiveType;_(p)&&this._renderCommands(o,m,p),_(f)&&(l.bindPipelineState(o,i.slot,!0),this._renderCommands(o,m,f),l.bindPipelineState(o,i.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,i,r){for(let s=0;s<r.length;s++)t.drawArrays(i,r[s].first,r[s].count)}_removeAndRebuild(t,i,r,s,n){for(const h of i)t.instances.delete(h.id);const o=tne(t.instances);t.instances.clear();const a=t.buffer.size,l=t.buffer.alloc(s);let c=0;for(const h of o){const p=h.from*r,f=h.to*r;l.copy(c,p,f),h.from=c/r,c+=f-p,h.to=c/r,t.instances.set(h.id,h)}n.push(new TT(0,l.hasNewBuffer?t.buffer.array.length:a)),l.dispose(),t.buffer.erase(c,n.back().to),t.holes.clear()}_remove(t,i,r,s){for(const n of i){const o=n.id,a=t.instances.get(o),l=a.from*r,c=a.to*r;t.buffer.erase(l,c),t.holes.push(new TT(a.from,a.to)),t.instances.delete(o),s.push(new TT(l,c))}nne(t.holes)}_add(t,i,r,s,n){if(i.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const p of i){const f=_(p.transformation)?Fr(Jz,s,p.transformation):s;us(hC,f);const m=bl(hC,hC),y=o.elementCount(p.data),v=y*r;let w=ytt(t.holes,y);A(w)&&(w=t.buffer.size/r,t.buffer.grow(v),a=o.vertexBufferLayout.createView(t.buffer.array.buffer)),o.write({transformation:f,invTranspTransformation:m},p.data,a,w);const b=p.instanceParameters.visible,S=!!p.instanceParameters.highlights&&b,T=!!p.instanceParameters.occludees,E=new ott(p.id,w,w+y,b,S,T);dt(t.instances.get(p.id)==null),t.instances.set(p.id,E),l?n.push(new TT(E.from*r,E.to*r)):(c=Math.min(E.from,c),h=Math.max(E.to,h))}l||n.push(new TT(c*r,h*r))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class mtt{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function gtt(e,t){const i=new Map;for(const r of e)rne(i,r,!0);for(const r of t)rne(i,r,!1);return i}function rne(e,t,i){const r=t.origin;if(A(r))return;let s=e.get(r.id);s==null&&(s=new mtt(r.vec3),e.set(r.id,s)),i?s.toAdd.push(t):s.toRemove.push(t)}function sne(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function ytt(e,t){let i;if(!e.some(s=>!(s.to-s.from<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function nne(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class vtt{constructor(t,i){this.origin=t,this.buffer=i,this.instances=new Map,this.holes=new Vt({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class _tt extends Mj{constructor(t,i,r,s){super(t),this.buffer=i,this.renderCommands=r,this.occludeeCommands=s}}const btt=new Vt({deallocator:null}),wtt=Ae(),Jz=Ae(),hC=Ae();let tf=class extends Ee{constructor(e){super(e),this._pending=new xtt,this._changes=new _we,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Vt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Ws(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=bwe(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new Iwe(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,i=!0,r=!0),!o)return;const a=i||o.hasHighlights,l=r||o.hasWater;o.modify(s),i=i||a!==o.hasHighlights,r=r||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Ws(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=Ws(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const r=this._pending.empty;for(const s of i)this._pending.adds.add(s);r&&this.notifyChange("updating"),t===Qt.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const s of e)r.has(s)?(this._pending.removed.add(s),r.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===Qt.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(r),s.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case Qt.State.TRANSFORMATION:case Qt.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case Qt.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,s){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let o=0;_(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),AI[0]=i[0]-r,AI[1]=i[1]-o,AI[2]=1,RI[0]=i[0]-r,RI[1]=i[1]-o,RI[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,AI,RI,(a,l,c)=>{Ttt(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(A(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}}_notifyGraphicVisibilityChanged(e){if(A(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return A(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],tf.prototype,"drapeSource",void 0),u([d()],tf.prototype,"updating",null),u([d()],tf.prototype,"rctx",null),u([d()],tf.prototype,"rendererContext",void 0),u([d()],tf.prototype,"_materialRepository",null),u([d()],tf.prototype,"_localOriginFactory",null),tf=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],tf);class xtt{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function Ttt(e,t,i,r,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(Dr.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==io.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===io.ALL){const c=xY(s.ray);l(c),s.results.all.push(c)}}const AI=M(),RI=M();function _U(e){e.fragment.uniforms.add(new ti("projInfo",(t,i)=>Stt(i))),e.fragment.uniforms.add(new fi("zScale",(t,i)=>$we(i))),e.fragment.code.add(x`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Stt(e){const t=e.camera.projectionMatrix;return t[11]===0?Xi(one,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Xi(one,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const one=Gt();function $we(e){return e.camera.projectionMatrix[11]===0?pi(ane,0,1):pi(ane,1,0)}const ane=tt();var Gv;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(Gv||(Gv={}));class Dwe extends Da{constructor(){super(...arguments),this.output=Gv.SSAO}}u([G({count:Gv.COUNT})],Dwe.prototype,"output",void 0);const dC={samples:16,filterRadius:4};function Ett(e){const t=new Hi,i=t.fragment;if(t.include(Jv),e.output===Gv.Blur){const r=(dC.filterRadius+1)/2,s=1/(2*r*r);i.include(Tu),i.uniforms.add([new $r("normalMap"),new $r("depthMap"),new $r("tex"),new vg("blurSize"),new $i("projScale"),new fi("nearFar",(n,o)=>o.camera.nearFar)]),i.code.add(x`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${x.float(s)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(x`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${x.int(dC.filterRadius)}; r <= ${x.int(dC.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===Gv.SSAO&&(i.include(Tu),t.include(_U),i.uniforms.add(new $r("normalMap")),i.uniforms.add(new $r("depthMap")),i.uniforms.add(new $r("rnm")),i.uniforms.add(new $i("intensity")),i.uniforms.add(new $i("projScale")),i.uniforms.add(new $i("radius")),i.uniforms.add(new fi("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new vg("screenSize")),i.uniforms.add(new vg("rnmScale")),i.code.add(x`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(x`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new fi("zScale",(r,s)=>$we(s))),i.code.add(x`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${x.int(dC.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${x.int(dC.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const Ctt=Object.freeze(Object.defineProperty({__proto__:null,build:Ett},Symbol.toStringTag,{value:"Module"}));class nM extends cr{initializeProgram(t){const i=nM.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({colorWrite:Kt})}}nM.shader=new Ki(Ctt,()=>import("./SSAO.glsl.68689218.js"));class Lwe{constructor(t,i,r){this._techniqueRep=t,this._rctx=i,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new Dwe,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Xe(this.quadVAO)}disposeOffscreenBuffers(){qs(this._ssaoFBO,t=>t.resize(0,0)),qs(this._blur0FBO,t=>t.resize(0,0)),qs(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&_(this._noiseTexture)&&_(this._ssaoFBO)&&_(this._blur0FBO)&&_(this._blur1FBO)}get colorTexture(){return _(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return _(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return _(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,i,r){if(!this.enabled||A(i)||A(r)||A(this._noiseTexture)||A(this._ssaoFBO)||A(this._blur0FBO)||A(this._blur1FBO))return;const s=this._rctx,n=t.camera,o=n.fullViewport,a=o[2],l=o[3],c=a/this._blurSizePx,h=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const p=1,f=1,m=a*p,y=l*f;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const v=s.bindTechnique(this._ssaoTechnique,lne,t);v.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let w=1/n.computeRenderPixelSizeAtDist(1);v.setUniform1f("projScale",w*p),v.setUniform2f("screenSize",m,y);const b=or(n.eye,n.center);let S=20*n.computeRenderPixelSizeAtDist(b);S=Math.max(.1,S),v.setUniform1f("radius",S),v.setUniform1f("intensity",4*this._attenuation/S**6),v.bindTexture("rnm",this._noiseTexture),v.bindTexture("normalMap",r),v.bindTexture("depthMap",i),A(this.quadVAO)&&(this.quadVAO=La(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays(Pt.TRIANGLE_STRIP,0,xo(this.quadVAO,"geometry"));const T=s.bindTechnique(this._blurTechnique,lne,t);T.bindTexture("tex",this._ssaoFBO.colorTexture),T.bindTexture("normalMap",r),T.bindTexture("depthMap",i),s.setViewport(0,0,m/this._blurSizePx,y/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),T.setUniform2f("screenSize",m,y),T.setUniform2f("blurSize",0,this._blurSizePx*p/y),b>5e4&&(w=Math.max(0,w-(b-5e4))),T.setUniform1f("projScale",w),s.drawArrays(Pt.TRIANGLE_STRIP,0,xo(this.quadVAO,"geometry")),T.setUniform2f("blurSize",this._blurSizePx*f/m,0),s.bindFramebuffer(this._blur1FBO),T.bindTexture("tex",this._blur0FBO.colorTexture),s.drawArrays(Pt.TRIANGLE_STRIP,0,xo(this.quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=Gv.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(nM,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=Gv.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(nM,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():import("./SSAOHelperData.08f44d75.js").then(i=>{this._data=i,t()})}_initialize(){const t={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE};ap(this._data.noiseTexture).then(r=>{this._enabled&&(this._ssaoFBO=new wr(this._rctx,i,t),this._blur0FBO=new wr(this._rctx,i,t),this._blur1FBO=new wr(this._rctx,i,t),this._noiseTexture=new st(this._rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Xe(this._noiseTexture),this._blur1FBO=Xe(this._blur1FBO),this._blur0FBO=Xe(this._blur0FBO),this._ssaoFBO=Xe(this._ssaoFBO)}get gpuMemoryUsage(){return(_(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(_(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(_(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const lne=new Us;function Att(){const e=new Hi;return e.include(Jv),e.fragment.uniforms.add([new $r("tex"),new Ca("uColor")]),e.fragment.code.add(x`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const Rtt=Object.freeze(Object.defineProperty({__proto__:null,build:Att},Symbol.toStringTag,{value:"Module"}));class g3 extends cr{initializeProgram(t){const i=g3.shader.get().build();return new er(t.rctx,i,Ni)}initializePipeline(){return this.configuration.hasAlpha?Ut({blending:so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:Kt}):Ut({colorWrite:Kt})}}g3.shader=new Ki(Rtt,()=>import("./TextureOnly.glsl.66e338f9.js"));class fZ extends Da{constructor(){super(...arguments),this.hasAlpha=!1}}u([G()],fZ.prototype,"hasAlpha",void 0);class Nwe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=Xe(t.texture)),this.cache.clear()}_acquire(t){if(A(t))return null;const i=this._patternId(t),r=this.cache.get(i);if(r)return r.refCount++,r.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:o,pixels:a,paddedPixels:l}=Ott(t.pattern,s),c=a/s,h={refCount:1,texture:null,bind:p=>(A(h.texture)&&(h.texture=new st(this._rctx,{width:l,height:1,internalFormat:ze.RGBA,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE},n)),p.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:o,pixels:a})};return this.cache.set(i,h),h.bind}release(t){if(A(t))return;const i=this._patternId(t),r=this.cache.get(i);r&&(r.refCount--,r.refCount===0&&(_(r.texture)&&r.texture.dispose(),this.cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function Ott(e,t){const i=e.map(y=>Math.round(y*t)),r=1/t,s=Math.floor(i.reduce((y,v)=>y+v)),n=i.reduce((y,v)=>Math.max(y,v)),o=(Math.floor(.5*(n-1))+.5)*r,a=[];let l=1;for(const y of i){for(let v=0;v<y;v++){const w=l*(Math.min(v,y-1-v)+.5)*r/o*.5+.5;a.push(w)}l=-l}const c=Math.round(i[0]/2),h=[...a.slice(c),...a.slice(0,c)],p=s+2,f=new Uint8Array(4*p);let m=4;for(const y of h)eM(y,f,m),m+=4;return f.copyWithin(0,m-4,m),f.copyWithin(m,4,8),{encodedData:f,sdfNormalizer:o,paddedPixels:p,pixels:s}}var Kl,bo;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(Kl||(Kl={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(bo||(bo={}));class uL extends Da{constructor(){super(...arguments),this.function=Kl.Standard,this.alphaMode=bo.None,this.hasOpacityFactor=!1}}u([G({count:Kl.COUNT})],uL.prototype,"function",void 0),u([G({count:bo.COUNT})],uL.prototype,"alphaMode",void 0),u([G()],uL.prototype,"hasOpacityFactor",void 0);let vd=class extends cU(Ee){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Ht,this._frameTask=g2,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new Vt,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new Kr,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new Nwe(e.renderingContext),this._shaderTechniqueRepository=new nwe({rctx:this._rctx,viewingMode:Ve.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new vwe(this._rctx,new pZ(this._rctx,this.view.state.viewingMode),new Lwe(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ae(()=>t.updating,()=>this.events.emit("content-changed"),Ps),ae(()=>this.spatialReference,i=>this._localOriginFactory=new dZ(i),Ps),fn(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new owe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&DF)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Se.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=Wve(this._rctx),this._bindParameters.camera=pb,this._bindParameters.transparencyPassType=gt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new dY(Ue(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=Yi(this._debugTextureTechnique),this._debugPatternTexture=Xe(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Xe(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Xe(this._shaderTechniqueRepository),this._temporaryFBO=Xe(this._temporaryFBO),this._quadVAO=Xe(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||Ws(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return _(this._overlays)&&_(this._overlayRenderTarget)}get gpuMemoryUsage(){return _(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,tf)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);_(r)&&r.destroy();const s=new t(ve(F({},i),{rendererContext:this,drapeSource:e}));return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ae(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(A(e))return;const t=this._drapeSourceRenderers.get(e);A(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(_(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return vt(this._overlays,[])}ensureDrapeTargets(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=z$(e,i=>i.drapeTargetType===Aj.WithoutRasterImage)})}ensureDrapeSources(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=z$(e,i=>i.drapeSourceType===UR.Features),t.hasDrapedRasterSource=z$(e,i=>i.drapeSourceType===UR.RasterImage)})}ensureOverlays(e,t){A(this._overlays)&&(this._overlayRenderTarget=new het(this._rctx),this._overlays=[new Ose(Pr.INNER,this._overlayRenderTarget),new Ose(Pr.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Xe(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(_(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(fE,e=>e.updatePolicy===b2.SYNC)}isEmpty(){if(Gi.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===Ge.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===Ge.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;pb.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===Ge.MATERIAL_NORMAL?Se.DRAPED_WATER:Se.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===Pr.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(Zi.COLOR_BUFFER_BIT));const c=t.type===fs.ColorNoRasterImage?P0.ExcludeRasterImage:t.type===fs.Occluded?P0.OccludedOnly:P0.Normal;if(c===P0.OccludedOnly&&(this._renderContext.renderOccludedMask=DF),Gi.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==P0.OccludedOnly)for(let h=0;h<r.numViews;h++)this._setViewParameters(r.extents[h],e,pb),this._drawDebugTexture(e.resolution,Ptt[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:h,renderer:p})=>{if(c===P0.ExcludeRasterImage&&h.drapeSourceType===UR.RasterImage)return;const{fullOpacity:f}=h,m=_(f)&&f<1&&s===Ge.MATERIAL;m&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(Zi.COLOR_BUFFER_BIT));for(let y=0;y<r.numViews;y++)this._setViewParameters(r.extents[y],e,pb),p.render(this._renderContext,this._bindParameters);m&&_(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),bo.PremultipliedAlpha,f,Kl.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){A(this._temporaryFBO)&&(this._temporaryFBO=new swe(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){var n,o;let s=0;for(const a of this._drapeSourceRenderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,i,r,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new Mtt(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,rW(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),V4(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=Ws(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Ws(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Ws(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays(Pt.TRIANGLE_STRIP,0,xo(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let o=0;o<e;o++){const a=Math.floor(o/10),l=Math.floor(n/10);a<2||l<2||10*a>e-20||10*l>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&a&&1&l?1&o^1&n?0:255:1&a^1&l?0:128)}this._debugPatternTexture=new st(this._rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:e,height:t},i);const s=new fZ;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(g3,s),this._quadVAO=La(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var P0;u([d()],vd.prototype,"_frameTask",void 0),u([d()],vd.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([go()],vd.prototype,"_shaderTechniqueRepository",void 0),u([go()],vd.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],vd.prototype,"view",void 0),u([d()],vd.prototype,"worldToPCSRatio",void 0),u([d()],vd.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],vd.prototype,"updating",null),vd=u([P("esri.views.3d.terrain.OverlayRenderer")],vd),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(P0||(P0={}));class Mtt{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const Ptt=[[1,.5,.5],[.5,.5,1]],pb=new Qi;pb.near=1,pb.far=1e4,pb.relativeElevation=null;const mZ=-2,DF=Or.OccludeAndTransparent;function cne(e){const t=[[R.POSITION,e.indices]],i=[[R.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return _(e.attributeData.color)&&(i.push([R.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([R.COLOR,new Uint32Array(e.indices.length)])),_(e.attributeData.uvMapSpace)&&(i.push([R.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([R.UVMAPSPACE,e.indices])),_(e.attributeData.boundingRect)&&(i.push([R.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([R.BOUNDINGRECT,e.indices])),_(e.attributeData.mapPosition)&&(i.push([R.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([R.MAPPOS,e.indices])),new Mr(i,t)}function une(e){const t=[[R.POSITION,e.indices],[R.UV0,e.indices]],i=[[R.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[R.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return _(e.attributeData.mapPosition)&&(i.push([R.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([R.MAPPOS,e.indices])),new Mr(i,t)}function oM(e){switch(e.type){case"extent":if(e instanceof ri)return Ao.fromExtent(e);break;case"polygon":return e}return null}function gZ(e,t,i,r){const s=d3(e.rings,e.hasZ,Uf.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=Vbe(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=o!=null;return{position:s.position,mapPosition:n,polygons:kwe(s.polygons,s.position,n),outlines:Uwe(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function Fwe(e,t){const i=d3(e.rings,!1,Uf.CCW_IS_HOLE),r=lr(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=mZ;return{position:i.position,polygons:kwe(i.polygons,i.position),outlines:Uwe(i.outlines,i.position),projectionSuccess:r}}function Uwe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({index:s,count:n,position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function kwe(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,h=o.map(p=>p-s);r.push({index:s,count:n,holeIndices:h,pathLengths:a,position:t.subarray(l,c),mapPosition:i?i.subarray(l,c):void 0})}return r}function zwe(e,t){const i=e.fragment;switch(i.code.add(x`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case Nr.None:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Nr.View:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Nr.WindingOrder:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case Nr.COUNT:}}var Nr;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(Nr||(Nr={}));function Bwe(e){e.vertex.code.add(x`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function Vwe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(R.MODELORIGINHI,"vec3"),e.attributes.add(R.MODELORIGINLO,"vec3"),e.attributes.add(R.MODEL,"mat3"),e.attributes.add(R.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include($F,t),i.uniforms.add(new Oa("viewOriginHi",(r,s)=>IWe(te(OI,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),OI))),i.uniforms.add(new Oa("viewOriginLo",(r,s)=>$We(te(OI,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),OI)))),i.code.add(x`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(x`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?x`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(x`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===J.Normal&&(i.uniforms.add(new yr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),i.code.add(x`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(x`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const OI=M();var ys;function Gwe(e){switch(e){case"multiply":default:return ys.Multiply;case"ignore":return ys.Ignore;case"replace":return ys.Replace;case"tint":return ys.Tint}}function jwe(e,t,i){if(A(e)||t===ys.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=De(Math.round(e[3]*LF),0,LF),s=r===0||t===ys.Tint?0:t===ys.Replace?Itt:$tt;i[0]=De(Math.round(e[0]*hx),0,hx),i[1]=De(Math.round(e[1]*hx),0,hx),i[2]=De(Math.round(e[2]*hx),0,hx),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(ys||(ys={}));const hx=255,LF=85,Itt=LF,$tt=2*LF;function Hwe(e){e.vertex.code.add(x`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${x.int(ys.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${x.int(ys.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${x.int(ys.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${x.int(ys.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function qwe(e,t){t.hasSymbolColors?(e.include(Hwe),e.attributes.add(R.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(x`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new m3("colorMixMode",i=>ibe[i.colorMixMode])),e.vertex.code.add(x`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function Uw(e,t){t.hasVertexColors?(e.attributes.add(R.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(x`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(x`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(x`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Dtt(e){e.fragment.code.add(x`
    #define discardOrAdjustAlpha(color) { if (color.a < ${x.float(Eo)}) { discard; } }
  `)}class Wwe extends Hr{constructor(t,i){super(t,"float",Li.Draw,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function Ib(e,t){Xwe(e,t,new We("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Ltt(e,t){Xwe(e,t,new Wwe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function Xwe(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==nr.Mask&&t.alphaDiscardMode!==nr.MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case nr.Blend:return e.include(Dtt);case nr.Opaque:r.code.add(x`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case nr.Mask:r.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case nr.MaskBlend:e.fragment.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function Ywe(e,t){const i=e.vertex.code,r=e.fragment.code,s=t.hasModelTransformation;t.output!==J.Depth&&t.output!==J.Shadow||(mu(e,t),e.include(To,{linearDepth:!0,hasModelTransformation:s}),e.include(yg,t),e.include(SS,t),e.include(e_,t),e.include(cs,t),e.vertex.uniforms.add(new fi("nearFar",(n,o)=>o.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new zt("tex",n=>n.texture)),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(Ib,t),r.add(x`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===J.Normal&&(mu(e,t),e.include(To,{linearDepth:!1,hasModelTransformation:s}),e.include(dU,t),e.include(fU,t),e.include(yg,t),e.include(SS,t),t.hasColorTexture&&e.fragment.uniforms.add(new zt("tex",n=>n.texture)),e.varyings.add("vPositionView","vec3"),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===xr.Attribute?x`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(cs,t),e.include(Ib,t),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===xr.ScreenDerivative?x`
            vec3 normal = screenDerivativeNormal(vPositionView);`:x`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===J.Highlight&&(mu(e,t),e.include(To,{linearDepth:!1,hasModelTransformation:s}),e.include(yg,t),e.include(SS,t),t.hasColorTexture&&e.fragment.uniforms.add(new zt("tex",n=>n.texture)),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(cs,t),e.include(Ib,t),e.include(Kg),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function Zwe(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(R.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===Nr.WindingOrder?i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==Zs.None){e.include(KX,t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===Li.Pass?eL("normalTexture",s=>s.textureNormal,r):PR("normalTexture",s=>s.textureNormal,r)),i.code.add(x`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function y3(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new zt("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture),new ti("viewportPixelSz",(r,s)=>Xi(Ntt,s.camera.fullViewport[0],s.camera.fullViewport[1],1/s.ssaoHelper.width,1/s.ssaoHelper.height))]),i.code.add(x`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(x`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const Ntt=Gt();function pw(e,t){const i=e.fragment;e.include(y3,t),t.pbrMode!==Rt.Disabled&&e.include(gU,t),e.include(sY,t),i.constants.add("ambientBoostFactor","float",gE),e.include(I5),i.code.add(x`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Rt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new xt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection)),i.code.add(x`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?x`normalize(vPosWorld)`:x`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new We("lightingGlobalFactor",(r,s)=>s.lighting.globalFactor),new xt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(x`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===Rt.Disabled||t.pbrMode===Rt.WaterOnIntegratedMesh?(e.include(nY,t),i.code.add(x`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==Rt.Normal&&t.pbrMode!==Rt.Schematic||(i.code.add(x`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(x`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new ew("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(x`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new We("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new We("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(x`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Rt.Schematic?x`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:x`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function Qwe(e,t){const i=x`
  /*
  *  ${t.name}
  *  ${t.output===J.Color?"RenderOutput: Color":t.output===J.Depth?"RenderOutput: Depth":t.output===J.Shadow?"RenderOutput: Shadow":t.output===J.Normal?"RenderOutput: Normal":t.output===J.Highlight?"RenderOutput: Highlight":""}
  */
  `;MO()&&(e.fragment.code.add(i),e.vertex.code.add(i))}function aM(e){e.include(Yf),e.code.add(x`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${x.int(ys.Multiply)}) {
        return allMixed;
      }
      if (mode == ${x.int(ys.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(ys.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${x.int(ys.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(ys.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Ftt(e){const t=new Hi,i=t.vertex.code,r=t.fragment.code;t.include(Qwe,{name:"Default Material Shader",output:e.output});const s=mu(t,e);return t.include(pU),t.varyings.add("vpos","vec3"),t.include(SS,e),t.include(Vwe,e),t.include(X1e,e),e.output!==J.Color&&e.output!==J.Alpha||(Ff(t.vertex,e),t.include(dU,e),t.include(To,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===xr.Attribute&&e.offsetBackfaces&&t.include(Bwe),t.include(Zwe,e),t.include(fU,e),e.instancedColor&&t.attributes.add(R.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(yg,e),t.include(f3,e),t.include(qwe,e),t.include(Uw,e),t.vertex.uniforms.add(new ti("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new yr("model",n=>_(n.modelTransformation)?n.modelTransformation:en)),i.add(x`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${x.float(Eo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===xr.Attribute?x`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===xr.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===J.Alpha&&(t.include(cs,e),t.include(Ib,e),t.include(Su,e),t.fragment.uniforms.add([new We("opacity",n=>n.opacity),new We("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new zt("tex",n=>n.texture)),t.fragment.include(aM),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===J.Color&&(t.include(cs,e),t.include(pw,e),t.include(y3,e),t.include(Ib,e),t.include(e.instancedDoublePrecision?mU:dw,e),t.include(Su,e),Ff(t.fragment,e),t.fragment.uniforms.add([s,new xt("ambient",n=>n.ambient),new xt("diffuse",n=>n.diffuse),new We("opacity",n=>n.opacity),new We("layerOpacity",n=>n.layerOpacity),new We("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new xt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",gE),e.hasColorTexture&&t.fragment.uniforms.add(new zt("tex",n=>n.texture)),t.include(rY,e),t.include(gU,e),t.fragment.include(aM),t.include(zwe,e),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===xr.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(localvpos);`:x`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Rt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?x`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:x`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?x`normalize(vpos + localOrigin);`:x`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?x`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===Rt.Normal||e.pbrMode===Rt.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?x`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===gt.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(Ywe,e),t}const Utt=Object.freeze(Object.defineProperty({__proto__:null,build:Ftt},Symbol.toStringTag,{value:"Module"}));class ktt extends Twe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ue(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=ar.Back,this.emissiveFactor=Ue(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.externalColor=gi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=M(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Sr(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Qb.Less,this.textureAlphaMode=nr.Blend,this.textureAlphaCutoff=CF,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Or.Occlude}}class ztt extends Swe{constructor(){super(...arguments),this.origin=M(),this.slicePlaneLocalOrigin=this.origin}}class v3 extends cr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global,i.doublePrecisionRequiresObfuscation=p3(t.rctx),i.textureCoordinateType=i.hasColorTexture||i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Zs.Default:Zs.None}initializeProgram(t){return this._initializeProgram(t,v3.shader)}_initializeProgram(t,i){const r=i.get().build(this.configuration);return new er(t.rctx,r,Ni)}_convertDepthTestFunction(t){return t===Qb.Lequal?hr.LEQUAL:hr.LESS}_setPipeline(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:r.output!==J.Color&&r.output!==J.Alpha||!r.transparent?null:s?gu:ey(t),culling:Btt(r)&&P5(r.cullFace),depthTest:{func:Kv(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:s||n?r.writeDepth&&wl:null,colorWrite:Kt,stencilWrite:r.hasOccludees?kf:null,stencilTest:r.hasOccludees?i?Vv:t_:null,polygonOffset:s||n?null:rU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function Btt(e){return e.cullFace!==ar.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}v3.shader=new Ki(Utt,()=>import("./DefaultMaterial.glsl.84170ca6.js"));class Yt extends qo{constructor(){super(...arguments),this.output=J.Color,this.alphaDiscardMode=nr.Opaque,this.doubleSidedMode=Nr.None,this.pbrMode=Rt.Disabled,this.cullFace=ar.None,this.transparencyPassType=gt.NONE,this.normalType=xr.Attribute,this.textureCoordinateType=Zs.None,this.customDepthTest=Qb.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}u([G({count:J.COUNT})],Yt.prototype,"output",void 0),u([G({count:nr.COUNT})],Yt.prototype,"alphaDiscardMode",void 0),u([G({count:Nr.COUNT})],Yt.prototype,"doubleSidedMode",void 0),u([G({count:Rt.COUNT})],Yt.prototype,"pbrMode",void 0),u([G({count:ar.COUNT})],Yt.prototype,"cullFace",void 0),u([G({count:gt.COUNT})],Yt.prototype,"transparencyPassType",void 0),u([G({count:xr.COUNT})],Yt.prototype,"normalType",void 0),u([G({count:Zs.COUNT})],Yt.prototype,"textureCoordinateType",void 0),u([G({count:Qb.COUNT})],Yt.prototype,"customDepthTest",void 0),u([G()],Yt.prototype,"spherical",void 0),u([G()],Yt.prototype,"hasVertexColors",void 0),u([G()],Yt.prototype,"hasSymbolColors",void 0),u([G()],Yt.prototype,"hasVerticalOffset",void 0),u([G()],Yt.prototype,"hasSlicePlane",void 0),u([G()],Yt.prototype,"hasSliceHighlight",void 0),u([G()],Yt.prototype,"hasColorTexture",void 0),u([G()],Yt.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([G()],Yt.prototype,"hasEmissionTexture",void 0),u([G()],Yt.prototype,"hasOcclusionTexture",void 0),u([G()],Yt.prototype,"hasNormalTexture",void 0),u([G()],Yt.prototype,"hasScreenSizePerspective",void 0),u([G()],Yt.prototype,"hasVertexTangents",void 0),u([G()],Yt.prototype,"hasOccludees",void 0),u([G()],Yt.prototype,"hasMultipassTerrain",void 0),u([G()],Yt.prototype,"hasModelTransformation",void 0),u([G()],Yt.prototype,"offsetBackfaces",void 0),u([G()],Yt.prototype,"vvSize",void 0),u([G()],Yt.prototype,"vvColor",void 0),u([G()],Yt.prototype,"receiveShadows",void 0),u([G()],Yt.prototype,"receiveAmbientOcclusion",void 0),u([G()],Yt.prototype,"textureAlphaPremultiplied",void 0),u([G()],Yt.prototype,"instanced",void 0),u([G()],Yt.prototype,"instancedColor",void 0),u([G()],Yt.prototype,"instancedDoublePrecision",void 0),u([G()],Yt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([G()],Yt.prototype,"writeDepth",void 0),u([G()],Yt.prototype,"transparent",void 0),u([G()],Yt.prototype,"enableOffset",void 0),u([G()],Yt.prototype,"cullAboveGround",void 0),u([G()],Yt.prototype,"snowCover",void 0),u([G({constValue:!0})],Yt.prototype,"hasVvInstancing",void 0),u([G({constValue:!1})],Yt.prototype,"useCustomDTRExponentForWater",void 0),u([G({constValue:!1})],Yt.prototype,"supportsTextureAtlas",void 0),u([G({constValue:!0})],Yt.prototype,"useFillLights",void 0);function Vtt(e){const t=new Hi,i=t.vertex.code,r=t.fragment.code,s=mu(t,e);return t.include(pU),t.varyings.add("vpos","vec3"),t.include(SS,e),t.include(Vwe,e),t.include(X1e,e),e.output!==J.Color&&e.output!==J.Alpha||(Ff(t.vertex,e),t.include(dU,e),t.include(To),e.offsetBackfaces&&t.include(Bwe),e.instancedColor&&t.attributes.add(R.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(yg,e),t.include(f3,e),t.include(qwe,e),t.include(Uw,e),t.vertex.uniforms.add(new ti("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),i.add(x`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${x.float(Eo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?x`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===J.Alpha&&(t.include(cs,e),t.include(Ib,e),t.include(Su,e),t.fragment.uniforms.add([new We("opacity",n=>n.opacity),new We("layerOpacity",n=>n.layerOpacity),new Mv("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new zt("tex",n=>n.texture)),t.fragment.include(aM),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===J.Color&&(t.include(cs,e),t.include(pw,e),t.include(y3,e),t.include(Ib,e),t.include(e.instancedDoublePrecision?mU:dw,e),t.include(Su,e),Ff(t.fragment,e),t.fragment.uniforms.add([s,new xt("ambient",n=>n.ambient),new xt("diffuse",n=>n.diffuse),new We("opacity",n=>n.opacity),new We("layerOpacity",n=>n.layerOpacity),new Mv("view"),new We("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new xt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",gE),e.hasColorTexture&&t.fragment.uniforms.add(new zt("tex",n=>n.texture)),t.include(rY,e),t.include(gU,e),t.fragment.include(aM),t.extensions.add("GL_OES_standard_derivatives"),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Rt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?x`albedo = mix(albedo, vec3(1), 0.9);`:x``}
        ${x`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===Rt.Normal||e.pbrMode===Rt.Schematic?e.spherical?x`vec3 normalGround = normalize(vpos + localOrigin);`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:x``}
        ${e.pbrMode===Rt.Normal||e.pbrMode===Rt.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?x`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===gt.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:x``}
      }
    `)),t.include(Ywe,e),t}const Gtt=Object.freeze(Object.defineProperty({__proto__:null,build:Vtt},Symbol.toStringTag,{value:"Module"}));class bU extends v3{initializeConfiguration(t,i){super.initializeConfiguration(t,i),i.hasMetalnessAndRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=xr.Attribute,i.doubleSidedMode=Nr.WindingOrder,i.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,bU.shader)}}bU.shader=new Ki(Gtt,()=>import("./RealisticTree.glsl.897402c8.js"));class fw extends Qf{constructor(t){super(t,qtt),this.supportsEdges=!0,this.techniqueConfig=new Yt,this.vertexBufferLayout=Xtt(this.parameters),this.instanceBufferLayout=t.instanced?Jwe(this.parameters):null}isVisibleInPass(t){return t!==Ge.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=t,o=_(i)&&i.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?xr.ScreenDerivative:xr.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,_(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?ar.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=_(this.parameters.modelTransformation),t!==J.Color&&t!==J.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=Nr.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Nr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Nr.WindingOrder:Nr.None,this.techniqueConfig.instancedColor=_(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Rt.Schematic:Rt.Normal:Rt.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<tU,this.techniqueConfig.snowCover=this.hasSnowCover(i)),this.techniqueConfig}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,i,r,s,n,o,a){if(_(this.parameters.verticalOffset)){const l=s.camera;te(eB,r[12],r[13],r[14]);let c=null;switch(s.viewingMode){case Ve.Global:c=we(hne,eB);break;case Ve.Local:c=se(hne,Qtt)}let h=0;const p=pe(Jtt,eB,l.eye),f=Oe(p),m=oe(p,p,1/f);let y=null;this.parameters.screenSizePerspective&&(y=xe(c,m)),h+=ebe(l,f,this.parameters.verticalOffset,y,this.parameters.screenSizePerspective),oe(c,c,h),ec(Kz,c,s.transform.inverseRotation),n=pe(Ytt,n,Kz),o=pe(Ztt,o,Kz)}Z5(t,i,s,n,o,lj(s.verticalOffset),a)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Se.OPAQUE_MATERIAL)||t===Se.DRAPED_MATERIAL}createGLMaterial(t){return t.output===J.Color||t.output===J.Alpha||t.output===J.Depth||t.output===J.Normal||t.output===J.Shadow||t.output===J.Highlight?new jtt(t):null}createBufferWriter(){return new Wtt(this.vertexBufferLayout,this.instanceBufferLayout)}}class jtt extends iY{constructor(t){super(F(F({},t),t.material.parameters))}_updateParameters(t){const i=this._material.parameters;this.updateTexture(i.textureId);const r=t.camera.viewInverseTransposeMatrix;return te(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?bU:v3,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==J.Color&&this._output!==J.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class Htt extends ktt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const qtt=new Htt;class Wtt{constructor(t,i){this.vertexBufferLayout=t,this.instanceBufferLayout=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(R.POSITION).length}write(t,i,r,s){J5(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}function Xtt(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=es().vec3f(R.POSITION).vec3f(R.NORMAL);return e.hasVertexTangents&&i.vec4f(R.TANGENT),t&&i.vec2f(R.UV0),e.hasVertexColors&&i.vec4u8(R.COLOR),e.hasSymbolColors&&i.vec4u8(R.SYMBOLCOLOR),i}function Jwe(e){let t=es();return t=e.instancedDoublePrecision?t.vec3f(R.MODELORIGINHI).vec3f(R.MODELORIGINLO).mat3f(R.MODEL).mat3f(R.MODELNORMAL):t.mat4f(R.MODEL).mat4f(R.MODELNORMAL),_(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(R.INSTANCECOLOR)),_(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(R.INSTANCEFEATUREATTRIBUTE)),t}const Ytt=M(),Ztt=M(),Qtt=Ue(0,0,1),hne=M(),Kz=M(),eB=M(),Jtt=M(),Ktt=["polygon","extent"];class eit extends Kf{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=sU(this._getSymbolSize());if(a)throw new H("graphics3dextrudesymbollayer:invalid-size",a)}const t=Tr(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=il(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?ar.None:ar.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new fw(o),this._bottomMaterial=new fw(ve(F({},o),{cullFace:ar.Back})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Ktt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Cu);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=Tr(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();return t.forEach(a=>{const l=i(a);_(l)&&l.layerOpacityChanged(o,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,zv)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var r;let i;return i=t.size&&this._drivenProperties.size?(r=eet(t.size,2))!=null?r:0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?Qs.Recreate_Symbol:Qs.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const o=oM(t.geometry);if(A(o))return null;const a=gZ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),o.rings.length===0||!o.rings.some(le=>le.length>0))return null;const l=eZ(o);if(A(l))return null;const c=new Array,h=new Array,p=new Array,f=Ls(),m=Ae(),y=M(),v=this._context.renderCoordsHelper.viewingMode===Ve.Global;v||this._context.renderCoordsHelper.worldUpAtPosition(null,y),bu(o.spatialReference,[l.x,l.y,0],m,this._context.renderCoordsHelper.spatialReference);const w=Ae();us(w,m);const b=Sr();x2(b,w);const{polygons:S,mapPosition:T,position:E}=a,C=E.length/3,O=new Float64Array(3*C*6),I=new Float64Array(3*C*6),N=new Float64Array(3*C*6),D=new Float64Array(1*C*6);let z=0;for(let le=0;le<S.length;++le){const ne=S[le],$=ne.count;if(this._context.clippingExtent&&(ur(f),cu(f,ne.mapPosition),!Bd(f,this._context.clippingExtent)))continue;const U=F2(ne.mapPosition,ne.holeIndices,3);if(U.length===0)continue;const V=3*$*2+U.length,q=new Uint32Array(V),W=new Uint32Array(U.length),K=6*$,j=3*O.BYTES_PER_ELEMENT,ee=new _s(O.buffer,z*j,j,(z+K)*j),ge=3*I.BYTES_PER_ELEMENT,Te=new _s(I.buffer,z*ge,ge,(z+K)*ge),Fe=new Float64Array(N.buffer,3*z*N.BYTES_PER_ELEMENT,3*K),_e=new Float64Array(D.buffer,1*z*D.BYTES_PER_ELEMENT,1*K),me=this._getExtrusionSize(i);tit(E,T,U,ne,ee.typedBuffer,Fe,Te.typedBuffer,_e,0,q,W,me,y,v),h3(ee,ee,w),Bv(Te,Te,b),z+=6*$;const Ce=dne(q,q.length-W.length,{positions:ee.typedBuffer,elevation:Fe,normals:Te.typedBuffer,heights:_e},r);c.push(Ce),h.push(this._material),p.push(en);const Ne=dne(W,0,{positions:ee.typedBuffer,elevation:Fe,normals:Te.typedBuffer,heights:_e},r);c.push(Ne),h.push(this._bottomMaterial),p.push(en)}if(c.length===0)return null;const B=new iy({geometries:c,materials:h,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});B.transformation=m;const k=Zbe(this.symbolLayer,{opacity:this._getLayerOpacity()}),Y=_(k)?{baseMaterial:this._material,edgeMaterials:[k],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Z=new Jf(this,B,c,null,null,sit,s,Y);return Z.alignedSampledElevation=a.sampledElevation,Z.needsElevationUpdates=zv(s.mode),Z}}function dne(e,t,i,r){const s=new Uint32Array(e.length),n=[[R.POSITION,{size:3,data:i.positions,exclusive:!0}],[R.NORMAL,{size:3,data:i.normals,exclusive:!0}],[R.COLOR,{size:4,data:r,exclusive:!0}],[R.SIZE,{size:1,data:i.heights,exclusive:!0}]],o=[[R.POSITION,e],[R.NORMAL,e],[R.COLOR,s]];return i.elevation&&(n.push([R.MAPPOS,{size:3,data:i.elevation}]),o.push([R.MAPPOS,e])),new Mr(n,o,ml.Triangle,t)}function tit(e,t,i,r,s,n,o,a,l,c,h,p,f,m){const y=i.length/3;let v=0,w=2*r.count;iit(e,t,r.index,r.count,i,0,y,s,n,o,a,l,c,h,w,p,f,m),l+=2*r.count,w=0,pne(s,n,a,o,v,r.pathLengths[0],r.count,l,c,w,p),l+=4*r.pathLengths[0],w+=2*r.pathLengths[0],v+=r.pathLengths[0];for(let b=1;b<r.pathLengths.length;++b)pne(s,n,a,o,v,r.pathLengths[b],r.count,l,c,w,p),l+=4*r.pathLengths[b],w+=2*r.pathLengths[b],v+=r.pathLengths[b]}function iit(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v,w,b){se(Ga,w);const S=v>0?1:-1;let T=3*i,E=p,C=3*E,O=p+r,I=3*O;for(let z=0;z<r;++z)b&&(Ga[0]=e[T+0],Ga[1]=e[T+1],Ga[2]=e[T+2],we(Ga,Ga)),a[C+0]=e[T+0],a[C+1]=e[T+1],a[C+2]=e[T+2],l[C+0]=t[T+0],l[C+1]=t[T+1],l[C+2]=t[T+2],c[C+0]=-S*Ga[0],c[C+1]=-S*Ga[1],c[C+2]=-S*Ga[2],h[E]=0,a[I+0]=e[T+0]+v*Ga[0],a[I+1]=e[T+1]+v*Ga[1],a[I+2]=e[T+2]+v*Ga[2],l[I+0]=t[T+0],l[I+1]=t[T+1],l[I+2]=t[T+2],c[I+0]=S*Ga[0],c[I+1]=S*Ga[1],c[I+2]=S*Ga[2],h[O]=v,C+=3,I+=3,T+=3,E+=1,O+=1;T=3*n,C=0,I=3*y;const N=v<0?_ne:vne,D=v<0?vne:_ne;for(let z=0;z<o;++z)m[C+0]=s[T+N[0]],m[C+1]=s[T+N[1]],m[C+2]=s[T+N[2]],f[I+0]=s[T+D[0]]+r,f[I+1]=s[T+D[1]]+r,f[I+2]=s[T+D[2]]+r,C+=3,I+=3,T+=3}function MI(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const pC=M();function pne(e,t,i,r,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,v=a,w=a+1,b=a+2*n,S=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),rit(e,p,f,m,pC),MI(e,t,r,i,pC,v,p),MI(e,t,r,i,pC,w,f),MI(e,t,r,i,pC,b,m),MI(e,t,r,i,pC,S,y),l[c++]=v,l[c++]=b,l[c++]=S,l[c++]=v,l[c++]=S,l[c++]=w,p++,f++,m++,y++,v+=2,w+=2,b+=2,S+=2}const tB=M(),fne=M(),mne=M(),gne=M(),yne=M();function rit(e,t,i,r,s){t*=3,i*=3,r*=3,te(tB,e[t++],e[t++],e[t++]),te(fne,e[i++],e[i++],e[i++]),te(mne,e[r++],e[r++],e[r++]),pe(gne,fne,tB),pe(yne,mne,tB),lt(s,yne,gne),we(s,s)}const dx=M();function sit(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,h=us(Ae(),c);for(let p=0;p<o;p+=2){const f=n[p].geometry,m=f.getMutableAttribute(R.POSITION).data,y=f.vertexAttributes.get(R.SIZE).data,v=f.vertexAttributes.get(R.MAPPOS).data,w=new _1e(v),b=m.length/3;let S=0,T=!1,E=0;const C=i.spatialReference;for(let O=0;O<b;O++){dx[0]=m[S],dx[1]=m[S+1],dx[2]=m[S+2],Bg(w,i,t,r,PI),a&&(E+=PI.sampledElevation),Gi.TESTS_DISABLE_OPTIMIZATIONS?(te(Al,w.array[w.offset+0],w.array[w.offset+1],PI.z+y[S/3]),r.toRenderCoords(Al,C,Al),ke(Al,Al,h)):(te(Al,m[S+0],m[S+1],m[S+2]),ke(Al,Al,c),r.setAltitude(Al,PI.z+y[S/3]),ke(Al,Al,h)),m[S]=Al[0],m[S+1]=Al[1],m[S+2]=Al[2];const I=nit/r.unitInMeters;(Math.abs(dx[0]-m[S])>=I||Math.abs(dx[1]-m[S+1])>=I||Math.abs(dx[2]-m[S+2])>=I)&&(T=!0),w.offset+=3,S+=3}T&&(f.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=E/b}return l/o}const Al=M(),Ga=M(),PI=new u3,vne=[0,2,1],_ne=[0,1,2],nit=.01;function oit(e,t,i,r,s){const n=e.referencesGeometry()&&s?ait(t,r,s):t,o=e.repurposeFeature(n);try{return e.evaluate(ve(F({},i),{$feature:o}))}catch(a){return fe.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const iB=new Map;function ait(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;iB.has(t)||iB.set(t,lit(t));const o=iB.get(t)(e.geometry,r,s,n);return ve(F({},e),{geometry:o})}function lit(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>Mbe(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>Pbe(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>Ibe(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>Obe(r,t,i,s,n);default:return fe.getLogger("esri.views.2d.support.arcadeOnDemand").error(new H("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const dwt=1.2,cit=bf,uit=vh;class wU{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Qt.Geometry.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Qt.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Qt.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=M()){return te(t,0,0,0)}getBoundingBoxObjectSpace(t=Ls()){return ur(t)}addObjectState(t,i){t===Fg.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Qt.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Qt.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.computeAttachmentOrigin(px)&&(t.draped.origin[0]+=px[0],t.draped.origin[1]+=px[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){ur(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,bne,r),uOe(n,bne)}if(i){let o;zd(n,px);const a=tZ(n,i);try{o=await i.service.queryElevation(px[0],px[1],s,a,"ground")}catch{}_(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)x4(xp,this.boundingBox);else{const n=t.boundingSphere,o=n[3];xp[0]=n[0]-o,xp[1]=n[1]-o,xp[2]=n[2]-o,xp[3]=n[0]+o,xp[4]=n[1]+o,xp[5]=n[2]+o}return i(xp,0,2),this.calculateRelativeScreenBounds&&s.push({location:zd(xp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),bq(xp,r)}}const bne=Dt(),xp=Ls(),px=M();class Kwe{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),i=this.lineHeight;return Math.ceil(t+i+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*hit}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(A(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case _v.Left:return this.backgroundHorizontalPadding;case _v.Center:return(this.displayWidth-this._lineWidths[t])/2;case _v.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;i+=o,r+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,i+p,r),this._renderLineDecoration(t,i+p,r,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(t,i+p,r,this._textWidths[c]),r+=this.lineSpacing}if(Gi.TEXT_SHOW_BASELINE){t.strokeStyle=wne,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this.baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this.lineSpacing}}if(Gi.TEXT_SHOW_BORDER&&(t.strokeStyle=wne,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this.baselinePosition}const l=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=De(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+o-s),t.arcTo(i+n,r+o,i+n-s,r+o,s),t.lineTo(i+s,r+o),t.arcTo(i,r+o,i,r+o-s,s),t.closePath()):t.rect(i,r,n,o)}_renderHalo(t,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=hL(rB,Math.max(o,fx),Math.max(a,fx)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this.baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of exe)this._fillText(t,n,i+o+this.haloSize*a,r+this.haloSize*l);r+=this.lineSpacing}}_renderHaloNative(t,i,r){const s=2*this.haloSize;r+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,i+a,r)}r+=this.lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(_(this._displayWidth))return this._displayWidth;const t=hL(rB,fx,fx).getContext("2d");this._setFontProperties(t,this.fontSize);let i=2*this.haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+i;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(A(this._heightMetrics)){const t=hL(rB,fx,fx).getContext("2d");this._setFontProperties(t,this.fontSize);const i=t.measureText(this.text+dit),r=this.hasBackground?t.measureText(this._lines[0]):i,s=this._lines.length===1?r:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):i,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this._heightMetrics={paddingTop:i.actualBoundingBoxAscent-r.actualBoundingBoxAscent,paddingBottom:i.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:i.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const exe=[];for(let t=0;t<360;t+=360/16)exe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var _v;function hL(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(_v||(_v={}));const rB={canvas:null},hit=.2,fx=512,wne="rgb(255, 0, 255, 0.5)",dit=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),pit={left:0,center:.5,right:1},dL={"bottom-left":Ii(0,0),bottom:Ii(.5,0),"bottom-right":Ii(1,0),left:Ii(0,.5),center:Ii(.5,.5),right:Ii(1,.5),"top-left":Ii(0,1),top:Ii(.5,1),"top-right":Ii(1,1)};function txe(e){switch(e){case"left":return _v.Left;case"right":return _v.Right;default:return _v.Center}}function xne(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function fit(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function mit(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function git(e){return e==="middle"?"center":e}var jo,Tne,NF;function fC(e){return e!=null}function mx(e){return typeof e=="number"}function xU(e){return typeof e=="string"}function yit(e){return e==null||xU(e)}function Ys(e,t){e&&e.push(t)}function vit(e,t,i,r=Ae()){const s=e||0,n=t||0,o=i||0;return s!==0&&r2(r,r,-s/180*Math.PI),n!==0&&i2(r,r,n/180*Math.PI),o!==0&&B4(r,r,o/180*Math.PI),r}function wy(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return Ys(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=r.symbolSize[i];return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=jo.DefinedSize,!0}if(fC(e.field))return fC(e.stops)?e.stops.length===2&&mx(e.stops[0].size)&&mx(e.stops[1].size)?(Sne(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=jo.DefinedSize,!0):(Ys(s,"Could not convert size info: stops only supported with 2 elements"),!1):mx(n)&&mx(o)&&fC(e.minDataValue)&&fC(e.maxDataValue)?(Sne(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=jo.DefinedSize,!0):KS[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/KS[e.valueUnit],t.type[i]=jo.DefinedSize,!0):e.valueUnit==="unknown"?(Ys(s,"Could not convert size info: proportional size not supported"),!1):(Ys(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!fC(e.field)){if(e.stops&&e.stops[0]&&mx(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=jo.DefinedSize,!0;if(mx(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=jo.DefinedSize,!0}return Ys(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Sne(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function _it(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return Ys(r,"Could not convert size info: unsupported property"),null;if(!yit(e.field))return Ys(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Ys(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[jo.Undefined,jo.Undefined,jo.Undefined]};let s;switch(e.axis){case"width":return s=wy(e,t.size,0,i,r),s?t:null;case"height":return s=wy(e,t.size,2,i,r),s?t:null;case"depth":return s=wy(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=wy(e,t.size,0,i,r),s&&wy(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=wy(e,t.size,0,i,r),s=s&&wy(e,t.size,1,i,r),s=s&&wy(e,t.size,2,i,r),s?t:null;default:return Ys(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function bit(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===jo.DefinedSize&&(n*=t.modelSize[s],e.type[s]=jo.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==jo.Undefined)r=0;else if(e.type[1]!==jo.Undefined)r=1;else{if(e.type[2]===jo.Undefined)return Ys(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===jo.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function Ene(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function wit(e,t,i){if(e.normalizationField)return Ys(i,"Could not convert color info: unsupported property"),null;if(xU(e.field)){if(!e.stops)return Ys(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return Ys(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,Ene(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return Ys(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,Ene(t.color.colors,s,r)}}return t}function xit(e,t,i){if(e.normalizationField)return Ys(i,"Could not convert opacity info: unsupported property"),null;if(xU(e.field)){if(!e.stops)return Ys(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return Ys(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return Ys(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function sB(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function Tit(e,t,i){if(!xU(e.field))return Ys(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Ys(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return sB(e,t.rotation,0),t;case"roll":return sB(e,t.rotation,1),t;case null:case void 0:case"heading":return sB(e,t.rotation,2),t;default:return Ys(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function ixe(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return Ys(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?_it(c,l,t,i):l;case"color":return s?wit(c,l,i):l;case"opacity":return o?xit(c,l,i):null;case"rotation":return n?Tit(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!bit(a.size,t,i)?null:a:null}function yZ(e){return e&&e.size!=null}function lM(e,t){if(!e)return{enabled:!1};if(Gi.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=ixe(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:rxe(i,t),requiresShaderTransformation:yZ(i)}:{enabled:!1}}function cM(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=ixe(t.visualVariables,i);return!!s&&!!(II(r.size,s.size,"size")&&II(r.color,s.color,"color")&&II(r.rotation,s.rotation,"rotation")&&II(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=rxe(s,i),e.requiresShaderTransformation=yZ(s),!0)}function II(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function rxe(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=yZ(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=Sr(),$f(zR),vit(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],zR),Ih(i.vvSymbolRotationMatrix,zR)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(jo||(jo={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Tne||(Tne={})),function(e){const t=Ae(),i=M();function r(n,o,a){if(!n.vvSizeEnabled)return a;gs(t,a);const l=n.vvSymbolRotationMatrix;jf(zR,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),Fr(t,t,zR);for(let c=0;c<3;++c){const h=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];i[c]=De(h,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return z4(t,t,i),Ia(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return te(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=De(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=r,e.evaluateModelTransformScale=s}(NF||(NF={}));const zR=Ae(),Ij=NF.evaluateModelTransform,Sit=NF.evaluateModelTransformScale;class Eit{constructor(){this.visible=!0}}class B2{constructor(t,i,r={}){this.data=t,this.material=i,this.boundingSphere=Gt(),this.instanceParameters=new Eit,this._transformation=Ae(),this._shaderTransformationDirty=!0,this.layerUid=vt(r.layerUid,null),this.graphicUid=vt(r.graphicUid,null),this.id=r.id?r.id:hl(),this.boundingInfo=vt(r.boundingInfo,null),this.calculateShaderTransformation=vt(r.calculateShaderTransformation,null),this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=qb(t)){A(this.boundingInfo)||(ke(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return _(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return A(this.calculateShaderTransformation)?vt(this.transformation,en):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ae()),gs(this._shaderTransformation,this.calculateShaderTransformation(vt(this.transformation,en))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(_(this._transformation)&&ke(t,t,this._transformation),!0);const i=this.indices.get(R.POSITION),r=this.vertexAttributes.get(R.POSITION);return!!A_e(r,i,t)&&(_(this._transformation)&&ke(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new OF(Fg.Highlight),i=this.instanceParameters;return i.highlights=uj(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=hj(i.highlights,t)}}const Cit=Ae(),Cne=Ue(0,0,1),Ait=16,Rit=1.5,fb=ZY,Oit=[fb/2,fb/2,1-fb/2,1-fb/2],Mit=[tM*fb,tM*fb];class uM extends Kf{constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(_(r))this._prepareResourcesPrimitive(i,r);else{const s=Y4e(this.symbol,this.symbolLayer),n=A4(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=sU(this._getIconSize());if(t)throw new H("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?eo(t.size):Ait);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:mv.PAD};r=new Rs(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(Pit(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:eo(r),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(nB(i)&&r===0)throw new Error("Nothing to render");this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(i,()=>cbe(i));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=Oit,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/fb,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){if(!he("esri-canvas-svg-support")&&Oq(i))throw new H("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio,o=await xu(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw nc(o.error),new H("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new Q2({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await import("./CIMSymbolRasterizer.ae6a05d7.js")).CIMSymbolRasterizer;hi(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await PAe(p,this._context.layer.spatialReference,n);a=(m,y,v)=>{const w=oit(f,m,{$view:v},"esriGeometryPoint",y);return w!==null?w:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];hi(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||sMe}_getOutlineSize(){let t=0;const i=this.symbolLayer;return _(i.outline)&&i.outline.size!=null?Math.max(eo(i.outline.size),0):(t=nB(this._getPrimitive())?Rit:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=Tr(i,"outline","color");if(_(r)){const s=qe.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(nB(this._getPrimitive()))return cit;const t=A(this._getPrimitive()),i=Tr(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?Ii((i.x||0)+.5,.5-(i.y||0)):t in dL?dL[t]:dL.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=lM(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=_(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new L2(t),this._cimSymbolMaterials.set(vt(t.textureId,0),r),i.add(r)),r}return this._material=new L2(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=Yi(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=eo(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f=F({textureId:p.id},this._cimMaterialParametersInfo);s=this._createMaterialAndAddToStage(f,this._context.stage),r=[p.params.width,p.params.height]}else r=this._size,s=this._material;const n=sM(i.geometry);if(A(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[r[0]*l,r[1]*l],h=this.setGraphicElevationContext(i,new Cu);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,s,a,c,t.layer.uid):this._createAs3DShape(i,n,s,a,c,h,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=c3(uM.elevationModeChangeTypes,r,s);if(n!==Gr.UPDATE)return n;const o=Nh(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!cM(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return Qs.Recreate_Symbol;_(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return Qs.Fast_Update}_defaultElevationInfoNoZ(){return Iit}_createAs3DShape(t,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?m=>Ij(this._fastUpdates.materialParameters,l,m):null,h=[jl.createPointGeometry(Cne,null,s,n,$it,null,l)],p=lZ(this._context,i,h,[r],o,this._context.layer.uid,a,c);if(p===null)return null;const f=new Jf(this,p.object,h,null,null,iM,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=Nh(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=m=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,m),rM(f,i,this._context.elevationProvider),f}_createAsOverlay(t,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=Gt();Pn(i,a,this._context.overlaySR),a[2]=mZ;const l=this._context.clippingExtent;if(_(l)&&!_q(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?y=>Ij(this._fastUpdates.materialParameters,c,y):null,p=jl.createPointGeometry(Cne,a,s,n,null,null,c),f=new B2(p,r,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:h});a[3]=0,kd(f.boundingSphere,a);const m=new wU(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,h),m.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,y),m}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=tt())=>{const a=i(Cit);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(o=tt())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Ue(t,t,t),r=yu(1),s=t*r;return{modelSize:i,symbolSize:Ue(s,s,s),unitInMeters:r,transformation:{anchor:Aa,scale:mf,rotation:Aa}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){_(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return ve(F({},super.test()),{material:this._material})}}function Pit(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function nB(e){return!A(e)&&(e==="cross"||e==="x")}uM.PRIMITIVE_SIZE=Mit,uM.elevationModeChangeTypes={definedChanged:Gr.UPDATE,staysOnTheGround:Gr.NONE,onTheGroundChanged:Gr.RECREATE};const Iit={mode:"relative-to-ground",offset:0},$it=gi(0,0,0,1);function $j(e){const t=[],i=[];Nit(e,i,t);const r=i[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return Fit(e,i,t),Uit(e,i,t,n),zit(e,i,t,n),kit(e,i,t,n),Bit(e,i,t,n),Vit(e,i,t,n),Git(e,i,t,r),new Mr(i,t,ml.Line)}function Dit(e,t,i,r){const s=e.type==="polygon"?Uf.CCW_IS_HOLE:Uf.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=d3(n,e.hasZ,s),l=new Float64Array(o.length),c=Vbe(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),h=c!=null;return{lines:h?sxe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function sxe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function Lit(e,t){const i=e.type==="polygon"?Uf.CCW_IS_HOLE:Uf.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=d3(r,!1,i),o=lr(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=mZ;return{lines:o?sxe(n,s):[],projectionSuccess:o}}function Nit(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=jit(r)&&s===mw.REMOVE,o=r.length/3-(n?1:0),a=new Uint32Array(2*(o-1)),l=n?MH(r,0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([R.POSITION,{size:3,data:l,exclusive:n}]),i.push([R.POSITION,a])}function Fit(e,t,i){const r=e.attributeData.mapPosition;A(r)||(i.push([R.MAPPOS,i[0][1]]),t.push([R.MAPPOS,{size:3,data:r}]))}function Uit(e,t,i,r){if(_(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([R.COLOR,{size:4,data:vt(s,uit)}]),i.push([R.COLOR,r])}function kit(e,t,i,r){const s=e.attributeData.colorFeature;A(s)||(t.push([R.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([R.COLOR,r]))}function zit(e,t,i,r){if(_(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([R.SIZE,{size:1,data:[vt(s,1)]}]),i.push([R.SIZE,r])}function Bit(e,t,i,r){const s=e.attributeData.sizeFeature;A(s)||(t.push([R.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([R.SIZEFEATUREATTRIBUTE,r]))}function Vit(e,t,i,r){const s=e.attributeData.opacityFeature;A(s)||(t.push([R.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([R.OPACITYFEATUREATTRIBUTE,r]))}function Git(e,t,i,r){if(A(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==Ve.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),n=wi(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)aW(r,f,s,f,n);const o=r.length/3,a=new Float32Array(o+1);let l=Hit,c=qit,h=0,p=0;te(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),te(c,s[p++],s[p++],s[p++]),h+=Ove(l,c),a[f]=h,[l,c]=[c,l];t.push([R.DISTANCETOSTART,{size:1,data:a}]),i.push([R.DISTANCETOSTART,i[0][1]])}function jit(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var mw;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(mw||(mw={}));const Hit=M(),qit=M();function Dj(e){switch(e){case"butt":return Ch.BUTT;case"square":return Ch.SQUARE;case"round":return Ch.ROUND;default:return null}}const FF=64,nxe=FF/2,oxe=nxe/5;function Wit(e,t){return _(t)?Xit(e,Yit(t.style)):null}function Xit(e,t){return e.fromData(t,()=>cbe(t,FF,nxe,oxe))}function Yit(e){return e==="diamond"?"kite":e}function Zit(e){const t=new Hi,i=e.hasMultipassTerrain&&(e.output===J.Color||e.output===J.Alpha);t.include(hwe,e),e.output===J.Depth&&t.include(e_,e);const{vertex:r,fragment:s}=t;return s.include(yc),mu(t,e),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float"),r.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),r.uniforms.add([new fi("nearFar",(n,o)=>o.camera.nearFar),new ti("viewport",(n,o)=>o.camera.fullViewport)]),r.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(x`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(r.uniforms.add(new yr("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix)),r.code.add(x`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),r.code.add(x`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),r.uniforms.add(new We("perScreenPixelRatio",(n,o)=>o.camera.perScreenPixelRatio)),r.code.add(x`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),r.uniforms.add(new We("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(x`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${x.float(FF/oxe)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||r.code.add(x`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),r.code.add(x`
        ${i?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(Su,e),t.include(cs,e),s.uniforms.add([new ti("intrinsicColor",n=>n.color),new zt("tex",n=>n.texture)]),s.include(Yf),s.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${x.float(1/FF)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${x.float(Eo)}) {
      discard;
    }

    ${e.output===J.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===J.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===J.Color&&e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===J.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===J.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const Qit=Object.freeze(Object.defineProperty({__proto__:null,build:Zit},Symbol.toStringTag,{value:"Module"})),axe=new Map([[R.POSITION,0],[R.UV0,2],[R.AUXPOS1,3],[R.SIZE,6],[R.SIZEFEATUREATTRIBUTE,6],[R.COLOR,5],[R.COLORFEATUREATTRIBUTE,5],[R.OPACITYFEATUREATTRIBUTE,7]]);class TU extends cr{initializeProgram(t){const i=TU.shader.get().build(this.configuration);return new er(t.rctx,i,axe)}_makePipelineState(t,i){const r=this.configuration,s=t===gt.NONE;return Ut({blending:r.output===J.Color||r.output===J.Alpha?s?gu:ey(t):null,depthTest:{func:Kv(t)},depthWrite:s?r.writeDepth&&wl:eU(t),colorWrite:Kt,stencilWrite:r.hasOccludees?kf:null,stencilTest:r.hasOccludees?i?Vv:t_:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Ut({blending:gu,depthTest:IF,depthWrite:null,colorWrite:Kt,stencilWrite:null,stencilTest:mwe}),this._occluderPipelineOpaque=Ut({blending:gu,depthTest:IF,depthWrite:null,colorWrite:Kt,stencilWrite:pwe,stencilTest:fwe}),this._occluderPipelineMaskWrite=Ut({blending:null,depthTest:hZ,depthWrite:null,colorWrite:null,stencilWrite:kf,stencilTest:Vv})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Se.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Se.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}TU.shader=new Ki(Qit,()=>import("./LineMarker.glsl.a6e5817a.js"));class da extends qo{constructor(){super(...arguments),this.output=J.Color,this.transparencyPassType=gt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([G({count:J.COUNT})],da.prototype,"output",void 0),u([G({count:gt.COUNT})],da.prototype,"transparencyPassType",void 0),u([G()],da.prototype,"occluder",void 0),u([G()],da.prototype,"hasSlicePlane",void 0),u([G()],da.prototype,"writeDepth",void 0),u([G()],da.prototype,"draped",void 0),u([G()],da.prototype,"hasCap",void 0),u([G()],da.prototype,"vvSize",void 0),u([G()],da.prototype,"vvColor",void 0),u([G()],da.prototype,"vvOpacity",void 0),u([G()],da.prototype,"hasOccludees",void 0),u([G()],da.prototype,"hasMultipassTerrain",void 0),u([G()],da.prototype,"cullAboveGround",void 0),u([G({constValue:!0})],da.prototype,"hasVvInstancing",void 0),u([G({constValue:!0})],da.prototype,"hasSliceTranslatedView",void 0);class Jit extends Qf{constructor(t){super(t,new ert),this._vertexAttributeLocations=axe,this.techniqueConfig=new da,this.layout=this.createLayout()}dispose(){}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Se.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==Ch.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===Or.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=es().vec3f(R.POSITION).vec2f(R.UV0).vec3f(R.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(R.SIZEFEATUREATTRIBUTE):t.f32(R.SIZE),this.parameters.vvColorEnabled?t.f32(R.COLORFEATUREATTRIBUTE):t.vec4f(R.COLOR),this.parameters.vvOpacityEnabled&&t.f32(R.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new trt(this.layout,this.parameters)}requiresSlot(t,i){if(t===Se.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Or.OccludeAndTransparentStencil)return t===Se.OPAQUE_MATERIAL||t===Se.OCCLUDER_MATERIAL||t===Se.TRANSPARENT_OCCLUDER_MATERIAL;const r=hw(i);return r===J.Color||r===J.Alpha?t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Se.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===J.Color||t.output===J.Alpha||t.output===J.Highlight||t.output===J.Depth?new Kit(t):null}}class Kit extends iY{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(TU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==J.Color&&this._output!==J.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class ert extends QY{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Ch.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class trt{constructor(t,i){this.vertexBufferLayout=t,this.parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,i,r,s){const n=i.vertexAttributes.get(R.POSITION).data,o=n.length/3;let a=1,l=0;this.parameters.vvSizeEnabled?l=i.vertexAttributes.get(R.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(R.SIZE)&&(a=i.vertexAttributes.get(R.SIZE).data[0]);let c=[1,1,1,1],h=0;this.parameters.vvColorEnabled?h=i.vertexAttributes.get(R.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(R.COLOR)&&(c=i.vertexAttributes.get(R.COLOR).data);let p=0;this.parameters.vvOpacityEnabled&&(p=i.vertexAttributes.get(R.OPACITYFEATUREATTRIBUTE).data[0]);const f=t.transformation,m=new Float32Array(r.buffer);let y=s*(this.vertexBufferLayout.stride/4);const v=(T,E,C,O)=>{if(m[y++]=T[0],m[y++]=T[1],m[y++]=T[2],m[y++]=C[0],m[y++]=C[1],m[y++]=E[0],m[y++]=E[1],m[y++]=E[2],this.parameters.vvSizeEnabled?m[y++]=l:m[y++]=a,this.parameters.vvColorEnabled)m[y++]=h;else{const I=Math.min(4*O,c.length-4);m[y++]=c[I+0],m[y++]=c[I+1],m[y++]=c[I+2],m[y++]=c[I+3]}this.parameters.vvOpacityEnabled&&(m[y++]=p)};let w;(function(T){T[T.ASCENDING=1]="ASCENDING",T[T.DESCENDING=-1]="DESCENDING"})(w||(w={}));const b=(T,E)=>{const C=te(irt,n[3*T],n[3*T+1],n[3*T+2]),O=rrt;let I=T+E;do te(O,n[3*I],n[3*I+1],n[3*I+2]),I+=E;while(Bb(C,O)&&I>=0&&I<o);f&&(ke(C,C,f),ke(O,O,f)),v(C,O,[-1,-1],T),v(C,O,[1,-1],T),v(C,O,[1,1],T),v(C,O,[-1,-1],T),v(C,O,[1,1],T),v(C,O,[-1,1],T)},S=this.parameters.placement;S!=="begin"&&S!=="begin-end"||b(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||b(o-1,w.DESCENDING)}}const irt=M(),rrt=M(),No={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},srt={dash:No.dash,"dash-dot":[...No.dash,...No.dot],dot:No.dot,"long-dash":No["long-dash"],"long-dash-dot":[...No["long-dash"],...No.dot],"long-dash-dot-dot":[...No["long-dash"],...No.dot,...No.dot],none:null,"short-dash":No["short-dash"],"short-dash-dot":[...No["short-dash"],...No["short-dot"]],"short-dash-dot-dot":[...No["short-dash"],...No["short-dot"],...No["short-dot"]],"short-dot":No["short-dot"],solid:null},nrt=8;function ort(e,t=2){return A(e)?e:{pattern:e.slice(),pixelRatio:t}}function pwt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function lxe(e){return _(e)&&e.type==="style"?art(e.style):null}function art(e){return _(e)?ort(srt[e],nrt):null}const lrt=["polyline","polygon","extent"];class SU extends Kf{constructor(t,i,r,s){super(t,i,r,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=lM(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:yu(1);if(t<0)throw new H("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=Wit(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:Dj(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:lxe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?F(F({},s),this._fastUpdates.materialParameters):s}get _materialColor(){return qs(this.symbolLayer.material,t=>t.color)}get _markerColor(){return qs(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return A(this._lineMaterial)&&(this._lineMaterial=new iS(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return A(this._ringMaterial)&&(this._ringMaterial=new iS(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return A(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new iS(ve(F({},this._getMaterialParameters(!1)),{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return A(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new iS(ve(F({},this._getMaterialParameters(!0)),{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return A(this._markerMaterial)&&_(this.symbolLayer.marker)&&_(this._markerTexture)&&(this._markerMaterial=new Jit(ve(F({},this._getMaterialParameters(!1,!0)),{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=Yi(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?eo(tet(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?bg(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=gi(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?bg(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?bg(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,lrt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Cu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!cM(this._fastUpdates,i,this._vvConvertOptions))return Qs.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return Qs.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const i=t.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=Dj(vt(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(t,i);this._prepareMaterialPatch(t,i,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){return this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i)),!0}_forEachMaterial(t){_(this._lineMaterial)&&t(this._lineMaterial),_(this._ringMaterial)&&t(this._ringMaterial),_(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),_(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),_(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=Tr(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=gi(r[0],r[1],r[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=c3(SU.elevationModeChangeTypes,r,s);if(n!==Gr.UPDATE)return n;const o=Nh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof ri)return Ao.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,h=Ls(),p=Dit(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,f,"LineSymbol3DLayer");for(let v=0;v<p.lines.length;v++){const{position:w,mapPosition:b}=p.lines[v];if(_(this._context.clippingExtent)&&(ur(h),cu(h,b),!Bd(h,this._context.clippingExtent)))continue;const S=this._createGeometry(t,w,b,n.type,BR.ELEVATED);a.push(S),l.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(en),Gi.LINE_WIREFRAMES&&(a.push(S.cloneShallow()),l.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(en));const T=this.markerMaterial;_(T)&&(a.push(S.cloneShallow()),l.push(T),c.push(en))}if(a.length===0)return null;const m=new iy({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),y=new Jf(this,m,a,null,null,mKe,i);return y.alignedSampledElevation=p.sampledElevation,y.needsElevationUpdates=Nh(i.mode),y}_createGeometry(t,i,r,s,n){const o=s==="polygon"?mw.REMOVE:mw.KEEP,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return $j({overlayInfo:n===BR.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:o,uniformSize:this._uniformSize,attributeData:{position:i,mapPosition:r,size:l?null:this._getDrivenSize(t.renderingInfo),color:a?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=Gi.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;_(a)&&(a.renderPriority=this._renderPriority-.001),_(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=Ls(),p=ur(),f=Lit(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(ur(h),cu(h,y.position),!Bd(h,this._context.clippingExtent))continue;WS(p,h);const v=this._createGeometry(t,y.position,null,s.type,BR.DRAPED),w=S=>{const T=new B2(v,S,{layerUid:i,graphicUid:r.uid});return c.push(T),T};if(_(l)){const S=w(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||cu(h,y.position,0,1),T!=="end"&&T!=="begin-end"||cu(h,y.position,y.position.length-3,1),this._updateBoundingSphere(S,h)}const b=w(o);if(this._updateBoundingSphere(b,h),Gi.LINE_WIREFRAMES){const S=w(a);this._updateBoundingSphere(S,h)}}return new wU(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,i){Xi(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return _(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=vt(t,yu(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?eo(1):1:eo(t)}_prepareMaterialPatch(t,i,r){const s=i.material;if(A(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(s.type==="collection")return;const n=s.type==="complete"?qs(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(q4(o),this._markerMaterial,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(A(r)||r.type!=="partial"||_(r.diff.style)||_(r.diff.placement)||_(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:A(this._markerColor)};const s=r.diff.color;if(A(s))return delete i.marker,{changed:!1,useMaterialColor:A(this._markerColor)};const n=s.newValue;return A(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,i,r){A(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:t}))}}var BR;SU.elevationModeChangeTypes={definedChanged:Gr.RECREATE,staysOnTheGround:Gr.NONE,onTheGroundChanged:Gr.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(BR||(BR={}));const Ane=2048,crt=1.5,urt=8;function hrt(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=vZ(e,t.padding),a=xrt(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=wrt(e,a),h=Ert(i),p=Mrt[h];return{format:h,quality:De(r!=null?r:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function drt(e,t){const i=hrt(e,t),r=i.area,s=i.width/r.width,n=vZ(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y}}function prt(e,t,i){const{ctx:r,canvas:s}=cxe(e,i),n=r.getImageData(0,0,e.width,e.height),o=grt(s,t);return uxe(s),{dataUrl:o,data:n}}function frt(e,t){const{ctx:i,canvas:r}=cxe(e,t),s=i.getImageData(0,0,e.width,e.height);return uxe(r),s}function cxe(e,t){const i=mrt();t.premultipliedAlpha&&Art(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.putImageData(e,0,0),t.flipY&&Crt(r),{ctx:r,canvas:i}}function uxe(e){e.width=0,e.height=0}function mrt(){return A(oB)&&(oB=document.createElement("canvas")),oB}let oB=null;function grt(e,t){const i=Rrt[t.format],r=t.quality/100;return e.toDataURL(i,r)}function aB(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(UF)try{return new ImageData(e,t)}catch{UF=!1}return hxe(e,t,i)}function yrt(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(UF)try{return new ImageData(e,t,i)}catch{UF=!1}const s=hxe(t,i,r);return s.data.set(e,0),s}function vrt(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,m=o/h,y=Math.ceil(f/2),v=Math.ceil(m/2),w=e.width;for(let b=0;b<h;b++)for(let S=0;S<c;S++){const T=4*(S+(a?h-b-1:b)*c);let E=0,C=0,O=0,I=0,N=0,D=0;const z=(b+.5)*m;for(let B=Math.floor(b*m);B<(b+1)*m;B++){const k=Math.abs(z-(B+.5))/v,Y=(S+.5)*f,Z=k*k;for(let le=Math.floor(S*f);le<(S+1)*f;le++){const ne=Math.abs(Y-(le+.5))/y,$=Math.sqrt(Z+ne*ne);if($>=1)continue;let U=2*$*$*$-3*$*$+1;const V=4*(r+le+(s+B)*w);D+=U*l[V+3],C+=U,!i&&l[V+3]<255&&(U=U*l[V+3]/255),O+=U*l[V],I+=U*l[V+1],N+=U*l[V+2],E+=U}}p[T]=O/E,p[T+1]=I/E,p[T+2]=N/E,p[T+3]=D/C}return t}function _rt(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=vZ(e,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,f=Math.min(urt,Math.min((Ane-l)/h,(Ane-c)/p));return f<crt?e:ve(F({},e),{framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}})}function hxe(e,t,i){return i||(i=brt()),i.getContext("2d").createImageData(e,t)}let mC=null,UF=!0;function brt(){return mC||(mC=document.createElement("canvas"),mC.width=1,mC.height=1),mC}function wrt(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function xrt(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return Trt(Srt(i,e),t)}function Trt(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function Srt(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function vZ(e,t){return!t||e&&e.ignorePadding?Prt:t}function Ert(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return Ort}}function Crt(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function Art(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const n=255/s;t[r+0]=t[r+0]*n,t[r+1]=t[r+1]*n,t[r+2]=t[r+2]*n}}}const Rrt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Rne=98,Ort="png",Mrt={png:100,jpg:Rne,jpeg:Rne},Prt={top:0,right:0,bottom:0,left:0};var ST;const lB=new WeakMap;let Irt=0,Wp=ST=class extends ye{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:Pg(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:Pg(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(lB.has(this.data)||lB.set(this.data,++Irt),t(lB.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new ST(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return yrt(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new ST({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new ST({data:e}):LS(ST,e)}};u([d({type:String,json:{write:Sv}})],Wp.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],Wp.prototype,"data",null),u([He("data")],Wp.prototype,"writeData",null),u([Pe("data")],Wp.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Wp.prototype,"transparent",null),u([d({json:{write:!0}})],Wp.prototype,"wrap",void 0),u([d({readOnly:!0})],Wp.prototype,"contentHash",null),Wp=ST=u([P("esri.geometry.support.MeshTexture")],Wp);const VR=Wp;var Lj;let Lm=Lj=class extends ye{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new Lj(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:_(this.color)?this.color.clone():null,colorTexture:_(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:_(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([d({type:qe,json:{write:!0}})],Lm.prototype,"color",void 0),u([d({type:VR,json:{write:!0}})],Lm.prototype,"colorTexture",void 0),u([d({type:VR,json:{write:!0}})],Lm.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],Lm.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],Lm.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],Lm.prototype,"doubleSided",void 0),Lm=Lj=u([P("esri.geometry.support.MeshMaterial")],Lm);const _Z=Lm;var Nj;let Nm=Nj=class extends _Z{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new Nj(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return ve(F({},super.clonePropertiesWithDeduplication(e)),{emissiveColor:_(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:_(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:_(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:_(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null})}};u([d({type:qe,json:{write:!0}})],Nm.prototype,"emissiveColor",void 0),u([d({type:VR,json:{write:!0}})],Nm.prototype,"emissiveTexture",void 0),u([d({type:VR,json:{write:!0}})],Nm.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Nm.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Nm.prototype,"roughness",void 0),u([d({type:VR,json:{write:!0}})],Nm.prototype,"metallicRoughnessTexture",void 0),Nm=Nj=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],Nm);const dxe=Nm;var pL;const gx=fe.getLogger("esri.geometry.support.MeshVertexAttributes");let Du=pL=class extends ye{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return ET(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},gx)}castPosition(e){return e&&e instanceof Float32Array&&gx.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),ET(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},gx)}castUv(e){return ET(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},gx)}castNormal(e){return ET(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},gx)}castTangent(e){return ET(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},gx)}clone(){const e={position:ie(this.position),uv:ie(this.uv),normal:ie(this.normal),tangent:ie(this.tangent),color:ie(this.color)};return new pL(e)}clonePositional(){const e={position:ie(this.position),normal:ie(this.normal),tangent:ie(this.tangent),uv:this.uv,color:this.color};return new pL(e)}};function cB(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function ET(e,t,i,r,s){if(!e)return e;if(e instanceof t)return cB(e,r,t,s);for(const n of i)if(e instanceof n)return cB(new t(e),r,t,s);if(Array.isArray(e))return cB(new t(e),r,t,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function gC(e,t,i){t[i]=$rt(e)}function $rt(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}u([d({json:{write:gC}})],Du.prototype,"color",void 0),u([jt("color")],Du.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:gC}})],Du.prototype,"position",void 0),u([jt("position")],Du.prototype,"castPosition",null),u([d({json:{write:gC}})],Du.prototype,"uv",void 0),u([jt("uv")],Du.prototype,"castUv",null),u([d({json:{write:gC}})],Du.prototype,"normal",void 0),u([jt("normal")],Du.prototype,"castNormal",null),u([d({json:{write:gC}})],Du.prototype,"tangent",void 0),u([jt("tangent")],Du.prototype,"castTangent",null),Du=pL=u([P("esri.geometry.support.MeshVertexAttributes")],Du);var jA;const Drt=fe.getLogger("esri.geometry.support.MeshComponent");let Fm=jA=class extends ye{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return LS(jA,e)}castFaces(e){return ET(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Drt)}castMaterial(e){return LS(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?dxe:_Z,e)}clone(){return new jA({faces:ie(this.faces),shading:this.shading,material:ie(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:ie(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new jA(i)}};u([d({json:{write:!0}})],Fm.prototype,"faces",void 0),u([jt("faces")],Fm.prototype,"castFaces",null),u([d({type:_Z,json:{write:!0}})],Fm.prototype,"material",void 0),u([jt("material")],Fm.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],Fm.prototype,"shading",void 0),u([d({type:Boolean})],Fm.prototype,"trustSourceNormals",void 0),Fm=jA=u([P("esri.geometry.support.MeshComponent")],Fm);const Lrt=Fm,EU=fe.getLogger("esri.geometry.support.meshUtils.normalProjection");function Nrt(e,t,i,r,s){return AU(r)?(CU(wg.TO_PCPF,ji.fromTypedArray(e),_s.fromTypedArray(t),_s.fromTypedArray(i),r,ji.fromTypedArray(s)),s):(EU.error("Cannot convert spatial reference to PCPF"),s)}function fwt(e,t,i,r,s){return AU(r)?(CU(wg.FROM_PCPF,ji.fromTypedArray(e),_s.fromTypedArray(t),_s.fromTypedArray(i),r,ji.fromTypedArray(s)),s):(EU.error("Cannot convert to spatial reference from PCPF"),s)}function mwt(e,t,i){return lr(e,t,0,i,If(t),0,e.length/3),i}function gwt(e,t,i){return lr(e,If(i),0,t,i,0,e.length/3),t}function Frt(e,t,i){if(A(e))return t;const r=_s.fromTypedArray(e),s=_s.fromTypedArray(t);return h3(s,r,i),t}function Urt(e,t,i){if(A(e))return t;x2(xn,i);const r=ji.fromTypedArray(e),s=ji.fromTypedArray(t);return Bv(s,r,xn),uY(xn)||cZ(s,s),t}function krt(e,t,i){if(A(e))return t;x2(xn,i);const r=ji.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=ji.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(Bv(s,r,xn),uY(xn)||cZ(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function zrt(e,t,i,r,s){if(!AU(r))return EU.error("Cannot convert spatial reference to PCPF"),s;CU(wg.TO_PCPF,ji.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),_s.fromTypedArray(t),_s.fromTypedArray(i),r,ji.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function ywt(e,t,i,r,s){if(!AU(r))return EU.error("Cannot convert to spatial reference from PCPF"),s;CU(wg.FROM_PCPF,ji.fromTypedArray(e,16),_s.fromTypedArray(t),_s.fromTypedArray(i),r,ji.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function CU(e,t,i,r,s,n){if(!t)return;const o=i.count,a=If(s);if(pxe(s))for(let l=0;l<o;l++)r.getVec(l,$I),t.getVec(l,Tp),bu(a,$I,DI,a),Ih(xn,DI),e===wg.FROM_PCPF&&$h(xn,xn),ec(Tp,Tp,xn),n.setVec(l,Tp);else for(let l=0;l<o;l++){r.getVec(l,$I),t.getVec(l,Tp),bu(a,$I,DI,a),Ih(xn,DI);const c=tN(i.get(l,1));let h=Math.cos(c);e===wg.TO_PCPF&&(h=1/h),xn[0]*=h,xn[1]*=h,xn[2]*=h,xn[3]*=h,xn[4]*=h,xn[5]*=h,e===wg.FROM_PCPF&&$h(xn,xn),ec(Tp,Tp,xn),we(Tp,Tp),n.setVec(l,Tp)}return n}function AU(e){return pxe(e)||Brt(e)}function pxe(e){return e.isWGS84||uue(e)||zf(e)||Bf(e)}function Brt(e){return e.isWebMercator}var wg;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(wg||(wg={}));const $I=M(),Tp=M(),DI=Ae(),xn=Sr();function Vrt(e){const t=new Hi;t.include(To),t.include(Uw,e),t.include(dwe,e),mu(t,e);const{vertex:i,fragment:r}=t;return e.stippleEnabled&&(t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.AUXPOS1,"vec3"),i.uniforms.add(new ti("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(R.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(x`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(x`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new We("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(x`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(x`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(x`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(x`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(x`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(x`}`),e.output===J.Highlight&&t.include(Kg),t.include(cs,e),r.uniforms.add(new We("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||r.uniforms.add(new ti("constantColor",s=>s.color)),r.code.add(x`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${x.float(Eo)}) {
      discard;
    }

    ${e.output===J.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===J.Highlight?x`outputHighlight();`:""}
  }
  `),t}const Grt=Object.freeze(Object.defineProperty({__proto__:null,build:Vrt},Symbol.toStringTag,{value:"Module"}));class RU extends cr{constructor(t,i,r){super(t,i,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==J.Highlight}initializeProgram(t){const i=RU.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}initializePipeline(){const t=this.configuration,i=so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Ut({blending:n,depthTest:hZ,depthWrite:o,colorWrite:Kt,stencilWrite:t.hasOccludees?kf:null,stencilTest:t.hasOccludees?s?Vv:t_:null});return t.output===J.Color?(this._occludeePipelineState=r(!0,t.transparent||this.stippleEnabled?i:null,wl),r(!1,t.transparent||this.stippleEnabled?i:null,wl)):r(!1)}get primitiveType(){return Pt.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}RU.shader=new Ki(Grt,()=>import("./NativeLine.glsl.df7a9b9d.js"));class Lc extends qo{constructor(){super(...arguments),this.output=J.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([G({count:J.COUNT})],Lc.prototype,"output",void 0),u([G()],Lc.prototype,"hasSlicePlane",void 0),u([G()],Lc.prototype,"hasVertexColors",void 0),u([G()],Lc.prototype,"transparent",void 0),u([G()],Lc.prototype,"draped",void 0),u([G()],Lc.prototype,"stippleEnabled",void 0),u([G()],Lc.prototype,"stippleOffColorEnabled",void 0),u([G()],Lc.prototype,"stipplePreferContinuous",void 0),u([G()],Lc.prototype,"hasOccludees",void 0),u([G({constValue:!1})],Lc.prototype,"stippleRequiresClamp",void 0),u([G({constValue:!1})],Lc.prototype,"stippleScaleWithLineWidth",void 0),u([G({constValue:!1})],Lc.prototype,"stippleRequiresStretchMeasure",void 0);const jrt=fe.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var kF;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(kF||(kF={}));class One extends Qf{constructor(t){super(t,new Wrt),this._techniqueConfig=new Lc}getConfiguration(t,i){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=i.slot===Se.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?oQe(t,s,c,o,1,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||t3(i))return;if(!E_e(r))return void jrt.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(R.POSITION).data,a=s.camera,l=Yrt;ro(l,s.point);const c=2;te(yC[0],l[0]-c,l[1]+c,0),te(yC[1],l[0]+c,l[1]+c,0),te(yC[2],l[0]+c,l[1]-c,0),te(yC[3],l[0]-c,l[1]-c,0);for(let y=0;y<4;y++)if(!a.unprojectFromRenderScreen(yC[y],cm[y]))return;Go(a.eye,cm[0],cm[1],uB),Go(a.eye,cm[1],cm[2],hB),Go(a.eye,cm[2],cm[3],dB),Go(a.eye,cm[3],cm[0],pB);let h=Number.MAX_VALUE,p=0;for(let y=0;y<o.length-5;y+=3){if(pa[0]=o[y]+r[12],pa[1]=o[y+1]+r[13],pa[2]=o[y+2]+r[14],fa[0]=o[y+3]+r[12],fa[1]=o[y+4]+r[13],fa[2]=o[y+5]+r[14],sr(uB,pa)<0&&sr(uB,fa)<0||sr(hB,pa)<0&&sr(hB,fa)<0||sr(dB,pa)<0&&sr(dB,fa)<0||sr(pB,pa)<0&&sr(pB,fa)<0)continue;if(a.projectToRenderScreen(pa,R_),a.projectToRenderScreen(fa,O_),R_[2]<0&&O_[2]>0){pe(Sp,pa,fa);const w=a.frustum,b=-sr(w[rr.NEAR],pa)/xe(Sp,w[rr.NEAR]);oe(Sp,Sp,b),de(pa,pa,Sp),a.projectToRenderScreen(pa,R_)}else if(R_[2]>0&&O_[2]<0){pe(Sp,fa,pa);const w=a.frustum,b=-sr(w[rr.NEAR],fa)/xe(Sp,w[rr.NEAR]);oe(Sp,Sp,b),de(fa,fa,Sp),a.projectToRenderScreen(fa,O_)}else if(R_[2]<0&&O_[2]<0)continue;R_[2]=0,O_[2]=0;const v=yW(Cb(R_,O_,Ine),l);v<h&&(h=v,se(Mne,pa),se(Pne,fa),p=y/3)}const f=s.rayBegin,m=s.rayEnd;if(h<c*c){let y=Number.MAX_VALUE;if(dfe(Cb(Mne,Pne,Ine),Cb(f,m,Xrt),A_)){pe(A_,A_,f);const v=Oe(A_);oe(A_,A_,1/v),y=v/or(f,m)}n(y,A_,p,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(R.POSITION);return yY(s,null,!1,i)}requiresSlot(t){return t===Se.OPAQUE_MATERIAL||t===Se.DRAPED_MATERIAL}createGLMaterial(t){return t.output===J.Color||t.output===J.Highlight?new Hrt(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?Owe:rtt;return A(this.parameters.stipplePattern)?new vU(t):new qrt(t.clone().vec3f(R.AUXPOS1).vec2f(R.UV0))}}class Hrt extends Qv{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===J.Color&&this._updateOccludeeState(t),this.ensureTechnique(RU,t)}}class qrt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(R.POSITION).length}write(t,i,r,s){J5(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s),this._writeAuxpos1(t,i,r,s),this._writeUV0(t,i,r,s)}_writeAuxpos1(t,i,r,s){const n=r.getField(R.AUXPOS1,ji),o=i.indices.get(R.POSITION),a=i.vertexAttributes.get(R.POSITION).data,l=t.transformation,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],v=a[m+1],w=a[m+2],b=l[0]*y+l[4]*v+l[8]*w+l[12],S=l[1]*y+l[5]*v+l[9]*w+l[13],T=l[2]*y+l[6]*v+l[10]*w+l[14];h[s]=b,h[s+1]=S,h[s+2]=T,s+=c}}_writeUV0(t,i,r,s){var E;const n=r.getField(R.UV0,Dh),o=i.indices.get(R.POSITION),a=i.vertexAttributes.get(R.POSITION).data,l=(E=i.vertexAttributes.get(R.DISTANCETOSTART))==null?void 0:E.data,c=t.transformation,h=n.typedBufferStride,p=n.typedBuffer;let f=0;p[s*=h]=kF.START,p[s+1]=f,s+=h;const m=3*o[0],y=te(pa,a[m],a[m+1],a[m+2]);c&&ke(y,y,c);const v=fa,w=o.length-1;let b=1;const S=l?(C,O,I)=>f=l[I]:(C,O,I)=>f+=or(C,O);for(let C=1;C<w;C+=2){const O=3*o[C];te(v,a[O],a[O+1],a[O+2]),c&&ke(v,v,c),S(y,v,b++);for(let I=0;I<2;++I)p[s]=1-I,p[s+1]=f,s+=h;se(y,v)}const T=3*o[w];te(v,a[T],a[T+1],a[T+2]),c&&ke(v,v,c),S(y,v,b),p[s]=kF.END,p[s+1]=f}}class Wrt extends wE{constructor(){super(...arguments),this.color=vh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const pa=M(),fa=M(),Sp=M(),A_=M(),R_=wo(),O_=wo(),Mne=M(),Pne=M(),Ine=Hf(),Xrt=Hf(),Yrt=M(),yC=[wo(),wo(),wo(),wo()],cm=[M(),M(),M(),M()],uB=_i(),hB=_i(),dB=_i(),pB=_i(),Zrt=["mesh"];class Qrt extends Kf{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Gi.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new One({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new One({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Zrt,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new Cu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);_(n)&&n.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,zv)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return A(t)?"-":t instanceof qe?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof dxe){const{metallic:y,roughness:v,metallicRoughnessTexture:w,emissiveColor:b,emissiveTexture:S,occlusionTexture:T}=i.material,E=this._colorOrTextureUid(w),C=this._colorOrTextureUid(b),O=this._colorOrTextureUid(S),I=this._colorOrTextureUid(T);s.metallic=y,s.roughness=v,s.metallicRoughnessTexture=w,s.emissiveColor=b,s.emissiveTexture=S,s.occlusionTexture=T,s.uid=`${s.uid},mrm:${y},mrr:${v},mrt:${E},emuid:${C},etmuid:${O},otmuid:${I}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=qe.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,nr.Opaque);return _(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new Rs(r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:i!==nr.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return bt.CLAMP_TO_EDGE;case"mirror":return bt.MIRRORED_REPEAT;default:return bt.REPEAT}}_setInternalMaterialParameters(t,i){if(_(t.color)&&this._setInternalColorValueParameters(t.color,i),_(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);_(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}_(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),_(t.emissiveColor)&&(i.emissiveFactor=qe.toUnitRGB(t.emissiveColor)),_(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),_(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),_(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=_(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=vh;else{const s=_(this.symbolLayer.material)?this.symbolLayer.material.color:null;_(s)?t.externalColor=qe.toUnitRGBA(s):(r=null,t.externalColor=vh)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(A(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var y,v,w;const r=(y=i.material)==null?void 0:y.color,s=(v=i.material)==null?void 0:v.colorTexture,n=(w=i.material)==null?void 0:w.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||_(r)&&r.a<1||_(s)&&s.transparent||o),l=this._materialProperties(t,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Aa,diffuse:mf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:ar.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?ar.None:ar.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new fw(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?nr.MaskBlend:nr.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?nr.Opaque:i.alphaMode==="mask"?nr.Mask:nr.Blend}_addDebugNormals(t,i,r,s){const n=i.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],h=[],p=[];for(let y=0;y<n;y++){const v=i[y],w=v.vertexAttributes.get(R.POSITION),b=v.vertexAttributes.get(R.NORMAL),S=v.indices.get(R.POSITION),T=v.indices.get(R.NORMAL),E=w.data,C=b.data;for(let O=0;O<S.length;O++){const I=3*S[O],N=3*T[O];for(let D=0;D<3;D++)l.push(E[I+D]);for(let D=0;D<3;D++)l.push(E[I+D]+C[N+D]*a);if(c.push(c.length),c.push(c.length),O%3==0){this._calculateFaceNormal(E,S,O,_x),this._getFaceVertices(E,S,O,co,yx,vx),de(co,co,yx),de(co,co,vx),oe(co,co,1/3);for(let D=0;D<3;D++)h.push(co[D]);for(let D=0;D<3;D++)h.push(co[D]+_x[D]*a);p.push(p.length),p.push(p.length)}}}const f=new Mr([[R.POSITION,{data:l,size:3,exclusive:!0}]],[[R.POSITION,new Uint32Array(c)]],ml.Line);i.push(f),r.push(this._debugVertexNormalMaterial),s.push(Eb(s[0]));const m=new Mr([[R.POSITION,{data:h,size:3,exclusive:!0}]],[[R.POSITION,new Uint32Array(p)]],ml.Line);i.push(m),r.push(this._debugFaceNormalMaterial),s.push(Eb(s[0]))}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:h}=o;Gi.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new iy({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=h;const f=this._createEdgeMaterial(),m=_(f)?{baseMaterial:l[0],edgeMaterials:[f],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,y=new Jf(this,p,a,null,null,iM,r,m);return y.needsElevationUpdates=zv(r.mode),y.useObjectOriginAsAttachmentOrigin=!0,y.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),y.alignedSampledElevation=iM(y,y.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),y}_getCenterPointInElevationSR(t){const i=ty(0,0,0,this._context.elevationProvider.spatialReference);return Npe([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,i,r,s){if(A(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,_x);for(let a=0;a<3;a++){const l=3*s[o+a];co[0]=i[l+0],co[1]=i[l+1],co[2]=i[l+2],xe(_x,co)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return{normals:i,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,i){const r=new Float32Array(i.length),s=new Uint32Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(t,i,n,_x);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return{normals:r,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(t,i,o,_x);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:M(),count:0},r[c]=h),de(h.normal,h.normal,a),h.count++}}const s=new Float32Array(3*i.length),n=new Uint32Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(we(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,co,yx,vx),pe(yx,yx,co),pe(vx,vx,co),lt(co,yx,vx),we(s,co),s}_getOrCreateComponents(t){return vt(t.components,Jrt)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===kc.ECEF?i.transformBeforeProject:null;if(_(s)&&(r=Frt(r,new Float64Array(r.length),s)),i.reprojection===kc.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=_(s)?r:new Float64Array(r.length);return lr(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(A(s))return null;const n=r.reprojection===kc.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=Urt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===kc.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return Nrt(s,o,i,t.spatialReference,a)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(A(s))return null;const n=r.reprojection===kc.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=krt(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===kc.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return zrt(s,o,i,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=Gwe(Tr(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return jwe(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(_(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(_(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(_(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===kc.NONE&&_(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===kc.NONE&&_(a.geometryTransformation)?a.geometryTransformation:Ae()}}_computeReprojectionInfo(t){const i=_(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===Ve.Local?kc.NONE:kc.ECEF;if(i){if(r===kc.NONE){const n=Ae();return bu(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:Eb(t.transform.localMatrix),needsBufferCopy:!1}}const s=V4(Ae(),t.transform.origin);return Fr(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;LI[0]=o.x,LI[1]=o.y,LI[2]=o.z;const a=Ae();bu(t.spatialReference,LI,a,n);const l=_s.fromTypedArray(i);if(us($ne,a),h3(l,l,$ne),_(r)||_(s)){if(Ih(vC,a),$h(vC,vC),_(r)){const c=ji.fromTypedArray(r);Bv(c,c,vC)}if(_(s)){const c=ji.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);Bv(c,c,vC)}}return a}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:M2(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return t.spatialReference.equals(r)?s=i:(s=new Float64Array(i.length),lr(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)),ur(fB),cu(fB,s,0,n),!Bd(fB,this._context.clippingExtent)}_createGeometryInfo(t,i){if(!Df(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,i);if(A(r))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:h,geometryTransformation:p}=r,f=this._getOrCreateComponents(t),m=[],y=[],v=[];let w=!1;for(const b of f){if(!this._validateFaces(t,b))return null;const S=this._getOrCreateFaces(t,b);if(S.length===0)continue;const T=this._createComponentNormals(s,l,b,S);T.didFlipNormals&&(w=!0);const E=[[R.POSITION,{size:3,data:s,exclusive:!0}],[R.NORMAL,{size:3,data:T.normals,exclusive:!0}]],C=[[R.POSITION,S],[R.NORMAL,T.indices]];_(o)&&(E.push([R.COLOR,{size:4,data:o,exclusive:!0}]),C.push([R.COLOR,S])),_(a)&&(E.push([R.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),C.push([R.SYMBOLCOLOR,new Uint16Array(S.length)])),_(n)&&(E.push([R.UV0,{size:2,data:n,exclusive:!0}]),C.push([R.UV0,S])),_(c)&&(E.push([R.TANGENT,{size:4,data:c,exclusive:!0}]),C.push([R.TANGENT,S]));const O=new Mr(E,C);m.push(O),y.push(p),v.push(this._getOrCreateMaterial(t,b))}return w&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:m,transformations:y,materials:v,objectTransformation:h}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return Zbe(this.symbolLayer,t)}}const LI=M(),co=M(),yx=M(),vx=M(),_x=M(),$ne=Ae(),vC=Sr(),fB=Ls(),Jrt=[new Lrt];var kc;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(kc||(kc={}));class Krt{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this.lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){rZ(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,t,i);_(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=M()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Ep),ke(t,this.lodRenderer.baseBoundingSphere.center,Ep)}getBoundingBoxObjectSpace(t=Ls()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Ep);const i=this.lodRenderer.baseBoundingBox;ur(t);for(let r=0;r<8;++r)te(Lu,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),ke(Lu,Lu,Ep),Rf(t,Lu);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Ep),t.render.origin[0]+=Ep[12],t.render.origin[1]+=Ep[13],t.render.origin[2]+=Ep[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=est,l=T4(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Ep);for(let h=0;h<l;h++){const p=a[h];Lu[0]=o[p[0]],Lu[1]=o[p[1]],Lu[2]=o[p[2]],ke(Lu,Lu,Ep),M_[3*h+0]=Lu[0],M_[3*h+1]=Lu[1],M_[3*h+2]=Lu[2]}if(!t(M_,0,l))return null;ur(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],M_[h+p]),o[p+3]=Math.max(o[p+3],M_[h+p]);c&&r.push({location:M_.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(zd(o,mB),this.elevationContext.mode!=="absolute-height")){let h;const p=tZ(o,i);try{h=await i.service.queryElevation(mB[0],mB[1],s,p,"ground")}catch{}_(h)&&_he(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,i){if(t===Fg.Highlight){const r=new OF(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const M_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Lu=M(),mB=M(),est=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Ep=Ae();function tst(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function ist(e){return{levels:e.map(t=>tst(t))}}function rst(e,t=nst){const i=IKe(e);return Math.sqrt(i/(t*Math.PI))}function sst(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=rst(t))})}const nst=.05;function vwt(e){return e=e||globalThis.location.hostname,ast.some(t=>(e==null?void 0:e.match(t))!=null)}function ost(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(fxe)!=null||t.match(gxe)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(mxe)!=null||t.match(yxe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const fxe=/^devext.arcgis.com$/,mxe=/^qaext.arcgis.com$/,gxe=/^[\w-]*\.mapsdevext.arcgis.com$/,yxe=/^[\w-]*\.mapsqa.arcgis.com$/,ast=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,fxe,mxe,/^jsapps.esri.com$/,gxe,yxe];function lst(e,t,i){if(e.count!==t.count)return void aU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=i[9],y=i[10],v=i[11],w=i[12],b=i[13],S=i[14],T=i[15],E=e.typedBuffer,C=e.typedBufferStride,O=t.typedBuffer,I=t.typedBufferStride;for(let N=0;N<r;N++){const D=N*C,z=N*I,B=O[z],k=O[z+1],Y=O[z+2],Z=O[z+3];E[D]=s*B+l*k+f*Y+w*Z,E[D+1]=n*B+c*k+m*Y+b*Z,E[D+2]=o*B+h*k+y*Y+S*Z,E[D+3]=a*B+p*k+v*Y+T*Z}}function vxe(e,t,i){if(e.count!==t.count)return void aU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,w=t.typedBufferStride;for(let b=0;b<r;b++){const S=b*y,T=b*w,E=v[T],C=v[T+1],O=v[T+2],I=v[T+3];m[S]=s*E+a*C+h*O,m[S+1]=n*E+l*C+p*O,m[S+2]=o*E+c*C+f*O,m[S+3]=I}}function cst(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function Fj(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function ust(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:lst,transformMat3:vxe,normalize:cst,scale:Fj,shiftRight:ust},Symbol.toStringTag,{value:"Module"}));function hst(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:hst},Symbol.toStringTag,{value:"Module"}));function dst(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:dst},Symbol.toStringTag,{value:"Module"}));function pst(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function fL(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:pst,makeDense:fL},Symbol.toStringTag,{value:"Module"}));function _xe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function bxe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(sqe(t.elementType)){const h=nqe(t.elementType);if(rqe(t.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else _xe(e,t,i);return e}function fst(e,t,i,r){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=r==null?void 0:r.count)!=null?l:e.count;let a=((c=r==null?void 0:r.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:_xe,normalizeIntegerBuffer:bxe,fill:fst},Symbol.toStringTag,{value:"Module"}));function OU(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function mst(e,t,i,r,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:OU,fill:mst},Symbol.toStringTag,{value:"Module"}));function wxe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function xxe(e,t,i,r,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:wxe,fill:xxe},Symbol.toStringTag,{value:"Module"}));function K1(e,t){return new e(new ArrayBuffer(t*e.ElementCount*T_e(e.ElementType)))}class Txe{constructor(t){this.streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return Gf(t)?(hi(i),$he(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(A(this.streamDataRequester))return(await ai(i,{responseType:gst[t]})).data;const s=await xu(this.streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw nc(s.error),new H("",`Request for resource failed: ${s.error}`)}}const gst={image:"image",binary:"array-buffer",json:"json"},yst=fe.getLogger("esri.views.3d.glTF");class vst{error(t){throw new H("gltf-loader-error",t)}errorUnsupported(t){throw new H("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,i){t&&this.errorUnsupported(i)}assert(t,i){t||this.error(i)}warn(t){yst.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,i){t&&this.warnUnsupported(i)}}function _st(e={}){return F({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}function bst(e,t={}){return{data:e,parameters:F({wrap:F({s:bt.REPEAT,t:bt.REPEAT},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}class gw{constructor(t,i,r=""){this.major=t,this.minor=i,this._context=r}lessThan(t,i){return this.major<t||t===this.major&&this.minor<i}since(t,i){return!this.lessThan(t,i)}validate(t){if(this.major!==t.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new H(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new gw(this.major,this.minor,this._context)}static parse(t,i=""){const[r,s]=t.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new H((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new H((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(r,10),a=parseInt(s,10);return new gw(o,a,i)}}class Dne{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const i=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,i,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var GR,Lne;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(GR||(GR={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Lne||(Lne={}));const Sxe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},wst={pbrMetallicRoughness:Sxe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},xst={ESRI_externalColorMixMode:"tint"},Nne=(e={})=>{const t=F(F({},Sxe),e.pbrMetallicRoughness),i=Tst(F(F({},xst),e.extras));return ve(F(F({},wst),e),{pbrMetallicRoughness:t,extras:i})};function Tst(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const Sst={magFilter:Je.LINEAR,minFilter:Je.LINEAR_MIPMAP_LINEAR,wrapS:bt.REPEAT,wrapT:bt.REPEAT},Est=e=>F(F({},Sst),e);function Cst(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const NI={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class Ym{constructor(t,i,r,s,n){this.context=t,this.errorContext=i,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=Cst(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),i.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),i.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,i,r,s){if(Gf(r)){const a=A4(r);if(a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new Ym(t,i,r,c)}catch{}const l=$he(r);if(Ym._isGLBData(l))return this._fromGLBData(t,i,r,l)}if(r.endsWith(".gltf")){const a=await t.loadJSON(r,s);return new Ym(t,i,r,a)}const n=await t.loadBinary(r,s);if(Ym._isGLBData(n))return this._fromGLBData(t,i,r,n);const o=await t.loadJSON(r,s);return new Ym(t,i,r,o)}static _isGLBData(t){const i=new Dne(t);return i.remainingBytes()>=4&&i.readUint32()===NI.MAGIC}static async _fromGLBData(t,i,r,s){const n=await Ym._parseGLBData(i,s);return new Ym(t,i,r,n.json,n.binaryData)}static async _parseGLBData(t,i){const r=new Dne(i);t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=r.readUint32(),n=r.readUint32(),o=r.readUint32();t.assert(s===NI.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(i.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;r.remainingBytes()>=8;){const h=r.readUint32(),p=r.readUint32();c===0?(t.assert(p===NI.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(h>=0,"No JSON data found."),a=await Ist(r.readUint8Array(h))):c===1?(t.errorUnsupportedIf(p!==NI.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=r.readUint8Array(h)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,i){const r=this.json.buffers[t],s=this.errorContext;if(r.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,i);return s.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,i){const r=this.bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),i).then(o=>new Uint8Array(o));return this.bufferLoaders.set(t,n),n}async getAccessor(t,i){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];r.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(s.type in[GR.MAT2,GR.MAT3,GR.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i),a=Ost[s.type],l=Mst[s.componentType],c=a*l,h=n.byteStride||c;return{raw:o.buffer,byteStride:h,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:h===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,i){if(t.indices==null)return null;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case ht.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case ht.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case ht.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case ht.UNSIGNED_BYTE:return fL(this._wrapAccessor(kg,r));case ht.UNSIGNED_SHORT:return fL(this._wrapAccessor(rw,r));case ht.UNSIGNED_INT:return fL(this._wrapAccessor(nw,r))}}async getPositionData(t,i){const r=this.errorContext;r.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,i);return r.errorUnsupportedIf(s.componentType!==ht.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+UI[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(ji,s)}async getNormalData(t,i){const r=this.errorContext;r.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,i);return r.errorUnsupportedIf(s.componentType!==ht.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+UI[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(ji,s)}async getTangentData(t,i){const r=this.errorContext;r.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,i);return r.errorUnsupportedIf(s.componentType!==ht.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+UI[s.componentType]),r.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new In(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,i){const r=this.errorContext;r.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,i);return r.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===ht.FLOAT?this._wrapAccessor(Dh,s):(r.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),Pst(s))}async getVertexColors(t,i){const r=this.errorContext;r.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,i);if(r.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===ht.FLOAT)return this._wrapAccessor(In,s);if(s.componentType===ht.UNSIGNED_BYTE)return this._wrapAccessor(xl,s);if(s.componentType===ht.UNSIGNED_SHORT)return this._wrapAccessor(Dv,s)}else if(s.componentCount===3){if(s.componentType===ht.FLOAT)return this._wrapAccessor(ji,s);if(s.componentType===ht.UNSIGNED_BYTE)return this._wrapAccessor($v,s);if(s.componentType===ht.UNSIGNED_SHORT)return this._wrapAccessor(sw,s)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+UI[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?Nne(this.json.materials[t.material]):Nne(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),h=r?this.getTexture(n.occlusionTexture,i):null,p=r?this.getTexture(n.emissiveTexture,i):null,f=r?this.getTexture(o.metallicRoughnessTexture,i):null,m=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,i){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.errorContext,n=this.json.textures[r],o=Est(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(r,n,i);return $H(this.textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:h(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:h(o.wrapT),minFilter:o.minFilter,name:a.name,id:r}})}getNodeTransform(t){if(t===void 0)return Rst;let i=this.nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=Fr(Ae(),r,s.matrix):s.translation||s.rotation||s.scale?(i=Eb(r),s.translation&&Ia(i,i,s.translation),s.rotation&&(FI[3]=Yve(FI,s.rotation),tc(i,i,FI[3],FI)),s.scale&&z4(i,i,s.scale)):i=r,this.nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return xh(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=gw.parse(this.json.asset.version,"glTF");Ast.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,i=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&i.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this.nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,i){const r=this.json.images[t.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),i);const s=this.errorContext;s.errorUnsupportedIf(r.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(r.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],o=await this.getBuffer(n.buffer,i);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),$st(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const Ast=new gw(2,0,"glTF"),Rst=vpe(Ae(),Math.PI/2),FI=qg(),Ost={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Mst={[ht.BYTE]:1,[ht.UNSIGNED_BYTE]:1,[ht.SHORT]:2,[ht.UNSIGNED_SHORT]:2,[ht.FLOAT]:4,[ht.UNSIGNED_INT]:4};function Pst(e){switch(e.componentType){case ht.BYTE:return new ow(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ht.UNSIGNED_BYTE:return new iw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ht.SHORT:return new aw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ht.UNSIGNED_SHORT:return new A2(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ht.UNSIGNED_INT:return new R2(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case ht.FLOAT:return new Dh(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function Ist(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function $st(e,t){return new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)):i(o)}),o.addEventListener("error",a=>{URL.revokeObjectURL(n),r(a)}),o.src=n})}const UI={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let Dst=0;async function Exe(e,t,i={},r=!0){const s=await Ym.load(e,mL,t,i),n="gltf_"+Dst++,o={lods:[],materials:new Map,textures:new Map,meta:Lst(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await Nst(s,async(c,h,p,f)=>{var D;const m=(D=l.get(p))!=null?D:0;l.set(p,m+1);const y=c.mode!==void 0?c.mode:Pt.TRIANGLES,v=y===Pt.TRIANGLES||y===Pt.TRIANGLE_STRIP||y===Pt.TRIANGLE_FAN?y:null;if(A(v))return void mL.warnUnsupported("Unsupported primitive mode ("+zst[y]+"). Skipping primitive.");if(!s.hasPositions(c))return void mL.warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(c,i),b=s.getMaterial(c,i,r),S=s.hasNormals(c)?s.getNormalData(c,i):null,T=s.hasTangents(c)?s.getTangentData(c,i):null,E=s.hasTextureCoordinates(c)?s.getTextureCoordinates(c,i):null,C=s.hasVertexColors(c)?s.getVertexColors(c,i):null,O=s.getIndexData(c,i),I={transform:Eb(h),attributes:{position:await w,normal:S?await S:null,texCoord0:E?await E:null,color:C?await C:null,tangent:T?await T:null},indices:await O,primitiveType:v,material:Ust(o,await b,n)};let N=null;_(o.meta)&&_(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(N=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:f,lodThreshold:N},o.lods[p].parts[m]=I});for(const c of o.lods)c.parts=c.parts.filter(h=>!!h);return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{}}}function Lst(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;_(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function Nst(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),Fst(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=e.getNodeTransform(a);if(mL.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function Fst(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Ust(e,t,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=bst(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:kst.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=_st({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const mL=new vst,kst=[Je.LINEAR_MIPMAP_LINEAR,Je.LINEAR_MIPMAP_NEAREST],zst=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function Bst(e,t=M2){return typeof e=="number"?t(e):kL(e)||F1(e)?new Uint32Array(e):e}function Vst(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function Gst(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],o=0;for(let a=0;a<i;++a){const l=e[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}const Um=fe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function Cxe(e,t){const i=await jst(e,t);return{resource:i,textures:await Yst(i.textureDefinitions,t)}}async function jst(e,t){const i=_(t)&&t.streamDataRequester;if(i)return Hst(e,i,t);const r=await xu(ai(e,t));if(r.ok===!0)return r.value.data;nc(r.error),Axe(r.error)}async function Hst(e,t,i){const r=await xu(t.request(e,"json",i));if(r.ok===!0)return r.value;nc(r.error),Axe(r.error.details.url)}function Axe(e){throw new H("",`Request for object resource failed: ${e}`)}function qst(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(Um.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Um.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Um.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(Um.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else Um.warn("Indexed geometries must specify faces"),r=!1;break}default:Um.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(Um.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(Um.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Wst(e,t){const i=[],r=[],s=[],n=[],o=e.resource,a=gw.parse(o.version||"1.0","wosr");Qst.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions,p=e.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const v=c[y];if(!qst(v))continue;const w=Zst(v),b=v.params.vertexAttributes,S=[];for(const D in b){const z=b[D],B=z.values;S.push([D,{data:B,size:z.valuesPerElement,exclusive:!0}])}const T=[];if(v.params.topology!=="PerAttributeArray"){const D=v.params.faces;for(const z in D)T.push([z,new Uint32Array(D[z].values)])}const E=p&&p[w.texture];if(E&&!m.has(w.texture)){const{image:D,params:z}=E,B=new Rs(D,z);n.push(B),m.set(w.texture,B)}const C=m.get(w.texture),O=C?C.id:void 0;let I=s[w.material]?s[w.material][w.texture]:null;if(!I){const D=h[w.material.substring(w.material.lastIndexOf("/")+1)].params;D.transparency===1&&(D.transparency=0);const z=E&&E.alphaChannelUsage,B=D.transparency>0||z==="transparency"||z==="maskAndTransparency",k=E?Rxe(E.alphaChannelUsage):void 0,Y={ambient:il(D.diffuse),diffuse:il(D.diffuse),opacity:1-(D.transparency||0),transparent:B,textureAlphaMode:k,textureAlphaCutoff:.33,textureId:O,initTextureTransparent:!0,doubleSided:!0,cullFace:ar.None,colorMixMode:D.externalColorMixMode||"tint",textureAlphaPremultiplied:!!E&&!!E.params.preMultiplyAlpha};_(t)&&t.materialParamsMixin&&Object.assign(Y,t.materialParamsMixin),I=new fw(Y),s[w.material]||(s[w.material]={}),s[w.material][w.texture]=I}r.push(I);const N=new Mr(S,T);f+=T.position?T.position.length:0,i.push(N)}return{name:l,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:Xst(i),numberOfVertices:f,lodThreshold:null}}function Xst(e){const t=ur();return e.forEach(i=>{const r=i.boundingInfo;_(r)&&(Rf(t,r.getBBMin()),Rf(t,r.getBBMax()))}),t}async function Yst(e,t){const i=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){Um.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:bt.REPEAT,t:bt.REPEAT},preMultiplyAlpha:Rxe(h)!==nr.Opaque},f=_(t)&&t.disableTextures?Promise.resolve(null):ap(l,t);i.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function Rxe(e){switch(e){case"mask":return nr.Mask;case"maskAndTransparency":return nr.MaskBlend;case"none":return nr.Opaque;default:return nr.Blend}}function Zst(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const Qst=new gw(1,2,"wosr"),bx=2.1;async function Oxe(e,t){const i=Mxe(ost(e));if(i.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(i.url,t):Cxe(i.url,t)),c=Wst(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):Exe(new Txe(t.streamDataRequester),i.url,t,t.usePBR)),s=Tr(r.model.meta,"ESRI_proxyEllipsoid");r.meta.isEsriSymbolResource&&_(s)&&r.meta.uri.includes("/RealisticTrees/")&&ent(r,s);const n=r.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!r.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},o=ve(F({},t.materialParamsMixin),{treeRendering:!!r.customMeta.esriTreeRendering});if(i.specifiedLodIndex!=null){const l=gL(r,n,o,i.specifiedLodIndex);let c=l[0].boundingBox;return i.specifiedLodIndex!==0&&(c=gL(r,n,o,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}const a=gL(r,n,o);return{lods:a,referenceBoundingBox:a[0].boundingBox,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}function Mxe(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function gL(e,t,i,r){const s=e.model,n=Sr(),o=new Array,a=new Map,l=new Map;return s.lods.forEach((c,h)=>{if(r!==void 0&&h!==r)return;const p={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:_(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:ur()};o.push(p),c.parts.forEach(f=>{const m=f.material+(f.attributes.normal?"_normal":"")+(f.attributes.color?"_color":"")+(f.attributes.texCoord0?"_texCoord0":"")+(f.attributes.tangent?"_tangent":""),y=s.materials.get(f.material),v=_(f.attributes.texCoord0),w=_(f.attributes.normal),b=Jst(y.alphaMode);if(!a.has(m)){if(v){if(_(y.textureColor)&&!l.has(y.textureColor)){const ne=s.textures.get(y.textureColor),$=ve(F({},ne.parameters),{preMultiplyAlpha:b!==nr.Opaque});l.set(y.textureColor,new Rs(ne.data,$))}if(_(y.textureNormal)&&!l.has(y.textureNormal)){const ne=s.textures.get(y.textureNormal);l.set(y.textureNormal,new Rs(ne.data,ne.parameters))}if(_(y.textureOcclusion)&&!l.has(y.textureOcclusion)){const ne=s.textures.get(y.textureOcclusion);l.set(y.textureOcclusion,new Rs(ne.data,ne.parameters))}if(_(y.textureEmissive)&&!l.has(y.textureEmissive)){const ne=s.textures.get(y.textureEmissive);l.set(y.textureEmissive,new Rs(ne.data,ne.parameters))}if(_(y.textureMetallicRoughness)&&!l.has(y.textureMetallicRoughness)){const ne=s.textures.get(y.textureMetallicRoughness);l.set(y.textureMetallicRoughness,new Rs(ne.data,ne.parameters))}}const D=y.color[0]**(1/bx),z=y.color[1]**(1/bx),B=y.color[2]**(1/bx),k=y.emissiveFactor[0]**(1/bx),Y=y.emissiveFactor[1]**(1/bx),Z=y.emissiveFactor[2]**(1/bx),le=_(y.textureColor)&&v?l.get(y.textureColor):null;a.set(m,new fw(F(ve(F({},t),{transparent:b===nr.Blend,customDepthTest:Qb.Lequal,textureAlphaMode:b,textureAlphaCutoff:y.alphaCutoff,diffuse:[D,z,B],ambient:[D,z,B],opacity:y.opacity,doubleSided:y.doubleSided,doubleSidedType:"winding-order",cullFace:y.doubleSided?ar.None:ar.Back,hasVertexColors:!!f.attributes.color,hasVertexTangents:!!f.attributes.tangent,normals:w?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:_(le)?le.id:void 0,colorMixMode:y.colorMixMode,normalTextureId:_(y.textureNormal)&&v?l.get(y.textureNormal).id:void 0,textureAlphaPremultiplied:_(le)&&!!le.params.preMultiplyAlpha,occlusionTextureId:_(y.textureOcclusion)&&v?l.get(y.textureOcclusion).id:void 0,emissiveTextureId:_(y.textureEmissive)&&v?l.get(y.textureEmissive).id:void 0,metallicRoughnessTextureId:_(y.textureMetallicRoughness)&&v?l.get(y.textureMetallicRoughness).id:void 0,emissiveFactor:[k,Y,Z],mrrFactors:[y.metallicFactor,y.roughnessFactor,t.mrrFactors[2]],isSchematic:!1}),i)))}const S=Kst(f.indices||f.attributes.position.count,f.primitiveType),T=f.attributes.position.count,E=K1(ji,T);h3(E,f.attributes.position,f.transform);const C=[[R.POSITION,{data:E.typedBuffer,size:E.elementCount,exclusive:!0}]],O=[[R.POSITION,S]];if(_(f.attributes.normal)){const D=K1(ji,T);x2(n,f.transform),Bv(D,f.attributes.normal,n),C.push([R.NORMAL,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),O.push([R.NORMAL,S])}if(_(f.attributes.tangent)){const D=K1(In,T);x2(n,f.transform),vxe(D,f.attributes.tangent,n),C.push([R.TANGENT,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),O.push([R.TANGENT,S])}if(_(f.attributes.texCoord0)){const D=K1(Dh,T);bxe(D,f.attributes.texCoord0),C.push([R.UV0,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),O.push([R.UV0,S])}if(_(f.attributes.color)){const D=K1(xl,T);if(f.attributes.color.elementCount===4)f.attributes.color instanceof In?Fj(D,f.attributes.color,255):f.attributes.color instanceof xl?wxe(D,f.attributes.color):f.attributes.color instanceof Dv&&Fj(D,f.attributes.color,1/256);else{xxe(D,255,255,255,255);const z=new $v(D.buffer,0,4);f.attributes.color instanceof ji?Cj(z,f.attributes.color,255):f.attributes.color instanceof $v?OU(z,f.attributes.color):f.attributes.color instanceof sw&&Cj(z,f.attributes.color,1/256)}C.push([R.COLOR,{data:D.typedBuffer,size:D.elementCount,exclusive:!0}]),O.push([R.COLOR,S])}const I=new Mr(C,O);p.stageResources.geometries.push(I),p.stageResources.materials.push(a.get(m)),v&&(_(y.textureColor)&&p.stageResources.textures.push(l.get(y.textureColor)),_(y.textureNormal)&&p.stageResources.textures.push(l.get(y.textureNormal)),_(y.textureOcclusion)&&p.stageResources.textures.push(l.get(y.textureOcclusion)),_(y.textureEmissive)&&p.stageResources.textures.push(l.get(y.textureEmissive)),_(y.textureMetallicRoughness)&&p.stageResources.textures.push(l.get(y.textureMetallicRoughness))),p.numberOfVertices+=T;const N=I.boundingInfo;_(N)&&(Rf(p.boundingBox,N.getBBMin()),Rf(p.boundingBox,N.getBBMax()))})}),o}function Jst(e){switch(e){case"BLEND":return nr.Blend;case"MASK":return nr.Mask;case"OPAQUE":case null:case void 0:return nr.Opaque}}function Kst(e,t){switch(t){case Pt.TRIANGLES:return Bst(e);case Pt.TRIANGLE_STRIP:return Vst(e);case Pt.TRIANGLE_FAN:return Gst(e)}}function ent(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const s of r.parts){const n=s.attributes.normal;if(A(n))return;const o=s.attributes.position,a=o.count,l=M(),c=M(),h=M(),p=K1(xl,a),f=K1(ji,a),m=us(Ae(),s.transform);for(let y=0;y<a;y++){o.getVec(y,c),n.getVec(y,l),ke(c,c,s.transform),pe(h,c,t.center),aN(h,h,t.radius);const v=h[2],w=Oe(h),b=Math.min(.45+.55*w*w,1);aN(h,h,t.radius),ke(h,h,m),we(h,h),i+1!==e.model.lods.length&&e.model.lods.length>1&&tn(h,h,l,v>-1?.2:Math.min(-4*v-3.8,1)),f.setVec(y,h),p.set(y,0,255*b),p.set(y,1,255*b),p.set(y,2,255*b),p.set(y,3,255)}s.attributes.normal=f,s.attributes.color=p}}}var _wt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetch:Oxe,gltfToEngineResources:gL,parseUrl:Mxe}),br;function tnt(e){let t=es().mat4f64(R.LOCALTRANSFORM).mat4f64(R.GLOBALTRANSFORM).vec4f64(R.BOUNDINGSPHERE).vec3f64(R.MODELORIGIN).mat3f(R.MODEL).mat3f(R.MODELNORMAL).vec2f(R.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(R.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(R.FEATUREATTRIBUTE)),t=t.u8(R.STATE).u8(R.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(br||(br={}));class int{constructor(t){this.localTransform=t.getField(R.LOCALTRANSFORM,Iv),this.globalTransform=t.getField(R.GLOBALTRANSFORM,Iv),this.modelOrigin=t.getField(R.MODELORIGIN,_s),this.model=t.getField(R.MODEL,lp),this.modelNormal=t.getField(R.MODELNORMAL,lp),this.modelScaleFactors=t.getField(R.MODELSCALEFACTORS,Dh),this.boundingSphere=t.getField(R.BOUNDINGSPHERE,tw),this.color=t.getField(R.COLOR,In),this.featureAttribute=t.getField(R.FEATUREATTRIBUTE,In),this.state=t.getField(R.STATE,kg),this.lodLevel=t.getField(R.LODLEVEL,kg)}}class rnt extends Kr{constructor(t,i){super(),this._capacity=0,this._size=0,this._next=0,this._layout=tnt(t),this._shaderTransformation=i}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,br.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const i=this._view.state;dt(t>=0&&t<this._capacity&&i.get(t)&br.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,br.ACTIVE)?this._setStateFlags(t,br.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const i=this._view.state;dt(t>=0&&t<this._capacity&&i.get(t)&br.ALLOCATED,"invalid instance handle"),i.set(t,0),this._size--}setLocalTransform(t,i,r=!0){this._view.localTransform.setMat(t,i),r&&this.updateModelTransform(t)}getLocalTransform(t,i){this._view.localTransform.getMat(t,i)}setGlobalTransform(t,i,r=!0){this._view.globalTransform.setMat(t,i),r&&this.updateModelTransform(t)}getGlobalTransform(t,i){this._view.globalTransform.getMat(t,i)}updateModelTransform(t){const i=this._view,r=xy,s=Zh;i.localTransform.getMat(t,Fne),i.globalTransform.getMat(t,gB);const n=Fr(gB,gB,Fne);te(r,n[12],n[13],n[14]),i.modelOrigin.setVec(t,r),Ih(s,n),i.model.setMat(t,s);const o=N$e(xy,n);o.sort(),i.modelScaleFactors.set(t,0,o[1]),i.modelScaleFactors.set(t,1,o[2]),Nw(s,s),$h(s,s),i.modelNormal.setMat(t,s),this._setStateFlags(t,br.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,i){const r=this._view;r.model.getMat(t,Zh),r.modelOrigin.getVec(t,xy),i[0]=Zh[0],i[1]=Zh[1],i[2]=Zh[2],i[3]=0,i[4]=Zh[3],i[5]=Zh[4],i[6]=Zh[5],i[7]=0,i[8]=Zh[6],i[9]=Zh[7],i[10]=Zh[8],i[11]=0,i[12]=xy[0],i[13]=xy[1],i[14]=xy[2],i[15]=1}applyShaderTransformation(t,i){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i)}getCombinedModelTransform(t,i){return this.getModelTransform(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedLocalTransform(t,i){return this._view.localTransform.getMat(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedMaxScaleFactor(t){let i=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(xy,this,t);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(t){let i=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(xy,this,t);r.sort(),i*=r[1]}return i}getModel(t,i){this._view.model.getMat(t,i)}setFeatureAttribute(t,i){this._view.featureAttribute.setVec(t,i)}getFeatureAttribute(t,i){this._view.featureAttribute.getVec(t,i)}setColor(t,i){this._view.color.setVec(t,i)}getColor(t,i){this._view.color.getVec(t,i)}setVisible(t,i){i!==this.getVisible(t)&&(this._setStateFlag(t,br.VISIBLE,i),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,br.VISIBLE)}setHighlight(t,i){i!==this.getHighlight(t)&&(this._setStateFlag(t,br.HIGHLIGHT,i),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,br.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&t&&++i;return i}_setStateFlags(t,i){const r=this._view.state;i=r.get(t)|i,r.set(t,i)}_clearStateFlags(t,i){const r=this._view.state;i=r.get(t)&~i,r.set(t,i)}_setStateFlag(t,i,r){r?this._setStateFlags(t,i):this._clearStateFlags(t,i)}_getStateFlag(t,i){return!!(this._view.state.get(t)&i)}_grow(){const t=Math.max(snt,Math.floor(this._capacity*nnt)),i=this._layout.createBuffer(t);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=t,this._buffer=i,this._view=new int(this._buffer)}_findSlot(){const t=this._view.state;let i=this._next;for(;t.get(i)&br.ALLOCATED;)i=(i+1)%this._capacity;return this._next=(i+1)%this._capacity,i}}const snt=1024,nnt=2,xy=M(),Zh=Sr(),Fne=Ae(),gB=Ae();class ont extends qd{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=mn(),this._tmpMat4=Ae(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);ke(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*qb(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class ant{constructor(t,i){this.thresholdScale=1,this._camera=new Qi,this._worldSpaceRadius=t,this._thresholds=i.map(r=>r)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,i){const r=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*i/r,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class lnt{constructor(t,i){const r=t.renderContext.rctx,{geometry:s,material:n}=i;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write({},s,c,0),this.geometry=s,this.material=n,this.glMaterials=new uwe(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=ii.createVertex(r,bi.STATIC_DRAW,c.buffer),this.vao=new Ns(r,Ni,{geometry:vc(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,r,s,(h,p,f,m,y)=>{if(h>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,h))return;const v={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:c,triangleNr:f,baseBoundingSphere:a,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||y>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(Dr.LOD,v,h,p,t.transform.transform,y),t.options.store!==io.MIN&&(t.results.max.drapedLayerOrder==null||y>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(Dr.LOD,v,h,p,t.transform.transform,y),t.options.store===io.ALL){const w=xY(t.results.min.ray);w.set(Dr.LOD,v,h,p,t.transform.transform,y),t.results.all.push(w)}}})}}class bZ{constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}static async create(t,i,r){const s=await Promise.allSettled(i.components.map(o=>t.schedule(()=>new lnt(t,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(Xs(r)||n.length!==s.length){n.forEach(o=>o.destroy()),hi(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new bZ(i.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(t,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(A(this._boundingBox)){const t=ur();this.components.forEach(i=>{_(i.boundingInfo)&&(Rf(t,i.boundingInfo.bbMin),Rf(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(A(this._boundingSphere)){const t=this.boundingBox,i=M();zd(t,i),this._boundingSphere={center:i,radius:.5*vhe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class cnt{constructor(t,i,r){this._elementSize=i,this._buffer=ii.createVertex(t,bi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(this._array,r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class unt{constructor(t){this.modelOriginHi=t.getField(R.MODELORIGINHI,ji),this.modelOriginLo=t.getField(R.MODELORIGINLO,ji),this.model=t.getField(R.MODEL,lp),this.modelNormal=t.getField(R.MODELNORMAL,lp),this.color=t.getField(R.INSTANCECOLOR,In),this.featureAttribute=t.getField(R.INSTANCEFEATUREATTRIBUTE,In)}}class Une{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){dt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){dt(this._updating,"not updating"),this.size<dnt*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){dt(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),dt(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){dt(this._updating,"not updating"),dt(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(kne,Math.floor(this._capacity*hnt));this._resize(t)}_shrink(){const t=Math.max(kne,Math.floor(this._capacity*pnt));this._resize(t)}_resize(t){if(dt(this._updating,"not updating"),t===this._capacity)return;const i=new cnt(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);dt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new unt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const kne=1024,hnt=2,dnt=.3,pnt=.5;let fnt=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new ant(t,i)};class mnt{constructor(t,i,r,s){this.type=Dr.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new Qi,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Se.OPAQUE_MATERIAL,Se.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=i,this._metadata=r,this._instanceBufferLayout=Jwe({instancedDoublePrecision:!0,instanced:i}),this._glInstanceBufferLayout=vc(this._instanceBufferLayout,1),this._instanceData=new rnt(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),t}get renderStats(){const t=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(t,i){this._context=t;const r=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new Une(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new Une(r,this._instanceBufferLayout)),bZ.create(t,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(Xs(i)||n.length!==s.length){n.forEach(o=>o.destroy()),hi(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=fnt(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(i=>i.material.requiresSlot(Se.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(Gi.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const r=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),r||this._requestUpdateCycle()}const i=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,i),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const i=t.pass!==Ge.MATERIAL_HIGHLIGHT&&t.pass!==Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,r=t.pass!==Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;i&&this._renderComponents(t,this._defaultRenderInstanceData),r&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,i,r,s){if(!this.baseMaterial.isVisible())return;const n=M();pe(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,Vne),t.transform.set(Vne),ke(Gne,r,t.transform.inverse),ke(jne,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;dt(l&br.ACTIVE,"invalid instance state"),dt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(t,i,Gne,jne,a,this._metadata,h)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(r,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new ont(this._instanceData,this.baseBoundingSphere),i=this._instanceData,r=i.view?i.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)r.get(s)&br.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const i=t.eye,r=t.viewForward,s=this.octree.findClosest(r,qd.DepthOrder.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(r,qd.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,Cp),pe(Cp,Cp,i);const o=xe(Cp,r)-Cp[3];this._instanceData.view.boundingSphere.getVec(n,Cp),pe(Cp,Cp,i);const a=xe(Cp,r)+Cp[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,i){const r=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(h=>{h.beginUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.beginUpdate()});const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;i=Math.min(a,i);for(let h=0;h<i;++h){c===0&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&br.ALLOCATED)){c=(c+1)%l,i++;continue}const m=o.lodLevel.get(c);if(p&br.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&br.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&br.REMOVE)n.freeInstance(c);else if(p&br.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,Bne),y=s.selectLevel(Bne,n.getCombinedMedianScaleFactor(c))),f=p&~(br.ACTIVE|br.TRANSFORM_CHANGED),y>=0&&(p&br.HIGHLIGHT?(zne(this._highlightRenderInstanceData[y],o,c),f|=br.HIGHLIGHT_ACTIVE):(zne(this._defaultRenderInstanceData[y],o,c),f|=br.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(br.ACTIVE|br.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octree){const y=!!(p&br.ACTIVE),v=!!(f&br.ACTIVE);!y&&v?this._octree.addInstance(c):y&&!v?this._octree.removeInstance(c):y&&v&&p&br.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>{h.endUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.endUpdate()})}_renderComponents(t,i){this.levels.forEach((r,s)=>{r.components.forEach(n=>{this._renderComponent(t,i[s],n,s)})})}_renderComponent(t,i,r,s){const n=t.bindParameters;if(i.size===0||!r.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=t,l=r.glMaterials.load(o,a);if(A(l))return;const c=l.beginSlot(n),h=o.bindTechnique(c,r.material.parameters,n);o.bindVAO(r.vao),c.ensureAttributeLocations(r.vao),c.bindDraw(ynt,n),Gi.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===Ge.MATERIAL&&(h.setUniform4fv("externalColor",Hne[Math.min(s,Hne.length-1)]),h.setUniform1i("colorMixMode",ibe.replace));const p=o.capabilities.instancing,f=i.capacity,m=i.headIndex,y=i.tailIndex,v=i.firstIndex,w=this._glInstanceBufferLayout,b=(S,T)=>{XX(o,Ni,i.buffer,w,S),p.drawArraysInstanced(c.primitiveType,0,r.vertexCount,T-S),YX(o,Ni,i.buffer,w)};r.material.parameters.transparent&&v!=null?m>y?(dt(v>=y&&v<=m,"invalid firstIndex"),b(v,m),b(y,v)):m<y&&(v<=m?(dt(v>=0&&v<=m,"invalid firstIndex"),b(v,m),b(y,f),b(0,v)):(dt(v>=y&&v<=f,"invalid firstIndex"),b(v,f),b(0,m),b(y,v))):m>y?b(y,m):m<y&&(b(0,m),b(y,f)),o.bindVAO(null)}}function zne(e,t,i){const r=e.allocateHead();gnt(t,i,e.view,r)}function gnt(e,t,i,r){LWe(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const Bne=M(),Cp=Gt(),Vne=Ae(),Gne=M(),jne=M(),Hne=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],ynt=new ztt;class vnt extends Kf{constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[t,i,r]=_(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}async doLoad(t){if(!this._drivenProperties.size&&sU(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this.isPrimitive){const r=i.resource?i.resource.primitive:Khe;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return _(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Tr(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,i=Tr(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?ar.None:ar.Back,t}async _createResourcesForPrimitive(t,i){if(!xKe(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=Ls(_Oe(t)),n=il(Y3(s)),o=il(Rk(n,r)),a=Oe(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:mf,diffuse:mf,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:b,minWorldLength:S,maxWorldLength:T}=f.verticalOffset;h.verticalOffset={screenLength:eo(b),minWorldLength:S||0,maxWorldLength:T!=null?T:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=vh;else{const b=_(r.material)&&r.material.color,S=_(b)?qe.toUnitRGBA(b):vh;h.externalColor=S}this._fastUpdates=lM(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,j_)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const m=new fw(h),y=Ybe(t,m);if(!y)throw new Error(`Unknown object symbol primitive: ${t}`);const v=_I(y).map(b=>({opacity:1,transparent:b.parameters.transparent})),w=await this._createStageResources(y,p);return{lodResources:y,lodRenderer:await this._createLodRenderer(y,i),stageResources:w,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:v,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:j_}}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=lM(this._context.renderer,this._fastVisualVariableConvertOptions(j_,j_,j_,j_)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:D,minWorldLength:z,maxWorldLength:B}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:eo(D),minWorldLength:z||0,maxWorldLength:B!=null?B:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled;const o=s.usePBR,a=await Oxe(t,s),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource(()=>a.remove());const h=ist(a.lods);sst(h),h.levels.sort((D,z)=>D.minScreenSpaceRadius-z.minScreenSpaceRadius),h.levels[0].minScreenSpaceRadius=Math.min(2,h.levels[0].minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),y=Tr(this.symbolLayer,"material","color"),v=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),w=this.needsDrivenTransparentPass,b=_I(h),S=_I(h).map(D=>({opacity:D.parameters.opacity||1,transparent:D.parameters.transparent}));b.forEach(D=>{const z=D.parameters;D.setParameters(m);const B=z.opacity*v,k=B<1||w||z.transparent;D.setParameters({opacity:B,transparent:k}),p.screenSizePerspectiveEnabled&&D.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,E=il(Y3(T)),C=il(h.levels[0].pivotOffset),O=il(Rk(E,this.symbolLayer)),I=Oe(O);cM(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,O,E,C))&&b.forEach(D=>D.setParameters(this._fastUpdates.materialParameters));const N=await this._createStageResources(h,o);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,i),stageResources:N,symbolSize:O,extentPadding:I,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:S,physicalBasedRenderingEnabled:o,resourceBoundingBox:T,resourceSize:E,pivotOffset:C}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,i){const r=this._context.stage,s=_I(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s),this._addDisposeResource(()=>r.removeMany(s));const n=MKe(t);r.addMany(n),this._addDisposeResource(()=>r.removeMany(n)),await r.load(n);const o=PKe(t);return r.addMany(o),this._addDisposeResource(()=>r.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,kI),gs(c,Ij(this._fastUpdates.materialParameters,kI,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,kI),Sit(a,this._fastUpdates.materialParameters,kI))}:null,o=new mnt(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o)}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=vh:_(t)&&_(t.color)?i.externalColor=qe.toUnitRGBA(t.color):(i.externalColor=vh,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=sM(i.geometry);if(A(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new Cu),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(A(this._resources))return!0;const t=this._drivenProperties.opacity,i=!this.isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=Tr(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?ar.None:ar.Back})}return!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,zv)}slicePlaneEnabledChanged(){if(A(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(A(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,i){if(A(this._resources))return Qs.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!cM(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return Qs.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return Qs.Fast_Update}computeComplexity(){return A(this._resources)?super.computeComplexity():{primitivesPerFeature:nZ(this._resources.lodResources.levels[0]).reduce((t,i)=>t+i.indices.get(R.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:ewe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return _(this._resources)}_createAs3DShape(t,i,r,s,n){if(!this._hasLodRenderer()||A(this._resources))return null;const o=this.getFastUpdateAttrValues(t),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?FR(r.color,r.opacity):null,l=this._context.clippingExtent;if(Pn(i,wx,this._context.elevationProvider.spatialReference),_(l)&&!_q(l,wx))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(i,s,yB,zI),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,qne),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),o&&f.setFeatureAttribute(m,o),a&&f.setColor(m,a);const y=new Krt(this,m,fKe,s);return c&&(y.alignedSampledElevation=zI.sampledElevation),y.needsElevationUpdates=zv(s.mode),rM(y,i,this._context.elevationProvider),y}_computeGlobalTransform(t,i,r,s){return Bg(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),wx[0]=t.x,wx[1]=t.y,wx[2]=s.z,bu(t.spatialReference,wx,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return $f(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=mse(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||z4(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(A(this._resources))return!0;const r=i&&sM(i);if(A(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,yB,zI),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=zI.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,yB,!0),rM(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||A(this._resources))return;const r=(y,v,w)=>vt(y!=null&&y.type==="complete"?y.newValue:v,w),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===Jc.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=il(Rk(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((y,v)=>{const w=this._computeLocalTransform(m,f,v,qne),b=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,w,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=_(s)?qe.toUnitRGBA(s):vh;delete r.color;const o=this._resources;A(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return rKe(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=M();switch(r.anchor){case"center":se(s,zd(t)),Wo(s,s);break;case"top":{const n=zd(t);te(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=zd(t);te(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=zd(t),o=Y3(t),a=r.anchorPosition,l=a?Ue(a.x,a.y,a.z):Aa;v4(s,o,l),de(s,s,n),Wo(s,s);break}default:_(i)?Wo(s,i):se(s,Aa)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&Ia(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=_(t)?il(Y3(t)):mf,o=_(t)?this._computeAnchor(t,s,this.symbolLayer):Aa,a=this._context.renderCoordsHelper.unitInMeters,l=mse(_(i)?i:void 0,i,r,a),c=Ue(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:_(i)?i:mf,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const wx=M(),qne=Ae(),yB=Ae(),kI=Gt(),zI=new u3;function _nt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function bnt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function wZ(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function wnt(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function xnt(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null}function Tnt(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function Snt(e){return e[0]*e[3]-e[2]*e[1]}function Pxe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*h,e[3]=s*c+o*h,e}function Ent(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e}function Cnt(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function Ant(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function Rnt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function Ont(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Mnt(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function Pnt(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function Int(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function Ixe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function $nt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Dnt(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Et*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Et*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Et*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Et*Math.max(1,Math.abs(n),Math.abs(c))}function Lnt(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Nnt(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const Fnt=Pxe,Unt=Ixe;Object.freeze(Object.defineProperty({__proto__:null,copy:_nt,identity:bnt,set:wZ,transpose:wnt,invert:xnt,adjoint:Tnt,determinant:Snt,multiply:Pxe,rotate:Ent,scale:Cnt,fromRotation:Ant,fromScaling:Rnt,str:Ont,frob:Mnt,LDU:Pnt,add:Int,subtract:Ixe,exactEquals:$nt,equals:Dnt,multiplyScalar:Lnt,multiplyScalarAndAdd:Nnt,mul:Fnt,sub:Unt},Symbol.toStringTag,{value:"Module"}));class knt extends Mr{constructor(t,i,r,s,n,o){super(t,i),this.path=r,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function $xe(e){return"upVectorAlignment"in e}function Dxe(){return[1,0,0,1]}function znt(e){return[e[0],e[1],e[2],e[3]]}function Bnt(e,t,i,r){return[e,t,i,r]}function Vnt(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:Dxe,clone:znt,fromValues:Bnt,createView:Vnt},Symbol.toStringTag,{value:"Module"}));function Uj(){return{up:M(),right:M()}}function Gnt(e,t,i){ke(e.up,t.up,i),ke(e.right,t.right,i)}function jnt(e,t,i){pi(e,xe(i,t.right),xe(i,t.up))}class Hnt{constructor(){this.pos=M(),this.posES=M(),this.posGS=M(),this.vRight=M(),this.vLeft=M(),this.frame=Uj(),this.rotationFrame=Uj(),this.rotationRight=tt(),this.rotationAngle=0,this.miterStretch=Dxe()}setFrameFromUpVector(t){se(this.frame.up,t),de(Ku,this.vLeft,this.vRight),we(Ku,Ku),oe(_d,this.frame.up,xe(Ku,this.frame.up)),pe(VI,Ku,_d),we(VI,VI),lt(this.frame.right,VI,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){se(this.rotationFrame.up,this.frame.up),se(this.rotationFrame.right,this.frame.right),pi(this.rotationRight,1,0),oe(_d,this.frame.up,xe(this.frame.up,this.vLeft)),pe(_d,this.vLeft,_d),Wo(_d,_d),we(_d,_d),oe(Ku,this.frame.up,xe(this.frame.up,this.vRight)),pe(Ku,this.vRight,Ku),we(Ku,Ku),lt(kj,this.rotationFrame.up,this.vLeft);const t=Math.sign(xe(kj,this.vRight));if(this.rotationAngle=t*(Math.PI-rn(xe(_d,Ku))),Math.abs(this.rotationAngle)>0){const r=G8(Math.cos(.5*this.rotationAngle));wZ(this.miterStretch,r-1+1,0,0,1)}const i=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*i))}}class hM{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,i){return this.vertices.push(gA(t)),this.vertexNormals.push(gA(i)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,i=null){return this.poles.push({position:gA(t),normal:i?gA(i):null}),this.poles.length-1}addSegment(t,i=null,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.uvIndices.push(i.v0),this.uvIndices.push(i.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}static circle(t=20){const r=new hM,s={v0:0,v1:0};r.addPole(Ii(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),h=Math.sin(l),p=Ii(c*.5,h*.5),f=Ii(c,h);r.addVertex(p,f),r.addUV(a/t)}r.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;r.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return r.addSegment(n,o,s),r}static rect(){const r=new hM,s=Ii(.5*-1,.5*-1),n=Ii(.5*1,.5*-1),o=Ii(.5*1,.5*1),a=Ii(.5*-1,.5*1),l=Ii(0,-1),c=Ii(1,0),h=Ii(0,1),p=Ii(-1,0);r.addUV(0),r.addUV(1),r.addPole(Ii(0,.5*1),h),r.addPole(Ii(0,.5*1)),r.addPole(Ii(0,.5*-1)),r.addPole(Ii(0,.5*-1),l);const f={v0:0,v1:1};return r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},f,{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},f,{v0:2,v1:1}),r.addVertex(o,h),r.addVertex(a,h),r.addSegment({v0:4,v1:5},f,{v0:0,v1:0}),r.addVertex(a,p),r.addVertex(s,p),r.addSegment({v0:6,v1:7},f,{v0:1,v1:2}),r}}class qnt{constructor(t){this.vertices=[],this.offset=M(),this.xform=Ae(),this.vertices=t;const i=Math.floor((t.length-1)/2);se(this.offset,this.vertices[i].pos);for(const r of this.vertices)pe(r.pos,r.pos,this.offset);Ia(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let i=this.vertices[0];i.index=0,te(i.vLeft,0,0,0),i.vLeftLength=0,pe(i.vRight,this.vertices[1].pos,i.pos),i.vRightLength=Oe(i.vRight),we(i.vRight,i.vRight);let r=i;for(let s=1;s<t;++s)i=this.vertices[s],i.index=s,se(i.vLeft,r.vRight),i.vLeftLength=r.vRightLength,s<t-1?(pe(i.vRight,this.vertices[s+1].pos,i.pos),i.vRightLength=Oe(i.vRight),we(i.vRight,i.vRight)):(se(i.vRight,i.vLeft),i.vRightLength=i.vLeftLength),r=i}}function Wnt(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=M(),o=M(),a=M(),l=M(),c=M(),h=M(),p=_i();let f=e.vertices[0];se(o,t),te(n,0,1,0),jl.makeOrthoBasisDirUpFallback(f.vRight,o,n,n,a,o,s),se(f.frame.up,o),se(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=e.vertices[m],de(c,f.vLeft,f.vRight);let y=Oe(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),de(h,i.pos,i.frame.up),a2(f.pos,c,p),Pw(p,wu(h,f.vLeft),l)?(pe(l,l,f.pos),we(o,l),lt(a,c,o),we(a,a)):jl.makeOrthoBasisDirUpFallback(c,i.frame.up,i.frame.right,n,a,o,s),se(f.frame.up,o),se(f.frame.right,a),i=f}}class Xnt{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class vB{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=tot;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){_u(Yne,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),Gnt(s,t.frame,Yne);for(let o=0;o<i.vertices.length;++o)Vs(i.vertices[o],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[o],i.vertexNormals[o],!1):(J7(mb,i.vertices[o],t.miterStretch),r(t.index,t.frame,mb,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=Vs(i.vertices[o],t.rotationRight)*t.rotationAngle>=0;J7(mb,i.vertices[o],t.miterStretch),r(t.index,t.frame,mb,i.vertexNormals[o],!a)}}}const Ynt={generateUV:!1};class xZ{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class Wne extends xZ{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class BI extends xZ{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=TZ;pi(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}}class Xne extends xZ{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=mb,o=TZ;pi(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(t.index,r,l.position,l.normal,s,0):i(t.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(t.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];df(n,this.profile.vertices[p],f.position),Jl(n,n,c),f.normal?(Rd(n,n,f.position),i(t.index,r,n,f.normal,s*h,0)):(OO(o,n),Jl(o,o,c),Rd(n,n,f.position),i(t.index,r,n,o,s*h,this.sign*h))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,y=s+f*this.profile.vertices.length+a;this.flip?(i(m,p,h),i(p,m,y)):(i(h,p,m),i(y,m,p)),h=m,p=y}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}}class Znt{constructor(t,i,r,s,n,o=Ynt){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,i,r){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=i,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[i],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=i,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}_rebuildGeometry(){const t=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const t=(o,a,l)=>this.emitTriangle(o,a,l);this._triangleCount=0;const i=this.profile.vertices.length,r=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(r*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=i*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let o=0;o<r;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<s;++c){const h=c*i+a,p=(c+1)*i+l,f=c*i+l;t(h,(c+1)*i+a,p),t(h,p,f)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class Lxe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class Nxe extends Lxe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=Jnt;te(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=_d,l=mb,c=Ku,h=kj,p=eot;let f=0,m=0;if(te(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),te(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),pi(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)lt(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const v=TZ,w=Knt;pi(v,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const b=jX(v);OO(v,v);const S=Vs(l,v);if(Math.abs(S)>b){pi(w,-v[1],v[0]);const T=Vs(l,w);Jl(v,v,b*Math.sign(S)),Jl(w,w,T),Rd(l,v,w)}te(c,0,0,0)}te(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const y=mb;pi(y,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*y[0]+p[0]*y[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*y[0]+p[1]*y[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*y[0]+p[2]*y[1]+c[2]*m}}createGeometryData(){const t=[[R.POSITION,this.builder.vertexIndices],[R.NORMAL,this.builder.normalIndices]],i=[[R.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[R.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([R.COLOR,new Uint32Array(r)]),i.push([R.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;s3(t,i,0,o,s,n,void 0,void 0,r)}}class Qnt extends Lxe{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new Nxe(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[R.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[R.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[R.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[R.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[R.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[R.POSITION,this.builder.pathVertexIndices],[R.PROFILERIGHT,this.builder.vertexIndices],[R.PROFILEUP,this.builder.vertexIndices],[R.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[R.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const Jnt=M(),mb=tt(),TZ=tt(),Knt=tt(),_d=M(),Ku=M(),kj=M(),eot=M(),VI=M(),tot=Uj(),Yne=Ae(),_B=8;function iot(e,t){e.attributes.add(R.FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(x`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new fi("size",r=>r.size)),t.vvSize?(i.uniforms.add(new xt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new xt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new xt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new xt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(x`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",_B),i.uniforms.add([new Ho("vvOpacityValues",r=>r.vvOpacityValues,_B),new Ho("vvOpacityOpacities",r=>r.vvOpacityOpacities,_B)]),i.code.add(x`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(x`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",Jd),i.uniforms.add([new Ho("vvColorValues",r=>r.vvColorValues,Jd),new K5("vvColorColors",r=>r.vvColorColors,Jd)]),i.code.add(x`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(x`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(pU),e.attributes.add(R.PROFILERIGHT,"vec4"),e.attributes.add(R.PROFILEUP,"vec4"),e.attributes.add(R.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(x`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(x`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(x`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(x`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class rot extends QY{constructor(){super(...arguments),this.size=Ii(1,1)}}function sot(e){const t=new Hi,i=mu(t,e),{vertex:r,fragment:s}=t;return t.varyings.add("vpos","vec3"),t.include(iot,e),e.output!==J.Color&&e.output!==J.Alpha||(t.include(To),t.include(dw,e),t.include(f3,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(x`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===J.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(Su,e),e.output===J.Alpha&&(t.include(cs,e),s.uniforms.add(new We("opacity",n=>n.opacity)),s.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===J.Color&&(t.include(cs,e),t.include(pw,e),t.include(y3,e),t.include(dw,e),t.include(zwe,e),Ff(s,e),s.uniforms.add([i,new xt("ambient",n=>n.ambient),new xt("diffuse",n=>n.diffuse),new xt("specular",n=>n.specular),new We("opacity",n=>n.opacity),new We("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new xt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),s.constants.add("ambientBoostFactor","float",gE),s.include(Yf),s.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==J.Depth&&e.output!==J.Shadow||(t.include(To,{hasModelTransformation:!1,linearDepth:!0}),r.uniforms.add(new fi("nearFar",(n,o)=>o.camera.nearFar)),t.varyings.add("depth","float"),r.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(cs,e),t.include(e_,e),s.code.add(x`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===J.Normal&&(t.include(To),t.include(ov,e),r.uniforms.add(new yr("viewNormal",(n,o)=>o.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(cs,e),s.uniforms.add(new Ca("waterColor")),s.code.add(x`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===J.Highlight&&(t.include(To),t.include(ov,e),t.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(cs,e),t.include(Kg),s.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const not=Object.freeze(Object.defineProperty({__proto__:null,build:sot},Symbol.toStringTag,{value:"Module"})),Fxe=new Map([[R.POSITION,0],[R.PROFILERIGHT,1],[R.PROFILEUP,2],[R.PROFILEVERTEXANDNORMAL,3],[R.FEATUREVALUE,4]]);class oot extends rot{constructor(){super(...arguments),this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.specular=Ue(0,0,0),this.opacity=1}}class MU extends cr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global,i.doublePrecisionRequiresObfuscation=p3(t.rctx)}initializeProgram(t){const i=MU.shader.get().build(this.configuration);return new er(t.rctx,i,Fxe)}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace,n=o=>!o.hasSlicePlane&&!(o.transparent||o.doubleSidedMode===Nr.None);return Ut({blending:i.output!==J.Color&&i.output!==J.Alpha||!i.transparent?null:r?gu:ey(t),culling:n(i)&&$ve,depthTest:{func:Kv(t)},depthWrite:r||s?wl:null,colorWrite:Kt,stencilWrite:i.hasOccludees?kf:null,stencilTest:i.hasOccludees?t_:null,polygonOffset:r||s?null:iU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}MU.shader=new Ki(not,()=>import("./Path.glsl.61b356ed.js"));class bn extends qo{constructor(){super(...arguments),this.output=J.Color,this.doubleSidedMode=Nr.None,this.transparencyPassType=gt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([G({count:J.COUNT})],bn.prototype,"output",void 0),u([G({count:Nr.COUNT})],bn.prototype,"doubleSidedMode",void 0),u([G({count:gt.COUNT})],bn.prototype,"transparencyPassType",void 0),u([G()],bn.prototype,"spherical",void 0),u([G()],bn.prototype,"receiveShadows",void 0),u([G()],bn.prototype,"receiveAmbientOcclusion",void 0),u([G()],bn.prototype,"vvSize",void 0),u([G()],bn.prototype,"vvColor",void 0),u([G()],bn.prototype,"vvOpacity",void 0),u([G()],bn.prototype,"hasSlicePlane",void 0),u([G()],bn.prototype,"transparent",void 0),u([G()],bn.prototype,"hasOccludees",void 0),u([G()],bn.prototype,"hasMultipassTerrain",void 0),u([G()],bn.prototype,"cullAboveGround",void 0),u([G()],bn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([G({constValue:Rt.Disabled})],bn.prototype,"pbrMode",void 0),u([G({constValue:!0})],bn.prototype,"hasVvInstancing",void 0),u([G({constValue:!1})],bn.prototype,"useCustomDTRExponentForWater",void 0),u([G({constValue:!1})],bn.prototype,"useFillLights",void 0);class SZ extends Qf{constructor(t){super(t,new lot),this.supportsEdges=!0,this._vertexAttributeLocations=Fxe,this._configuration=new bn,this.vertexBufferLayout=SZ.getVertexBufferLayout(this.parameters)}getConfiguration(t,i){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==J.Color&&t!==J.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Nr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Nr.WindingOrder:Nr.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==Ge.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,i,r,s,n,o,a){const l=t;if(!$xe(l))return;const c=l.path,h=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,S=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,C=c.sizeAttributeValue;h[0]*=De(b[0]+C*S[0],T[0],E[0]),h[1]*=De(b[2]+C*S[2],T[2],E[2])}const p=Math.max(h[0],h[1]),f=t.boundingInfo;if(A(f))return void this._intersectTriangles(c,h,n,o,a);const m=Vb(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),y=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],v=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),w=[v/y[0],v/y[1],v/y[2]];HY(m,n,w,s.tolerance)&&this._intersectTriangles(c,h,n,o,a)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=r.get(R.POSITION);return yY(s,null,!1,i)}createBufferWriter(){return new cot(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?Se.TRANSPARENT_MATERIAL:Se.OPAQUE_MATERIAL)||t===Se.DRAPED_MATERIAL}createGLMaterial(t){return t.output===J.Color||t.output===J.Alpha||t.output===J.Depth||t.output===J.Normal||t.output===J.Highlight||t.output===J.Shadow&&this.parameters.castShadows?new aot(t):null}static getVertexBufferLayout(t){let i=es().vec3f(R.POSITION).vec4f(R.PROFILERIGHT).vec4f(R.PROFILEUP).vec4f(R.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(i=i.vec4f(R.FEATUREVALUE)),i}}class aot extends Qv{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(A(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==J.Color&&this._output!==J.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(MU,t)}}class lot extends oot{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class cot{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(R.POSITION).length}write(t,i,r,s){const n=o=>{if(i.vertexAttributes.has(o)){const a=i.vertexAttributes.get(o),l=i.indices.get(o);dt(a.size===4);const c=r.getField(o,In);if(!c)throw new Error("unable to acquire view for "+o);D2(l,a.data,c,s)}};n(R.PROFILERIGHT),n(R.PROFILEUP),n(R.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(R.FEATUREVALUE)&&n(R.FEATUREVALUE),J5(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const uot=["polyline"];class hot extends Kf{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=Ii(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=_(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=_(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=lM(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=hM.circle(got);break;case"quad":this._profile=hM.rect()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new vB(0,mot);break;case"bevel":this._extruder=new vB(0,1);break;case"miter":this._extruder=new vB(.8*Math.PI,1);break;default:this._extruder=new Xnt}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new Wne,this._endCap=new Wne;break;case"butt":default:this._startCap=new BI(this._profile,0),this._endCap=new BI(this._profile,0,!0);break;case"square":this._startCap=new BI(this._profile,-.5),this._endCap=new BI(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new Xne({profile:this._profile,flip:!1,breakNormals:m,subdivisions:Jne}),this._endCap=new Xne({profile:this._profile,flip:!0,breakNormals:m,subdivisions:Jne});break}}const a=Tr(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=il(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?ar.None:ar.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(pi(this._intrinsicSize,t,i),!RF(this._intrinsicSize[0])||!RF(this._intrinsicSize[1])))throw new H("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Jl(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m=ve(F(F({},f),this._fastUpdates.materialParameters),{size:Jpe(this._intrinsicSize)});this._material=new SZ(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new fw(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,uot,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Cu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=Tr(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:i,transparent:r}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,zv)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!cM(this._fastUpdates,i,this._vvConvertOptions))return Qs.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Qs.Fast_Update}getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const m of r)i+=m.length;const l=new Float64Array(3*i),c=new Float64Array(3*i),h=new Float64Array(3*i);let p=0;for(const m of r){s.push({index:p,numVertices:m.length});for(const y of m)l[p++]=y[0],l[p++]=y[1],l[p++]=t.hasZ?y[2]:0}let f=!0;return n.equals(o)?this._copyVertices(l,0,c,0,i):f=lr(l,n,0,c,o,0,i),o.equals(a)?this._copyVertices(c,0,h,0,i):lr(c,o,0,h,a,0,i),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:h,projectionSuccess:f,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=Ls(),p=this._context.renderCoordsHelper;kxe.spatialReference=c;const f=this.getVertexData(n);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let m=0;m<f.pathVertexDataInfos.length;++m){const y=f.pathVertexDataInfos[m],v=y.index,w=y.numVertices;if(w<2||_(this._context.clippingExtent)&&(ur(h),cu(h,f.vertexDataES,3*v,w),!Bd(h,this._context.clippingExtent)))continue;const b=[];for(let N=v;N<v+3*w;){const D=N++,z=N++,B=N++,k=new Hnt;te(k.posGS,f.vertexDataGS[D],f.vertexDataGS[z],f.vertexDataGS[B]),te(k.posES,f.vertexDataES[D],f.vertexDataES[z],f.vertexDataES[B]);const Y=sKe(k.posES,this._context.elevationProvider,r,p);te(bh,f.vertexDataRS[D],f.vertexDataRS[z],f.vertexDataRS[B]),p.setAltitude(bh,Y),te(k.pos,bh[0],bh[1],bh[2]),b.push(k)}const S=new qnt(b);Uxe(S,this.upVectorAlignment,this._context.renderCoordsHelper);const T=new Znt(S,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const N=this._fastUpdates.visualVariables,D=N.size?bg(N.size.field,t):0,z=N.color?bg(N.color.field,t):0,B=N.opacity?bg(N.opacity.field,t):0;E=new Qnt(T,D,z,B)}else{const N=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(N[0]*=Zne(i.size[0],i.size[2]==="symbol-value"?this.symbolLayer.height||0:i.size[2],this.symbolLayer.width||0),N[1]*=Zne(i.size[2],i.size[0]==="symbol-value"?this.symbolLayer.width||0:i.size[0],this.symbolLayer.height||0));let D=null;this._drivenProperties.color&&(D=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(D=D?[D[0],D[1],D[2],i.opacity]:[1,1,1,i.opacity]);const z=new Nxe(T);z.bake(N),D&&z.bakeVertexColors(D),E=z}const{vertexAttributes:C,indices:O}=E.createGeometryData(),I=new knt(C,O,E,c,this.upVectorAlignment,this.stencilWidth);o.push(I),a.push(this._material),l.push(E.xform)}if(o.length>0){const m={layerUid:this._context.layer.uid,graphicUid:s},y=new iy({geometries:o,materials:a,transformations:l,metadata:m}),v=new Jf(this,y,o,null,null,pot,r);return v.alignedSampledElevation=f.terrainElevation,v.needsElevationUpdates=zv(r.mode),v}}else n.paths.length!==0&&n.paths.some(m=>m.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function Uxe(e,t,i){switch(t){case"world":for(const r of e.vertices)de(Ap,r.pos,e.offset),i.worldUpAtPosition(Ap,bh),r.setFrameFromUpVector(bh),r.computeRotationAxisAndAngleFromUpVector();break;case"path":de(Ap,e.vertices[0].pos,e.offset),i.worldUpAtPosition(Ap,bh),Wnt(e,bh);for(const r of e.vertices){const s=Math.sign(xe(r.frame.right,r.vRight));lt(r.rotationFrame.up,r.vRight,r.vLeft),oe(r.rotationFrame.up,r.rotationFrame.up,s),we(r.rotationFrame.up,r.rotationFrame.up);const n=xe(r.rotationFrame.up,r.frame.up),o=xe(r.rotationFrame.up,r.frame.right);if(oe(Ap,r.frame.up,-o),oe(Qne,r.frame.right,n),de(Ap,Ap,Qne),we(r.rotationFrame.right,Ap),jnt(r.rotationRight,r.frame,r.rotationFrame.right),Wo(Ap,r.vLeft),r.rotationAngle=-s*(Math.PI-rn(xe(Ap,r.vRight))),Math.abs(r.rotationAngle)>0){const l=G8(Math.cos(.5*r.rotationAngle));wZ(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(Math.min(r.vLeftLength,r.vRightLength)*G8(Math.cos(.5*a)))}}}function Zne(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function dot(e,t,i,r){let s=0;for(const n of e.vertices)Bg(n.posES,i,t,r,bB),s+=bB.sampledElevation,de(bh,n.pos,e.offset),r.setAltitude(bh,bB.z),pe(n.pos,bh,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function pot(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;fot.spatialReference=r.spatialReference;for(const a of n){const l=a.geometry;if(!$xe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;kxe.spatialReference=p,o+=dot(h,t,i,r),l.upVectorAlignment!=="world"&&Uxe(h,l.upVectorAlignment,r),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const fot=ty(0,0,0,null),kxe=ty(0,0,0,null),bh=M(),Ap=Si(),Qne=Si(),bB=new u3,mot=3,Jne=3,got=10;function yot(e,t,i,r,s=1){if(i.isGeographic&&r===Ve.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=wi(i);for(let h=0;h<l;h+=3)aW(t.typedBuffer,h,a,h,c);t=_s.fromTypedArray(a)}pi(js,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,Zl),js[0]=Math.min(js[0],Zl[0]),js[1]=Math.min(js[1],Zl[1]);const n=js[0]%s,o=js[1]%s;fh[0]=js[0]-n,fh[1]=js[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,Zl),e.setValues(a,(Zl[0]-fh[0])/s,(Zl[1]-fh[1])/s,fh[0]/s,fh[1]/s)}function zxe(e,t,i,r,s=1){te(P_,1,0,0),te(I_,0,1,0),te(xx,0,0,1),bot(wB,t),vot(t,Kne)&&_ot(Kne,P_,I_,xx,i,wB),pi(js,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),pi($_,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,Zl);const c=xe(P_,Zl),h=xe(I_,Zl);js[0]=Math.min(js[0],c),js[1]=Math.min(js[1],h),$_[0]=Math.max($_[0],c),$_[1]=Math.max($_[1],h)}const n=xe(xx,wB);TB(Ty,js[0],js[1],n,P_,I_,xx),TB(D_,$_[0],js[1],n,P_,I_,xx),TB(L_,js[0],$_[1],n,P_,I_,xx),pe(D_,D_,Ty),oe(D_,D_,.5),pe(L_,L_,Ty),oe(L_,L_,.5),de(Ty,Ty,D_),de(Ty,Ty,L_);const o=js[0]%s,a=js[1]%s;fh[0]=js[0]-o,fh[1]=js[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,Zl),e.setValues(l,(xe(P_,Zl)-fh[0])/s,(xe(I_,Zl)-fh[1])/s,fh[0]/s,fh[1]/s);for(let c=0;c<3;c++)r.set(l,c,Ty[c]),r.set(l,c+3,D_[c]),r.set(l,c+6,L_[c])}}const wB=M(),Zl=M(),Kne=_i(),P_=M(),I_=M(),xx=M(),js=tt(),$_=tt(),fh=tt(),Ty=M(),D_=M(),L_=M();function vot(e,t){const i=e.count-1;return Sfe(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function _ot(e,t,i,r,s,n){_(s)?(s.basisMatrixAtPosition(n,Rp),te(GI,Rp[0],Rp[1],Rp[2]),te(jI,Rp[4],Rp[5],Rp[6]),te(xB,Rp[8],Rp[9],Rp[10])):(te(GI,1,0,0),te(jI,0,1,0),te(xB,0,0,1));const o=e;xe(o,xB)<0&&oe(o,o,-1),se(r,o);const a=xe(o,jI),l=xe(o,GI);Math.abs(a)<Math.abs(l)?(tb(t,GI,o,-l),we(t,t),lt(i,t,o),we(i,i),oe(i,i,-1)):(tb(i,jI,o,-a),we(i,i),lt(t,i,o),we(t,t))}const Rp=Ae(),GI=M(),jI=M(),xB=M();function bot(e,t){te(HI,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,Zl),de(HI,HI,Zl);oe(e,HI,1/(t.count-1))}const HI=M();function TB(e,t,i,r,s,n,o){te(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}function wot(e){const t=new Hi,i=e.output===J.Depth,r=e.hasMultipassTerrain&&(e.output===J.Color||e.output===J.Alpha);mu(t,e),t.include(To,{hasModelTransformation:!1,linearDepth:i}),t.include(Uw,e),t.attributes.add(R.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r&&t.varyings.add("depth","float");const{vertex:s,fragment:n}=t;return i&&(t.include(e_,e),s.uniforms.add(new fi("nearFar",(o,a)=>a.camera.nearFar)),t.varyings.add("linearDepth","float")),s.code.add(x`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(cs,e),r&&t.include(Su,e),n.include(Yf),n.uniforms.add(new ti("eColor",o=>o.color)),e.output===J.Highlight&&t.include(Kg),n.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${x.float(Eo)}) {
      discard;
    }

    ${e.output===J.Alpha?x`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===J.Color?x`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===J.Highlight?x`outputHighlight();`:""};
    ${e.output===J.Depth?x`outputDepth(linearDepth);`:""};
  }
  `),t}const xot=Object.freeze(Object.defineProperty({__proto__:null,build:wot},Symbol.toStringTag,{value:"Module"}));class PU extends cr{initializeProgram(t){const i=PU.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}_createPipeline(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:r.output!==J.Color&&r.output!==J.Alpha||!r.transparent?null:s?gu:ey(t),culling:P5(r.cullFace),depthTest:{func:Kv(t)},depthWrite:s||n?r.writeDepth&&wl:null,colorWrite:Kt,stencilWrite:r.hasOccludees?kf:null,stencilTest:r.hasOccludees?i?Vv:t_:null,polygonOffset:s||n?r.polygonOffset&&Tot:rU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}PU.shader=new Ki(xot,()=>import("./ColorMaterial.glsl.faecddd7.js"));const Tot={factor:1,units:1};class Nc extends qo{constructor(){super(...arguments),this.output=J.Color,this.cullFace=ar.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=gt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([G({count:J.COUNT})],Nc.prototype,"output",void 0),u([G({count:ar.COUNT})],Nc.prototype,"cullFace",void 0),u([G()],Nc.prototype,"hasSlicePlane",void 0),u([G()],Nc.prototype,"hasVertexColors",void 0),u([G()],Nc.prototype,"transparent",void 0),u([G()],Nc.prototype,"polygonOffset",void 0),u([G()],Nc.prototype,"enableOffset",void 0),u([G()],Nc.prototype,"writeDepth",void 0),u([G()],Nc.prototype,"hasOccludees",void 0),u([G({count:gt.COUNT})],Nc.prototype,"transparencyPassType",void 0),u([G()],Nc.prototype,"hasMultipassTerrain",void 0),u([G()],Nc.prototype,"cullAboveGround",void 0);class eoe extends Qf{constructor(t){super(t,new Eot),this.supportsEdges=!0,this._configuration=new Nc}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<tU,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(t,i,r,s,n,o,a){Z5(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Se.DRAPED_MATERIAL?!0:hw(i)===J.Highlight?t===Se.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Se.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===J.Color||t.output===J.Alpha||t.output===J.Highlight||t.output===J.Depth&&this.parameters.writeLinearDepth?new Sot(t):null}createBufferWriter(){return new vU(Owe)}}class Sot extends Qv{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==J.Color&&this._output!==J.Alpha||this._updateOccludeeState(t),this.ensureTechnique(PU,t)}}class Eot extends wE{constructor(){super(...arguments),this.color=bf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ar.None,this.hasOccludees=!1}}var Zn;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(Zn||(Zn={}));const zj=.70710678118,toe=zj,Cot=.08715574274;function Aot(e){const t=new Hi,i=e.hasMultipassTerrain&&(e.output===J.Color||e.output===J.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const r=e.output===J.Depth,{vertex:s,fragment:n}=t;mu(t,e),t.include(To,{hasModelTransformation:!1,linearDepth:r}),t.include(Uw,e),r&&(t.include(e_,e),s.uniforms.add(new fi("nearFar",(a,l)=>l.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?s.uniforms.add(new We("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(R.BOUNDINGRECT,"mat3"),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const o=e.style===Zn.ForwardDiagonal||e.style===Zn.BackwardDiagonal||e.style===Zn.DiagonalCross;return o&&s.code.add(x`
      const mat2 rotate45 = mat2(${x.float(zj)}, ${x.float(-toe)},
                                 ${x.float(toe)}, ${x.float(zj)});
    `),e.draped||(Ff(s,e),s.uniforms.add(new We("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),s.code.add(x`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),s.code.add(x`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),s.code.add(x`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${x.float(Cot)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),s.code.add(x`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${o?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${o?" * rotate45":""};

      ${e.draped?"":x`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${x.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),s.code.add(x`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${r?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(cs,e),n.include(Yf),e.draped&&n.uniforms.add(new We("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===J.Highlight&&t.include(Kg),i&&t.include(Su,e),e.output!==J.Highlight&&(n.code.add(x`
      const float lineWidth = ${x.float(e.lineWidth)};
      const float spacing = ${x.float(e.patternSpacing)};
      const float spacingINV = ${x.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||n.code.add(x`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new ti("uColor",a=>a.color)),n.code.add(x`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==J.Highlight?x`color.a *= ${Rot(e)};`:""}

      if (color.a < ${x.float(Eo)}) {
        discard;
      }

      ${e.output===J.Alpha?x`gl_FragColor = vec4(color.a);`:""}

      ${e.output===J.Color?x`gl_FragColor = color; ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===J.Highlight?x`outputHighlight();`:""}
      ${e.output===J.Depth?x`outputDepth(linearDepth);`:""};
    }
  `),t}function Rot(e){function t(i){return e.draped?x`coverage(vuv.${i}, texelSize)`:x`sample(vuv.${i})`}switch(e.style){case Zn.ForwardDiagonal:case Zn.Horizontal:return t("y");case Zn.BackwardDiagonal:case Zn.Vertical:return t("x");case Zn.DiagonalCross:case Zn.Cross:return x`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const Oot=Object.freeze(Object.defineProperty({__proto__:null,build:Aot},Symbol.toStringTag,{value:"Module"}));class IU extends cr{initializeProgram(t){const i=IU.shader.get().build(this.configuration);return new er(t.rctx,i,Bxe)}_setPipelineState(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:r.output===J.Color||r.output===J.Alpha?s?gu:ey(t):null,culling:P5(r.cullFace),depthTest:{func:Kv(t)},depthWrite:s?r.writeDepth&&wl:eU(t),colorWrite:Kt,stencilWrite:r.hasOccludees?kf:null,stencilTest:r.hasOccludees?i?Vv:t_:null,polygonOffset:s||n?r.polygonOffset&&Mot:rU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}IU.shader=new Ki(Oot,()=>import("./Pattern.glsl.24d9fdab.js"));const Mot={factor:1,units:1};class ma extends qo{constructor(){super(...arguments),this.output=J.Color,this.cullFace=ar.None,this.transparencyPassType=gt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([G({count:J.COUNT})],ma.prototype,"output",void 0),u([G({count:ar.COUNT})],ma.prototype,"cullFace",void 0),u([G({count:Zn.COUNT})],ma.prototype,"style",void 0),u([G({count:gt.COUNT})],ma.prototype,"transparencyPassType",void 0),u([G()],ma.prototype,"hasSlicePlane",void 0),u([G()],ma.prototype,"hasVertexColors",void 0),u([G()],ma.prototype,"polygonOffset",void 0),u([G()],ma.prototype,"writeDepth",void 0),u([G()],ma.prototype,"hasOccludees",void 0),u([G()],ma.prototype,"patternSpacing",void 0),u([G()],ma.prototype,"lineWidth",void 0),u([G()],ma.prototype,"enableOffset",void 0),u([G()],ma.prototype,"draped",void 0),u([G()],ma.prototype,"hasMultipassTerrain",void 0),u([G()],ma.prototype,"cullAboveGround",void 0);const Bxe=new Map([[R.POSITION,0],[R.COLOR,3],[R.UVMAPSPACE,4],[R.BOUNDINGRECT,5]]);class EZ extends Qf{constructor(t){super(t,new $ot),this.supportsEdges=!0,this._vertexAttributeLocations=Bxe,this.techniqueConfig=new ma}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<tU,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a){Z5(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Se.DRAPED_MATERIAL?!0:hw(i)===J.Highlight?t===Se.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Se.TRANSPARENT_MATERIAL:Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===J.Color||t.output===J.Alpha||t.output===J.Highlight||t.output===J.Depth&&this.parameters.writeLinearDepth?new Pot(t):null}createBufferWriter(){const t=es().vec3f(R.POSITION).vec4u8(R.COLOR).vec4f(R.UVMAPSPACE);return this.parameters.draped||t.mat3f(R.BOUNDINGRECT),new Iot(t)}}class Pot extends Qv{_updateParameters(t){return this.ensureTechnique(IU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==J.Color&&this._output!==J.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class Iot extends vU{write(t,i,r,s){for(const n of this.vertexBufferLayout.fieldNames){const o=i.vertexAttributes.get(n),a=i.indices.get(n);if(o&&a)switch(n){case R.POSITION:{dt(o.size===3);const l=r.getField(n,ji);l&&Q5(a,o.data,t.transformation,l,s);break}case R.COLOR:{dt(o.size===3||o.size===4);const l=r.getField(n,xl);l&&TF(a,o.data,o.size,l,s);break}case R.UVMAPSPACE:{dt(o.size===4);const l=r.getField(n,In);l&&D2(a,o.data,l,s);break}case R.BOUNDINGRECT:{dt(o.size===9);const l=r.getField(n,lp);l&&this.writeBoundingRect(a,o.data,t.transformation,l,s);break}}}}writeBoundingRect(t,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=i[p],m=i[p+1],y=i[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let v=3;v<9;++v)a[n+v]=i[p+v];n+=l}}}class $ot extends wE{constructor(){super(...arguments),this.color=gi(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ar.None,this.hasOccludees=!1,this.style=Zn.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Dot(e,t,i){return Not(Lot(e),t,i)}function Lot(e){return e&&e.pattern||null}function Not(e,t,i){return _(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=gi(0,0,0,0),t.transparent=!0),new eoe(t)):(t.style=Fot(e.style),t.draped=i.isDraped,new EZ(t)):new eoe(t)}function Fot(e){switch(e){case"horizontal":return Zn.Horizontal;case"vertical":return Zn.Vertical;case"cross":return Zn.Cross;case"forward-diagonal":return Zn.ForwardDiagonal;case"backward-diagonal":return Zn.BackwardDiagonal;case"diagonal-cross":return Zn.DiagonalCross;default:return}}function Uot(e){return e.material instanceof EZ&&!e.material.parameters.draped}function kot(e,t){if(Uot(e)){const i=e.geometry.vertexAttributes,r=i.get(R.POSITION).data,s=i.get(R.UVMAPSPACE).data,n=i.get(R.BOUNDINGRECT).data;zxe(In.fromTypedArray(s),_s.fromTypedArray(r),t,Pv.fromTypedArray(n))}}function zot(e,t,i,r){const s=Gbe(e,t,i,r),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)kot(n[o],r);return s}const Bot=["polyline","polygon","extent"];class $U extends Kf{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(_(this._material))return;const t=Tr(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=Dot(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof EZ,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(_(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=lxe(t.pattern);return new iS({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:Dj(t.patternCap||"butt")})};this._outlineMaterial=i(eo(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return _(t)&&t.size&&t.size>0&&_(t.color)&&(A(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Bot,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Cu);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(_(this._material)){const t=this._material.parameters.color,i=Tr(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(_(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=c3($U.elevationModeChangeTypes,r,s);if(n!==Gr.UPDATE)return n;const o=Nh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){if(_(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),_(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=oM(t.geometry);if(A(s))return null;nn.renderData=gZ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),nn.color=i;const n=nn.renderData.position.length/3;if(this._needsUV&&(nn.uvMapSpace=new Float32Array(4*n),nn.boundingRect=new Float64Array(9*n)),nn.outNum=0,nn.outGeometries=[],nn.outTransforms=[],nn.outMaterials=[],this._createAs3DShapeFill(nn),this._hasOutline&&this._createAs3DShapeOutline(nn),this._logGeometryCreationWarnings(nn.renderData,s.rings,"rings","FillSymbol3DLayer"),nn.outNum===0)return null;this._needsUV&&zxe(In.fromTypedArray(nn.uvMapSpace),_s.fromTypedArray(nn.renderData.position),this._context.renderCoordsHelper,Pv.fromTypedArray(nn.boundingRect));const o=new iy({geometries:nn.outGeometries,materials:nn.outMaterials,transformations:nn.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),a=new Jf(this,o,nn.outGeometries,null,null,zot,r);return a.alignedSampledElevation=nn.renderData.sampledElevation,a.needsElevationUpdates=Nh(r.mode),a}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPosition:s,holeIndices:n,index:o,count:a}of i){if(_(this._context.clippingExtent)&&(ur(sa),cu(sa,s),!Bd(sa,this._context.clippingExtent)))continue;const l=F2(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=cne({indices:c,attributeData:{position:r,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null}});t.outGeometries.push(h),t.outMaterials.push(this._material),t.outTransforms.push(en),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:s,position:n}=i[r];if(_(this._context.clippingExtent)&&(ur(sa),cu(sa,s),!Bd(sa,this._context.clippingExtent)))continue;const o=$j({overlayInfo:null,removeDuplicateStartEnd:mw.REMOVE,attributeData:{position:n,mapPosition:s}}),a=o.vertexAttributes.get(R.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(en),t.outNum++}}_createAsOverlay(t,i){const r=oM(t.geometry);if(A(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,_(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),uo.renderData=Fwe(r,this._context.overlaySR),uo.color=i;const s=uo.renderData.position.length/3;return this._needsUV&&(uo.uvMapSpace=new Float32Array(4*s)),uo.outNum=0,uo.outGeometries=[],uo.outBoundingBox=ur(),uo.layerUid=this._context.layer.uid,uo.graphicsUid=t.uid,this._createAsOverlayFill(uo),this._hasOutline&&this._createAsOverlayOutline(uo),this._logGeometryCreationWarnings(uo.renderData,r.rings,"rings","FillSymbol3DLayer"),uo.outNum===0?null:(this._needsUV&&yot(In.fromTypedArray(uo.uvMapSpace),_s.fromTypedArray(uo.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),uo.outNum>0?new wU(this,uo.outGeometries,uo.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){if(ur(sa),cu(sa,r),!Bd(sa,this._context.clippingExtent))continue;const a=F2(r,s,3);if(a.length===0)continue;WS(t.outBoundingBox,sa);const l=new Uint32Array(a),c=cne({indices:l,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),h=new B2(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),p=sa;Xi(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),t.outGeometries.push(h),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(ur(sa),cu(sa,s),!Bd(sa,this._context.clippingExtent))continue;WS(t.outBoundingBox,sa);const n=$j({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:mw.REMOVE,attributeData:{position:s}}),o=new B2(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=sa;Xi(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o),t.outNum++}}_getOutlineOpacity(){const t=Tr(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(_(t)?t.a:0)}_getOutlineColor(){const t=Tr(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return FR(_(t)?qe.toUnitRGB(t):null,i)}test(){return ve(F({},super.test()),{createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)})}}$U.elevationModeChangeTypes={definedChanged:Gr.RECREATE,staysOnTheGround:Gr.NONE,onTheGroundChanged:Gr.RECREATE};const sa=Ls(),nn={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},uo={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Vot=fe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class DU{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i=1){const r=Tr(t,"material","color"),s=Kc(r,bf,qe.toUnitRGBA),n=Kc(t.size,12,eo),o=t.lineHeight,a=_(t.background)?qe.toUnitRGBA(t.background.color):bf,l={family:Kc(t.font,"sans-serif",m=>m.family),decoration:Kc(t.font,"none",m=>m.decoration),weight:Kc(t.font,"normal",m=>m.weight),style:Kc(t.font,"normal",m=>m.style)},c=t.halo,h=_(c)&&_(c.color)&&c.size>0?{size:eo(c.size),color:qe.toUnitRGBA(c.color)}:{size:0,color:bf},p=new DU({color:s,size:n,background:{color:a,padding:_(t.background)?[.65*n,.5*n]:[0,0],borderRadius:_(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(n);try{await document.fonts.load(f)}catch{Vot.warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class Got{constructor(t,i,r){this._renderer=new Kwe(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=hL(jot,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new Rs(t,{wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:mv.PAD})}}const jot={canvas:null},Hot=[0,0,1];class qot extends Kf{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=sU(this.symbolLayer.size);if(t)throw new H("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await DU.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=sM(i.geometry);if(A(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(A(s)||s==="")return null;const n=Uq(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(_(n)&&!nde(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=ve(F({},Yot),{verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:git(this.symbolLayer.verticalAlignment)});return this._createAs3DShape(i,r,s,o)}createLabel(t,i,r,s){const n=t.graphic,o=sM(n.geometry);if(A(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return ioe(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Gr.UPDATE}slicePlaneEnabledChanged(t,i){return ioe(t,i,r=>{for(const s of r.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=Nh(i.elevationContext.mode)||i.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Xot}_createAs3DShape(t,i,r,s,n,o){const a=this.setGraphicElevationContext(t,new Cu,s.elevationOffset),l=Tr(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(A(o)){const k=txe(s.horizontalPlacement);h=new Got(r,k,this._textRenderParameters);let Y=null;p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{_(Y)&&Y.release()});const Z=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(A(Z)||Eu(Z))return p.release(),null;Y=Z}const f=Wot(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(_(p)&&(m.textureId=p.texture.id),_(o)&&(m.textureId=o.id),_(s.verticalOffset)){const{screenLength:k,minWorldLength:Y,maxWorldLength:Z}=s.verticalOffset;m.verticalOffset={screenLength:eo(k),minWorldLength:Y||0,maxWorldLength:Z!=null?Z:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:k,screenSizePerspectiveSettingsLabels:Y}=this._context.sharedResources;m.screenSizePerspective=Y.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=k}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,_(n)){const k=JSON.stringify(m);y=n.get(k),A(y)&&(y=new L2(m),n.add(k,y))}else y=new L2(m);const v=[y],w=s.translation,b=_(h)?[h.displayWidth,h.displayHeight]:[0,0],S=s.centerOffset,T=Hot,E=[0,0],C=[jl.createPointGeometry(T,w,null,b,S,E,null)],O=this._context.layer.uid,I=lZ(this._context,i,C,v,a,O,c);if(I===null)return null;const N=new Jf(this,I.object,C,A(n)?v:null,p,iM,a);N.alignedSampledElevation=I.sampledElevation,N.needsElevationUpdates=Nh(a.mode)||a.mode==="absolute-height";const{displayWidth:D,displayHeight:z}=_(h)?h:s;N.getScreenSize=(k=tt())=>(k[0]=D,k[1]=z,k);const B={labelText:r,elevationOffset:s.elevationOffset};return N.metadata=B,rM(N,i,this._context.elevationProvider),N}}function ioe(e,t,i){e&&e.forEach(r=>{const s=t(r);_(s)&&i(s,r.graphic)})}function Wot(e,t){if(t.verticalPlacement==="baseline"){const r=pit[t.horizontalPlacement],s=_(e)?e.baselineAnchorY:0;return Ii(r,s)}const i=mit(t.horizontalPlacement,t.verticalPlacement);return dL[i]}const Xot={mode:"relative-to-ground",offset:0},Yot={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},Zot={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Qot=["polyline","polygon","extent"];class lf extends Kf{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Qot,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Cu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(_(this._material))return;const t=new Pwe,i=this.symbolLayer.color;_(i)&&(t.color=qe.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=_(this.symbolLayer.waveDirection)?lf.headingVectorFromAngle(this.symbolLayer.waveDirection):Ii(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=Zot[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new Mwe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(A(this._material))return!0;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=c3(lf.elevationModeChangeTypes,r,s);if(n!==Gr.UPDATE)return n;const o=Nh(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return _(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=oM(t.geometry);if(A(s))return null;Fo.renderData=gZ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);const n=Fo.renderData.position.length/3;if(Fo.uvCoords=new Float64Array(2*n),Fo.outNum=0,Fo.outGeometries=[],Fo.outTransforms=[],Fo.outMaterials=[],this._create3DShapeGeometries(Fo),this._logGeometryCreationWarnings(Fo.renderData,s.rings,"rings","WaterSymbol3DLayer"),Fo.outNum===0)return null;this._createUVCoordsFromVertices(Fo.uvCoords,Fo.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new iy({geometries:Fo.outGeometries,materials:Fo.outMaterials,transformations:Fo.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),a=new Jf(this,o,Fo.outGeometries,null,null,Gbe,i);return a.alignedSampledElevation=Fo.renderData.sampledElevation,a.needsElevationUpdates=Nh(i.mode),a}_createUVCoordsFromVertices(t,i,r,s){const n=gc(s);vu(Sy);for(let l=0;l<r;l++)pi(roe,i[3*l+0],i[3*l+1]),hS(Sy,roe);IM(Sy,Sy,n);const o=Sy[0]%lf.unitSizeOfTexture,a=Sy[1]%lf.unitSizeOfTexture;qI[0]=Sy[0]-o,qI[1]=Sy[1]-a;for(let l=0;l<r;l++)t[2*l+0]=(i[3*l+0]*n-qI[0])/lf.unitSizeOfTexture,t[2*l+1]=(i[3*l+1]*n-qI[1])/lf.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of i){if(_(this._context.clippingExtent)&&(ur(Ey),cu(Ey,a),!Bd(Ey,this._context.clippingExtent)))continue;const c=F2(a,l,3);if(c.length===0)continue;const h=new Uint32Array(c),p=new Float64Array(r.buffer,2*n*r.BYTES_PER_ELEMENT,2*s),f=une({indices:h,attributeData:{position:o,uv0:p,mapPosition:a}});t.outGeometries.push(f),t.outMaterials.push(this._material),t.outTransforms.push(en),t.outNum++}}_createAsOverlay(t){const i=oM(t.geometry);if(A(i))return null;this._material.renderPriority=this._renderPriority,na.renderData=Fwe(i,this._context.overlaySR);const r=na.renderData.position.length/3;return na.uvCoords=new Float64Array(2*r),na.outNum=0,na.outGeometries=[],na.outBoundingBox=ur(),na.layerUid=this._context.layer.uid,na.graphicsUid=t.uid,this._createAsOverlayWater(na),this._logGeometryCreationWarnings(na.renderData,i.rings,"rings","WaterSymbol3DLayer"),na.outNum===0?null:(this._createUVCoordsFromVertices(na.uvCoords,na.renderData.position,r,this._context.overlaySR),na.outNum>0?new wU(this,na.outGeometries,na.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(ur(Ey),cu(Ey,s),!Bd(Ey,this._context.clippingExtent))continue;WS(t.outBoundingBox,Ey);const l=F2(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=new Float64Array(i.buffer,2*o*i.BYTES_PER_ELEMENT,2*a),p=une({indices:c,attributeData:{position:s,uv0:h}}),f=new B2(p,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),m=Ey;Xi(f.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),t.outGeometries.push(f),t.outNum++}}static headingVectorFromAngle(t){const i=tt(),r=y4(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return ve(F({},super.test()),{create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()})}}lf.unitSizeOfTexture=100,lf.elevationModeChangeTypes={definedChanged:Gr.RECREATE,staysOnTheGround:Gr.NONE,onTheGroundChanged:Gr.RECREATE};const qI=tt(),Sy=Dt(),roe=tt(),Ey=Ls(),Fo={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},na={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Jot=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function Kot(e,t,i,r){const s=soe[e.type]&&soe[e.type][t.type]||eat[t.type];return s?new s(e,t,i,r):(Jot.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const eat={icon:uM,object:vnt,line:SU,path:hot,fill:$U,extrude:eit,text:qot,water:lf},soe={"mesh-3d":{fill:Qrt}};class tat extends sZ{constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let i=0;i<t.symbolLayers.length;i++){const r=this.symbolLayers[i];A(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[i])}}get symbol(){return this._symbol}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;WI.renderPriority=1-(1+n)/r,WI.renderPriorityStep=1/r,WI.ignoreDrivers=o._ignoreDrivers;const a=Kot(this.symbol,o,this._context,WI);s.push(VH(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await n5(this.symbolLayers,async(n,o)=>{if(_(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,hi(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return _(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=_(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new YKe(r,i||this,s,t.layer,n)}get complexity(){return aZ(this.symbolLayers.map(t=>Tr(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof Jf?l:null};if(_(n)&&!n.globalPropertyChanged(t,i,o))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==Jc.LOADED?Qs.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==Qs.Recreate_Symbol&&_(s)?Math.min(r,s.applyRendererDiff(t,i)):r,Qs.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===Jc.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(A(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.graphics[n];_(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(A(s))continue;const n=t.graphics[r];if(A(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(A(r))continue;const s=t.graphics[i];_(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{A(s)||(s.loadStatus===Jc.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)_(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const WI={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class iat extends sZ{constructor(t,i,r){super(i),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this.convert(i),_(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:oZ}globalPropertyChanged(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return _(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):Qs.Recreate_Symbol}prepareSymbolPatch(t){_(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){_(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function CZ(e){return e instanceof iat?e.graphics3DSymbol:e instanceof tat?e:null}const dM=fe.getLogger("esri.views.3d.layers.graphics.labelPlacement");function rat(e){const t=dat(e);if(A(t))return null;const i=sat(e,t);if(A(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return oat({anchor:r,verticalOffset:t.verticalOffset,screenOffset:tt(),centerOffset:gi(0,0,0,-1),centerOffsetUnits:"world",translation:M(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function sat(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=Wd[i],s=r||zF(e);return i&&!r&&dM.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),nat(s,e)}function AZ(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=CZ(t);return _(i)?i.symbol.symbolLayers.getItemAt(0):null}function nat(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(A(i))return null;if(_(t.disablePlacement))return t.labelClass.labelPlacement?(dM.warnOncePerTick(noe(e.placement,t.disablePlacement.logEntityDescription)),zF(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return dM.warnOncePerTick(noe(e.placement,`'${r}' geometries`)),zF(t);break;case"point":case"mesh":return e}return e}function noe(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function zF(e){const t=e.graphics3DGraphic.graphic.geometry;if(A(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=AZ(e);return _(i)&&i.type==="extrude"?Wd["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Wd["above-center"];default:return}}function oat(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(A(r))return null;switch(r.type){case"point":lat(e,t,i);break;case"polygon":aat(e,t,i);break;case"mesh":RZ(e,t,i.graphics3DGraphic.graphics[0])}return e}function aat(e,t,i){const r=AZ(i);if(!A(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.graphics[0];_(s)?(s.getBoundingBoxObjectSpace(jR),zd(jR,e.translation),e.translation[2]=Hv(jR)/2):te(e.translation,0,0,0),RZ(e,t,s);break}}}function lat(e,t,i){const r=AZ(i);if(A(r))return;const s=i.graphics3DGraphic.graphics[0];switch(_(s)?s.getCenterObjectSpace(e.translation):te(e.translation,0,0,0),r.type){case"icon":case"text":cat(e,t,i,s);break;case"object":RZ(e,t,s)}}function cat(e,t,i,r){const{graphics3DGraphic:s}=i,n=_(r)?r.getScreenSize():null;if(!s.isDraped&&_(n)){const o=uat(i);_C[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),_C[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=_C[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=_C[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=_C[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(Wd[i.labelClass.labelPlacement]&&dM.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function uat(e,t=pat){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=_(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof L2){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function RZ(e,t,i){const r=_(i)?i.getBoundingBoxObjectSpace(jR):jR,s=Ue(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Oe(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function hat(e){return e==="above-center"}function dat(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=CZ(r.graphics3DSymbol),n=qs(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Wd[t]||zF(e);return _(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:ooe(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(A(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?hat(o.placement)?{placement:"above-center",verticalOffset:ooe(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(dM.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function ooe(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const Wd={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},aoe={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in aoe){const t=aoe[e],i=Wd[e];t.forEach(r=>{Wd[r]=i})}Object.freeze&&(Object.freeze(Wd),Object.keys(Wd).forEach(e=>{Object.freeze(Wd[e]),Object.freeze(Wd[e].normalizedOffset)}));const _C=[0,0],pat=[0,0],jR=Ls();class loe{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const SB=512,EB=4096,fat=.85,mat=.95;let HA=class extends Ee{constructor(e){super(e),this.type=cp.Texture,this.id=hl(),this.events=new Kr,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Xe(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,flipped:!0,samplingMode:Je.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return _(this._glTexture)||(this._glTexture=new st(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(yt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=Js(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=Xe(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",SB.toString()),e.setAttribute("height",SB.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=SB){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=GS(i),i=Math.min(i,EB),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,_(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=bC,e.cursor.y=bC+coe,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(R.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+bC,a=n+bC+coe;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const l=this._getExpectedAtlasUsage(),c=l>fat&&i.size.width<EB;return c&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!c&&l>mat&&i.size.width===EB?(this._processRemovals(),rS.OK):(this._repack(),rS.REPACK)}i.cursor.x=bC,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return rS.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(R.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(R.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],i.geometryVertexAttrsUpdated(i.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(Ws(this.elementsToAddOrUpdate,(s,n)=>{const o=this.elements.get(n);if(o&&o.rendered){const a=this.stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this.elements.get(n);c.get(R.UV0).data=new Float32Array(h.placement.uvMinMax),c.get(R.SIZE).data=new Float32Array([h.placement.size.displayWidth,h.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===rS.REPACK&&(i=!0,!0)}),i)return void this.runTask(fE,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),Ws(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&_(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&get.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this.elements.clear();for(const{element:i,key:r}of e)this.elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([d({constructOnly:!0})],HA.prototype,"view",void 0),u([d({type:Boolean})],HA.prototype,"updating",void 0),HA=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],HA);const bC=2,coe=2;var rS;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(rS||(rS={}));const uoe=fe.getLogger("esri.views.3d.layers.graphics.Labeler");let A1=class extends Ee{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ht,this._handles.add([ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(yt.LABELER,this)]),this._textTextureAtlas=new HA({view:this.view}),this._hudMaterialCollection=new loe(this.view._stage),this._calloutMaterialCollection=new loe(this.view._stage)}dispose(){this._handles=at(this._handles),this._textTextureAtlas=Xe(this._textTextureAtlas),this._hudMaterialCollection=Xe(this._hudMaterialCollection),this._calloutMaterialCollection=Xe(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,i)=>{this._labels.set(i,t),t.graphics3DGraphic.setVisibilityFlag(nu.USER_SETTING,!0,Yn.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,i)=>{t.graphics3DGraphic.setVisibilityFlag(nu.USER_SETTING,!1,Yn.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(gat(t)){if(!hoe(t)){if(yat(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),CB(t)){this._dirty=!0;continue}if(!hoe(t))continue}Ws(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),hi(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await n5(s,async(a,l)=>{const c=a.symbol,h=CZ(i.getOrCreateGraphics3DSymbol(c));if(A(h))return void uoe.error("Failed to create Graphics3DSymbol for label");await h.load(),hi(t);let p=null;Uq(c)&&c.hasVisibleCallout()&&(p=HKe(c,i.symbolCreationContext),await p.load(),hi(t));const f=await xu(kbe(a,e.layer.fieldsIndex,this.view.spatialReference));if(hi(t),f.ok===!0){const m=await this._createTextRenderParameters(h.symbol);hi(t),n[l]={labelClass:a,labelFunction:f.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:m}}else uoe.error(`Label expression failed to evaluate: ${f.error}`),o=!0}),hi(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(jr(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?DU.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:xne(i.anchor),verticalPlacement:fit(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:Gi.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return Cy.graphic=t,Cy.renderingInfo=null,Cy.layer=r,s.createLabel(Cy,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return Cy.graphic=e,Cy.renderingInfo=n,Cy.layer=s,i.createGraphics3DGraphic(Cy)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=r.layer,l=K9(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=i.textRenderers[h],f=i.labelPlacements[h];if(A(p)||A(f))continue;const m=s[h],y=m.graphics3DSymbol,v=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,w=y.symbolLayers[0];if(!w)continue;w.setElevationInfoOverride(r.elevationInfoOverride);const b=this._createTextSymbolGraphic(p,o,f,a,w);if(!b)return!1;b._labelClass=m.labelClass,b._labelIndex=h,t.addLabelGraphic(b,c,r.stageLayer),t.setVisibilityFlag(nu.USER_SETTING,l,Yn.LABEL),t.clearVisibilityFlag(nu.SCALE_RANGE,Yn.LABEL),t.setVisibilityFlag(nu.DECONFLICTION,!1,Yn.LABEL),n=!0;const S=m.graphics3DCalloutSymbolLayer;if(S&&f.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,v,S,f,a);_(T)&&(m.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(T,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?YJe(s,i.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(A(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=i.disablePlacement,y=rat({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(A(y))continue;const v=xne(y.anchor),w=txe(v);t.textRenderers[n]=new Kwe(l,w,o.textRenderParameters),t.labelPlacements[n]=y}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.labels.get(i);r&&(this._removeGraphic(e,r.graphics3DGraphic),this._addGraphic(e,r.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;r.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new cwe({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>K9(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>CB(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(CB(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function gat(e){return e.active&&K9(e.layer)}function CB(e){return e.labelClassPromise&&!!e.labelClassAbortController}function hoe(e){return e.labelClassContexts&&e.labelClassContexts.length}function yat(e){return e.labelClassContexts===null}u([d({constructOnly:!0})],A1.prototype,"view",void 0),u([d({constructOnly:!0})],A1.prototype,"deconflictor",void 0),u([d()],A1.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],A1.prototype,"updating",null),A1=u([P("esri.views.3d.layers.graphics.Labeler")],A1);const Cy=new WKe(null,null,null);class vat{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new Ht}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>Exe(new Txe(n.streamDataRequester),t,n,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`;return this._fromCache(this.wosrCache,r,s=>Cxe(t,s),i)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,i,r,s){return new Promise((n,o)=>{if(Xs(s))return void o(di());const a=Yo(s,()=>{this._remove(t,i),o(di())}),l=t.get(i);if(l)return this.evictHandles.remove(i),l.refCount++,void l.item.then(n,o);const c=new AbortController,h=ve(F({},s),{signal:c.signal}),p={refCount:1,abortController:c,item:r(h).then(f=>(p.abortController=null,f.remove=()=>this._remove(t,i),f))};t.set(i,p),p.item.then(f=>{_(a)&&a.remove(),n(f)},f=>{_(a)&&a.remove(),o(f)})})}_remove(t,i){const r=t.get(i);r&&(r.refCount--,r.refCount===0&&this.evictHandles.add(pEe(()=>{t.delete(i),_(r.abortController)&&r.abortController.abort()},bat),i))}}const _at=1e4;let bat=_at;class Fd{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=Dt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Bo.VISIBLE_ON_SURFACE,screenRect:Dt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=Fd.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new Fd(i,r,s,this.tilingScheme),new Fd(i,r+1,s,this.tilingScheme),new Fd(i,r,s+1,this.tilingScheme),new Fd(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,Mg(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var Bo;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Bo||(Bo={}));class U0{constructor(t){this.renderCoordsHelper=t,this.frustum=ZO(),this._points=H_e(),this.lines=new Array(12),this._origin=M(),this._direction=M(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:M(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){q_e(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),se(this._origin,t.eye),se(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)se(this._points[i],t[i]);W_e(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return rv(this.frustum,t)}intersectsRay(t){return CXe(this.frustum,t)}intersectsLineSegment(t,i){return AXe(this.frustum,t,i)}intersectsPoint(t){return X_e(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;AB(this.lines[i],t[i],t[r]),AB(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),AB(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function AB(e,t,i){e.origin=t,e.endpoint=i,Vg(e.direction,t,i)}U0.planePointIndices=OXe,U0.nearFarLineIndices=[[Qe.NEAR_BOTTOM_LEFT,Qe.FAR_BOTTOM_LEFT],[Qe.NEAR_BOTTOM_RIGHT,Qe.FAR_BOTTOM_RIGHT],[Qe.NEAR_TOP_RIGHT,Qe.FAR_TOP_RIGHT],[Qe.NEAR_TOP_LEFT,Qe.FAR_TOP_LEFT]];const Vxe=.5*Math.PI,wat=Vxe/Math.PI*180;class xat{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:M(),direction:M()};for(let i=0;i<4;i++)this.extent[i]={origin:M(),direction:M(),cap:{next:null,direction:M()}},this.planes[i]=_i();this.planes[rr.NEAR]=_i(),this.planes[rr.FAR]=_i(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,i,r,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,i,r),de(this.center.origin,n[0].origin,n[2].origin),oe(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||oe(this.center.direction,this.center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this.renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,Vg(a.cap.direction,a.origin,l.origin),gO(a.direction,a.cap.direction,a.origin,this.planes[o]),s||oe(a.direction,a.direction,-1)}gO(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[rr.NEAR]),s?Z9(this.planes[rr.NEAR],this.planes[rr.FAR]):(Y4(this.planes[rr.FAR],this.planes[rr.NEAR]),Z9(this.planes[rr.NEAR],this.planes[rr.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=i,this.minGlobalAltitude=.9*wi(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===Ve.Global){const n=this.maxSpanSpatialReference.isGeographic?wat:Vxe*i;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(r||!t.intersectsRay(wu(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const o=this.extent[n];if(!r&&t.intersectsRay(wu(o.origin,o.direction))||t.intersectsLineSegment(Cb(o.origin,o.cap.next,Sat),o.cap.direction))return!0}const s=r?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(rWe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){yq(t,Qh),Qh[2]=r,bu(i,Qh,RB,this.renderCoordsHelper.spatialReference),us(doe,RB),ur(Rl);for(const{x0:n,x1:o,y0:a,y1:l}of Tat)for(let c=0;c<5;c++){const h=c/4;Qh[0]=qt(t[n],t[o],h),Qh[1]=qt(t[a],t[l],h),Qh[2]=r,Ks(Qh,i,Qh,this.renderCoordsHelper.spatialReference),ke(Qh,Qh,doe),Rf(Rl,Qh)}te(this.extent[0].origin,Rl[0],Rl[1],Rl[2]),te(this.extent[1].origin,Rl[3],Rl[1],Rl[2]),te(this.extent[2].origin,Rl[3],Rl[4],Rl[2]),te(this.extent[3].origin,Rl[0],Rl[4],Rl[2]);for(let n=0;n<4;++n)ke(this.extent[n].origin,this.extent[n].origin,RB)}_toRenderBoundingExtentLocal(t,i,r){j4(t,i,um,this.renderCoordsHelper.spatialReference),te(this.extent[0].origin,um[0],um[1],r),te(this.extent[1].origin,um[2],um[1],r),te(this.extent[2].origin,um[2],um[3],r),te(this.extent[3].origin,um[0],um[3],r)}_toRenderBoundingExtent(t,i,r){switch(this.renderCoordsHelper.viewingMode){case Ve.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case Ve.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(sr(t.planes[rr.NEAR],this.center.origin)<0&&xe(this.center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this.extent[i];if(sr(t.planes[rr.NEAR],r.origin)<0&&xe(r.direction,t.direction)<0)return!0}return!1}}const Tat=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Qh=M(),RB=Ae(),doe=Ae(),Rl=Ls(),um=Dt(),Sat=Hf();class Eat{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new U0(t),this.extendedFrustum=new U0(t),this.intersector=new xat({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,i){this.surfaceElevation=i,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>i,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return Bo.INVISIBLE;const i=this.renderCoordsHelper.viewingMode===Ve.Global&&t.lij[0]>=Cat&&t.lij[0]<Aat,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==Bo.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=U0.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];pe(Ec,l,a),oe(Ec,Ec,Oat),de(r[o],a,Ec)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=Bo.INVISIBLE;const r=this.cache.get(t.id);if(r!=null)return r;const s=goe.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Bo.INVISIBLE&&(i=o,o===Bo.VISIBLE_ON_SURFACE))break}return goe.release(s),this.cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this.cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===Ve.Global&&t.lij[0]<Rat?this._calculateSingleTileVisibilitySided(t,!1)===Bo.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,i){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,i);const r=wi(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?Bo.VISIBLE_ON_SURFACE:Bo.VISIBLE_WHEN_EXTENDED:Bo.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,Ec);this.aboveGround||Wo(i,i);const r=rn(-xe(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this.renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,Ec),a){case Qe.FAR_BOTTOM_LEFT:case Qe.FAR_TOP_LEFT:case Qe.NEAR_BOTTOM_LEFT:case Qe.NEAR_TOP_LEFT:Q9(this.extendedFrustum.planes[rr.LEFT],Ec,Ec);break;case Qe.FAR_BOTTOM_RIGHT:case Qe.FAR_TOP_RIGHT:case Qe.NEAR_BOTTOM_RIGHT:case Qe.NEAR_TOP_RIGHT:Q9(this.extendedFrustum.planes[rr.RIGHT],Ec,Ec)}oe(Ec,Ec,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(wu(l,Ec),s.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(n),Go(n[Qe.NEAR_BOTTOM_LEFT],n[Qe.NEAR_BOTTOM_RIGHT],n[Qe.NEAR_TOP_RIGHT],foe),Go(n[Qe.NEAR_BOTTOM_RIGHT],n[Qe.NEAR_TOP_RIGHT],n[Qe.NEAR_TOP_LEFT],moe),xe(foe,moe)<0){const o=this.extendedFrustum.mutablePoints;this.aboveGround?[o[Qe.NEAR_BOTTOM_LEFT],o[Qe.NEAR_BOTTOM_RIGHT]]=[o[Qe.NEAR_BOTTOM_RIGHT],o[Qe.NEAR_BOTTOM_LEFT]]:[o[Qe.NEAR_TOP_LEFT],o[Qe.NEAR_TOP_RIGHT]]=[o[Qe.NEAR_TOP_RIGHT],o[Qe.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-poe;return{zWithMargin:t,pointIndices:U0.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+poe;return{zWithMargin:t,pointIndices:U0.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const Cat=2,Aat=6,Rat=12,Oat=.95,poe=1,Ec=M(),foe=_i(),moe=_i(),goe=new vs(Array,e=>{e.length!==4&&(e[0]=new Fd,e[1]=new Fd,e[2]=new Fd,e[3]=new Fd)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class Mat{constructor(t){this.camera=new Qi,this.focusOnMap=[0,0],this.screenRect=Dt(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new Eat(t.renderCoordsHelper)}begin(t,i,r){this.camera.copyFrom(t),this.surfaceElevation=r,this.focusOnMap[0]=i.x,this.focusOnMap[1]=i.y,gq(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=aOe(t.extent,this.focusOnMap),t.measures.visibility!==Bo.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=Pat,r=1<<i,s=t.measures.screenRect;vu(s);let n=0;const o=t.lij[0]+i,a=t.lij[1]<<i,l=t.lij[2]<<i,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===Bo.VISIBLE_WHEN_EXTENDED?this.tileSize*Iat:this.tileSize}_computeScreenArea(t,i,r,s,n){const o=t.measures.visibility===Bo.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,Ay),vu(OB);for(let a=0;a<4;a++)hS(OB,Ay[a]);return bb(n,OB,n),Yie(Ay[0],Ay[1],Ay[2])+Yie(Ay[0],Ay[2],Ay[3])}_projectToScreen(t,i,r,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,i,r,wC),this._toRenderCoords(wC,0,3,Ry[0]),this._toRenderCoords(wC,2,3,Ry[1]),this._toRenderCoords(wC,2,1,Ry[2]),this._toRenderCoords(wC,0,1,Ry[3]),s&&(this._projectToPlane(Ry,this.camera.frustum[rr.NEAR]),this._projectToPlane(Ry,this.camera.frustum[rr.TOP]),this._projectToPlane(Ry,this.camera.frustum[rr.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(Ry[o],yoe),this.camera.renderToScreen(yoe,n[o])}_projectToPlane(t,i){for(let s=0;s<4;s++)TC[s]=sr(i,t[s]);const r=Math.max(TC[0],TC[1],TC[2],TC[3]);if(r>0){const s=oe(xC,i,-r);for(let n=0;n<4;n++)de(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return xC[0]=t[i],xC[1]=t[r],xC[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(xC,this.tilingScheme.spatialReference,s),s}}const OB=Dt(),Pat=2,Iat=5,Ay=[Vr(),Vr(),Vr(),Vr()],wC=Dt(),xC=M(),Ry=[M(),M(),M(),M()],TC=[0,0,0,0],yoe=wo();function bwt(e,t,i){if(A(e)||A(i))return!1;let r=!0;return Gs[0]=e.xmin!=null?e.xmin:0,Gs[1]=e.ymin!=null?e.ymin:0,Gs[2]=e.zmin!=null?e.zmin:0,r=r&&lr(Gs,e.spatialReference,0,t,i,0,1),Gs[0]=e.xmax!=null?e.xmax:0,Gs[1]=e.ymax!=null?e.ymax:0,Gs[2]=e.zmax!=null?e.zmax:0,r=r&&lr(Gs,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function Gxe(e,t,i){if(A(e)||A(i))return!1;let r=!0;return Gs[0]=e.xmin!=null?e.xmin:0,Gs[1]=e.ymin!=null?e.ymin:0,Gs[2]=e.zmin!=null?e.zmin:0,r=r&&lr(Gs,e.spatialReference,0,Gs,i,0,1),t[0]=Gs[0],t[1]=Gs[1],Gs[0]=e.xmax!=null?e.xmax:0,Gs[1]=e.ymax!=null?e.ymax:0,Gs[2]=e.zmax!=null?e.zmax:0,r=r&&lr(Gs,e.spatialReference,0,Gs,i,0,1),t[2]=Gs[0],t[3]=Gs[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const Gs=M(),$at=fe.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let jn=class extends Ee{constructor(e){super(e),this.tiles=new ft,this.tileSize=512,this._idToTile=new Map,this._handles=new Ht,this._clients=new Set,this._dirty=!1,this._newTiles=new Vt}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(_(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void $at.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||_(t)&&e&&t.equals(e))return;const i=_(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(A(this.filterExtent)||!this.tilingScheme)return null;const e=Dt();return Gxe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([ae(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Vi),ae(()=>{var e,t,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Ps)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(yt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Js(this._frameWorker),this._handles=at(this._handles)}addClient(){const e=Lat();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(fE))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),_(this._frameWorker)&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&_(this._frameWorker)&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Mat({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new Fd(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),vu(XI);for(let t=0;t<e.length;t++)if(bb(XI,e.data[t].measures.screenRect,XI),np(XI)>Nat)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!$M(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==Bo.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===Bo.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],jn.prototype,"scheduler",void 0),u([d({constructOnly:!0})],jn.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],jn.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],jn.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],jn.prototype,"focus",void 0),u([d({constructOnly:!0})],jn.prototype,"viewState",void 0),u([d({constructOnly:!0})],jn.prototype,"terrain",void 0),u([d()],jn.prototype,"tiles",void 0),u([d()],jn.prototype,"tileSize",void 0),u([d({readOnly:!0})],jn.prototype,"tilingScheme",null),u([d()],jn.prototype,"filterExtent",null),u([d({readOnly:!0})],jn.prototype,"filterExtentRect",null),u([d({readOnly:!0})],jn.prototype,"rootTileIds",null),u([d({value:!1})],jn.prototype,"suspended",null),u([d({readOnly:!0})],jn.prototype,"updating",null),jn=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],jn);let Dat=0;function Lat(){return Dat++}const XI=Dt(),Nat=10;let Gn=class extends Ee{constructor(){super(...arguments),this._propertiesPool=new Lg({camera:Qi},this),this._lastSeenCameraProjectionValues=new Qi,this.events=new Kr,this.viewingMode=Ve.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new $m({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Lg({camera:Qi},this)}createInitialCamera(){if(this.viewingMode===Ve.Global){const e=wi(this.spatialReference).radius;this.camera=new Qi(Ue(4*e,0,0),Ue(e,0,0),Ue(0,0,1))}else this.camera=new Qi(Ue(0,0,100),Ue(0,0,0),Ue(0,1,0))}get animation(){return this.cameraController instanceof QO&&_(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Nu&&Nu.copyFrom(e),Nu.computeUp(this.viewingMode),voe.camera=Nu,this.events.emit("before-camera-change",voe);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Nu)&&(this._lastSeenCameraProjectionValues.copyFrom(Nu),_oe.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",_oe)),(!t||!t.equals(Nu))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Nu)),this._cameraChanged=!t||!t.almostEquals(Nu),this._cameraChanged)){const i=tue(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return _(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=_(e)?e.clone():null}get fixedContentCamera(){return _(this._contentCamera)}get isGlobal(){return this.viewingMode===Ve.Global}get isLocal(){return this.viewingMode===Ve.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(ae(()=>e.state,t=>{t!==Ir.Finished&&t!==Ir.Stopped||(this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i)))},Vi)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ir.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Ir.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();Nu.copyFrom(this._get("camera")),e(Nu),this.camera=Nu,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Ct.TOP]!==t.padding[Ct.TOP]||e.padding[Ct.RIGHT]!==t.padding[Ct.RIGHT]||e.padding[Ct.BOTTOM]!==t.padding[Ct.BOTTOM]||e.padding[Ct.LEFT]!==t.padding[Ct.LEFT]}};u([d({readOnly:!0,type:y2})],Gn.prototype,"animation",null),u([d({type:Qi})],Gn.prototype,"camera",null),u([d()],Gn.prototype,"pixelRatio",null),u([d({})],Gn.prototype,"_contentCamera",void 0),u([d({type:Qi})],Gn.prototype,"contentCamera",null),u([d({readOnly:!0})],Gn.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],Gn.prototype,"constraints",void 0),u([d({readOnly:!0})],Gn.prototype,"events",void 0),u([d({readOnly:!0})],Gn.prototype,"isGlobal",null),u([d({readOnly:!0})],Gn.prototype,"isLocal",null),u([d({readOnly:!0})],Gn.prototype,"viewingMode",void 0),u([d({readOnly:!0})],Gn.prototype,"spatialReference",void 0),u([d({readOnly:!0})],Gn.prototype,"navigating",null),u([d({readOnly:!0})],Gn.prototype,"stationary",null),u([d()],Gn.prototype,"_cameraChanged",void 0),u([d()],Gn.prototype,"cameraController",null),Gn=u([P("esri.views.3d.state.ViewState")],Gn);const Fat=Gn,Nu=new Qi,voe={camera:null},_oe={camera:null};function Uat(e,t,i){return e===Ve.Global?new zat(i):new kat(t,i)}class kat{constructor(t,i){this.elevationProvider=t,this._referenceEllipsoid=wi(i),this.unitInMeters=gc(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=t[2]*this.unitInMeters;const a=o,l=o-s,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(o=l>=0?a-this.unitInMeters*c.min:this.unitInMeters*c.max-a);const h={x:(r=_(r)?r:new ri({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);pe(N_,i,t),Tx[0]=N_[0]>0?r.xmax:r.xmin,Tx[1]=N_[1]>0?r.ymax:r.ymin,Tx[2]=N_[2]>0?p/2:-p/2,pe(Tx,Tx,t),we(N_,N_);const f=1.1*xe(Tx,N_)*this.unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),v=y*Gat*this.unitInMeters,w=y*jat*this.unitInMeters;let b=De((o-w)/(v-w),0,1);b*=b*b;let S=qt(m,f,b);return S*=Math.max(Math.log(Math.abs(l)),1),S=Math.min(S,Math.max(34064e4,p)),S/=this.unitInMeters,jxe(S,Bat,this.unitInMeters,n)}}class zat{constructor(t){this._referenceEllipsoid=wi(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const o=Oe(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return jxe(1.2*Math.sqrt(c*(c+2*a)),De(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function jxe(e,t,i,r){const s=Vat/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const Bat=2e4,Vat=2,Gat=.001,jat=1e-4,Tx=M(),N_=M();let yL=class extends Ee{constructor(e){super(e),this.handles=new Ht}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;D_e(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{yE(this.view,e,Sh.EYE_AND_CENTER)})}};u([d({constructOnly:!0})],yL.prototype,"view",void 0),yL=u([P("esri.views.3d.state.ElevationCollisionConstraint")],yL);let qA=class extends Ee{constructor(e){super(e),this._handles=new Ht,this.nearFarHeuristic=Uat(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([ae(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(r=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:r.far]},()=>this._clipDistanceNearFarChanged()),ae(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),ae(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Vi),ae(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(r=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:r.max]},()=>this._updateAltitude(),Vi),ae(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),Vi),ae(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),Vi),ae(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Vi),ae(()=>{var e,t,i,r,s,n;return[(i=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:i.type,(n=(s=(r=this.view.state)==null?void 0:r.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),Vi)]),this.view.state.isLocal&&this._handles.add(ae(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Ft)),this._updateNearFar(),this.view.state.viewingMode!==Ve.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new yL({view:this.view}))}destroy(){this._handles=at(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>(this._updateCameraNearFarManual(i,e),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,V5(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var r,s,n;const e=(n=(s=(r=this.view.map)==null?void 0:r.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(mr.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ve.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt($t(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(hc(i))}}_updateLocalSurfaceDistance(e){if(A(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=mr.ALL){this.view.state.updateCamera(t=>ls(this.view,t,{selection:e,interactionType:kt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:On.TUMBLE}))}};u([d({constructOnly:!0})],qA.prototype,"view",void 0),u([d({readOnly:!0})],qA.prototype,"surfaceCollisionConstraint",void 0),qA=u([P("esri.views.3d.state.ConstraintsManager")],qA);let sS=class extends hb{constructor(e){super(e),this.handles=new Ht}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ir.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){D_e(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),yE(this.view,e,Sh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ir.Stopped)})}};u([d({constructOnly:!0})],sS.prototype,"view",void 0),u([d({constructOnly:!0})],sS.prototype,"desiredCamera",null),sS=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],sS);const Hat=.66;function Hxe(e){return 360-Kq.normalize(e)}function LU(e){return Kq.normalize(360-e)}function YI(e){return _(e)&&e.resolver&&e.resolver.reject(),null}function qat(e,t){return _(e)&&e.resolver&&e.resolver.resolve(t),t}function qxe(e,t,i,r=null){if(!t)return YI(r);const s=e.spatialReference||Ke.WGS84;if(_(t.camera)){const c=ww(t.camera.position,s);if(A(c))return YI(r);const h=t.camera.clone();return h.position=c,qat(r,h)}if(A(t.targetGeometry))return YI(r);const n=t.get("targetGeometry.spatialReference");if(n&&!hv(n,s))return YI(r);const o=$2(e,e.state.camera);let a=So.ADJUST;if(t.rotation!=null&&(o.heading=Hxe(t.rotation),a=So.LOCKED),i!=null&&(o.tilt=i),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?zY(e,t.scale,c.latitude):e.state.camera.distance,C1e(e,p,h,o,a,r)}const l=t.targetGeometry.extent;return $R(e,l,o.heading,o.tilt,a,r)}function Wat(e,t,i=null){return A(i)&&(i=new Oh),PZ(e,null,t.clone(),i)}async function Xat(e,t,i){const r=slt(e,t);if(!r)throw new H("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new dc({fov:e.camera.fov}),n=new Oh({camera:s});if(r.target instanceof Oh)return F_(await Qat(e,r.target,r,i,n));if(r.target instanceof dc)return F_(Xxe(e,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof ri){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return F_(o||c?await Bj(e,r,r.target.center,s,i,n):await tlt(e,r,r.target,s,i,n))}const a={boundingBox:ur(),hasZ:!1,screenSpaceObjects:[]},l=o?Yat(e,r):void 0;if(await Wxe(e,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(zd(a.boundingBox,as),Yc.x=as[0],Yc.y=as[1],Yc.z=as[2],Yc.spatialReference=e.spatialReference,isFinite(Yc.z)&&a.hasZ?c=T4(a.boundingBox):(Yc.z=void 0,c=lOe(bq(a.boundingBox,olt))),o||c)return F_(await Bj(e,r,Yc,s,i,n));const h=nlt(e,a.screenSpaceObjects);return F_(await rlt(e,r,Yc,a.boundingBox,h,s,i,n))}return r.position?F_(Kat(e,r,s,n)):F_(await elt(e,r,s,i,n))}function OZ(e,t){return t.scale==null&&t.zoom!=null?O1e(e,t.zoom):t.scale}function Yat(e,t){return iZe(e,OZ(e,t))}function MZ(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=Hxe(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function PZ(e,t,i,r){const s=e.spatialReference||Ke.WGS84;return t=_(t)?t:Xm(e,i),A(t)||(r.targetGeometry=Rv(t.center,e.renderSpatialReference,s),r.scale=M1e(e,t),r.rotation=LU(i.heading),r.camera=i),r}function BF(e,t,i){if(!t)return;if(!hv(t.spatialReference,e.spatialReference))throw new H("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let o;switch(t.type){case"point":o=t;break;case"multipoint":case"polyline":o=t.extent.center;break;case"mesh":o=t.origin;break;case"extent":o=t.center;break;case"polygon":o=t.centroid}o&&hv(o,e.basemapTerrain.spatialReference)?as[2]=vt(yf(e.elevationProvider,o),0):as[2]=0}(0,alt[t.type])(t,o=>{r.push(o[0],o[1],o[2])},as);const s=r.length/3;if(s===0)return;const n=new Array(r.length);if(lr(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let o=0;o<n.length;o+=3)t.hasZ?(as[0]=n[o+0],as[1]=n[o+1],as[2]=n[o+2]):(as[0]=n[o+0],as[1]=n[o+1]),Rf(i.boundingBox,as)}}async function Zat(e,t,i,r){const s=await xu(e.whenViewForGraphic(t));if(s.ok===!1||A(s.value)||!("whenGraphicBounds"in s.value))return void BF(e,t.geometry,r);const n=s.value,o=await xu(n.whenGraphicBounds(t,{minDemResolution:i}));if(o.ok===!1)return void BF(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;WS(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function Wxe(e,t,i,r){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return Yc.x=s,Yc.y=n,Yc.z=void 0,Yc.spatialReference=e.spatialReference.isGeographic?e.spatialReference:Ke.WGS84,void BF(e,Yc,r)}t&&typeof t.map=="function"?await Zo(t.map(s=>Wxe(e,s,i,r))):t instanceof cc?BF(e,t,r):t instanceof Pa&&await Zat(e,t,i,r)}async function Qat(e,t,i,r,s){if(_(t.camera))return Xxe(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=_(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=LU(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=OZ(e,i);n!=null&&(s.scale=n);const o=new bE(r);return qxe(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}function Xxe(e,t,i){const r=e.spatialReference,s=ww(t.position,r);return A(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,PZ(e,null,t,i))}function Jat(e,t,i,r,s,n){const o=e.renderSpatialReference;return Pn(i.position,QI,o),Pn(t,MB,o),n.targetGeometry=new nt(t),s.position=new nt(i.position),pe(VF,MB,QI),H5(e,QI,VF,r.up,s),n.scale=cw(e,or(QI,MB),n.targetGeometry.latitude),n.rotation=LU(s.heading),n.camera=s,n}async function Bj(e,t,i,r,s,n){if(A(i))throw new H("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=Fw(e);if(t.position)return Jat(e,n.targetGeometry,t,o,r,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=oe(as,o.viewForward,-l);o.eye=de(as,o.center,c),n.scale=cw(e,l,i.latitude)}$2(e,o,r);const a=MZ(r,t)?So.LOCKED:So.ADJUST;if(!t.zoomFactor){n.scale=OZ(e,t),n.scale==null&&(Pn(i,as,e.renderSpatialReference),X_e(o.frustum,as)?n.scale=cw(e,or(o.eye,as),i.latitude):n.scale=M1e(e,o));const l=new bE(s);E1e(e,n.targetGeometry,n.scale,r,a,l),n.camera=await l.resolver.promise}return n}function Kat(e,t,i,r){const s=Fw(e);return se(VF,s.viewForward),H5(e,s.eye,VF,s.up,PB),i.position=new nt(t.position),i.heading=t.heading!=null?t.heading:PB.heading,i.tilt=t.tilt!=null?t.tilt:PB.tilt,PZ(e,null,i,r)}async function elt(e,t,i,r,s){const n=Fw(e);return Bj(e,t,Rv(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function tlt(e,t,i,r,s,n){n.targetGeometry=i.clone();const o=Fw(e);$2(e,o,r);const a=MZ(r,t)?So.LOCKED:So.ADJUST,l=new bE(s);return $R(e,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function ilt(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=yf(e.elevationProvider,i)),te(as,i.x,i.y,n),bu(e.spatialReference,as,boe,e.renderSpatialReference),Ih(ZI,boe),$h(ZI,ZI),ur(SC);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const v=o[y];let w=r[v[2]];isFinite(w)||(w=n),te(as,r[v[0]],r[v[1]],w),Ks(as,e.spatialReference,as,e.renderSpatialReference),Rf(SC,ec(as,as,ZI))}const a=Sw(SC),l=Hv(SC),c=Ew(SC),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function rlt(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=Fw(e),c=ilt(e,l,i,r,s);$2(e,l,n);const h=MZ(n,t)?So.LOCKED:So.ADJUST;a.scale=cw(e,c,a.targetGeometry.latitude);const p=new bE(o);return E1e(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function slt(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function F_(e){return e&&_(e.camera)&&(e.rotation=LU(e.camera.heading)),e}function nlt(e,t){const i=Hat;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const as=M(),boe=Ae(),ZI=Sr(),SC=Ls(),olt=Dt(),VF=M(),QI=M(),MB=M(),PB={heading:0,tilt:0},Yc=new nt,alt={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.hasZ?(t(te(i,e.xmin,e.ymin,e.zmin)),t(te(i,e.xmax,e.ymin,e.zmin)),t(te(i,e.xmin,e.ymax,e.zmin)),t(te(i,e.xmax,e.ymax,e.zmin)),t(te(i,e.xmin,e.ymin,e.zmax)),t(te(i,e.xmax,e.ymin,e.zmax)),t(te(i,e.xmin,e.ymax,e.zmax)),t(te(i,e.xmax,e.ymax,e.zmax))):(t(te(i,e.xmin,e.ymin,i[2])),t(te(i,e.xmax,e.ymin,i[2])),t(te(i,e.xmin,e.ymax,i[2])),t(te(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(te(i,r[s+0],r[s+1],r[s+2]))}};class llt{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const o=new AbortController;_(this.options.signal)&&Yo(this.options.signal,()=>{this.abort()}),this.abortController=o,this.waitForReady()})}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(di());break;case"wait-for-animation-finish":!t&&_(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(di())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await e2(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,Xat(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const i=this._getCameraFromViewpoint(t);if(!A(i))if(this.options.animate){if(A(this.animationController))return;this.startAnimation(i,this.animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const i=!!(this.target instanceof Oh&&this.target.camera||this.target instanceof dc),r=t.camera;if(A(r))return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new H("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=Xm(this.view,r);return A(s)?(this.reject(new H("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(A(r))return void this.reject(new H("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||A(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new sS({view:this.view,desiredCamera:t.camera}),yE(this.view,t.camera,Sh.EYE_AND_CENTER)):ls(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof cg&&_(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):_(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!A(this.view.state))switch(i.state){case Ir.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Ir.Ready:case Ir.Rejected:case Ir.Running:case Ir.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,i=null;const r=this.view.state.cameraController;return r instanceof cg&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new cg({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(_(i)&&i.stop(),this.reject(new H("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const Fu=fe.getLogger("esri.views.3d.state.ViewStateManager");let an=class extends Ee{constructor(e){super(e),this.propertiesPool=new Lg({frustum:U0},this),this.handles=new Ht,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=$2(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(Xm(this.view,e),{applyConstraints:!1})||Fu.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=$2(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=Xm(this.view,e);A(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=il(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([ae(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),ae(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),ae(()=>this.view.state.camera,n=>{const o=pn(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Fu.error("#center=","Invalid center",e):Fu.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Fu.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=QYe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return _(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Fu.error("#extent=","Invalid extent",e):Fu.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Fu.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return cw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Fu.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[Ct.TOP]/i),n=Math.round(t[Ct.RIGHT]/i),o=Math.round(t[Ct.BOTTOM]/i),a=Math.round(t[Ct.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,JI),this.view.state.updateCamera(t=>t.padding=JI))}_paddingToArray(e,t,i){e?Xi(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Xi(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return sp((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Wat(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Fu.error("#viewpoint=","Invalid viewpoint",e);else{const t=_(e.camera)?e.camera.position:e.targetGeometry,i=_(t)&&t.spatialReference;Fu.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else Fu.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?R1e(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Fu.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(_(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),i!=null){const r=i/Math.max(this.view.width,this.view.height);e=Math.min(e,r)}return e}get _devicePixelRatio(){return A(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([fn(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),ae(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(Lb({prepare:()=>this._prepareFrame()})),this.handles.add(ae(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(KI)})),this.handles.add(fn(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new qA({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Ve.Local&&this.handles.add(_l(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(KI),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),KI)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(KI),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i=F({animate:!0},t);return _(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new llt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Fw(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(r=>{i.stepController(e,r)}),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){_(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of hlt){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(A(e)||this.cameraSetByUser)return;if(e instanceof dc)return void this.setStateCamera(Xm(this.view,e),{applyConstraints:!1});if(e instanceof Oh){if(e.targetGeometry instanceof ri){const s=$R(this.view,e.targetGeometry,0,.5,So.LOCKED);return void(_(s)&&this.setStateCamera(Xm(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=$R(this.view,e,0,.5,So.LOCKED);_(t)&&this.setStateCamera(Xm(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&ult.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!A(e)&&(e instanceof Oh?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof dc?this.isCompatible(e.position):e.spatialReference&&hv(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=dlt){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=Oy){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=KO(this.view,r,s,e,t,So.ADJUST);return A(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=$R(this.view,e,t,i,So.ADJUST,plt);return _(r)?Xm(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=zY(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(O1e(this.view,e))}_viewpointToCamera(e){return Xm(this.view,qxe(this.view,e))}setStateCamera(e,t){return!(A(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&ls(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new sS({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(Oy.copyFrom(n),Oy.pixelRatio!==i&&(this._paddingToArray(this.padding,i,JI),Oy.padding=JI),Oy.fullWidth=r,Oy.fullHeight=s,Oy.pixelRatio=i,this.view.state.camera=Oy)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?V5(this.view,e.eye):0;e.relativeElevation=i-r}};u([d({type:dc,dependsOn:["view.state.camera","ready"]})],an.prototype,"camera",null),u([d({type:dc,dependsOn:["view.state.contentCamera","ready"]})],an.prototype,"contentCamera",null),u([d({type:nt})],an.prototype,"center",null),u([d({type:ri})],an.prototype,"extent",null),u([d({readOnly:!0})],an.prototype,"frustum",null),u([d({readOnly:!0})],an.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],an.prototype,"ready",void 0),u([d({type:Number})],an.prototype,"scale",null),u([d()],an.prototype,"padding",null),u([d({readOnly:!0})],an.prototype,"screenCenter",null),u([d({constructOnly:!0})],an.prototype,"view",void 0),u([d({type:Oh})],an.prototype,"viewpoint",null),u([d({type:Number})],an.prototype,"zoom",null),u([d()],an.prototype,"maximumPixelRatio",null),u([d()],an.prototype,"_devicePixelRatio",null),u([d()],an.prototype,"_windowDevicePixelRatio",void 0),u([d()],an.prototype,"_devicePixelRatioOverride",void 0),u([d()],an.prototype,"_maximumPixelRatioOverride",void 0),an=u([P("esri.views.3d.state.ViewStateManager")],an);const clt=an,ult=["camera","viewpoint","extent","scale","center","zoom"],hlt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],dlt={heading:0,tilt:0},plt=new dc,Oy=new Qi,JI=Gt(),KI="pending-initial-view";class flt{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this.view=r,this.externalIntersectionHandlers=new Vt,this.tolerance=P2,this.tmpRay=Qn(),this.tmpRegion=Dt(),this.validateHUDIntersector=Lh(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this.tmpRay),woe(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,woe(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=io.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(i$,r,s),i$[0]+=.0466,i$[1]-=.0123,$Y(t,i$,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this.tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||Zf(s)&&s.intersector!==Dr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=P2){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===Dr.TERRAIN?1:r.type===Dr.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t)!=null&&this.externalIntersectionHandlers.sort((i,r)=>i.type===Dr.TERRAIN?1:r.type===Dr.TERRAIN?-1:0)}_getPickRay(t,i){const r=this.view.state.camera;return Q_e(r,t,i)}_intersectRayFreePointLocal(t,i){if(this.viewingMode!==Ve.Local||A(t))return!1;const r=this.view.renderDataExtent;if(A(r))return de(i,t.origin,we(je.get(),t.direction)),!0;const s={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return de(i,t.origin,we(je.get(),t.direction)),!0;const o=this.view.state.camera,a=Math.max(0,r.xmin-o.eye[0],o.eye[0]-r.xmax),l=Math.max(0,r.ymin-o.eye[1],o.eye[1]-r.ymax),c=Math.sqrt(a*a+l*l),h=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/h))**2;let f=n/Math.max(1,p);f=Math.max(f,Math.min(c,n));const m=oe(je.get(),t.direction,f/Oe(t.direction));return de(i,t.origin,m),!0}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(A(t))return null;const n=_(i)?i.mode:"absolute-height",o=_(i)?vt(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,a,t$)){const S=this.view.computeMapPointFromVec3d(t$);return S.z-=o,S}return null}const c=this.view.state.camera,h=je.get();c.projectToRenderScreen(t.origin,h);const p=new xoe(null,this._forEachLayer),f=this.view.slicePlane,m=_(f)?gre(f):null,y=Lh(this.viewingMode);y.options.store=io.MIN,y.options.verticalOffset=l;const v=t.origin,w=de(je.get(),v,t.direction);y.reset(v,w,c),y.point=h;const b=_(s)?"type"in s&&s.type==="graphics"?S=>S.metadata.layerUid!==s.uid:S=>S.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const S=T=>(A(b)||b(T))&&T.metadata&&T.metadata.isElevationSource;y.intersect(p.layers,h,this.tolerance,null,S),this.externalIntersectionHandlers.forAll(T=>{if(T.type===Dr.I3S||T.type===Dr.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(y,E,y.rayBegin,y.rayEnd,h)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(S=>{if(S.isGround){const T=S.slicePlaneEnabled?m:null;S.intersect(y,T,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(t$)){const S=this.view.computeMapPointFromVec3d(t$);return S.z=r,S}return null}computeIntersection(t,i,r){if(A(t))return;const s=this.view.state.camera,n=je.get();s.projectToRenderScreen(t.origin,n);const o=new xoe(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=t.origin,l=de(je.get(),t.origin,t.direction);i.reset(a,l,s),i.intersect(o.layers,n,this.tolerance);const c=this.view.slicePlane,h=_(c)?gre(c):null;i.intersect(o.sliceableLayers,n,this.tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll(m=>{if(i.options.isFiltered=!o.filterLayerUid(m.layerUid),m.isGround&&p||!i.options.isFiltered){const y=m.slicePlaneEnabled?h:null;m.intersect(i,y,a,l,n)}});const f=je.get();if(r&&r.enableDraped&&i.results.ground.getIntersectionPoint(f)){const m=this.view.basemapTerrain,y=m.overlayManager.renderer,v=this.view.renderCoordsHelper.spatialReference,w=je.get();this.view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=vt(this.view.elevationProvider.getElevation(f[0],f[1],f[2],v,"ground"),0),y.intersect(i,w,i.results.ground,b=>o.filterRenderGeometry(b))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){const i=t.results.hud;Mg(this.tmpRegion,rV);const r=this.view.state.camera,s=[],n=this.tmpRegion,o=b=>{const S=new glt(b);r.projectToRenderScreen(b.target.center,S.screenPoint),S.screenPoint[0]=Math.floor(S.screenPoint[0]),S.screenPoint[1]=Math.floor(S.screenPoint[1]),s.push(S),hS(n,S.screenPoint)};t.sortResults(i.all),_(i.min.dist)&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(_(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-WA),h=Math.max(0,n[1]-WA),p=Math.min(ru(n)+2*WA,a-c),f=Math.min(np(n)+2*WA,l-h),m=new Uint8Array(p*f*4);this.view._stage.renderView.readHUDVisibility(c,h,p,f,m);let y=!0;const v=A(t.results.max.dist);let w=0;for(const b of s)for(const S of mlt)if(m[4*(Math.min(b.screenPoint[0]+S[0],a)-n[0]+(Math.min(b.screenPoint[1]+S[1],l)-n[1])*p)]){y&&(t.results.min.copy(b.result),y=!1),v&&t.results.max.copy(b.result),t.options.store===io.ALL&&t.results.all.splice(w++,0,b.result);break}}}const WA=1,mlt=(()=>{const e=[],t=WA;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class glt{constructor(t){this.result=t,this.screenPoint=wo()}}let e$;function woe(e){return e$&&e$.viewingMode===e||(e$=Lh(e)),e$}class xoe{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.isPickable&&this.filterLayerUid(r.apiLayerUid)&&(r.isSliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return A(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function Toe(e){return typeof e=="object"&&"intersect"in e}const t$=M(),i$=wo();class wwt{constructor(t,i){this.spatialReference=t,this.view=i}getElevation(t,i,r){return this.view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this.view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class ylt{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=ve(F({},s),{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(yt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,o)=>{const a={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),Yo(r,()=>{OH(this._queries,a),o(di())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void t.forEach(c=>c.result.reject());const r=t.map(c=>[c.x,c.y]),s=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new xw({points:r,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=_(o)?o.signal:t[0].signal;if(_(o)){let c=0;t.forEach(h=>Yo(h.signal,()=>{c++,h.result.reject(di()),c===t.length&&o.abort()}))}const l=ve(F({},this._queryOptions),{minDemResolution:s,signal:a});i.queryElevation(n,l).then(c=>{t.forEach((h,p)=>{_(h.signal)&&h.signal.aborted?h.result.reject(di()):h.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let XA=class extends Kr.EventedMixin(Ee){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=at(this._elevationQuery)}get elevationQuery(){return A(this._elevationQuery)&&(this._elevationQuery=new ylt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&r.equals(o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=r$(n,this.im,e,t,i,r,s),A(n)&&(n=r$(n,this.ground,e,t,i,r,s)),s==="scene"&&(n=r$(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=ip();return this.elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=r$(l,this.scene,e,t,i,r,s)),a.resolve(l)}).catch(l=>{jr(l)?a.reject(l):a.resolve(this.getElevation(e,t,i,r,s))}),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function r$(e,t,i,r,s,n,o){for(const a of t){const l=a.getElevation(i,r,s,n,o);_(l)&&(e=_(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],XA.prototype,"view",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],XA.prototype,"spatialReference",void 0),XA=u([P("esri.views.3d.support.CombinedElevationProvider")],XA);class av{static isValidProfile(t){return t in av.profiles}static getDefaultProfile(){return he("trident")||he("esri-iPhone")?"low":"medium"}static apply(t,i){const r=av.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable;{const s=i.sceneService["3dObject"],n=r.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumRenderResolution=r.maximumRenderResolution,i.maximumPixelRatio=r.maximumPixelRatio}}function Soe(){const e=!!he("esri-mobile"),t=!!he("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}av.debug={reset(){const e=Soe();for(const t in e)av.profiles[t]=e[t]}},function(e){e.profiles=Soe()}(av||(av={}));const vL=av;function IZ(){return new Float32Array(4)}function vlt(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Fh(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function _lt(e,t){return new Float32Array(e,t,4)}function Yxe(){return IZ()}function Zxe(){return Fh(1,1,1,1)}function Qxe(){return Fh(1,0,0,0)}function Jxe(){return Fh(0,1,0,0)}function Kxe(){return Fh(0,0,1,0)}function eTe(){return Fh(0,0,0,1)}const blt=Yxe(),wlt=Zxe(),xlt=Qxe(),Tlt=Jxe(),Slt=Kxe(),Elt=eTe();Object.freeze(Object.defineProperty({__proto__:null,create:IZ,clone:vlt,fromValues:Fh,createView:_lt,zeros:Yxe,ones:Zxe,unitX:Qxe,unitY:Jxe,unitZ:Kxe,unitW:eTe,ZEROS:blt,ONES:wlt,UNIT_X:xlt,UNIT_Y:Tlt,UNIT_Z:Slt,UNIT_W:Elt},Symbol.toStringTag,{value:"Module"}));let Xp=class extends Ee{constructor(){super(...arguments),this.color=new qe([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new qe([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=qe.toUnitRGBA(e.color),i=_(e.haloColor)?qe.toUnitRGBA(e.haloColor):t,r=qe.toUnitRGBA(e.shadowColor);return{color:Fh(t[0],t[1],t[2],t[3]),haloColor:Fh(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:gi(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([d({type:qe})],Xp.prototype,"color",void 0),u([d({type:qe})],Xp.prototype,"haloColor",void 0),u([d()],Xp.prototype,"haloOpacity",void 0),u([d()],Xp.prototype,"fillOpacity",void 0),u([d()],Xp.prototype,"shadowOpacity",void 0),u([d({type:qe})],Xp.prototype,"shadowColor",void 0),u([d()],Xp.prototype,"shadowDifference",void 0),Xp=u([P("esri.views.3d.support.HighlightOptions")],Xp);const Vj=Xp;function Clt(e,t,i){const r=$ue(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let R1=class extends ye{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(r=>r.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:Z2(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],R1.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],R1.prototype,"outSpatialReference",void 0),u([d()],R1.prototype,"transformation",void 0),u([d()],R1.prototype,"transformForward",void 0),R1=u([P("esri.rest.support.ProjectParameters")],R1);const $Z=R1,Alt=Ds($Z);async function tTe(e,t,i){t=Alt(t);const r=dge(e),s=F(ve(F({},r.query),{f:"json"}),t.toJSON()),n=t.outSpatialReference,o=Z2(t.geometries[0]),a=S5e(s,i);return ai(r.path+"/project",a).then(({data:{geometries:l}})=>Clt(l,o,n))}async function DZ(e=null,t){var s,n;if(Di.geometryServiceUrl)return Di.geometryServiceUrl;if(!e)throw new H("internal:geometry-service-url-not-configured");let i;i="portal"in e?e.portal||Ro.getDefault():e,await i.load({signal:t});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new H("internal:geometry-service-url-not-configured");return r}async function Rlt(e,t,i=null,r){const s=await DZ(i,r),n=new $Z;n.geometries=[e],n.outSpatialReference=t;const o=await tTe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new H("internal:geometry-service-projection-failed")}var Olt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getGeometryServiceURL:DZ,projectGeometry:Rlt});class Mlt{constructor(t,i){this.spatialReference=i,this.unitInMeters=gc(this.spatialReference,wi(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=DZ(t&&t.get("portalItem")).catch(()=>{throw new H("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(l=>l instanceof nt?l:new nt(l,this.spatialReference)),o=new $Z({geometries:n,outSpatialReference:Ke.WGS84}),a=(await tTe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let rf=class extends Ee{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};u([d()],rf.prototype,"minTotalNumberOfFeatures",void 0),u([d()],rf.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],rf.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],rf.prototype,"snapshotAvailable",void 0),u([d()],rf.prototype,"polygonLodFactor",void 0),u([d()],rf.prototype,"polylineLodFactor",void 0),rf=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],rf);let xf=class extends Ee{constructor(){super(...arguments),this.lodFactor=1}};u([d()],xf.prototype,"lodFactor",void 0),xf=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],xf);let GF=class extends xf{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};GF=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],GF);let Zm=class extends Ee{constructor(){super(...arguments),this["3dObject"]=new GF,this.point=new xf,this.integratedMesh=new xf,this.pointCloud=new xf,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:GF})],Zm.prototype,"3dObject",void 0),u([d({type:xf})],Zm.prototype,"point",void 0),u([d({type:xf})],Zm.prototype,"integratedMesh",void 0),u([d({type:xf})],Zm.prototype,"pointCloud",void 0),u([d()],Zm.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Zm=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Zm);let I0=class extends Ee{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};u([d()],I0.prototype,"lodBias",void 0),u([d()],I0.prototype,"angledSplitBias",void 0),u([d()],I0.prototype,"reduceTileLevelDifferences",void 0),u([d()],I0.prototype,"textureFadeDuration",void 0),I0=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],I0);let nS=class extends Ee{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],nS.prototype,"pixelRatio",void 0),u([d()],nS.prototype,"maxTotalNumberOfFeatures",void 0),nS=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],nS);let Xa=class extends Ee{constructor(){super(...arguments),this.graphics3D=new rf,this.sceneService=new Zm,this.tiledSurface=new I0,this.heatmap=new nS,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};u([d({type:rf})],Xa.prototype,"graphics3D",void 0),u([d({type:Zm})],Xa.prototype,"sceneService",void 0),u([d({type:I0})],Xa.prototype,"tiledSurface",void 0),u([d({type:nS})],Xa.prototype,"heatmap",void 0),u([d()],Xa.prototype,"antialiasingEnabled",void 0),u([d()],Xa.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],Xa.prototype,"highQualityTransparency",void 0),u([d()],Xa.prototype,"memoryLimit",void 0),u([d()],Xa.prototype,"additionalCacheMemory",void 0),u([d()],Xa.prototype,"frameRate",void 0),u([d()],Xa.prototype,"maximumRenderResolution",void 0),u([d()],Xa.prototype,"maximumPixelRatio",void 0),Xa=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],Xa);const Eoe=Xa;class jF{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this.coordinateSystem=s,this._coordinateSystem=cDe(s)}set extent(t){t&&uDe(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return vDe(this.coordinateSystem,t)}setAltitude(t,i,r=t){return kfe(this.coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){_De(this.coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return fDe(this.coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return mDe(this.coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,pu.X,je.get()),s=this.worldBasisAtPosition(t,pu.Y,je.get()),n=this.worldBasisAtPosition(t,pu.Z,je.get());return jf(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}intersectManifoldClosestSilhouette(t,i,r){return Xk(this.coordinateSystem,i,this._coordinateSystem),yDe(this._coordinateSystem,t,r),r}intersectManifold(t,i,r){Xk(this.coordinateSystem,i,this._coordinateSystem);const s=je.get();return gDe(this._coordinateSystem,t,s)?se(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===Ve.Global)return this.intersectManifold(t,i,r);Xk(this.coordinateSystem,i,this._coordinateSystem);const s=this._coordinateSystem.value,n=je.get();return Pw(s.plane,t,n)?se(r,n):null}toRenderCoords(t,i,r){return vF(t)?Pn(t,i,this.spatialReference):Ks(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return vF(i)?(_(r)&&(i.spatialReference=r),Npe(t,this.spatialReference,i)):i instanceof Ke?Rv(t,this.spatialReference,i):Ks(t,this.spatialReference,i,r)?i:null}static create(t,i){switch(t){case Ve.Local:return new jF(Ve.Local,i,gc(i),pDe());case Ve.Global:return new jF(Ve.Global,i,1,dDe(i))}}static renderUnitScaleFactor(t,i){return Coe(t)/Coe(i)}}function Coe(e){if(_F(e,Ve.Global))return 1;const t=zfe(!1,e);return gc(t)}var pf;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(pf||(pf={}));const Plt=(()=>{const e=new Array;return e[pf.ELEVATION]=10,e[pf.BASEMAP]=10,e[pf.I3S_INDEX]=10,e[pf.I3S_DATA]=10,e[pf.SYMBOLOGY]=5,e})(),Ilt=30;function iTe(e){return typeof e.getUsedMemory=="function"}const $lt=fe.getLogger("esri.views.3d.support.MemoryController");function Dlt(e){return new Ya({view:e})}const s$=1,IB=1,Llt=.75,Nlt=.6,Aoe=1.3;let Ya=class extends Ee{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new YW,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(s$),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new z4e(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Nlt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(s$);else if(e)(this._memoryPredicted>1.1*IB||this._memoryUsed>IB)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/Aoe),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>IB)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Aoe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<Llt&&this._quality<s$){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),s$))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;_(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(iTe(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);$lt.warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],Ya.prototype,"view",void 0),u([d()],Ya.prototype,"maxMemory",null),u([d()],Ya.prototype,"additionalCacheMemory",null),u([d()],Ya.prototype,"memoryFactor",null),u([d()],Ya.prototype,"updating",null),u([d()],Ya.prototype,"usedMemory",null),u([d()],Ya.prototype,"_quality",void 0),u([d()],Ya.prototype,"_memoryUsed",void 0),u([d()],Ya.prototype,"_updating",void 0),u([d()],Ya.prototype,"_stableQuality",void 0),u([d()],Ya.prototype,"_maxMemory",void 0),u([d()],Ya.prototype,"_additionalCacheMemory",void 0),Ya=u([P("esri.views.3d.support.MemoryController")],Ya);class Flt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class Ult{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new klt}}class klt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class zlt{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new Ult(n))}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,dt(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let _L=class extends Ee{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new zlt((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(yt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Js(this._frameTask),this._tasks.forEach(e=>Ah(e.abortController)),this._loadQueue=at(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=ip();s.__signal=_(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return Yo(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const o=new Glt(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){c4(e.resolvers,t),t.reject(di()),e.resolvers.length===0&&(e.status===th.DOWNLOADING&&(e.status=th.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=th.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=jlt(_(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(dt(e.status===th.DOWNLOADING),e.status=th.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();hi(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==th.DOWNLOADED&&(t.err=t.err||di()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!jr(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)jr(t)?r.reject(t):r.reject(new H("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:ie(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===th.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=th.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=ai(e.url,ve(F({},e.options),{responseType:r,timeout:i,signal:s}));let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===th.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=Vlt(c);if(r="image",e.size=c.byteLength,h==="unknown")return e.request=ai(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=ai(f,{responseType:r,timeout:i,signal:s}),e.request.then(m=>o(new NU(m.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],_L.prototype,"updating",void 0),_L=u([P("esri.views.3d.support.StreamDataLoader")],_L);const Blt={numRetries:0};function Vlt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class NU{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class Glt extends Flt{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=th.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Blt.numRetries}}function jlt(e,t,i){return`${e}:${t}:${i}`}var th;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(th||(th={}));let n$=class extends Ee{constructor(){super(...arguments),this.updating=!1}};function Hlt(e){return new Gj.ResourceController({view:e})}var Gj;u([d({readOnly:!0})],n$.prototype,"updating",void 0),n$=u([P("esri.views.3d.support.ResourceController")],n$),function(e){let t=class extends n${constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=g2,this._cameraChangeTime=0,this._handles=new Ht,this._frameTask=null,this._state=Tn.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=lGe(),this._memoryController=Dlt(this.view),this._streamDataLoader=new _L,this._streamDataLoader.setup(Ilt,Plt,this._scheduler),this._handles.add([ae(()=>{var r;return(r=this.view.state)==null?void 0:r.camera},(r,s)=>this._cameraChangedHandler(r,s),Vi),ae(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=Lb({update:r=>this._frame(r)}),this._scheduleTask=this._scheduler.registerTask(yt.RESOURCE_CONTROLLER)}destroy(){this._handles=at(this._handles),this._scheduleTask.remove(),this._frameTask=Js(this._frameTask),this._streamDataLoader=at(this._streamDataLoader),this._memoryController=at(this._memoryController),this._scheduler=at(this._scheduler)}get updating(){var r,s,n;return!!(((r=this._memoryController)==null?void 0:r.updating)||((s=this._streamDataLoader)==null?void 0:s.updating)||((n=this._scheduleTask)==null?void 0:n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(r,s,n){return this._scheduleTask.schedule(r,s,n)}createStreamDataRequester(r){const s=this._streamDataLoader;return{request:(n,o,a)=>s.request(n,o,r,a),get busy(){return!s.hasDownloadSlots(r)}}}_frame(r){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(jH(r.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(r)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(r,s){r&&s&&r.almostEquals(s)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=Tn.ANIMATING:this.view.interacting?this._state=Tn.INTERACTING:(this._state===Tn.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=i?this._state=Tn.INTERACTING:this._state=Tn.IDLE)}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r),state:this._state}}};u([d({constructOnly:!0})],t.prototype,"view",void 0),u([d()],t.prototype,"_scheduler",void 0),u([d()],t.prototype,"_memoryController",void 0),u([d()],t.prototype,"_streamDataLoader",void 0),u([d()],t.prototype,"_scheduleTask",void 0),u([d({readOnly:!0})],t.prototype,"updating",null),t=u([P("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(Gj||(Gj={}));function qlt(e){return"performanceInfo"in e}const Sx=M(),Wlt=M(),hm=M(),dm=M();function Xlt(e,t,i=0){const r=e.extent;if(A(r))return!1;if(i===0)return yhe(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return oOe(r,t,i*s)}function o$(e,t,i,r){se(Sx,i),Sx[r]=t[r];const s=pe(Sx,Sx,t),n=pe(Wlt,e,t),o=xe(n,s),a=xe(s,s);let l;l=o<=0?t:a<=o?i:de(Sx,t,oe(s,s,o/a));const c=pe(Sx,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Ylt(e,t,i){const r=e.extent;if(A(r))return 0;hm[0]=r[0],hm[1]=r[1],hm[2]=i,dm[0]=r[2],dm[1]=r[3],dm[2]=i;let s=1/0,n=1/0;return t[0]<hm[0]?s=o$(t,hm,dm,0):t[0]>dm[0]&&(s=o$(t,dm,hm,0)),t[1]<hm[1]?n=o$(t,hm,dm,1):t[1]>dm[1]&&(n=o$(t,dm,hm,1)),Math.min(s,n)}function Zlt(e,t,i){if(A(e))return BX();if(e.spatialReference.isGeographic&&!Hb(e.spatialReference))return new H("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Rr.checkUnsupported(e);if(_(r))return r;if(A(i))return new H("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=Qlt(e,i);if(s)return s;const n=e.spatialReference;return _(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function Qlt(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=mhe(t),a=Dt();Rr.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>qT){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new H("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:qT})}return null}const Jlt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:Xlt,tiltToExtentEdge:Ylt,checkIfTileInfoSupportedForViewSR:Zlt},Symbol.toStringTag,{value:"Module"}));function Klt(){return!0}function ect(){return 0}function tct(e,t){if(A(e))return BX();const i=e.lods.length-1,r=e.spatialReference,s=Hb(r)||zf(r)||Bf(r);if(r.isWebMercator){if(!Rr.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new H("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new H("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Rr.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new H("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new H("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return _(t)&&!e.spatialReference.equals(t)?new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const ict=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:Klt,tiltToExtentEdge:ect,checkIfTileInfoSupportedForViewSR:tct},Symbol.toStringTag,{value:"Module"})),rct={[Ve.Global]:ict,[Ve.Local]:Jlt};function af(e,t){e||console.warn("Terrain: "+t)}function jj(e){return FU(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function HF(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function FU(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function LZ(e){return(e==null?void 0:e.type)==="tile-3d"}function pM(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function rTe(e){return(e==null?void 0:e.type)==="wmts-3d"}function Hj(e){return(e==null?void 0:e.type)==="elevation-3d"}function sTe(e){return(e==null?void 0:e.type)==="group"}function qF(e){return e&&(LZ(e)||rTe(e)||FU(e)||pM(e))}function qj(e){return e&&(LZ(e)||FU(e)||pM(e)||rTe(e))}function fM(e){return qj(e)||Hj(e)}function xwt(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return e.type,!1}}function sct(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="raster-tile"}function nct(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="vector-tile"}function oct(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="tile-texture"}function act(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return t instanceof HTMLImageElement||t instanceof NU||t instanceof HTMLCanvasElement||t instanceof ImageData}function CS(e){return _(e)&&"release"in e&&e.release(),null}function Roe(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function NZ(e,t,i,r){return rct[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function UU(e,t,i){let r=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=lct(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=HF(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===Ve.Local;if(HF(e))r=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!cct(t)||uct.force512VTL,a=e.tileInfo.spatialReference.isGeographic;r=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=e.tileInfo}return _(r)&&_(s)&&NZ(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function lct(e,t,i){const r=bDe(e);if(_(r)){if(!ft.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>NZ(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function cct(e){return e.isWGS84||e.isWebMercator||uue(e)||!iO(e)}const uct={force512VTL:!1};function WF(e){return e===Nt.NORTH_EAST?Nt.SOUTH_WEST:e===Nt.NORTH_WEST?Nt.SOUTH_EAST:e===Nt.SOUTH_WEST?Nt.NORTH_EAST:Nt.NORTH_WEST}function bL(e){return e===Nt.NORTH?Nt.SOUTH:e===Nt.EAST?Nt.WEST:e===Nt.SOUTH?Nt.NORTH:Nt.EAST}function hct(e){return e===Nt.NORTH_WEST||e===Nt.SOUTH_WEST}function dct(e){return e===Nt.NORTH_WEST||e===Nt.NORTH_EAST}function Ooe(e){return e===Nt.NORTH_WEST||e===Nt.WEST||e===Nt.SOUTH_WEST}function Moe(e){return e===Nt.NORTH_EAST||e===Nt.EAST||e===Nt.SOUTH_EAST}function Poe(e){return e===Nt.SOUTH_EAST||e===Nt.SOUTH||e===Nt.SOUTH_WEST}function Ioe(e){return e===Nt.NORTH_EAST||e===Nt.NORTH||e===Nt.NORTH_WEST}const k0=[Nt.NORTH,Nt.EAST,Nt.SOUTH,Nt.WEST],XF=[Nt.NORTH_EAST,Nt.SOUTH_EAST,Nt.SOUTH_WEST,Nt.NORTH_WEST];class pct{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=fM(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),qlt(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class fct{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*n2.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=_(r)?r.usedMemory:0,t.allLayerViews.items.forEach(s=>{(iTe(s)||fM(s))&&this.layerPerformanceInfos.push(new pct(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class mct extends WT{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){hi(r);const s=_(r)&&r.signal,n=this.makeUid(t,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const h=this._createTexture(t,c,i);return o.texture=h,o.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:n,texture:h,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{Yo(s,()=>{l(di())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,i,r){const s=ve(F({},this._parameters),{powerOfTwoResizeMode:mv.PAD});if(Oq(t)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new Rs(i,s)}}class gct{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(pf.SYMBOLOGY),this.textures=new mct(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:bt.CLAMP_TO_EDGE,t:bt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=wi(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=B1e(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=qZe(t.viewingMode,i)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return Rh();this.graphicsOwners.push(t);const i=ae(()=>{var r;return(r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),Rh(()=>{i.remove(),c4(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new Ht;const i=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([ae(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Vi),this.viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;a$.distance=t.centerOnSurfaceInfrequent.distance,a$.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(a$),this.screenSizePerspectiveSettingsLabels.update(a$),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const a$={distance:0,fovY:0};class g0{constructor(t,i,r=""){this.graphics=t,this._symbol=new W0({symbolLayers:[new q0({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Cw({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(A(i))return;this.hide();const r=new nt({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new Pa({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){_(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let z0=class extends Ee{constructor(e){super(e),this.handles=new Ht}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],z0.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],z0.prototype,"surface",void 0),u([d({constructOnly:!0})],z0.prototype,"state",void 0),z0=u([P("esri.views.3d.support.PointOfInterest")],z0);const yct=Array;let zc=class extends z0{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Lg({location:nt,renderLocation:yct},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=M(),this.tmpPoint=new nt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(fn(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=or(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return cw(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{jr(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude($B,this._estimatedSurfaceAltitude,this._camera.eye),ll(this._get("renderLocation"),$B)||this._set("renderLocation",se(this._propertiesPool.get("renderLocation"),$B))}};u([d({constructOnly:!0})],zc.prototype,"scheduler",void 0),u([d({constructOnly:!0})],zc.prototype,"cache",void 0),u([d({constructOnly:!0})],zc.prototype,"task",void 0),u([d({constructOnly:!0})],zc.prototype,"cameraName",void 0),u([d({readOnly:!0})],zc.prototype,"location",null),u([d({constructOnly:!0})],zc.prototype,"map",void 0),u([d({readOnly:!0})],zc.prototype,"renderLocation",void 0),u([d({readOnly:!0})],zc.prototype,"scale",null),u([d({readOnly:!0})],zc.prototype,"updating",null),zc=u([P("esri.views.3d.support.CameraOnSurface")],zc);const $B=M(),vct=Array;let Vl=class extends z0{constructor(e){super(e),this._propertiesPool=new Lg({location:nt,renderLocation:vct},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=M(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Js(this._frameWorker),this._propertiesPool=at(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=bct;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=wct;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(se(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=or(this._camera.eye,e):(oe(e,this._camera.viewForward,this._get("distance")),de(e,e,this._camera.eye)),ll(this._get("renderLocation"),e)||this._set("renderLocation",se(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=wi(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=Sa(i.eye),o=n<s*s,a=or(i.eye,t);if(o&&a>r/4){const l=s-Math.sqrt(n);return oe(t,i.viewForward,l),de(t,t,i.eye),!0}}else{const r=this.surface.ready?this.surface.extent:null;_(r)&&j4(r,this.surface.spatialReference,EC,this.renderCoordsHelper.spatialReference)&&(t[0]=De(t[0],EC[0],EC[2]),t[1]=De(t[1],EC[1],EC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Gi.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=or(i,e),s=or(i,t);if(Math.abs(s-r)/r>_ct)return!0}return!1}};u([d({constructOnly:!0})],Vl.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Vl.prototype,"task",void 0),u([d({constructOnly:!0})],Vl.prototype,"cameraName",void 0),u([d()],Vl.prototype,"distance",void 0),u([d({constructOnly:!0})],Vl.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],Vl.prototype,"location",null),u([d({readOnly:!0})],Vl.prototype,"renderLocation",void 0),u([d()],Vl.prototype,"updating",void 0),Vl=u([P("esri.views.3d.support.CenterOnSurface")],Vl);const _ct=.05,bct=M(),wct=M(),EC=Dt();class xct{constructor(t){this.handles=new Ht,this.events=new Kr,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this.handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Tct)}}const Tct={},Sct=Array;let Yp=class extends z0{constructor(e){super(e),this._propertiesPool=new Lg({location:nt,renderLocation:Sct},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ae(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ae(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(yt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,$oe);const s=Math.max(0,(Math.acos(xe($oe,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!Bb(e,t)){const l=this._propertiesPool.get("renderLocation");se(l,t),this._set("renderLocation",l)}return}const n=1-De(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(Doe);const a=this._propertiesPool.get("renderLocation");tn(a,t,Doe,o),e&&Bb(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(wo());if(i[1]=t.aboveGround?t.padding[Ct.BOTTOM]:t.fullHeight-t.padding[Ct.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,CC)){pe(CC,CC,t.eye);const s=we(CC,CC);if(this.renderCoordsHelper.intersectManifold(wu(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],Yp.prototype,"_dirty",void 0),u([d({constructOnly:!0})],Yp.prototype,"scheduler",void 0),u([d({constructOnly:!0})],Yp.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],Yp.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],Yp.prototype,"updating",null),u([d({readOnly:!0})],Yp.prototype,"location",null),u([d({readOnly:!0})],Yp.prototype,"renderLocation",void 0),Yp=u([P("esri.views.3d.support.CenterOnSurface")],Yp);const $oe=M(),CC=M(),Doe=M();let km=class extends Ee{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Ht}get renderLocation(){if(!this.location)return null;const e=M();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([ae(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),fn(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||A(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=yq(this.surfaceView.extent),t=new nt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{jr(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};u([d({constructOnly:!0})],km.prototype,"view",void 0),u([d({constructOnly:!0})],km.prototype,"cache",void 0),u([d({readOnly:!0,aliasOf:"view.map.ground"})],km.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain"})],km.prototype,"surfaceView",void 0),u([d({readOnly:!0})],km.prototype,"location",void 0),u([d({readOnly:!0})],km.prototype,"renderLocation",null),km=u([P("esri.views.3d.terrain.StableSurfaceCenter")],km);let zm=class extends Ee{constructor(){super(...arguments),this.handles=new Ht,this._tileGeometryUpdateExtent=vu(),this._tileGeometryUpdateSpatialReference=null,this.events=new Kr,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(yt.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=at(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Ect),vu(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,bb(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=Cct,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,U_,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,k_,t),U_[0]<k_[0]?(r[0]=U_[0],r[2]=k_[0]):(r[0]=k_[0],r[2]=U_[0]),U_[1]<k_[1]?(r[1]=U_[1],r[3]=k_[1]):(r[1]=k_[1],r[3]=U_[1]),$M(r,e)}};u([d({constructOnly:!0})],zm.prototype,"state",void 0),u([d({constructOnly:!0})],zm.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],zm.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],zm.prototype,"scheduler",void 0),u([d({constructOnly:!0})],zm.prototype,"surface",void 0),u([d({readOnly:!0})],zm.prototype,"updating",void 0),zm=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],zm);const Ect={},U_=M(),k_=M(),Cct=vu();let zo=class extends Ee{constructor(e){super(e),this._handles=new Ht,this._tmpRay=Qn(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Lg({renderPointOfView:Act},this),this.renderPointOfView=M(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=Lh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=io.MIN,this._contentIntersector=Lh(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new Vl(ve(F({},a),{task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("centerOnSurfaceFrequent",new Vl(ve(F({},a),{task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("contentCenterOnSurface",new Vl(ve(F({},a),{task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"}))),this._set("centerOnContent",new Vl(ve(F({},a),{task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new zc(ve(F({},a),{cache:o,task:yt.POINT_OF_INTEREST_INFREQUENT,map:r}))),this._set("contentCameraOnSurface",new zc(ve(F({},a),{cache:o,task:yt.POINT_OF_INTEREST_INFREQUENT,map:r,cameraName:"contentCamera"}))),this._set("surfaceGeometryUpdates",new zm(ve(F({},a),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new xct({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new km({cache:o,view:this.view})),this._set("focus",new Yp({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new g0(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new g0(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new g0(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new g0(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new g0(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new g0(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new g0(l,"green","Focus")),this._handles.add([ae(()=>e.camera,h=>this._cameraChanged(h),Vi),ae(()=>t.extent,()=>this._updateCenterPointsOfInterest()),_l(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),Vi),fn(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),fn(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),_l(()=>Gi.SHOW_POI,h=>this._setDebug(h),Ft)]),this._cameraChanged(this.view.state.camera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)==null?void 0:e.updating)&&!this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return A(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,Ex,Oct)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ex):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(A(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=de(Ex,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(Ex)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(Ex)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=$Y(t,e,Rct);if(A(r))return null;const s=r.origin,n=de(Ex,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;ll(this.renderPointOfView,t)||this._set("renderPointOfView",se(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(ae(()=>t.renderLocation,i=>this._debugCenters.get(t).show(i,t.renderCoordsHelper.spatialReference),Ft),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],zo.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],zo.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],zo.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],zo.prototype,"contentCenterOnSurface",void 0),u([d({readOnly:!0})],zo.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],zo.prototype,"contentCameraOnSurface",void 0),u([d({readOnly:!0})],zo.prototype,"focus",void 0),u([d({readOnly:!0})],zo.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],zo.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],zo.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],zo.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],zo.prototype,"view",void 0),u([d({readOnly:!0})],zo.prototype,"updating",null),zo=u([P("esri.views.3d.support.PointsOfInterest")],zo);const Act=Array,Ex=M(),Rct=Qn(),Oct={exclude:new Set([Nd])};class Mct{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,i){this.store.put(t,i,i.values.byteLength+256)}}const Pct=fe.getLogger("esri.core.workers.WorkerHandle");class nTe{constructor(t,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=mpe(t,ve(F({},n),{schedule:s})).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Pct.error(`Failed to initialize ${t} worker: ${o}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),Rh(()=>{r.removed=!0,OH(this._listeners,r),this._thread&&_(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this._transferLists[t],n=s?s(i):[];return this._thread.invoke(t,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(hi(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class Loe extends nTe{constructor(t=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(HR.forEach((t,i)=>{t===this&&HR.delete(i)}),this.destroy())}}const HR=new Map;function Ict(e=null){let t=HR.get(e);return t||(_(e)?(t=new Loe(i=>e.schedule(i)),HR.set(e,t)):(t=new Loe,HR.set(null,t))),++t.ref,t}function xg(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function oTe(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function $ct(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Dct(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:xg,clone:oTe,fromValues:$ct,createView:Dct},Symbol.toStringTag,{value:"Module"}));var Noe,Xl,Foe,Uoe,koe;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(Noe||(Noe={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(Xl||(Xl={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(Foe||(Foe={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(Uoe||(Uoe={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(koe||(koe={}));class Lct{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class Twt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function Swt(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class Ewt{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function Nct(e,t,i,r,s,n){const o=t[r++];for(let a=0;a<o;a++){const l=new Lct(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];const c=t[r++];for(let f=0;f<c;f++){const m=t[r++],y=t[r++],v=t[r++],w=t[r++],b=!!t[r++],S=t[r++],T=i[r++],E=i[r++],C=t[r++],O=t[r++];l.colliders.push({xTile:m,yTile:y,dxPixels:v,dyPixels:w,hard:b,partIndex:S,width:C,height:O,minLod:T,maxLod:E})}const h=e[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[r++],e[r++]]);const p=e[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[r++],e[r++]]);s.push(l)}return r}function Cwt(e,t,i){for(const[r,s]of e.symbols)Fct(e,t,i,s,r)}function Fct(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===Xl.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class kU{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return A(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){A(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class Uct extends kU{constructor(t,i){super(t,i),this.type=Xl.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){_(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),_(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),_(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=ii.createVertex(t,bi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=ii.createIndex(t,bi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Ns(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class kct extends kU{constructor(t,i){super(t,i),this.type=Xl.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){_(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),_(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),_(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,_(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),_(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),_(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=ii.createVertex(t,bi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=ii.createIndex(t,bi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=ii.createVertex(t,bi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=ii.createIndex(t,bi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new Ns(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Ns(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class zct extends kU{constructor(t,i,r){super(t,i),this.type=Xl.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],v=s[a++];this.iconPerPageElementsMap.set(m,[y,v])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],v=s[a++];this.glyphPerPageElementsMap.set(m,[y,v])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=Nct(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){_(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),_(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),_(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),_(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,_(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),_(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),_(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),_(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=ii.createVertex(t,bi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=ii.createIndex(t,bi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=ii.createVertex(t,bi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=ii.createIndex(t,bi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=ii.createVertex(t,bi.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=ii.createVertex(t,bi.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new Ns(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Ns(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class Bct extends kU{constructor(t,i){super(t,i),this.type=Xl.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){_(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),_(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),_(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=ii.createVertex(t,bi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=ii.createIndex(t,bi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Ns(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const Awt=!0,Rwt=32,zoe=200,Vct=1/he("mapview-transitions-duration");class Gct extends Kr{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return A(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=ip(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=ip(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*Vct;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class cf{constructor(t,i,r,s){this.set(t,i,r,s)}static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new cf(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new cf(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new cf(t,i,r,s),new cf(t,i,r+1,s),new cf(t,i+1,r,s),new cf(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}cf.pool=new vs(cf,null,null,25,50);class jct extends Gct{constructor(t,i,r,s,n,o=s,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new cf(t),this.x=i,this.y=r,this.width=s,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,i){const r=i/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,o]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;oY(s,a,0,0,0,l,0,n,o,1),D5(this.transforms.dvs,t.displayViewMat3,s)}}class qR extends jct{constructor(t,i,r,s,n,o,a=null){super(t,i,r,s,n,4096,4096),this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<zoe}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<zoe)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Xl.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(aTe.delete(this),qR._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Xl.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===Xl.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,i){super.setTransform(t,i);const r=i/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*r,n=this.height/this.rangeY*r,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;aY(a),sF(a,a,o),lY(a,a,Math.PI*t.rotation/180),cY(a,a,[s,n,1])}_createTransforms(){return{dvs:xg(),tileMat3:xg(),tileUnitsToPixels:xg()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case Xl.FILL:r=new kct(t,this.styleRepository);break;case Xl.LINE:r=new Uct(t,this.styleRepository);break;case Xl.SYMBOL:r=new zct(t,this.styleRepository,this);break;case Xl.CIRCLE:r=new Bct(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const aTe=new Map;function Hct(){aTe.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const Owt={value:.5,readOnly:!0},qct={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class FZ{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class Wct{constructor(t,i,r){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i;const s=r.noDataValue,n=r.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let h=0;h<n.length;h++){const p=n[h];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:s,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(i[2]-i[0]),dy:(r.width-1)/(i[3]-i[1]),x0:i[0],y1:i[3]},this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,h=this.samplerData.pixelData,p=.5*CO;let f=(c-1)/o,m=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const v=Math.floor(m),w=Math.floor(y),b=v+w*c,S=h[b],T=h[b+1],E=h[b+c],C=h[b+c+1];if(S+T+E+C<p){const O=m-v,I=y-w,N=dP(S,T,E,C,O,I),D=dP(S,T,E,C,O+f,I),z=dP(S,T,E,C,O,I+f),B=dP(S,T,E,C,O+f,I+f);return s.min=Math.min(N,D,z,B),s.max=Math.max(N,D,z,B),s}m=v,y=w,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let v=m;v<=m+f;v++)for(let w=y;w<=y+f;w++){const b=h[v+w*c];b<p?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}function lTe(e,t,i){if(A(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=De(r.dy*(r.y1-t),0,s),o=De(r.dx*(e-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.width,h=a*c+l,p=r.pixelData,f=p[h],m=p[h+1],y=h+c,v=p[y],w=p[y+1];if(f+v+m+w<.5*CO){n-=a,o-=l;const b=f+(m-f)*o;return b+(v+(w-v)*o-b)*n}}return null}function gr(e,t,i){const r=lTe(e,t,i);return _(r)?r:0}let eh=class extends Ee{constructor(e){super(e),this._handles=new Ht}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=cTe(i.fullExtent,this.viewSpatialReference);_(r)&&e.push(mhe(r))}}),e}};function Xct(e,t){return e===Ve.Global?new Wj(t):new Xj(t)}u([d({readOnly:!0})],eh.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],eh.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],eh.prototype,"stencilEnabledExtents",null),u([d()],eh.prototype,"viewSpatialReference",void 0),u([d()],eh.prototype,"tilingScheme",void 0),u([d()],eh.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],eh.prototype,"layers",void 0),u([d({constructOnly:!0})],eh.prototype,"layerViews",void 0),eh=u([P("esri.views.3d.terrain.ExtentHelper")],eh);let Wj=class extends eh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?nve:A9e}};Wj=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],Wj);let Xj=class extends eh{_computeLayerViewsExtent(){const e=vu(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=cTe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);bb(e,o,e)}});const i=tV(e)?e:null,r=this._get("layerViewsExtent");return wb(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=vu();this.layers.forEach(n=>{if(n.loaded&&_R(n)){const o=UU(n,t,Ve.Local);if(A(o))return;const{tileInfo:a,fullExtent:l}=o;_(a)&&_(l)&&(HF(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&bb(i,l,i)}}),bb(i,this.defaultTiledLayersExtent,i);const r=tV(i)?i:null,s=this._get("tiledLayersExtent");return wb(r,s)?s:r}};function cTe(e,t){return _(e)&&!e.spatialReference.equals(t)?Ipe(e,e.spatialReference,t):e}Xj=u([P("esri.views.3d.terrain.ExtentHelperLocal")],Xj);var Wt;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Wt||(Wt={}));const O1=[Wt.ELEVATION,Wt.MAP];function uTe(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const i=Object.keys(e);for(const r of i)r.search(".glsl")!==-1&&delete e[r]}}const Yct=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let My,Za=class extends Ee{constructor(e){super(e),this._handles=new Ht,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=he("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Gi.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return _(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?wi(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new vd({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=Lh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ae(()=>{var t,i,r;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(r=(i=e.pointsOfInterest)==null?void 0:i.centerOnSurfaceFrequent)==null?void 0:r.location]},()=>this.setPlacementDirty()),ae(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),Vi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),Lb({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,Ms.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(yt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,Ms.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Ms.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),_(My)&&(My.hide(),My=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;_(e)&&_(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Cv(-20037508342787e-6,20037508342787e-6):new Cv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,tf)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&_(e.setDrapingExtent)&&_(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,Ms.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const i=cet(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,pm);const r=ru(pm.inner)/ru(pm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(Pr.INNER,pm.inner,i,1*pm.pixelRatioAdjustment,pm.mapUnitsPerPixel),n=this._updateOverlay(Pr.OUTER,pm.outer,i,r*pm.pixelRatioAdjustment,pm.mapUnitsPerPixel);s!==sf.EXTENT&&n!==sf.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===sf.NONE&&n===sf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return sf.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,Zct(t,n.extent)&&i===n.resolution)return o===s?sf.NONE:sf.RERENDER_ONLY;Mg(n.extent,t),n.resolution=i;const a=yq(n.extent);return n.renderLocalOrigin=kR(a[0],a[1],0,"OV_"+this._latestOriginId++),sf.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[Pr.INNER],r=this.renderer.overlays[Pr.OUTER],s=X$(e.extent,this.surface.extent,Boe);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,Pr.INNER,t),this._setTileOverlayData(s,Pr.OUTER,t)):(this._clearTileOverlayData(Pr.INNER,t),this._clearTileOverlayData(Pr.OUTER,t))}else this._clearTileOverlayData(Pr.INNER,t),this._clearTileOverlayData(Pr.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[Pr.INNER],i=this.renderer.overlays[Pr.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=ru(r),n=np(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,ru(e)/s,np(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){uTe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||_(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Jct,t,i);if(A(s))return!1;const n=s.origin,o=de(l$,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=De(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=l$;sE(W4(X4,wi(this.view.spatialReference).radius+a),wu(e.eye,e.viewForward),c),pe(c,c,e.eye);const h=Av.normalize(S$e(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=gi(0,h,1,0),f=lu(p,p,e.projectionMatrix)[1],m=De(.5+.5*f,0,1);i=m===1||m===0?.5:l?m*r:1-(1-m)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&cq(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=M();this._findHorizonBasedPointOfInterest(e,s)||se(s,r);const n=Math.max(.1,or(e.eye,s)),o=Fv(this.view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);Gi.OVERLAY_SHOW_CENTER?(A(My)&&(My=new g0(this.view.graphics,"red")),My.show(s,this._renderSR)):_(My)&&My.hide(),this._overlaySREqualsRenderSR||Ks(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&_(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&_(this._spatialReference)?1/wi(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*h;i.mapUnitsPerPixel=p/this._worldToPCSRatio;let f=t*p/2,m=!1,y=c?90:1/0;this._isSpherical&&_(l)&&_(this._spatialReference)&&(this._spatialReference.isWebMercator?(f/=Math.cos(tN(s[1])),y=l[3]):(m=!0,f/=wi(this._spatialReference).metersPerDegree,y=90),f>=y&&(f=y,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;m&&(v=1/Math.max(.2,Math.cos(Math.abs($t(s[1])))),f*v>180&&(v=180/f),i.mapUnitsPerPixel*=v);const w=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/w)*w);const b=f*v,S=32,T=.5*t/(S*b),E=.5*t/(S*f);s[0]=Math.round(s[0]*T)/T,s[1]=Math.round(s[1]*E)/E;const C=i.inner;C[0]=s[0]-b,C[1]=s[1]-f,C[2]=s[0]+b,C[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,y);const O=i.outer;if(6*b>ru(l))Mg(O,l);else if(a<=.25*Math.PI)O[0]=C[0]-b,O[1]=C[1]-f,O[2]=C[2]+b,O[3]=C[3]+f;else{Ks(e.eye,this._renderSR,l$,this._spatialReference),df(z_,s,l$);let N=-Math.atan2(z_[1],z_[0])+.125*Math.PI;N<0&&(N+=2*Math.PI);const D=Math.floor(N/(.25*Math.PI));IM(z_,Yct[D],2*f),z_[0]*=v,z_[2]*=v,hq(O,C,z_)}if(this._isSpherical)O[0]=this._longitudeCyclical.clamp(O[0]),O[2]=this._longitudeCyclical.clamp(O[2]),O[1]=Math.max(O[1],-y),O[3]=Math.min(O[3],y);else{const N=X$(C,l,Boe),D=X$(O,l,Qct);sJ(N,D)&&(O[2]=O[0],O[3]=O[1])}const I=Math.abs(C[2]-C[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,I),i.pixelRatioAdjustment=i.mapUnitsPerPixel/I}_drawOverlayTextures(e,t,i=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Pr.INNER],i),n=this._drawOverlay(e[Pr.OUTER],i);s!==w2.CHANGED&&n!==w2.CHANGED||this.surface.updateTileOverlayParams(Ms.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),r?(this.surface.requestRender(t),t===Ms.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Ms.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!A(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):$M(e,t))}_rectInsideRect(e,t){return!A(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:sJ(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),cN(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function Zct(e,t){const r=Gi.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([d()],Za.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],Za.prototype,"running",null),u([d()],Za.prototype,"_placementDirty",void 0),u([d()],Za.prototype,"_contentUpdated",void 0),u([d()],Za.prototype,"_isSpherical",null),u([d()],Za.prototype,"_worldToPCSRatio",null),u([d()],Za.prototype,"renderer",void 0),u([d({constructOnly:!0})],Za.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"surface.suspended"})],Za.prototype,"suspended",void 0),u([d({readOnly:!0})],Za.prototype,"updating",null),u([d({type:Boolean})],Za.prototype,"hasHighlights",null),u([d({type:Boolean})],Za.prototype,"rendersOccluded",null),Za=u([P("esri.views.3d.terrain.OverlayManager")],Za);const z_=Gt(),l$=M(),pm={inner:Dt(),outer:Dt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Boe=Dt(),Qct=Dt(),Jct=Qn();var sf;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(sf||(sf={}));class mM{constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!mM.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(mM.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new Vt({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}mM.test={disabled:!1};class Kct{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=ur(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=Gt(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class Voe{constructor(t,i,r,s,n){this._buf=t,this._localOrigin=i,this.offset0=r,this.stride=s,this.count=n}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t,i){const r=this.getVertexOffset(i)*ih;t[0]=this._buf[r+0]+this._localOrigin[0],t[1]=this._buf[r+1]+this._localOrigin[1],t[2]=this._buf[r+2]+this._localOrigin[2]}getVertexZ(t){const i=this.getVertexOffset(t)*ih;return this._buf[i+2]+this._localOrigin[2]}setVertex(t,i,r,s){const n=this.getVertexOffset(t)*ih;this._buf[n+0]=i[0]-this._localOrigin[0],this._buf[n+1]=i[1]-this._localOrigin[1],this._buf[n+2]=i[2]-this._localOrigin[2],this._buf[n+3]=r,this._buf[n+4]=s}getNormal(t,i){const r=this.getVertexOffset(i)*ih;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}setVertexRawXYZUV(t,i,r,s,n,o){const a=this.getVertexOffset(t)*ih;this._buf[a+0]=i,this._buf[a+1]=r,this._buf[a+2]=s,this._buf[a+3]=n,this._buf[a+4]=o}setVertexRawXYZUVN(t,i,r,s,n,o,a,l,c){const h=this.getVertexOffset(t)*ih;this._buf[h+0]=i,this._buf[h+1]=r,this._buf[h+2]=s,this._buf[h+3]=n,this._buf[h+4]=o,this._buf[h+5]=a,this._buf[h+6]=l,this._buf[h+7]=c}setVertexRawNormal(t,i,r,s){const n=this.getVertexOffset(t)*ih;this._buf[n+5]=i,this._buf[n+6]=r,this._buf[n+7]=s}getVertexRawNormal(t,i){const r=this.getVertexOffset(i)*ih;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}}const eut=es().vec3f(R.POSITION).vec2f(R.UV0).vec3f(R.NORMAL),UZ=new mM(e=>eut.createBuffer(e),e=>e.count);function tut(){UZ.clear()}function hTe(e){return UZ.acquire(e)}function iut(e){UZ.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class rut{constructor(){this.sinLonLUT=new Array($7+1),this.cosLonLUT=new Array($7+1)}update(t,i){const r=i[0],s=i[2];for(let n=0;n<=t;n++){const o=n/t,a=r*(1-o)+s*o;this.sinLonLUT[n]=Math.sin(a),this.cosLonLUT[n]=Math.cos(a)}}}class c${constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class sut{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new c$,new c$,new c$,new c$],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class nut{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new sut}}class AS{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=at(this._current),this._next=at(this._next),this._waiting=at(this._waiting),this._delayed=at(this._delayed)}get current(){if(A(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=AS.test.fadeMoment;if(_(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,Tg.Immediate),this._delayed=null)),_(this._next)){t=t||performance.now();const i=this._fadeDuration,r=_(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==Rn.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(at(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(A(this._next))return 1;const t=AS.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return _(this._next)||_(this._delayed)}push(t,i=Tg.Immediate){this._delayed=at(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),A(this._current))return void(this._current=t);const r=AS.test.fadeMoment||performance.now();return i!==Tg.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):A(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(A(t)||(at(this._waiting),this._waiting=t))}get _fadeDuration(){return A(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Tg;AS.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Tg||(Tg={}));class dTe{constructor(){this._queue=new Vt,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),_(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class out{constructor(){this.q=new Vt}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!A(t)){this.q.pushArray(t);for(let i=0;i<this.q.length;++i){const r=this.q.data[i];r.isLeaf||this.q.pushArray(r.children)}}}next(){return this.q.pop()}}function WR(e,t,i){if(A(t)||A(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function pTe(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function fTe(e,t){t.sort((i,r)=>mTe(i,r,e))}function mTe(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:pTe(e,t)}function aut(e,t){const i=new Map;e.forAll(r=>i.set(r.lij,r.distanceToSquared(t))),e.sort((r,s)=>i.get(r.lij)-i.get(s.lij)||pTe(r,s))}function lut(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function cut(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i&&n.loadable)return!0}}return!1}function Mwt(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class kZ{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,Rn.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return _(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=jj(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?WR:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=_(m)?m.tile.level:-1,v=!!_(m)&&y-p>=a,w=Tr(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const b=h.level,S=p-b,T=h.layerInfo[i][t];if(T.data&&S>=a){(!v||b>y)&&this._setUpsampleTile(h),T.dataInvalidated&&(f=h);break}if((A(w)||w.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&b<=o&&!T.data&&!T.dataMissing&&((A(f)||h.level===n||b%sve==0||p-f.level<a)&&(f=h),S>=l))break;h=h.parent}return _(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,Rn.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class uut extends kZ{get _desiredMinLevelDelta(){throw Goe}get _progressiveLevelModulo(){throw Goe}dispose(){}}const Goe=new Error("Abstract method called on TileAgent"),Ol=new uut;class gTe extends kZ{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return GD(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class yTe extends kZ{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return sve}}var $b,yw;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})($b||($b={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(yw||(yw={}));var joe,Le;(function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"})(joe||(joe={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(Le||(Le={}));const wL={normal:Le.Normal,average:Le.Average,lighten:Le.Lighten,lighter:Le.Lighter,screen:Le.Screen,plus:Le.Plus,"color-dodge":Le.ColorDodge,darken:Le.Darken,multiply:Le.Multiply,"color-burn":Le.ColorBurn,overlay:Le.Overlay,"soft-light":Le.SoftLight,"hard-light":Le.HardLight,"vivid-light":Le.VividLight,hue:Le.Hue,saturation:Le.Saturation,luminosity:Le.Luminosity,color:Le.Color,difference:Le.Difference,exclusion:Le.Exclusion,minus:Le.Minus,invert:Le.Invert,reflect:Le.Reflect,"destination-over":Le.DestinationOver,"destination-atop":Le.DestinationAtop,"destination-in":Le.DestinationIn,"destination-out":Le.DestinationOut,"source-atop":Le.SourceAtop,"source-in":Le.SourceIn,"source-out":Le.SourceOut,xor:Le.Xor};function hut(e){return e===Le.DestinationOver||e===Le.DestinationAtop||e===Le.DestinationIn||e===Le.DestinationOut||e===Le.SourceAtop||e===Le.SourceIn||e===Le.SourceOut||e===Le.Xor}function dut(e){e.fragment.uniforms.add([new zt("u_colormap",t=>t.u_colormap),new We("u_colormapOffset",t=>t.colormap.u_colormapOffset),new We("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new We("u_opacity",t=>t.common.u_opacity)]),e.fragment.code.add(x`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}function put(e){e.fragment.uniforms.add(new zt("u_transformGrid",t=>t.u_transformGrid)),e.fragment.uniforms.add(new fi("u_transformSpacing",t=>t.common.u_transformSpacing)),e.fragment.uniforms.add(new fi("u_transformGridSize",t=>t.common.u_transformGridSize)),e.fragment.uniforms.add(new fi("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(x`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class vTe extends Us{constructor(){super(...arguments),this.scale=1,this.offset=Mh}}function _Te(e){e.attributes.add(R.POSITION,"vec2"),e.attributes.add(R.UV0,"vec2"),e.vertex.uniforms.add(new We("scale",t=>t.scale)),e.vertex.uniforms.add(new fi("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(x`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class fut extends vTe{constructor(t,i,r){super(),this.common=t,this.u_image=i,this.u_transformGrid=r}}function mut(e){e.include(put),e.fragment.uniforms.add([new zt("u_image",t=>t.u_image),new ew("u_flipY",t=>t.common.u_flipY),new ew("u_applyTransform",t=>t.common.u_applyTransform)]),e.fragment.code.add(x`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function zZ(e){e.code.add(x`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.float(257)};
      if(pos < 0.5 || pos > ${x.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}var Co;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(Co||(Co={}));function bTe(e,t){const i=t.blendMode;i!==Le.Normal&&(i===Le.Reflect&&e.code.add(x`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Le.ColorDodge&&i!==Le.VividLight||e.code.add(x`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Le.ColorBurn&&i!==Le.VividLight||e.code.add(x`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Le.Overlay&&e.code.add(x`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Le.HardLight&&e.code.add(x`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Le.SoftLight&&e.code.add(x`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Le.VividLight&&e.code.add(x`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Le.Hue&&i!==Le.Saturation&&i!==Le.Color&&i!==Le.Luminosity||(e.code.add(x`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Le.Hue&&i!==Le.Saturation||e.code.add(x`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(x`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Le.Multiply?x`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Average?x`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Lighten?x`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Darken?x`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Lighter?x`return vec4(cl * ol + cb * ob, ol + ob);`:i===Le.Plus?x`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Le.Minus?x`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Le.Screen?x`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Difference?x`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Invert?x`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Le.DestinationOver?x`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Le.DestinationAtop?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Le.DestinationOut?x`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Le.SourceAtop?x`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Le.SourceOut?x`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Le.Xor?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Le.DestinationIn?x`return vec4(cb * ob * ol, ol * ob);`:i===Le.SourceIn?x`return vec4(cl * ol * ob, ol * ob);`:i===Le.Hue?x`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Saturation?x`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Color?x`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Luminosity?x`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Exclusion?x`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Reflect?x`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.ColorDodge?x`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.ColorBurn?x`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.Overlay?x`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.SoftLight?x`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.HardLight?x`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Le.VividLight?x`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:x``}
    }
  `))}var Kn,hn;function gut(e){const t=new Hi,i=e.output===Kn.GridOnly,r=e.output===Kn.GridComposite,s=r||i,n=e.output===Kn.ColorOnly,o=e.output===Kn.ColorComposite,a=o||n,l=r||o;if(t.include(_Te),a&&t.fragment.uniforms.add(new xt("backgroundColor",m=>m.backgroundColor)),e.baseOpacityMode!==hn.One&&t.fragment.uniforms.add(new We("baseOpacity",m=>m.baseOpacity)),s&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(zZ)),i||n)return t.fragment.code.add(x`
    void main() {
      gl_FragColor = ${n?x`vec4(backgroundColor, 1.0)`:x`gridColor(uv)`};
    }
  `),t;const c=e.blendMode!==Le.Normal,h=e.baseOpacityMode===hn.OnBaseLayer,p=e.baseOpacityMode===hn.OnBackground||e.baseOpacityMode===hn.OnBaseLayer,f=e.premultipliedSource;return t.fragment.uniforms.add(new zt("tex",m=>m.texture)),t.fragment.uniforms.add(new We("opacity",m=>m.opacity)),(c||h||f)&&(t.fragment.uniforms.add(new zt("fboColor",m=>m.fboTexture)),t.fragment.uniforms.add(new We("tileSize",m=>_(m.fboTexture)?m.fboTexture.descriptor.width:1))),t.fragment.include(bTe,e),t.fragment.code.add(x`
    void main() {
      ${l||h||f?x`
      vec4 bgColor = ${o?x`vec4(backgroundColor, 1.0)`:r?x`gridColor(uv)`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${p?x`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${c?x`
          vec4 fboTex = ${l?x`bgColor;`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${h?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:x`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${f?x`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:l||h?x`mix(bgColor, pmColorLayer, composeAlpha);`:x`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT"})(Kn||(Kn={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(hn||(hn={}));const yut=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return Kn},get BaseOpacityMode(){return hn},build:gut},Symbol.toStringTag,{value:"Module"}));class zU extends fut{constructor(t,i,r,s,n,o){super(t,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=Aa,this.fboTexture=null,this.baseOpacity=1}}class vut extends zU{}class _ut extends zU{}function but(e){const t=new Hi;t.include(_Te),t.include(mut),t.include(dut),e.tileBlendInput===Co.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(zZ));const i=e.tileBlendInput===Co.ColorComposite;i&&t.fragment.uniforms.add(new xt("backgroundColor",a=>a.backgroundColor)),e.baseOpacityMode!==hn.One&&t.fragment.uniforms.add(new We("baseOpacity",a=>a.baseOpacity));const r=e.baseOpacityMode===hn.OnBaseLayer,s=e.baseOpacityMode===hn.OnBackground||e.baseOpacityMode===hn.OnBaseLayer,n=e.blendMode!==Le.Normal;t.fragment.include(bTe,e);const o=e.tileBlendInput!==Co.LayerOnly;return(n&&!o||r)&&(t.fragment.uniforms.add(new zt("fboColor",a=>a.fboTexture)),t.fragment.uniforms.add(new We("tileSize",a=>_(a.fboTexture)?a.fboTexture.descriptor.width:1))),t.fragment.code.add(x`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${o||r?x`
          vec4 bgColor = ${r?x`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:i?x`vec4(backgroundColor, 1.0)`:x`gridColor(vuv)`};
          ${s?x`bgColor *= baseOpacity;`:""}`:""}
      ${n?x`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${o?x`bgColor;`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${r?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:o||r?x`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:x`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===$b.Stretch?xut(t,e):e.colorizerType===$b.Lut?wut(t):e.colorizerType===$b.Hillshade&&Tut(t,e),t}function wut(e){e.fragment.code.add(x`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function xut(e,t){e.fragment.uniforms.add([new m3("u_bandCount",r=>r.symbolizer.u_bandCount),new Ho("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Ho("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Ho("u_factor",r=>r.symbolizer.u_factor,3),new We("u_minOutput",r=>r.symbolizer.u_minOutput),new We("u_maxOutput",r=>r.symbolizer.u_maxOutput),new ew("u_useGamma",r=>r.symbolizer.u_useGamma),new Ho("u_gamma",r=>r.symbolizer.u_gamma,3),new Ho("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new We("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(x`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(x`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===yw.Noop?x`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:x`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Tut(e,t){const i=e.fragment;i.uniforms.add([new zt("u_image",s=>s.u_image),new m3("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Ho("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Ho("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Ho("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Ho("u_weights",s=>s.symbolizer.u_weights,6),new fi("u_factor",s=>s.symbolizer.u_factor),new We("u_minValue",s=>s.symbolizer.u_minValue),new We("u_maxValue",s=>s.symbolizer.u_maxValue),new fi("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(Yf),i.code.add(x`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),i.code.add(x`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(x`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Sut=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:zU,ColorizerStretchUniforms:vut,ColorizerHillshadeUniforms:_ut,build:but},Symbol.toStringTag,{value:"Module"}));function Eut(e,t,i="nearest",r=!1){var c;const s=!(r&&t.pixelType==="u8"),n=s?St.FLOAT:St.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===ui.WEBGL2&&s?mt.RGBA32F:ze.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?Je.NEAREST:Je.LINEAR,dataType:n,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1};return new st(e,l,o)}function Cut(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=t,a=i[0]>1,l={width:a?4*n:n,height:o,target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:e.type===ui.WEBGL2?mt.RGBA32F:ze.RGBA,dataType:St.FLOAT,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new st(e,l,c)}function Hoe(e,t){const i={width:t.length/4,height:1,target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,flipped:!1};return new st(e,i,t)}function Aut(e,t,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:Mh,u_transformGridSize:e?e.size:Mh,u_targetImageSize:t,u_srcImageSize:i}}function Rut(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function Out(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function Mut(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const qoe={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class Put{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=Xe(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?ve(F({},qoe),{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||qoe}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){_(t)&&t.length>0?this._bandIds&&t.every((i,r)=>!!this._bandIds[r]&&i===this._bandIds[r])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,_(this._rasterTexture)){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?Je.LINEAR:Je.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=Xe(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((A(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),_(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&A(this._transformGridTexture)&&(this._transformGridTexture=Cut(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:i,width:r,height:s,opacity:n}=this,o=Aut(i,[r,s],[this.source.width,this.source.height],n),a=Rut(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Out(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Mut(this.symbolizerParameters):null;return new zU(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(A(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(i=>_(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=Xe(this._rasterTexture),this._transformGridTexture=Xe(this._transformGridTexture),this._colormapTexture=Xe(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=Xe(this._rasterTexture));const s=A(i)&&A(this.bandIds)||_(i)&&_(this.bandIds)&&i.join("")===this.bandIds.join("");if(_(this._rasterTexture)&&s)return;this._rasterTexture=Xe(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Eut(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=Xe(this._colormapTexture),this._colormapTexture=Hoe(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=Hoe(t,r),void(this._colormap=r)):(this._colormapTexture=Xe(this._colormapTexture),void(this._colormap=null))}}class xL{constructor(){this.waitingAgents=new Vt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=DB.acquire();return i._init(t),i}release(){this.dispose(),TL.delete(this),DB.release(this)}dispose(){this.loadingAgent=Xe(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=CS(this._data)}static prune(){DB.prune(0)}_init(t){this.waitingAgents.clear(),this._data=CS(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Ah(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){_(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||A(i))this._unsetUpsampleInfo();else{if(A(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),lut(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){CS(this._data),this._data=t}}const DB=new vs(xL,null,()=>{}),TL=new Map;function Iut(){TL.size>0&&(console.log(`${TL.size} live TilePerLayerInfo allocations:`),TL.forEach(e=>console.log(e,`
`)))}class CT{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var _t;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(_t||(_t={}));const LB=M(),Cx=M(),Ln=M(),$ut=.1;class Dut{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class BZ{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=Dt(),this._elevationBounds=tt(),this.layerInfo=[[],[]],this.extentInRadians=Dt(),this.centerAtSeaLevel=M(),this._center=[M(),mn(),M()],this.up=aq(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){VZ.prune(0),GZ.prune(0),xL.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[va.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===U2.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=wi(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[va.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?ro(this._elevationBounds,i.elevationBounds):pi(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of O1){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=xL.acquire(this._surface.upsampleInfoPool),s===Wt.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,$7)}release(){af(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of O1){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const t=this.cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Wt.MAP].reduce((t,i)=>t+(i instanceof qR?i.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(_(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let t=0;for(const{data:r}of this.layerInfo[Wt.MAP])r instanceof qR?t+=this._getTerrainDataMemory(r):this._mapTileMemory+=this._getTerrainDataMemory(r);const i=this.cpuImageMemorySize;for(const r of this.layerInfo[Wt.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=Kb(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+t),this._usedMemory}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];return(r==null?void 0:r.data)?t===Wt.MAP?this.isCached?0:this._getTerrainDataMemory(r.data):t===Wt.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof CT?Kb(t.texture):t instanceof HTMLImageElement||t instanceof NU?this.cpuImageMemorySize:t instanceof qR||t instanceof Put?t.memoryUsage:0}updateScreenDepth(t){const i=this._center[va.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this._screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(_(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return _t.NONE;const s=this.level;pe(LB,this._center[va.MIDDLE],i);let n=Sa(LB),o=va.MIDDLE;pe(Cx,this._center[va.TOP],i);const a=Sa(Cx);a<n&&(n=a,o=va.TOP),pe(Cx,this._center[va.BOTTOM],i);const l=Sa(Cx);if(l<n&&(n=l,o=va.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return _t.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const w=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return w!==this.vlevel?(this.vlevel=w,_t.VSPLITMERGE):_t.NONE_HIT_MAXLOD};if(r===U2.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?f():_t.SPLIT;const m=xe(this.up,LB),y=this._elevationBounds[1]-this._elevationBounds[0],v=y/this.edgeLen;if(t.aboveGround&&m>0&&v<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-v>0)return _t.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,_t.VSPLITMERGE):_t.NONE;if(s>=t.maxLod)return f();if(s>6){pe(Cx,this._center[o],i),oe(Ln,this.up,m),pe(Ln,Ln,Cx);const w=Sa(Ln);if(w>this.radius*this.radius){oe(Ln,Ln,this.radius/Math.sqrt(w)),de(Ln,Ln,this._center[o]),pe(Ln,i,Ln);const b=Math.min(1,(Math.abs(xe(Ln,this.up))+.5*y+this._curvatureHeight)/Oe(Ln)),S=$ut/t.angledSplitBias,T=t.fovY*c*2;if(b*(this._edgeLen/T)<S*t.relativeHeightLimit)return _t.NONE}}return _t.SPLIT}setChildren(t,i,r,s){af(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,i;return(i=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?i:!1}prepareToLoad(t){this.refMapData();for(const i of O1)this._createOrUpdateAgents(0,i);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const i of O1){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==Ol&&(u$(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(_t.GEOMETRY),this.resetPendingUpdate(_t.TEXTURE_NOFADING),this.resetPendingUpdate(_t.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[Wt.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==Ol&&(u$(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(wb(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;_(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(_t.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of O1){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Ol&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(_t.SPLIT)||t!==Wt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===_t.SPLIT||t===_t.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;Ah(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return Sa(pe(Ln,this._center[va.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;af(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i){switch(t){case Wt.MAP:return this._updateTexture(i);case Wt.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===Rn.FADING?_t.TEXTURE_NOFADING:_t.TEXTURE_FADING),this.setPendingUpdate(t===Rn.FADING?_t.TEXTURE_FADING:_t.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(_t.GEOMETRY);for(const t of this.layerInfo[Wt.ELEVATION])t.pendingUpdates|=_t.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const t=this._elevationBounds;pi(t,Number.MAX_VALUE,-Number.MAX_VALUE);const i=this.layerInfo[Wt.ELEVATION];let r=!0;for(const s of i)_(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(r=!1));r&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,i=.5*(t[0]+t[1]);oe(Ln,this.up,i),de(this._center[va.MIDDLE],this.centerAtSeaLevel,Ln),oe(Ln,this.up,t[0]),de(this._center[va.TOP],this.centerAtSeaLevel,Ln),oe(Ln,this.up,t[1]),de(this._center[va.BOTTOM],this.centerAtSeaLevel,Ln)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[Wt.ELEVATION][t];if(_(r.elevationBounds)&&r.elevationBounds.level>=i)return;const s=this._surface.layerViewByIndex(t,Wt.ELEVATION),n=jj(s);if(!WR(this,n,!1))return;const o=Nut;let a=!1;if(r.data){const l=r.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,h=0;for(let p=this._parent;p&&(!c||h<GD(this.level))&&(h=this.vlevel-p.level,l=c||l,c=p.layerInfo[Wt.ELEVATION][t].data,!(!c&&l&&h>=GD(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(A(r.elevationBounds)&&(r.elevationBounds=new FZ),r.elevationBounds.copyFrom(o))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==Ol&&(u$(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:xL.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,Rn.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===Ol&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of O1){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==Ol&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Ol&&this.updateRenderData(t,Rn.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==Ol&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=Ol,!r.data&&A(r.upsampleInfo)&&this._createOrUpdateAgents(t+1,i)}_createOrUpdateAgents(t,i){const r=this.layerInfo[i];if(r.length===0)return;const s=(()=>{for(let o=t;o<r.length;++o){const a=this._surface.layerViewByIndex(o,i);if(qF(a)&&a.layer.blendMode!=="normal")return!0}return!1})(),n=this._isSuspended(i);for(let o=t;o<r.length;++o){const a=r[o];let l=!1;const c=this._surface.layerViewByIndex(o,i),h=jj(c);if(a.loadingAgent?WR(this,h,!1)?(a.loadingAgent!==Ol&&a.loadingAgent.setSuspension(n),a.loadingAgent!==Ol&&(l=a.loadingAgent.update())):a.dispose():WR(this,h,!1)&&(a.loadingAgent=Lut(this,o,i,n),l=a.loadingAgent.startLoading(),l?a.loadingAgent===Ol&&this.setPendingUpdate(_t.GEOMETRY):(u$(a.loadingAgent),a.loadingAgent=Ol)),a.loadingAgent===Ol&&this.updateRenderData(i,Rn.FADING),!s&&l&&c.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationBasedVerticesPerSide(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,GD(this.level)-i);return De(1+(this.maxTesselation>>r),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,i){if(!t)return null;const r=this.surface.rootTiles;if(_(r)){for(const s of r)if(Fut(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){const r=this.lij,s=this.getNeighborLIJ(r,t);return s?Uut(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){const r=t===Nt.NORTH_EAST?1:t===Nt.NORTH_WEST?0:t===Nt.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||i&&i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){var r;return(r=this.findNeighborTile(t,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(WF(t),i)}forAllSubtreeOnSide(t,i){const r=t===Nt.NORTH?[0,1]:t===Nt.NORTH_EAST?[1]:t===Nt.EAST?[1,3]:t===Nt.SOUTH_EAST?[3]:t===Nt.SOUTH?[2,3]:t===Nt.SOUTH_WEST?[2]:t===Nt.WEST?[0,2]:[0],s=n=>{i(n)||n.isLeaf||r.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){XF.forEach(i=>this.findNeighborCornerTileExact(i,t)),k0.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||t(s)))==null?void 0:r.forAllSubtreeOnSide(bL(i),t)})}getNeighborEdgeStartVertexIndex(t,i){const r=i!=null?i:this.findNeighborTile(k0[t],h=>h.isLoaded);if(!r||!this.isLoaded||!r.isLoaded)return 0;const s=this.level-r.level;if(s===0)return 0;const n=2**s,o=(1&t)==1,a=o?0:1,l=r.lij[a+1]*n,c=this.lij[a+1]-l;return o?n-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const i=k0[t],r=this.findNeighborTile(i,s=>s.isLoaded||s.level===this.level);if(!r)continue;if(!r.isLoaded){r.isLeaf;const s=(t+2)%4,n=bL(i);r.forAllSubtreeOnSide(n,o=>o.isLoaded?(o.updateEdgeAfterResolutionChange(s),!0):(o.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this.forEachLoadedNeighbor(i=>this._updateNeighbor(i)),k0.forEach(i=>{var r;(r=this.findNeighborTile(i,s=>s.isLoaded&&s.level<t))==null||r.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}forEachLoadedNeighbor(t){const i=this.level,r=s=>s.level===i||s.isLoaded;k0.forEach((s,n)=>{var l,c;const o=this.findNeighborTile(s,r);o!=null&&o!==this&&o.forAllSubtreeOnSide(bL(s),h=>!!h.isLoaded&&(t(h),!0));const a=(c=(l=this.renderData)==null?void 0:l.geometryState)==null?void 0:c.neighborData;a&&(a.modifiedEdgeResolutions[n]=!1)}),XF.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(WF(s),a=>a.isLoaded);!n||kut(this,n,s),(n==null?void 0:n.isLoaded)&&t(n)})}_updateNeighbor(t){(t==null?void 0:t.isLoaded)&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,i){const r=Ioe(i)?-1:Poe(i)?1:0,s=Ooe(i)?-1:Moe(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Et>=this.surface.extent[1]}compareLIJs(t){const i=this.lij,r=i[0],s=t[0];if(r===s)return[i,t];const n=r-s;if(n<0){const o=2**-n;return[[s,i[1]*o,i[2]*o],t]}{const o=2**n;return[i,[r,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(Ioe(t)&&i[3]+s>=r[3]||Poe(t)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Ooe(t)&&i[0]-s<=r[0])&&!(!n&&Moe(t)&&i[2]+s>=r[2])}}function Lut(e,t,i,r){const s=i===Wt.ELEVATION?GZ.acquire():VZ.acquire();return s.init(e,t,i,r),s}function u$(e){e.dispose(),e instanceof gTe?GZ.release(e):e instanceof yTe&&VZ.release(e)}const VZ=new vs(yTe),GZ=new vs(gTe),Nut=new FZ;var va;function Fut(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function Uut(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function NB(e,t,i){return Math.abs(e-t)<=i}function kut(e,t,i){return!A(e)&&!A(t)&&t!==e&&(e.level>=t.level?Woe(e,t,i):Woe(t,e,WF(i)))}function Woe(e,t,i){e.level>=t.level;const r=hct(i),s=dct(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=NB(a[0],l[0],c)||e.surface.isGlobal&&NB(a[0],-l[0],c),p=NB(a[1],l[1],c);return h&&p?!0:e.level===t.level||!h&&!p?!1:h?Xoe(o[1],o[3],n[1],n[3],c):Xoe(o[0],o[2],n[0],n[2],c)}function Xoe(e,t,i,r,s=Et){return e-s<=i&&i<=r&&r<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(va||(va={}));class zut{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}class ug{constructor(){this.geometryInfo=new Kct,this.intersectionData=null,this.geometryState=null,this._textureRef=new AS(()=>this.tile.surface.textureFadeDuration),this.overlay=new zut,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(t){this._tile=t,this.clear();const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,ur(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new nut,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(t,i){const r=this.updateGeometryStateAndPrepareForGeometryGeneration(i);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(r,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,i=this.vao.context){const r=this._updateNeighborData(),s=t||this._geometryStateChangedSinceLastUpdate||r;return s&&(this._updateGeometry(i),this._geometryStateChangedSinceLastUpdate=!1),s}_calculateEdgeResolution(t,i){var c;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const h=r.surface.extent;if(_(h)&&(t===0&&r.extent[3]>h[3]||t===1&&r.extent[2]>h[2]||t===2&&r.extent[1]<h[1]||t===3&&r.extent[0]<h[0]))return s}const n=r.level,o=k0[t],a=i||r.findNeighborTile(o,h=>h.isLoaded||h.level===n);if(!a||a.isLeaf&&!a.isLoaded)return A((c=r.surface)==null?void 0:c.rootTiles)||r.surface.updatingRootTiles||r.shouldHaveNeighbor(o),s;if(a.isLoaded){const h=a,p=h.renderData.geometryState,f=n-h.level;if(f===0){const v=p.numVerticesPerSide-1;return Math.max(v,s)}const m=2**f,y=p.neighborData.edgeResolutions[(t+2)%4]/m;return Math.max(1,y)}a.isLeaf;let l=s;return a.forAllSubtreeOnSide(bL(o),h=>h===r||(h.isLoaded?(l=Math.max(l,2**(h.level-n)),!0):(h.isLeaf,!1))),l}_updateNeighborData(){const t=this.tile,i=c=>c.isLoaded||c.level===t.level,r=c=>c.isLoaded,s=[null,null,null,null],n=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const h=t.findNeighborTile(k0[c],i);s[c]=h,n[c]=(h==null?void 0:h.isLoaded)?h:null}})();const o=[null,null,null,null];(()=>{for(let c=0;c<4;++c)o[c]=t.findNeighborTile(XF[c],r)})();const a=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const h=a.edgeResolutions[c],p=s[c],f=this._calculateEdgeResolution(c,p);a.edgeResolutions[c]=f,h!==f&&(l=!0,this._edgeResolutionChanged=!0,p&&p!==t&&!p.isLoaded&&p.level===t.level&&(a.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=(f,m)=>{var b,S;const y=f.reduce((T,E)=>{var C;return Math.min(T,(C=E==null?void 0:E.level)!=null?C:1/0)},1/0);for(let T=0;T<4;++T){const E=f[(T+3)%4],C=f[T];if(E&&E.level<t.level&&E===C){const O=E,I=(1&T)==1,N=(t.getNeighborEdgeStartVertexIndex(T,O)+(m===0||m===1&&!I||m===3&&I?1:0))/2**(t.level-O.level),D=I?m===0||m===1?O.extent[0]:O.extent[2]:qt(O.extent[0],O.extent[2],N),z=I?qt(O.extent[1],O.extent[3],N):m===0||m===3?O.extent[1]:O.extent[3];return gr(D,z,O.renderData.geometryState.samplerData)}}let v=0,w=0;for(let T=0;T<4;++T){const E=f[T];if(E&&E.level===y){const C=T===0||T===1,O=T===0||T===3,I=E.extent;w+=gr(I[C?0:2],I[O?1:3],(S=(b=E.renderData)==null?void 0:b.geometryState)==null?void 0:S.samplerData),v++}}return v?w/v:0},h=a.cornerNeighborData,p=(f,m)=>{var b;const y=h[f],v=y.cornerTiles;for(let S=0;S<4;++S){const T=XF[S],E=(b=m[S])==null?void 0:b.findCorner(WF(T),C=>(C==null?void 0:C.isLoaded)||C===t);v[S]=E}const w=c(v,f);return y.elevation!==w&&(y.elevation=w,!0)};for(let f=0;f<4;++f){const m=o[f],y=n[f],v=[m,n[(f+1)%4],t,y],w=v.map((b,S)=>v[(S+4-f)%4]);p(f,w)&&(this._cornerElevationChanged=!0,l=!0)}})(),(()=>{var p;const c=(f,m)=>{if(!(f==null?void 0:f.isLoaded)||f.lij[0]>t.lij[0])return null;const y=f.renderData.geometryState;return{neighborSamplerData:y.samplerData,neighborEdgeOverlapResolution:y.neighborData.edgeResolutions[m+2],version:y.samplerDataVersion,neighborVerticesPerSide:y.numVerticesPerSide,neighborTile:f}},h=a.edgeNeighbours;for(let f=0;f<4;++f){const m=n[f];m&&(m==null||m.isLoaded,(m==null?void 0:m.lij[0])<=t.lij[0],void 0);const y=h[f],v=y==null?void 0:y.version,w=c(m,f),b=(p=w==null?void 0:w.version)!=null?p:null,S=y!=null!=(w!=null),T=y&&w&&v!==b,E=y&&w&&(y==null?void 0:y.neighborTile)!==(w==null?void 0:w.neighborTile),C=S||T||E;this._edgeNeighborChanged||(this._edgeNeighborChanged=C),l||(l=C),!C&&v||(h[f]=w)}})(),l}updateEdgeAfterResolutionChange(t){var n,o;const i=this._calculateEdgeResolution(t),r=this.geometryState.neighborData.edgeResolutions,s=r[t];((o=(n=this.geometryState.neighborData.edgeNeighbours[t])==null?void 0:n.neighborTile.level)!=null?o:0)<=this.tile.level,i!==s&&(r[t]=i,this._edgeResolutionChanged=!0,ug.deferTileNeighborUpdate?ug.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(t){this.intersectionData=null;const i=this.tile,r=i.lij,s=ug.updatedGeometryTiles.get(r)||0;ug.updatedGeometryTiles.set(r,s+1);const n=this._vao,o=this.geometryInfo.vertexAttributes,a=!n||!o||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,l=!a&&this._edgeNeighborChanged,c=!l&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,a?(this._releaseGeometry(),this._createGeometry(t)):l?i.updateEdgeElevations():c?i.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,i){return _(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),A(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){_(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const i=this._getElevationInfo(),r=i.samplerData?this.tile.getElevationBasedVerticesPerSide(i.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(r,5);let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;return o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),i.changed&&(this._samplerDataChanged=!0,o.samplerData=i.samplerData,o.samplerDataVersion++,a=!0),wv(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0),o.wireframe!==t&&(this._wireframeChanged=!0,o.wireframe=t,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),this._hasGeometry=!0,a}_createGeometry(t){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new Ns(t,Ni,{geometry:vc(i.layout)},{geometry:ii.createVertex(t,s.STATIC_DRAW,i.buffer)},ii.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,iut(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,i=Tg.Immediate){_(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[Wt.ELEVATION],r=i.length;let s=new Array(r),n=0,o=0,a=!1;for(let l=0;l<r;l++){const c=i[l];if(_(c.upsampleInfo)){const h=c.upsampleInfo.tile,p=h.layerInfo[Wt.ELEVATION][l].data,f=p&&p.samplerData;t&&t[n]===f||(a=!0),s[n++]=f,o=Math.max(o,h.lij[0])}else if(c.data){const h=this.tile.surface.layerViewByIndex(l,Wt.ELEVATION);if(WR(this.tile,h.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return _(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=Kc(this.intersectionData,0,i=>i.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return _(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}ug.updatedGeometryTiles=new Map,ug.deferTileNeighborUpdate=!1,ug.neighborTilesToUpdate=new Set;const But=65536;function Vut(e,t){const i=e.tile,{extent:r,extentInRadians:s,surface:n}=i,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shadingEnabled,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(t===ph.HAS_SOUTH_POLE||t===ph.HAS_BOTH_POLES),y=l&&(t===ph.HAS_NORTH_POLE||t===ph.HAS_BOTH_POLES),v=6,w=((m?1:0)+(y?1:0))*v*(p+1),b=a.neighborData,S=b.edgeResolutions.reduce((K,j)=>K+j+1,0),T=hTe(f+w+S),E=e.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=T,Xi(E.uvOffsetAndScale,0,0,1,1);const C=T.position.typedBuffer,O=T.uv0.typedBuffer,I=T.normal.typedBuffer,N=E.boundingBox;ur(N);const D=o[0],z=o[1],B=o[2];B_.update(p,s);let k=0;const Y=a.samplerData,Z=i.ellipsoid.radius,le=HZ(e),ne=h-2,$=r[0],U=r[2],V=r[1],q=r[3];(()=>{for(let K=1;K<=ne;K++){const j=K/p,ee=V*(1-j)+q*j,ge=le(j),Te=Math.cos(ge),Fe=Math.sin(ge);for(let _e=1;_e<=ne;_e++){const me=_e/p,Ce=$*(1-me)+U*me,Ne=B_.sinLonLUT[_e],Mi=B_.cosLonLUT[_e],Fi=Z+gr(Ce,ee,Y),si=Mi*Te*Fi-D,Ui=Ne*Te*Fi-z,li=Fe*Fi-B;Sg(si,Ui,li,N);const ki=ih*k;C[ki+0]=si,C[ki+1]=Ui,C[ki+2]=li,O[ki+0]=me,O[ki+1]=j,++k}}})(),c&&(()=>{const K=_e=>(pe(Eg,_e,FB),lt(V2,Eg,bv),lt(G2,V2,Eg),G2),j=T.position,ee=T.normal;k=0;const ge=_e=>{j.getVec(_e,rc),de(os,os,K(rc))},Te=(_e,me)=>{{const Ce=_e/p,Ne=$*(1-Ce)+U*Ce,Mi=B_.sinLonLUT[_e],Fi=B_.cosLonLUT[_e],si=me/p,Ui=V*(1-si)+q*si,li=le(si),ki=Math.cos(li),Ur=Math.sin(li),ts=Z+gr(Ne,Ui,Y);te(rc,Fi*ki*ts-D,Mi*ki*ts-z,Ur*ts-B)}de(os,os,K(rc))},Fe=(_e,me,Ce)=>{_e>1&&me>1&&_e<ne&&me<ne?ge(k+Ce):Te(_e,me)};for(let _e=1;_e<=ne;_e++)for(let me=1;me<=ne;me++)j.getVec(k,FB),de(ff,FB,e.localOrigin),we(bv,ff),te(os,0,0,0),Fe(me-1,_e,-1),Fe(me+1,_e,1),Fe(me,_e-1,-ne),Fe(me,_e+1,+ne),we(os,os),ee.setVec(k,os),++k})(),k=f,xTe(e,f),RTe(e),k=f+S;const W=[];(()=>{const K=(j,ee)=>{const ge=ee*h;Sg(-D,-z,j*Z-B,N),W.push({connectedRowOffset:ge,connectedOuterEdgeOffset:j===1?0:2,rowOffset:k,latitudeResolution:v});const Te=MTe(j===-1?V:q,Z),Fe=j*Math.PI/2-Te,_e=.99*(j===1?1:-1),me=Z+0;for(let Ce=1;Ce<=v;++Ce){const Ne=Te+Fe*(Ce/v),Mi=Math.cos(Ne),Fi=Math.sin(Ne);for(let si=0;si<=p;si++){const Ui=si/p,li=B_.sinLonLUT[si],ki=B_.cosLonLUT[si]*Mi*me-D,Ur=li*Mi*me-z,ts=Fi*me-B;Sg(ki,Ur,ts,N);const rt=ih*k;if(C[rt+0]=ki,C[rt+1]=Ur,C[rt+2]=ts,O[rt+0]=Ui,O[rt+1]=_e,c){const Er=1/Math.sqrt(ki*ki+Ur*Ur+ts*ts);I[rt+0]=Er*ki,I[rt+1]=Er*Ur,I[rt+2]=Er*ts}++k}}};m&&K(-1,0),y&&K(1,p)})(),wTe(E,a.numVerticesPerSide,W,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null;for(let K=0;K<4;++K)E.outerEdges[K].count,b.edgeResolutions[K]+1}function Gut(e,t){const i=e.tile,r=i.extent,s=e.localOrigin,n=e.geometryState,o=i.surface,a=o.isWebMercatorOnPlateeCarree,l=o.shadingEnabled,c=r[0],h=r[1],p=r[2]-c,f=r[3]-h,m=n.clippingArea,y=_(m)?Math.max(0,(m[0]-r[0])/p):0,v=_(m)?Math.max(0,(m[1]-r[1])/f):0,w=_(m)?Math.min(1,(m[2]-r[0])/p):1,b=_(m)?Math.min(1,(m[3]-r[1])/f):1,S=w-y,T=b-v,E=S>0?1/S:1,C=T>0?1/T:1,O=-y*E,I=-v*C,N=n.numVerticesPerSide,D=N-1,z=(N-2)**2+n.neighborData.edgeResolutions.reduce((Te,Fe)=>Te+Fe+1,0),B=hTe(z),k=B.position.typedBuffer,Y=B.uv0.typedBuffer,Z=B.normal.typedBuffer,le=e.geometryInfo,ne=le.boundingBox;ur(ne);let $=0;const U=i.ellipsoid.radius,V=n.samplerData,q=_(m)?m:DTe,W=gq(Math.max(r[0],q[0]),Math.max(r[1],q[1]),Math.min(r[2],q[2]),Math.min(r[3],q[3])),K=s[0],j=s[1],ee=s[2],ge=_3(a,U,t);(()=>{for(let Te=1;Te<=D-1;Te++){const Fe=Te/D,_e=I+Fe*C,me=De(h+Fe*f,W[1],W[3]),Ce=De(_e,0,1),Ne=ge(me)-j,Mi=p/D;for(let Fi=1;Fi<=D-1;Fi++){const si=Fi/D,Ui=O+si*E,li=De(c+si*p,W[0],W[2]),ki=De(Ui,0,1),Ur=gr(li,me,V),ts=li*t-K,rt=Ur-ee;Sg(ts,Ne,rt,ne);const Er=ih*$;if(k[Er+0]=ts,k[Er+1]=Ne,k[Er+2]=rt,Y[Er+0]=ki,Y[Er+1]=Ce,l){const $n=gr(li+Mi,me,V),Na=gr(li-Mi,me,V),ea=gr(li,me+Mi,V),Bh=.25*(Na-$n),Vh=.25*(gr(li,me-Mi,V)-ea),ta=Mi,i_=Math.sqrt(Bh*Bh+Vh*Vh+ta*ta);Z[Er+0]=Bh/i_,Z[Er+1]=Vh/i_,Z[Er+2]=ta/i_}++$}}})(),le.numVerticesPerSide=n.numVerticesPerSide,le.vertexAttributes=B,Xi(e.geometryInfo.uvOffsetAndScale,y,v,w-y,b-v),xTe(e,$),TTe(e,t),$=z,wTe(le,n.numVerticesPerSide,[],[0,N-1],[0,N-1],n.wireframe),e.intersectionData=null}function wTe(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=k0.map((b,S)=>S===0&&s[1]<t-2||S===1&&r[1]<t-2||S===2&&s[0]>1||S===3&&r[0]>1),h=3*(l+e.outerEdges.reduce((b,S,T)=>b+(c[T]?0:o-2+S.count-1),0)+i.reduce((b,S)=>b+o*(2*(S.latitudeResolution-1)+1),0))*(n?2:1),p=new(a>But?Uint32Array:Uint16Array)(h);let f=0;const m=n?(b,S,T)=>{p[f++]=b,p[f++]=S,p[f++]=S,p[f++]=T,p[f++]=T,p[f++]=b}:(b,S,T)=>{p[f++]=b,p[f++]=S,p[f++]=T},y=t-2,v=o-2;(()=>{for(let b=Math.max(s[0],1)-1;b<Math.min(s[1],t-2)-1;++b)for(let S=Math.max(r[0],1)-1;S<Math.min(r[1],t-2)-1;++S){const T=b*y+S,E=T+1,C=E+y,O=C-1;m(T,E,C),m(C,O,T)}})(),(()=>{for(let b=0;b<4;++b){if(c[b])continue;const S=e.outerEdges[b],T=e.innerEdges[b];let E=0,C=0;const O=S.count,I=T.count;S.count;const N=b===1||b===2?(D,z,B)=>m(D,z,B):(D,z,B)=>m(D,B,z);for(;E<O-1||C<I-1;){const D=T.getVertexOffset(C),z=S.getVertexOffset(E),B=E<O-1,k=C<I-1,Y=B?0+o*(E+.5)/(O-1):0,Z=k?1+v*(C+.5)/(I-1):0;B&&(!k||Y<=Z)?(++E,N(D,z,S.getVertexOffset(E))):(++C,N(D,z,T.getVertexOffset(C)))}}})();const w=b=>{let S=e.outerEdges[b.connectedOuterEdgeOffset].offset0;for(let T=0;T<b.latitudeResolution;++T){const E=T===0?b.rowOffset:S+t;for(let C=0;C<o;C++)m(S,S+1,E+C),T<b.latitudeResolution-1&&m(S+1,E+C+1,E+C),++S;S=E}};i.forEach(w),e.indices=p,e.indexCount=h}function xTe(e,t){const i=e.localOrigin,r=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes.position.typedBuffer;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new Voe(o,i,h,p,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new Voe(o,i,c,1,h),a+=h}}}function jut(e){var r,s;ETe(e),PTe(e);const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function Hut(e){RTe(e),jZ(e)}function qut(e,t){CTe(e,t),ITe(e,t),jZ(e)}function Wut(e,t){TTe(e,t),jZ(e)}function TTe(e,t){CTe(e,t),eht(e,t),ITe(e,t)}function STe(e,t,i,r,s){const n=Math.cos(i),o=Math.sin(i),a=Math.sin(t),l=Math.cos(t),c=s+r;e[0]=l*n*c,e[1]=a*n*c,e[2]=o*c}function Xut(e,t,i,r,s,n){const o=s[i===0?1:3];STe(e,s[t===0?0:2],o,r,n)}function Yut(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function Zut(e,t){return e*t}function _3(e,t,i){return e?r=>Yut(r,t):r=>Zut(r,i)}function Qut(e,t,i,r,s,n,o){const a=t===0?s[0]:s[2],l=i===0?s[1]:s[3],c=r;e[0]=a*n,e[1]=o(l),e[2]=c}function Jut(e,t){const i=e.geometryState,r=e.tile,s=r.extent,n=vt(i.clippingArea,s),o=e.geometryInfo,a=o.boundingBox,l=o.outerEdges,c=i.neighborData.cornerNeighborData,h=o.uvOffsetAndScale[0],p=o.uvOffsetAndScale[1],f=o.uvOffsetAndScale[2],m=o.uvOffsetAndScale[3],y=f>0?1/f:1,v=m>0?1/m:1,w=-h*y,b=-p*v,S=r.surface.isWebMercatorOnPlateeCarree,T=_3(S,S?r.ellipsoid.radius:0,t),E=i.samplerData,C=i.neighborData.edgeNeighbours,O=e.localOrigin,I=(N,D,z,B,k)=>{const Y=s[0]*(1-B)+s[2]*B,Z=s[1]*(1-k)+s[3]*k,le=De(Y,n[0],n[2]),ne=De(Z,n[1],n[3]),$=[ne===s[3],le===s[2],ne===s[1],le===s[0]],U=!$[3]&&!$[1]||!$[0]&&!$[2],V=U?$[0]&&_(C[0])?C[0]:$[1]&&_(C[1])?C[1]:$[2]&&_(C[2])?C[2]:$[3]&&_(C[3])?C[3]:null:null,q=U?V?V.neighborTile.level===r.level?.5*(gr(le,ne,E)+gr(le,ne,V.neighborSamplerData)):gr(le,ne,V.neighborSamplerData):gr(le,ne,E):c[z].elevation,W=le*t-O[0],K=T(ne)-O[1],j=q-O[2];Sg(W,K,j,a);const ee=De(w+B*y,0,1),ge=De(b+k*v,0,1);N.setVertexRawXYZUV(D,W,K,j,ee,ge)};for(let N=0;N<4;++N){const D=l[N];I(D,0,N===0?3:N===1?1:2,N===1?1:0,N===0?1:0);const z=N===2?1:N===3?3:0,B=N===3?0:1,k=N===2?0:1;I(D,D.count-1,z,B,k)}}function ETe(e){ATe(e,(t,i,r,s)=>Xut(t,i,r,s,e.tile.extentInRadians,e.tile.ellipsoid.radius))}function CTe(e,t){const i=e.tile;_(i.renderData.geometryState.clippingArea)?Jut(e,t):ATe(e,(r,s,n,o)=>Qut(r,s,n,o,e.tile.extent,t,_3(i.surface.isWebMercatorOnPlateeCarree,i.ellipsoid.radius,t)))}function ATe(e,t){const i=e.geometryInfo,r=i.outerEdges,s=e.geometryState.neighborData.cornerNeighborData,n=i.boundingBox,o=e.localOrigin,a=(l,c,h,p,f)=>{t(Py,h,p,s[c].elevation);for(let m=0;m<3;++m)Py[m]-=o[m];Sg(Py[0],Py[1],Py[2],n),l.setVertexRawXYZUV(f,Py[0],Py[1],Py[2],h,p)};for(let l=0;l<4;++l){const c=r[l];a(c,l===0?3:l===1?1:2,l===1?1:0,l===0?1:0,0),a(c,l===2?1:l===3?3:0,l===3?0:1,l===2?0:1,c.count-1)}}function jZ(e){var r,s;const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function RTe(e){ETe(e);for(let t=0;t<4;++t)Kut(e,t);PTe(e)}function Kut(e,t){var C3,A3,R3;const i=e.geometryState,r=i.neighborData,s=e.tile;s.level;const n=s.extent,o=n[2]-n[0],a=n[3]-n[1],l=s.extentInRadians,c=l[0];l[1];const h=l[2];l[3];const p=s.ellipsoid.radius,f=HZ(e),m=Ri=>{if(!Ri)return 0;const Mo=v,no=w?0:1,Sl=Ri.lij[no+1]*D,r_=s.lij[no+1]-Sl;return(w?D-1-r_:r_)*Mo},y=r.edgeNeighbours[t],v=r.edgeResolutions[t],w=t===1||t===3,b=t===1?1:0,S=t===0?1:0,T=n[0]+b*o,E=n[1]+S*a,C=c*(1-b)+h*b,O=f(S),I=y==null?void 0:y.neighborTile,N=s.level-((C3=I==null?void 0:I.level)!=null?C3:s.level),D=2**N,z=v*D,B=m(I),k=I==null?void 0:I.extent,Y=(t+2)%4,Z=i.samplerData,le=(R3=(A3=I==null?void 0:I.renderData)==null?void 0:A3.geometryState)==null?void 0:R3.samplerData,ne=I&&N===0,$=(Ri,Mo,no,Sl)=>.5*(gr(Ri,Mo,le)+gr(no,Sl,Z)),U=(Ri,Mo)=>gr(Ri,Mo,le),V=ne?$:U;let q=k?Y===1?k[2]:k[0]:T,W=k?Y===0?k[3]:k[1]:E;const K=(Ri,Mo,no)=>{const Sl=(B+Ri)/z;return W=k[1]*(1-Sl)+k[3]*Sl,V(q,W,Mo,no)},j=(Ri,Mo,no)=>{const Sl=(B+Ri)/z;return q=k[0]*(1-Sl)+k[2]*Sl,V(q,W,Mo,no)},ee=I?w?K:j:(Ri,Mo,no)=>gr(Mo,no,Z),ge=(Ri,Mo,no)=>ee(Ri,Mo,no);let Te=b,Fe=T,_e=C,me=S,Ce=E,Ne=O,Mi=Math.sin(_e),Fi=Math.cos(_e),si=Math.cos(Ne),Ui=Math.sin(Ne);const li=w?()=>f(me):()=>O,ki=w?Ri=>{me=Ri,Ce=n[1]*(1-Ri)+n[3]*Ri,Ne=li(),si=Math.cos(Ne),Ui=Math.sin(Ne)}:Ri=>{Te=Ri,Fe=n[0]*(1-Ri)+n[2]*Ri,_e=c*(1-Te)+h*Te,Mi=Math.sin(_e),Fi=Math.cos(_e)},Ur=e.geometryInfo,ts=Ur.boundingBox,rt=Ur.vertexAttributes,Er=rt.position.typedBuffer,$n=rt.uv0.typedBuffer,Na=rt.normal.typedBuffer,ea=Ur.outerEdges[t];let Bh=ea.getVertexOffset(1);const Vh=v+1,ta=e.localOrigin,i_=ta[0],ak=ta[1],lk=ta[2],x3=s.surface.shadingEnabled,T3=t===1?-1:t===3?1:0,S3=t===0?-1:t===2?1:0,E3=o/v,ck=T3*E3,uk=S3*E3,hk=T3*(1/v),dk=S3*(1/v),TE=Ri=>{uc(Eg,Ri,ff),lt(V2,Eg,bv),lt(G2,V2,Eg),de(os,os,G2)};for(let Ri=1;Ri<Vh-1;++Ri){ki(Ri/v);const Mo=ge(Ri,Fe,Ce),no=p+Mo,Sl=Fi*si*no,r_=Mi*si*no,O3=Ui*no,M3=Sl-i_,P3=r_-ak,I3=O3-lk;Sg(M3,P3,I3,ts);const up=ih*Bh;if(Er[up+0]=M3,Er[up+1]=P3,Er[up+2]=I3,$n[up+0]=Te,$n[up+1]=me,x3){te(os,0,0,0),te(ff,Sl,r_,O3),we(bv,ff);const ue=(Cr,kw)=>{const Au=gr(Fe+Cr*ck,Ce+Cr*uk,kw),s_=p+Au,ct=Te+Cr*hk,n_=c*(1-ct)+h*ct,gn=Math.sin(n_),o_=Math.cos(n_),$3=f(me+Cr*dk),Gh=Math.sin($3),SE=Math.cos($3),D3=Ue(o_*SE*s_,gn*SE*s_,Gh*s_);TE(D3)};I&&ue(-1,le),I&&!ne||ue(1,Z),Na[up+0]=os[0],Na[up+1]=os[1],Na[up+2]=os[2]}++Bh}if(x3)for(let Ri=1;Ri<Vh-1;++Ri)ea.getVertexRawNormal(os,Ri),ea.getVertex(ff,Ri),we(bv,ff),ea.getVertex(rc,Ri-1),TE(rc),ea.getVertex(rc,Ri+1),TE(rc),we(os,os),ea.setVertexRawNormal(Ri,os[0],os[1],os[2])}function eht(e,t){const i=e.geometryState.clippingArea,r=e.tile.extent,s=_(i)&&(r[0]<i[0]||r[2]>i[2]||r[1]<i[1]||r[3]>i[3])?iht:tht;for(let n=0;n<4;++n)s(e,n,t)}function OTe(e,t,i,r,s,n,o){return o===s?!e||t?(a,l)=>gr(a,l,i):null:o===n&&e?(a,l)=>gr(a,l,r):null}function YF(e,t,i,r){if(t!==e)return()=>0;const s=t?3:2,n=t?1:0,o=r(s,n),a=r(n,s),l=(o!=null?1:0)+(a!=null?1:0),c=t?i:0,h=t?0:i;return(p,f,m)=>((o!=null?-(o(p+c,f+h)-m):0)+(a!=null?+(a(p-c,f-h)-m):0))/l}function tht(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,y=p+1,v=c,w=e.localOrigin,b=m.samplerData,S=(j,ee)=>gr(j,ee,b),T=(j,ee)=>.5*(gr(j,ee,v.neighborSamplerData)+gr(j,ee,b)),E=(j,ee)=>gr(j,ee,v.neighborSamplerData),C=(v==null?void 0:v.neighborTile.level)===o,O=C?T:E,I=_(v)?O:S,N=e.geometryInfo,D=N.outerEdges[t],z=_3(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),B=N.boundingBox,k=t===1||t===3,Y=t===1?f[2]:f[0],Z=t===0?f[3]:f[1],le=t===1?1:0,ne=t===0?1:0,$=(f[2]-f[0])/h,U=v==null?void 0:v.neighborSamplerData,V=_(v),q=(j,ee)=>OTe(V,C,b,U,j,ee,t),W=YF(k,!0,$,q),K=YF(k,!1,$,q);for(let j=1;j<y-1;++j){const ee=j/p,ge=k?Y:f[0]*(1-ee)+f[2]*ee,Te=k?f[1]*(1-ee)+f[3]*ee:Z,Fe=k?le:ee,_e=k?ee:ne,me=I(ge,Te),Ce=ge*i-w[0],Ne=z(Te)-w[1],Mi=me-w[2];if(Sg(Ce,Ne,Mi,B),l){const Fi=W(ge,Te,me),si=K(ge,Te,me),Ui=$;D.setVertexRawXYZUVN(j,Ce,Ne,Mi,Fe,_e,Fi,si,Ui)}else D.setVertexRawXYZUV(j,Ce,Ne,Mi,Fe,_e)}if(l){const j=k?0:1,ee=k?1:0;for(let ge=1;ge<y-1;++ge){D.getNormal(RS,ge);const Te=D.getVertexZ(ge-1)-D.getVertexZ(ge+1),Fe=RS[0]+.5*j*Te,_e=RS[1]+.5*ee*Te,me=2*$,Ce=1/Math.sqrt(Fe*Fe+_e*_e+me*me);D.setVertexRawNormal(ge,Ce*Fe,Ce*_e,Ce*me)}}}function iht(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,y=vt(m.clippingArea,DTe),v=e.geometryInfo,w=v.uvOffsetAndScale[0],b=v.uvOffsetAndScale[1],S=w+v.uvOffsetAndScale[2],T=b+v.uvOffsetAndScale[3],E=S>w?1/(S-w):1,C=T>b?1/(T-b):1,O=-w*E,I=-b*C,N=p+1,D=[f[3]>y[3],f[2]>y[2],f[1]<y[1],f[0]<y[0]],z=c,B=m.samplerData,k=(si,Ui)=>gr(si,Ui,B),Y=(z==null?void 0:z.neighborTile.level)===o,Z=(si,Ui)=>{const li=gr(si,Ui,z.neighborSamplerData);return Y?.5*(li+gr(si,Ui,B)):li},le=k,ne=_(z)?Z:k,$=D[t]?le:ne,U=v.outerEdges[t],V=v.boundingBox,q=t===1||t===3,W=De(t===1?f[2]:f[0],y[0],y[2]),K=De(t===0?f[3]:f[1],y[1],y[3]),j=t===1?1:0,ee=t===0?1:0,ge=e.localOrigin,Te=_3(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),Fe=(f[2]-f[0])/h,_e=z==null?void 0:z.neighborSamplerData,me=_(z),Ce=(z==null?void 0:z.neighborTile.level)===o,Ne=(si,Ui)=>OTe(me,Ce,B,_e,si,Ui,t),Mi=YF(q,!0,Fe,Ne),Fi=YF(q,!1,Fe,Ne);for(let si=1;si<N-1;++si){const Ui=si/p,li=q?W:De(f[0]*(1-Ui)+f[2]*Ui,y[0],y[2]),ki=q?De(f[1]*(1-Ui)+f[3]*Ui,y[1],y[3]):K,Ur=q?j:De(O+Ui*E,0,1),ts=q?De(I+Ui*C,0,1):ee,rt=$(li,ki),Er=li*i-ge[0],$n=Te(ki)-ge[1],Na=rt-ge[2];if(Sg(Er,$n,Na,V),l){const ea=Mi(li,ki,rt),Bh=Fi(li,ki,rt),Vh=Fe;U.setVertexRawXYZUVN(si,Er,$n,Na,Ur,ts,ea,Bh,Vh)}else U.setVertexRawXYZUV(si,Er,$n,Na,Ur,ts)}if(l){const si=q?0:1,Ui=q?1:0;for(let li=1;li<N-1;++li){U.getNormal(RS,li);const ki=U.getVertexZ(li-1)-U.getVertexZ(li+1),Ur=RS[0]+.5*si*ki,ts=RS[1]+.5*Ui*ki,rt=2*Fe,Er=1/Math.sqrt(Ur*Ur+ts*ts+rt*rt);U.setVertexRawNormal(li,Er*Ur,Er*ts,Er*rt)}}}function MTe(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function rht(e,t,i,r){return MTe(e+r*(t-e),i)}function sht(e,t,i){return e*(1-i)+t*i}function HZ(e){const t=e.tile;if(t.surface.isWebMercator){const r=t.extent,s=t.ellipsoid.radius;return n=>rht(r[1],r[3],s,n)}const i=t.extentInRadians;return r=>sht(i[1],i[3],r)}function PTe(e){e.tile.surface.shadingEnabled&&$Te(e,(t,i,r,s,n,o,a)=>nht(i,t,r,s,n,o,a))}function ITe(e,t){e.tile.surface.shadingEnabled&&$Te(e,(i,r,s,n,o,a,l)=>oht(lht(e,t),i,s,o,a,l))}function nht(e,t,i,r,s,n,o){aht(e,rc,s,n,o),uc(Eg,rc,i),lt(V2,Eg,r),lt(t,V2,Eg)}function oht(e,t,i,r,s,n){e(rc,r,s,n);const o=rc[0]-i[0],a=rc[1]-i[1],l=rc[2]-i[2];t[0]=-o*l,t[1]=-a*l,t[2]=o*o+a*a}function aht(e,t,i,r,s){const n=HZ(e),o=e.tile,a=o.extent;WC(a,i,r,1);const l=(i-a[0])/(a[2]-a[0]),c=(r-a[1])/(a[3]-a[1]),h=o.extentInRadians;STe(t,h[0]*(1-l)+h[2]*l,n(c),s,o.ellipsoid.radius)}function lht(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(i,r,s,n)=>uht(t,e.tile.ellipsoid.radius,i,r,s,n):(i,r,s,n)=>cht(t,i,r,s,n)}function cht(e,t,i,r,s){t[0]=i*e,t[1]=r*e,t[2]=s}function uht(e,t,i,r,s,n){i[0]=r*e,i[1]=(Math.PI/2-2*Math.atan(Math.exp(-s/t)))*t,i[2]=n}function $Te(e,t){var o;if(!e.tile.surface.shadingEnabled)return;const i=e.geometryState.neighborData.cornerNeighborData,r=e.tile,s=r.extent,n=((o=e.tile.surface.view)==null?void 0:o.viewingMode)==="local";n&&te(bv,0,0,1);{const a=(v,w,b,S)=>{t(G2,v.renderData,ff,bv,w,b,S),de(os,os,G2)},c=(v,w,b,S,T,E)=>{const C=E===1?T.extent[0]:E===3?T.extent[2]:v,O=E===0?T.extent[1]:E===2?T.extent[3]:w,I=C+Ax[b][0]*S,N=O+Ax[b][1]*S;WC(T.extent,I,N,1);const D=gr(I,N,T.renderData.geometryState.samplerData);a(T,I,N,D)},h=(v,w,b)=>v.extent[w===0||w===1?2:0]+b,p=(v,w,b)=>v.extent[w===0||w===3?3:1]+b,f=(v,w,b,S)=>{const T=h(b,S,Ax[v][0]*w),E=p(b,S,Ax[v][1]*w);WC(b.extent,T,E,1);const C=gr(T,E,b.renderData.geometryState.samplerData);a(b,T,E,C)},m=(v,w,b,S,T,E)=>{const C=Ax[v][0]*w,O=Ax[v][1]*w,I=h(b,S,C),N=p(b,S,O),D=h(T,E,C),z=p(T,E,O);WC(b.extent,I,N,1),WC(T.extent,D,z,1);const B=gr(I,N,b.renderData.geometryState.samplerData),k=gr(D,z,T.renderData.geometryState.samplerData);a(b,I,N,.5*(B+k))},y=v=>{const w=v===0||v===1?s[2]:s[0],b=v===0||v===3?s[3]:s[1],S=i[v].cornerTiles,T=S.reduce((E,C)=>{var O;return Math.min(E,(O=C==null?void 0:C.level)!=null?O:1/0)},1/0);for(let E=0;E<4;++E){const C=S[E];Iy[E]=(C==null?void 0:C.level)===T?C:null}for(let E=0;E<4;++E){const C=Iy[(E+3)%4],O=Iy[E];if(C!=null&&C!==r&&C===O){const I=C,N=(E+2)%4,D=I.renderData.geometryState.neighborData.edgeResolutions[N],z=Math.max(D,2**(r.level-I.level)),B=(I.extent[2]-I.extent[0])/z,k=(E+0)%4,Y=(E+1)%4;return c(w,b,(E+3)%4,B,I,E),c(w,b,k,B,I,E),c(w,b,Y,B,I,E),os}}{Iy.some(C=>(C==null?void 0:C.isLoaded)||C===r);const E=Iy.reduce((C,O)=>O?O.extent[2]-O.extent[0]:C,0)/Iy.reduce((C,O)=>{var I;return Math.max(C,(I=O==null?void 0:O.renderData.geometryState.numVerticesPerSide)!=null?I:1)},1);for(let C=0;C<4;++C){const O=Iy[(C+3)%4],I=Iy[(C+0)%4];if(!O&&!I)continue;const N=C===0?1:C===1?2:C===2?3:0,D=C===0?2:C===1?3:C===2?0:1;O&&I?m(C,E,O,N,I,D):f(C,E,O!=null?O:I,O?N:D)}}return os};for(let v=0;v<4;++v){const w=e.geometryInfo.outerEdges[v],b=v===1||v===2?0:w.count-1;w.getVertex(ff,b),n||we(bv,ff),te(os,0,0,0);const S=y(v);we(UB[v],S)}}{const a=(c,h,p,f,m)=>{c.setVertexRawNormal(m,h,p,f)},l=e.geometryInfo.outerEdges;for(let c=0;c<4;++c){const h=l[c];{const p=UB[c===0?3:c===1?1:2];a(h,p[0],p[1],p[2],0)}{const p=UB[c===2?1:c===3?3:0];a(h,p[0],p[1],p[2],h.count-1)}}}}function Sg(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}const Ax=[[0,1],[1,0],[0,-1],[-1,0]],B_=new rut,DTe=gq(-1/0,-1/0,1/0,1/0),Py=M(),rc=M(),Eg=M(),V2=M(),G2=M(),ff=M(),FB=M(),bv=M(),os=M(),RS=M(),UB=[M(),M(),M(),M()],Iy=[null,null,null,null];class hht extends BZ{constructor(t,i,r){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=Dt(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=_(s)&&sO(s)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this.extentInRenderSR,c=this.extent;if(a){const h=Ue(c[0],c[1],0);Ks(h,Ke.WebMercator,h,Ke.PlateCarree);const p=Ue(c[2],c[3],0);Ks(p,Ke.WebMercator,p,Ke.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[va.MIDDLE][3]=o}_isVisible(t){return RXe(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return fOe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s){return h$[0]=1/i[0],h$[1]=1/i[1],h$[2]=1/i[2],qY(this._aabb(),t,h$,r,s)}createGeometry(){Gut(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){qut(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){Wut(this.renderData,this.horizontalScaleFactor)}}const h$=M();var gM;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(gM||(gM={}));class dht extends BZ{constructor(t,i,r){super(),this.obb=new Array(8);for(let s=0;s<8;s++)this.obb[s]=M();t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=qt(o,l,.5),p=qt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),LE(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=il(this.centerAtSeaLevel);we(m,m),this.up=m,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)te(this._center[xd.MIDDLE],0,0,0),te(this._center[xd.TOP],0,0,0),te(this._center[xd.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=wi(this.surface.spatialReference)),this._center[xd.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(pn(this._center[xd.MIDDLE],this.obb[0]),pn(this._center[xd.MIDDLE],this.obb[1]));this._center[xd.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!rv(t,this._center[xd.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const i=this.obb;for(let r=0;r<zg.NUM;r++){const s=r===rr.NEAR,n=t[r];s&&(AC[0]=n[0],AC[1]=n[1],AC[2]=n[2],AC[3]=n[3]-this.surface.view.state.camera.near);const o=s?AC:n;let a;for(a=0;a<8;a++){const l=i[a];if(o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]<0)break}if(a===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);Vut(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,i=this.obb;for(let r=0;r<2;r++){const s=this.elevationBounds[r];let n=4*r;LE(i[n++],t[0],t[1],this.ellipsoid.radius+s),LE(i[n++],t[0],t[3],this.ellipsoid.radius+s),LE(i[n++],t[2],t[3],this.ellipsoid.radius+s),LE(i[n++],t[2],t[1],this.ellipsoid.radius+s)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case ph.HAS_NORTH_POLE:te(i[1],0,0,this.ellipsoid.radius),te(i[2],0,0,this.ellipsoid.radius),te(i[5],0,0,this.ellipsoid.radius),te(i[6],0,0,this.ellipsoid.radius);break;case ph.HAS_SOUTH_POLE:te(i[0],0,0,-this.ellipsoid.radius),te(i[3],0,0,-this.ellipsoid.radius),te(i[4],0,0,-this.ellipsoid.radius),te(i[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,i){return t===(1<<i)-1?t===0?ph.HAS_BOTH_POLES:ph.HAS_SOUTH_POLE:t===0?ph.HAS_NORTH_POLE:ph.REGULAR}intersectsRay(t,i,r,s){const n=this._center[xd.MIDDLE],o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,m=i[1]*p-c,y=i[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<Yoe.length?Yoe[this.level]+1:2}updateCornerElevations(){jut(this.renderData)}updateEdgeElevations(){Hut(this.renderData)}}const Yoe=[128,64,32,16,16,8,8,4],AC=_i();var xd;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(xd||(xd={}));class pht{constructor(){this.extent=Gt(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class fht{constructor(){this._queries=new Vt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Vt({initialSize:30}),this._queryPool=new vs(pht)}queryVisibleLevelRange(t,i,r,s){const n=this._queryPool.acquire();kd(n.extent,t),n.minLevel=i||-Number.MAX_VALUE,n.maxLevel=r!=null?r:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const i=this._queries.data[t];this._queryPool.release(i),i.callback(t>=this._queriesInvPtr),i.callback=null}this._queries.clear()}scaleQueriesForTile(t){const i=t.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}}class qZ extends Da{constructor(){super(...arguments),this.blendMode=Le.Normal}}u([G({count:Le.COUNT})],qZ.prototype,"blendMode",void 0);class mht extends vTe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=Le.Normal,this.backgroundColor=Aa}}class BU extends cr{initializeProgram(t){const i=BU.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:Xf(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}}BU.shader=new Ki(yut,()=>import("./BlendLayers.glsl.a0655d9f.js"));class SL extends qZ{constructor(){super(...arguments),this.output=Kn.Composite,this.baseOpacityMode=hn.One,this.premultipliedSource=!1}}u([G({count:Kn.COUNT})],SL.prototype,"output",void 0),u([G({count:hn.COUNT})],SL.prototype,"baseOpacityMode",void 0),u([G()],SL.prototype,"premultipliedSource",void 0);class kB{constructor(t,i,r,s,n,o){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=gi(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ue(s,o,n)}destroy(){this.texture.release()}}function EL(){return[1,0,0,1,0,0]}function ght(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function yht(e,t,i,r,s,n){return[e,t,i,r,s,n]}function vht(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:EL,clone:ght,fromValues:yht,createView:vht},Symbol.toStringTag,{value:"Module"}));function _ht(e){return e instanceof Float32Array&&e.length>=2}function bht(e){return Array.isArray(e)&&e.length>=2}function zB(e){return _ht(e)||bht(e)}const wht=96,xht=39.37;function WZ(e,t){return t.type?pi(e,t.x,t.y):ro(e,t)}function Tht(e){return gc(e)}function Sht(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const Eht=function(){const e=tt();return function(t,i,r){const s=i.targetGeometry;WZ(e,s);const n=.5*VU(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function VU(e){return e.scale*Cht(e.targetGeometry)}function Cht(e){return _(e)&&gl(e.spatialReference)?1/(Tht(e.spatialReference)*xht*wht):1}function Aht(e){return y4(e.rotation)||0}const XZ=function(){const e=tt(),t=tt(),i=tt();return function(r,s,n,o,a,l){return HX(e,s),Jl(t,n,.5*l),pi(i,1/o*l,-1/o*l),UX(r,t),a&&NX(r,r,a),W0e(r,r,i),FX(r,r,e),r}}(),Rht=function(){const e=tt();return function(t,i,r,s){const n=VU(i),o=Aht(i);return WZ(e,i.targetGeometry),XZ(t,e,r,n,o,s)}}(),Oht=function(){const e=tt();return function(t,i,r,s){const n=VU(i);return WZ(e,i.targetGeometry),XZ(t,e,r,n,0,s)}}();function Mht(e){const t=uv(e);return t?t.valid[1]-t.valid[0]:0}function Pht(e,t){return Math.round(Mht(e)/t)}var Yj;const fm=[0,0];let y0=Yj=class extends ye{constructor(e){super(e),this._viewpoint2D={center:tt(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new ri,this.id=0,this.inverseTransform=EL(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=EL(),this.transformNoRotation=EL(),this.displayMat3=xg(),this.displayViewMat3=xg(),this.viewMat3=xg(),this.viewMat2d=G0e(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Sht(i,e.viewpoint),this._set("size",ro(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new Yj({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return zB(t)?x1(e,t,this.inverseTransform):(fm[0]=t,fm[1]=i,x1(e,fm,this.inverseTransform))}toScreen(e,t,i){return zB(t)?x1(e,t,this.transform):(fm[0]=t,fm[1]=i,x1(e,fm,this.transform))}toScreenNoRotation(e,t,i){return zB(t)?x1(e,t,this.transformNoRotation):(fm[0]=t,fm[1]=i,x1(e,fm,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return XZ(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Oh({targetGeometry:new nt(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=VU(o),this.rotation=r,this.scale=i,this.spatialReference=t,ro(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;oY(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=aY(this.viewMat3),h=Ta(n[0]/2,n[1]/2),p=Ta(-n[0]/2,-n[1]/2),f=y4(r);sF(c,c,h),lY(c,c,f),sF(c,c,p),D5(this.displayViewMat3,this.displayMat3,c);const m=UX(this.viewMat2d,h);return NX(m,m,f),FX(m,m,p),Eht(this.extent,o,n),Rht(this.transform,o,n,s),H0e(this.inverseTransform,this.transform),Oht(this.transformNoRotation,o,n,s),this.worldScreenWidth=Pht(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],y0.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],y0.prototype,"pixelRatio",null),u([d({json:{write:!0}})],y0.prototype,"size",null),u([d()],y0.prototype,"spatialReference",void 0),u([d({type:Oh,json:{write:!0}})],y0.prototype,"viewpoint",null),y0=Yj=u([P("esri.views.2d.ViewState")],y0);const Iht=y0,$ht=.125;class Dht{constructor(){this._renderParams={context:null,drawPhase:1,state:new Iht({viewpoint:new Oh({targetGeometry:new nt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(i[0]),[y,v]=o.getShift(i,a*m),w=$ht*a*m/c,b=r.transforms.dvs;b[0]=w,b[4]=-w,b[6]=-1-y-l[0]*a*2,b[7]=1+v+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(f,r,n)}}class GU extends cr{initializeProgram(t){const i=GU.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:Xf(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}}GU.shader=new Ki(Sut,()=>import("./RasterColorizer.glsl.5a5afe03.js"));class AT extends qZ{constructor(){super(...arguments),this.colorizerType=$b.Stretch,this.stretchType=yw.Noop,this.tileBlendInput=Co.LayerOnly,this.baseOpacityMode=hn.One,this.applyColormap=!0}}u([G({count:$b.COUNT})],AT.prototype,"colorizerType",void 0),u([G({count:yw.COUNT})],AT.prototype,"stretchType",void 0),u([G({count:Co.COUNT})],AT.prototype,"tileBlendInput",void 0),u([G({count:hn.COUNT})],AT.prototype,"baseOpacityMode",void 0),u([G()],AT.prototype,"applyColormap",void 0);class Zoe{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let i=this._pools.get(t);if(!i){const r=Qoe.bind(Qoe,this._rctx,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.DEPTH_RENDER_BUFFER,width:t,height:t},s=>this._getPool(s.width).release(s));i=new vs(r,null,()=>{}),this._pools.set(t,i)}return i}}class Qoe extends wr{constructor(t,i,r){super(t,i),this.release=()=>r(this)}}const Lht=fe.getLogger("esri.views.3d.terrain");class Nht{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new Dht,this._bindParameters=new F5(null,null,null),this._blendLayersTechniqueConfig=new SL,this._poolToWrite=0,this._vaoQuad=La(this._rctx,QM),this._fboPools.push(new Zoe(this._rctx)),this._fboPools.push(new Zoe(this._rctx))}dispose(){this._fboPools.forEach(t=>{t.clear(),t=null}),this._fboPools=null,this._doubleBufferFbo.forEach(t=>Xe(t)),this._vaoQuad=Xe(this._vaoQuad),this._vectorTileHelper=Xe(this._vectorTileHelper),this._backgroundTechnique=Yi(this._backgroundTechnique),this._applyOpacityTechnique=Yi(this._applyOpacityTechnique),this._blendLayersTechnique=Yi(this._blendLayersTechnique)}_getBlendLayersTechnique(t,i,r,s=!1){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r?i===Kn.Composite?hn.OnBaseLayer:hn.OnBackground:hn.One,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(BU,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,i){const r=this._getBlendLayersTechnique(Le.Normal,i,!1),s=this._rctx.bindTechnique(r,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Pt.TRIANGLE_STRIP,0,xo(this._vaoQuad,"geometry"))}drawRasterData(t,i,r=!1){if(A(i.texture))return;const s=i.baseOpacity<1;i.blendMode!==Le.Normal||s||r?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const n=this._getBlendLayersTechnique(i.blendMode,t,s,r),o=this._rctx.bindTechnique(n,i,this._bindParameters);this._render(o)}drawImageryTileData(t,i,r){const s=t.sourceLayerInfo.data;if(!s.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,Wt.MAP).ensureSymbolizerParameters(s);const n=r.baseOpacity<1;r.blendMode!==Le.Normal||n?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const o=this._getRasterColorizerTechnique(s,i,r.blendMode,n),a=this._rctx.bindTechnique(o);if(!s.bind(this._rctx))return;s.opacity=r.opacity;const l=s.getUniforms();l.scale=t.scale,l.offset=t.offset,l.backgroundColor=r.backgroundColor,l.fboTexture=r.fboTexture,l.baseOpacity=r.baseOpacity,o.bindPass(l,null),this._render(a)}_getRasterColorizerTechnique(t,i,r,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return A(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new AT,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=i===Kn.ColorComposite?Co.ColorComposite:i===Kn.GridComposite?Co.GridComposite:Co.LayerOnly,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s?i===Kn.Composite?hn.OnBaseLayer:hn.OnBackground:hn.One,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?yw.Noop:yw.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(GU,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,i,r,s,n,o,a){const l=this._rctx,c=i.sourceLayerInfo.data,h=i.tile.surface.layerViewByIndex(i.layerIndex,Wt.MAP),p=t.baseOpacity<1||t.opacity<1||t.blendMode!==Le.Normal||a!==Kn.Composite;let f;this._getBlendLayersTechnique(t.blendMode,a,t.baseOpacity<1,p).bindPipelineState(l),p?(f=this._acquire(n),l.bindFramebuffer(f),l.setClearColor(0,0,0,0),l.clearSafe(Zi.COLOR_BUFFER_BIT|Zi.DEPTH_BUFFER_BIT)):o&&l.clearSafe(Zi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(l,i.sourceLod,c,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/i.scale),i.offset,s,r)}catch(m){Lht.warnOnce("A render call containing vector tiles did not resolve correctly.",m)}return!_(f)||(l.bindFramebuffer(this._currentFBO),t.texture=f.colorTexture,t.offset=Mh,t.scale=1,this.drawRasterData(a,t,p),f.release(),o)}copyFBOToTexture(t){const i=this._rctx,r=i.bindTexture(t.texture,st.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;i.gl.copyTexImage2D(pt.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),i.bindTexture(r,st.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(t,i){this._rctx.bindFramebuffer(t),this._rctx.setViewport(0,0,i,i),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Zi.COLOR_BUFFER_BIT|Zi.DEPTH_BUFFER_BIT)}_acquire(t){return this._fboPools[this._poolToWrite].acquire(t)}bindPool(t,i){this._poolToWrite=t,this._doubleBufferFbo[t]==null&&(this._doubleBufferFbo[t]=this._acquire(i),this._initFBO(this._doubleBufferFbo[t],i))}_switchPool(t){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=this._poolToWrite===0?1:0,this.bindPool(this._poolToWrite,t)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(t,i){t===this._lastPixelRatio&&i===this._lastNumLayers||(this._fboPools.forEach(r=>r.clear()),this._lastPixelRatio=t,this._lastNumLayers=i)}}class Fht{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new mht,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Nht(this._rctx,this._techniqueRepository),this._blackTex=new CT(sje(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Xe(this._composition),this._backgroundTexture=Yi(this._backgroundTexture),this._blackTex=Yi(this._blackTex)}get backgroundIsGrid(){return A(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){if(!t.renderData)return;const r=t.surface,s=r.baseOpacity;this._numTexturedLayer=0;let n=0,o=this.tileSize,a=!1;const l=r.view.state.pixelRatio;let c=!1;const h=t.layerInfo[Wt.MAP];let p=h.length,f=0;for(;f<h.length;f++){const v=r.layerViewByIndex(f,Wt.MAP),w=v.fullOpacity;if(VB[f]=w,Gfe(v.layer)&&p>=h.length&&(p=f),w===0){h[f].pendingUpdates&=~(_t.TEXTURE_NOFADING&_t.TEXTURE_FADING);continue}++n;const b=BB(t,f);if(b){if(h[f].pendingUpdates&=~(_t.TEXTURE_NOFADING&_t.TEXTURE_FADING),qF(v)){const S=sTe(v.layer.parent)?"normal":v.layer.blendMode;Joe[f]=S;const T=S!=="normal";T&&(c=T,a=!1)}pM(v)?o=Math.max(o,this.tileSize*l):s===1&&w===1&&(v.isOpaque||this._dataToTexture(b)&&b.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(l,h.length),o=Uht(o);const m=o/this.tileSize,y=f-1;this._ensureBackgroundTexture(this.tileSize),this._numTexturedLayer!==0?this._numTexturedLayer===1&&!c&&this._useLayerTexture(t,y,p,VB[y])||this._composeMapLayers(t,i,y,p,VB,Joe,o,m,!a||c):this._useBackgroundTexture(t,n)}_ensureBackgroundTexture(t){A(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,t),this._passParameters.offset=Mh,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=Le.Normal,_(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,_(this.backgroundColor)?Kn.ColorOnly:Kn.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(t,i){let r=Tg.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=Tg.Delayed),this._backgroundTexture&&A(t.renderData.textureReference)&&(r=Tg.Immediate),t.renderData.setTextureReference(_(this._backgroundTexture)?new kB(this._backgroundTexture,Rn.FADING,Koe,t.surface.baseOpacity,1,0):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=BB(t,i);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new kB(l.sourceLayerInfo.data,Rn.FADING,l,o,s,a)),!0)}_composeMapLayers(t,i,r,s,n,o,a,l,c){this._composition.bindPool(0,a);const h=t.surface.baseOpacity;let p=!1,f=Je.LINEAR_MIPMAP_LINEAR,m=!1,y=0;for(let w=r;w>=0;w--){const b=BB(t,w);if(!b||n[w]===0)continue;const S=w<s&&h<1&&!p;this._passParameters.baseOpacity=S?h:1,S&&(p=!0);const T=y===0,E=c&&T?this.backgroundIsGrid?Kn.GridComposite:Kn.ColorComposite:Kn.Composite;nct(b)?(this._passParameters.opacity=n[w],this._passParameters.blendMode=wL[o[w]],m=this._composition.drawVectorData(this._passParameters,b,l,this.tileSize,a,m,E)):sct(b)?(this._passParameters.opacity=n[w],this._passParameters.blendMode=wL[o[w]],this._composition.drawImageryTileData(b,E,this._passParameters),this._hasNearestInterpolation(b)&&(f=Je.NEAREST)):this._dataToTexture(b)&&(this._passParameters.texture=b.sourceLayerInfo.data.texture,this._passParameters.offset=b.offset,this._passParameters.scale=b.scale,this._passParameters.opacity=n[w],this._passParameters.blendMode=wL[o[w]],this._composition.drawRasterData(E,this._passParameters)),y++}const v=t.renderData.ensureTexture(a,()=>this._buildTexture(a,f));this._composition.copyFBOToTexture(v),this._composition.releasePool(),t.renderData.setTextureReference(new kB(v,i,Koe,p?1:h,1,0))}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(t){return act(t)&&this._rasterDataToTexture(t),oct(t)}_rasterDataToTexture(t){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,i=Je.LINEAR_MIPMAP_LINEAR){if(A(t))return null;const r={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new CT(new st(s,r));else if(t instanceof NU)r.isOpaque=t.isOpaque,n=new CT(new st(s,r,t.image)),t.release();else try{n=new CT(new st(s,r,t))}catch{n=new CT(qve(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,st.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,st.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function Uht(e){const t=GS(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function BB(e,t){Cc.layerIndex=t;const i=e.layerInfo[Wt.MAP][t];if(_(i.data))return pi(Cc.offset,0,0),Cc.tile=e,Cc.scale=1,Cc.sourceLod=e.lij,Cc.sourceLayerInfo=i,Cc;const r=i.upsampleInfo;if(_(r)){const s=r.tile.layerInfo[Wt.MAP][t];return Cc.tile=r.tile,ro(Cc.offset,r.offset),Cc.scale=r.scale,Cc.sourceLod=r.tile.lij,Cc.sourceLayerInfo=s,Cc}return null}const VB=new Array,Joe=new Array,Cc={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},Koe={offset:[0,0],scale:1},LTe=200,GB=40,kht=.8,zht=10,YA=1e-6;function Bht(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(r[a]<l){if(s[a]<=YA)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-YA){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(r[a]>l){if(s[a]>=-YA)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=YA){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class eae{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class j2{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this.rayDirection=M(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=r-i,o=n<=NTe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=qht(t,i,r,s.data,s.stride),l=De(Math.log2(n/GB),2,zht),c=(h,p,f)=>{const m=jht(o,a,h,p),y=p-h;if(y<=GB){const E=new eae(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:v,midValue:w}=Hht(m),b=Ght(o,a,h,p,v,w),S=(E,C)=>{if(f>l)return;const O=C-E;return O<GB||O>=kht*y?void 0:c(E,C,f+1)},T=new eae(m,v,w,b.next,b.mid);return this.bspNodeTree.push(T),T.leftNode=S(h,b.next),T.rightNode=S(b.mid,p),T};c(0,n,0),this.triangleVertexIndices=Wht(o,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],l=o[1],c=o[2],h=this.rayDirection,p=h[0],f=h[1],m=h[2];for(let y=t,v=3*t;y<i;++y){const w=r[v]*n,b=s[w],S=s[w+1],T=s[w+2],E=r[v+1]*n,C=s[E],O=s[E+1],I=s[E+2],N=r[v+2]*n,D=s[N],z=s[N+1],B=s[N+2];v+=3;const k=C-b,Y=O-S,Z=I-T,le=D-b,ne=z-S,$=B-T,U=f*$-ne*m,V=m*le-$*p,q=p*ne-le*f,W=k*U+Y*V+Z*q;if(Math.abs(W)<=Number.EPSILON)continue;const K=a-b,j=l-S,ee=c-T,ge=K*U+j*V+ee*q;if(W>0){if(ge<0||ge>W)continue}else if(ge>0||ge<W)continue;const Te=j*Z-Y*ee,Fe=ee*k-Z*K,_e=K*Y-k*j,me=p*Te+f*Fe+m*_e;if(W>0){if(me<0||ge+me>W)continue}else if(me>0||ge+me<W)continue;const Ce=(le*Te+ne*Fe+$*_e)/W;if(Ce>=0){const Ne=this.indices[y]+this.firstTriangleIndex,Mi=jY(k,Y,Z,le,ne,$,Vht);this.callback(Ce,Mi,Ne,!1)}}}j2.numFacesTested+=i-t}intersectRay(t,i){j2.numFacesTested=0;const r=Ue(t.r0[0],t.r0[1],t.r0[2]),s=Ue(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<YA)return;this.rayOrigin=r;const l=this.rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this.callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,i,r){const s=this.rayOrigin,n=this.rayDirection;if(!Bht(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=i,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=r;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}j2.numFacesTested=0;const Vht=M(),Rx=[1/0,1/0,1/0],Ox=[-1/0,-1/0,-1/0];function Ght(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function jht(e,t,i,r){if(r<=i)return Vb(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)Rx[n]=t[s+0+n],Ox[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let o=0;o<3;++o)Rx[o]=Math.min(Rx[o],t[n+0+o]),Ox[o]=Math.max(Ox[o],t[n+3+o])}return Vb(Rx[0],Rx[1],Rx[2],Ox[0],Ox[1],Ox[2])}function Hht(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function qht(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],y=r[h+f],v=r[p+f];o[6*a+f]=Math.min(m,y,v),o[6*a+3+f]=Math.max(m,y,v)}}return o}function Wht(e,t,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=NTe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+i);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const NTe=65535;class YZ extends Twe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=M(),this.origin=this.slicePlaneLocalOrigin}}var ou,Wn;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(ou||(ou={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(Wn||(Wn={}));class Xht extends YZ{constructor(){super(...arguments),this.identifier=ou.Material,this.transparent=!1,this.integratedMesh=!1}}class Yht extends YZ{constructor(){super(...arguments),this.identifier=ou.ShadowMap}}class Zht extends YZ{constructor(){super(...arguments),this.identifier=ou.Highlight}}class ZF extends Hr{constructor(t,i){super(t,"vec4",Li.Draw,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}var Cg;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(Cg||(Cg={}));class Qht extends Us{constructor(){super(...arguments),this.overlayOpacity=1}}function tae(e,t){e.vertex.uniforms.add([new Ca("overlayTexOffset"),new Ca("overlayTexScale")]),e.fragment.uniforms.add([new We("overlayOpacity",i=>i.overlayOpacity),new zt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[Pr.INNER].getColorTexture(i.overlaySource))]),FTe(e,t)}function Jht(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add([new ZF("overlayTexOffset",(s,n)=>Kht(s,n)),new ZF("overlayTexScale",(s,n)=>edt(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new zt("ovColorTex",(s,n)=>Zj(s,n))),FTe(e,t)}function FTe(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==Rt.Water&&t.pbrMode!==Rt.WaterOnIntegratedMesh||e.include(Rwe,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.code.add(x`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(x`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(x`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==Rt.Water&&t.pbrMode!==Rt.WaterOnIntegratedMesh||(r.uniforms.add([new xt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new xt("lightingMainIntensity",(s,n)=>n.lighting.mainLight.intensity)]),r.code.add(x`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Zj(e,t){return t.overlays.length===0?null:e.identifier===ou.Material&&e.subPass===Wn.Color?t.overlays[Pr.INNER].getColorTextureNoRasterImage():e.identifier===ou.Highlight?t.overlays[Pr.INNER].getValidTexture(fs.Highlight):null}function Kht(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;ghe(s)>0&&(OS[2*r]=e.toMapSpace[0]/ru(s)-s[0]/ru(s),OS[2*r+1]=e.toMapSpace[1]/np(s)-s[1]/np(s))}return OS}function edt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;ghe(s)>0&&(OS[2*r]=e.toMapSpace[2]/ru(s),OS[2*r+1]=e.toMapSpace[3]/np(s))}return OS}const OS=Gt();function tdt(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(x`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function idt(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new Ca("texOffsetAndScale")),e.fragment.uniforms.add(new $r("tex")),e.fragment.uniforms.add(new ul("textureOpacities"));const i=t.textureFadingEnabled&&!t.renderOccluded;i&&(e.vertex.uniforms.add(new Ca("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new $r("texNext")),e.fragment.uniforms.add(new ul("nextTexOpacities")),e.fragment.uniforms.add(new $i("fadeFactor")));const r=t.tileBlendInput===Co.ColorComposite,s=t.tileBlendInput===Co.GridComposite;s&&e.fragment.include(zZ),r&&e.fragment.uniforms.add(new ul("backgroundColor")),e.vertex.code.add(x`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${i?x`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:x``}
  }`),e.fragment.code.add(x`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${s||r?x`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${r?x`vec4(backgroundColor, 1.0)`:x`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:x`return color;`}
    }`),i?e.fragment.code.add(x`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(x`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class UTe extends Qht{}function rdt(e){const t=new Hi;t.include(Qwe,{name:"Terrain Shader",output:e.output}),t.attributes.add(R.POSITION,"vec3"),t.attributes.add(R.UV0,"vec2"),t.attributes.add(R.NORMAL,"vec3");const{vertex:i,fragment:r}=t;if(i.uniforms.add([new yr("proj",(s,n)=>n.camera.projectionMatrix),new Sj("view",(s,n)=>Ia(iae,n.camera.viewMatrix,s.origin)),new Oa("origin",s=>s.origin)]),r.uniforms.add(new Oa("origin",s=>s.origin)),e.output===J.Color){t.include(To),t.include(ov,e),t.include(idt,e),t.include(pw,e);const s=e.overlayMode!==Cg.Disabled,n=e.overlayMode===Cg.EnabledWithWater;s&&t.include(tae,ve(F({},e),{pbrMode:Rt.Water})),n&&t.include(tdt,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&i.uniforms.add(new yr("viewNormal",(a,l)=>l.camera.viewInverseTransposeMatrix));const o=e.receiveShadows&&!e.renderOccluded;o&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(i.uniforms.add(new xt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),i.code.add(x`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?x`normal`:x`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?x`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?x`vuv = uv;`:""}
        ${e.screenSizePerspective?x`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${o?x`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${s?x`setOverlayVTC(uv);`:""}
        ${n?x`forwardVertexTangent(vnormal);`:x``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(cs,e),t.include(pw,e),t.include(y3,e),t.include(dw,e),r.uniforms.add([new Oa("cameraPosition",(a,l)=>pe(jB,l.camera.eye,a.origin)),new xt("viewDirection",(a,l)=>we(jB,te(jB,l.camera.viewMatrix[12],l.camera.viewMatrix[13],l.camera.viewMatrix[14]))),new We("lightingGlobalFactor",(a,l)=>l.lighting.globalFactor),new xt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection),new xt("lightingMainIntensity",(a,l)=>l.lighting.mainLight.intensity)]),r.constants.add("ambientBoostFactor","float",gE),n&&r.uniforms.add([new zt("ovWaterTex",(a,l)=>l.overlays.length===0?null:l.overlays[Pr.INNER].getNormalTexture(a.overlaySource)),new Sj("view",(a,l)=>Ia(iae,l.camera.viewMatrix,a.origin))]),r.code.add(x`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r.code.add(x`
      void main() {
        ${o?x`float shadow = readShadowMap(vpos, linearDepth);`:x`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${s?x`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?x`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?x`atm + tileColor.rgb;`:x`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":x`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":x`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${n?x`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?x`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?x`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==J.Depth&&e.output!==J.Shadow||(t.include(To,{hasModelTransformation:!1,linearDepth:!0}),t.include(e_,{output:e.output}),t.include(ov,e),t.varyings.add("linearDepth","float"),i.uniforms.add(new fi("nearFar",(s,n)=>n.camera.nearFar)),i.code.add(x`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(x`void main() {
outputDepth(linearDepth);
}`)),e.output===J.Normal&&(t.include(To),t.include(ov,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),i.uniforms.add(new yr("viewNormal",(s,n)=>n.camera.viewInverseTransposeMatrix)),i.code.add(x`
        void main(void) {
          vec3 normal = ${e.shading?x`normal`:x`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),r.code.add(x`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===J.Highlight&&(t.include(To),t.include(ov,e),t.include(tae,e),i.code.add(x`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(Kg),r.code.add(x`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const iae=Ae(),jB=M(),sdt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:UTe,build:rdt},Symbol.toStringTag,{value:"Module"}));class jU extends cr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global}initializeProgram(t){const i=jU.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Ut({blending:i.renderOccluded?Xf(Re.ONE,Re.ONE_MINUS_SRC_ALPHA):null,culling:r&&qX,depthTest:!i.renderOccluded&&{func:hr.LESS},depthWrite:!i.renderOccluded&&wl,colorWrite:Kt,stencilTest:t?Iet(fl.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}jU.shader=new Ki(sdt,()=>import("./Terrain.glsl.0f3f2dbb.js"));class Ss extends qo{constructor(){super(...arguments),this.output=J.Color,this.overlayMode=Cg.Disabled,this.tileBlendInput=Co.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=he("enable-feature:terrain-shading")}}u([G({count:J.COUNT})],Ss.prototype,"output",void 0),u([G({count:Cg.COUNT})],Ss.prototype,"overlayMode",void 0),u([G({count:Co.COUNT})],Ss.prototype,"tileBlendInput",void 0),u([G()],Ss.prototype,"spherical",void 0),u([G()],Ss.prototype,"atmosphere",void 0),u([G()],Ss.prototype,"receiveShadows",void 0),u([G()],Ss.prototype,"hasSlicePlane",void 0),u([G()],Ss.prototype,"backfaceCullingEnabled",void 0),u([G()],Ss.prototype,"stencilEnabled",void 0),u([G()],Ss.prototype,"textureFadingEnabled",void 0),u([G()],Ss.prototype,"renderOccluded",void 0),u([G()],Ss.prototype,"hasScreenSpaceReflections",void 0),u([G()],Ss.prototype,"hasCloudsReflections",void 0),u([G()],Ss.prototype,"tileBorders",void 0),u([G()],Ss.prototype,"screenSizePerspective",void 0),u([G()],Ss.prototype,"receiveAmbientOcclusion",void 0),u([G()],Ss.prototype,"shading",void 0),u([G({constValue:!0})],Ss.prototype,"isGround",void 0),u([G({constValue:Rt.Disabled})],Ss.prototype,"pbrMode",void 0),u([G({constValue:!1})],Ss.prototype,"highStepCount",void 0),u([G({constValue:!1})],Ss.prototype,"useCustomDTRExponentForWater",void 0),u([G({constValue:!1})],Ss.prototype,"useFillLights",void 0);const HB=7,ndt=10,qB=Ls(),d$=Gt();let Fc=class extends Ee{constructor(e){super(e),this.type=Dr.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new Ss,this._passParameters=new UTe,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new fht,this.renderDataPool=new vs(ug),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new dTe,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Or.Occlude}get isGlobal(){return this.stage.viewingMode===Ve.Global}get shadingEnabled(){var e;return(e=this._techniqueConfiguration)==null?void 0:e.shading}initialize(){const e=[Se.OPAQUE_TERRAIN,Se.TRANSPARENT_TERRAIN,Se.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),tut()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Nd}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?DF:Or.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,_(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,_t.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){_(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===_t.TEXTURE_FADING?Rn.FADING:Rn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[Wt.ELEVATION])t.pendingUpdates&=~_t.GEOMETRY;e.resetPendingUpdate(_t.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=ndt-HB,i=Math.max(0,Math.floor((e.level-t)/HB)*HB);if(this.isGlobal&&i===0)return Aa;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=Ms.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new Fht(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=qve(this.rctx)}uninitializeRenderContext(){this.emptyTex=Xe(this.emptyTex),this.tileRenderer=Xe(this.tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=adt,n=ldt;pe(s,r,i),te(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===io.MIN,h=!!e.results.ground.target,p=PWe(e.verticalOffset),f=e.tolerance;let m,y=c&&_(o.dist)?o.dist:1/0;const v=b=>{const S=b.renderData;if(!(S==null?void 0:S.vao))return;const T=S.geometryInfo;x4(qB,T.boundingBox);const E=S.localOrigin;_(p)&&(p.localOrigin=E,p.applyToAabb(qB));const C=qB;if(Mx[0]=i[0]-E[0],Mx[1]=i[1]-E[1],Mx[2]=i[2]-E[2],!qY(C,Mx,n,f,y))return;const O=(Y,Z,le)=>{Y.set(this.type,b,Z,le,en),y=c&&_(o.dist)?o.dist:1/0},I=(Y,Z)=>{if(_(Z)&&Y>=0&&(e.options.backfacesTerrain||xe(Z,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,Y))){if((l.dist==null||Y<l.dist)&&O(l,Y,Z),e.options.isFiltered)return;e.options.store===io.ALL&&(A(m)?(m=xY(e.ray),O(m,Y,Z),e.results.all.push(m)):Y<m.dist&&O(m,Y,Z)),(o.dist==null||Y<o.dist)&&O(o,Y,Z),e.options.store!==io.MIN&&(a.dist==null||Y>a.dist)&&O(a,Y,Z)}},N=cdt;pe(N,r,E);const D=T.indices,z=T.vertexAttributes,B={data:z.getField(R.POSITION,ji).typedBuffer,size:3,stride:z.stride/4},k=T.indexCount/3;if(A(p)&&k>LTe){const Y=b.renderData;A(Y.intersectionData)&&(Y.intersectionData=new j2(D,0,k,B)),Y.intersectionData.intersectRay({r0:Mx,r1:N},I)}else s3(Mx,N,0,k,D,B,null,p,I)},w=this._rootTiles;_(w)&&(()=>{const b=this.tileIterator;b.reset(w);const S=e.options.invisibleTerrain;for(;!b.done;){const T=b.next();!(T.visible||S&&T.intersectsClippingArea)||!_(p)&&!T.intersectsRay(i,s,f,y)||h&&this._useStencilForTile(T)?b.skipSubtree():v(T)}})()}prepareTechnique(e){if(e.bindParameters.slot===Se.OCCLUDED_TERRAIN){if((e.renderOccludedMask&DF)==0)return null}else{const t=this.opaque?Se.OPAQUE_TERRAIN:Se.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case Ge.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=_(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?Cg.Disabled:this.overlayRenderer.hasWater?Cg.EnabledWithWater:Cg.Enabled;const t=e.bindParameters.slot===Se.OCCLUDED_TERRAIN?ba.Occluded:ba.ColorAndWater;return this._updateTechnique(J.Color,t===ba.Occluded)}case Ge.MATERIAL_DEPTH_SHADOWMAP_ALL:case Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(J.Shadow,!1)):null;case Ge.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(J.Depth,!1));case Ge.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(J.Normal,!1);case Ge.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(J.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,i){case Ge.MATERIAL:{const s=e.bindParameters.slot===Se.OCCLUDED_TERRAIN?ba.Occluded:ba.ColorAndWater;this._renderMaterialPass(e,t,s);break}case Ge.MATERIAL_DEPTH_SHADOWMAP_ALL:case Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,ba.None);break;case Ge.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,ba.None);break;case Ge.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,ba.None);break;case Ge.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,ba.Highlight),e.rctx.clearSafe(Zi.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i)}updateTileBackground(e=null){if(A(this.tileRenderer))return;const t=this.tileRenderer;let i=null;if(_(e)){const r=qe.toUnitRGBA(e);i=Ue(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this.allTiles.forAll(r=>t.updateTileTexture(r,Rn.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?Co.GridComposite:_(t.backgroundColor)?Co.ColorComposite:Co.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==gM.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>fTe(this.renderOrder,t)),e.sort((t,i)=>mTe(t[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!A(e)){(t=e[0])==null||t.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r||i.visible)if(i.rendered){if(r){const s=this._patchGroups.get(r.localOrigin)||new Array;this._patchGroups.set(r.localOrigin,s),s.push(i),(!this.highestVisibleLODTile||i.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=i),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new Mj(n),e.bindParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],Pt.TRIANGLES,r,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=B1e(this.stage.viewingMode,this.ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=i===ba.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",bf));const l=_(this.tileRenderer)&&_(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:Aa;this._techniqueConfiguration.tileBlendInput===Co.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Pt.LINES:Pt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(h=>{const p=h[0].renderData.localOrigin;t.program.bindDraw(new Mj(p),e.bindParameters),this.numOriginsRendered++;for(let f=0;f<h.length;f++){const m=h[f],y=m.renderData.textureReference;if(!A(y)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(m),rae(m.renderData.geometryInfo.uvOffsetAndScale,y.offsetAndScale,d$),n.setUniform4fv("texOffsetAndScale",d$),n.bindTexture("tex",y.texture.texture);const v=m.renderData.textureFadeFactor,w=v<1?m.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&_(w)&&v<1?(rae(m.renderData.geometryInfo.uvOffsetAndScale,w.offsetAndScale,d$),n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",d$),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),m.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,t,m,c,o,i),m.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if(A(l))return;const c=t.program;n!==ba.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===J.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(jU,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};u([d({constructOnly:!0})],Fc.prototype,"overlayRenderer",void 0),u([d({constructOnly:!0})],Fc.prototype,"stage",void 0),u([d({readOnly:!0})],Fc.prototype,"isGlobal",null),u([d({constructOnly:!0})],Fc.prototype,"allTiles",void 0),u([d({constructOnly:!0})],Fc.prototype,"ellipsoidRadius",void 0),u([d({value:!1})],Fc.prototype,"renderingDisabled",null),u([d()],Fc.prototype,"renderPatchBorders",null),u([d()],Fc.prototype,"cullBackFaces",null),u([d({value:gM.FRONT_TO_BACK})],Fc.prototype,"renderOrder",null),u([d()],Fc.prototype,"wireframe",null),Fc=u([P("esri.views.3d.terrain.TerrainRenderer")],Fc);const odt=Fc;function rae(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const adt=M(),ldt=M(),Mx=M(),cdt=M();class udt{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let Zp=class extends Ee{constructor(e){super(e),this._handles=new Ht}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ae(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=at(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!_R(t)||t.isRejected())&&!(t.isFulfilled()&&!hdt(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||HF(t)))),e)if(e.isResolved()){const t=UU(e,this.viewSpatialReference,this.viewingMode);if(_(t)){const i=new Rr(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Ve.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Rr.makeWebMercatorAuxiliarySphere(t):Hb(e.spatialReference)&&(e=Rr.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ae(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ve.Global){const e=this.extentHelper.viewSpatialReference,t=Hb(e)||zf(e)||Bf(e);e.isWebMercator?this.tilingScheme=Rr.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Rr.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;_(e)&&!wb(e,this.extent)&&(this.tilingScheme=Rr.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function hdt(e,t,i){return _(UU(e,t,i))}u([d()],Zp.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],Zp.prototype,"extent",void 0),u([d({value:!1})],Zp.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],Zp.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],Zp.prototype,"layers",void 0),u([d({constructOnly:!0})],Zp.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],Zp.prototype,"viewingMode",void 0),Zp=u([P("esri.views.3d.terrain.TilingSchemeLogic")],Zp);class ddt{constructor(){this.offset=tt(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const Jh=fe.getLogger("esri.views.3d.terrain.TerrainSurface"),pdt=.25;let ei=class extends Kr.EventedMixin(Ee){constructor(e){var t,i;super(e),this._elevationBounds=new FZ,this._iteratorPool=new vs(dTe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new out,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new udt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=M(),this._eyePosSurfaceSR=M(),this._splitLimits=new Dut,this._snapLevel=1/0,this._frustum=ZO(),this._viewProjectionMatrix=Ae(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ht,this._watchUpdatingTracking=new _f,this._frameTask=g2,this._allTiles=new Vt,this._upsampleInfoPool=new vs(ddt),this._rootTilesExtent=Dt(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!((i=(t=e.view)==null?void 0:t.state)==null?void 0:i.isLocal)}initialize(){this._lercDecoder=Ict(this.view.resourceController),this._tilePool=this.view.state.isLocal?new vs(hht):new vs(dht);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new Mct(e.newCache("elevation-query")),this._set("overlayManager",new Za({surface:this})),this._handles.add([ae(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),ae(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new odt({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:wi(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([ae(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},Ps),ae(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},Ps),ae(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),Vi),ae(()=>this.backgroundColor,s=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(s)},Ps),ae(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),ae(()=>Gi.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?import("./TerrainTileTree3DDebugger.88c90441.js").then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&Gi.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=at(this._treeDebugger))},Ft)]),this._extentHelper=Xct(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new m2({getCollections:()=>{var s,n,o;return(o=(n=(s=this.view)==null?void 0:s.defaultsFromMap)==null?void 0:n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,i=new Zp({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(pf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(pf.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(yt.TERRAIN_SURFACE,this),this._handles.add([ae(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),Ft),ae(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Vi),ae(()=>this.extent,()=>this._updateRootTiles(),Ft),this.view.on("resize",()=>this._viewChangeUpdate()),ae(()=>{var o,a;const s=this.view,n=s.state;return[this.lodBias,this.lodSnapping,(a=(o=s.resourceController)==null?void 0:o.memoryController)==null?void 0:a.memoryFactor,n.camera,n.contentCamera,n.fixedContentCamera]},()=>this._viewChangeUpdate(),Ps),ae(()=>{var s,n;return(n=(s=this.view.qualitySettings)==null?void 0:s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,Ft),ae(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Vi)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Yi(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=at(this._upsampleMapCache),this._elevationQueryCache=at(this._elevationQueryCache),this._set("tilingSchemeLogic",at(this.tilingSchemeLogic)),this._extentHelper=at(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",at(this.overlayManager)),this._tilePool=at(this._tilePool),BZ.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=at(this._renderer),this._iteratorPool=at(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=at(this._upsampleInfoPool),Hct(),Iut()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,i;const e=(i=(t=this.view.pointsOfInterest)==null?void 0:t.contentCameraOnSurface)==null?void 0:i.scale;if(e){const r=this.view.state.contentCamera;let s=H5(this.view,r.eye,r.viewForward,r.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=R1e(this.view,e)-n;Math.abs(this._snapLevel-o)>pdt&&(Math.round(o)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=o)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?U2.ON:U2.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(A(t)||A(e))return null;const i=Dt(),r=Gxe(t,i,e)?i:null,s=this._get("extent");return wb(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=X$(this.groundExtent,this._userClippingExtent,Dt()),t=this._get("extent");return wb(e,t)?t:e}get groundExtent(){return _(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return _(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var t,i;const e=!this.renderingDisabled&&!this.opaque;(i=(t=this.view)==null?void 0:t._stage)==null||i.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,ho);return A(s)?null:lTe(ho[0],ho[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=ho){var o;const n=this.rootTiles;if(A(n)||!n.length||n[0].layerInfo[Wt.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=i,!Ks(s,r,s,(o=this.tilingScheme)==null?void 0:o.spatialReference))return Jh.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of n){if(!a.containsPoint(s))continue;for(;a&&!a.rendered&&!a.isLeaf;){let c=0;s[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),s[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c]}const l=a.renderData;return(l?l.geometryState.samplerData:null)?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!Pn(e,ho,this.spatialReference))return Jh.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(_(t)){for(let i of t)if(i==null?void 0:i.containsPoint(ho)){for(;!i.isLeaf&&!i.rendered;){let r=0;ho[0]>i.children[0].extent[2]&&(r+=1),ho[1]<i.children[0].extent[1]&&(r+=2),i=i.children[r]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100}getSphereElevationBounds(e,t,i,r,s){var c;if(ho[0]=e,ho[1]=t,ho[2]=i,ho[3]=r,!Ks(ho,s,ho,(c=this.tilingScheme)==null?void 0:c.spatialReference))return Jh.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&rJ(h.extent,ho))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this.rootTiles;if(_(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!Pn(e,ho,this.spatialReference))return Jh.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;ho[3]=t;let i=null;const r=n=>{if(n&&rJ(n.extent,ho))if(n.isLeaf||n.rendered){const o=this._getLodBiasCorrectedScale(n.level);i=i==null?o:Math.min(i,o)}else for(const o of n.children)r(o)},s=this.rootTiles;if(_(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?Rn.UNFADED:Rn.IMMEDIATE)}_updateTilingScheme(){var t,i;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(af(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(t=this.view)==null?void 0:t.state)==null?void 0:i.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return p$[0]=e,p$[1]=t,p$[2]=i,s.init(p$,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=gdt;let r=t.rootTilesInExtent(e,i,5*qT);if(_(this.rootTiles)){if(r.length>qT)return void Jh.warn(R9e);const s=this.rootTiles.map(o=>o.lij),n=B2e(s,r,sae);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>sae(l,a.lij))>-1)||(this._purgeTile(a,!0),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>qT&&(Jh.warn(O9e),r=t.rootTilesInExtent(e,i,qT)),this._setRootTiles(r.map(s=>this._newRootTile(s)));wb(i,this._rootTilesExtent)||(this._rootTilesExtent=Dt(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(s=>{s.isLoaded&&this._prepareToLoadTile(s)}),this._allTiles.forAll(s=>{s.isLoaded&&(this._updateTileGeometry(s),this._updateTileNeighborsAfterGeometryChange(s))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===_t.SPLIT&&t.setPendingUpdate(_t.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),_(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(_t.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(A(e))return;const t=cut(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(_t.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(_t.RENDERDATA);const c=l.computeVisibility();s||c?(l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),r=Math.max(l.elevationBounds[1],r))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(A(this._splitLimits.frustum)&&(this._splitLimits.frustum=ZO()),uF(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,uF(this._frustum,e.frustum),Fr(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),se(this._eyePosRenderSR,t.eye),Ks(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(kTe(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness()))):mdt(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const i=this.neighborTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const i=e.resetPendingUpdate(_t.TEXTURE_FADING)?_t.TEXTURE_FADING:!!e.resetPendingUpdate(_t.TEXTURE_NOFADING)&&_t.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){f$.spatialReference=this.spatialReference,f$.tile=e,f$.extent=e.extent,this.emit("elevation-change",f$)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const i=t.next();if(i.loadable){const r=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(r===_t.SPLIT){i.resetPendingUpdate(_t.MERGE),i.isLeaf&&(i.setPendingUpdate(_t.SPLIT),t.skipSubtree());continue}i.resetPendingUpdate(_t.SPLIT)&&i.updateAgentSuspension(),r===_t.VSPLITMERGE&&i.updateAgents(Wt.ELEVATION)}if(t.skipSubtree(),!i.isLeaf){i.setPendingUpdate(_t.MERGE),i.resetPendingUpdate(_t.SPLIT);const r=this._iteratorPool.acquire();r.resetOne(i);for(let s=r.next();!r.done;s=r.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);r.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(aut(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){this.neighborTilesToUpdate.size,this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const i of e)i.updateNeighborsWithChangedEdgeResolution()};(()=>{for(const i of e)i.updateNeighborDataAndGeometryIfNeeded()})(),t(),e.clear()})()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let i=!1;for(;!e.done;){i=!0;let r=!1;const s=!this._allTiles.some(n=>{if(n.resetPendingUpdate(_t.MERGE)){if(!t)return n.setPendingUpdate(_t.MERGE),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(_t.SPLIT)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(_t.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(t=>(t.resetPendingUpdate(_t.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Ms.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*E9e}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=De(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){_(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),i}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){af(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(_t.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){m$.spatialReference=this.spatialReference,m$.extent=e.extent,m$.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",m$)}_createTile(e,t,i,r){af(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===_t.SPLIT&&s.setPendingUpdate(_t.SPLIT)),s}_mergeTile(e){af(!e.hasPendingUpdate(_t.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(af(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),af(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(i=>this._prepareToLoadTile(i)),t.forEach(i=>this._loadTilePrepared(i)),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach(i=>i.updateNeighborsWithChangedEdgeResolution()),t.forEach(i=>i.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i)}}_postLoadTile(e){e.setPendingUpdate(_t.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,i){const r=new Wct(e.lij,e.extent,i);e.dataArrived(t,Wt.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=fE){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),fM(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);_(o)&&((o<r||A(r))&&(t=!0),r=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,i;let e=((i=(t=this.view.map)==null?void 0:t.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(qj(r)&&!Gfe(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(qF(e)){const t=sTe(e.layer.parent)?"normal":e.layer.blendMode;if(hut(wL[t]))return!0}return!1}_layerClassFromLayerView(e){return Hj(e)?Wt.ELEVATION:Wt.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(ae(()=>e.suspended,()=>this._updateTiledLayers())),t.push(ae(()=>e.fullOpacity,()=>this._updateTileTextures(Rn.UNFADED))),t.push(ae(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),qF(e)&&t.push(ae(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Rn.UNFADED)})),e.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,e.uid);_(r)&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach(r=>{if(!r.layer||r.suspended||!fM(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===Wt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}t[s].push(r)});for(const r of O1){const s=this._layerViews[r],n=t[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[r].set(p,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this.rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===Wt.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Wt.MAP),e===Rn.IMMEDIATE?this.renderer.updateTileTexture(t,_t.TEXTURE_NOFADING):t.updateRenderData(Wt.MAP,e)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Ms.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||pM(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],ve(F({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,jr(o)||this._dataMissing(e,i,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===Wt.ELEVATION?Hj(i)?this._requestElevationTileData(e,i,r):Promise.reject():qj(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=o=>{if(Xs(i))return;const a=this._layerIndexByUid[Wt.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):Jh.warn("TerrainSurface: received data from unknown layer %d %s",Wt.ELEVATION,e.lij.toString())},s=o=>{jr(o)||(this._dataMissing(e,Wt.ELEVATION,t,o),this.requestUpdate())};if(Roe(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:CO,signal:i.signal}).then(o=>{if(!Xs(i))return this._frameTask.schedule(()=>r(o),i.signal,s);Jh.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:CO},i.signal)).then(o=>{o?r({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue}):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,CS(h),Xs(i)||(this._dataMissing(e,Wt.MAP,t,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Xs(i)?CS(c):this._mapTileDataArrived(e,t,c)},i.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(pM(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],i).then(n,o)}if(FU(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if(LZ(t)&&Roe(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(c=>{if(Xs(i))return Jh.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(di());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);e8e(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(Wt.MAP,t.uid);_(r)?e.dataArrived(r,Wt.MAP,i):(CS(i),Jh.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);_(s)?e.dataMissing(s,t,r):Jh.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(A(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),_(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return _(r)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(A(e)||A(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return af(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{_(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){WB.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&WB.push(i)});const t=WB.toArray();return fTe(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var e;return!!((e=this.tilingScheme)==null?void 0:e.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var e;return this.isWebMercator&&sO((e=this.view)==null?void 0:e.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}};u([d()],ei.prototype,"_renderer",void 0),u([d()],ei.prototype,"_hasPendingUpdates",void 0),u([d()],ei.prototype,"_asyncWorkItems",void 0),u([d()],ei.prototype,"_allTilesDirty",void 0),u([d()],ei.prototype,"_allTilesSorted",void 0),u([d()],ei.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],ei.prototype,"_watchUpdatingTracking",void 0),u([d()],ei.prototype,"_frameTask",void 0),u([d({readOnly:!0})],ei.prototype,"snapLevel",null),u([d({readOnly:!0})],ei.prototype,"lodSnapping",null),u([d({constructOnly:!0})],ei.prototype,"view",void 0),u([d()],ei.prototype,"_userClippingExtent",null),u([d()],ei.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],ei.prototype,"extent",null),u([d({readOnly:!0})],ei.prototype,"groundExtent",null),u([d({readOnly:!0})],ei.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],ei.prototype,"updating",null),u([d(qct)],ei.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],ei.prototype,"updatingProgressValue",null),u([d()],ei.prototype,"_maxNumUpdating",void 0),u([d({aliasOf:"view.map.ground.opacity"})],ei.prototype,"baseOpacity",void 0),u([d()],ei.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],ei.prototype,"overlayManager",void 0),u([d({readOnly:!0})],ei.prototype,"viewingMode",null),u([d()],ei.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],ei.prototype,"ready",null),u([d({value:gM.FRONT_TO_BACK})],ei.prototype,"renderOrder",null),u([d({readOnly:!0})],ei.prototype,"rootTiles",void 0),u([d({readOnly:!0})],ei.prototype,"spatialReference",null),u([d({type:qe,aliasOf:"view.map.ground.surfaceColor"})],ei.prototype,"backgroundColor",void 0),u([d({value:!1})],ei.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],ei.prototype,"tilingScheme",void 0),u([d({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],ei.prototype,"tilingSchemeLocked",void 0),u([d({readOnly:!0})],ei.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],ei.prototype,"velvetOverground",null),u([ut("_renderer.wireframe")],ei.prototype,"wireframe",void 0),u([d({value:!1})],ei.prototype,"suspended",null),u([d({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],ei.prototype,"textureFadeDuration",void 0),u([d()],ei.prototype,"_layerViewsDirty",void 0),u([ut("_renderer.renderPatchBorders")],ei.prototype,"renderPatchBorders",void 0),u([ut("_renderer.renderingDisabled")],ei.prototype,"renderingDisabled",void 0),ei=u([P("esri.views.3d.terrain.TerrainSurface")],ei);const fdt=ei;function sae(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function kTe(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>kTe(t)))}function mdt(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const ho=Gt(),gdt=Dt(),p$=[0,0,0],WB=new Vt,f$={spatialReference:null,tile:null,extent:null,context:"ground"},m$={spatialReference:null,extent:null,scale:0};let ZA=class extends Ee{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach((o,a)=>{const l=o[0],c=o[1],h=o[2];let p=!1;if(c&Qt.Geometry.UPDATE){const f=n.get(a);if(f){const m=f[1];if(h&Qt.State.TRANSFORMATION){const y=this.model.getObject(s);this.model.updateRenderGeometryTransformation(y,l,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:h})}else dt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&Qt.Geometry.REMOVE||p){const f=n.get(a);f?(t.removes.push(f[1]),n.delete(a),f[0].disposed&&uw.pool.release(f[0])):c===Qt.Geometry.REMOVE&&dt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&Qt.Geometry.ADD||p){const f=this.model.getObject(s);if(_(f)){const m=this.model.getRenderGeometry(f,l),y=[l,m];t.adds.push(m),n.set(a,y)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,Qt.Geometry.UPDATE,0,0,Qt.Geometry.UPDATE,Qt.Geometry.ADD|Qt.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(Qt.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(Qt.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(Qt.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,Qt.Geometry.UPDATE,0,0,Qt.Geometry.UPDATE,Qt.Geometry.ADD|Qt.Geometry.REMOVE,Qt.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r[0],t,Qt.Geometry.UPDATE,0,0,Qt.Geometry.UPDATE,Qt.Geometry.ADD|Qt.Geometry.REMOVE,Qt.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,Qt.Geometry.ADD,Qt.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,Qt.Geometry.REMOVE,Qt.Geometry.ADD,Qt.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,o,a,l){i=vt(i,this._getParentLayerId(e));const c=e.id,h=t.id,p=this._ensureDirtyRecord(i,c),f=p.get(h);if(f){const m=f[1];m&s?(p.delete(h),f[0].disposed&&uw.pool.release(f[0])):m&n?(f[1]=r,f[2]=l):m&o?f[2]|=l:m&a||dt(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else p.set(h,[t,r,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return Ws(this._dirtyGeomRecords,e=>Ws(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return _(e.parentLayer)?e.parentLayer.id:vCe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const o=[];s.forEach(a=>{const l=a[1];o[l]||(o[l]=[]),o[l].push(a[0].geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)}}}};u([d({constructOnly:!0})],ZA.prototype,"model",void 0),u([d()],ZA.prototype,"dirty",void 0),ZA=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],ZA);const ydt=ZA;let CL=class extends Ee{constructor(){super(...arguments),this.dirtySet=new ydt({model:this}),this._content=new Map,this._originFactory=new dZ(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;dt(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),MF(e)&&this.dirtySet.layerAdded(e)}remove(e){dt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),MF(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)_(t)&&(dt(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)dt(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new B2(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,i){if(A(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<cp.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],CL.prototype,"dirtySet",void 0),CL=u([P("esri.views.3d.webgl-engine.parts.Model")],CL);function zTe(){const e=new Float32Array(4);return e[3]=1,e}function BTe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function vdt(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function VTe(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:zTe,clone:BTe,fromValues:vdt,createView:VTe},Symbol.toStringTag,{value:"Module"}));const ns=!0,gb={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function ZZ(e,t,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,i+gb.identifierOffset,gb.identifierLength)),version:t.getUint16(i+gb.versionOffset,ns),checksum:t.getUint32(i+gb.checksumOffset,ns)}}const Ul={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function _dt(e,t){return{sizeLo:e.getUint32(t+Ul.sizeLo,ns),sizeHi:e.getUint32(t+Ul.sizeHi,ns),minX:e.getFloat64(t+Ul.minX,ns),minY:e.getFloat64(t+Ul.minY,ns),minZ:e.getFloat64(t+Ul.minZ,ns),maxX:e.getFloat64(t+Ul.maxX,ns),maxY:e.getFloat64(t+Ul.maxY,ns),maxZ:e.getFloat64(t+Ul.maxZ,ns),errorX:e.getFloat64(t+Ul.errorX,ns),errorY:e.getFloat64(t+Ul.errorY,ns),errorZ:e.getFloat64(t+Ul.errorZ,ns),count:e.getUint32(t+Ul.count,ns),reserved:e.getUint32(t+Ul.reserved,ns)}}function Pwt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=ZZ(e,t,i);if(i+=gb.byteCount,r!=="LEPCC     ")throw new H("lepcc-decode-error","Bad identifier");if(s>1)throw new H("lepcc-decode-error","Unknown version");const n=_dt(t,i);if(i+=Ul.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new H("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(i=g$(e,i,a),i=g$(e,i,l),i=g$(e,i,c),i=g$(e,i,h),i!==e.byteLength)throw new H("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let y=0;for(let v=0;v<l[m];v++){y+=c[p];const w=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*y),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*w),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function g$(e,t,i){const r=[];t=Qj(e,t,r);const s=[];for(let n=0;n<r.length;n++){s.length=0,t=Qj(e,t,s);for(let o=0;o<s.length;o++)i.push(s[o]+r[n])}return t}function Qj(e,t,i){const r=new DataView(e,t),s=r.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=r.getUint32(1,ns),t+=5;else if(a===1)l=r.getUint16(1,ns),t+=3;else{if(a!==2)throw new H("lepcc-decode-error","Bad count type");l=r.getUint8(1),t+=2}if(o)throw new H("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(e,t,c);let p=0,f=0,m=0;const y=-1>>>32-n;for(let v=0;v<l;v++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;i[v]=p&y,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return t+m}const M1={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function bdt(e,t){return{sizeLo:e.getUint32(t+M1.sizeLo,ns),sizeHi:e.getUint32(t+M1.sizeHi,ns),count:e.getUint32(t+M1.count,ns),colorMapCount:e.getUint16(t+M1.colorMapCount,ns),lookupMethod:e.getUint8(t+M1.lookupMethod),compressionMethod:e.getUint8(t+M1.compressionMethod)}}function wdt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=ZZ(e,t,i);if(i+=gb.byteCount,r!=="ClusterRGB")throw new H("lepcc-decode-error","Bad identifier");if(s>1)throw new H("lepcc-decode-error","Unknown version");const n=bdt(t,i);if(i+=M1.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new H("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+i!==e.byteLength||n.colorMapCount>256)throw new H("lepcc-decode-error","Bad count");const o=new Uint8Array(e,i,3*n.colorMapCount),a=new Uint8Array(e,i+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+i!==e.byteLength||n.colorMapCount!==0)throw new H("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(i+3!==e.byteLength||n.colorMapCount!==1)throw new H("lepcc-decode-error","Bad count");const o=t.getUint8(i),a=t.getUint8(i+1),l=t.getUint8(i+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new H("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const P1={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function xdt(e,t){return{sizeLo:e.getUint32(t+P1.sizeLo,ns),sizeHi:e.getUint32(t+P1.sizeHi,ns),count:e.getUint32(t+P1.count,ns),scaleFactor:e.getUint16(t+P1.scaleFactor,ns),bitsPerPoint:e.getUint8(t+P1.bitsPerPoint),reserved:e.getUint8(t+P1.reserved)}}function Tdt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=ZZ(e,t,i);if(i+=gb.byteCount,r!=="Intensity ")throw new H("lepcc-decode-error","Bad identifier");if(s>1)throw new H("lepcc-decode-error","Unknown version");const n=xdt(t,i);if(i+=P1.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new H("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+i!==e.byteLength)throw new H("lepcc-decode-error","Bad size");const a=new Uint8Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+i!==e.byteLength)throw new H("lepcc-decode-error","Bad size");const a=new Uint16Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(Qj(e,i,a)!==e.byteLength)throw new H("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const Jj=fe.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Sdt(e,t,i){let r="",s=0;for(;s<i;){const n=e[t+s];if(n<128)r+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=i)throw new H("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&e[t+s+1];r+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=i)throw new H("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];r+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new H("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=i)throw new H("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);r+=String.fromCharCode(a,l)}else r+=String.fromCharCode(o);s+=4}}}return r}function GTe(e,t){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=Idt[o];i.fields[n.property]=a(e,r),r+=HU[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function Edt(e,t,i){const r=[];let s,n,o=0;for(n=0;n<e;n+=1){if(s=t[n],s>0){if(r.push(Sdt(i,o,s-1)),i[o+s-1]!==0)throw new H("string-array-error","Invalid string array: missing null termination.")}else r.push(null);o+=s}return r}function nae(e,t){return new HU[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function Cdt(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function Adt(e,t,i){const r=t.header!=null?GTe(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},s={header:r,byteOffset:r.byteCount,byteCount:0,entries:Object.create(null)};let n=r.byteCount;for(let o=0;o<t.ordering.length;o++){const a=t.ordering[o],l=ie(t[a]);if(l.count=r.fields.count,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=r.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new H("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!HTe(l.valueType))throw new H("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=AL(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function jTe(e,t,i){if(t!==e&&Jj.error(`Invalid ${i} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new H("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function Rdt(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function Iwt(e,t){const i=GTe(e,t&&t.header);let r=i.byteCount;const s={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const h=ve(F({},t.vertexAttributes[c]),{byteOffset:r,count:o}),p=oae[c]?oae[c]:"_"+c;s.vertexAttributes[p]=h,r+=AL(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const h=ve(F({},t.faces[c]),{byteOffset:r,count:a});s.faces[c]=h,r+=AL(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const h=ve(F({},t.featureAttributes[c]),{byteOffset:r,count:l});s.featureAttributes[c]=h,r+=(h.valueType==="UInt64"?8:AL(h.valueType))*h.valuesPerElement*l}}return jTe(r,e.byteLength,"geometry"),s.byteCount=r-s.byteOffset,s}function $wt(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?Rdt(e):Odt(t):Mdt(e.compressedAttributes.attributes)}function Odt(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e.ordering)if(e.vertexAttributes[i])switch(i){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function Mdt(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e)switch(i){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const oae={position:R.POSITION,normal:R.NORMAL,color:R.COLOR,uv0:R.UV0,region:R.UVREGION};function Pdt(e,t,i){if(e.encoding==="lepcc-rgb")return wdt(t);if(e.encoding==="lepcc-intensity")return Tdt(t);if(e.encoding!=null&&e.encoding!=="")throw new H("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(Jj.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&(Jj.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const r=Adt(t,e,i);jTe(r.byteOffset+r.byteCount,t.byteLength,"attribute");const s=r.entries.attributeValues||r.entries.objectIds;if(s){if(s.valueType==="String"){const n=r.entries.attributeByteCounts,o=nae(t,n),a=Cdt(t,s);return Edt(n.count,o,a)}return nae(t,s)}throw new H("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const HU={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},Idt={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function HTe(e){return HU.hasOwnProperty(e)}function AL(e){return HTe(e)?HU[e].BYTES_PER_ELEMENT:0}function $dt(e,t,i,r){const s=Ddt(e,t,i),n=Ae();return bu(i,s,n,r),n}const qTe=1,aae=5-qTe;function Ddt(e,t,i){const r=M(),s=e[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/aae)*aae+qTe);if(i.isGeographic){const l=n/wi(i).radius*180/Math.PI,c=Math.round(e[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(e[0]/p)*p;r[0]=f,r[1]=h}else{const l=Math.round(e[0]/n),c=Math.round(e[1]/n);r[0]=l*n,r[1]=c*n}const o=e[2]+t,a=Math.round(o/n);return r[2]=a*n,r}const H2=1e-6,RC=[0,0,0],y$=[0,0,0];function Ldt(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new jdt(e);RL(RC,n.minProj,n.maxProj),eb(RC,RC,.5),mh(y$,n.maxProj,n.minProj);const o=Kj(y$),a=new Hdt;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(Ndt(n,e,y,l,c,h,p,f,m,a)){case 1:return void hae(RC,y$,t);case 2:return void Gdt(e,p,t)}Fdt(e,y,l,c,h,p,f,m,a),WTe(e,a.b0,a.b1,a.b2,PS,IS);const v=[0,0,0];mh(v,IS,PS),a.quality=Kj(v),a.quality<o?XTe(a.b0,a.b1,a.b2,PS,IS,v,t):hae(RC,y$,t)}function Ndt(e,t,i,r,s,n,o,a,l,c){return Udt(e,r,s),eH(r,s)<H2?1:(mh(o,r,s),yo(o,o),kdt(t,r,o,n)<H2?2:(mh(a,s,n),yo(a,a),mh(l,n,r),yo(l,l),gh(i,a,o),yo(i,i),I1(t,i,o,a,l,c),0))}const OC=[0,0,0],MC=[0,0,0],Uu=[0,0,0],ku=[0,0,0],zu=[0,0,0],$y=[0,0,0],Dy=[0,0,0],Ly=[0,0,0];function Fdt(e,t,i,r,s,n,o,a,l){zdt(e,t,i,OC,MC),OC[0]!==void 0&&(mh(Uu,OC,i),yo(Uu,Uu),mh(ku,OC,r),yo(ku,ku),mh(zu,OC,s),yo(zu,zu),gh($y,ku,n),yo($y,$y),gh(Dy,zu,o),yo(Dy,Dy),gh(Ly,Uu,a),yo(Ly,Ly),I1(e,$y,n,ku,Uu,l),I1(e,Dy,o,zu,ku,l),I1(e,Ly,a,Uu,zu,l)),MC[0]!==void 0&&(mh(Uu,MC,i),yo(Uu,Uu),mh(ku,MC,r),yo(ku,ku),mh(zu,MC,s),yo(zu,zu),gh($y,ku,n),yo($y,$y),gh(Dy,zu,o),yo(Dy,Dy),gh(Ly,Uu,a),yo(Ly,Ly),I1(e,$y,n,ku,Uu,l),I1(e,Dy,o,zu,ku,l),I1(e,Ly,a,Uu,zu,l))}function Udt(e,t,i){let r=eH(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=eH(e.maxVert[n],e.minVert[n]);o>r&&(r=o,s=n)}sc(t,e.minVert[s]),sc(i,e.maxVert[s])}const Bu=[0,0,0];function kdt(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Bu[0]=s[l]-t[0],Bu[1]=s[l+1]-t[1],Bu[2]=s[l+2]-t[2];const c=i[0]*Bu[0]+i[1]*Bu[1]+i[2]*Bu[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=Bu[0]*Bu[0]+Bu[1]*Bu[1]+Bu[2]*Bu[2]-c*c/h;p>o&&(o=p,a=l)}return sc(r,s,a),o}const cn=[0,0];function zdt(e,t,i,r,s){Vdt(e,t,cn,s,r);const n=ZTe(i,t);cn[1]-H2<=n&&(r[0]=void 0),cn[0]+H2>=n&&(s[0]=void 0)}const lae=[0,0,0],cae=[0,0,0],uae=[0,0,0],Px=[0,0,0],Ix=[0,0,0],v$=[0,0,0];function I1(e,t,i,r,s,n){if(YTe(t)<H2)return;gh(lae,i,t),gh(cae,r,t),gh(uae,s,t),MS(e,t,cn),Ix[1]=cn[0],Px[1]=cn[1],v$[1]=Px[1]-Ix[1];const o=[i,r,s],a=[lae,cae,uae];for(let l=0;l<3;++l){MS(e,o[l],cn),Ix[0]=cn[0],Px[0]=cn[1],MS(e,a[l],cn),Ix[2]=cn[0],Px[2]=cn[1],v$[0]=Px[0]-Ix[0],v$[2]=Px[2]-Ix[2];const c=Kj(v$);c<n.quality&&(sc(n.b0,o[l]),sc(n.b1,t),sc(n.b2,a[l]),n.quality=c)}}const Bdt=[0,0,0];function MS(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function Vdt(e,t,i,r,s){const{data:n,size:o}=e;sc(r,n),sc(s,r),i[0]=ZTe(Bdt,t),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<i[0]&&(i[0]=l,sc(r,n,a)),l>i[1]&&(i[1]=l,sc(s,n,a))}}function hae(e,t,i){sc(i.center,e),eb(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const mm=[0,0,0],$x=[0,0,0],PC=[0,0,0],PS=[0,0,0],IS=[0,0,0],dae=[0,0,0];function Gdt(e,t,i){sc(mm,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?mm[0]=0:Math.abs(t[1])>Math.abs(t[2])?mm[1]=0:mm[2]=0,YTe(mm)<H2&&(mm[0]=mm[1]=mm[2]=1),gh($x,t,mm),yo($x,$x),gh(PC,t,$x),yo(PC,PC),WTe(e,t,$x,PC,PS,IS),mh(dae,IS,PS),XTe(t,$x,PC,PS,IS,dae,i)}function WTe(e,t,i,r,s,n){MS(e,t,cn),s[0]=cn[0],n[0]=cn[1],MS(e,i,cn),s[1]=cn[0],n[1]=cn[1],MS(e,r,cn),s[2]=cn[0],n[2]=cn[1]}const _$=[0,0,0],Op=[1,0,0,0,1,0,0,0,1],Dx=[0,0,0];function XTe(e,t,i,r,s,n,o){Op[0]=e[0],Op[1]=e[1],Op[2]=e[2],Op[3]=t[0],Op[4]=t[1],Op[5]=t[2],Op[6]=i[0],Op[7]=i[1],Op[8]=i[2],qdt(o.quaternion,Op),RL(Dx,r,s),eb(Dx,Dx,.5),eb(o.center,e,Dx[0]),eb(_$,t,Dx[1]),RL(o.center,o.center,_$),eb(_$,i,Dx[2]),RL(o.center,o.center,_$),eb(o.halfSize,n,.5)}const Ac=7;class jdt{constructor(t){this.minVert=new Array(Ac),this.maxVert=new Array(Ac);const i=64*Ac;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Ac),r+=8*Ac,this.maxProj=new Float64Array(this.buffer,r,Ac),r+=8*Ac;for(let l=0;l<Ac;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Ac;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Ac;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(Ac),n=new Array(Ac),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<Ac;++l){let c=s[l];sc(this.minVert[l],o,c),c=n[l],sc(this.maxVert[l],o,c)}}}class Hdt{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function Kj(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function RL(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function mh(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function eb(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function sc(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function gh(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function yo(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function YTe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function eH(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function ZTe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function qdt(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+r]+t[3*r+s])*o,e[n]=(t[3*n+r]+t[3*r+n])*o}}const XR=qg(),yb=M(),Wdt=M(),Xdt=Sr();class Dwt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:oq(this.buffer,56*a+0),halfSize:Kve(this.buffer,56*a+24),quaternion:VTe(this.buffer,56*a+36)}}}function QZ(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:$s(e),halfSize:rF(t),quaternion:BTe(i)}}function pae(e){return QZ(e.center,e.halfSize,e.quaternion)}function Lwt(e,t){se(t.center,e.center),se(t.halfSize,e.halfSize),JM(t.quaternion,e.quaternion)}function QTe(e,t){return t=t||QZ(),Ldt(e,t),t}function $1(e,t){const i=sr(t,e.center),r=qU(e,t);return i>r?1:i<-r?-1:0}function Nwt(e,t){t||(t=Ls());const i=L5(Xdt,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function Fwt(e,t){return sr(t,e.center)-qU(e,t)}function Uwt(e,t){return sr(t,e.center)+qU(e,t)}function kwt(e,t){return $1(e,t[0])<=0&&$1(e,t[1])<=0&&$1(e,t[2])<=0&&$1(e,t[3])<=0&&$1(e,t[4])<=0&&$1(e,t[5])<=0}function zwt(e,t,i,r=0){Ug(XR,e.quaternion),pe(yb,t,e.center);const s=uu(yb,yb,XR),n=uu(Wdt,i,XR);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+e.halfSize[l]-s[l])/n[l],h=(-r-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+r||s[l]<-e.halfSize[l]-r)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function qU(e,t){Ug(XR,e.quaternion),uu(yb,t,XR);const i=e.halfSize;return Math.abs(yb[0]*i[0])+Math.abs(yb[1]*i[1])+Math.abs(yb[2]*i[2])}function JTe(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],uu(r,r,e.quaternion),de(r,r,e.center)}}function Ydt(e){return uq(e.halfSize)}function KTe(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function Bwt(e){var t;if(he("disable-feature:i3s-draco")||!e)return!1;for(const i of e)for(const r of i.geometryBuffers)if(((t=r.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function Vwt(e,t,i,r,s,n){const o=t!==r;s.traverse(i,a=>{let l=a.mbs;return o&&(l=Zdt,XIe(a.mbs,r,l,t)),Qdt(e,l)!==vb.OUTSIDE&&(n(a),!0)})}function Gwt(e,t,i){let r=0,s=0;for(let n=0;n<t.length&&r<e.length;n++)e[r]===t[n]&&(i(n)&&(e[s]=e[r],s++),r++);e.length=s}function jwt(e,t,i){let r=0,s=0;for(;r<i.length;)ice(e,i[r])>=0===t&&(i[s]=i[r],s++),r++;i.length=s}const IC=Dt();function Hwt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return IC[0]=(e[0]-t.position[0])/t.rotationScale[0],IC[1]=(e[1]-t.position[1])/t.rotationScale[4],IC[2]=(e[2]-t.position[0])/t.rotationScale[0],IC[3]=(e[3]-t.position[1])/t.rotationScale[4],IC}const Zdt=Gt();var vb;function Qdt(e,t){const i=t[0],r=t[1],s=t[3],n=e[0]-i,o=i-e[2],a=e[1]-r,l=r-e[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?vb.OUTSIDE:p>0?vb.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?vb.INSIDE:vb.INTERSECTS_CENTER_INSIDE}function Jdt(e,t,i){const r=[],s=i&&i.missingFields,n=i&&i.originalFields;for(const o of e){const a=o.toLowerCase();let l=!1;for(const c of t)if(a===c.name.toLowerCase()){r.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return r}async function qwt(e,t,i,r,s){if(t.length===0)return[];const n=e.attributeStorageInfo;if(_(e.associatedLayer))try{return await ept(e.associatedLayer,t,i,r)}catch(o){if(e.associatedLayer.loaded)throw o}if(n){const o=Kdt(t,i,s);if(A(o))throw new H("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=e.parsedUrl.path,l=await Promise.all(o.map(c=>tpt(a,n,c.node,c.indices,r).then(h=>{for(let p=0;p<c.graphics.length;p++){const f=c.graphics[p],m=h[p];if(f.attributes)for(const y in f.attributes)y in m||(m[y]=f.attributes[y]);f.attributes=m}return c.graphics})));return rce(l)}throw new H("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function Kdt(e,t,i){const r=new Map,s=[],n=i();for(const o of e){const a=o.attributes[t];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=r.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),r.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function ept(e,t,i,r){t.sort((l,c)=>l.attributes[i]-c.attributes[i]);const s=t.map(l=>l.attributes[i]),n=[],o=Jdt(r,e.fields,{originalFields:n}),a=await eSe(e,s,o);for(let l=0;l<t.length;l++){const c=t[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return t}function eSe(e,t,i){const r=e.capabilities.query.maxRecordCount;if(r!=null&&t.length>r){const n=G2e(t,r);return Promise.all(n.map(o=>eSe(e,o,i))).then(rce)}const s=new _h({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===t.length)return n.features.map(o=>o.attributes);throw new H("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function tpt(e,t,i,r,s){const n=[];for(const o of t)if(o&&s.includes(o.name)){const a=`${e}/nodes/${i.resources.attributes}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return Zo(n.map(o=>ai(o.url,{responseType:"array-buffer"}).then(a=>Pdt(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of r){const c={};for(let h=0;h<o.length;h++)o[h].value!=null&&(c[n[h].storageInfo.name]=spt(o[h].value,l));a.push(c)}return a})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(vb||(vb={}));const ipt=-32768,rpt=-(2**31);function spt(e,t){if(!e)return null;const i=e[t];return ace(e)?i===ipt?null:i:lce(e)?i===rpt?null:i:i!=i?null:i}function npt(e){const t=e.store.indexCRS||e.store.geographicCRS,i=t===void 0?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new H("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new H("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new Ke(KTe(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function opt(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=t===void 0?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new H("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new H("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new Ke(KTe(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function Wwt(e,t){return A(t)?"@null":t===If(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function tH(e,t,i){if(!Df(e,t))throw new H("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(i==="local"&&!apt(e,t))throw new H("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function apt(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function lpt(e,t,i){const r=npt(e),s=opt(e);tH(r,t,i),tH(s,t,i)}function cpt(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Xwt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!cpt(e.store.defaultGeometrySchema))throw new H("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function Ywt(e,t){lpt(e,t.spatialReference,t.viewingMode)}function upt(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Zwt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!upt(e.store.defaultGeometrySchema))throw new H("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Qwt(e,t){tH(e.spatialReference,t.spatialReference,t.viewingMode)}function hpt(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function dpt(e){return e.type==="mesh-3d"}function Jwt(e){if(e==null||!hpt(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const i of t){if(!dpt(i)||i.symbolLayers.length===0)return!0;for(const r of i.symbolLayers.items)if(r.type!=="fill"||A(r.material)||A(r.material.color)||r.material.colorMixMode!=="replace")return!0}return!1}const Kwt=Jbe({color:[0,0,0,0],opacity:0});class ppt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function ext(e){const t=new ppt;let i=!1,r=!1;for(const s of e.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(_(n)&&!i){const a=n.color,l=Gwe(n.colorMixMode);_(a)?t.material={color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:ys.Multiply},t.castShadows=s.castShadows,i=!0}_(o)&&!r&&(t.edgeMaterial=Qbe(o,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:ys.Multiply}),t}function txt(e,t){return(0|e)+(0|t)|0}function fpt(e,t,i,r,s=0){r===If(r)?t.isGeographic?wpt(e,i,t,s):bpt(e,i,t,s):t.isWGS84&&(r.isWebMercator||sO(r))?gpt(t,e,r,i,s):t.isWebMercator&&sO(r)?_pt(t,e,r,i,s):e===i?(i.center[2]+=s,lr(i.center,t,0,i.center,r,0,1)):(te(i.center,e.center[0],e.center[1],e.center[2]+s),lr(i.center,t,0,i.center,r,0,1),JM(i.quaternion,e.quaternion),se(i.halfSize,e.halfSize))}function mpt(e,t,i,r,s){if(JM(s.quaternion,e.quaternion),r===Ve.Global){Ug(b$,e.quaternion),uu(Ny,e.center,b$),B8(Lx,Ny),Zue(Nx,Lx,e.halfSize),uc(Nx,Lx,Nx);const n=Oe(Nx);de(Nx,Lx,e.halfSize);const o=Oe(Nx);if(n<i)se(s.center,e.center),te(Ny,i,i,i),de(s.halfSize,e.halfSize,Ny);else{const a=o>0?1+t/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;oe(s.halfSize,Lx,h),tb(s.halfSize,s.halfSize,e.halfSize,c),oe(s.center,Lx,c),tb(s.center,s.center,e.halfSize,h),Yue(Ny,Ny),v4(s.center,s.center,Ny),uu(s.center,s.center,s.quaternion)}}else{const n=te(Ny,0,0,1);tb(s.center,e.center,n,(i+t)/2),Ug(b$,e.quaternion),uu(n,n,b$),B8(n,n),tb(s.halfSize,e.halfSize,n,(i-t)/2)}return s}const Ny=M(),Lx=M(),Nx=M(),b$=qg();function gpt(e,t,i,r,s){se(B0,t.center),B0[2]+=s;const n=If(i);lr(B0,e,0,B0,n,0,1),tSe(n,t,B0,i,r)}const OL=new Float64Array(24),ypt={data:OL,size:3},fae=M(),B0=M(),vpt=Sr();function _pt(e,t,i,r,s){se(B0,t.center),B0[2]+=s,tSe(e,t,B0,i,r)}function tSe(e,t,i,r,s){const n=L5(vpt,t.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)fae[a]=t.halfSize[a]*((o&1<<a)!=0?-1:1);for(let a=0;a<3;++a){let l=i[a];for(let c=0;c<3;++c)l+=fae[c]*n[3*c+a];OL[3*o+a]=l}}lr(OL,e,0,OL,r,0,8),QTe(ypt,s)}function bpt(e,t,i,r){JTe(e,iH),te(t.center,e.center[0],e.center[1],e.center[2]+r),bu(i,t.center,Rc,If(i)),te(t.center,Rc[12],Rc[13],Rc[14]);const s=2*Math.sqrt(1+Rc[0]+Rc[5]+Rc[10]);Qm[0]=(Rc[6]-Rc[9])/s,Qm[1]=(Rc[8]-Rc[2])/s,Qm[2]=(Rc[1]-Rc[4])/s,Qm[3]=.25*s,ZX(t.quaternion,Qm,e.quaternion),Ug(Qm,t.quaternion);let n=0,o=0,a=0;for(const l of iH)l[2]+=r,lr(l,i,0,l,If(i),0,1),uc(vi,l,t.center),uu(vi,vi,Qm),n=Math.max(n,Math.abs(vi[0])),o=Math.max(o,Math.abs(vi[1])),a=Math.max(a,Math.abs(vi[2]));te(t.halfSize,n,o,a)}function wpt(e,t,i,r){const s=wi(i),n=1+Math.max(0,r)/(s.radius+e.center[2]);te(t.center,e.center[0],e.center[1],e.center[2]+r),lr(t.center,i,0,t.center,If(i),0,1),JM(t.quaternion,e.quaternion),Ug(Qm,e.quaternion),te(vi,0,0,1),uu(vi,vi,Qm),te(vi,e.halfSize[0]*Math.abs(vi[0]),e.halfSize[1]*Math.abs(vi[1]),e.halfSize[2]*Math.abs(vi[2])),oe(vi,vi,s.inverseFlattening),de(t.halfSize,e.halfSize,vi),oe(t.halfSize,t.halfSize,n)}function ixt(e,t,i,r,s,n){if(!n||n.length===0||A(t))return null;const o=$dt(e.mbs,s,i,t);let a;us(x$,o);const l=()=>{if(!a)if(a=iH,vu(w$),_(e.serviceObb)){fpt(e.serviceObb,i,mae,t,s),JTe(mae,a);for(const m of a)ke(m,m,x$),hS(w$,m)}else{const m=e.mbs,y=m[3];Ks(m,i,vi,t),ke(vi,vi,x$),vi[2]+=s;for(let v=0;v<8;++v){const w=1&v?y:-y,b=2&v?y:-y,S=4&v?y:-y,T=a[v];se(T,[vi[0]+w,vi[1]+b,vi[2]+S]),hS(w$,T)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const y=m.geometry;if(!y.hasZ)return;vu(XB);const v=y.spatialReference||r,w=y.rings.reduce((b,S)=>S.reduce((T,E)=>(Ks(E,v,vi,t),ke(vi,vi,x$),hS(XB,vi),Math.min(vi[2],T)),b),1/0);l(),$M(w$,XB)&&(c=Math.min(c,w),h=Math.max(h,w))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,y,v)=>{ke(vi,v,o),m[y+0]=vi[0],m[y+1]=vi[1],m[y+2]=vi[2],y+=24,v[2]=c,ke(vi,v,o),m[y+0]=vi[0],m[y+1]=vi[1],m[y+2]=vi[2],y+=24,v[2]=h,ke(vi,v,o),m[y+0]=vi[0],m[y+1]=vi[1],m[y+2]=vi[2]};for(let m=0;m<8;++m)f(gae.data,3*m,a[m]);return QTe(gae)}function rxt(e){return _(e)&&e.halfSize[0]>=0}function sxt(e){return e[3]>=0}function nxt(e){_(e)&&(e.halfSize[0]=-1)}function oxt(e){_(e)&&(e[3]=-1)}const Rc=Ae(),Qm=zTe(),iH=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],XB=Dt(),w$=Dt(),mae=QZ(),vi=[0,0,0],gae={data:new Array(72),size:3},x$=Ae();class xpt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Tpt(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}}function Tpt(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class Spt extends uU{constructor(t,i){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=MH(i);const r=this.count;this.visibility=new xpt(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return A(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return A(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return A(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((A(this.cachedHighlightRanges)||A(this.cachedDefaultRanges))&&_(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=Ept(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function Ept(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}class rH extends uU{constructor(){super(...arguments),this.visible=$S.Hidden}}var $S;u([go()],rH.prototype,"renderable",void 0),u([go()],rH.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}($S||($S={}));function Cpt(e,t,i,r){if(i>=t)return e;e==null&&(e=Apt());const s=e.isVisibleBit;let n=e.data;const o=rSe(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const m=a+1,y=Math.ceil(h.length*1.5),v=c+1;let w=Math.max(m,y);w=Math.min(w,v),n=new Uint32Array(w),n.set(h)}return a<n.length&&(n[a]=Opt(n[a],l,p)),e.data=n,e}function iSe(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=rSe(r);return t<r.length*s?Rpt(i,r,t,s):!e.isVisibleBit}function Apt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function Rpt(e,t,i,r){const s=i/r|0,n=i-s*r;return Mpt(t[s],n)===e}function rSe(e){return e.BYTES_PER_ELEMENT*8}function Opt(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function Mpt(e,t){return(e&1<<t)!=0}class Ppt{constructor(t,i){this._indices=_(t.indices)?t.indices:M2(t.positions.length/3),this._positions=new ji(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(_(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,h=this._components.offsets,p=K1e(t,i,Ipt),f=t[2],m=i[2];this._components.visibility.forEachComponent(y=>{if(!iSe(this._components.pickability,y))return!0;const v=this.getComponentAabb(y,$pt);if(_(o)){const E=o[y];_(n)?n.componentOffset=E:(t[2]=f-E,i[2]=m-E)}if(_(n)&&n.applyToAabb(v),!HY(v,t,p,r))return!0;const w=h[y]/3,b=h[y+1]/3,S=(E,C,O)=>{a(y,E,ec(C,C,s),O)},T=b-w;return A(n)&&T>LTe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new j2(this._indices,w,b,l)),this._componentIntersectionData[y].intersectRay({r0:t,r1:i},S)):s3(t,i,w,b,c,l,void 0,n,S),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,v=-1/0;for(let w=l;w<c;w++){const b=i[w]*s,S=r[b],T=r[b+1],E=r[b+2];h=Math.min(h,S),p=Math.min(p,T),f=Math.min(f,E),m=Math.max(m,S),y=Math.max(y,T),v=Math.max(v,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=y,this._perComponentAabbs[o++]=v}}get positions(){return this._positions}get indices(){return this._indices}}const Ipt=M(),$pt=Ls();class Dpt{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}dispose(){this.material.dispose(),this.geometry.dispose()}}class sSe extends uU{constructor(t,i,r,s){super(),this.primitiveType=i,this.parameters=r,this.indexed=s,this.vao=t}}u([go()],sSe.prototype,"vao",void 0);function Lpt(e,t){return{near:e,far:t}}function b3(e){return e?yM(e,1/0,-1/0):Lpt(1/0,-1/0)}function yM(e,t,i){return e.near=t,e.far=i,e}function q2(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function T$(e,t){return e.near<=t&&t<=e.far}const sH={near:0,far:0};function Npt(e,t){const i=b3(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=_(o.offsetObb)?o.offsetObb:o.obb,l=xe(uc(Uc,a.center,r),n),c=qU(a,n);if(T$(i,l-c)&&T$(i,l+c))return;const h=Bpt(a,s);if(h===-1)return;if(h===0)return gm.far=l+c,gm.near=l-c,void q2(i,gm);const p=S$.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<S$.length;o++){const a=S$.data[o];if(T$(i,a.near)&&T$(i,a.far))continue;gm.far=a.far,gm.near=1/0,zpt(_(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,Fpt,c=>{let h=Upt;for(let p=0;p<nSe&&c.length>0;p++){if((a.mask&1<<p)==0)continue;kpt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){te(el,c.data[p+0],c.data[p+1],c.data[p+2]);const f=xe(uc(el,el,r),n);gm.near=Math.min(gm.near,f)}})===0&&(gm.near=0),q2(i,gm)}return S$.length=0,i}const S$=new Vt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),gm=b3(),el=M(),V_=M(),Fpt=new Vt({deallocator:null}),Upt=new Vt({deallocator:null});function kpt(e,t,i){i.length=0;const r=t.length-3;YB(el,t,r);const s=sr(e,el);s<=0&&(i.push(el[0]),i.push(el[1]),i.push(el[2]));let n=0,o=s;for(;n<r;n+=3){YB(V_,t,n);const a=sr(e,V_);o*a<0&&(tn(el,V_,el,a/(a-o)),tl(i,el)),a<=0&&tl(i,V_),o=a,se(el,V_)}o*s<0&&(YB(V_,t,r),tn(el,V_,el,s/(s-o)),tl(i,el))}function YB(e,t,i){return te(e,t.data[i+0],t.data[i+1],t.data[i+2])}function tl(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function zpt(e,t,i,r){Ug(vae,e.quaternion),uc(Uc,t,e.center),uu(Uc,Uc,vae);const s=8*((Uc[0]<-e.halfSize[0]?-1:Uc[0]>e.halfSize[0]?1:0)+3*(Uc[1]<-e.halfSize[1]?-1:Uc[1]>e.halfSize[1]?1:0)+9*(Uc[2]<-e.halfSize[2]?-1:Uc[2]>e.halfSize[2]?1:0)+13),n=yae[s];if(n===0)return n;L5(E$,e.quaternion),cY(E$,E$,e.halfSize);const o=(a,l)=>{const c=yae[s+l+1];return te(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),ec(a,a,E$),de(a,e.center,a)};return i.length=0,tl(i,o(ZB,0)),tl(i,o(_ae,1)),tl(i,o(Uc,2)),tl(i,o(bae,3)),r(i),n===1||(i.length=0,tl(i,ZB),tl(i,bae),tl(i,o(Uc,4)),tl(i,o(wae,5)),r(i),n===2||(i.length=0,tl(i,ZB),tl(i,wae),tl(i,o(Uc,6)),tl(i,_ae),r(i))),n}const yae=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),nSe=4;function Bpt(e,t){let i=0;for(let r=0;r<nSe;r++){const s=$1(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const E$=Sr(),vae=qg(),Uc=M(),ZB=M(),_ae=M(),bae=M(),wae=M();class Vpt{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?Npt(t,this._objects.visibleObjects):null}}function Gpt(e){const t=es().vec3f(R.POSITION);return e.normals&&t.vec2i16(R.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===Zs.Default?t.vec2f(R.UV0):e.textureCoordinates===Zs.Atlas&&(t.vec2f(R.UV0),t.vec4u16(R.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(R.COLOR,{glNormalized:!0}),t.alignTo(4)}class jpt extends Hr{constructor(t,i){super(t,"int",Li.Draw,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}var Kd;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(Kd||(Kd={}));const JZ=429496.7296;function oSe(e,t){eM(e/JZ*.5+.5,t)}function Hpt(e,t){switch(t.componentData){case Kd.Varying:return qpt(e);case Kd.Uniform:return Wpt(e);case Kd.COUNT:return;default:t.componentData}}function qpt(e){const{vertex:t,fragment:i}=e;t.include(yc),t.uniforms.add([new $r("componentColorTex"),new vg("componentColorTexInvDim")]),e.attributes.add(R.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(Hwe),t.constants.add("elevationScale","float",2*JZ),t.code.add(x`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),i.code.add(x`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function Wpt(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new ZF("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new jpt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(x`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(x`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var wh;function Xpt(e,t){const i=e.vertex;switch(i.code.add(x`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case wh.None:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) {}`);break;case wh.Opaque:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case wh.Transparent:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(wh||(wh={}));var Tf;function axt(e){return e&&zf(e)?Tf.Mars:e&&Bf(e)?Tf.Moon:Tf.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(Tf||(Tf={}));var xae,iu;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(xae||(xae={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(iu||(iu={}));class oi extends Da{constructor(){super(...arguments),this.output=J.Color,this.textureCoordinateType=Zs.None,this.componentData=Kd.Uniform,this.cullFace=ar.Back,this.vertexDiscardMode=wh.None,this.doubleSidedMode=Nr.WindingOrder,this.alphaDiscardMode=nr.Opaque,this.integratedMeshMode=iu.None,this.transparencyPassType=gt.NONE,this.ellipsoidMode=Tf.Earth,this.pbrMode=Rt.Disabled,this.normalType=xr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}u([G({count:J.COUNT})],oi.prototype,"output",void 0),u([G({count:Zs.COUNT})],oi.prototype,"textureCoordinateType",void 0),u([G({count:Kd.COUNT})],oi.prototype,"componentData",void 0),u([G({count:ar.COUNT})],oi.prototype,"cullFace",void 0),u([G({count:wh.COUNT})],oi.prototype,"vertexDiscardMode",void 0),u([G({count:Nr.COUNT})],oi.prototype,"doubleSidedMode",void 0),u([G({count:nr.COUNT})],oi.prototype,"alphaDiscardMode",void 0),u([G({count:iu.COUNT})],oi.prototype,"integratedMeshMode",void 0),u([G({count:gt.COUNT})],oi.prototype,"transparencyPassType",void 0),u([G({count:Tf.COUNT})],oi.prototype,"ellipsoidMode",void 0),u([G({count:Rt.COUNT})],oi.prototype,"pbrMode",void 0),u([G({count:xr.COUNT})],oi.prototype,"normalType",void 0),u([G()],oi.prototype,"spherical",void 0),u([G()],oi.prototype,"doublePrecisionRequiresObfuscation",void 0),u([G()],oi.prototype,"hasVertexColors",void 0),u([G()],oi.prototype,"hasNormals",void 0),u([G()],oi.prototype,"hasSlicePlane",void 0),u([G()],oi.prototype,"hasBaseColorTexture",void 0),u([G()],oi.prototype,"receiveAmbientOcclusion",void 0),u([G()],oi.prototype,"receiveShadows",void 0),u([G()],oi.prototype,"blendingEnabled",void 0),u([G()],oi.prototype,"hasScreenSpaceReflections",void 0),u([G()],oi.prototype,"hasPolygonOffset",void 0),u([G()],oi.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([G()],oi.prototype,"hasEmissionTexture",void 0),u([G()],oi.prototype,"hasOcclusionTexture",void 0),u([G()],oi.prototype,"hasNormalTexture",void 0),u([G()],oi.prototype,"hasOccludees",void 0),u([G()],oi.prototype,"hasMultipassTerrain",void 0),u([G()],oi.prototype,"cullAboveGround",void 0),u([G()],oi.prototype,"isGround",void 0),u([G()],oi.prototype,"hasCloudsReflections",void 0),u([G()],oi.prototype,"snowCover",void 0),u([G({constValue:Li.Draw})],oi.prototype,"pbrTextureBindType",void 0),u([G({constValue:!0})],oi.prototype,"hasSliceHighlight",void 0),u([G({constValue:!1})],oi.prototype,"hasSliceInVertexProgram",void 0),u([G({constValue:!1})],oi.prototype,"useCustomDTRExponentForWater",void 0),u([G({constValue:!1})],oi.prototype,"hasVertexTangents",void 0),u([G({constValue:!0})],oi.prototype,"supportsTextureAtlas",void 0),u([G({constValue:!1})],oi.prototype,"highStepCount",void 0),u([G({constValue:!1})],oi.prototype,"instancedDoublePrecision",void 0),u([G({constValue:!0})],oi.prototype,"useFillLights",void 0);function Tae(e,t){e.include(Uw,t),e.fragment.include(aM);const i=e.fragment;i.uniforms.add(new ZF("baseColor",r=>r.baseColor)),i.uniforms.add(new Wwe("objectOpacity",r=>r.objectOpacity)),t.hasVertexColors?i.code.add(x`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(x`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(x`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Sae(e,t){const i=e.fragment;switch(t.doubleSidedMode){case Nr.None:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Nr.View:e.include(ES,t),i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Nr.WindingOrder:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case Nr.COUNT:}switch(t.normalType){case xr.Attribute:case xr.CompressedAttribute:e.include(fU,t),i.code.add(x`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case xr.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(ES,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case xr.Ground:t.spherical?(e.include(ES,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(x`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case xr.COUNT:}}function Ypt(e,t){const i=e.fragment;if(t.hasBaseColorTexture){e.include(KX,t);const r=t.textureCoordinateType===Zs.Atlas;i.uniforms.add(PR("baseColorTexture",s=>s.texture,r)),r?(e.include(s_e),i.code.add(x`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):i.code.add(x`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(x`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const aSe=new Map([[R.POSITION,0],[R.NORMAL,1],[R.NORMALCOMPRESSED,1],[R.COLOR,2],[R.UV0,3],[R.UVREGION,4],[R.COMPONENTINDEX,5]]);function Zpt(e){const t=new Hi;t.include(ES,e),t.include(fU,e),t.include(Uw,e),t.include(yg,e),t.include(f3,e),t.include(Hpt,e),t.include(Ltt,e),t.include(qQe,e),t.include(Ypt,e),t.include(Xpt,e);const{vertex:i,fragment:r}=t;r.uniforms.add(new Mv("view")),e.pbrMode!==Rt.Normal&&e.pbrMode!==Rt.Schematic||(t.include(rY,e),e.hasNormalTexture&&t.include(Zwe,e)),e.output===J.Shadow&&e.componentData===Kd.Varying?i.code.add(x`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(x`#define discardShadows(castShadows) {}`);const s=e.integratedMeshMode===iu.ColorOverlay||e.integratedMeshMode===iu.ColorOverlayWithWater,n=s&&e.output===J.Color&&e.pbrMode===Rt.WaterOnIntegratedMesh;return s&&(t.include(pw,e),t.include(Jht,e),e.spherical?i.code.add(x`
      const float invEllipsoidRadius = ${x.float(1/(e.ellipsoidMode===Tf.Earth?Ai.radius:e.ellipsoidMode===Tf.Mars?vf.radius:Rg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(x`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),i.code.add(x`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${x.float(Eo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${n?e.spherical?x`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:x`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?x`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===J.Alpha&&(r.include(Tu),t.include(Su,e),t.include(Tae,e),s&&r.uniforms.add(new zt("ovColorTex",(o,a)=>Zj(o,a))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?x`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===J.Color&&(r.include(Tu),t.include(Su,e),t.include(Tae,e),t.include(Sae,e),t.include(pw,e),e.receiveShadows?(t.include(mU,e),r.code.add(x`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(x`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new zt("ovColorTex",(o,a)=>Zj(o,a))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?x`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===Rt.Normal||e.pbrMode===Rt.Schematic?(r.uniforms.add(new xt("lightingMainIntensity",(o,a)=>a.lighting.mainLight.intensity)),r.code.add(x`
        ${e.pbrMode===Rt.Normal?x`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?r.code.add(x`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(x`vec3 shadingNormal = normalVertex;`),r.code.add(x`${e.spherical?x`vec3 normalGround = normalize(positionWorld());`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(x`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?x`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?r.code.add(x`float shadow = evaluateShadow();`):e.spherical?(r.uniforms.add(new We("lightingGlobalFactor",(o,a)=>a.lighting.globalFactor)),r.code.add(x`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(x`float shadow = 0.0;`),n&&r.uniforms.add(new zt("ovNormalTex",(o,a)=>KZ(a))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(x`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(x`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?x`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(x`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==J.Depth&&e.output!==J.Shadow||(t.include(e_,e),r.code.add(x`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===J.Normal&&(t.include(Sae,e),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===xr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===J.Highlight&&(t.include(Kg),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?x`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function KZ(e){return e.overlays.length===0?null:e.overlays[Pr.INNER].getValidTexture(fs.Water)}const Qpt=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:aSe,build:Zpt,getOverlayNormalTexture:KZ},Symbol.toStringTag,{value:"Module"}));class WU extends cr{bindDraw(t,i){const r=this.program;r.bindDraw(t,i),r.rebindTextures(),t.componentParameters.type===Kd.Varying&&t.componentParameters.texture.bind(r,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ve.Global,i.doublePrecisionRequiresObfuscation=p3(t.rctx)}initializeProgram(t){const i=WU.shader.get(),r=i.build(this.configuration);return new er(t.rctx,r,i.attributeLocations)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==iu.None,s=t===gt.NONE,n=t===gt.FrontFace;return Ut({blending:i.output!==J.Color&&i.output!==J.Alpha||!i.blendingEnabled?null:s?gu:ey(t),culling:P5(i.cullFace),depthTest:{func:Kv(t)},depthWrite:s||n?wl:null,colorWrite:Kt,stencilWrite:r||i.hasOccludees?kf:null,stencilTest:r?$et(fl.IntegratedMeshMaskExcluded):i.hasOccludees?t_:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:iU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}WU.shader=new Ki(Qpt,()=>import("./ComponentShader.glsl.12b1edb2.js"));class Jpt extends Us{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class eQ{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function zr(e={}){return(t,i)=>{var s;const r=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=r+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(o){const a=this[r];if(a==null)this[r]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(n){this[r]!==n&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function Eae(){return(e,t)=>{var r;const i=(r=e._parameterCount)!=null?r:0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(s){this[i]!==s&&(this[i]=s,this._setDirty())}})}}class XU{constructor(t){this._low=Si(),this._high=Si(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;se(i,t),uc(r,t,i)}setElements(t,i,r){te(Cae,t,i,r),this.set(Cae)}get(t){return de(t,this._low,this._high)}getLowScaled(t){return oe(t,this._low,1)}}const Cae=M();class wn extends Jpt{constructor(t,i){super(),this.toMapSpace=i,this.baseColor=Fh(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Oi(1,1,.5),this.emissiveFactor=Oi(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new ML,this.componentParameters=new YR,this.textureAlphaCutoff=CF,this.alphaDiscardMode=nr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Tf.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new oi;const r=new XU(t.position),s=oTe(t.rotationScale);Nw(s,s),this.transformNormalGlobalFromModel=$h(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=Yi(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return _(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return _(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return _(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return _(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return _(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetalnessAndRoughnessTexture=_(this.metallicRoughnessTexture),n.hasEmissionTexture=_(this.emissionTexture),n.hasOcclusionTexture=_(this.occlusionTexture),n.hasNormalTexture=_(this.normalTexture),n.transparencyPassType=i.identifier===ou.Material&&r.transparencyPassType!=null?r.transparencyPassType:gt.NONE,n.hasMultipassTerrain=i.identifier===ou.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===ou.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?Nr.View:Nr.None,n.hasBaseColorTexture=_(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===ya.Transparent||o===ya.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?tft(r)?KZ(r)?iu.ColorOverlayWithWater:iu.ColorOverlay:iu.NoOverlay:iu.None,n.isGround=this.isIntegratedMesh,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&A(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===iu.ColorOverlayWithWater?Rt.WaterOnIntegratedMesh:this.usePBR?a?Rt.Schematic:Rt.Normal:Rt.Disabled,n.normalType=n.integratedMeshMode===iu.None?n.hasNormals?xr.CompressedAttribute:xr.ScreenDerivative:xr.Ground,n.hasSlicePlane=_(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===ou.ShadowMap?(n.output=J.Shadow,n.vertexDiscardMode=wh.None):i.identifier===ou.Highlight?(n.output=J.Highlight,n.vertexDiscardMode=wh.None):(this._computeWhichMaterialPass()===ya.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?wh.Opaque:wh.Transparent:n.vertexDiscardMode=wh.None,n.output=Kpt(i.subPass),i.subPass===Wn.Alpha&&(n.hasOccludees=r.hasOccludees),i.subPass===Wn.Color?(n.receiveAmbientOcclusion=r.ssaoHelper.ready,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=_(r.clouds.data)):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1),n.snowCover=this.hasSnowCover(r)),this._technique=t.releaseAndAcquire(WU,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case ya.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case ya.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case ya.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case ya.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),eft(i)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==un.None;h&&t.shadowMap.submitDraw(this,s,a,o),_(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&_(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}get attributeLocations(){return aSe}_computeWhichMaterialPass(){return this.isIntegratedMesh?ya.IntegratedMesh:this.objectOpacity<1?ya.Transparent:this.componentParameters.opaqueOverride===un.All?ya.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===nr.Blend||this.alphaDiscardMode===nr.MaskBlend?ya.Transparent:this.componentParameters.transparent===un.None?ya.Opaque:this.componentParameters.transparent===un.All?ya.Transparent:ya.OpaqueAndTransparent}}var Aae,ya,un;u([zr({vectorOps:she})],wn.prototype,"baseColor",void 0),u([zr()],wn.prototype,"usePBR",void 0),u([zr()],wn.prototype,"hasParametersFromSource",void 0),u([zr({vectorOps:KQ})],wn.prototype,"mrrFactors",void 0),u([zr({vectorOps:KQ})],wn.prototype,"emissiveFactor",void 0),u([zr({dispose:!0})],wn.prototype,"baseColorTexture",void 0),u([zr({dispose:!0})],wn.prototype,"metallicRoughnessTexture",void 0),u([zr({dispose:!0})],wn.prototype,"emissionTexture",void 0),u([zr({dispose:!0})],wn.prototype,"occlusionTexture",void 0),u([zr({dispose:!0})],wn.prototype,"normalTexture",void 0),u([zr()],wn.prototype,"objectOpacity",void 0),u([Eae()],wn.prototype,"commonMaterialParameters",void 0),u([Eae()],wn.prototype,"componentParameters",void 0),u([zr()],wn.prototype,"textureAlphaCutoff",void 0),u([zr()],wn.prototype,"alphaDiscardMode",void 0),u([zr()],wn.prototype,"isIntegratedMesh",void 0),u([zr()],wn.prototype,"polygonOffsetEnabled",void 0),u([zr()],wn.prototype,"ellipsoidMode",void 0),u([zr()],wn.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(Aae||(Aae={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(ya||(ya={}));class ML extends eQ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=ar.Back,this.hasSlicePlane=!0}}u([zr()],ML.prototype,"doubleSided",void 0),u([zr()],ML.prototype,"cullFace",void 0),u([zr()],ML.prototype,"hasSlicePlane",void 0);class YR extends eQ{constructor(){super(...arguments),this.externalColor=Fh(1,1,1,1),this.externalColorMixMode=ys.Multiply,this.castShadows=un.All}get transparent(){return this.externalColor[3]<1?un.All:un.None}get opaqueOverride(){return this.externalColorMixMode===ys.Replace&&this.externalColor[3]===1?un.All:un.None}get visible(){return this.externalColor[3]>0?un.All:un.None}get type(){return Kd.Uniform}}u([zr({vectorOps:she})],YR.prototype,"externalColor",void 0),u([zr()],YR.prototype,"externalColorMixMode",void 0),u([zr()],YR.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(un||(un={}));class QA extends eQ{constructor(){super(...arguments),this.texture=null,this.transparent=un.None,this.opaqueOverride=un.None,this.castShadows=un.None}get type(){return Kd.Varying}}function Kpt(e){switch(e){case Wn.Color:return J.Color;case Wn.Alpha:return J.Alpha;case Wn.Depth:return J.Depth;case Wn.Normal:return J.Normal}}function eft(e){return e.overlays.length!==0&&_(e.overlays[Pr.INNER].getValidTexture(fs.Highlight))}function tft(e){return e.overlays.length!==0&&_(e.overlays[Pr.INNER].getColorTextureNoRasterImage())}u([zr()],QA.prototype,"texture",void 0),u([zr()],QA.prototype,"transparent",void 0),u([zr()],QA.prototype,"opaqueOverride",void 0),u([zr()],QA.prototype,"castShadows",void 0);const vM=es().vec3f(R.POSITION).u16(R.COMPONENTINDEX).u16(R.U16PADDING),lSe=es().vec2u8(R.SIDENESS),Rae=vc(lSe),cSe=es().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX).u8(R.VARIANTOFFSET,{glNormalized:!0}).u8(R.VARIANTSTROKE).u8(R.VARIANTEXTENSION,{glNormalized:!0}).u8(R.U8PADDING,{glPadding:!0}).u16(R.U16PADDING,{glPadding:!0}),nH=cSe.clone().vec3f(R.NORMAL),oH=cSe.clone().vec3f(R.NORMALA).vec3f(R.NORMALB),aH=new Map([[R.POSITION0,0],[R.POSITION1,1],[R.COMPONENTINDEX,2],[R.VARIANTOFFSET,3],[R.VARIANTSTROKE,4],[R.VARIANTEXTENSION,5],[R.NORMAL,6],[R.NORMALA,6],[R.NORMALB,7],[R.SIDENESS,8]]);function Oae(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,S)=>{b<S?s[b+1]++:n[S+1]++};for(let b=0;b<r;b++){const S=e[3*b],T=e[3*b+1],E=e[3*b+2];o(S,T),o(T,E),o(E,S)}let a=0,l=0;for(let b=0;b<i;b++){const S=s[b+1],T=n[b+1];s[b+1]=a,n[b+1]=l,a+=S,l+=T}const c=new Uint32Array(6*r),h=s[i],p=(b,S,T)=>{if(b<S){const E=s[b+1]++;c[2*E]=S,c[2*E+1]=T}else{const E=n[S+1]++;c[2*h+2*E]=b,c[2*h+2*E+1]=T}};for(let b=0;b<r;b++){const S=e[3*b],T=e[3*b+1],E=e[3*b+2];p(S,T,b),p(T,E,b),p(E,S,b)}const f=(b,S)=>{const T=2*b,E=S-b;for(let C=1;C<E;C++){const O=c[T+2*C],I=c[T+2*C+1];let N=C-1;for(;N>=0&&c[T+2*N]>O;N--)c[T+2*N+2]=c[T+2*N],c[T+2*N+3]=c[T+2*N+1];c[T+2*N+2]=O,c[T+2*N+3]=I}};for(let b=0;b<i;b++)f(s[b],s[b+1]),f(h+n[b],h+n[b+1]);const m=new Int32Array(3*r),y=(b,S)=>b===e[3*S]?0:b===e[3*S+1]?1:b===e[3*S+2]?2:-1,v=(b,S)=>{const T=y(b,S);m[3*S+T]=-1},w=(b,S,T,E)=>{const C=y(b,S);m[3*S+C]=E;const O=y(T,E);m[3*E+O]=S};for(let b=0;b<i;b++){let S=s[b];const T=s[b+1];let E=n[b];const C=n[b+1];for(;S<T&&E<C;){const O=c[2*S],I=c[2*h+2*E];O===I?(w(b,c[2*S+1],I,c[2*h+2*E+1]),S++,E++):O<I?(v(b,c[2*S+1]),S++):(v(I,c[2*h+2*E+1]),E++)}for(;S<T;)v(b,c[2*S+1]),S++;for(;E<C;)v(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}function QF(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:ift(e.layout)}}function C$(e){return rft(e.layout).createView(e.buffer)}function ift(e){const t=new Array;return e.fields.forEach((i,r)=>{const s=ve(F({},i),{constructor:uSe(i.constructor)});t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function rft(e){const t=es();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],ve(F({},i[1]),{constructor:nft(i[1].constructor)}))),t}const sft=[KM,Dh,ji,In,lp,S2,E2,C2,_s,tw,Pv,Iv,kg,iw,$v,xl,rw,A2,sw,Dv,nw,R2,FO,UO,O2,ow,kO,zO,BO,aw,VO,GO,jO,HO,qO,WO];function uSe(e){return`${e.ElementType}_${e.ElementCount}`}function nft(e){return hSe.get(e)}const hSe=new Map;sft.forEach(e=>hSe.set(uSe(e),e));class dSe{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?aft:oft}write(t,i,r){const s=this.edgeHashFunction(r);R$.seed=s;const n=R$.getIntRange(0,255),o=R$.getIntRange(0,this.settings.variants-1),a=.7,l=R$.getFloat(),c=255*(.5*lft(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,o),t.variantExtension.set(i,c)}trim(t,i){return t.slice(0,i)}}const tQ=new Float32Array(6),JF=new Uint32Array(tQ.buffer),lv=new Uint32Array(1);function oft(e){const t=tQ;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],lv[0]=5381;for(let i=0;i<JF.length;i++)lv[0]=31*lv[0]+JF[i];return lv[0]}function aft(e){const t=tQ;t[0]=Fx(e.position0[0]),t[1]=Fx(e.position0[1]),t[2]=Fx(e.position0[2]),t[3]=Fx(e.position1[0]),t[4]=Fx(e.position1[1]),t[5]=Fx(e.position1[2]),lv[0]=5381;for(let i=0;i<JF.length;i++)lv[0]=31*lv[0]+JF[i];return lv[0]}const Mae=1e4;function Fx(e){return Math.round(e*Mae)/Mae}function lft(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class KF{constructor(){this.commonWriter=new dSe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return nH.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),de(A$,r.faceNormal0,r.faceNormal1),we(A$,A$),t.normal.setVec(i,A$)}trim(t,i){return this.commonWriter.trim(t,i)}}KF.Layout=nH,KF.glLayout=vc(nH,1);class e4{constructor(){this.commonWriter=new dSe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return oH.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this.commonWriter.trim(t,i)}}e4.Layout=oH,e4.glLayout=vc(oH,1);const A$=M(),R$=new uh,D1=-1;var t4;function lH(e,t,i,r=fft){const s=e.vertices.position,n=e.vertices.componentIndex,o=$t(r.anglePlanar),a=$t(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=cH.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,v=pft(e),w=dft(e),b=w.length/4,S=t.allocate(b);let T=0;const E=b,C=i.allocate(E);let O=0,I=0,N=0;const D=H2e(0,b),z=new Float32Array(b);X2e(z,(le,ne,$)=>{s.getVec(w[4*ne+0],p),s.getVec(w[4*ne+1],f),$[ne]=or(p,f)}),D.sort((le,ne)=>z[ne]-z[le]);const B=new Array,k=new Array;for(let le=0;le<b;le++){const ne=D[le],$=z[ne],U=w[4*ne+0],V=w[4*ne+1],q=w[4*ne+2],W=w[4*ne+3],K=W===D1;if(s.getVec(U,p),s.getVec(V,f),K)te(m,v[3*q+0],v[3*q+1],v[3*q+2]),se(y,m),h.componentIndex=n.get(U),h.cosAngle=xe(m,y);else{if(te(m,v[3*q+0],v[3*q+1],v[3*q+2]),te(y,v[3*W+0],v[3*W+1],v[3*W+2]),h.componentIndex=n.get(U),h.cosAngle=xe(m,y),uft(h,c))continue;h.cosAngle<-.9999&&se(y,m)}I+=$,N++,K||cft(h,l)?(t.write(S,T++,h),B.push($)):hft(h,o)&&(i.write(C,O++,h),k.push($))}const Y=new Float32Array(B.reverse()),Z=new Float32Array(k.reverse());return{regular:{instancesData:t.trim(S,T),lodInfo:{lengths:Y}},silhouette:{instancesData:i.trim(C,O),lodInfo:{lengths:Z}},averageEdgeLength:I/N}}function cft(e,t){return e.cosAngle<t}function uft(e,t){return e.cosAngle>t}function hft(e,t){const i=rn(e.cosAngle),r=cH.fwd,s=cH.ortho;return Vg(r,e.position1,e.position0),i*(xe(lt(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function dft(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];s+=l===D1||p<f?1:0,s+=c===D1||f<m?1:0,s+=h===D1||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===D1||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===D1||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===D1||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function pft(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=QB.v0,n=QB.v1,o=QB.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),pe(n,n,s),pe(o,o,s),lt(s,n,o),we(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(t4||(t4={}));const cH={edge:{position0:M(),position1:M(),faceNormal0:M(),faceNormal1:M(),componentIndex:0,cosAngle:0},ortho:M(),fwd:M()},QB={v0:M(),v1:M(),v2:M()},fft={anglePlanar:4,angleSignificantEdge:35};class pSe{async extract(t){const i=JB(t),r=iQ(i),s=[i.data.buffer];return{result:mft(r,s),transferList:s}}async extractComponentsEdgeLocations(t){const i=JB(t),r=uH(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=lH(r,_ft,$ae),n=[];return{result:QF(s.regular.instancesData,n),transferList:n}}async extractEdgeLocations(t){const i=JB(t),r=uH(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=lH(r,vft,$ae),n=[];return{result:QF(s.regular.instancesData,n),transferList:n}}}function iQ(e){const t=uH(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return Pae.updateSettings(e.writerSettings),Iae.updateSettings(e.writerSettings),lH(t,Pae,Iae)}function JB(e){return{data:vM.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function mft(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:QF(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:QF(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function uH(e,t,i,r){if(t)return{faces:i,facesLength:r,neighbors:Oae(i,r,e.count),vertices:e};const s=rwe(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Oae(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:vM.createView(s.buffer)}}const Pae=new KF,Iae=new e4;class gft{allocate(t){return fSe.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1)}}class yft{allocate(t){return rQ.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex)}}const vft=new gft,_ft=new yft,$ae={allocate:()=>null,write:()=>{},trim:()=>null},fSe=es().vec3f(R.POSITION0).vec3f(R.POSITION1),rQ=es().vec3f(R.POSITION0).vec3f(R.POSITION1).u16(R.COMPONENTINDEX).u16(R.U16PADDING,{glPadding:!0});function bft(){return new pSe}var wft=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",EdgeProcessingWorker:pSe,default:bft,extract:iQ,extractComponentsEdgeLocationsLayout:rQ,extractEdgeLocationsLayout:fSe});class xft{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class Tft{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.textureWidth=4096,this.dirty=!0,this.texture=new st(this.rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new xl(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,i,r,s,n,o){const a=t*this.fieldCount+i;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,s),this.data.set(a,2,n),this.data.set(a,3,o)}setDataElement(t,i,r,s){const n=t*this.fieldCount+i;this.dirty=!0,this.data.set(n,r,s)}resizeToFit(t){const i=t*this.fieldCount;if(i>=this.data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new xl(new ArrayBuffer(4*r));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,i=this.texture.descriptor.height;this.data.count>t*i&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,i,r){t.bindTexture(i,this.texture),t.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const mSe=65536;class Sft{constructor(t,i=1){this.textureBuffer=new Tft(t,i),this.indexManager=new xft(mSe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class gSe{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const r of this.buffers)if(r.availableCount>=t)return r;if(t>mSe)return null;const i=new Sft(this.rctx,this.fieldCount);return this.buffers.push(i),i}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const Dae=fe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Eft{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._objects=[new Vt,new Vt],this._renderSubmit=new Vpt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new gSe(t.rctx,2)}dispose(){dt(this._objects[$S.Hidden].length===0&&this._objects[$S.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new rH;return i.toMapSpace=t.toMapSpace,i.transform=t.transform,i.obb=pae(t.obb),i.components=new Spt(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new Ppt(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.dispose(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=pn(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:IZ(),externalColorMixMode:ys.Multiply,elevationOffset:0},c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,v=n.verticalOffsets,w=1/0,b=-1/0,S=!1,T=!1,E=0;for(let C=0;C<n.count;C++)i(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===ys.Replace&&l.externalColor[3]===1),y+=+l.castShadows,jwe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[C],0,h[0],h[1],h[2],h[3]),S||(S=C>0&&E!==p[0]),E=p[0],T||(T=l.elevationOffset!==0),T&&A(v)&&(v=new Array(C).fill(0)),_(v)&&(v[C]=l.elevationOffset),w=Math.min(w,l.elevationOffset),b=Math.max(b,l.elevationOffset),oSe(l.elevationOffset,h),c.setData(a[C],1,h[0],h[1],h[2],h[3]),l.pickable!==iSe(n.pickability,C)&&(n.pickability=Cpt(n.pickability,n.count,C,l.pickable));n.verticalOffsets=T?v:null,r.offsetObb=T?mpt(r.obb,w,b,this._viewingMode,_(r.offsetObb)?r.offsetObb:pae(r.obb)):null,S||T?(s.componentParameters=new QA,s.componentParameters.castShadows=KB(y,n.count),s.componentParameters.transparent=KB(f,n.count),s.componentParameters.opaqueOverride=KB(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new YR,s.componentParameters.castShadows=l.castShadows?un.All:un.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,i,r,s=!1){t.intersectionGeometry.getComponentAabb(i,r);const n=t,o=n.components.verticalOffsets;if(s||A(o))return r;const a=o[i];if(this._viewingMode===Ve.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=MWe(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,o){const a=t;_(n)&&(n.localOrigin=a.transform.position);const l=Nw(Lae,a.transform.rotationScale);uc(O$,i,a.transform.position),uc(M$,r,a.transform.position),ec(O$,O$,l),ec(M$,M$,l);const c=$h(Lae,l);return a.intersectionGeometry.intersect(O$,M$,s,c,n,a.components.verticalOffsets,o)}addEdges(t,i,r,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:Ydt(n.obb)},a,o,l,r,s)}async extractEdgeInformation(t,i,r){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:rQ.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=vM.createBuffer(a.count);OU(c.position,a),Bv(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:$s(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(t,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,i,r,s){if(t&&i.allVisible())return t;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let f=h;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,i){const r=t.components;A(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(A(r.highlightCounts))return void Dae.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else Dae.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;_(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[$S.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=ii.createVertex(r,bi.STATIC_DRAW,s.vertices.data),a=qs(s.indices,v=>ii.createIndex(r,bi.STATIC_DRAW,v)),l=vc(Gpt(n)),c=new Uint16Array(s.vertices.count);for(let v=0;v<i.count;v++){const w=i.offsets[v],b=i.offsets[v+1],S=i.materialDataIndices[v];if(_(s.indices))for(let T=w;T<b;T++)c[s.indices[T]]=S;else for(let T=w;T<b;T++)c[T]=S}const h=ii.createVertex(r,bi.STATIC_DRAW,c.buffer),p=new wn(t.transform,t.toMapSpace),f=new Ns(r,p.attributeLocations,{data:l,componentIndices:Cft},{data:o,componentIndices:h},a),m=new sSe(f,Pt.TRIANGLES,n,_(a)),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(_(a)?a.byteSize:0)};return new Dpt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const Cft=vc(es().u16(R.COMPONENTINDEX));function KB(e,t){return e===t?un.All:e===0?un.None:un.Some}const Lae=xg(),O$=M(),M$=M();class ySe extends Us{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function Aft(e){const t=new Hi;t.include(Jv);const i=t.fragment;switch(e.function){case Kl.Standard:i.uniforms.add(new zt("tex",r=>r.texture)),e.hasOpacityFactor?(i.uniforms.add(new We("opacity",r=>r.opacity)),i.code.add(x`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):i.code.add(x`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case Kl.OverlayWithTransparency:i.uniforms.add(new zt("tex",r=>r.texture)),i.uniforms.add(new m3("overlayIdx",r=>r.overlayIndex)),e.hasOpacityFactor&&i.uniforms.add(new We("opacity",r=>r.opacity)),i.code.add(x`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case Kl.TransparentToHUDVisibility:i.uniforms.add(new zt("tex",r=>r.texture)),i.code.add(x`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case Kl.Transparency:i.uniforms.add([new zt("colorTexture",r=>r.colorTexture),new zt("alphaTexture",r=>r.alphaTexture),new zt("frontFaceTexture",r=>r.frontFaceTexture)]),i.code.add(x`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case Kl.COUNT:break;default:e.function}return t}const Rft=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:ySe,build:Aft},Symbol.toStringTag,{value:"Module"}));class _M extends cr{initializeProgram(t){const i=_M.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){if(this.configuration.function===Kl.TransparentToHUDVisibility)return Ut({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case bo.None:return Ut({colorWrite:Kt});case bo.Alpha:return Ut({blending:so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:Kt});default:return Ut({blending:Xf(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}}}_M.shader=new Ki(Rft,()=>import("./Compositing.glsl.8e3c93b5.js"));class Oft{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._configuration=new uL,this._passParameters=new ySe}dispose(){this._vao=Xe(this._vao)}compositeTransparent(t,i,r,s,n=1){this._configuration.alphaMode=bo.Alpha,this._configuration.function=Kl.Transparency,this._configuration.hasOpacityFactor=n!==1,this._passParameters.colorTexture=i,this._passParameters.alphaTexture=r,this._passParameters.frontFaceTexture=s;const o=this._rctx,a=this._techniqueRepository.acquire(_M,this._configuration);o.bindTechnique(a,this._passParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Pt.TRIANGLE_STRIP,0,xo(l,"geometry")),a.release()}composite(t,i,r=bo.None,s=1,n=Kl.Standard,o=Pr.INNER){const a=this._rctx;this._configuration.alphaMode=r,this._configuration.function=n,this._configuration.hasOpacityFactor=s!==1,this._passParameters.overlayIndex=o,this._passParameters.texture=i,this._passParameters.opacity=s;const l=this._techniqueRepository.acquire(_M,this._configuration);a.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();a.bindVAO(c),a.drawArrays(Pt.TRIANGLE_STRIP,0,xo(c,"geometry")),l.release()}_ensureVAO(){return A(this._vao)&&(this._vao=La(this._rctx)),this._vao}}const Mft=1e4,hH=100,Pft=500,Ift=500,$ft=.1;function Dft(e,t,i){return XY(t,e)*(i[1]-i[0])+i[0]}function Lft(e,t,i){if(t.size<Mft)return Gft.compute(e,t);const r=b3();return i.forAll(s=>{s.isVisible&&q2(r,Nft(e,s))}),r}function Nft(e,t){if(!t.isVisible)return;const i=b3(),r=t.getSpatialQueryAccelerator();return _(r)?Fft(i,e,r):Uft(i,e,t.objects),i}function Fft(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=i.objectCount;if(a<Pft)yM(ah,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,qd.DepthOrder.FRONT_TO_BACK,ah,(l,c)=>{dH(e,t,l),ah.far=e.near,c.setRange(ah)},n,o),yM(ah,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,qd.DepthOrder.BACK_TO_FRONT,ah,(l,c)=>{dH(e,t,l),ah.near=e.far,c.setRange(ah)},n,o);else{const l=Math.max(Math.min(a,Ift),Math.ceil(a*$ft)),c=i.findClosest(s,qd.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,qd.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Nae(e,t,c.boundingVolumeWorldSpace.bounds),Nae(e,t,h.boundingVolumeWorldSpace.bounds))}}function Uft(e,t,i){Ux.clear(),i.forAll(r=>{r.isVisible&&r.geometryRecords.length!==0&&Ux.add(r)}),Ux.empty||(Ux.sort(t),yM(ah,t.near,Math.min(e.near,t.far)),Ux.forEachInDepthRange(ah,qd.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&dH(e,t,r)}),yM(ah,Math.max(e.far,t.near),t.far),Ux.forEachInDepthRange(ah,qd.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function dH(e,t,i){if(!i.isVisible||!rv(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=Vft;i.geometryRecords.forEach(n=>{Fr(s,r,n.getShaderTransformation());const o=qb(s);vSe(e,t,n.geometry.boundingInfo,s,o)})}function vSe(e,t,i,r,s){if(A(i))return;const n=t.eye,o=t.viewForward;ke(vo,i.center,r);const a=o[0]*(vo[0]-n[0])+o[1]*(vo[1]-n[1])+o[2]*(vo[2]-n[2]);if(vo[3]=i.radius*s,!(a-vo[3]>e.near&&a+vo[3]<e.far)&&rv(t.frustum,vo))if(i.radius>hH&&i.getChildren()){const l=i.getChildren();for(let c=0;c<8;++c)l[c]&&vSe(e,t,l[c],r,s)}else pH.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Nae(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class kft{constructor(){this._items=new Vt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===qd.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class zft{constructor(){this.view=Ae(),this.viewProj=Ae(),this.frustum=ZO(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,i){this._reset(),gs(this.view,t.viewMatrix),Fr(this.viewProj,t.projectionMatrix,this.view),uF(this.frustum,t.frustum);const r=this.view,s=r[2],n=r[6],o=r[10],a=r[14],l=this.range;let c=0;if(i.forEach(m=>{if(!m.instanceParameters.visible||!m.castShadow)return;let y;m.hasShaderTransformation?(m.computeBoundingSphere(m.getShaderTransformation(),vo,1),y=vo):y=m.boundingSphere;const v=s*y[0]+n*y[1]+o*y[2]+a,w=v-y[3],b=v+y[3];this.geometries[c]=m,this.near[c]=-b,this.far[c]=-w,++c}),this.geometries.length===0)return l;for(let m=0;m<this.geometries.length;++m)this.near[m]>l.far&&(l.far=this.near[m]),this.near[m]>2&&this.far[m]<l.near&&(l.near=this.far[m]);const h=this.looseRange;h.near=Math.max(.5*l.near,2),h.far=2*l.far;let p=0,f=0;for(let m=0;m<this.geometries.length;++m)this.near[m]<l.near&&(this.near[m]>=h.near?l.near=this.near[m]:this.nearCandidates[p++]=m),this.far[m]>l.far&&(this.far[m]<=h.far?l.far=this.far[m]:this.farCandidates[f++]=m);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((m,y)=>this.near[m]<this.near[y]?-1:this.near[m]>this.near[y]?1:0),this.farCandidates.sort((m,y)=>this.far[m]<this.far[y]?1:this.far[m]>this.far[y]?-1:0);for(let m=0;m<this.nearCandidates.length;++m){const y=this.nearCandidates[m];if(this.near[y]<l.near){const v=this.geometries[y],w=v.boundingInfo;this._includeNearBoundingInfoRec(w,v.getShaderTransformation())}}for(let m=0;m<this.farCandidates.length;++m){const y=this.farCandidates[m];if(this.far[y]>l.far){const v=this.geometries[y],w=v.boundingInfo;this._includeFarBoundingInfoRec(w,v.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,i){if(A(t))return;const r=t.getCenter();ke(vo,r,i);const s=qb(i),n=vo[0],o=vo[1],a=vo[2],l=t.getBSRadius()*s,c=this.frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const h=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14],p=h+l;if(!(-(h-l)<2||-p>=this.range.near))if(-p>this.looseRange.near)this.range.near=-p;else{if(l>hH){const f=t.getChildren();if(f!==void 0){for(let m=0;m<8;++m)f[m]!==void 0&&this._includeNearBoundingInfoRec(f[m],i);return}}pH.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,i){if(A(t))return;let r=t.getBSRadius();const s=t.getCenter();ke(vo,s,i);const n=qb(i),o=vo[0],a=vo[1],l=vo[2];r*=n;const c=this.frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>r)return;const h=this.view[2]*o+this.view[6]*a+this.view[10]*l+this.view[14]-r;if(!(-h<=this.range.far))if(-h<this.looseRange.far)this.range.far=-h;else{if(r>hH){const p=t.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&this._includeFarBoundingInfoRec(p[f],i);return}}pH.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}}class Bft{constructor(){this.modelViewProj=Ae(),this.clipPosition=[Gt(),Gt(),Gt(),Gt(),Gt(),Gt(),Gt(),Gt()]}unionDepthRangeWithAABB(t,i,r,s,n){const o=this.modelViewProj;Fr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this.clipPosition[e8[l][0]],h=this.clipPosition[e8[l][1]],p=this.clipPosition[e8[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const v=f[y][3];v<t.near&&(t.near=v),v>t.far&&(t.far=v)}}}return a}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void dt(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),_4(Gt(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const e8=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],vo=mn(),Vft=Ae(),ah=b3(),Ux=new kft,Gft=new zft,pH=new Bft;class jft extends Us{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function Hft(){const e=new Hi;return e.attributes.add(R.POSITION,"vec2"),e.vertex.uniforms.add(new Ca("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(x`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new $r("textureInput")),e.fragment.uniforms.add(new $r("textureMask")),e.fragment.uniforms.add(new $r("textureOverlay")),e.fragment.uniforms.add(new ew("maskEnabled",t=>t.maskEnabled)),e.fragment.uniforms.add(new ew("overlayEnabled",t=>t.overlayEnabled)),e.fragment.code.add(x`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function qft(e){const t=import("./mask-svg.d736db49.js"),i=import("./overlay-svg.ddc1dd43.js"),r=ap((await t).default,{signal:e}),s=ap((await i).default,{signal:e}),n={mask:await r,overlay:await s};return hi(e),n}let RT=class extends Ee{constructor(){super(...arguments),this._handles=new Ht,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new jft,this.events=new Kr,this.attributeLocations=new Map([[R.POSITION,0]]),this.tmpScreenPoint=Vr(),this.tmpRenderPoint=qRe()}get updating(){return A(this._imageSources)&&_(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};_(this._magnifier)&&this._handles.add(ae(()=>qs(this._magnifier,i=>i.version),t)),t()}get enabled(){return _(this._validMagnifier)}get _validMagnifier(){return _(this._magnifier)&&this._magnifier.visible&&_(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return _(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),_(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(A(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),A(this._resources))return;this._passParameters.maskEnabled=i.maskEnabled,this._passParameters.overlayEnabled=i.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;tg(i.position,this.tmpScreenPoint);const h=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),p=.5*a,f=.5*a;h[0]=De(h[0],p,l-p-1),h[1]=De(h[1],f,c-f-1);const m=Math.floor(h[0]-p),y=Math.floor(h[1]-f);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0);const v=i.offset.x*r,w=i.offset.y*r,b=(h[0]+v)/l*2-1,S=(h[1]-w)/c*2-1,T=s/l*2,E=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",b,S,T,E),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Pt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(A(e))return;const t=e.maskUrl,i=e.overlayUrl;!_(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),_(this._imageSources)||_(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:MM(async r=>{const s=A(t)||A(i)?qft(r):null,n=_(t)?ap(t,{signal:r}):s.then(a=>a.mask),o=_(i)?ap(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(_(this._resources)){if(this._resources.textures.size!==t){const r=this._createTextureResources(e,t);if(A(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const i=this._createTextureResources(e,t);A(i)||(this._resources={textures:i,program:this._createProgram(e),vao:La(e,WX,this.attributeLocations,0,1),pipelineState:Ut({blending:Xf(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:Kt})})}_disposeResources(){A(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(A(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new st(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!0,preMultiplyAlpha:!Oq(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new st(e,{target:pt.TEXTURE_2D,pixelFormat:ze.ALPHA,internalFormat:ze.ALPHA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!0},this._imageSources.mask);return{input:new st(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new er(e,Hft(),this.attributeLocations)}};u([d()],RT.prototype,"_imageSources",void 0),u([d()],RT.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],RT.prototype,"updating",null),RT=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],RT);const Wft=.5,Xft=1e3/30;var bM;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(bM||(bM={}));class Fy{constructor(t,i,r=bM.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new Vt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=t,n.depthSquaredHint=s,n.indexType=i.indexed?i.vao.indexBuffer.indexType:0}dispatch(t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===gt.NONE||(r.bindTechnique(l,t,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,i),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=PL.get(c.indexType);for(let y=0;y<f;y+=2){const v=p[y],w=p[y+1];r.drawElements(h.primitiveType,w,c.indexType,v*m)}}else for(let m=0;m<f;m+=2){const y=p[m],v=p[m+1];r.drawArrays(h.primitiveType,y,v)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===bM.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const PL=new Map;PL.set(ht.UNSIGNED_BYTE,1),PL.set(ht.UNSIGNED_SHORT,2),PL.set(ht.UNSIGNED_INT,4);class Yft{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new Xht,this._shadowPassParameters=new Yht,this._highlightPassParameters=new Zht,this._systems=new Set,this._passes={materialOpaque:new Fy(t,i),materialTransparent:new Fy(t,i,bM.BackToFront),materialIntegratedMesh:new Fy(t,i),shadowMap:new Fy(t,i),highlight:new Fy(t,i),highlightIntegratedMesh:new Fy(t,i),highlightShadowMap:new Fy(t,i),defaultShadowMap:new Fy(t,i)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,t.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case Se.OPAQUE_MATERIAL:switch(t.pass){case Ge.MATERIAL:return this._materialPassParameters.subPass=Wn.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Wn.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Wn.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case Ge.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case Se.TRANSPARENT_MATERIAL:switch(t.pass){case Ge.MATERIAL:return this._materialPassParameters.subPass=Wn.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_ALPHA:return this._materialPassParameters.subPass=Wn.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Wn.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Wn.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Se.INTEGRATED_MESH:switch(t.pass){case Ge.MATERIAL:return this._materialPassParameters.subPass=Wn.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Wn.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Wn.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case Ge.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Se.OPAQUE_MATERIAL,Se.TRANSPARENT_MATERIAL,Se.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);_(s)&&q2(i,s,i)}),i}_configure(t){const i=t.pass===Ge.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===Ge.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.bindParameters.camera,s=r.viewInverseTransposeMatrix;te(t8,s[3],s[7],s[11]),i8.set(t8),se(i.transformWorldFromViewTH,i8.high),se(i.transformWorldFromViewTL,i8.low),se(i.slicePlaneLocalOrigin,t8),Ih(i.transformViewFromCameraRelativeRS,r.viewMatrix),gs(i.transformProjFromView,r.projectionMatrix),i.identifier===ou.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Se.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Se.INTEGRATED_MESH,$h(Fae,i.transformViewFromCameraRelativeRS),Nw(i.transformNormalViewFromGlobal,Fae))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const t8=M(),Fae=Sr(),i8=new XU,Zft=8.6,Qft=.4;function Jft(){const e=new Hi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(R.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(R.UV0,"vec2"),t.uniforms.add(new zt("coverageTex",n=>n.coverageTexture)),r.add(x`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new zt("tex",n=>n.blurColorTexture)),i.uniforms.add(new zt("origin",n=>n.highlightColorTexture)),i.uniforms.add(new ti("uColor",n=>n.color)),i.uniforms.add(new ti("haloColor",n=>n.haloColor)),i.uniforms.add(new ti("opacities",n=>Xi(Kft,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",Zft),i.constants.add("blurSize","float",Qft),s.add(x`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const Kft=Gt(),emt=Object.freeze(Object.defineProperty({__proto__:null,build:Jft},Symbol.toStringTag,{value:"Module"}));class YU extends cr{initializeProgram(t){const i=YU.shader.get().build();return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:Kt})}}YU.shader=new Ki(emt,()=>import("./HighlightApply.glsl.b3abcf3e.js"));class _Se extends Us{constructor(){super(...arguments),this.blurSize=tt()}}function tmt(){const e=new Hi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(R.POSITION,"vec2"),e.attributes.add(R.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new zt("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new eY("blurSize",n=>n.blurSize)),r.add(x`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new tY("tex",n=>n.blurInputTexture)),s.add(x`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const imt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:_Se,build:tmt},Symbol.toStringTag,{value:"Module"}));class ZU extends cr{initializeProgram(t){const i=ZU.shader.get().build();return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({colorWrite:Kt})}}ZU.shader=new Ki(imt,()=>import("./HighlightBlur.glsl.d2509231.js"));class bSe extends Us{constructor(){super(...arguments),this.invFramebufferDim=tt()}}function rmt(){const e=new Hi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(R.POSITION,"vec2"),r.add(x`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new tY("tex",n=>n.inputTexture)),i.uniforms.add(new eY("invFramebufferDim",n=>n.invFramebufferDim)),s.add(x`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const smt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:bSe,build:rmt},Symbol.toStringTag,{value:"Module"}));class QU extends cr{initializeProgram(t){const i=QU.shader.get().build();return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({colorWrite:Kt})}}QU.shader=new Ki(smt,()=>import("./HighlightDownsample.glsl.4cc670c9.js"));class Uae extends Us{constructor(){super(...arguments),this.color=Fh(1,0,1,1),this.haloColor=Fh(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=gi(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const nmt=32;class omt{constructor(t,i){this._techniqueRep=t,this._rctx=i,this.viewportToRestore=Gt(),this._passParameters=new Uae,this._downsampleDrawParameters=new bSe,this._blurDrawParameters=new _Se,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=La(this._rctx);const t={colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE,width:0,height:0},i={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new wr(this._rctx,t,i),this.blur1Fbo=new wr(this._rctx,t,i);const r=new Da;this._blurTechnique=this._techniqueRep.acquire(ZU,r),this._downsampleTechnique=this._techniqueRep.acquire(QU,r),this._applyTechnique=this._techniqueRep.acquire(YU,r)}dispose(){if(this._blurTechnique=Yi(this._blurTechnique),this._downsampleTechnique=Yi(this._downsampleTechnique),this._applyTechnique=Yi(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Xe(this.blur0Fbo),this.blur1Fbo=Xe(this.blur1Fbo)}setDefaultOptions(t){this._passParameters=F(F({},new Uae),t)}render(t,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=t.camera;kd(this.viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this.quadVAO);let p=null;this._gridUpdateResources(i,nmt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(Zi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,pi(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,xo(p,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(Zi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,pi(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,xo(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,xo(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:pt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:St.UNSIGNED_SHORT_5_6_5,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new wr(r,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let v=0;for(let w=0;w<l;w++)for(let b=0;b<c;b++)y[v+0]=(b-.5)*p*2-1,y[v+1]=(w-.5)*h*2-1,y[v+2]=b*p,y[v+3]=w*h,y[v+4]=(b+.5)*p*2-1,y[v+5]=(w-.5)*h*2-1,y[v+6]=b*p,y[v+7]=w*h,y[v+8]=(b-.5)*p*2-1,y[v+9]=(w+.5)*h*2-1,y[v+10]=b*p,y[v+11]=w*h,y[v+12]=(b-.5)*p*2-1,y[v+13]=(w+.5)*h*2-1,y[v+14]=b*p,y[v+15]=w*h,y[v+16]=(b+.5)*p*2-1,y[v+17]=(w-.5)*h*2-1,y[v+18]=b*p,y[v+19]=w*h,y[v+20]=(b+.5)*p*2-1,y[v+21]=(w+.5)*h*2-1,y[v+22]=b*p,y[v+23]=w*h,v+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new Ns(r,Ni,{geometry:QM},{geometry:ii.createVertex(r,bi.STATIC_DRAW,y)})}}_gridComputeMipmap(t){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,t);i.bindVAO(this.quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,pi(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t),i.setViewport(0,0,o,a),i.drawArrays(Pt.TRIANGLE_STRIP,0,xo(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(_(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(_(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const amt={dataType:St.UNSIGNED_BYTE,internalFormat:ze.RGBA},lmt={};class cmt{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null),r||(r=new st(this.rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.DEPTH_STENCIL,dataType:St.UNSIGNED_INT_24_8,samplingMode:Je.NEAREST,wrapMode:bt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new xT(this.rctx,F({internalFormat:xa.DEPTH_STENCIL},i)),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null)),r||(r=new st(this.rctx,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return F(F({id:hl()},lmt),t)}registerColorTarget(t={}){return F(F({id:hl()},amt),t)}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,t);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=_(r)?new wr(this.rctx,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.DEPTH_STENCIL_TEXTURE},o,l):new wr(this.rctx,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new wr(this.rctx,{colorTarget:Qr.TEXTURE,depthStencilTarget:r?Ei.DEPTH_STENCIL_RENDER_BUFFER:Ei.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=Kb(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class umt{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=t.type===ui.WEBGL2;this._renderTargetHelper=new cmt(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:St.FLOAT,internalFormat:r?mt.RGBA32F:ze.RGBA,samplingMode:Je.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:Je.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?mt.RGBA4:ze.RGBA,dataType:St.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?mt.RGBA4:ze.RGBA,dataType:St.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(Zi.COLOR_BUFFER_BIT|Zi.DEPTH_BUFFER_BIT|Zi.STENCIL_BUFFER_BIT)}composite(t){_(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,bo.None)}renderTmpAndCompositeToMain(t,i,r,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,hmt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,dmt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),bo.None,1,Kl.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case gt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case gt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case gt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),bo.PremultipliedAlpha)}compositeOccludedOntoMain(t,i){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),bo.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(t,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Zi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,i,r,s,n=!1,o=!1){const a=this._rctx,l=this.bindTarget(i,r);let c=0;if(s){const p=Math.max(1e-13,s[3]);a.setClearColor(s[0],s[1],s[2],p),c|=Zi.COLOR_BUFFER_BIT}return n&&(c|=Zi.DEPTH_BUFFER_BIT),o===!1?o=0:(o===!0&&(o=255),c|=Zi.STENCIL_BUFFER_BIT),c&&a.clearSafe(c,o),t(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const hmt=[0,0,0,0],dmt=[0,1,0,1];class pmt{constructor(t){this.context=t,this._renderPlugins=new Vt,this.slots=[];for(let i=0;i<Se.MAX_SLOTS;++i)this.slots[i]=[]}add(t,i,r){const s=()=>{if(r==null?void 0:r.aborted)throw i.uninitializeRenderContext(),di();this._renderPlugins.push(i);for(const o of t)this.slots[o].push(i);this.context.requestRender()},n=i.initializeRenderContext(this.context,r);if(Eu(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let i=0;i<this.slots.length;++i)this.slots[i]=this.slots[i].filter(r=>r!==t);t.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(fmt(r)){const s=r.prepareTechnique(this.context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this.context.renderContext,i[s]))}queryDepthRange(t){const i=mmt;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&q2(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[Se.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,0)}}function fmt(e){return"prepareTechnique"in e}const mmt={near:0,far:0};class wSe extends Cwe{}const JU=255,gmt=1/JU;function ymt(){const e=new Hi,t=e.fragment;return t.include(yc),t.include(Tu),e.include(_U),e.include(Jv),e.include(mU,{receiveShadows:!0}),t.uniforms.add([new zt("depthMap",i=>i.linearDepthTexture),new yr("inverseViewMatrix",(i,r)=>us(kae,Ia(kae,r.camera.viewMatrix,r.camera.center))),new fi("nearFar",(i,r)=>r.camera.nearFar)]),t.constants.add("sampleValue","float",gmt),t.code.add(x`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const kae=Ae(),vmt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:wSe,shadowCastMaxSamples:JU,build:ymt},Symbol.toStringTag,{value:"Module"}));var vw;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(vw||(vw={}));class fH extends Da{constructor(){super(...arguments),this.visualization=vw.Gradient,this.bandsEnabled=!1}}u([G({count:vw.COUNT})],fH.prototype,"visualization",void 0),u([G()],fH.prototype,"bandsEnabled",void 0);function _mt(e){const t=new Hi,i=t.fragment;i.include(yc),i.include(Tu),t.include(_U),t.include(Jv);const{visualization:r,bandsEnabled:s}=e;i.constants.add("inverseSampleValue","float",JU),i.uniforms.add([new zt("shadowCastMap",a=>a.shadowCastMap),new We("sampleScale",a=>a.sampleScale),new We("opacityFromElevation",a=>a.opacityFromElevation),new ti("uColor",a=>a.color)]);const n=r===vw.Gradient,o=r===vw.Threshold;return n&&s?i.uniforms.add(new We("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new We("threshold",a=>a.threshold)),i.code.add(x`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?x`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?x`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?x`* strength`:""});
      }
    `),t}const bmt=Object.freeze(Object.defineProperty({__proto__:null,build:_mt},Symbol.toStringTag,{value:"Module"}));class KU extends cr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=KU.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:gu,colorWrite:Kt,depthTest:null,depthWrite:null})}get primitiveType(){return Pt.TRIANGLE_STRIP}}KU.shader=new Ki(bmt,()=>import("./ShadowCastVisualize.glsl.90835dbc.js"));const wmt=gi(.01,0,.25,1),xmt=4e4,Tmt=5e4,xSe=1/512;let IL=class extends Ee{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:wmt,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new fH,this._enabled=!1,this._vao=La(t),this._techniqueConfig.visualization=vw.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Xe(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(KU,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,xo(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>xSe}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;oO(e,t)||(kd(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],IL.prototype,"opacityFromElevation",null),IL=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],IL);class ek extends cr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=ek.shader.get().build();return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:so(Re.ONE,Re.ONE,Re.ONE,Re.ONE),colorWrite:Kt,depthTest:null,depthWrite:null})}get primitiveType(){return Pt.TRIANGLE_STRIP}}ek.shader=new Ki(vmt,()=>import("./ShadowCastAccumulate.glsl.4f4ad543.js"));var JA;let ko=JA=class extends Ee{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new wSe,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=sH,this._previewing=!1,this._handles=new Ht,this._cameraForcedForScreenshot=!1,this._bindParameters=new F5(new pZ(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new Qi,this._vao=La(e);const o={colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE,width:0,height:0},a={target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new wr(e,o,a),this._accumulationRenderer=new IL(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(yt.SHADOW_ACCUMULATOR,this)),this._handles.add(ae(()=>i.renderView,c=>{this._handles.remove(JA.renderViewHandleKey),A(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),JA.renderViewHandleKey)},Ps))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(A(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new ek(e,new Da)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==sH&&this._opacityFromElevation>xSe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(wv(t,e,Bb))return;const i=e.length;t.length=i,this._sampleCount=Math.min(JU,i);for(let r=0;r<i;++r){const s=e[r],n=t[r]||M();se(n,s),t[r]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(JA.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Xe(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Xe(this._fbo),this._vao=Xe(this._vao),this._accumulationTechnique=Yi(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=Smt;return this._fbo.readPixels(e,t,1,1,ze.RGBA,St.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Zi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,xo(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-HS(xmt,Tmt,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};ko.previewSamples=6,ko.renderViewHandleKey="renderView",u([d()],ko.prototype,"_progress",void 0),u([d()],ko.prototype,"_sampleCount",void 0),u([d()],ko.prototype,"_enabled",void 0),u([d()],ko.prototype,"_depthRange",void 0),u([d()],ko.prototype,"_previewing",void 0),u([d()],ko.prototype,"_accumulationRenderer",void 0),u([d()],ko.prototype,"_isRefining",null),u([d()],ko.prototype,"_isActive",null),u([d()],ko.prototype,"canAccumulate",null),u([d()],ko.prototype,"_isDoneAccumulating",null),u([d()],ko.prototype,"_opacityFromElevation",null),u([d()],ko.prototype,"running",null),ko=JA=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],ko);const Smt=new Uint8Array(4),zae={highlightedThreshold:.99999,selfShadowThreshold:.025};function Emt(){const e=new Hi;e.include(dw,{receiveShadows:!0});const t=e.fragment;return t.include(yc),t.include(Tu),e.include(_U),e.include(Jv),t.uniforms.add([new zt("defaultDepthTex",(i,r)=>r.shadowMap.getSnapshot(z2.Default)),new zt("highlightDepthTex",(i,r)=>r.shadowMap.getSnapshot(z2.Highlight)),new zt("depthMap",(i,r)=>r.linearDepthTexture),new zt("highlightMap",(i,r)=>r.highlightColorTexture),new ti("uColor",i=>i.shadowColor),new fi("nearFar",(i,r)=>r.camera.nearFar),new We("opacity",i=>i.shadowOpacity),new We("occludedOpacity",i=>i.occludedShadowOpacity),new We("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new xt("lightingMainDirectionView",(i,r)=>we(Vae,ke(Vae,r.lighting.lightingMainDirection,r.camera.viewInverseTransposeMatrix))),new fi("texelSize",(i,r)=>_(r.linearDepthTexture)?pi(Cmt,1/r.linearDepthTexture.descriptor.width,1/r.linearDepthTexture.descriptor.height):Mh),new yr("inverseViewMatrix",(i,r)=>us(Bae,Ia(Bae,r.camera.viewMatrix,r.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",_be).add("highlightedThreshold","float",zae.highlightedThreshold).add("selfShadowThreshold","float",zae.selfShadowThreshold),t.code.add(x`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(x`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Bae=Ae(),Vae=M(),Cmt=tt(),Amt=Object.freeze(Object.defineProperty({__proto__:null,build:Emt},Symbol.toStringTag,{value:"Module"}));class Rmt extends Us{constructor(){super(...arguments),this.shadowColor=gi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class tk extends cr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=tk.shader.get().build();return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({blending:so(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:Kt,depthTest:null,depthWrite:null})}get primitiveType(){return Pt.TRIANGLE_STRIP}}tk.shader=new Ki(Amt,()=>import("./ShadowHighlight.glsl.c6808ed8.js"));const Omt=.001953125,Mmt=4e4,Pmt=5e4;class Imt{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new Rmt,this._drawParameters=new Cwe,this._vao=La(this._rctx)}get technique(){return A(this._technique)&&(this._technique=new tk({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,i){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const r=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,xo(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(i=(t=this._vao)==null?void 0:t.size)!=null?i:0}setDefaultOptions(t){this._passParameters=F(F({},this._passParameters),t),this._updateMaxOpacity()}updateParameters(t,i){this._passParameters.opacityElevation=1-HS(Mmt,Pmt,t.relativeElevation);const r=this._viewingMode===Ve.Global?we(Gae,t.center):te(Gae,0,0,1),s=xe(r,i);this._passParameters.dayNightTerminator=HS(0,1,De(30*s,0,1))}dispose(){this._vao=Xe(this._vao),this._technique=Yi(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*t*i>=Omt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const Gae=M(),jae=Zv();class $mt{constructor(){this._plane=Zv()}get isEnabled(){return!$fe(this.plane,jae)}get plane(){return this._plane}set plane(t){Iw(t||jae,this._plane)}}var Sf;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(Sf||(Sf={}));class TSe extends Da{constructor(){super(...arguments),this.output=Sf.EdgeDetector}}u([G({count:Sf.COUNT})],TSe.prototype,"output",void 0);const Uy={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function Dmt(e){const t=new Hi;return e.output===Sf.EdgeDetector&&(t.attributes.add(R.POSITION,"vec2"),t.vertex.uniforms.add(new Ca("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(x`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new $r("tColor")),t.fragment.code.add(x`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${x.float(Uy.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${x.float(Uy.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===Sf.BlendWeight&&(t.attributes.add(R.POSITION,"vec2"),t.vertex.uniforms.add(new Ca("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(x`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${x.int(Uy.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new $r("tEdges")),t.fragment.uniforms.add(new $r("tArea")),t.fragment.uniforms.add(new $r("tSearch")),t.fragment.uniforms.add(new $r("tColor")),t.fragment.uniforms.add(new Ca("resolution")),t.fragment.code.add(x`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(Uy.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(Uy.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(Uy.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(Uy.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${x.int(Uy.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===Sf.Blur&&(t.attributes.add(R.POSITION,"vec2"),t.vertex.uniforms.add(new Ca("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(x`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new $r("tBlendWeights")),t.fragment.uniforms.add(new $r("tColor")),t.fragment.uniforms.add(new Ca("resolution")),t.fragment.code.add(x`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const Lmt=Object.freeze(Object.defineProperty({__proto__:null,build:Dmt},Symbol.toStringTag,{value:"Module"}));class ik extends cr{initializeProgram(t){const i=ik.shader.get().build(this.configuration);return new er(t.rctx,i,Ni)}initializePipeline(){return Ut({colorWrite:Kt})}}ik.shader=new Ki(Lmt,()=>import("./SMAA.glsl.844e0fa1.js"));let KA=class extends Ee{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Ah(this._abortController),this.disable()}_loadResources(e){if(_(this._abortController))return!1;if(_(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return import("./SmaaRenderPassData.e07ab82b.js").then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return hi(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,Je.LINEAR,ze.RGB),this._loadTextureFromBase64(e.searchTexure,Je.NEAREST,ze.LUMINANCE)]).then(([i,r])=>{Xs(t)?(i.dispose(),r.dispose(),hi(t)):(this._areaTexture=i,this._searchTexture=r)})}get updating(){return _(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new TSe,i=(r,s)=>this._techniqueRep.releaseAndAcquire(ik,r,s);t.output=Sf.EdgeDetector,this._edgeDetectTechnique=i(t,this._edgeDetectTechnique),t.output=Sf.BlendWeight,this._blendWeightsTechnique=i(t,this._blendWeightsTechnique),t.output=Sf.Blur,this._blurTechnique=i(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=rje(this.rctx),this._edges=new wr(this.rctx,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},{target:pt.TEXTURE_2D,pixelFormat:ze.RGB,dataType:St.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new wr(this.rctx,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.LINEAR,wrapMode:bt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Xe(this._vao),this._areaTexture=Xe(this._areaTexture),this._searchTexture=Xe(this._searchTexture),this._blend=Xe(this._blend),this._edges=Xe(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(Zi.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays(Pt.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(Zi.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(Pt.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(Zi.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(Pt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return ap(e).then(r=>new st(this.rctx,{pixelFormat:i,dataType:St.UNSIGNED_BYTE,wrapMode:bt.CLAMP_TO_EDGE,width:r.width,height:r.height,samplingMode:t},r))}};u([d()],KA.prototype,"_abortController",void 0),u([d({readOnly:!0})],KA.prototype,"updating",null),KA=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],KA);function Nmt(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],o=i[3],a=i[7],l=i[11],c=i[15];i[0]+=o*r,i[1]+=o*s,i[2]+=o*n,i[4]+=a*r,i[5]+=a*s,i[6]+=a*n,i[8]+=l*r,i[9]+=l*s,i[10]+=l*n,i[12]+=c*r,i[13]+=c*s,i[14]+=c*n}function Fmt(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}class Umt{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const i=this.originData.get(t.id);return i?(i.refCount++,i.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Ae(),origin:t}),t)}release(t){const i=this.originData.get(t.id);i&&(i.refCount--,i.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(i=>{gs(i.viewMatrix,t),Fmt(i.origin.vec3,i.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}class kmt extends wwe{constructor(t,i,r){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=i,this.transparency=r,this.transformNormalViewFromGlobal=Sr()}}class zmt extends xwe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Sr(),this.slicePlaneLocalOrigin=M(),this.transformNormalGlobalFromModel=Sr()}}function Bmt(e){const t=x`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const Vmt=Ii(.5,-4e-4);function Gmt(e,t){const i=e.vertex;i.include(Bmt),i.constants.add("depthBias","vec2",Vmt),i.uniforms.add(new fi("inverseViewport",(r,s)=>s.inverseViewport)),t.legacy?(i.uniforms.add(new Mv("localView")),i.uniforms.add(new yr("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new o3("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new yr("transformProjFromView",r=>r.transformProjFromView)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(x`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function jmt(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(x`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(x`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Hmt(e,t){const i=e.vertex;t.silhouette?(i.code.add(x`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function qmt(e,t){const i=e.vertex;i.include(yc),i.uniforms.add(new We("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(x`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new $r("componentDataTex")),i.uniforms.add(new vg("componentDataTexInvDim")),e.attributes.add(R.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.constants.add("verticalOffsetScale","float",2*JZ),i.code.add(x`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new DO("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(R.NORMALA,"vec3"),e.attributes.add(R.NORMALB,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(R.NORMAL,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(x`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include($F,t),i.include($F,t),i.uniforms.add([new o3("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new DO("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Oa("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Oa("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new xt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new xt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(x`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?x`normalize(transformWorldFromModelTL + rotatedModelPosition);`:x`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new yr("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(x`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function SSe(e){return e.mode===Is.SKETCH||e.mode===Is.MIXED}var Is;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(Is||(Is={}));function Wmt(e,t){const i=e.vertex;switch(t.mode){case Is.SKETCH:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Is.MIXED:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case Is.SOLID:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function sQ(e,t){const i=e.vertex;switch(e.attributes.add(R.SIDENESS,"vec2"),t.mode===Is.MIXED?i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case Is.MIXED:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Is.SKETCH:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Is.SOLID:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Is.COUNT:break;default:t.mode}}function Xmt(e,t){const i=e.vertex;switch(e.include(sQ,t),SSe(t)&&i.uniforms.add(new $i("strokesAmplitude")),t.mode){case Is.SOLID:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case Is.SKETCH:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case Is.MIXED:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Ymt(e,t){const i=e.vertex;e.include(sQ,t);const r=e.fragment;switch(SSe(t)&&(i.uniforms.add(new vg("strokesTextureScale")),i.uniforms.add(new $i("strokesLog2Resolution")),i.uniforms.add(new $i("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new $r("strokesTexture")),r.uniforms.add(new $i("strokesNormalizationScale")),i.code.add(x`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(yc),r.code.add(x`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case Is.SOLID:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(x`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case Is.SKETCH:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(x`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case Is.MIXED:e.varyings.add("vType","float"),i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(x`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Zmt(e){const t=new Hi,i=t.vertex,r=t.fragment;return e.legacy&&i.uniforms.add(new Mv("model")),e.antialiasing&&(i.code.add(x`#define ANTIALIASING 1`),r.code.add(x`#define ANTIALIASING 1`)),t.include(Gmt,e),t.include(qmt,e),t.include(Xmt,e),t.include(sQ,e),t.include(Ymt,e),t.include(cs,e),t.include(Hmt,e),t.include(jmt,e),t.include(Wmt,e),t.include(Su,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new fi("pixelToNDC",(s,n)=>pi(Qmt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))),i.uniforms.add(new ti("viewport",(s,n)=>n.camera.fullViewport)),i.uniforms.add(new We("pixelRatio",(s,n)=>n.camera.pixelRatio)),t.attributes.add(R.POSITION0,"vec3"),t.attributes.add(R.POSITION1,"vec3"),t.attributes.add(R.VARIANTOFFSET,"float"),t.attributes.add(R.VARIANTSTROKE,"float"),t.attributes.add(R.VARIANTEXTENSION,"float"),i.code.add(x`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(x`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const Qmt=tt(),Jmt=Object.freeze(Object.defineProperty({__proto__:null,build:Zmt},Symbol.toStringTag,{value:"Module"}));class rk extends cr{initializeProgram(t){const i=rk.shader.get().build(this.configuration);return new er(t.rctx,i,aH)}initializePipeline(t){return t.blendMinMax?Ut({blending:so(Re.ONE,Re.ONE,Re.ZERO,Re.ONE,Ng.ADD,t.blendMinMax.MAX),depthTest:{func:hr.LEQUAL},colorWrite:Kt}):Ut({depthTest:{func:hr.LEQUAL},depthWrite:wl,colorWrite:Kt})}}rk.shader=new Ki(Jmt,()=>import("./EdgeShader.glsl.9e1b72da.js"));class Qp extends qo{constructor(){super(...arguments),this.mode=Is.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([G({count:Is.COUNT})],Qp.prototype,"mode",void 0),u([G()],Qp.prototype,"hasSlicePlane",void 0),u([G()],Qp.prototype,"silhouette",void 0),u([G()],Qp.prototype,"legacy",void 0),u([G()],Qp.prototype,"antialiasing",void 0),u([G()],Qp.prototype,"doublePrecisionRequiresObfuscation",void 0),u([G()],Qp.prototype,"hasMultipassTerrain",void 0),u([G()],Qp.prototype,"cullAboveGround",void 0),u([G()],Qp.prototype,"spherical",void 0);const Kmt=8,r8=128,egt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class tgt{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const igt={solid:Is.SOLID,sketch:Is.SKETCH,uber:Is.MIXED};class ZR{constructor(t,i,r){this.rctx=t,this.shaderTechniqueRepository=i,this._configuration=new Qp,this.refCount=new tgt,this.renderables=new Set,this.sortedRenderables={[It.TRANSPARENT]:{[It.TRANSPARENT]:new Vt,[It.OPAQUE]:new Vt},[It.OPAQUE]:{[It.TRANSPARENT]:new Vt,[It.OPAQUE]:new Vt}},this._renderablesDirty=!1,this._drawParameters=new zmt,this._settings=F(F({},egt),r),this.key=ZR.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Gi.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=igt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=p3(t),this._configuration.spherical=r.spherical}dispose(){this._technique=Yi(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,i){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[i][It.TRANSPARENT].forAll(t),this.sortedRenderables[i][It.OPAQUE].forAll(t)}updateTechnique(t,i){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(rk,this._configuration,this._technique),this._technique}bindRegularEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!1),t,i)}bindSilhouetteEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!0),t,i)}renderRegularEdges(t,i,r,s,n){this._render(t,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(t,i,r,s,n){this._render(t,i,i.silhouette.vao,r,s,n)}_render(t,i,r,s,n,o){this._bindDraw(t,i,s,o),this.rctx.bindVAO(r),this.rctx.capabilities.instancing.drawArraysInstanced(Pt.TRIANGLE_FAN,0,4,n)}_bindDraw(t,i,r,s){if(i.components.buffer.textureBuffer.bind(t,rgt,sgt),"origin"in i.transform)t.setUniformMatrix4fv("localView",s),t.setUniformMatrix4fv("model",i.transform.modelMatrix),se(this._drawParameters.slicePlaneLocalOrigin,i.transform.origin.vec3);else{const n=new XU(i.transform.position),o=$h(Hae,Nw(Hae,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=r.camera.viewInverseTransposeMatrix;te(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,r),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const i=this._settings.strokesTexture,r=i.texture;A(r)||(t.bindTexture("strokesTexture",r),t.setUniform2f("strokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(i.resolution)),t.setUniform1f("strokesNormalizationScale",i.normalizationScale),t.setUniform1f("strokesAmplitude",i.amplitude),t.setUniform1f("strokeVariants",i.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[It.TRANSPARENT][It.TRANSPARENT].clear(),this.sortedRenderables[It.TRANSPARENT][It.OPAQUE].clear(),this.sortedRenderables[It.OPAQUE][It.TRANSPARENT].clear(),this.sortedRenderables[It.OPAQUE][It.OPAQUE].clear(),this.renderables.forEach(i=>{i.objectTransparency!==It.INVISIBLE&&i.edgeTransparency!==It.INVISIBLE&&this.sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform&&"origin"in r.transform?i.transform.origin.id<r.transform.origin.id?-1:i.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[It.TRANSPARENT][It.TRANSPARENT].sort(t),this.sortedRenderables[It.TRANSPARENT][It.OPAQUE].sort(t),this.sortedRenderables[It.OPAQUE][It.TRANSPARENT].sort(t),this.sortedRenderables[It.OPAQUE][It.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const rgt="componentDataTex",sgt="componentDataTexInvDim",Hae=xg();class ngt extends nTe{constructor(t){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},t)}async process(t,i,r){if(r)return iQ(t);const s=this._packInput(t),n=await this.invoke(s,i);return this._unpackOutput(n)}async extractEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractEdgeLocations",r,i);return C$(s)}async extractComponentsEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractComponentsEdgeLocations",r,i);return C$(s)}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:zL(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:C$(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:C$(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function ogt(e){const i=$C.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=$C.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=$C.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:y}of $C.strokes){let v=m,w=y,b=p;for(let S=0;S<c;S++){S!==0&&(v=qae(v,wM.DISTANCE),w=qae(w,wM.PRESSURE));for(let T=0;T<$C.resolution;T++){const E=.5+(v?v[T%v.length]/a:0),C=w?w[T%w.length]:1;eM(E,s,b),eM(C,s,b+n),b+=4}b-=l*(h+1)}p+=l}const f=new st(e,{pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:Je.LINEAR,width:i,height:i,wrapMode:bt.REPEAT},s);return new lgt(i,a,o,h,f)}function qae(e,t){if(!e)return null;const i=e.length/2,r=agt*i,s=new Array(i);let n=0;const o=t===wM.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*Wae):Math.min(r,l*Wae)}return s}var wM;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(wM||(wM={}));const agt=.1,Wae=.5;class lgt{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=Xe(this.texture)}}const $C={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Xae(e){let t=null;for(const i of e){const r=i.type;if(cgt(i)){if(A(t))t=r;else if(t!==r)return"uber"}}return _(t)?t:"uber"}function s8(e){let t=It.INVISIBLE;for(const{material:i}of e)if(ESe(i)){if(i.color[3]*i.opacity<1)return It.TRANSPARENT;t=It.OPAQUE}return t}function n8(e){let t=It.INVISIBLE;for(const{material:i}of e)if(ESe(i)){switch(i.objectTransparency){case It.TRANSPARENT:case It.INVISIBLE:return It.TRANSPARENT;case It.OPAQUE:if(i.opacity<1)return It.TRANSPARENT}t=It.OPAQUE}return t}function ESe(e){return e.size*e.color[3]*e.opacity>0}function cgt(e){return e.size*e.color[3]>0}function ugt(e,t){const i=ice(e,t,!0);return i===-1?t<e[0]?0:e.length:i}function Yae(e,t,i){return e.length-ugt(e,t*i.minimumEdgeLength)}function Zae(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}const hgt=fe.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let bd=class extends Ee{constructor(e){super(e),this.updatingHandles=new _f,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[It.TRANSPARENT]:0,[It.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=M(),this.localOrigins=new Umt(new dZ(e.renderSR))}initialize(){this.worker=new ngt(this.schedule),this.componentColorManager=new gSe(this.rctx,3);const e=lSe.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=ii.createVertex(this.rctx,bi.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=Xe(this.strokesTexture),this.componentColorManager=at(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Xe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[It.TRANSPARENT]+this.numberOfRenderedEdges[It.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new Qae(new Promise(p=>l=p),i.center,i.radius);this.perObjectData.set(e,c);const h=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void hgt.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new Qae(new Promise(c=>n=c),o,mg(o));this.perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&pgt(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let c=0;c<e.geometries.length;c++){const h=e.geometryRecords[c];if(!h.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,h,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?r=>t[r]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{const s=r.components.meta.length;for(let n=0;n<s;n++){const o=i(n),a=r.components.meta[n],l=a.index;a.material.opacity=o,r.components.buffer.textureBuffer.setDataElement(l,1,3,255*o)}this._updateTransparency(r)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,i)=>t+i.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof iy,n=!!i.hasSlicePlane,o=Xae(t),a=ZR.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(a!==l.rendererKey){const c=this.renderers.get(l.rendererKey),h=this._acquireRenderer(o,n,s);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=a,h.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];r&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>{var s;const r=i.components.meta;for(let n=0;n<r.length;n++)i.components.meta[n].verticalOffset=(s=t==null?void 0:t[n])!=null?s:0;this._updateComponentBuffer(i.components)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>i.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,t.loaded==null)throw di();return t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,A(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=M(),s=new XU;let n=0,o=0;if(this.renderers.forEach(h=>{h.refCount.value===0?(this.renderers.delete(h.key),h.dispose()):h.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,p.regular&&h.updateTechnique(e,!1),p.silhouette&&h.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),o===0)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new kmt(a,l,t);te(r,i[3],i[7],i[11]),s.set(r),se(c.transformWorldFromViewTH,s.high),se(c.transformWorldFromViewTL,s.low),Ih(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),$h(Jae,c.transformViewFromCameraRelativeRS),Nw(c.transformNormalViewFromGlobal,Jae),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(h=>{this._renderRegularEdges(h,e,c),this._renderSilhouetteEdges(h,e,c)})}_updateTransparency(e){const t=s8(e.components.meta),i=n8(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),_(t.origin))this.localOrigins.register(t.origin);else{const r=te(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(r)}return Nmt(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e,r=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=De(Math.round(n.size*Kmt),0,255),l=De(n.extensionLength,-r8,255-r8)+r8,c=n.type==="solid"?t4.SOLID:t4.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],v=255*p[3];i.textureBuffer.setData(o,0,f,m,y,v),i.textureBuffer.setData(o,1,a,l,c,h),oSe(t[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(e){if(A(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=i.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if(A(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new Ns(this.rctx,aH,{vertices:Rae,instances:KF.glLayout},{vertices:this.verticesBufferObject,instances:ii.createVertex(this.rctx,bi.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new Ns(this.rctx,aH,{vertices:Rae,instances:e4.glLayout},{vertices:this.verticesBufferObject,instances:ii.createVertex(this.rctx,bi.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,o){const a=i.vertexAttributes.get(R.POSITION),l=i.indices.get(R.POSITION),c=Ae(),h={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,r,c)};return this._addPositionData(t,h,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([r]);if(A(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,m=vM.createBuffer(f);for(let T=0;T<f;T++)m.position.set(T,0,p.data[T*p.size+0]),m.position.set(T,1,p.data[T*p.size+1]),m.position.set(T,2,p.data[T*p.size+2]);Zae(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,i));if(e.loaded==null)return;const{regular:v,silhouette:w}=this._createEdgeResources(y),b=(v?v.vao.size:0)+(w?w.vao.size:0),S={regular:v,silhouette:w,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:b,externalMemoryUsage:!1,averageEdgeLength:y.averageEdgeLength},components:o,visible:!0,edgeTransparency:s8(o.meta),objectTransparency:n8(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(S),a.addRenderable(S),this.gpuMemoryUsage+=b}async _addComponentGeometry(e,t,i,r,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(A(a))return 0;const l=Xae(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=vM.createBuffer(i.count);OU(h.position,i),Zae(a.meta,s,h.componentIndex,r);const p=!0,f=c.writerSettings,m=await this.updatingHandles.addPromise(this._extractEdges(f,h,p,!1,r));if(t.loaded==null)return 0;const{regular:y,silhouette:v}=this._createEdgeResources(m),w=(y?y.vao.size:0)+(v?v.vao.size:0),b={regular:y,silhouette:v,transform:e,statistics:{gpuMemoryUsage:w,externalMemoryUsage:!0,averageEdgeLength:m.averageEdgeLength},components:a,visible:!0,edgeTransparency:s8(a.meta),objectTransparency:n8(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(b),c.addRenderable(b),w}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let b=0;b<e.geometries.length;b++){const S=e.geometries[b],T=e.geometryRecords[b];if(!T.material.supportsEdges)continue;!a&&T.origin&&(a=T);const E=S.vertexAttributes.get(R.POSITION);l+=E.data.length/E.size,o+=S.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let b=0;b<e.geometries.length;b++){const S=e.geometries[b];if(!e.geometryRecords[b].material.supportsEdges)continue;const T=S.vertexAttributes.get(R.POSITION),E=S.indices.get(R.POSITION);let C=n.get(T.data);if(C==null){C=p.length/3;for(let O=0;O<T.data.length;O+=T.size)p.push(T.data[O+0]),p.push(T.data[O+1]),p.push(T.data[O+2]);n.set(T.data,C)}if(E)for(let O=0;O<S.edgeIndicesLength;O++)h[f++]=C+E[O]}const m=a||e.geometryRecords[0],y=Ae(),v=this._computeModelTransformWithLocalOrigin(e,m,y);for(let b=0;b<e.geometryRecords.length;b++)e.geometryRecords[b].origin=v;const w={position:{data:p,size:3},indices:h,modelTransform:y,origin:v};await this.updatingHandles.addPromise(this._addPositionData(t,w,h.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=ZR.getKey(e,t,i);let s=this.renderers.get(r);return A(this.strokesTexture)&&(this.strokesTexture=ogt(this.rctx)),s||(s=new ZR(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:i,spherical:this.viewingMode===Ve.Global}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){dgt(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=M(),s=n=>{const{center:o,radius:a}=n;uc(r,o,t);const l=xe(r,i),c=l<-a?1/0:l<a?0:l-a;n.renderables.forEach(h=>h.distanceToCamera=c)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.regular)return;const o=Yae(n.regular.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):en;e.renderRegularEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.silhouette)return;const o=Yae(n.silhouette.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):en;e.renderSilhouetteEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}};function dgt(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function pgt(e){let t=null,i=null;for(let r=0;r<e.geometries.length;r++){const s=e.geometryRecords[r];if(s.material.supportsEdges){if(t){if(!wv(t,s.transformation))return!1}else t=s.transformation;if(!i&&_(s.origin))i=s;else if(_(i==null?void 0:i.origin)&&_(s.origin)&&i.origin.id!==s.origin.id)return!1}}return!0}u([d({constructOnly:!0})],bd.prototype,"rctx",void 0),u([d({constructOnly:!0})],bd.prototype,"renderSR",void 0),u([d({constructOnly:!0})],bd.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],bd.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],bd.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],bd.prototype,"schedule",void 0),u([d({readOnly:!0})],bd.prototype,"updatingHandles",void 0),u([d({readOnly:!0})],bd.prototype,"updating",null),bd=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],bd);class Qae{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const Jae=Sr();function fgt(e){const t=e.capabilities.disjointTimerQuery;return A(t)?null:t.timestampBits()>0?new mgt(t):mH?null:new ggt(t)}class mgt{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,i=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,i)}_checkQueryResult(t,i){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,i),i);if(this.timer.disjoint())return void t(null);const r=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-r)/1e6)}}class ggt{constructor(t){this.timer=t,this.query=t.createQuery(),mH=!0,this.timer.beginTimeElapsed(this.query)}stop(t,i=50){this.timer.endTimeElapsed(),mH=!1,this._checkQueryResult(t,i)}_checkQueryResult(t,i){const r=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!r||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,i),i);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let mH=!1;var Es;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(Es||(Es={}));const ygt=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class vgt extends cv{constructor(){super("total"),this.total=0,this.frameCount=0}}class _gt{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new vgt,this.gpuTime=new cv("gpu",9),this.renderPassTimings=ygt.map(t=>new cv(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:LH(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=fgt(t))}advance(t){const i=performance.now();this.renderPassTimings[t].record(i-this._lastSample),this._lastSample=i}postrender(){_(this._gpuTimer)&&(this._gpuTimer.stop(i=>_(i)&&this.gpuTime.record(i),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const Kae=.9;let Bm=class extends Ee{constructor(e,t,i,r,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new _gt,this._antialiasing=Z1.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new Ht,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new KA(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new umt(this._rctx,this._compositingHelper),this._sliceHelper=new $mt,this._shadowMap=new pZ(this._rctx,l.viewingMode,2),this._ssaoHelper=new Lwe(i,this._rctx,()=>this._requestRender()),this._highlight=new omt(i,this._rctx),this._shadowHighlight=new Imt(this._rctx,l.viewingMode),this._shadowAccumulator=new ko(this._rctx,i,l,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(Ge.MATERIAL_DEPTH_SHADOWMAP_ALL,c.shadowMap),c.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new Get(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new pmt({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new Yft(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ae(()=>this._stage.state.camera,()=>this._requestRender(),Ps),ae(()=>Gi.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(It.TRANSPARENT):()=>{},this._requestRender()},Ft)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=at(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Xe(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),U5.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===Z1.SMAA&&this._smaaPass.updating||_(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return A(this._edgeView)&&(this._edgeView=new bd({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(ae(()=>qs(this._edgeView,e=>e.updating),()=>this._requestRender(),Vi)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Epe(this._bindParameters.ssr.reprojectionMatrix,en)}set _reprojectionMatrix(e){RH(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)==null?void 0:e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:i,_bindParameters:r}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),_(e.environment)){_(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&i.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(i.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type==="sun";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?Z1.SMAA:Z1.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(t.length===0&&i.length===0&&r.length===0)return;i.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=bwe(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new Iwe(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=Ws(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=Ws(this._materialRenderers,o=>o.hasOccludees),this._hasWater=Ws(this._materialRenderers,o=>o.hasWater),this._needsTransparentPass=Ws(this._materialRenderers,o=>o.requiresSlot(Se.TRANSPARENT_MATERIAL,Ge.MATERIAL)),this._hasHUDElements=Ws(this._materialRenderers,o=>o.requiresSlot(Se.LINE_CALLOUTS_HUD_DEPTH,Ge.MATERIAL)||o.requiresSlot(Se.HUD_MATERIAL,Ge.MATERIAL)||o.requiresSlot(Se.LABEL_MATERIAL,Ge.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=i,this._bindParameters.lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=gt.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=Zv(this._sliceHelper.plane);r===Jb.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,i),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Es.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance(Es.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t,i),this._renderLinearDepth(),this.performanceInfo.advance(Es.Lineardepth),this._accumulateShadows(o,t,i),this._renderNormal(),this.performanceInfo.advance(Es.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(Es.SSAO),this._renderContext.pass=Ge.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Es.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges(It.OPAQUE),this.performanceInfo.advance(Es.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Se.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Es.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot(Se.LINE_CALLOUTS),this.performanceInfo.advance(Es.Hudvisibility),this._renderEdges(It.TRANSPARENT,a),this.performanceInfo.advance(Es.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(oh.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(oh.Occluded,s.framebuffer),this.performanceInfo.advance(Es.HudOccluded)),this.performanceInfo.advance(Es.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges(It.OPAQUE),this.performanceInfo.advance(Es.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Es.Transparent),this._renderEdges(It.TRANSPARENT),this.performanceInfo.advance(Es.TransparentEdges))),a&&this._renderLineCallouts(oh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets(()=>{this._renderInternalSlot(Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Se.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Se.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(Es.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot(Se.LASERLINES_CONTRAST_CONTROL),this._bindParameters,bo.PremultipliedAlpha),this.performanceInfo.advance(Es.Laserline),this._renderOccluded(),this.performanceInfo.advance(Es.Occluded);const h=r===Jb.ON&&this._magnifierHelper.enabled,p=h&&A(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const f=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,f)&&_(f)&&this._compositingHelper.composite(this._bindParameters,f,bo.None),this.performanceInfo.advance(Es.Antialiasing),this._renderHUD(oh.NotOccluded,p),this.performanceInfo.advance(Es.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance(Es.Highlights),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,bo.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===Ms.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/Wft;this._animationTimestep=Math.max(this._animationTimestep*Kae+t*(1-Kae),Xft)}}readDepthPixels(e,t,i){const r=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Zi.COLOR_BUFFER_BIT|Zi.DEPTH_BUFFER_BIT|Zi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(Ge.MATERIAL_DEPTH)}r.readPixels(t[0],t[1],t[2],t[3],ze.RGBA,St.UNSIGNED_BYTE,i)}readHUDVisibility(e,t,i,r,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,i,r,ze.RGBA,St.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;_(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,bo.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,z2.Highlight)),s.clear(),this._renderShadowCascades(Ge.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,z2.Default),this._renderGeometryAndTransparentTerrainPass(Ge.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(Ge.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(Ge.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=Ge.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(Ge.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(Ge.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return sH;const t=Lft(e,this._content,this._stage.layers);return q2(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(Se.INTEGRATED_MESH),this._renderSlot(Se.OPAQUE_TERRAIN),this._renderInternalSlot(Se.OPAQUE_MATERIAL),this._renderSlot(Se.OPAQUE_MATERIAL),this._renderSlot(Se.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Se.TRANSPARENT_MATERIAL),this._renderSlot(Se.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Se.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Se.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===oh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Se.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Se.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,bo.PremultipliedAlpha)):e===oh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(oh.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Se.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Se.HUD_MATERIAL),this._renderInternalSlot(Se.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlight,r=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(Ge.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(Zi.DEPTH_BUFFER_BIT),this._renderHUDElements(oh.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},r=this._renderContext.pass;this._renderContext.pass=Ge.MATERIAL_ALPHA,i(gt.Alpha),this._renderContext.pass=Ge.MATERIAL,i(gt.Color),i(gt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=gt.NONE,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===Or.OccludeAndTransparentStencil&&(e|=o.renderOccluded,LC.push(o))});const t=this._offscreenRendering,i=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};LC.length!==0&&(this._renderInternalSlot(Se.OCCLUDER_MATERIAL,LC),i(.5,Or.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Se.TRANSPARENT_OCCLUDER_MATERIAL,LC),!1,!1),LC.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===Or.OccludeAndTransparent||o.renderOccluded===Or.Transparent||o.renderOccluded===Or.Opaque)&&(e|=o.renderOccluded,DC.push(o))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>Or.Occlude&&this._renderSlot(Se.OCCLUDED_TERRAIN),this._renderInternalSlot(Se.OPAQUE_MATERIAL,DC),this._renderInternalSlot(Se.TRANSPARENT_MATERIAL,DC),this._renderInternalSlot(Se.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,DC),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=Ge.MATERIAL,i(.5,Or.OccludeAndTransparent,()=>s(Or.OccludeAndTransparent),!0,fl.OutlineVisualElementMask),i(.5,Or.Transparent,()=>s(Or.Transparent),!0,fl.OutlineVisualElementMask),i(1,Or.Opaque,()=>s(Or.Opaque),!0,fl.OutlineVisualElementMask),DC.length=0}_renderAntiAliasing(e,t){if(e===Z1.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&_(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var r;this._ensureCameraBindParameters(e,t);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(r=i.depthTexture)!=null?r:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=en:(us(tle,this._bindParameters.camera.viewMatrix),us(ele,this._bindParameters.camera.projectionMatrix),Fr(kx,tle,ele),Fr(kx,this._renderContext.lastFrameCamera.viewMatrix,kx),Fr(kx,this._renderContext.lastFrameCamera.projectionMatrix,kx),this._reprojectionMatrix=kx),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,_(t)?t.forEach(r=>{if(!r.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(r);_(s)&&(i=s.render(this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((r,s)=>{s.shouldRender(this._renderContext)&&r.render(this._renderContext.pass,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=Wve(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((r=(i=this._highlight)==null?void 0:i.gpuMemoryUsage)!=null?r:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case $0.Color:return e._offscreenRendering.colorTexture;case $0.LinearDepth:return e._offscreenRendering.linearDepthTexture;case $0.Normals:return e._offscreenRendering.normalTexture;case $0.ShadowMap:return e._shadowMap.depthTexture;case $0.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case $0.Highlight:return e._offscreenRendering.highlightTexture}}}}};var $0;u([d()],Bm.prototype,"_shadowAccumulator",void 0),u([d()],Bm.prototype,"_smaaPass",void 0),u([d()],Bm.prototype,"_antialiasing",void 0),u([d()],Bm.prototype,"_edgeView",void 0),u([d()],Bm.prototype,"updating",null),u([d()],Bm.prototype,"isCameraFinal",null),Bm=u([P("esri.views.3d.webgl-engine.lib.Renderer")],Bm),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}($0||($0={}));const DC=[],LC=[],ele=Ae(),tle=Ae(),kx=Ae();class ile{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Re.ONE,dstRGB:Re.ZERO,srcAlpha:Re.ONE,dstAlpha:Re.ZERO},this.blendEquation={mode:Ng.ADD,modeAlpha:Ng.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Hd.BACK,this.frontFace=_2.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=hr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Hd.FRONT_AND_BACK,func:hr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Hd.FRONT_AND_BACK,fail:Jr.KEEP,zFail:Jr.KEEP,zPass:Jr.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class bgt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(i=>{var r;t.set(i,((r=t.get(i))!=null?r:0)+1)}),t.forEach((i,r)=>{const s=r.split(`
`);s.shift(),s.shift(),console.log(`${i}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const wgt={RECORD_ALLOCATIONS:!1};class xgt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new bgt(wgt.RECORD_ALLOCATIONS);this._current.length<dn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<dn.COUNT;++t){const i=this._current[t];i>0&&console.log(`${dn[t]}: ${i}`)}}this._allocations.print()}}const Tgt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var rle,CSe={exports:{}};(rle=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(CSe.exports=rle);const Sgt=CSe.exports;var sle,ASe={exports:{}};sle=ASe,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(sle.exports=t)}();const nle=ASe.exports;var RSe={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();i!==void 0&&(e.exports=i)})()})(RSe);const Egt=RSe.exports;var Kh=999,ole=9999,o8=0,a8=1,ale=2,lle=3,cle=4,P$=5,Cgt=6,Agt=7,Rgt=8,ule=9,Ogt=10,hle=11,Mgt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Pgt(){var e,t,i,r=0,s=0,n=Kh,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(k){return a=[],k!==null?v(k.replace?k.replace(/\r\n/g,`
`):k):w()};function y(k){k.length&&a.push({type:Mgt[n],data:k,position:h,line:l,column:c})}function v(k){var Y;for(r=0,i=(m+=k).length;e=m[r],r<i;){switch(Y=r,n){case o8:r=C();break;case a8:r=E();break;case ale:r=T();break;case lle:r=O();break;case cle:r=D();break;case hle:r=N();break;case P$:r=z();break;case ole:r=B();break;case ule:r=S();break;case Kh:r=b()}Y!==r&&(m[Y]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function w(k){return o.length&&y(o.join("")),n=Ogt,y("(eof)"),a}function b(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+r-1,n=o8,t=e,r+1):t==="/"&&e==="/"?(h=s+r-1,n=a8,t=e,r+1):e==="#"?(n=ale,h=s+r,r):/\s/.test(e)?(n=ule,h=s+r,r):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+r,n=p?cle:f?lle:ole,r)}function S(){return/[^\s]/g.test(e)?(y(o.join("")),n=Kh,r):(o.push(e),t=e,r+1)}function T(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,r+1):(y(o.join("")),n=Kh,r)}function E(){return T()}function C(){return e==="/"&&t==="*"?(o.push(e),y(o.join("")),n=Kh,r+1):(o.push(e),t=e,r+1)}function O(){if(t==="."&&/\d/.test(e))return n=P$,r;if(t==="/"&&e==="*")return n=o8,r;if(t==="/"&&e==="/")return n=a8,r;if(e==="."&&o.length){for(;I(o););return n=P$,r}if(e===";"||e===")"||e==="("){if(o.length)for(;I(o););return y(e),n=Kh,r+1}var k=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||k){for(;I(o););return n=Kh,r}return o.push(e),t=e,r+1}function I(k){for(var Y,Z,le=0;;){if(Y=nle.indexOf(k.slice(0,k.length+le).join("")),Z=nle[Y],Y===-1){if(le--+k.length>0)continue;Z=k.slice(0,1).join("")}return y(Z),h+=Z.length,(o=o.slice(Z.length)).length}}function N(){return/[^a-fA-F0-9]/.test(e)?(y(o.join("")),n=Kh,r):(o.push(e),t=e,r+1)}function D(){return e==="."||/[eE]/.test(e)?(o.push(e),n=P$,t=e,r+1):e==="x"&&o.length===1&&o[0]==="0"?(n=hle,o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=Kh,r):(o.push(e),t=e,r+1)}function z(){return e==="f"&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=Kh,r):(o.push(e),t=e,r+1)}function B(){if(/[^\d\w_]/.test(e)){var k=o.join("");return n=Sgt.indexOf(k)>-1?Rgt:Egt.indexOf(k)>-1?Agt:Cgt,y(o.join("")),n=Kh,r}return o.push(e),t=e,r+1}}function Igt(e){var t=Pgt(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function $gt(e){return Igt(e)}function Dgt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const l8=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Lgt(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function Ngt(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function eR(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,eR(e,t,r+"_"+t[r],r);return i}function OSe(e,t,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function Fgt(e,t,i,r="lowp"){OSe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Ugt(e,t,i,r,s="lowp"){OSe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function kgt(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&e.splice(i,r-i+1),s}function dle(e,t){const i=zgt();if(_(i))return i;const r=$gt(e);if(Lgt(r,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":t===tu.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===tu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===tu.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=eR(r,o,"fragColor"),Fgt(r,s,"vec4")),c.data=s),t===tu.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=kgt(r,l+1),p=eR(r,o,"fragData");Ugt(r,p,"vec4",h,"mediump"),c.data=p}else t===tu.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=eR(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(Tgt.includes(c.data)){if(t===tu.VERTEX_SHADER&&Ngt(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=eR(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&l8.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&l8.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&l8.includes(f[1].trim())&&(c.data="#if 0")}}return Bgt(e,Dgt(r))}function zgt(e){return null}function Bgt(e,t){return t}const Vgt=4294967295;class Ggt{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===ui.WEBGL2&&(i=dle(i,tu.VERTEX_SHADER),r=dle(r,tu.FRAGMENT_SHADER)),this._vShader=ple(this._context,tu.VERTEX_SHADER,i),this._fShader=ple(this._context,tu.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(dn.Shader,this),MO()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(_(this._glName))return this._glName;if(A(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),MO()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===ui.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const o=r.getUniformBlockIndex(i,s);o<Vgt&&r.uniformBlockBinding(i,o,n)}}return this._glName=i,this._context.instanceCounter.increment(dn.Program,this),i}get hasGLName(){return _(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(dn.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(dn.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){Mp(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){Mp(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){Mp(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){Mp(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){Mp(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){Mp(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){Mp(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(t,i){Mp(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){Mp(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){Mp(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}}function ple(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),MO()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===tu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(jgt(i))),s}function jgt(e){let t=2;return e.replace(/\n/g,()=>`
`+Hgt(t++)+":")}function Hgt(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Mp(e,t,i){const r=e.get(t);return r?RH(r,i):(e.set(t,Array.from(i)),!0)}class qgt{constructor(t){this._rctx=t,this._store=new uZ}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(_(n))return n.ref(),n;const o=new Ggt(this._rctx,t,i,r,s);return o.ref(),this._store.set(t,i,o),o}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}function fle(e,t){const i=new wr(e,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1});function r(b,S){const T=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,E=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,C=e.programCache.acquire(T,E,new Map([["position",0]])),O=new Float32Array(6);cj(b,O,3);const I=new Float32Array(6);return cj(S,I,3),e.useProgram(C),C.setUniform3f("u_highA",O[0],O[2],O[4]),C.setUniform3f("u_lowA",O[1],O[3],O[5]),C.setUniform3f("u_highB",I[0],I[2],I[4]),C.setUniform3f("u_lowB",I[1],I[3],I[5]),C}const s=ii.createVertex(e,bi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new Ns(e,new Map([["position",0]]),{geometry:[new to("position",2,ht.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Ue(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Ue(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=r(o,a),c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(Pt.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);i.readPixels(0,0,1,1,ze.RGBA,St.UNSIGNED_BYTE,y),l.dispose(),n.dispose(!1),s.dispose(),i.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c);const v=(o[2]-a[2])/25,w=XY(y);return Math.abs(v-w)}var mle,gle,yle,MSe={exports:{}};function Wgt(e){var y,v,w,b,S;if(!e.gl)return!1;if(e.type===ui.WEBGL1)return!(!((y=e.capabilities.textureFloat)==null?void 0:y.textureFloat)||!((v=e.capabilities.colorBufferFloat)==null?void 0:v.textureFloat));if(!(((w=e.capabilities.textureFloat)==null?void 0:w.textureFloat)&&((b=e.capabilities.colorBufferFloat)==null?void 0:b.textureFloat)&&((S=e.capabilities.colorBufferFloat)==null?void 0:S.floatBlend)))return!1;const t=new wr(e,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.FLOAT,internalFormat:mt.RGBA32F,samplingMode:Je.NEAREST,width:1,height:1}),i=ii.createVertex(e,bi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new Ns(e,new Map([["a_pos",0]]),{geometry:[new to("a_pos",2,ht.UNSIGNED_SHORT,0,4)]},{geometry:i}),s=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,o=e.programCache.acquire(s,n,new Map([["a_pos",0]]));e.useProgram(o);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(Pt.TRIANGLE_STRIP,0,4);const f=Ut({blending:wbe});e.setPipelineState(f),e.drawArrays(Pt.TRIANGLE_STRIP,0,4),MSe.exports.init(e);const m=e.gl.getError();return e.setViewport(l,c,h,p),e.bindFramebuffer(a),o.dispose(),r.dispose(!1),i.dispose(),t.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}mle=MSe,gle=function(){var e=function(v){window.console&&window.console.log&&window.console.log(v)},t=function(v){window.console&&window.console.error?window.console.error(v):e(v)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(v){if(r==null)for(var w in r={},s={},v)typeof v[w]=="number"&&(r[v[w]]=w,s[w]=v[w])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(v){return o(),r[v]!==void 0}function l(v){o();var w=r[v];return w!==void 0?"gl."+w:"/*UNKNOWN WebGL ENUM*/ 0x"+v.toString(16)}function c(v,w,b,S){var T;if((T=i[v])!==void 0&&(T=T[w])!==void 0&&T[b]){if(typeof T[b]=="object"&&T[b].enumBitwiseOr!==void 0){for(var E=T[b].enumBitwiseOr,C=0,O=[],I=0;I<E.length;++I){var N=s[E[I]];(S&N)!=0&&(C|=N,O.push(l(N)))}return C===S?O.join(" | "):l(S)}return l(S)}return S===null?"null":S===void 0?"undefined":S.toString()}function h(v,w){for(var b="",S=w.length,T=0;T<S;++T)b+=(T==0?"":", ")+c(v,S,T,w[T]);return b}function p(v,w,b){v.__defineGetter__(b,function(){return w[b]}),v.__defineSetter__(b,function(S){w[b]=S})}function f(v,w,b,S){S=S||v,n(v),w=w||function(N,D,z){for(var B="",k=z.length,Y=0;Y<k;++Y)B+=(Y==0?"":", ")+c(D,k,Y,z[Y]);t("WebGL error "+l(N)+" in "+D+"("+B+")")};var T={};function E(N,D){return function(){b&&b(D,arguments);var z=N[D].apply(N,arguments),B=S.getError();return B!=0&&(T[B]=!0,w(B,D,arguments)),z}}var C={};for(var O in v)if(typeof v[O]=="function")if(O!="getExtension")C[O]=E(v,O);else{var I=E(v,O);C[O]=function(){return f(I.apply(v,arguments),w,b,S)}}else p(C,v,O);return C.getError=function(){for(var N in T)if(T.hasOwnProperty(N)&&T[N])return T[N]=!1,N;return v.NO_ERROR},C}function m(v){var w=v.getParameter(v.MAX_VERTEX_ATTRIBS),b=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,b);for(var S=0;S<w;++S)v.disableVertexAttribArray(S),v.vertexAttribPointer(S,4,v.FLOAT,!1,0,0),v.vertexAttrib1f(S,0);v.deleteBuffer(b);var T=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(S=0;S<T;++S)v.activeTexture(v.TEXTURE0+S),v.bindTexture(v.TEXTURE_CUBE_MAP,null),v.bindTexture(v.TEXTURE_2D,null);for(v.activeTexture(v.TEXTURE0),v.useProgram(null),v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.disable(v.BLEND),v.disable(v.CULL_FACE),v.disable(v.DEPTH_TEST),v.disable(v.DITHER),v.disable(v.SCISSOR_TEST),v.blendColor(0,0,0,0),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.ONE,v.ZERO),v.clearColor(0,0,0,0),v.clearDepth(1),v.clearStencil(-1),v.colorMask(!0,!0,!0,!0),v.cullFace(v.BACK),v.depthFunc(v.LESS),v.depthMask(!0),v.depthRange(0,1),v.frontFace(v.CCW),v.hint(v.GENERATE_MIPMAP_HINT,v.DONT_CARE),v.lineWidth(1),v.pixelStorei(v.PACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),v.UNPACK_COLORSPACE_CONVERSION_WEBGL&&v.pixelStorei(v.UNPACK_COLORSPACE_CONVERSION_WEBGL,v.BROWSER_DEFAULT_WEBGL),v.polygonOffset(0,0),v.sampleCoverage(1,!1),v.scissor(0,0,v.canvas.width,v.canvas.height),v.stencilFunc(v.ALWAYS,0,4294967295),v.stencilMask(4294967295),v.stencilOp(v.KEEP,v.KEEP,v.KEEP),v.viewport(0,0,v.canvas.width,v.canvas.height),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);v.getError(););}function y(v){var w,b,S=[],T=[],E={},C=1,O=!1,I=[],N=0,D=0,z=!1,B=0,k={};function Y(j){return typeof j=="function"?j:function(ee){j.handleEvent(ee)}}v.getContext=(b=v.getContext,function(){var j=b.apply(v,arguments);if(j instanceof WebGLRenderingContext){if(j!=w){if(w)throw"got different context";E=K(w=j)}return E}return j});var Z=function(j){S.push(Y(j))},le=function(j){T.push(Y(j))};function ne(j){var ee=j.addEventListener;j.addEventListener=function(ge,Te,Fe){switch(ge){case"webglcontextlost":Z(Te);break;case"webglcontextrestored":le(Te);break;default:ee.apply(j,arguments)}}}function $(){for(var j=Object.keys(k),ee=0;ee<j.length;++ee)delete k[j]}function U(){++D,O||N==D&&v.loseContext()}function V(j,ee){var ge=j[ee];return function(){if(U(),!O)return ge.apply(j,arguments)}}function q(){for(var j=0;j<I.length;++j){var ee=I[j];ee instanceof WebGLBuffer?w.deleteBuffer(ee):ee instanceof WebGLFramebuffer?w.deleteFramebuffer(ee):ee instanceof WebGLProgram?w.deleteProgram(ee):ee instanceof WebGLRenderbuffer?w.deleteRenderbuffer(ee):ee instanceof WebGLShader?w.deleteShader(ee):ee instanceof WebGLTexture&&w.deleteTexture(ee)}}function W(j){return{statusMessage:j,preventDefault:function(){z=!0}}}return ne(v),v.loseContext=function(){if(!O){for(O=!0,N=0,++C;w.getError(););$(),k[w.CONTEXT_LOST_WEBGL]=!0;var j=W("context lost"),ee=S.slice();setTimeout(function(){for(var ge=0;ge<ee.length;++ge)ee[ge](j);B>=0&&setTimeout(function(){v.restoreContext()},B)},0)}},v.restoreContext=function(){O&&T.length&&setTimeout(function(){if(!z)throw"can not restore. webglcontestlost listener did not call event.preventDefault";q(),m(w),O=!1,D=0,z=!1;for(var j=T.slice(),ee=W("context restored"),ge=0;ge<j.length;++ge)j[ge](ee)},0)},v.loseContextInNCalls=function(j){if(O)throw"You can not ask a lost contet to be lost";N=D+j},v.getNumCalls=function(){return D},v.setRestoreTimeout=function(j){B=j},v;function K(j){for(var ee in j)typeof j[ee]=="function"?E[ee]=V(j,ee):p(E,j,ee);E.getError=function(){if(U(),!O)for(;Ce=w.getError();)k[Ce]=!0;for(var Ce in k)if(k[Ce])return delete k[Ce],Ce;return E.NO_ERROR};for(var ge=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Te=0;Te<ge.length;++Te){var Fe=ge[Te];E[Fe]=function(Ce){return function(){if(U(),O)return null;var Ne=Ce.apply(j,arguments);return Ne.__webglDebugContextLostId__=C,I.push(Ne),Ne}}(j[Fe])}var _e=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Te=0;Te<_e.length;++Te)Fe=_e[Te],E[Fe]=function(Ce){return function(){return U(),O?null:Ce.apply(j,arguments)}}(E[Fe]);var me=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Te=0;Te<me.length;++Te)Fe=me[Te],E[Fe]=function(Ce){return function(){return U(),!O&&Ce.apply(j,arguments)}}(E[Fe]);return E.checkFramebufferStatus=function(Ce){return function(){return U(),O?E.FRAMEBUFFER_UNSUPPORTED:Ce.apply(j,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Ce){return function(){return U(),O?-1:Ce.apply(j,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Ce){return function(){return U(),O?0:Ce.apply(j,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return O},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:y,resetToInitialState:m}},(yle=gle())!==void 0&&(mle.exports=yle);const Xgt=fe.getLogger("esri.views.WebGLDriverTest");function Ygt(e){const t=new wr(e,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1}),i=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,r=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=ii.createVertex(e,bi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Ns(e,new Map([["a_position",0]]),{geometry:[new to("a_position",2,ht.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(i,r,new Map([["a_pos",0]]));e.useProgram(a);const l=new st(e,{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:h,y:p,width:f,height:m}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays(Pt.TRIANGLE_STRIP,0,4),e.setViewport(h,p,f,m),t.readPixels(0,0,1,1,ze.RGBA,St.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const y=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return y&&Xgt.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),y}new to("a_pos",2,ht.BYTE,0,2);new to("a_pos",2,ht.BYTE,0,4),new to("a_tex",2,ht.BYTE,2,4);const Zgt={geometry:[new to("a_pos",2,ht.UNSIGNED_SHORT,0,4)]};async function Qgt(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new wr(e,{colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.NONE},{target:pt.TEXTURE_2D,wrapMode:bt.CLAMP_TO_EDGE,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,samplingMode:Je.NEAREST,width:1,height:1}),r=ii.createVertex(e,bi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Ns(e,new Map([["a_pos",0]]),Zgt,{geometry:r}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new st(e,{dataType:St.UNSIGNED_BYTE,pixelFormat:ze.RGBA,preMultiplyAlpha:!1,wrapMode:bt.CLAMP_TO_EDGE,samplingMode:Je.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(Zi.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(Pt.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return i.readPixels(0,0,1,1,ze.RGBA,St.UNSIGNED_BYTE,y),a.dispose(),s.dispose(!1),r.dispose(),i.dispose(),l.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c),t.src="",y[0]===255}class Jgt{constructor(t){this.context=t,this._floatBufferBlendWorking=Wgt(t),Qgt(t).then(i=>this._svgAlwaysPremultipliesAlpha=!i)}get floatBufferBlendWorking(){if(A(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(A(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(A(this._doublePrecisionRequiresObfuscation)){const t=fle(this.context,!1),i=fle(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(i===0||t/i>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return A(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=Ygt(this.context)),this._ignoresSamplerPrecision}}class vle{constructor(t,i,r,s,n,o,a,l){this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}function Kgt(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&An(e)?new vle(()=>e.createQuery(),r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>e.beginQuery(i.TIME_ELAPSED_EXT,r),()=>e.endQuery(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new vle(()=>i.createQueryEXT(),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function eyt(e,t){if(t.disjointTimerQuery)return null;if(An(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function tyt(e){if(An(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function iyt(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function ryt(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function syt(e,t){if(An(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function nyt(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function oyt(e,t){if(An(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function ayt(e,t){if(An(e)){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function NC(e,t,i,r,s){if(r&&An(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function lyt(e,t){if(!An(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function cyt(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function uyt(e,t){if(An(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class hyt{constructor(t,i){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=eyt(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=tyt(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=uyt(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=iyt(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=ryt(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=nyt(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=Kgt(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=oyt(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=ayt(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=syt(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=NC(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=NC(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=NC(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=NC(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=cyt(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=lyt(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=NC(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class dyt{constructor(t,i){this.gl=t,this.instanceCounter=new xgt,this.programCache=new qgt(this),this._state=new ile,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=An(t)?ui.WEBGL2:ui.WEBGL1,this._loadExtensions(),this.configure(i)}configure(t){this._capabilities=new hyt(this.gl,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new ile,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new W7e({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new Jgt(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),An(this.gl)&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,rh()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,i){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,i,r,s){t===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,i,r,s),this._state.blendColor.r=t,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,i){t===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,i,r,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,i,r,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,i){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(t,i),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(t,i,r,s){this._state.colorMask.r===t&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(t,i,r,s),this._state.colorMask.r=t,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,i,r,s){this._state.clearColor.r===t&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(t,i,r,s),this._state.clearColor.r=t,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,i){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=i,this.gl.polygonOffset(t,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,i,r,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(t,i,r,s),this._state.scissorRect.x=t,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,i){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===i||(this.gl.depthRange(t,i),this._state.depthRange.zNear=t,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,i,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,i,r),this._state.stencilFunction.face=Hd.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,i,r,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,i,r,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,i,r){this._state.stencilOperation.face===Hd.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,i,r),this._state.stencilOperation.face=Hd.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,i,r,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,i,r,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,i=!1){const r=this._state.activeTexture;return t>=0&&(i||t!==this._state.activeTexture)&&(this.gl.activeTexture(Y6+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,i=255){t&&(t&Zi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&Zi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&Zi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(t))}drawArrays(t,i,r){if(rh()&&(this._numOfDrawCalls++,this._numOfTriangles+=_le(t,r)),this.gl.drawArrays(t,i,r),rh()){const s=Lie(this);s&&console.error("drawArrays:",s)}}drawElements(t,i,r,s){var n;if(rh()&&(this._numOfDrawCalls++,this._numOfTriangles+=_le(t,i)),this.gl.drawElements(t,i,r,s),rh()){const o=Lie(this);if(o){const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c=a==null?void 0:a.vertexBuffers,h={indexBuffer:l,vertexBuffers:c},p={mode:t,count:i,type:r,offset:s},f=(n=qs(l,v=>v.size))!=null?n:0,m=s+i,y=f<m?`. Buffer is too small. Attempted to draw index ${m} of ${f}`:"";console.error(`drawElements: ${o}${y}`,{args:p,vao:h})}}}logInfo(){rh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){rh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===i&&n.width===r&&n.height===s||(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var i,r;this._state.program!==t&&((i=this._state.program)==null||i.stop(),this._state.program=t,this.gl.useProgram((r=t==null?void 0:t.glName)!=null?r:null))}bindTexture(t,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return A(t)||t.glName==null?(_(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==t?(this.setActiveTexture(i,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[i]=t,s):(t.isDirty&&(this.setActiveTexture(i,r),t.applyChanges()),s)}unbindTexture(t){if(!A(t))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===t&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(t,i=!1){if(i||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(A(t))return this.gl.bindFramebuffer(Sn.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(Sn.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,i,r=!1){const s=i===Sn.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==t)&&(A(t)?this.gl.bindFramebuffer(i,null):t.initializeAndBind(i),s?this._state.readFramebuffer=vt(t,null):this._state.drawFramebuffer=vt(t,null))}blitFramebuffer(t,i,r=0,s=0,n=t.width,o=t.height,a=0,l=0,c=i.width,h=i.height,p=Zi.COLOR_BUFFER_BIT,f=Je.NEAREST){this.bindFramebufferSeparate(t,Sn.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Sn.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,p,f)}bindBuffer(t,i){if(t)switch(i!=null||(i=t.bufferType),i){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Ml(this.gl,t,i,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ml(this.gl,t,i,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Ml(this.gl,t,i,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ml(this.gl,t,i,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ml(this.gl,t,i,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Ml(this.gl,t,i,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ml(this.gl,t,i,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const i=this.gl;t||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(i.bindRenderbuffer(i.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return A(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(t,i,r){const s=this._getBufferBinding(t,i);A(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(t,i,r,s,n){const o=this._getBufferBinding(t,i);if(!A(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(t,i,r,s){A(i)?this.bindBufferBase(wt.UNIFORM_BUFFER,t,null):(rh()&&(s!=null?s:i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(wt.UNIFORM_BUFFER,t,i.buffer,r,s):this.bindBufferBase(wt.UNIFORM_BUFFER,t,i.buffer))}unbindUBO(t){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];_(s)&&s.buffer===t.buffer&&this.bindBufferBase(wt.UNIFORM_BUFFER,i,null)}}unbindBuffer(t){switch(t){case wt.ARRAY_BUFFER:this._state.vertexBuffer=Ml(this.gl,null,t,this._state.vertexBuffer);break;case wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ml(this.gl,null,t,this._state.indexBuffer);break;case wt.UNIFORM_BUFFER:this._state.uniformBuffer=Ml(this.gl,null,t,this._state.uniformBuffer);break;case wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ml(this.gl,null,t,this._state.pixelPackBuffer);break;case wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ml(this.gl,null,t,this._state.pixelUnpackBuffer);break;case wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Ml(this.gl,null,t,this._state.copyReadBuffer);break;case wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ml(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){A(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const i=this.gl,r=i.fenceSync(ej.SYNC_GPU_COMMANDS_COMPLETE,0);let s;this.instanceCounter.increment(dn.Sync,r),i.flush();do await kS(t),s=i.clientWaitSync(r,0,0);while(s===tF.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(dn.Sync,r),i.deleteSync(r),s===tF.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=Sn.FRAMEBUFFER){return t===Sn.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(wt.ARRAY_BUFFER),this.unbindBuffer(wt.ELEMENT_ARRAY_BUFFER),An(this.gl)&&(this.unbindBuffer(wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(wt.PIXEL_PACK_BUFFER),this.unbindBuffer(wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(wt.COPY_READ_BUFFER),this.unbindBuffer(wt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Re.ONE,Re.ZERO),this.setBlendEquation(Ng.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Hd.BACK),this.setFrontFace(_2.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(hr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(hr.ALWAYS,0,0),this.setStencilOp(Jr.KEEP,Jr.KEEP,Jr.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n,o,a,l;const t=this.gl,i=this.capabilities.vao;i&&i.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)t.disableVertexAttribArray(c);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(wt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(wt.ELEMENT_ARRAY_BUFFER,null),An(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(wt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const h=this._state.uniformBufferBindingPoints[c];if(_(h)){const{buffer:p,offset:f,size:m}=h;p!==null?f===0&&m===0?t.bindBufferBase(wt.UNIFORM_BUFFER,c,p.glName):t.bindBufferRange(wt.UNIFORM_BUFFER,c,p.glName,f,m):t.bindBufferBase(wt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(wt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(wt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(wt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(wt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(Sn.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(Sn.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(Gc.COLOR_ATTACHMENT0)),t.bindFramebuffer(Sn.DRAW_FRAMEBUFFER,(s=(r=this._state.drawFramebuffer)==null?void 0:r.glName)!=null?s:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(Sn.FRAMEBUFFER,(o=(n=this._state.drawFramebuffer)==null?void 0:n.glName)!=null?o:null);if(i&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}t.useProgram((l=(a=this._state.program)==null?void 0:a.glName)!=null?l:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){t.activeTexture(Y6+c),t.bindTexture(pt.TEXTURE_2D,null),t.bindTexture(pt.TEXTURE_CUBE_MAP,null),An(t)&&(t.bindTexture(pt.TEXTURE_3D,null),t.bindTexture(pt.TEXTURE_2D_ARRAY,null));const h=this._state.textureUnitMap[c];_(h)&&t.bindTexture(h.descriptor.target,h.glName)}t.activeTexture(Y6+this._state.activeTexture),t.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===ui.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var a;const i=this.capabilities.textureFilterAnisotropic,r=(a=t.maxAnisotropy)!=null?a:1/0,s=An(this.gl),n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return st.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}}function Ml(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function _le(e,t){switch(e){case Pt.POINTS:return 2*t;case Pt.TRIANGLES:return t/3;case Pt.TRIANGLE_STRIP:case Pt.TRIANGLE_FAN:return t-2;default:return 0}}class pyt extends dyt{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,i,r,s){this.useProgram(t.program);const n=_(r)?r.slot:null;return t.bindPipelineState(this,n,s),_(i)&&_(r)&&t.bindPass(i,r),t.program}get test(){return this.programCache.test}}const PSe=fe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let OT=class extends Ee{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new Kr,this._frameTask=e.resourceController.scheduler.registerTask(yt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(cp.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return A(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(g3,new fZ)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),vt(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",Ms.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(A(t))return dt(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new fyt(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),_(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,jr(a)||PSe.error(a),null);return Eu(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",Ms.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],OT.prototype,"_loadingCount",void 0),u([d()],OT.prototype,"_frameTask",void 0),u([d()],OT.prototype,"updating",null),OT=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],OT);class fyt{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(PSe.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const myt=fe.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let tR=class extends Ee{constructor(){super(...arguments),this._data=new Array,this._state=Wl.NOT_LOADED}dispose(){this._state=Wl.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===Wl.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[Pi("esri/images/materials/water/normals.jpg"),Pi("esri/images/materials/water/perturbation.jpg")];this._state=Wl.LOADING,Promise.all(t.map(i=>ap(i))).then(i=>{i.forEach(r=>this._data.push(new st(e,{target:pt.TEXTURE_2D,pixelFormat:ze.RGBA,dataType:St.UNSIGNED_BYTE,wrapMode:bt.REPEAT,samplingMode:Je.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:r.width,height:r.height},r))),this._state=Wl.LOADED}).catch(i=>{myt.error("Failed to load textures for water material.",i),this._state=Wl.NOT_LOADED})}bind(e){this._state===Wl.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};u([d()],tR.prototype,"_state",void 0),u([d({type:Boolean,readOnly:!0})],tR.prototype,"updating",null),tR=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],tR);class gyt extends uU{constructor(t,i,r,s,n,o){super(),this._rctx=t,this._renderScene=i,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(Ms.BACKGROUND);const i=ip();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const r=ve(F({},i.settings),{pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio}),s=this._renderScreenshot(t,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){if(A(this._renderOverlay))return i;t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(t,i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=aB(r,s,a);this._rctx.gl.readPixels(0,0,r,s,ze.RGBA,ht.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,ve(F({},t),{region:null}));const c=aB(n.width,n.height,a);return vrt(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=aB(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,ze.RGBA,ht.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i){let r=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:o}=i;let a=!1;const l=i.disableDecorations&&t.frameHasDecorations,c=n!==s.fullWidth||o!==s.fullHeight,h=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,p=c||l||h;if(p){const y=s.clone();if(i.ignorePadding){const b=q4(y.padding);for(let S=0;S<4;S++)b[S]=Math.round(b[S]/y.pixelRatio*i.pixelRatio);y.padding=b}y.fullWidth=n,y.fullHeight=o,y.pixelRatio=i.pixelRatio;const v=s.fovX-y.fovX,w=s.fovY-y.fovY;v<0&&v<w?y.fovX=s.fovX:w<0&&w<v&&(y.fovY=s.fovY),this._forceCameraHook(y),a=!0,r=new wr(this._rctx,{width:y.fullWidth,height:y.fullHeight,colorTarget:Qr.TEXTURE,depthStencilTarget:Ei.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(r,y,i.disableDecorations?Jb.OFF:Jb.ON),this._disposeOffscreenBuffers()}const f=()=>{this._rctx.bindFramebuffer(null),Xe(r)},m=this._readbackScreenshot(i,f);if(f(),p&&!this._rctx.contextAttributes.alpha)for(let y=3;y<m.data.length;y+=4)m.data[y]=255;return a&&this._forceCameraHook(s),m}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const ble=fe.getLogger("esri.views.3d.webgl-engine.parts.View");let mo=class extends cU(Ee){constructor(e){super({}),this.events=new Kr,this.waterTextureRepository=new tR,this._magnifierHelper=new RT,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),ae(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),Ft),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new Nwe(this._rctx),this._shaderTechniqueRepository=new nwe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new OT(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new owe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new Oft(this._rctx,this._shaderTechniqueRepository),this._renderer=new Bm(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new gyt(this._rctx,(t,i,r)=>this._renderer.render(t,i,i,r),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Js(this._frameTask),this._shaderTechniqueRepository=Xe(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=Ms.UPDATE){e===Ms.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,i,r,s){this._renderer.readHUDVisibility(e,t,i,r,s)}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=Dft(4*c,a,r.nearFar);l>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(l=h)}if(_(e)){const c=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);_(c)&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(A(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){uTe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=Ms.BACKGROUND,n=!1;const o={preRender:a=>{r=this.updating,s=this._needsUpdate?Ms.UPDATE:Ms.BACKGROUND,e.processSyncLayers();const l=a.time-this._lastAnimationUpdate;(l>this.animationTimestep||_(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(Ms.BACKGROUND),this._lastAnimationUpdate=a.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,Jb.ON),n=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(Ms.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=Lb(o)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},r=X7e("3d",this._canvas,i);if(A(r)){const n=he("esri-force-webgl");ble.error(n)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&ble.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&he("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new pyt(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return A(this._componentObjectCollection)&&(this._componentObjectCollection=new Eft(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],mo.prototype,"updating",null),u([go()],mo.prototype,"_rctx",void 0),u([go()],mo.prototype,"_container",void 0),u([go()],mo.prototype,"_canvas",void 0),u([go()],mo.prototype,"_stippleTextureRepository",void 0),u([go(),d()],mo.prototype,"waterTextureRepository",void 0),u([go(),d()],mo.prototype,"_magnifierHelper",void 0),u([go(),d()],mo.prototype,"_textureRepository",void 0),u([go()],mo.prototype,"_compositingHelper",void 0),u([go()],mo.prototype,"_renderer",void 0),u([go()],mo.prototype,"_screenshotManager",void 0),u([go()],mo.prototype,"componentObjectCollection",null),u([go()],mo.prototype,"_componentObjectCollection",void 0),u([d()],mo.prototype,"_needsUpdate",void 0),u([d()],mo.prototype,"_needsWaterReflectionUpdate",void 0),mo=u([P("esri.views.3d.webgl-engine.parts.RenderView")],mo);var $L;let Qa=$L=class extends cU(Ee){constructor(e){super(e),this._handles=new Ht,this._model=new CL,this._layers=new Vt,this._changeSet=new _we,this._layerSyncSet=new Set}initialize(){this._set("renderView",new mo(this)),this._frameTask=this.resourceController.scheduler.registerTask(yt.STAGE,this),this._handles.add(this._frameTask)}destroy(){uw.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),MF(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){A(e)||(this.renderView.requestRender(),this._model.remove(e),MF(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){_(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){_(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){A(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>A(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;$L.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),$L.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===b2.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{Toe(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(Eu(r))return r.then(s);s()}removeRenderPlugin(e){Toe(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};Qa.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([d({constructOnly:!0})],Qa.prototype,"resourceController",void 0),u([d({constructOnly:!0})],Qa.prototype,"options",void 0),u([d({constructOnly:!0})],Qa.prototype,"state",void 0),u([d({constructOnly:!0})],Qa.prototype,"sceneIntersectionHelper",void 0),u([d({readOnly:!0})],Qa.prototype,"viewingMode",null),u([d({constructOnly:!0})],Qa.prototype,"container",void 0),u([d({constructOnly:!0})],Qa.prototype,"renderSR",void 0),u([d({constructOnly:!0})],Qa.prototype,"_handles",void 0),u([d({readOnly:!0})],Qa.prototype,"updating",null),u([d({constructOnly:!0})],Qa.prototype,"_model",void 0),u([go(),d()],Qa.prototype,"renderView",void 0),Qa=$L=u([P("esri.views.3d.webgl-engine.Stage")],Qa);function ISe(e){return Zf(e)&&e.intersector===Dr.PCL&&!!e.target}function sk(e){return Zf(e)&&e.intersector===Dr.I3S&&!!e.target}function yyt(e){return Zf(e)&&e.intersector===Dr.TERRAIN&&!!e.target}function $Se(e){return Zf(e)&&e.intersector===Dr.OVERLAY&&!!e.target}function nQ(e){return Zf(e)&&e.intersector===Dr.LOD&&!!e.target}function wle(e,t){var i;return z5(e)||B5(e)?xM(e.target.object.metadata,t):yyt(e)?(i=t.map)==null?void 0:i.ground:ISe(e)||sk(e)||$Se(e)?xM(e.target,t):null}function lxt(e,t){const i=gH(e,t);return _(i)&&i.type==="graphic"?i.graphic:null}function gH(e,t){if(A(e))return null;if(z5(e)||B5(e))return xle(e.target.object.metadata,t);if(ISe(e)){const i=e.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return $Se(e)||nQ(e)?xle(e.target,t):sk(e)?vyt(e.target,t):null}function xle(e,t){if(A(e)||A(e.graphicUid))return null;const i=xM(e,t);if(A(i))return null;if(i===t.graphics)return A(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||A(e.graphicUid)?null:"getHit"in r?r.getHit(e.graphicUid):null}function vyt(e,t){const i=xM(e,t);if(A(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?byt(r.getGraphicFromIntersectorTarget(e)):null}function _yt(e,t){const i=xM(e,t);if(A(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}function byt(e){return _(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function xM(e,t){return A(e.layerUid)?null:_(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function cxt(e,t){if(z5(e)||B5(e))return mg(e.target.object.boundingVolumeWorldSpace.bounds);if(nQ(e)){wpe(I$,e.transformation);const i=Math.max(I$[0],I$[1],I$[2]);return e.target.baseBoundingSphere.radius*i}return sk(e)?qs(_yt(e.target,t),i=>.5*vhe(i)):null}function uxt(e){return!z5(e)&&!B5(e)&&(nQ(e)?e.target.numLodLevels>1:!!sk(e))}const I$=M();async function wyt(e,t){if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t);if(i.results.length===0)return i;const r=i.results[0],s=_(r.distance)?r.distance*(1+xyt):r.distance,n=i.results.findIndex(o=>o.distance>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const xyt=.05;let c8,u8;function Tyt(e){const t=Gve(e);for(;t.length>1;){const i=Tle(t.shift());if(i.available)return i}return Tle(t.shift())}function Tle(e){switch(e){case ui.WEBGL1:return Syt();case ui.WEBGL2:return Eyt()}}function Syt(){return c8||(c8=Ryt()),c8}function Eyt(){return u8||(u8=Oyt()),u8}class DSe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class Cyt extends DSe{constructor(){super(...arguments),this.type=ui.WEBGL1}}class Ayt extends DSe{constructor(){super(...arguments),this.type=ui.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function LSe(e,t){var n;if(e===ui.WEBGL1&&typeof WebGLRenderingContext===void 0||e===ui.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const i=document.createElement("canvas");if(!i)return null;let r=iF(i,e,{failIfMajorPerformanceCaveat:!0});if(A(r)&&(r=iF(i,e),_(r)&&(t.majorPerformanceCaveat=!0)),A(r))return r;if(e===ui.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function Ryt(){const e=new Cyt,t=LSe(ui.WEBGL1,e);return A(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function Oyt(){const e=new Ayt,t=LSe(ui.WEBGL2,e);return A(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function Myt(e){const t=Tyt(e);if(!t.available)return new H("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new H("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new H("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new H("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===ui.WEBGL1){if(!t.supportsElementIndexUint)return new H("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new H("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new H("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Pyt(e){return e&&"nodeType"in e}function Iyt(e){return e&&typeof e.render=="function"}const Sle={component:"esri-component"};let L1=class extends Ee{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Sle.component),t&&t.classList.remove(Sle.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||Pyt(e)?(this._set("widget",null),k4(e)):(Iyt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],L1.prototype,"id",null),u([d()],L1.prototype,"node",null),u([jt("node")],L1.prototype,"castNode",null),u([d({readOnly:!0})],L1.prototype,"widget",void 0),L1=u([P("esri.views.ui.Component")],L1);const DL=L1,$yt={left:0,top:0,bottom:0,right:0},NSe={bottom:30,top:15,right:15,left:15},h8="manual",ja={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function Dyt(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function d8(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function p8(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let Vm=class extends Kr.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Ht,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&p8(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&p8(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([ae(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Ft),ae(()=>this.padding,this._applyUIPadding,Ft)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(ja.ui),YFe(e),this._attachContainers(e)),t&&(t.classList.remove(ja.ui),p8(t,{top:"",bottom:"",left:"",right:""}),ape(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:F(F({},NSe),e)}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=d8(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||h8)===h8?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(ja.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=d8(e)||d8(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof DL||(e=new DL({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof DL?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||$yt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(ja.innerContainer),e.classList.add(ja.cornerContainer);const t=document.createElement("div");t.classList.add(ja.innerContainer),t.classList.add(ja.manualContainer);const i=document.createElement("div");i.classList.add(ja.topLeft),i.classList.add(ja.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(ja.topRight),r.classList.add(ja.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(ja.bottomLeft),s.classList.add(ja.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(ja.bottomRight),n.classList.add(ja.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=ev();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup=F({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||h8,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(Dyt(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?FJ(t.node,s.firstChild):s.appendChild(t.node));r>=o.length?s.appendChild(t.node):FJ(t.node,o[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};u([d()],Vm.prototype,"container",null),u([d()],Vm.prototype,"height",null),u([d({value:NSe})],Vm.prototype,"padding",null),u([jt("padding")],Vm.prototype,"castPadding",null),u([d()],Vm.prototype,"view",void 0),u([d()],Vm.prototype,"width",null),Vm=u([P("esri.views.ui.UI")],Vm);const Lyt=Vm;function Ele(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function Nyt(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function $$(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function Fyt(e){return e.type==="bing-maps"}const ky=[];let MT=class extends t2{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ft,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>ae(()=>{var s;return[r.suspended,(s=r.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.handles.add([fn(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),_l(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");ky.length=0,e?(e.forEach(t=>{var s;if(t.suspended||!((s=t.layer)==null?void 0:s.attributionVisible))return;const i=t.layer;if(Ele(i,"user"))return void $$(ky,t,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(t)){const n=this._fetchedAttributionData.get(t);return void(n?$$(ky,t,this._getDynamicAttribution(n,this.view,i)):Ele(i)&&$$(ky,t,i.copyright))}return void this._fetchAttributionData(t)}const r=i.get("portalItem.accessInformation");$$(ky,t,r||i.copyright)}),Nyt(this.items,ky)&&(this.items.removeAll(),this.items.addMany(ky)),ky.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await xu(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,Fyt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:Ke.WGS84},f={extent:pg(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)r[m]=r[m]||[],r[m].push(f)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||n==null||n<=-1)return"";const o=e[n],a=ww(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const h=!l[c.id]&&a&&YH(c.extent,a);return h&&(l[c.id]=!0),h}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:ft})],MT.prototype,"items",void 0),u([d({readOnly:!0})],MT.prototype,"state",null),u([d()],MT.prototype,"view",void 0),MT=u([P("esri.widgets.Attribution.AttributionViewModel")],MT);const FSe=MT,zy={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Ja=class extends $a{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.iconClass=zy.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new FSe}initialize(){this.own(fn(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[zy.open]:this._isOpen};return ce("div",{bind:this,class:this.classes(zy.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return ce("div",{class:zy.poweredBy},"Powered by"," ",ce("a",{class:zy.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s={[zy.sourcesOpen]:e,[zy.interactive]:t};return ce("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(zy.sources,s),innerHTML:r,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],Ja.prototype,"_isOpen",void 0),u([d()],Ja.prototype,"_isInteractive",null),u([d()],Ja.prototype,"_attributionTextOverflowed",void 0),u([d()],Ja.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ja.prototype,"attributionText",null),u([d()],Ja.prototype,"iconClass",void 0),u([d()],Ja.prototype,"itemDelimiter",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ja.prototype,"label",void 0),u([d(),Ra("esri/widgets/Attribution/t9n/Attribution")],Ja.prototype,"messages",void 0),u([ut("viewModel.view")],Ja.prototype,"view",void 0),u([d({type:FSe})],Ja.prototype,"viewModel",void 0),u([Hc()],Ja.prototype,"_toggleState",null),Ja=u([P("esri.widgets.Attribution")],Ja);const Uyt=Ja,kyt="esri.widgets.CompassViewModel";let N1=class extends kX(Ee){constructor(e){super(e),this._handles=new Ht,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ae(()=>this.view,this._updateRotationWatcher,Ft))}destroy(){this._handles=Js(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ae(()=>e==null?void 0:e.rotation,this._updateForRotation,Ft):ae(()=>e==null?void 0:e.camera,this._updateForCamera,Ft))}};u([d({readOnly:!0})],N1.prototype,"canShowNorth",null),u([d()],N1.prototype,"orientation",void 0),u([d({readOnly:!0})],N1.prototype,"state",null),u([d()],N1.prototype,"view",void 0),N1=u([P(kyt)],N1);const USe=N1,By={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Jp=class extends $a{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=By.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new USe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[By.disabled]:i,[By.interactive]:!i},o={[By.northIcon]:r,[By.rotationIcon]:!r},{messages:a}=this;return ce("div",{bind:this,class:this.classes(By.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},ce("span",{"aria-hidden":"true",class:this.classes(By.icon,o),styles:this._toRotationTransform(e)}),ce("span",{class:By.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([ut("viewModel.goToOverride")],Jp.prototype,"goToOverride",void 0),u([d()],Jp.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Jp.prototype,"label",void 0),u([d(),Ra("esri/widgets/Compass/t9n/Compass")],Jp.prototype,"messages",void 0),u([ut("viewModel.view")],Jp.prototype,"view",void 0),u([d({type:USe})],Jp.prototype,"viewModel",void 0),u([Hc()],Jp.prototype,"_reset",null),Jp=u([P("esri.widgets.Compass")],Jp);const zyt=Jp;let PT=class extends Ee{constructor(e){super(e),this._handles=new Ht,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(_l(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],PT.prototype,"state",null),u([d()],PT.prototype,"navigationMode",void 0),u([d()],PT.prototype,"view",void 0),PT=u([P("esri.widgets.NavigationToggleViewModel")],PT);const kSe=PT,Vu={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let Kp=class extends $a{constructor(e,t){super(e,t),this.iconClass=Vu.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new kSe}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[Vu.disabled]:e,[Vu.isLayoutHorizontal]:this.layout==="horizontal"},r={[Vu.activeButton]:t},s={[Vu.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return ce("div",{bind:this,class:this.classes(Vu.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},ce("div",{class:this.classes(Vu.button,Vu.panButton,r)},ce("span",{class:Vu.panIcon})),ce("div",{class:this.classes(Vu.button,Vu.rotateButton,s)},ce("span",{class:Vu.rotationIcon})))}_toggle(){this.toggle()}};u([d()],Kp.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Kp.prototype,"label",void 0),u([d({value:"vertical"})],Kp.prototype,"layout",null),u([d(),Ra("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Kp.prototype,"messages",void 0),u([ut("viewModel.view")],Kp.prototype,"view",void 0),u([d({type:kSe})],Kp.prototype,"viewModel",void 0),u([Hc()],Kp.prototype,"_toggle",null),Kp=u([P("esri.widgets.NavigationToggle")],Kp);const Byt=Kp,FC={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let v0=class extends $a{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[FC.disabled]:!this.enabled,[FC.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return ce("div",{bind:this,class:this.classes(FC.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},ce("span",{"aria-hidden":"true",role:"presentation",class:this.classes(FC.icon,i)}),ce("span",{class:FC.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],v0.prototype,"action",void 0),u([d()],v0.prototype,"enabled",void 0),u([d()],v0.prototype,"iconClass",void 0),u([d()],v0.prototype,"title",void 0),u([Hc()],v0.prototype,"_triggerAction",null),v0=u([P("esri.widgets.IconButton")],v0);const Cle=v0;let IT=class extends Ee{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],IT.prototype,"canZoomIn",null),u([d({readOnly:!0})],IT.prototype,"canZoomOut",null),u([d()],IT.prototype,"view",void 0),IT=u([P("esri.widgets.Zoom.ZoomConditions2D")],IT);const Vyt=IT;let $T=class extends Ee{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};u([d({readOnly:!0})],$T.prototype,"canZoomIn",null),u([d({readOnly:!0})],$T.prototype,"canZoomOut",null),u([d()],$T.prototype,"view",void 0),$T=u([P("esri.widgets.Zoom.ZoomConditions3D")],$T);const Gyt=$T;let _0=class extends Ee{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Vyt({view:e}):e.type==="3d"&&(this._zoomConditions=new Gyt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():M8(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():M8(e.goTo({zoomFactor:.5}))}};u([d()],_0.prototype,"_zoomConditions",void 0),u([d({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],_0.prototype,"canZoomIn",void 0),u([d({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],_0.prototype,"canZoomOut",void 0),u([d({readOnly:!0})],_0.prototype,"state",null),u([d()],_0.prototype,"view",null),_0=u([P("esri.widgets.Zoom.ZoomViewModel")],_0);const zSe=_0,UC={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let Gm=class extends $a{constructor(e,t){super(e,t),this.iconClass=UC.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new zSe}initialize(){this._zoomInButton=new Cle({action:this.zoomIn.bind(this),iconClass:UC.zoomInIcon}),this._zoomOutButton=new Cle({action:this.zoomOut.bind(this),iconClass:UC.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[UC.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,ce("div",{class:this.classes(UC.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],Gm.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Gm.prototype,"label",void 0),u([d({value:"vertical"})],Gm.prototype,"layout",null),u([d(),Ra("esri/widgets/Zoom/t9n/Zoom")],Gm.prototype,"messages",void 0),u([ut("viewModel.view")],Gm.prototype,"view",void 0),u([d({type:zSe})],Gm.prototype,"viewModel",void 0),Gm=u([P("esri.widgets.Zoom")],Gm);const jyt=Gm,BSe="esri.views.ui.DefaultUI";function Hyt(e){return e&&e.view!==void 0}fe.getLogger(BSe);let LL=class extends Lyt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([ae(()=>this.components,this._componentsWatcher.bind(this),Ft),ae(()=>this.view,this._updateViewAwareWidgets.bind(this),Ft)])}_add(e,t,i,r){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;Hyt(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new DL({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new Uyt({view:this.view})}_createCompass(){return new zyt({view:this.view})}_createNavigationToggle(){return new Byt({view:this.view})}_createZoom(){return new jyt({view:this.view})}};u([d()],LL.prototype,"components",void 0),LL=u([P(BSe)],LL);const qyt=LL;let NL=class extends qyt{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],NL.prototype,"components",void 0),NL=u([P("esri.views.ui.3d.DefaultUI3D")],NL);const VSe=NL,Oc=fe.getLogger("esri.views.SceneView");let it=class extends TDe(v9e($9e(OGe))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new Lg({slicePlane:Cfe},this),this._resourceController=Hlt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Ej({view:this}),this.labeler=new A1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new l2,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new Y1,this.environmentManager=new yd,this.extent=null,this.floors=new ft,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new IGe({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Fat,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new VSe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new Vj,this.voxelWasm=null,this.voxelWasmPromise=null,lIe(),e&&e.environment||(this._defaults.environment=new bT,this.environment=this._defaults.environment);const t=(i=null)=>{_(i)&&i.type===qi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([fn(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),ae(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new BZe({view:this}),this.stateManager=new clt({view:this})}initialize(){this.groundView=new I9e({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(fn(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Ft),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Ft),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>pCe(t>0?1e3/Math.ceil(t):0),Ft),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,Ps),this.updatingHandles.add(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),Ps),this.handles.add(ae(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Vi))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=at(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=at(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=at(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||A(e)?(this._clippingArea=null,null):e instanceof ri?this.spatialReference&&(e=D$(e,this.spatialReference),A(e))?(Oc.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),A(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(Oc.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&_(e)?Oc.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ve.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return A(t)||A(e)||t.spatialReference.equals(e)?t:D$(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||Ke.WGS84,i=D$(this.clippingArea,t);_(i)&&(e=_(e)?e.intersection(i):i);const r=this._get("dataExtent");return _(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||Ke.WGS84;let t;const i=n=>{const o=D$(n,e);A(o)||(_(t)?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r==null?void 0:r.spatialReference){const n=r.groundExtent;i(new ri({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!_(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(A(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof bT?e:e instanceof Sve?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):bT.fromWebsceneEnvironment(e):Ds(bT,e):new bT}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||_(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(A(this.state)||this.state.stationary)}set qualityProfile(e){vL.isValidProfile(e)&&(vL.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||vL.getDefaultProfile()}set slicePlane(e){if(_(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),A(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");Iw(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Vfe(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?Mw.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var r,s,n;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(t=!0,o.suspended||fM(o))return;++i,e+=o.updatingProgress}}else++i});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])_(o)&&o.updating&&(i+=.1,e+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])_(o)&&o.updating&&(++i,e+=o.updatingProgress);if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((r=this.inputManager)==null?void 0:r.hasPendingInputs)||((n=(s=this.map)==null?void 0:s.allLayers)==null?void 0:n.some(o=>!o.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const o=performance.now();if(e<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?o:0}return t}get viewingMode(){var i;const e=this._predeterminedViewingMode;if(_(e))return G6(e);const t=this.spatialReference;return t?_((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?G6(this.defaultsFromMap.viewingMode):_F(t,Ve.Global)?"global":"local":"global"}set viewingMode(e){this.ready?Oc.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new fct(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return Oc.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=_(i.graphics)&&(_(i.graphics.include)||_(i.graphics.exclude)),s=pie(e)?die(this,e):e,n=tg(s);i.enableDraped=i.include&&!i.include.has(Nd)||i.exclude&&i.exclude.has(Nd);const o=this.sceneIntersectionHelper,a=Lh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?io.ALL:io.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=gH(l,this);if(A(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return Oc.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=vt(e.z==null&&yf(this.elevationProvider,e),0);return Pn(e,zx,this.renderSpatialReference,t),this.state.camera.projectToScreen(zx,f8),sp(f8[0],f8[1])}pixelSizeAt(e){return this.ready?e?(Pn(e,zx,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(zx)):0:(Oc.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return Oc.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=pie(e)?die(this,e):e,r=Vr(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=Lh(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=io.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=wle(a,this),c=_(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Zf(a)?a.distanceInRenderSpace:0,layer:c}};return Gi.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:i}=await wyt(this,e);let r=null;return!(t.length===0||Math.abs(vt(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(A(e.parent))throw new H("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="line-of-sight"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return prt(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return frt(i,this._pixelFormat())}_completeSettings(e){const t=drt(e,this);return t.pixelRatio/=this.state.pixelRatio,_rt(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return wie.importLayerView(e)}hasLayerViewModule(e){return wie.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=Myt(this.type);if(he("safari")&&he("safari")<9&&(e=new H("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:he("safari")})),_(e))throw Oc.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,i;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(i=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?i:null;return _(e)?vie(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(_(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,Ve.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Ve.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,Ve.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Ve.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!_F(e,i)&&(!!A(t)||!!fK(t)||(!_R(t)||!A(UU(t,e,i)))&&(!pK(t)||i!==Ve.Global))}_makeSpatialReferenceConstraints(e,t,i){if(A(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return fK(t)&&(r||s)?!s||i===Ve.Local||NZ(t.tileInfo,t.fullExtent,e,Ve.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:Ke.WebMercator,viewingMode:i}]:[{spatialReference:r?Ke.WGS84:Ke.WebMercator,viewingMode:i}]:_R(t)||pK(t)||!r&&!s?_R(t)&&r&&i!==Ve.Global?[{spatialReference:e,viewingMode:i},{spatialReference:Ke.WGS84,viewingMode:Ve.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?Ke.WGS84:Ke.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=_(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(_(i)?Oc.warnOnce(`Spatial reference defined on view not supported in ${G6(i)} viewing mode.`):e.isGeographic&&Oc.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||Ke.WGS84;return Ks(e,this.renderSpatialReference,e,i)||(i=Ke.WGS84,Ks(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new nt(e,i),t}trackGraphicState(e){if(!e.graphic)return Oc.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var o;!r&&_(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return _(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return NS(e.map(i=>this.highlight(i)));if(ft.isCollection(e))return NS(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):Rh()}maskOccludee(e){if(!e)return Oc.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&_(n)&&i9e(n)&&(i=n.maskOccludee(e))};return _(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){_(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await e2(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new H("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,QR.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,QR.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(zx)?(t=this.computeMapPointFromVec3d(zx,t),e.intersector===Dr.TERRAIN&&this.basemapTerrain&&(t.z=vt(yf(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=wle(n,this);if(_(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=gH(n,this);if(A(a))continue;if(a.type==="graphic"){if(A(r)&&s!==e.length-1&&(r=new Set),_(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push(ve(F({},a),{mapPoint:l,distance:c}))}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return A(e)||(A(e.include)||e.include.has(i))&&(A(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof Pa)Wyt(i,this._getGraphicFilterUid(e)),t===QR.INCLUDE&&(_(this.graphicsView)&&e.layer===this?kC(i,this.graphicsView.processor.layer.id):e.layer&&kC(i,e.layer.uid));else if(Bce(e))for(const r of e)r===this.graphics&&_(this.graphicsView)?kC(i,this.graphicsView.processor.layer.id):r===this.map.ground?kC(i,Nd):this._externalToInternalRenderItems(r,t,i);else"uid"in e&&kC(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new fdt({view:this})),this._set("elevationProvider",new XA({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new zo({view:this})),this._set("featureTiles",new jn({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var i;const t=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const r=_(this.basemapTerrain.extent)?kM(w4(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;_(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Gi.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger.912970e5.js")).then(({FeatureTileTree3DDebugger:i})=>{!this.featureTreeDebugger&&Gi.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new i({view:this}))}):t||!this.featureTreeDebugger||Gi.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},Ps),this.updatingHandles.add(()=>this.clippingArea,e,Ps),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Ps)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Mlt(this.map,e));const t=this.state.isGlobal,i=zfe(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",jF.create(this.state.viewingMode,i)),t||this.handles.add(ae(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&j4(r,this.basemapTerrain.spatialReference,Ale,s)&&(this.renderCoordsHelper.extent=Ale)},Vi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(P2/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){_(e)&&e.type===qi.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(ae(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),Vi),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new flt(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const i=k4(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new Qa({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=OM(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new H("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Ft),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),Ft),ae(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,Ps)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:Vj.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(P2/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new gct({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new vat})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await import("./GraphicsView3D.f718da42.js")).default;hi(e),await e2(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),_(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=vie(this.viewingMode);if(e===Ve.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(fn(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Nd);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Nd);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return A(this.voxelWasm)?(A(this.voxelWasmPromise)&&(this.voxelWasmPromise=import("./VoxelWasmPerSceneView.2e500ebd.js").then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){_(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function kC(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function Wyt(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function D$(e,t){return _(e)&&Df(e.spatialReference,t)?kM(e,t):null}var QR;it.type="3d",u([d()],it.prototype,"_userClippingArea",void 0),u([d()],it.prototype,"_resourceController",void 0),u([d()],it.prototype,"_stage",void 0),u([d({readOnly:!0})],it.prototype,"deconflictor",void 0),u([d({readOnly:!0})],it.prototype,"labeler",void 0),u([d(D9(l2,"analyses"))],it.prototype,"analyses",void 0),u([d({type:y2,readOnly:!0,aliasOf:"state.animation"})],it.prototype,"animation",void 0),u([d({readOnly:!0})],it.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],it.prototype,"elevationProvider",void 0),u([d({type:dc,aliasOf:"stateManager.camera"})],it.prototype,"camera",void 0),u([d({type:dc,aliasOf:"stateManager.contentCamera"})],it.prototype,"contentCamera",void 0),u([d({readOnly:!0})],it.prototype,"canvas",void 0),u([d({type:nt,aliasOf:"stateManager.center"})],it.prototype,"center",void 0),u([d({type:ri})],it.prototype,"clippingArea",null),u([d({type:Y1})],it.prototype,"constraints",void 0),u([d({type:ri,readOnly:!0})],it.prototype,"renderDataExtent",null),u([d({type:ri,readOnly:!0})],it.prototype,"dataExtent",null),u([d({type:ri,readOnly:!0})],it.prototype,"groundAndLayersExtent",null),u([d({value:null,type:bT})],it.prototype,"environment",null),u([jt("environment")],it.prototype,"castEnvironment",null),u([d({readOnly:!0})],it.prototype,"environmentManager",void 0),u([d({type:ri,aliasOf:"stateManager.extent"})],it.prototype,"extent",void 0),u([d()],it.prototype,"floors",void 0),u([d({readOnly:!0,aliasOf:"stateManager.screenCenter"})],it.prototype,"screenCenter",void 0),u([d({aliasOf:"stateManager.frustum"})],it.prototype,"frustum",void 0),u([d({type:Number,readOnly:!0})],it.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],it.prototype,"graphicsView",void 0),u([d({readOnly:!0})],it.prototype,"analysisViewManager",void 0),u([d()],it.prototype,"groundView",void 0),u([d({type:Boolean})],it.prototype,"initialExtentRequired",null),u([d()],it.prototype,"_defaultsFromMapSettings",null),u([d({type:Boolean,readOnly:!0})],it.prototype,"interacting",null),u([d()],it.prototype,"stationary",null),u([d({aliasOf:"state.navigating"})],it.prototype,"navigating",void 0),u([d()],it.prototype,"map",void 0),u([d({readOnly:!0})],it.prototype,"mapCoordsHelper",void 0),u([d({aliasOf:"stateManager.padding"})],it.prototype,"padding",void 0),u([d({type:zo,readOnly:!0})],it.prototype,"pointsOfInterest",void 0),u([d({type:jn,readOnly:!0})],it.prototype,"featureTiles",void 0),u([d()],it.prototype,"featureTreeDebugger",void 0),u([d({type:Boolean})],it.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],it.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],it.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],it.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],it.prototype,"state",void 0),u([d({readOnly:!0})],it.prototype,"inputManager",void 0),u([d({readOnly:!0})],it.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],it.prototype,"qualityProfile",null),u([d({type:Eoe,get(){let e=this._get("qualitySettings");return e||(e=new Eoe,vL.apply(this.qualityProfile,e)),e}})],it.prototype,"qualitySettings",void 0),u([d()],it.prototype,"slicePlane",null),u([d({readOnly:!0})],it.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],it.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],it.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],it.prototype,"resolution",null),u([d({type:Number,aliasOf:"stateManager.scale"})],it.prototype,"scale",void 0),u([d()],it.prototype,"heightModelInfo",null),u([d()],it.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],it.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],it.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],it.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],it.prototype,"type",void 0),u([d({type:VSe})],it.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],it.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],it.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],it.prototype,"viewingMode",null),u([d({type:Oh,aliasOf:"stateManager.viewpoint"})],it.prototype,"viewpoint",void 0),u([d({type:Number,aliasOf:"stateManager.zoom"})],it.prototype,"zoom",void 0),u([d({type:Vj})],it.prototype,"highlightOptions",void 0),it=u([P("esri.views.SceneView")],it),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(QR||(QR={}));const zx=M(),f8=Vr(),Ale=Dt(),hxt=it,ms={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let DT,GSe,nk,jSe=!1,i4=!1,oQ=!1,Zc=!1,Rle=null,yH=!1;const xE=typeof window!="undefined"?window:{};ms.cssVarShim&&xE.CSS;const ep=xE.document||{head:{}},aQ=xE.HTMLElement||class{},Tl={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},r4=ms.shadowDomShim&&ms.shadowDom?(()=>(ep.head.attachShadow+"").indexOf("[native")>-1)():!0,Xyt=(()=>{let e=!1;try{ep.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),Yyt=e=>Promise.resolve(e),Zyt=ms.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,HSe=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=Jyt(e,s),l=Qyt(t,o),c=Kyt(s);Tl.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>Tl.rel(a,n,l,c))})},Qyt=(e,t)=>i=>{try{ms.lazyLoad||e.$hostElement$[t](i)}catch(r){w3(r)}},Jyt=(e,t)=>t&4?ep:t&8?xE:t&16?ep.body:e,Kyt=e=>Xyt?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Ole="http://www.w3.org/1999/xlink",_w=(e,t="")=>()=>{},Mle=new WeakMap,e0t=(e,t,i)=>{let r=o4.get(e);Zyt&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,o4.set(e,r)},t0t=(e,t,i,r)=>{let s=qSe(t,i),n=o4.get(s);if(e=e.nodeType===11?e:ep,n)if(typeof n=="string"){e=e.head||e;let o=Mle.get(e),a;o||Mle.set(e,o=new Set),o.has(s)||(a=ep.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},i0t=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=_w("attachStyles",t.$tagName$),n=t0t(r4&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},qSe=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),r0t=e=>P0t.map(t=>t(e)).find(t=>!!t),Ple={},s0t="http://www.w3.org/2000/svg",n0t="http://www.w3.org/1999/xhtml",o0t=e=>e!=null,lQ=e=>(e=typeof e,e==="object"||e==="function"),As=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!lQ(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?s4(null,r):r),a=o)};if(c(i),t&&(ms.isDev&&e==="input"&&c0t(t),ms.vdomKey&&t.key&&(s=t.key),ms.slotRelocation&&t.name&&(n=t.name),ms.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(ms.isDev&&l.some(WSe)&&O0t(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),ms.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,a0t);const h=s4(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),ms.vdomKey&&(h.$key$=s),ms.slotRelocation&&(h.$name$=n),h},s4=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return ms.vdomAttribute&&(i.$attrs$=null),ms.vdomKey&&(i.$key$=null),ms.slotRelocation&&(i.$name$=null),i},cQ={},WSe=e=>e&&e.$tag$===cQ,a0t={forEach:(e,t)=>e.map(Ile).forEach(t),map:(e,t)=>e.map(Ile).map(t).map(l0t)},Ile=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),l0t=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),As(e.vtag,i,...e.vchildren||[])}const t=s4(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},c0t=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&M0t('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},$le=(e,t,i,r,s,n)=>{if(i!==r){let o=Fle(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Dle(i),h=Dle(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Fle(xE,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&Tl.rel(e,t,i,!1),r&&Tl.ael(e,t,r,!1);else{const l=lQ(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(Ole,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(Ole,t,r):e.setAttribute(t,r))}}},u0t=/\s/,Dle=e=>e?e.split(u0t):[],XSe=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||Ple,o=t.$attrs$||Ple;for(r in n)r in o||$le(s,r,n[r],void 0,i,t.$flags$);for(r in o)$le(s,r,n[r],o[r],i,t.$flags$)},n4=(e,t,i,r)=>{let s=t.$children$[i],n=0,o,a,l;if(jSe||(oQ=!0,s.$tag$==="slot"&&(DT&&r.classList.add(DT+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=ep.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=ep.createTextNode("");else{if(Zc||(Zc=s.$tag$==="svg"),o=s.$elm$=ep.createElementNS(Zc?s0t:n0t,s.$flags$&2?"slot-fb":s.$tag$),Zc&&s.$tag$==="foreignObject"&&(Zc=!1),XSe(null,s,Zc),o0t(DT)&&o["s-si"]!==DT&&o.classList.add(o["s-si"]=DT),s.$children$)for(n=0;n<s.$children$.length;++n)a=n4(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?Zc=!1:o.tagName==="foreignObject"&&(Zc=!0)}return o["s-hn"]=nk,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=GSe,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&TM(e.$elm$,!1)),o},TM=(e,t)=>{Tl.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==nk&&s["s-ol"]&&(QSe(s).insertBefore(s,uQ(s)),s["s-ol"].remove(),s["s-ol"]=void 0,oQ=!0),t&&TM(s,t)}Tl.$flags$&=-2},YSe=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===nk&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=n4(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,uQ(t))))},ZSe=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,e2e(r),i4=!0,s["s-ol"]?s["s-ol"].remove():TM(s,!0),s.remove())},h0t=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],y,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(L$(c,f))LT(c,f),c=t[++s],f=r[++n];else if(L$(h,m))LT(h,m),h=t[--l],m=r[--p];else if(L$(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&TM(c.$elm$.parentNode,!1),LT(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(L$(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&TM(h.$elm$.parentNode,!1),LT(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?y=n4(t&&t[n],i,o,e):(LT(v,f),t[o]=void 0,y=v.$elm$),f=r[++n]):(y=n4(t&&t[n],i,n,e),f=r[++n]),y&&QSe(c.$elm$).insertBefore(y,uQ(c.$elm$))}s>l?YSe(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&ZSe(t,s,l)},L$=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,uQ=e=>e&&e["s-ol"]||e,QSe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,LT=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(Zc=n==="svg"?!0:n==="foreignObject"?!1:Zc,n==="slot"||XSe(e,t,Zc),r!==null&&s!==null?h0t(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),YSe(i,null,t,s,0,s.length-1)):r!==null&&ZSe(r,0,r.length-1),Zc&&n==="svg"&&(Zc=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},JSe=e=>{let t=e.childNodes,i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}JSe(i)}},Dd=[],KSe=e=>{let t,i,r,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(Lle(i,s)?(n=Dd.find(h=>h.$nodeToRelocate$===i),i4=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:Dd.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&Dd.map(h=>{Lle(h.$nodeToRelocate$,i["s-sn"])&&(n=Dd.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Dd.some(h=>h.$nodeToRelocate$===i)||Dd.push({$nodeToRelocate$:i}));t.nodeType===1&&KSe(t)}},Lle=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",e2e=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(e2e)},d0t=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||s4(null,null),n=WSe(t)?t:As(null,null,t);nk=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,DT=i["s-sc"],GSe=i["s-cr"],jSe=r4&&(r.$flags$&1)!==0,i4=!1,LT(s,n);{if(Tl.$flags$|=1,oQ){KSe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Dd.length;f++)o=Dd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=ep.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Dd.length;f++)if(o=Dd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}i4&&JSe(n.$elm$),Tl.$flags$&=-2,Dd.length=0}},p0t=(e,t)=>{},t2e=(e,t)=>(e.$flags$|=16,p0t(e,e.$ancestorComponent$),D0t(()=>f0t(e,t))),f0t=(e,t)=>{const i=e.$hostElement$,r=_w("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=DS(s,"componentWillLoad"):n=DS(s,"componentWillUpdate"),n=Nle(n,()=>DS(s,"componentWillRender")),r(),Nle(n,()=>m0t(e,s,t))},m0t=async(e,t,i)=>{const r=e.$hostElement$,s=_w("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&i0t(e);const n=_w("render",e.$cmpMeta$.$tagName$);g0t(e,t,r),n(),s(),y0t(e)},g0t=(e,t,i)=>{try{Rle=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(ms.hasRenderFn||ms.reflect)&&(ms.vdomRender||ms.reflect)&&(ms.hydrateServerSide||d0t(e,t))}catch(a){w3(a,e.$hostElement$)}return Rle=null,null},y0t=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=_w("postUpdate",t),s=i;e.$ancestorComponent$,DS(s,"componentDidRender"),e.$flags$&64?(DS(s,"componentDidUpdate"),r()):(e.$flags$|=64,DS(s,"componentDidLoad"),r())},DS=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){w3(r)}},Nle=(e,t)=>e&&e.then?e.then(t):t(),v0t=(e,t)=>e!=null&&!lQ(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,_0t=(e,t)=>ok(e).$instanceValues$.get(t),b0t=(e,t,i,r)=>{const s=ok(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;if(i=v0t(i,r.$members$[t][0]),i!==o){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const c=r.$watchers$[t];c&&c.map(h=>{try{l[h](i,o,t)}catch(p){w3(p,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;t2e(s,!1)}}}},w0t=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return _0t(this,n)},set(a){b0t(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Tl.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},x0t=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=r0t(e)]);const a=qSe(i,t.$modeName$);if(!o4.has(a)){const l=_w("registerStyles",i.$tagName$);e0t(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>t2e(t,!0))()},T0t=e=>{},S0t=e=>{if((Tl.$flags$&1)===0){const t=ok(e),i=t.$cmpMeta$,r=_w("connectedCallback",i.$tagName$);t.$flags$&1?(HSe(e,t,i.$listeners$),T0t(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&E0t(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),x0t(e,t,i)),r()}},E0t=e=>{const t=e["s-cr"]=ep.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},C0t=e=>{if((Tl.$flags$&1)===0){const t=ok(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},hQ=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};i.$members$=t[2],i.$listeners$=t[3],i.$watchers$=e.$watchers$,i.$attrsToReflect$=[],!r4&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){R0t(this,i)},connectedCallback(){S0t(this),r&&r.call(this)},disconnectedCallback(){C0t(this),s&&s.call(this)},__attachShadow(){r4?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.shadowRoot=this}}),e.is=i.$tagName$,w0t(e,i)},A0t=e=>{const t=new URL(e,Tl.$resourcesUrl$);return t.origin!==xE.location.origin?t.href:t.pathname},i2e=new WeakMap,ok=e=>i2e.get(e),R0t=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return HSe(e,i,t.$listeners$),i2e.set(e,i)},Fle=(e,t)=>t in e,w3=(e,t)=>(0,console.error)(e,t),r2e=ms.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],O0t=(...e)=>console.error(...r2e,...e),M0t=(...e)=>console.warn(...r2e,...e),o4=new Map,P0t=[],Ule=[],s2e=[],I0t=(e,t)=>i=>{e.push(i),yH||(yH=!0,t&&Tl.$flags$&4?$0t(vH):Tl.raf(vH))},kle=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){w3(i)}e.length=0},vH=()=>{kle(Ule),kle(s2e),(yH=Ule.length>0)&&Tl.raf(vH)},$0t=e=>Yyt().then(e),D0t=I0t(s2e,!0),dQ={isDev:!!ms.isDev,isBrowser:!0,isServer:!1,isTesting:!!ms.isTesting};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */function L0t(e){return e.map(t=>{let i="";for(let r=0;r<t;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const N0t=()=>L0t([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */function F0t(e){const t="dir",i=`[${t}]`,r=pQ(e,i);return r?r.getAttribute(t):"ltr"}function n2e(e){return e.getRootNode()}function o2e(e){return e.host||null}function U0t(e,{selector:t,id:i}){function r(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=n2e(s),o=i?n.getElementById(i):t?n.querySelector(t):null,a=o2e(n);return o||(a?r(a):null)}return r(e)}function pQ(e,t){function i(r){return r?r.closest(t)||i(o2e(n2e(r))):null}return i(e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */const a2e="calciteInternalLabelClick",zle="calcite-label",a4=new WeakMap,k0t=e=>{const{id:t}=e,i=t&&U0t(e,{selector:`${zle}[for="${t}"]`});if(i)return i;const r=pQ(e,zle);return!r||z0t(r,e)?null:r};function z0t(e,t){let i;const r="custom-element-ancestor-check",s=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(t),a.indexOf(e))};return e.addEventListener(r,s,{once:!0}),t.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),e.removeEventListener(r,s),i.filter(o=>o!==t&&o!==e).filter(o=>{var a;return(a=o.tagName)===null||a===void 0?void 0:a.includes("-")}).length>0}function B0t(e){const t=k0t(e.el);if(!t||a4.has(t))return;e.labelEl=t;const i=j0t.bind(e);a4.set(e.labelEl,i),e.labelEl.addEventListener(a2e,i)}function V0t(e){if(!e.labelEl)return;const t=a4.get(e.labelEl);e.labelEl.removeEventListener(a2e,t),a4.delete(e.labelEl)}function G0t(e){var t,i;return e.label||((i=(t=e.labelEl)===null||t===void 0?void 0:t.textContent)===null||i===void 0?void 0:i.trim())||""}function j0t(e){this.disabled||this.el.contains(e.detail.sourceEvent.target)||this.onLabelClick(e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */function l2e(e,t,i){const r=H0t(e);return dQ.isBrowser?new r(t,i):void 0}function H0t(e){return e==="intersection"?window.IntersectionObserver:e==="mutation"?window.MutationObserver:window.ResizeObserver}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */const q0t={icon:"icon",flipRtl:"flip-rtl"},m8={},g8={},c2e={s:16,m:24,l:32};async function W0t({icon:e,scale:t}){const i=c2e[t],r=X0t(e),s=r.charAt(r.length-1)==="F",o=`${s?r.substring(0,r.length-1):r}${i}${s?"F":""}`;if(m8[o])return m8[o];g8[o]||(g8[o]=fetch(A0t(`./assets/icon/${o}.json`)).then(l=>l.json()).catch(()=>(console.error(`"${o}" is not a valid calcite-ui-icon name`),"")));const a=await g8[o];return m8[o]=a,a}function X0t(e){const t=!isNaN(Number(e.charAt(0))),i=e.split("-");return i.length===1?t?`i${e}`:e:i.map((r,s)=>s===0?t?`i${r.toUpperCase()}`:r:r.charAt(0).toUpperCase()+r.slice(1)).join("")}const Y0t="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:-ms-inline-flexbox;display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){height:1rem;width:1rem;min-width:1rem;min-height:1rem}:host([scale=m]){height:1.5rem;width:1.5rem;min-width:1.5rem;min-height:1.5rem}:host([scale=l]){height:2rem;width:2rem;min-width:2rem;min-height:2rem}.flip-rtl{-webkit-transform:scaleX(-1);transform:scaleX(-1)}.svg{display:block}";let _H=class extends aQ{constructor(){super();this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){var e;(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:e,flipRtl:t,pathData:i,scale:r,textLabel:s}=this,n=F0t(e),o=c2e[r],a=!!s,l=[].concat(i||"");return As(cQ,{"aria-hidden":(!a).toString(),"aria-label":a?s:null,role:a?"img":null},As("svg",{class:{[q0t.flipRtl]:n==="rtl"&&t,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${o} ${o}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},l.map(c=>typeof c=="string"?As("path",{d:c}):As("path",{d:c.d,opacity:"opacity"in c?c.opacity:1}))))}async loadIconPathData(){const{icon:e,scale:t,visible:i}=this;!dQ.isBrowser||!e||!i||(this.pathData=await W0t({icon:e,scale:t}))}waitUntilVisible(e){if(this.intersectionObserver=l2e("intersection",t=>{t.forEach(i=>{i.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,e())})},{rootMargin:"50px"}),!this.intersectionObserver){e();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return Y0t}};_H=hQ(_H,[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]}]);function u2e(){if(typeof customElements=="undefined")return;["calcite-icon"].forEach(t=>{switch(t){case"calcite-icon":customElements.get(t)||customElements.define(t,_H);break}})}u2e();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */const Z0t='@charset "UTF-8";@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{position:relative;margin-left:auto;margin-right:auto;display:none;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;padding-top:4rem;padding-bottom:4rem;opacity:1;min-height:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;-webkit-transform:scale(1, 1);transform:scale(1, 1);animation:loader-color-shift 6s alternate-reverse infinite linear}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-top:0px;padding-bottom:0px}:host{display:none}:host([active]){display:-ms-flexbox;display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-top:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);width:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;width:var(--calcite-loader-size);height:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svg{position:absolute;top:0px;left:0px;-webkit-transform-origin:center;transform-origin:center;overflow:visible;width:var(--calcite-loader-size);height:var(--calcite-loader-size);-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:loader-clockwise;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{-webkit-animation-name:loader-offset-1;animation-name:loader-offset-1}.loader__svg--2{-webkit-animation-name:loader-offset-2;animation-name:loader-offset-2}.loader__svg--3{-webkit-animation-name:loader-offset-3;animation-name:loader-offset-3}}:host([type=determinate]){-webkit-animation:none;animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{-webkit-animation:none;animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);-webkit-transition:all var(--calcite-internal-animation-timing-fast) linear;transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;-webkit-animation:none;animation:none;stroke:currentColor;stroke-width:2;padding-top:0px;padding-bottom:0px;height:var(--calcite-loader-size-inline);min-height:var(--calcite-loader-size-inline);width:var(--calcite-loader-size-inline);-webkit-margin-end:calc(var(--calcite-loader-size-inline) * 0.5);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([active][inline]){display:inline-block}:host([inline]) .loader__svgs{top:0px;left:0px;margin:0px;width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;-webkit-animation-duration:0.72s;animation-duration:0.72s}@-webkit-keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;-webkit-animation-duration:0.96s;animation-duration:0.96s}@-webkit-keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;-webkit-animation-duration:1.16s;animation-duration:1.16s}@-webkit-keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@-webkit-keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@-webkit-keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}';let bH=class extends aQ{constructor(){super();this.__registerHost(),this.__attachShadow(),this.active=!1,this.inline=!1,this.scale="m",this.value=0,this.text="",this.noPadding=!1}render(){const{el:e,inline:t,label:i,scale:r,text:s,type:n,value:o}=this,a=e.id||N0t(),l=.45,c=t?this.getInlineSize(r):this.getSize(r),h=c*l,p=`0 0 ${c} ${c}`,f=n==="determinate",m=2*h*Math.PI,y=o/100*m,v=m-y,w=Math.floor(o),b={"aria-valuenow":w,"aria-valuemin":0,"aria-valuemax":100,complete:w===100},S={r:h,cx:c/2,cy:c/2},T={"stroke-dasharray":`${y} ${v}`};return As(cQ,Object.assign({"aria-label":i,id:a,role:"progressbar"},f?b:{}),As("div",{class:"loader__svgs"},As("svg",{class:"loader__svg loader__svg--1",viewBox:p},As("circle",Object.assign({},S))),As("svg",{class:"loader__svg loader__svg--2",viewBox:p},As("circle",Object.assign({},S))),As("svg",Object.assign({class:"loader__svg loader__svg--3",viewBox:p},f?{style:T}:{}),As("circle",Object.assign({},S)))),s&&As("div",{class:"loader__text"},s),f&&As("div",{class:"loader__percentage"},o))}getSize(e){return{s:32,m:56,l:80}[e]}getInlineSize(e){return{s:12,m:16,l:20}[e]}get el(){return this}static get style(){return Z0t}};bH=hQ(bH,[1,"calcite-loader",{active:[516],inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1],noPadding:[4,"no-padding"]}]);function h2e(){if(typeof customElements=="undefined")return;["calcite-loader"].forEach(t=>{switch(t){case"calcite-loader":customElements.get(t)||customElements.define(t,bH);break}})}h2e();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 */(function(e){if(typeof e.requestSubmit=="function")return;e.requestSubmit=function(r){r?(t(r,this),r.click()):(r=document.createElement("input"),r.type="submit",r.hidden=!0,this.appendChild(r),r.click(),this.removeChild(r))};function t(r,s){r instanceof HTMLElement||i(TypeError,"parameter 1 is not of type 'HTMLElement'"),r.type=="submit"||i(TypeError,"The specified element is not a submit button"),r.form==s||i(DOMException,"The specified element is not owned by this form element","NotFoundError")}function i(r,s,n){throw new r("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+s+".",n)}})(HTMLFormElement.prototype);const ed={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty"},Q0t={loading:"Loading"},J0t="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:inline-block;width:auto;vertical-align:middle}:host([round]){border-radius:50px}:host([round]) a,:host([round]) button{border-radius:50px}:host button,:host a{outline-offset:0;outline-color:transparent;-webkit-transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out;transition:outline-offset 100ms ease-in-out, outline-color 100ms ease-in-out}:host button:focus,:host a:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px}:host button,:host a{--calcite-button-content-margin:0.5rem;--calcite-button-padding-x:7px;--calcite-button-padding-y:3px;padding:var(--calcite-button-padding-y) var(--calcite-button-padding-x) var(--calcite-button-padding-y) var(--calcite-button-padding-x);position:relative;-webkit-box-sizing:border-box;box-sizing:border-box;display:-ms-flexbox;display:flex;height:100%;width:100%;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;border-radius:0px;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);-webkit-text-decoration-line:none;text-decoration-line:none;-webkit-transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, outline-offset var(--calcite-internal-animation-timing-fast) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out, -webkit-box-shadow var(--calcite-animation-timing) ease-in-out;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, outline-offset var(--calcite-internal-animation-timing-fast) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out, -webkit-box-shadow var(--calcite-animation-timing) ease-in-out;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-offset var(--calcite-internal-animation-timing-fast) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-offset var(--calcite-internal-animation-timing-fast) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out, -webkit-box-shadow var(--calcite-animation-timing) ease-in-out}:host button:hover,:host a:hover{-webkit-text-decoration-line:none;text-decoration-line:none}.content{display:-ms-flexbox;display:flex;-ms-flex-preferred-size:auto;flex-basis:auto;-webkit-margin-start:var(--calcite-button-content-margin);margin-inline-start:var(--calcite-button-content-margin);-webkit-margin-end:var(--calcite-button-content-margin);margin-inline-end:var(--calcite-button-content-margin)}.icon-start-empty .content{-webkit-margin-start:unset;margin-inline-start:unset}.icon-end-empty .content{-webkit-margin-end:unset;margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-content-margin:0.75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-button-content-margin:1rem}:host([width=auto]){width:auto}:host([width=half]){width:50%}:host([width=full]){width:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{-ms-flex-pack:center;justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{-ms-flex-pack:start;justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{-ms-flex-pack:end;justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{-ms-flex-pack:justify;justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{-webkit-margin-end:auto;margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{-webkit-margin-start:auto;margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{-webkit-margin-start:var(--calcite-button-content-margin);margin-inline-start:var(--calcite-button-content-margin)}.icon{position:relative;margin:0px;display:-ms-inline-flexbox;display:inline-flex;font-weight:var(--calcite-font-weight-normal);line-height:inherit}:host([loading]),:host([disabled]){pointer-events:none}:host([loading]) button,:host([loading]) a,:host([disabled]) button,:host([disabled]) a{pointer-events:none;opacity:var(--calcite-ui-opacity-disabled)}@-webkit-keyframes loader-in{0%{width:0;opacity:0;-webkit-transform:scale(0.5);transform:scale(0.5)}100%{width:1em;opacity:1;-webkit-transform:scale(1);transform:scale(1)}}@keyframes loader-in{0%{width:0;opacity:0;-webkit-transform:scale(0.5);transform:scale(0.5)}100%{width:1em;opacity:1;-webkit-transform:scale(1);transform:scale(1)}}@-webkit-keyframes loader-out{0%{width:1em;opacity:1;-webkit-transform:scale(1);transform:scale(1)}100%{width:0;opacity:0;-webkit-transform:scale(0.5);transform:scale(0.5)}}@keyframes loader-out{0%{width:1em;opacity:1;-webkit-transform:scale(1);transform:scale(1)}100%{width:0;opacity:0;-webkit-transform:scale(0.5);transform:scale(0.5)}}.calcite-button--loader{display:-ms-flexbox;display:flex}.calcite-button--loader calcite-loader{margin:0px;-webkit-transition:width var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, -webkit-transform var(--calcite-internal-animation-timing-slow) ease-in-out;transition:width var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, -webkit-transform var(--calcite-internal-animation-timing-slow) ease-in-out;transition:width var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out;transition:width var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out, -webkit-transform var(--calcite-internal-animation-timing-slow) ease-in-out}.calcite-button--loader calcite-loader.loading-in{-webkit-animation-name:loader-in;animation-name:loader-in;-webkit-animation-duration:310ms;animation-duration:310ms}.calcite-button--loader calcite-loader.loading-out{-webkit-animation-name:loader-out;animation-name:loader-out;-webkit-animation-duration:310ms;animation-duration:310ms}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{-webkit-margin-end:var(--calcite-button-content-margin);margin-inline-end:var(--calcite-button-content-margin)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance=solid]) button,:host([appearance=solid]) a{border-width:1px;border-style:solid;border-color:transparent}:host([appearance=solid][color=blue]) button,:host([appearance=solid][color=blue]) a{background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}:host([appearance=solid][color=blue]) button:hover,:host([appearance=solid][color=blue]) button:focus,:host([appearance=solid][color=blue]) a:hover,:host([appearance=solid][color=blue]) a:focus{background-color:var(--calcite-ui-brand-hover)}:host([appearance=solid][color=blue]) button:active,:host([appearance=solid][color=blue]) a:active{background-color:var(--calcite-ui-brand-press)}:host([appearance=solid][color=blue]) button calcite-loader,:host([appearance=solid][color=blue]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=solid][color=red]) button,:host([appearance=solid][color=red]) a{background-color:var(--calcite-ui-danger);color:var(--calcite-ui-text-inverse)}:host([appearance=solid][color=red]) button:hover,:host([appearance=solid][color=red]) button:focus,:host([appearance=solid][color=red]) a:hover,:host([appearance=solid][color=red]) a:focus{background-color:var(--calcite-ui-danger-hover)}:host([appearance=solid][color=red]) button:active,:host([appearance=solid][color=red]) a:active{background-color:var(--calcite-ui-danger-press)}:host([appearance=solid][color=red]) button calcite-loader,:host([appearance=solid][color=red]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=solid][color=neutral]) button,:host([appearance=solid][color=neutral]) a{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}:host([appearance=solid][color=neutral]) button:hover,:host([appearance=solid][color=neutral]) button:focus,:host([appearance=solid][color=neutral]) a:hover,:host([appearance=solid][color=neutral]) a:focus{background-color:var(--calcite-ui-foreground-2)}:host([appearance=solid][color=neutral]) button:active,:host([appearance=solid][color=neutral]) a:active{background-color:var(--calcite-ui-foreground-1)}:host([appearance=solid][color=neutral]) button calcite-loader,:host([appearance=solid][color=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=solid][color=inverse]) button,:host([appearance=solid][color=inverse]) a{color:var(--calcite-ui-text-inverse);background-color:var(--calcite-ui-inverse)}:host([appearance=solid][color=inverse]) button:hover,:host([appearance=solid][color=inverse]) button:focus,:host([appearance=solid][color=inverse]) a:hover,:host([appearance=solid][color=inverse]) a:focus{background-color:var(--calcite-ui-inverse-hover)}:host([appearance=solid][color=inverse]) button:active,:host([appearance=solid][color=inverse]) a:active{background-color:var(--calcite-ui-inverse-press)}:host([appearance=solid][color=inverse]) button calcite-loader,:host([appearance=solid][color=inverse]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=outline]) button,:host([appearance=outline]) a{border-width:1px;border-style:solid;background-color:var(--calcite-ui-foreground-1);-webkit-box-shadow:inset 0 0 0 1px transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline][color=blue]) button,:host([appearance=outline][color=blue]) a{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand)}:host([appearance=outline][color=blue]) button:hover,:host([appearance=outline][color=blue]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline][color=blue]) button:focus,:host([appearance=outline][color=blue]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline][color=blue]) button:active,:host([appearance=outline][color=blue]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline][color=blue]) button calcite-loader,:host([appearance=outline][color=blue]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline][color=red]) button,:host([appearance=outline][color=red]) a{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger)}:host([appearance=outline][color=red]) button:hover,:host([appearance=outline][color=red]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline][color=red]) button:focus,:host([appearance=outline][color=red]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline][color=red]) button:active,:host([appearance=outline][color=red]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline][color=red]) button calcite-loader,:host([appearance=outline][color=red]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline][color=neutral]) button,:host([appearance=outline][color=neutral]) a{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-foreground-3)}:host([appearance=outline][color=neutral]) button:hover,:host([appearance=outline][color=neutral]) a:hover{-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline][color=neutral]) button:focus,:host([appearance=outline][color=neutral]) a:focus{-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][color=neutral]) button:active,:host([appearance=outline][color=neutral]) a:active{-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][color=neutral]) button calcite-loader,:host([appearance=outline][color=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][color=inverse]) button,:host([appearance=outline][color=inverse]) a{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline][color=inverse]) button:hover,:host([appearance=outline][color=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline][color=inverse]) button:focus,:host([appearance=outline][color=inverse]) a:focus{border-color:var(--calcite-ui-inverse);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline][color=inverse]) button:active,:host([appearance=outline][color=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline][color=inverse]) button calcite-loader,:host([appearance=outline][color=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=clear]) button,:host([appearance=clear]) a{border-width:1px;border-style:solid;background-color:transparent;-webkit-box-shadow:inset 0 0 0 1px transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=clear][color=blue]) button,:host([appearance=clear][color=blue]) a{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand)}:host([appearance=clear][color=blue]) button:hover,:host([appearance=clear][color=blue]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=clear][color=blue]) button:focus,:host([appearance=clear][color=blue]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=clear][color=blue]) button:active,:host([appearance=clear][color=blue]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=clear][color=blue]) button calcite-loader,:host([appearance=clear][color=blue]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=clear][color=red]) button,:host([appearance=clear][color=red]) a{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger)}:host([appearance=clear][color=red]) button:hover,:host([appearance=clear][color=red]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=clear][color=red]) button:focus,:host([appearance=clear][color=red]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=clear][color=red]) button:active,:host([appearance=clear][color=red]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=clear][color=red]) button calcite-loader,:host([appearance=clear][color=red]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=clear][color=neutral]) button,:host([appearance=clear][color=neutral]) a{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-foreground-3)}:host([appearance=clear][color=neutral]) button:hover,:host([appearance=clear][color=neutral]) a:hover{-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=clear][color=neutral]) button:focus,:host([appearance=clear][color=neutral]) a:focus{-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=clear][color=neutral]) button:active,:host([appearance=clear][color=neutral]) a:active{-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=clear][color=neutral]) button calcite-loader,:host([appearance=clear][color=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=clear][color=inverse]) button,:host([appearance=clear][color=inverse]) a{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=clear][color=inverse]) button:hover,:host([appearance=clear][color=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=clear][color=inverse]) button:focus,:host([appearance=clear][color=inverse]) a:focus{border-color:var(--calcite-ui-inverse);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=clear][color=inverse]) button:active,:host([appearance=clear][color=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=clear][color=inverse]) button calcite-loader,:host([appearance=clear][color=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][split-child=primary]) button,:host([appearance=clear][split-child=primary]) button{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline][split-child=secondary]) button,:host([appearance=clear][split-child=secondary]) button{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:transparent}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) button:focus,:host([appearance=transparent]:not(.enable-editing-button)) a:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:focus{background-color:var(--calcite-button-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-button-transparent-press)}:host([appearance=transparent][color=blue]) button,:host([appearance=transparent][color=blue]) a{color:var(--calcite-ui-brand)}:host([appearance=transparent][color=blue]) button:hover,:host([appearance=transparent][color=blue]) a:hover{color:var(--calcite-ui-brand-hover)}:host([appearance=transparent][color=blue]) button:focus,:host([appearance=transparent][color=blue]) a:focus{color:var(--calcite-ui-brand)}:host([appearance=transparent][color=blue]) button:active,:host([appearance=transparent][color=blue]) a:active{color:var(--calcite-ui-brand-press)}:host([appearance=transparent][color=blue]) button calcite-loader,:host([appearance=transparent][color=blue]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=transparent][color=red]) button,:host([appearance=transparent][color=red]) a{color:var(--calcite-ui-danger)}:host([appearance=transparent][color=red]) button:hover,:host([appearance=transparent][color=red]) a:hover{color:var(--calcite-ui-danger-hover)}:host([appearance=transparent][color=red]) button:focus,:host([appearance=transparent][color=red]) a:focus{color:var(--calcite-ui-danger)}:host([appearance=transparent][color=red]) button:active,:host([appearance=transparent][color=red]) a:active{color:var(--calcite-ui-danger-press)}:host([appearance=transparent][color=red]) button calcite-loader,:host([appearance=transparent][color=red]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=transparent][color=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][color=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][color=neutral]:not(.cancel-editing-button)) calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=transparent][color=neutral].cancel-editing-button) button{border-top-width:1px;border-bottom-width:1px;color:var(--calcite-ui-text-3);border-top-color:var(--calcite-ui-border-input);border-bottom-color:var(--calcite-ui-border-input);border-bottom-style:solid;border-top-style:solid}:host([appearance=transparent][color=neutral].cancel-editing-button) button:not(.content--slotted){--calcite-button-padding-y:0}:host([appearance=transparent][color=neutral].cancel-editing-button) button:hover{color:var(--calcite-ui-text-1)}:host([appearance=transparent][color=neutral].enable-editing-button) button{background-color:transparent}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][color=inverse]) button,:host([appearance=transparent][color=inverse]) a,:host([appearance=transparent][color=inverse]) calcite-loader{color:var(--calcite-ui-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-button-padding-x:0.5rem;--calcite-button-padding-y:0.25rem}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-button-padding-x:11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]:not([appearance=transparent])) button.content--slotted,:host([scale=m]:not([appearance=transparent])) a.content--slotted{--calcite-button-padding-y:7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-button-padding-x:0.75rem;--calcite-button-padding-y:0.5rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-button-padding-x:15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]:not([appearance=transparent])) button.content--slotted,:host([scale=l]:not([appearance=transparent])) a.content--slotted{--calcite-button-padding-y:11px}:host([scale=l][appearance=transparent]) button.content--slotted,:host([scale=l][appearance=transparent]) a.content--slotted{--calcite-button-padding-x:1rem;--calcite-button-padding-y:0.75rem}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-button-padding-x:0.125rem;--calcite-button-padding-y:3px;width:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-height:1.5rem}:host([scale=s][appearance=transparent]) button:not(.content--slotted),:host([scale=s][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y:0.25rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-button-padding-x:0.125rem;--calcite-button-padding-y:7px;width:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-height:2rem}:host([scale=m][appearance=transparent]) button:not(.content--slotted),:host([scale=m][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y:0.5rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-button-padding-x:0.125rem;--calcite-button-padding-y:9px;width:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-height:2.75rem}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y:0.625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x:23px;height:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x:1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x:2rem;height:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x:33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x:43px;height:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{-webkit-margin-start:1rem;margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x:2.75rem}";let wH=class extends aQ{constructor(){super();this.__registerHost(),this.__attachShadow(),this.alignment="center",this.appearance="solid",this.color="blue",this.disabled=!1,this.intlLoading=Q0t.loading,this.loading=!1,this.round=!1,this.scale="m",this.splitChild=!1,this.width="auto",this.mutationObserver=l2e("mutation",()=>this.updateHasContent()),this.hasContent=!1,this.hasLoader=!1,this.handleClick=()=>{const{formEl:e,type:t}=this;!this.href&&t!=="button"&&(t==="submit"?e==null||e.requestSubmit():t==="reset"&&(e==null||e.reset()))}}loadingChanged(e,t){!!e&&!t&&(this.hasLoader=!0),!e&&!!t&&window.setTimeout(()=>{this.hasLoader=!1},300)}connectedCallback(){this.hasLoader=this.loading,this.setupTextContentObserver(),B0t(this),this.formEl=pQ(this.el,this.form?`#${this.form}`:"form")}disconnectedCallback(){var e;(e=this.mutationObserver)===null||e===void 0||e.disconnect(),V0t(this),this.formEl=null}componentWillLoad(){dQ.isBrowser&&(this.updateHasContent(),!this.href&&!this.type&&(this.type="submit"))}render(){const e=this.href?"a":"button",t=e,i=this.hasLoader?As("div",{class:ed.buttonLoader},As("calcite-loader",{active:!0,class:this.loading?ed.loadingIn:ed.loadingOut,inline:!0,label:this.intlLoading,scale:"m"})):null,r=As("calcite-icon",{class:{[ed.icon]:!0,[ed.iconStart]:!0},flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,scale:"s"}),s=As("calcite-icon",{class:{[ed.icon]:!0,[ed.iconEnd]:!0},flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,scale:"s"}),n=As("span",{class:ed.content},As("slot",null));return As(t,{"aria-label":G0t(this),class:{[ed.contentSlotted]:this.hasContent,[ed.iconStartEmpty]:!this.iconStart,[ed.iconEndEmpty]:!this.iconEnd},disabled:this.disabled||this.loading,href:e==="a"&&this.href,name:e==="button"&&this.name,onClick:this.handleClick,ref:o=>this.childEl=o,rel:e==="a"&&this.rel,tabIndex:this.disabled||this.loading?-1:null,target:e==="a"&&this.target,type:e==="button"&&this.type},i,this.iconStart?r:null,this.hasContent?n:null,this.iconEnd?s:null)}async setFocus(){this.childEl.focus()}updateHasContent(){var e,t;const i=this.el.textContent.trim().length>0||this.el.childNodes.length>0;this.hasContent=this.el.childNodes.length===1&&((e=this.el.childNodes[0])===null||e===void 0?void 0:e.nodeName)==="#text"?((t=this.el.textContent)===null||t===void 0?void 0:t.trim().length)>0:i}setupTextContentObserver(){var e;(e=this.mutationObserver)===null||e===void 0||e.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}get el(){return this}static get watchers(){return{loading:["loadingChanged"]}}static get style(){return J0t}};wH=hQ(wH,[1,"calcite-button",{alignment:[513],appearance:[513],label:[1],color:[513],disabled:[516],href:[513],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],intlLoading:[1,"intl-loading"],loading:[516],name:[1],rel:[1],form:[1],round:[516],scale:[513],splitChild:[520,"split-child"],target:[1],type:[1025],width:[513],hasContent:[32],hasLoader:[32],setFocus:[64]}]);function K0t(){if(typeof customElements=="undefined")return;["calcite-button","calcite-icon","calcite-loader"].forEach(t=>{switch(t){case"calcite-button":customElements.get(t)||customElements.define(t,wH);break;case"calcite-icon":customElements.get(t)||u2e();break;case"calcite-loader":customElements.get(t)||h2e();break}})}K0t();function d2e(e){return e&&"getAtOrigin"in e&&"originOf"in e}function Ble(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:i,newOrigin:r})=>{d2e(t)&&r&&t.originOf(i)!==r&&t.updateOrigin(i,r)})}async function evt(e,t,i,r,s,n){let o=null;if(_(i)){const c=`${e}/nodepages/`,h=c+Math.floor(i.rootIndex/i.nodesPerPage);try{return{type:"page",rootPage:(await ai(h,{query:{f:"json",token:r},responseType:"json",signal:n})).data,rootIndex:i.rootIndex,pageSize:i.nodesPerPage,lodMetric:i.lodSelectionMetricType,urlPrefix:c}}catch(p){_(s)&&s.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,p),o=p}}if(!t)return null;const a=`${e}/nodes/`,l=a+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await ai(l,{query:{f:"json",token:r},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new H("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}async function tvt(e,t={},i){await e.load(i);const r=vl(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=t,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:e.apiKey},signal:Tr(i,"signal")},c=await e.portal._request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:e.resourceFromPath(f)}))}}async function ivt(e,t,i,r){if(!e.hasPath())throw new H(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(r);const n=vl(s.userItemUrl,t==="add"?"addResources":"updateResources"),[o,a]=p2e(e.path),l=await f2e(i),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),_(r)&&r.access&&c.append("access",r.access),await s.portal._request(n,{method:"post",body:c,signal:Tr(r,"signal")}),e}async function rvt(e,t,i){if(!t.hasPath())throw new H("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=vl(e.userItemUrl,"removeResources");await e.portal._request(r,{method:"post",query:{resource:t.path},signal:Tr(i,"signal")}),t.portalItem=null}async function svt(e,t){await e.load(t);const i=vl(e.userItemUrl,"removeResources");return e.portal._request(i,{method:"post",query:{deleteAll:!0},signal:Tr(t,"signal")})}function p2e(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function fQ(e){const[t,i]=nvt(e),[r,s]=p2e(t);return[r,s,i]}function nvt(e){const t=Mq(e);return A(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function f2e(e){return e instanceof Blob?e:(await ai(e.url,{responseType:"blob"})).data}function ovt(e,t){if(!e.hasPath())return null;const[i,,r]=fQ(e.path);return e.portalItem.resourceFromPath(vl(i,t+r))}function m2e(e,t){if(!e.hasPath())return null;const[i,,r]=fQ(e.path);return e.portalItem.resourceFromPath(vl(i,t+r))}var iR=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",addOrUpdateResource:ivt,contentToBlob:f2e,fetchResources:tvt,getSiblingOfSameType:ovt,getSiblingOfSameTypeI:m2e,removeAllResources:svt,removeResource:rvt,splitPrefixFileNameAndExtension:fQ});async function Vle(e,t,i){if(!t||!t.resources)return;const r=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{r.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(r.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,y=m2e(h,IW());e.paths.push(y.path),o.push(Gle({resource:y,content:p,finish:f,error:m},i))}else e.paths.push(c.resource.path),o.push(avt(c,i)),n.add(c.resource.path);for(const c of t.resources.toAdd)o.push(Gle(c,i)),e.paths.push(c.resource.path);if(r.forEach(c=>{const h=t.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}),o.length===0)return;const a=await Zo(o);hi(i);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new H("save:resources","Failed to save one or more resources",{errors:l})}async function Gle(e,t){const i=await xu(e.resource.portalItem.addResource(e.resource,e.content,t));if(i.ok!==!0)throw e.error&&e.error(i.error),i.error;e.finish&&e.finish(e.resource)}async function avt(e,t){const i=await xu(e.resource.update(e.content,t));if(i.ok!==!0)throw e.error(i.error),i.error;e.finish(e.resource)}const Bx=fe.getLogger("esri.layers.mixins.SceneService"),g2e=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=GH(async(i,r,s)=>{switch(i){case jv.SAVE:return this._save(r);case jv.SAVE_AS:return this._saveAs(s,r)}})}readSpatialReference(i,r){return this._readSpatialReference(r)}_readSpatialReference(i){if(i.spatialReference!=null)return Ke.fromJSON(i.spatialReference);{const r=i.store,s=r.indexCRS||r.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new Ke(n):null}}readFullExtent(i,r,s){if(i!=null&&typeof i=="object"){const a=i.spatialReference==null?ve(F({},i),{spatialReference:this._readSpatialReference(r)}):i;return ri.fromJSON(a,s)}const n=r.store,o=this._readSpatialReference(r);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<y8)?null:new ri({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(i){const r={major:Number.NaN,minor:Number.NaN,versionString:i},s=i.split(".");return s.length>=2&&(r.major=parseInt(s[0],10),r.minor=parseInt(s[1],10)),r}readVersion(i,r){const s=r.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(i){return this.sublayerTitleMode!=="item-title"?void 0:i}readTitleService(i,r){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return i0e(this.url,r.name);let n=r.name;if(!n&&this.url){const o=Zb(this.url);_(o)&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),T5(n)}set url(i){const r=s0e({layer:this,url:i,nonStandardUrlAllowed:!1,logger:Bx});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){n0e(this,i,"layers",r,n)}get parsedUrl(){const i=this._get("url");if(!i)return null;const r=Mn(i);return this.layerId!=null&&(r.path=`${r.path}/layers/${this.layerId}`),r}async _fetchIndexAndUpdateExtent(i,r){this.indexInfo=evt(this.parsedUrl.path,this.rootNode,i,this.apiKey,Bx,r),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(i){var r,s,n;if((i==null?void 0:i.type)==="page"){const o=i.rootIndex%i.pageSize,a=(s=(r=i.rootPage)==null?void 0:r.nodes)==null?void 0:s[o];if(a==null||a.obb==null||a.obb.center==null||a.obb.halfSize==null)throw new H("sceneservice:invalid-node-page","Invalid node page.");if(a.obb.center[0]<y8||this.fullExtent==null||this.fullExtent.hasZ)return;const l=a.obb.halfSize,c=a.obb.center[2],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-h,this.fullExtent.zmax=c+h}else if((i==null?void 0:i.type)==="node"){const o=(n=i.rootNode)==null?void 0:n.mbs;if(!Array.isArray(o)||o.length!==4||o[0]<y8)return;const a=o[2],l=o[3];this.fullExtent.zmin=a-l,this.fullExtent.zmax=a+l}}async _fetchService(i){if(this.url==null)throw new H("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(i);r!=null&&(this.layerId=r)}return this._fetchServiceLayer(i)}async _fetchFirstLayerId(i){const r=await ai(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:i});if(r.data&&Array.isArray(r.data.layers)&&r.data.layers.length>0)return r.data.layers[0].id}async _fetchServiceLayer(i){const r=await ai(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:i});r.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(r.data.layerType&&r.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=r.data;this.read(n,{origin:"service",url:this.parsedUrl}),this.validateLayer(n)}async _fetchVoxelServiceLayer(i){const r=(await ai(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:i})).data;this.read(r,{origin:"service",url:this.parsedUrl}),this.validateLayer(r)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(i){}_updateTypeKeywords(i,r,s){i.typeKeywords||(i.typeKeywords=[]);const n=r.getTypeKeywords();for(const o of n)i.typeKeywords.push(o);i.typeKeywords&&(i.typeKeywords=i.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===JR.newItem&&(i.typeKeywords=i.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(i,r){const s=F(F({},jle),r);let n=f2.from(i);n||(Bx.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new H("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||Ro.getDefault();await this._ensureLoadBeforeSave(),n.type=N$,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,JR.newItem),await o._signIn(),await o.user.addItem({item:n,folder:s&&s.folder,data:l}),await Vle(this.resourceReferences,a,null),this.portalItem=n,Ble(a),a.portalItem=n,n}async _save(i){const r=F(F({},jle),i);this.portalItem||(Bx.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new H("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),this.portalItem.type!==N$&&(Bx.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+N$),await Promise.reject(new H("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${N$}"`))),await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&Mn(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||Ro.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations),await this._validateAgainstJSONSchema(n,s,r),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,r,JR.existingItem),await this.portalItem.update({data:n}),await Vle(this.resourceReferences,s,null),Ble(s),this.portalItem}async _validateAgainstJSONSchema(i,r,s){let n=r.messages.filter(o=>o.type==="error").map(o=>new H(o.name,o.message,o.details));if(s&&s.validationOptions.ignoreUnsupported&&(n=n.filter(o=>o.name!=="layer:unsupported"&&o.name!=="symbol:unsupported"&&o.name!=="symbol-layer:unsupported"&&o.name!=="property:unsupported"&&o.name!=="url:unsupported"&&o.name!=="scenemodification:unsupported")),s.validationOptions.enabled||lvt){const o=(await import("./schemaValidator.8f08b0b0.js")).validate(i,s.portalItemLayerType);if(o.length>0){const a=`Layer item did not validate:
${o.join(`
`)}`;if(Bx.error(`_validateAgainstJSONSchema(): ${a}`),s.validationOptions.failPolicy==="throw"){const l=o.map(c=>new H("sceneservice:schema-validation",c)).concat(n);throw new H("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:l})}}}if(n.length>0)throw new H("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([d(c0e)],t.prototype,"id",void 0),u([d({type:Ke})],t.prototype,"spatialReference",void 0),u([Pe("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),u([d({type:ri})],t.prototype,"fullExtent",void 0),u([Pe("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),u([d({readOnly:!0,type:Mw})],t.prototype,"heightModelInfo",void 0),u([d({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),u([d({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"version",void 0),u([Pe("version",["store.version"])],t.prototype,"readVersion",null),u([d({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),u([d({type:String})],t.prototype,"title",void 0),u([Pe("portal-item","title")],t.prototype,"readTitlePortalItem",null),u([Pe("service","title",["name"])],t.prototype,"readTitleService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),u([d(a0e)],t.prototype,"url",null),u([He("url")],t.prototype,"writeUrl",null),u([d()],t.prototype,"parsedUrl",null),u([d({readOnly:!0})],t.prototype,"store",void 0),u([d({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=u([P("esri.layers.mixins.SceneService")],t),t},y8=-1e38,lvt=!1;var JR;(function(e){e[e.existingItem=0]="existingItem",e[e.newItem=1]="newItem"})(JR||(JR={}));const N$="Scene Service",jle={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var jv;(function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"})(jv||(jv={}));const cvt={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};class uvt{constructor(t,i,r,s){this.parsedUrl=t,this.portalItem=i,this.apiKey=r,this.signal=s,this.rootDocument=null;const n=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this.urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){var r;if(!this.urlParts)return null;const t=(r=this.portalItem)!=null?r:await this._portalItemFromServiceItemId();if(A(t))return this._loadFromUrl();const i=await this._findAndLoadRelatedPortalItem(t);return A(i)?null:this._loadFeatureLayerFromPortalItem(i)}async fetchPortalItem(){var i;if(!this.urlParts)return null;const t=(i=this.portalItem)!=null?i:await this._portalItemFromServiceItemId();return A(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(_(this.rootDocument))return this.rootDocument;if(A(this.urlParts))return this.rootDocument={},{};const t={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},i=`${this.urlParts.root}/SceneServer`;try{const r=await ai(i,t);this.rootDocument=r.data}catch{this.rootDocument={}}return this.rootDocument}async _fetchServiceOwningPortalUrl(){const t=Zr==null?void 0:Zr.findServerInfo(this.parsedUrl.path);if(t==null?void 0:t.owningSystemUrl)return t.owningSystemUrl;const i=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const r=(await ai(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(r)return r}catch(r){nc(r)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(i=>i.type==="Feature Service")||null}catch(i){return nc(i),null}}async _loadFeatureLayerFromPortalItem(t){await t.load({signal:this.signal});const i=await this._findMatchingAssociatedSublayerUrl(t.url);return new XN({url:i,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){const t=await this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return new XN({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){const i=t.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),r={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},s=this.urlParts.layerId,n=this._fetchRootDocument(),o=ai(i,r),[a,l]=await Promise.all([o,n]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let p=0;p<Math.min(c.length,h.length);p++)if(c[p].id===s)return`${i}/${h[p].id}`}else if(s<h.length)return`${i}/${h[s].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const i=new f2({id:t,apiKey:this.apiKey}),r=await this._fetchServiceOwningPortalUrl();_(r)&&(i.portal=new Ro({url:r}));try{return i.load({signal:this.signal})}catch(s){return nc(s),null}}}let V0=class extends ye{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([d({type:Number})],V0.prototype,"nodesPerPage",void 0),u([d({type:Number})],V0.prototype,"rootIndex",void 0),u([d({type:String})],V0.prototype,"lodSelectionMetricType",void 0),V0=u([P("esri.layer.support.I3SNodePageDefinition")],V0);let hg=class extends ye{constructor(){super(...arguments),this.factor=1}};u([d({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],hg.prototype,"id",void 0),u([d({type:Number})],hg.prototype,"factor",void 0),hg=u([P("esri.layer.support.I3SMaterialTexture")],hg);let b0=class extends ye{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([d({type:[Number]})],b0.prototype,"baseColorFactor",void 0),u([d({type:hg})],b0.prototype,"baseColorTexture",void 0),u([d({type:hg})],b0.prototype,"metallicRoughnessTexture",void 0),u([d({type:Number})],b0.prototype,"metallicFactor",void 0),u([d({type:Number})],b0.prototype,"roughnessFactor",void 0),b0=u([P("esri.layer.support.I3SMaterialPBRMetallicRoughness")],b0);let Bc=class extends ye{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([ot({opaque:"opaque",mask:"mask",blend:"blend"})],Bc.prototype,"alphaMode",void 0),u([d({type:Number})],Bc.prototype,"alphaCutoff",void 0),u([d({type:Boolean})],Bc.prototype,"doubleSided",void 0),u([ot({none:"none",back:"back",front:"front"})],Bc.prototype,"cullFace",void 0),u([d({type:hg})],Bc.prototype,"normalTexture",void 0),u([d({type:hg})],Bc.prototype,"occlusionTexture",void 0),u([d({type:hg})],Bc.prototype,"emissiveTexture",void 0),u([d({type:[Number]})],Bc.prototype,"emissiveFactor",void 0),u([d({type:b0})],Bc.prototype,"pbrMetallicRoughness",void 0),Bc=u([P("esri.layer.support.I3SMaterialDefinition")],Bc);let rR=class extends ye{};u([d({type:String,json:{read:{source:["name","index"],reader:(e,t)=>e!=null?e:`${t.index}`}}})],rR.prototype,"name",void 0),u([ot({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],rR.prototype,"format",void 0),rR=u([P("esri.layer.support.I3STextureFormat")],rR);let oS=class extends ye{constructor(){super(...arguments),this.atlas=!1}};u([d({type:[rR]})],oS.prototype,"formats",void 0),u([d({type:Boolean})],oS.prototype,"atlas",void 0),oS=u([P("esri.layer.support.I3STextureSetDefinition")],oS);let Od=class extends ye{};u([ot({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Od.prototype,"type",void 0),u([d({type:Number})],Od.prototype,"component",void 0),Od=u([P("esri.layer.support.I3SGeometryAttribute")],Od);let sR=class extends ye{};u([ot({draco:"draco"})],sR.prototype,"encoding",void 0),u([d({type:[String]})],sR.prototype,"attributes",void 0),sR=u([P("esri.layer.support.I3SGeometryCompressedAttributes")],sR);let td=class extends ye{constructor(){super(...arguments),this.offset=0}};u([d({type:Number})],td.prototype,"offset",void 0),u([d({type:Od})],td.prototype,"position",void 0),u([d({type:Od})],td.prototype,"normal",void 0),u([d({type:Od})],td.prototype,"uv0",void 0),u([d({type:Od})],td.prototype,"color",void 0),u([d({type:Od})],td.prototype,"uvRegion",void 0),u([d({type:Od})],td.prototype,"featureId",void 0),u([d({type:Od})],td.prototype,"faceRange",void 0),u([d({type:sR})],td.prototype,"compressedAttributes",void 0),td=u([P("esri.layer.support.I3SGeometryBuffer")],td);let aS=class extends ye{};u([ot({triangle:"triangle"})],aS.prototype,"topology",void 0),u([d()],aS.prototype,"geometryBuffers",void 0),aS=u([P("esri.layer.support.I3SGeometryDefinition")],aS);let w0=class extends ye{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([d({type:String,json:{read:!0,write:!0}})],w0.prototype,"name",void 0),u([d({type:String,json:{read:!0,write:!0}})],w0.prototype,"field",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],w0.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],w0.prototype,"fullRangeExtent",void 0),u([d({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],w0.prototype,"type",void 0),w0=u([P("esri.layers.support.RangeInfo")],w0);function xH(e){return mQ[hvt(e)]||pvt}function hvt(e){return e instanceof Blob?e.type:dvt(e.url)}function dvt(e){const t=Mq(e);return TH[t]||y2e}const mQ={},y2e="text/plain",pvt=mQ[y2e],TH={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const e in TH)mQ[TH[e]]=e;function l4(e){const t=_(e)&&e.origins?e.origins:[void 0];return(i,r)=>{const s=fvt(e,i,r);for(const n of t){const o=UH(i,n,r);for(const a in s)o[a]=s[a]}}}function fvt(e,t,i){if(_(e)&&e.type==="resource")return mvt(e,t,i);switch(_(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:r,write:s}=iMe;return{read:r,write:s}}}}function mvt(e,t,i){const r=AM(t,i);return{type:String,read:(s,n,o)=>{const a=R4(s,n,o);return r.type===String?a:typeof r.type=="function"?new r.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=Pg(s,a)):void(n[o]=s.write({},a));const l=_vt(s),c=l?Pg(l,ve(F({},a),{verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),XS.NO):null,h=r.type!==String&&(!d2e(this)||a&&a.origin&&this.originIdOf(i)>ng(a.origin));a&&a.portalItem&&_(c)&&!oc(c)?h?gvt(this,i,s,c,n,o,a,e):yvt(c,n,o,a):a&&a.portalItem&&(A(c)||_(Uhe(c))||Tv(c)||h)?v2e(this,i,s,c,n,o,a,e):n[o]=c}}}}function v2e(e,t,i,r,s,n,o,a){const l=IW(),c=b2e(i,r,o),h=vl(Tr(a,"prefix"),l),p=`${h}.${xH(c)}`,f=o.portalItem.resourceFromPath(p);Tv(r)&&o.resources.pendingOperations.push(vvt(r).then(m=>{f.path=`${h}.${xH(m)}`,s[n]=f.itemRelativeUrl}).catch(()=>{})),_2e(e,t,f,c,o.resources.toAdd),s[n]=f.itemRelativeUrl}function gvt(e,t,i,r,s,n,o,a){const l=o.portalItem.resourceFromPath(r),c=b2e(i,r,o);xH(c)===Mq(l.path)?(_2e(e,t,l,c,o.resources.toUpdate),s[n]=r):v2e(e,t,i,r,s,n,o,a)}function yvt(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}function _2e(e,t,i,r,s){s.push({resource:i,content:r,finish:n=>{bvt(e,t,n)}})}function b2e(e,t,i){return typeof e=="string"?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}async function vvt(e){const t=(await Promise.resolve().then(function(){return Zhe})).default,{data:i}=await t(e,{responseType:"blob"});return i}function _vt(e){return A(e)?null:typeof e=="string"?e:e.url}function bvt(e,t,i){typeof e[t]=="string"?e[t]=i.url:e[t].url=i.url}var FL;let SH=FL=class extends bw(ft.ofType(Ao)){constructor(e){super(e)}clone(){return new FL(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){var i;const t=(i=e==null?void 0:e.layer)==null?void 0:i.spatialReference;return t?this.toArray().map(r=>{if(!t.equals(r.spatialReference)){if(!Df(r.spatialReference,t))return e&&e.messages&&e.messages.push(new Ma("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const n=new Ao;Dpe(r,n,t),r=n}const s=r.toJSON(e);return delete s.spatialReference,s}).filter(r=>r!=null):((e==null?void 0:e.messages)&&e.messages.push(new Ma("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(r=>r.toJSON(e)))}static fromJSON(e,t){const i=new FL;return e.forEach(r=>i.add(Ao.fromJSON(r,t))),i}};SH=FL=u([P("esri.layers.support.PolygonCollection")],SH);const EH=SH;var CH;let NT=CH=class extends ye{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new EH,this._geometriesSource=null,this._handles=new Ht}initialize(){this._handles.add(fn(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,Vi))}destroy(){this._handles.destroy()}readGeometries(e,t,i){this._geometriesSource={url:qv(e,i),context:i}}async loadGeometries(e,t){if(A(this._geometriesSource))return;const{url:i,context:r}=this._geometriesSource,s=await ai(i,{responseType:"json",signal:Tr(t,"signal")}),n=e.toJSON(),o=s.data.map(a=>ve(F({},a),{spatialReference:n}));this.geometries=EH.fromJSON(o,r),this._geometriesSource=null}clone(){return new CH({geometries:ie(this.geometries),spatialRelationship:this.spatialRelationship})}};u([d({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],NT.prototype,"spatialRelationship",void 0),u([d({type:EH,nonNullable:!0,json:{write:!0}}),l4({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],NT.prototype,"geometries",void 0),u([Pe(["web-scene","portal-item"],"geometries")],NT.prototype,"readGeometries",null),NT=CH=u([P("esri.layers.support.SceneFilter")],NT);const wvt=NT,xvt=["3DObject","Point"],Vx=fe.getLogger("esri.layers.SceneLayer"),Hle=S0e();let Mt=class extends g2e(TX(EX(CX(AX(x5(xX(p2))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new ft,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var r,s,n,o;const i=(s=(r=this.getFeatureType(t==null?void 0:t.feature))==null?void 0:r.domains)==null?void 0:s[e];return i&&i.type!=="inherited"?i:(o=(n=this.getField(e))==null?void 0:n.domain)!=null?o:null}getFeatureType(e){return e&&_(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){return _(this.associatedLayer)?this.associatedLayer.types:[]}get typeIdField(){return _(this.associatedLayer)?this.associatedLayer.typeIdField:null}get formTemplate(){return _(this.associatedLayer)?this.associatedLayer.formTemplate:null}get fieldsIndex(){return new T0e(this.fields)}readNodePages(e,t,i){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:V0.fromJSON(e,i)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return Tvt[this.profile]||"mesh"}set renderer(e){rN(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){const e=_(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:cvt,{query:t,editing:{supportsGlobalId:i,supportsRollbackOnFailure:r,supportsUploadWithItemId:s,supportsReturnServiceEditsInSourceSpatialReference:n},data:{supportsZ:o,supportsM:a,isVersioned:l,supportsAttachment:c},operations:{supportsEditing:h,supportsUpdate:p,supportsQuery:f,supportsQueryAttachments:m}}=e,y=e.operations.supportsChangeTracking;return{query:t,editing:{supportsGlobalId:i,supportsReturnServiceEditsInSourceSpatialReference:n,supportsRollbackOnFailure:r,supportsGeometryUpdate:!1,supportsUploadWithItemId:s},data:{supportsAttachment:c,supportsZ:o,supportsM:a,isVersioned:l},operations:{supportsQuery:f,supportsQueryAttachments:m,supportsEditing:h&&y,supportsAdd:!1,supportsDelete:!1,supportsUpdate:p&&y}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}get defaultPopupTemplate(){return _(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(i=>(i.type==="esriFieldTypeOID"&&(e=i.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(i=>(i.type==="esriFieldTypeGlobalID"&&(e=i.name),!!e)),e||void 0}get displayField(){return _(this.associatedLayer)?this.associatedLayer.displayField:null}readProfile(e,t){const i=t.store.profile;return i!=null&&qle[i]?qle[i]:(Vx.error("Unknown or missing profile",{profile:i,layer:this}),"mesh-pyramids")}load(e){const t=_(e)?e.signal:null,i=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(nc).then(()=>this._fetchService(t)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),_(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>C0e(this,{origin:"service"},t)).then(()=>rN(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}async beforeSave(){_(this.filter)&&await this.load()}createQuery(){const e=new _h;return this.geometryType!=="mesh"&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatures(e||this.createQuery(),t)).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=this,r.sourceLayer=this;return i})}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryAttachments(e,t))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(Vx.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return A0e(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return _(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),A(this.associatedLayer))throw new H("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new H("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){if(await this.load(t),!this.statisticsInfo)throw new H("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const i=this.fieldsIndex.get(e);if(!i)throw new H("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const r of this.statisticsInfo)if(r.name===i.name){const s=vl(this.parsedUrl.path,r.href);return ai(s,{query:{f:"json",token:this.apiKey},responseType:"json",signal:t?t.signal:null}).then(n=>n.data)}throw new H("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,t){return this._debouncedSaveOperations(jv.SAVE_AS,ve(F({},t),{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"}),e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(jv.SAVE,e)}async applyEdits(e,t){const i=await import("./editingSupport.7f8682fa.js");if(await this.load(),A(this.associatedLayer))throw new H(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),i.applyEdits(this,this.associatedLayer.source,e,t)}on(e,t){return super.on(e,t)}validateLayer(e){if(e.layerType&&!xvt.includes(e.layerType))throw new H("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new H("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new H("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(i,r){let s=!1,n=!1;if(i==null)s=!0,n=!0;else{const o=r&&r.isGeographic;switch(i){case"east-north-up":case"earth-centered":s=!0,n=o;break;case"vertex-reference-frame":s=!0,n=!o;break;default:s=!1}}if(!s)throw new H("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new H("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new H("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(s=>s.name===e.name)),i=!!(_(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(s=>s&&e.name===s.name)),r={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||i,supportsLayerQuery:i};this._fieldUsageInfo[e.name]=r}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides()}_applyAssociatedLayerFieldsOverrides(){if(A(this.associatedLayer)||!this.associatedLayer.fields)return;let e=null;for(const t of this.associatedLayer.fields){const i=this.getField(t.name);i?(!i.domain&&t.domain&&(i.domain=t.domain.clone()),i.editable=t.editable,i.nullable=t.nullable,i.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(A(this.associatedLayer))return;const e=["popupTemplate","popupEnabled"],t=Xo(this);for(let i=0;i<e.length;i++){const r=e[i],s=this.originIdOf(r),n=this.associatedLayer.originIdOf(r);s<n&&(n===yi.SERVICE||n===yi.PORTAL_ITEM)&&t.setAtOrigin(r,this.associatedLayer[r],n)}}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const t=new uvt(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await t.fetch()}catch(i){jr(i)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await e2(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?Vx.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):Vx.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&(this.profile==="mesh-pyramids"&&e.mode==="relative-to-scene"&&Vx.warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&e.featureExpressionInfo.expression!=="0"&&Vx.warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([d({types:{key:"type",base:gg,typeMap:{selection:M7}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],Mt.prototype,"featureReduction",void 0),u([d({type:[w0],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],Mt.prototype,"rangeInfos",void 0),u([d({json:{read:!1}})],Mt.prototype,"associatedLayer",void 0),u([d({type:["show","hide"]})],Mt.prototype,"listMode",void 0),u([d({type:["ArcGISSceneServiceLayer"]})],Mt.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],Mt.prototype,"type",void 0),u([d(ve(F({},Hle.fields),{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],Mt.prototype,"fields",void 0),u([d()],Mt.prototype,"types",null),u([d()],Mt.prototype,"typeIdField",null),u([d()],Mt.prototype,"formTemplate",null),u([d({readOnly:!0})],Mt.prototype,"fieldsIndex",null),u([d({type:E0e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Mt.prototype,"floorInfo",void 0),u([d(Hle.outFields)],Mt.prototype,"outFields",void 0),u([d({type:V0,readOnly:!0,json:{read:!1}})],Mt.prototype,"nodePages",void 0),u([Pe("service","nodePages",["nodePages","pointNodePages"])],Mt.prototype,"readNodePages",null),u([d({type:[Bc],readOnly:!0})],Mt.prototype,"materialDefinitions",void 0),u([d({type:[oS],readOnly:!0})],Mt.prototype,"textureSetDefinitions",void 0),u([d({type:[aS],readOnly:!0})],Mt.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],Mt.prototype,"serviceUpdateTimeStamp",void 0),u([d({readOnly:!0})],Mt.prototype,"attributeStorageInfo",void 0),u([d({readOnly:!0})],Mt.prototype,"statisticsInfo",void 0),u([d({type:ft.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],Mt.prototype,"excludeObjectIds",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Mt.prototype,"definitionExpression",void 0),u([d({type:wvt,json:{name:"layerDefinition.polygonFilter",write:!0}})],Mt.prototype,"filter",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Mt.prototype,"path",void 0),u([d(SX)],Mt.prototype,"elevationInfo",null),u([d({type:String})],Mt.prototype,"geometryType",null),u([d(E5)],Mt.prototype,"labelsVisible",void 0),u([d({type:[ZM],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:WN},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:WN},write:!0}})],Mt.prototype,"labelingInfo",void 0),u([d(l0e)],Mt.prototype,"legendEnabled",void 0),u([d({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){var r,s;if(typeof e=="number"&&e>=0&&e<=1)return e;const i=(s=(r=t.layerDefinition)==null?void 0:r.drawingInfo)==null?void 0:s.transparency;return i!==void 0?qS(i):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],Mt.prototype,"opacity",void 0),u([d({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Mt.prototype,"priority",void 0),u([d({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Mt.prototype,"semantic",void 0),u([d({types:Wye,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],Mt.prototype,"renderer",null),u([d({json:{read:!1}})],Mt.prototype,"cachedDrawingInfo",void 0),u([Pe("service","cachedDrawingInfo")],Mt.prototype,"readCachedDrawingInfo",null),u([d({readOnly:!0,json:{read:!1}})],Mt.prototype,"capabilities",null),u([d({type:Boolean,json:{read:!1}})],Mt.prototype,"editingEnabled",null),u([d(S5)],Mt.prototype,"popupEnabled",void 0),u([d({type:iE,json:{name:"popupInfo",write:!0}})],Mt.prototype,"popupTemplate",void 0),u([d({readOnly:!0,json:{read:!1}})],Mt.prototype,"defaultPopupTemplate",null),u([d({type:String,json:{read:!1}})],Mt.prototype,"objectIdField",void 0),u([Pe("service","objectIdField",["objectIdField","fields"])],Mt.prototype,"readObjectIdField",null),u([d({type:String,json:{read:!1}})],Mt.prototype,"globalIdField",void 0),u([Pe("service","globalIdField",["globalIdField","fields"])],Mt.prototype,"readGlobalIdField",null),u([d({readOnly:!0,type:String,json:{read:!1}})],Mt.prototype,"displayField",null),u([d({type:String,json:{read:!1}})],Mt.prototype,"profile",void 0),u([Pe("service","profile",["store.profile"])],Mt.prototype,"readProfile",null),u([d({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],Mt.prototype,"normalReferenceFrame",void 0),u([d(o0e)],Mt.prototype,"screenSizePerspectiveEnabled",void 0),Mt=u([P("esri.layers.SceneLayer")],Mt);const qle={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Tvt={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},Svt=Mt;var dxt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Svt}),AH;let FT=AH=class extends ye{constructor(e){super(e),this.geometry=null,this.type="clip"}writeGeometry(e,t,i,r){if(r.layer&&r.layer.spatialReference&&!r.layer.spatialReference.equals(this.geometry.spatialReference)){if(!Df(e.spatialReference,r.layer.spatialReference))return void(r&&r.messages&&r.messages.push(new Ma("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:r.layer.spatialReference,context:r})));const s=new Ao;Dpe(e,s,r.layer.spatialReference),t[i]=s.toJSON(r)}else t[i]=e.toJSON(r);delete t[i].spatialReference}clone(){return new AH({geometry:ie(this.geometry),type:this.type})}};u([d({type:Ao}),l4()],FT.prototype,"geometry",void 0),u([He(["web-scene","portal-item"],"geometry")],FT.prototype,"writeGeometry",null),u([d({type:["clip","mask","replace"],nonNullable:!0}),l4()],FT.prototype,"type",void 0),FT=AH=u([P("esri.layers.support.SceneModification")],FT);const v8=FT;var nR;let UL=nR=class extends bw(ft.ofType(v8)){constructor(e){super(e),this.url=null}clone(){return new nR({url:this.url,items:this.items.map(e=>e.clone())})}toJSON(e){return this.toArray().map(t=>t.toJSON(e)).filter(t=>!!t.geometry)}static fromJSON(e,t){const i=new nR;for(const r of e)i.add(v8.fromJSON(r,t));return i}static async fromUrl(e,t,i){const r={url:Mn(e),origin:"service"},s=await ai(e,{responseType:"json",signal:Tr(i,"signal")}),n=t.toJSON(),o=[];for(const a of s.data)o.push(v8.fromJSON(ve(F({},a),{geometry:ve(F({},a.geometry),{spatialReference:n})}),r));return new nR({url:e,items:o})}};u([d({type:String})],UL.prototype,"url",void 0),UL=nR=u([P("esri.layers.support.SceneModifications")],UL);const w2e=UL;let ga=class extends g2e(TX(EX(CX(AX(x5(xX(p2))))))){constructor(...e){super(...e),this._handles=new Ht,this.geometryType="mesh",this.operationalLayerType="IntegratedMeshLayer",this.type="integrated-mesh",this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.profile="mesh-pyramids",this.modifications=null,this._modificationsSource=null,this.elevationInfo=null,this.path=null}destroy(){this._handles.destroy()}initialize(){this._handles.add(fn(()=>this.modifications,"after-changes",()=>this.modifications=this.modifications,Vi))}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}readModifications(e,t,i){this._modificationsSource={url:qv(e,i),context:i}}async load(e){return this.addResolvingPromise(this._doLoad(e)),this}async _doLoad(e){const t=Tr(e,"signal");try{await this.loadFromPortal({supportedTypes:["Scene Service"]},e)}catch(i){nc(i)}if(await this._fetchService(t),_(this._modificationsSource)){const i=await w2e.fromUrl(this._modificationsSource.url,this.spatialReference,e);this.setAtOrigin("modifications",i,this._modificationsSource.context.origin),this._modificationsSource=null}await this._fetchIndexAndUpdateExtent(this.nodePages,t)}beforeSave(){if(!A(this._modificationsSource))return this.load().then(()=>{},()=>{})}async saveAs(e,t){return this._debouncedSaveOperations(jv.SAVE_AS,ve(F({},t),{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"integrated-mesh"}),e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"integrated-mesh"};return this._debouncedSaveOperations(jv.SAVE,e)}validateLayer(e){if(e.layerType&&e.layerType!=="IntegratedMesh")throw new H("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new H("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(this.version.major>1)throw new H("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"})}_getTypeKeywords(){return["IntegratedMeshLayer"]}};u([d({type:String,readOnly:!0})],ga.prototype,"geometryType",void 0),u([d({type:["show","hide"]})],ga.prototype,"listMode",void 0),u([d({type:["IntegratedMeshLayer"]})],ga.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],ga.prototype,"type",void 0),u([d({type:V0,readOnly:!0})],ga.prototype,"nodePages",void 0),u([d({type:[Bc],readOnly:!0})],ga.prototype,"materialDefinitions",void 0),u([d({type:[oS],readOnly:!0})],ga.prototype,"textureSetDefinitions",void 0),u([d({type:[aS],readOnly:!0})],ga.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],ga.prototype,"serviceUpdateTimeStamp",void 0),u([d({type:w2e}),l4({origins:["web-scene","portal-item"],type:"resource",prefix:"modifications"})],ga.prototype,"modifications",void 0),u([Pe(["web-scene","portal-item"],"modifications")],ga.prototype,"readModifications",null),u([d(SX)],ga.prototype,"elevationInfo",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0},"portal-item":{read:!0,write:!0}},read:!1}})],ga.prototype,"path",void 0),ga=u([P("esri.layers.IntegratedMeshLayer")],ga);const Evt=ga;var pxt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Evt});let jm=class extends kX(Kr.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new H("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};u([d()],jm.prototype,"_goingHomeController",void 0),u([d({readOnly:!0})],jm.prototype,"state",null),u([d()],jm.prototype,"view",null),u([d({type:Oh})],jm.prototype,"viewpoint",null),u([d()],jm.prototype,"go",null),u([d()],jm.prototype,"cancelGo",null),jm=u([P("esri.widgets.Home.HomeViewModel")],jm);const x2e=jm,G_={base:"esri-home esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",homeIcon:"esri-icon esri-icon-home",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let Ka=class extends $a{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=G_.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.view=null,this.viewModel=new x2e,this.viewpoint=null}get homeTitle(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{messagesCommon:t,messages:i}=this;return e==="going-home"?t.cancel:i.title}cancelGo(){return null}go(){return null}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{homeTitle:t}=this,i={[G_.disabled]:e==="disabled"};return ce("div",{bind:this,class:this.classes(G_.base,i),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":t,title:t},this.renderIcon(),this.renderText())}renderIcon(){var i;const e=(i=this.viewModel)==null?void 0:i.state,t={[G_.loadingIcon]:e==="going-home",[G_.rotatingIcon]:e==="going-home"};return ce("span",{"aria-hidden":"true",class:this.classes(G_.homeIcon,t)})}renderText(){const{messages:e}=this;return ce("span",{class:G_.text},e.button)}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};u([ut("viewModel.goToOverride")],Ka.prototype,"goToOverride",void 0),u([d({readOnly:!0})],Ka.prototype,"homeTitle",null),u([d()],Ka.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ka.prototype,"label",void 0),u([d(),Ra("esri/widgets/Home/t9n/Home")],Ka.prototype,"messages",void 0),u([d(),Ra("esri/t9n/common")],Ka.prototype,"messagesCommon",void 0),u([ut("viewModel.view")],Ka.prototype,"view",void 0),u([d({type:x2e}),Qme("go")],Ka.prototype,"viewModel",void 0),u([ut("viewModel.viewpoint")],Ka.prototype,"viewpoint",void 0),u([ut("viewModel.cancelGo")],Ka.prototype,"cancelGo",null),u([ut("viewModel.go")],Ka.prototype,"go",null),u([Hc()],Ka.prototype,"_go",null),Ka=u([P("esri.widgets.Home")],Ka);const fxt=Ka;export{P4 as $,Evt as A,AJ as B,t2 as C,UR as D,b2 as E,s3e as F,jr as G,ae as H,cwt as I,uwt as J,XN as K,iGe as L,p2 as M,YJe as N,Fg as O,Qq as P,_h as Q,ft as R,LM as S,Ps as T,Vi as U,Rh as V,iwt as W,dwt as X,H as Y,yPe as Z,Tbt as _,fxt as a,Kbt as a$,Sbt as a0,Ebt as a1,kq as a2,S4 as a3,v0e as a4,xbt as a5,Kr as a6,ewt as a7,BIe as a8,pl as a9,awt as aA,wwt as aB,dZ as aC,owt as aD,nwt as aE,_l as aF,fn as aG,fE as aH,yt as aI,Js as aJ,cwe as aK,Zo as aL,Ws as aM,Fvt as aN,nu as aO,Yn as aP,xv as aQ,Tr as aR,zd as aS,e2 as aT,te as aU,Ks as aV,de as aW,oe as aX,nt as aY,Jc as aZ,J3 as a_,Lf as aa,tat as ab,HKe as ac,xu as ad,hi as ae,OH as af,he as ag,x_t as ah,fe as ai,Lh as aj,io as ak,JS as al,UBe as am,vt as an,ur as ao,bq as ap,se as aq,Rf as ar,vu as as,M as at,Ls as au,Lg as av,ri as aw,g2 as ax,Vt as ay,lwt as az,_f as b,wP as b$,rK as b0,Xbt as b1,WKe as b2,M4 as b3,Df as b4,Avt as b5,Aw as b6,iat as b7,eZ as b8,Cf as b9,Qe as bA,rr as bB,jF as bC,Ve as bD,zfe as bE,U0 as bF,ie as bG,A4 as bH,mge as bI,Mpe as bJ,$_t as bK,yee as bL,AUe as bM,dge as bN,tUe as bO,C_t as bP,P_t as bQ,iFe as bR,gge as bS,cG as bT,sUe as bU,$G as bV,f5 as bW,vl as bX,Z2 as bY,CG as bZ,Mn as b_,Qs as ba,Y2 as bb,Dt as bc,Gxe as bd,T_t as be,lr as bf,j4 as bg,Mbt as bh,Mg as bi,ghe as bj,bb as bk,sJ as bl,yhe as bm,xat as bn,wi as bo,$vt as bp,oce as bq,sce as br,Pi as bs,Ge as bt,Se as bu,ui as bv,hr as bw,Hd as bx,Jr as by,ai as bz,ZRe as c,wa as c$,Ad as c0,dUe as c1,aCe as c2,xi as c3,Ig as c4,GH as c5,wBe as c6,qf as c7,lc as c8,Ke as c9,nc as cA,aO as cB,Mw as cC,a0e as cD,Pe as cE,VD as cF,Dvt as cG,Ow as cH,n2 as cI,Bze as cJ,Yo as cK,jvt as cL,Xs as cM,jt as cN,di as cO,rl as cP,sl as cQ,Vo as cR,cc as cS,Wf as cT,CD as cU,TO as cV,gX as cW,GN as cX,Cs as cY,Sze as cZ,pv as c_,Og as ca,_8e as cb,b8e as cc,w8e as cd,rUe as ce,iUe as cf,Ble as cg,Ro as ch,AW as ci,B2e as cj,p1t as ck,f2 as cl,Zb as cm,ABe as cn,O_t as co,VC as cp,X_t as cq,kM as cr,C0e as cs,_ce as ct,TX as cu,EX as cv,CX as cw,x5 as cx,Ict as cy,Yi as cz,d,YS as d$,xze as d0,Ph as d1,yze as d2,pze as d3,dze as d4,Yb as d5,Qc as d6,Uye as d7,Eu as d8,JUe as d9,fze as dA,kze as dB,Nze as dC,Lze as dD,cbt as dE,Fze as dF,Uze as dG,mze as dH,gze as dI,bze as dJ,$ze as dK,rX as dL,dbt as dM,uze as dN,hze as dO,lze as dP,aze as dQ,BT as dR,SPe as dS,B_t as dT,k_t as dU,WOe as dV,TPe as dW,qv as dX,V_t as dY,vwt as dZ,ost as d_,oze as da,cze as db,Jt as dc,Fye as dd,du as de,Tze as df,vze as dg,U8 as dh,Dw as di,QH as dj,Eze as dk,Cze as dl,au as dm,xw as dn,Aze as dp,fX as dq,Oze as dr,Rze as ds,Mze as dt,Hhe as du,gc as dv,xO as dw,ize as dx,wze as dy,_ze as dz,u as e,Z5 as e$,pR as e0,RV as e1,G_t as e2,CGe as e3,Nbt as e4,qct as e5,Owt as e6,NZ as e7,O4 as e8,ru as e9,We as eA,J as eB,CF as eC,Yf as eD,gt as eE,Xf as eF,Re as eG,G as eH,ar as eI,Ki as eJ,qo as eK,cr as eL,er as eM,Ni as eN,Ut as eO,ey as eP,P5 as eQ,Kv as eR,wl as eS,eU as eT,Kt as eU,kf as eV,Vv as eW,t_ as eX,rU as eY,Qf as eZ,tU as e_,np as ea,jl as eb,$M as ec,Mr as ed,R as ee,wb as ef,n5 as eg,Gi as eh,Qt as ei,Rs as ej,bt as ek,Pr as el,B2 as em,Pbt as en,X$ as eo,ww as ep,Rlt as eq,Hi as er,mu as es,To as et,fi as eu,sfe as ev,x as ew,cs as ex,Su as ey,zt as ez,hxt as f,sbe as f$,hw as f0,vU as f1,stt as f2,iY as f3,wE as f4,Qbe as f5,ys as f6,q4 as f7,qs as f8,Jdt as f9,x4 as fA,oJ as fB,cu as fC,xhe as fD,ec as fE,ty as fF,nTe as fG,c4 as fH,Lb as fI,bIe as fJ,ke as fK,mg as fL,A$e as fM,Ae as fN,Dr as fO,MWe as fP,rxt as fQ,zwt as fR,sxt as fS,xY as fT,QZ as fU,v8 as fV,Jwt as fW,Xwt as fX,Ywt as fY,Wwt as fZ,K9 as f_,Lue as fa,Qvt as fb,KAe as fc,npt as fd,PBe as fe,tH as ff,NS as fg,Ma as fh,D9e as fi,nte as fj,Lr as fk,_bt as fl,T0e as fm,evt as fn,A0e as fo,cvt as fp,V0 as fq,Bc as fr,oS as fs,aS as ft,BBe as fu,Wye as fv,S5 as fw,iE as fx,ot as fy,S0e as fz,Wv as g,sKe as g$,vc as g0,Gpt as g1,qwt as g2,$dt as g3,EE as g4,ixt as g5,Ddt as g6,Y_t as g7,pae as g8,$S as g9,SN as gA,gq as gB,Ck as gC,De as gD,Ai as gE,Gt as gF,i_t as gG,fW as gH,Oe as gI,oxt as gJ,nxt as gK,axt as gL,Fbt as gM,jS as gN,nr as gO,Pdt as gP,E1t as gQ,$wt as gR,xh as gS,VH as gT,Gvt as gU,ZO as gV,sO as gW,Cu as gX,swt as gY,q_e as gZ,kd as g_,Eb as ga,Fr as gb,gIe as gc,Ih as gd,xg as ge,Q_t as gf,gi as gg,Zs as gh,ip as gi,Gwt as gj,XIe as gk,Qdt as gl,vb as gm,txt as gn,Xi as go,K2 as gp,ext as gq,It as gr,spt as gs,Kde as gt,epe as gu,rwt as gv,Kwt as gw,Hwt as gx,jwt as gy,Wq as gz,Ft as h,a3e as h$,fpt as h0,mpt as h1,kwt as h2,rv as h3,C$e as h4,pn as h5,or as h6,xe as h7,Sa as h8,pe as h9,WS as hA,pc as hB,CUe as hC,Xvt as hD,UT as hE,aR as hF,hv as hG,Nb as hH,iK as hI,B4e as hJ,Y1t as hK,gee as hL,Q1t as hM,Zvt as hN,cue as hO,jCe as hP,B1t as hQ,Oge as hR,Pge as hS,Age as hT,s_t as hU,jbt as hV,Oue as hW,vAe as hX,Wvt as hY,fc as hZ,o3e as h_,If as ha,qD as hb,pf as hc,opt as hd,vie as he,Vwt as hf,rJ as hg,Ibt as hh,Ilt as hi,G2e as hj,S1t as hk,Pf as hl,r$e as hm,s$e as hn,MH as ho,yfe as hp,aAe as hq,fAe as hr,_b as hs,Ige as ht,Iue as hu,YH as hv,Hvt as hw,gl as hx,YW as hy,z4e as hz,Pa as i,Ype as i$,ye as i0,jM as i1,lE as i2,bge as i3,Zbt as i4,IBe as i5,bbt as i6,nCe as i7,r_t as i8,Jvt as i9,gu as iA,Pt as iB,tf as iC,Qr as iD,Ei as iE,pt as iF,ze as iG,mt as iH,St as iI,Je as iJ,wr as iK,La as iL,st as iM,Da as iN,Xe as iO,Zi as iP,xo as iQ,Ng as iR,es as iS,zB as iT,pi as iU,eF as iV,Qv as iW,Q5 as iX,Vbt as iY,tt as iZ,eo as i_,e_t as ia,Kvt as ib,t_t as ic,nO as id,Eh as ie,JAe as ig,Nbe as ih,qbt as ii,qJe as ij,Qbt as ik,mhe as il,v_t as im,Lvt as io,Mwt as ip,m_t as iq,w4 as ir,cUe as is,Jbt as it,Rr as iu,xge as iv,r0e as iw,Jv as ix,Dtt as iy,Us as iz,spe as j,_q as j$,J_t as j0,Vfe as j1,fbt as j2,g4 as j3,V1t as j4,Ovt as j5,Pn as j6,mZ as j7,ml as j8,qi as j9,rq as jA,pge as jB,qvt as jC,ab as jD,Lwt as jE,Nwt as jF,b_t as jG,pOe as jH,$1 as jI,Dwt as jJ,OF as jK,Mv as jL,yr as jM,vg as jN,ul as jO,yc as jP,Kg as jQ,to as jR,ht as jS,S_t as jT,VM as jU,Si as jV,_i as jW,Wo as jX,_he as jY,Fwt as jZ,Uwt as j_,z$ as ja,Pue as jb,Vvt as jc,Z1t as jd,z_t as je,Vhe as jf,Gb as jg,Aj as jh,MM as ji,Ah as jj,d1t as jk,nBe as jl,Tw as jm,LS as jn,He as jo,QQ as jp,E5e as jq,S5e as jr,yi as js,W_t as jt,kvt as ju,mv as jv,uv as jw,bP as jx,iq as jy,tq as jz,W0 as k,Obt as k$,_$e as k0,V4 as k1,Gbt as k2,Ns as k3,ii as k4,bi as k5,bwt as k6,Zwt as k7,Qwt as k8,lge as k9,Tyt as kA,N9 as kB,ss as kC,L9 as kD,U9 as kE,xN as kF,kIe as kG,Ab as kH,mpe as kI,cf as kJ,Ewt as kK,Rwt as kL,oTe as kM,zoe as kN,Swt as kO,Cwt as kP,Twt as kQ,qR as kR,xD as kS,$ct as kT,Fh as kU,l_t as kV,hY as kW,Ta as kX,Uoe as kY,cct as kZ,uct as k_,bA as ka,Tfe as kb,lCe as kc,rF as kd,U3 as ke,Iwt as kf,nae as kg,Pwt as kh,Ko as ki,fS as kj,d3e as kk,m2 as kl,mc as km,xb as kn,Ag as ko,m4 as kp,nW as kq,lpt as kr,Bwt as ks,iAe as kt,QTe as ku,Ue as kv,ice as kw,Ok as kx,kS as ky,Put as kz,qe as l,Jpe as l$,LX as l0,Rbt as l1,vs as l2,uh as l3,eM as l4,D1t as l5,yu as l6,j4e as l7,bDe as l8,qIe as l9,N_t as lA,L_t as lB,H3e as lC,G3e as lD,ppe as lE,U_t as lF,q_t as lG,H_t as lH,j_t as lI,df as lJ,OO as lK,wo as lL,r5 as lM,x1t as lN,T1t as lO,b1t as lP,w1t as lQ,gs as lR,iy as lS,Aa as lT,IZ as lU,vlt as lV,iS as lW,$j as lX,mw as lY,Ii as lZ,wT as l_,c1t as la,HIe as lb,we as lc,lt as ld,F2 as le,Hb as lf,pu as lg,Z_t as lh,o1t as li,a1t as lj,GX as lk,Yie as ll,$t as lm,yf as ln,Vde as lo,L3e as lp,hS as lq,zIe as lr,ti as ls,so as lt,Or as lu,oO as lv,pwt as lw,$Me as lx,c_t as ly,Hs as lz,lhe as m,s1t as m$,ro as m0,tn as m1,il as m2,_4 as m3,wv as m4,JGe as m5,Jl as m6,Rd as m7,Vs as m8,Ave as m9,PY as mA,Hf as mB,Qn as mC,ll as mD,Cb as mE,SXe as mF,Bbt as mG,kbt as mH,zbt as mI,r1t as mJ,ngt as mK,US as mL,M8 as mM,NJe as mN,JJe as mO,Lbt as mP,tb as mQ,uc as mR,F_t as mS,Qi as mT,hie as mU,LH as mV,tg as mW,Q_e as mX,Pw as mY,yW as mZ,d_t as m_,jX as ma,uS as mb,gA as mc,Vg as md,vW as me,a2 as mf,sr as mg,vR as mh,Y4 as mi,u1t as mj,Bb as mk,h1t as ml,s7e as mm,l7e as mn,A9 as mo,sp as mp,Vr as mq,HX as mr,qRe as ms,je as mt,$s as mu,l1t as mv,F$e as mw,Kq as mx,hh as my,vJ as mz,P as n,rYe as n$,y_t as n0,uie as n1,jf as n2,cW as n3,Upe as n4,$f as n5,Sr as n6,Ff as n7,xt as n8,Eo as n9,cp as nA,cbe as nB,L2 as nC,GS as nD,ZY as nE,z4 as nF,u_t as nG,k2e as nH,n1t as nI,sk as nJ,CN as nK,yyt as nL,lxt as nM,uxt as nN,cxt as nO,lq as nP,PH as nQ,g_t as nR,j_ as nS,cie as nT,jp as nU,bw as nV,l4 as nW,bW as nX,gO as nY,r2 as nZ,p_t as n_,iU as na,J5 as nb,dt as nc,ji as nd,w_t as ne,eoe as nf,gW as ng,us as nh,AO as ni,$bt as nj,f_t as nk,K_t as nl,Nd as nm,Tu as nn,_U as no,$r as np,Ia as nq,Ca as nr,$i as ns,mn as nt,tbe as nu,t1t as nv,nQe as nw,wu as nx,lu as ny,y$e as nz,Cw as o,Nrt as o$,wW as o0,_pe as o1,i2 as o2,S$e as o3,One as o4,hc as o5,Zv as o6,rDe as o7,$g as o8,Q4 as o9,M_t as oA,A1t as oB,R1t as oC,Hbt as oD,GCe as oE,gbt as oF,Qze as oG,tze as oH,zAe as oI,Xve as oJ,ZX as oK,Yve as oL,qg as oM,tc as oN,_s as oO,bu as oP,h3 as oQ,Epe as oR,en as oS,OU as oT,RIe as oU,gwt as oV,x2 as oW,Bv as oX,fwt as oY,ywt as oZ,mwt as o_,Eje as oa,e1t as ob,xwt as oc,d4 as od,Iw as oe,_u as of,dIe as og,bf as oh,Dbt as oi,Ra as oj,$a as ok,ce as ol,Sm as om,eG as on,ege as oo,Zr as op,hce as oq,dS as or,lO as os,Ohe as ot,A_t as ou,OM as ov,Di as ow,Xd as ox,C4 as oy,W2 as oz,eE as p,y1t as p$,zrt as p0,Frt as p1,Urt as p2,krt as p3,U1t as p4,W1t as p5,q1t as p6,m0e as p7,b5e as p8,$ge as p9,Pvt as pA,Kc as pB,F1t as pC,Ivt as pD,Yl as pE,H1t as pF,p5 as pG,zTe as pH,Oi as pI,Ug as pJ,uu as pK,X0 as pL,Abt as pM,qd as pN,rQ as pO,i1t as pP,D$e as pQ,Bvt as pR,zvt as pS,VOe as pT,Rq as pU,Awt as pV,Xl as pW,IH as pX,koe as pY,_1t as pZ,g1t as p_,j1t as pa,G1t as pb,n_t as pc,o_t as pd,a_t as pe,VRe as pf,Ybt as pg,Wbt as ph,hl as pi,eUe as pj,r3e as pk,PAe as pl,F5e as pm,J1t as pn,X5e as po,nee as pp,wge as pq,X1t as pr,NPe as ps,I_t as pt,I9 as pu,l6 as pv,c6 as pw,O8 as px,U2e as py,Mvt as pz,qt as q,Dmt as q$,f1t as q0,bme as q1,hNe as q2,v1t as q3,m1t as q4,UTe as q5,rdt as q6,S7e as q7,Gje as q8,f_e as q9,M1t as qA,$1t as qB,G4e as qC,PM as qD,oit as qE,L1t as qF,N1t as qG,C1t as qH,Ett as qI,_ut as qJ,vut as qK,zU as qL,but as qM,PF as qN,Met as qO,aSe as qP,Zpt as qQ,KZ as qR,Jft as qS,_Se as qT,tmt as qU,bSe as qV,rmt as qW,wSe as qX,ymt as qY,JU as qZ,Emt as q_,CHe as qa,YHe as qb,pY as qc,KHe as qd,vqe as qe,Rqe as qf,QQe as qg,AF as qh,Ftt as qi,Vtt as qj,Att as qk,hn as ql,Kn as qm,gut as qn,ySe as qo,Aft as qp,Y3 as qq,Rk as qr,_Oe as qs,RHe as qt,NKe as qu,I1t as qv,P1t as qw,O1t as qx,kT as qy,H4e as qz,_ as r,l5e as r$,ttt as r0,_mt as r1,Zmt as r2,Zit as r3,Vrt as r4,sot as r5,Aot as r6,wot as r7,Cq as r8,Du as r9,Xv as rA,WBe as rB,MBe as rC,$Be as rD,s8e as rE,rN as rF,Due as rG,M8e as rH,E5 as rI,ZM as rJ,WN as rK,ND as rL,w5 as rM,o0e as rN,PX as rO,x0e as rP,ut as rQ,P8 as rR,a6 as rS,OEe as rT,F8e as rU,rE as rV,Ji as rW,wde as rX,Ede as rY,a5e as rZ,uPe as r_,Lrt as ra,hwt as rb,OBe as rc,AX as rd,tGe as re,K9e as rf,Z9e as rg,Yte as rh,ove as ri,Xo as rj,t8e as rk,ahe as rl,IW as rm,g2e as rn,xX as ro,jv as rp,uvt as rq,wbt as rr,SX as rs,R4 as rt,Sv as ru,rO as rv,c0e as rw,l0e as rx,Uh as ry,I4 as rz,Svt as s,Rfe as s$,tpe as s0,Gye as s1,HN as s2,Uvt as s3,bde as s4,gN as s5,RBe as s6,Yvt as s7,Ds as s8,Nvt as s9,khe as sA,VBe as sB,vbt as sC,kCe as sD,BQ as sE,L as sF,D_t as sG,lbt as sH,Jee as sI,ebt as sJ,Qee as sK,Ize as sL,abt as sM,hbt as sN,ubt as sO,ibt as sP,tbt as sQ,rbt as sR,sbt as sS,obt as sT,nze as sU,ete as sV,nbt as sW,Pze as sX,b5 as sY,zye as sZ,Bye as s_,Vb as sa,__t as sb,ng as sc,gw as sd,DH as se,iT as sf,E0e as sg,YL as sh,OR as si,D9 as sj,rve as sk,Of as sl,Ef as sm,Ude as sn,Lhe as so,Rvt as sp,iBe as sq,_X as sr,jBe as ss,GBe as st,X2 as su,yde as sv,ybt as sw,oc as sx,Yd as sy,E_t as sz,A as t,K$e as t0,Bo as t1,oGe as t2,mbt as t3,LVe as t4,G0e as t5,q0e as t6,x1 as t7,FX as t8,NX as t9,vxe as tA,cst as tB,xxe as tC,bxe as tD,fst as tE,Fj as tF,wxe as tG,Dv as tH,ust as tI,$v as tJ,Cj as tK,sw as tL,QKe as tM,Gst as tN,Vst as tO,Bst as tP,Ubt as tQ,Zhe as tR,k1t as tS,z1t as tT,pbt as tU,Cbt as tV,twt as tW,_wt as tX,dxt as tY,pxt as tZ,MVe as ta,K1t as tb,UX as tc,T8e as td,S8e as te,E8e as tf,Gf as tg,Tje as th,c$e as ti,a$e as tj,mf as tk,dxe as tl,$H as tm,pje as tn,R_t as to,Txe as tp,Exe as tq,VR as tr,K1 as ts,In as tt,xl as tu,Dh as tv,bx as tw,h_t as tx,cZ as ty,mst as tz,Ht as u,Ao as v,Hq as w,ZN as x,Ee as y,at as z};
