import{nR as L,ki as R,E as _,y as z,r as n,k as t,n as s,o as c,Z as b,ja as S,Q as x,_ as m,C as y,jb as A,f3 as u,bb as q,sf as F,jq as P,av as M,sg as T,cD as k,cF as C,V as D}from"./vendor.5fba8a95.js";import{f as w,u as O}from"./LineOfSightAnalysisTarget.dc05a28a.js";import{s as N}from"./elevationInfoUtils.025015e4.js";let I=0,o=class extends L(R(_(z))){constructor(e){super(e),this.id=`${Date.now().toString(16)}-analysis-${I++}`,this.title=null}get parent(){return this._get("parent")}set parent(e){const i=this.parent;if(n(i))switch(i.type){case"line-of-sight":i.removeAnalysis(this);break;case"2d":case"3d":i.analyses.includes(this)&&i.analyses.remove(this)}this._set("parent",e)}get isEditable(){return this.requiredPropertiesForEditing.every(n)}};t([s({type:String,constructOnly:!0,clonable:!1})],o.prototype,"id",void 0),t([s({type:String})],o.prototype,"title",void 0),t([s({constructOnly:!0})],o.prototype,"type",void 0),t([s({clonable:!1,value:null})],o.prototype,"parent",null),t([s({readOnly:!0})],o.prototype,"extent",void 0),t([s({readOnly:!0})],o.prototype,"isEditable",null),t([s({readOnly:!0})],o.prototype,"requiredPropertiesForEditing",void 0),t([s({readOnly:!0})],o.prototype,"nonEditableMessage",void 0),o=t([c("esri.analysis.Analysis")],o);const Q=o,g=b.ofType(w);let a=class extends Q{constructor(e){super(e),this.type="line-of-sight",this.observer=null,this.extent=null,this.nonEditableMessage="Assign an observer location to the analysis to allow editing."}initialize(){this.own(x(()=>this._computeExtent(),e=>{(y(e)||y(e.pending))&&this._set("extent",n(e)?e.extent:null)},m))}get targets(){return this._get("targets")||new g}set targets(e){this._set("targets",A(e,this.targets,g))}get spatialReference(){return n(this.observer)&&n(this.observer.position)?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){return[u(this.observer,e=>e.position)]}async waitComputeExtent(){const e=this._computeExtent();return n(e)?q(e.pending):null}_computeExtent(){const e=this.spatialReference;if(y(this.observer)||y(this.observer.position)||y(e))return null;const i=p=>N(p.position,p.elevationInfo)==="absolute-height",l=this.observer.position,v=F(l.x,l.y,l.z,l.x,l.y,l.z);for(const p of this.targets)if(n(p.position)){const d=P(p.position,e);if(n(d.pending))return{pending:d.pending,extent:null};if(n(d.geometry)){const{x:E,y:$,z:j}=d.geometry;M(v,[E,$,j])}}const h=T(v,e);return i(this.observer)&&this.targets.every(i)||(h.zmin=null,h.zmax=null),{pending:null,extent:h}}clear(){this.observer=null,this.targets.removeAll()}};t([s({type:["line-of-sight"]})],a.prototype,"type",void 0),t([s({type:O,json:{read:!0,write:!0}})],a.prototype,"observer",void 0),t([s({cast:S,type:g,nonNullable:!0,json:{read:!0,write:!0}})],a.prototype,"targets",null),t([s({value:null,readOnly:!0})],a.prototype,"extent",void 0),t([s({readOnly:!0})],a.prototype,"spatialReference",null),t([s({readOnly:!0})],a.prototype,"requiredPropertiesForEditing",null),t([s({readOnly:!0})],a.prototype,"nonEditableMessage",void 0),a=t([c("esri.analysis.LineOfSightAnalysis")],a);const f=a,V=b.ofType(w);let r=class extends k(C(D)){constructor(e){super(e),this.type="line-of-sight",this.operationalLayerType="LineOfSightLayer",this.analysis=new f,this.opacity=1}initialize(){this.own(x(()=>this.analysis,(e,i)=>{n(i)&&i.parent===this&&(i.parent=null),n(e)&&(e.parent=this)},m))}async load(){return n(this.analysis)&&this.addResolvingPromise(this.analysis.waitComputeExtent()),this}get observer(){return u(this.analysis,e=>e.observer)}set observer(e){u(this.analysis,i=>i.observer=e)}get targets(){return n(this.analysis)?this.analysis.targets:null}set targets(e){u(this.analysis,i=>i.targets=e)}get fullExtent(){return n(this.analysis)?this.analysis.extent:null}get spatialReference(){return n(this.analysis)?this.analysis.spatialReference:null}removeAnalysis(e){this.analysis===e&&(this.analysis=new f)}};t([s({json:{read:!1},readOnly:!0})],r.prototype,"type",void 0),t([s({type:["LineOfSightLayer"]})],r.prototype,"operationalLayerType",void 0),t([s({type:O,json:{read:!0,write:{ignoreOrigin:!0}}})],r.prototype,"observer",null),t([s({type:V,json:{read:!0,write:{ignoreOrigin:!0}}})],r.prototype,"targets",null),t([s({nonNullable:!0,json:{read:!1,write:!1}})],r.prototype,"analysis",void 0),t([s({readOnly:!0})],r.prototype,"fullExtent",null),t([s({readOnly:!0})],r.prototype,"spatialReference",null),t([s({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],r.prototype,"opacity",void 0),t([s({type:["show","hide"]})],r.prototype,"listMode",void 0),r=t([c("esri.layers.LineOfSightLayer")],r);const H=r;export{H as default};
