var B=Object.defineProperty,R=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var E=(n,a,e)=>a in n?B(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e,M=(n,a)=>{for(var e in a||(a={}))O.call(a,e)&&E(n,e,a[e]);if(g)for(var e of g(a))k.call(a,e)&&E(n,e,a[e]);return n},b=(n,a)=>R(n,j(a));import{b2 as q,bb as G,oz as Y,oA as _,jt as U,iV as Z,bg as H,ch as J,oB as K,oC as L}from"./vendor.5fba8a95.js";import{T as Q,s as W,m as X,c as aa,V as na,g as ea,h as ia,y as ta,D as oa,z as sa}from"./utils.6eccf1e5.js";import"./ClassBreaksDefinition.413c77e2.js";let z=null;function la(n,a,e){return n.x<0?n.x+=a:n.x>e&&(n.x-=a),n}function ra(n,a,e,o){const t=_(e)?U(e):null,r=t?Math.round((t.valid[1]-t.valid[0])/a.scale[0]):null;return n.map(l=>{const i=new q(G(l.geometry));return Y(a,i,i,i.hasZ,i.hasM),l.geometry=t?la(i,r,o[0]):i,l})}function ua(n,a=18,e,o,t,r){const l=new Float64Array(t*r);a=Math.round(Z(a));let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,u=0,m=0,d=0,f=0;const c=K(o,e);for(const{geometry:v,attributes:I}of n){const{x:y,y:V}=v,P=Math.max(0,y-a),$=Math.max(0,V-a),C=Math.min(r,V+a),D=Math.min(t,y+a),N=+c(I);for(let x=$;x<C;x++)for(let T=P;T<D;T++){const F=x*t+T,S=L(T-y,x-V,a),A=l[F];u=l[F]+=S*N;const w=u-A;m+=w,d+=w*w,u<i&&(i=u),u>s&&(s=u),f++}}if(!f)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};const p=(s-i)/2;return{mean:m/f,stdDev:Math.sqrt((d-m*m/f)/f),min:i,max:s,mid:p,count:f}}async function h(n,a){if(!a)return[];const e=n.field,o=n.valueExpression,t=n.normalizationType,r=n.normalizationField,l=n.normalizationTotal,i=[],s=n.viewInfoParams;let u=null,m=null;if(o){if(!z){const{arcadeUtils:c}=await H();z=c}u=z.createFunction(o),m=s&&z.getViewInfo({viewingMode:s.viewingMode,scale:s.scale,spatialReference:new J(s.spatialReference)})}const d=n.fieldInfos,f=!(a[0]&&"declaredClass"in a[0]&&a[0].declaredClass==="esri.Graphic")&&d?{fields:d}:null;return a.forEach(c=>{const p=c.attributes;let v;if(o){const I=f?b(M({},c),{layer:f}):c,y=z.createExecContext(I,m);v=z.executeFunction(u,y)}else p&&(v=p[e]);if(t&&isFinite(v)){const I=p&&parseFloat(p[r]);v=Q(v,t,I,l)}i.push(v)}),i}async function pa(n){const{attribute:a,features:e}=n,{normalizationType:o,normalizationField:t,minValue:r,maxValue:l,fieldType:i}=a,s=await h({field:a.field,valueExpression:a.valueExpression,normalizationType:o,normalizationField:t,normalizationTotal:a.normalizationTotal,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),u=W({normalizationType:o,normalizationField:t,minValue:r,maxValue:l}),m={value:.5,fieldType:i},d=i==="esriFieldTypeString"?X({values:s,supportsNullCount:u,percentileParams:m}):aa({values:s,minValue:r,maxValue:l,useSampleStdDev:!o,supportsNullCount:u,percentileParams:m});return na(d,i==="esriFieldTypeDate")}async function va(n){const{attribute:a,features:e}=n,o=await h({field:a.field,valueExpression:a.valueExpression,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),t=ea(o);return ia(t,a.domain,a.returnAllCodedValues)}async function za(n){const{attribute:a,features:e}=n,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:i}=a,s=await h({field:o,valueExpression:a.valueExpression,normalizationType:t,normalizationField:r,normalizationTotal:l,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),u=ta(s,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:i,standardDeviationInterval:a.standardDeviationInterval,numClasses:a.numClasses,minValue:a.minValue,maxValue:a.maxValue});return oa(u,i)}async function Ia(n){const{attribute:a,features:e}=n,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:i}=a,s=await h({field:o,valueExpression:a.valueExpression,normalizationType:t,normalizationField:r,normalizationTotal:l,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e);return sa(s,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:l,classificationMethod:i,standardDeviationInterval:a.standardDeviationInterval,numBins:a.numBins,minValue:a.minValue,maxValue:a.maxValue})}async function ya(n){const{attribute:a,features:e}=n,{field:o,radius:t,fieldOffset:r,transform:l,spatialReference:i,size:s}=a,u=ra(e,l,i,s),{count:m,min:d,max:f,mean:c,stdDev:p}=ua(u,t,r,o,s[0],s[1]);return{count:m,min:d,max:f,avg:c,stddev:p}}export{za as classBreaks,ya as heatmapStatistics,Ia as histogram,pa as summaryStatistics,va as uniqueValues};
