var iRe=Object.defineProperty,rRe=Object.defineProperties;var sRe=Object.getOwnPropertyDescriptors;var DP=Object.getOwnPropertySymbols;var wK=Object.prototype.hasOwnProperty,xK=Object.prototype.propertyIsEnumerable;var bK=(e,t,i)=>t in e?iRe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,F=(e,t)=>{for(var i in t||(t={}))wK.call(t,i)&&bK(e,i,t[i]);if(DP)for(var i of DP(t))xK.call(t,i)&&bK(e,i,t[i]);return e},ye=(e,t)=>rRe(e,sRe(t));var NP=(e,t)=>{var i={};for(var r in e)wK.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&DP)for(var r of DP(e))t.indexOf(r)<0&&xK.call(e,r)&&(i[r]=e[r]);return i};function u(e,t,i,r){var s,n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}let pv;function he(e){return typeof pv[e]=="function"?pv[e]=pv[e](globalThis):pv[e]}var dhe,phe,fhe,mhe;pv=((dhe=globalThis.dojoConfig)==null?void 0:dhe.has)||((phe=globalThis.esriConfig)==null?void 0:phe.has)?F(F({},(fhe=globalThis.dojoConfig)==null?void 0:fhe.has),(mhe=globalThis.esriConfig)==null?void 0:mhe.has):{},he.add=(e,t,i,r)=>((r||pv[e]===void 0)&&(pv[e]=t),i&&he(e)),he.cache=pv,he.add("esri-deprecation-warnings",!0),(()=>{var t;he.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window!="undefined"&&typeof location!="undefined"&&typeof document!="undefined"&&window.location===location&&window.document===document;if(he.add("host-browser",e),he.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),he.add("dom",e),he("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(he.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),he.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),he.add("khtml",s.includes("Konqueror")?n:void 0),he.add("edge",parseFloat(r.split("Edge/")[1])||void 0),he.add("opr",parseFloat(r.split("OPR/")[1])||void 0),he.add("webkit",!he("wp")&&!he("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),he.add("chrome",!he("edge")&&!he("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),he.add("android",!he("wp")&&parseFloat(r.split("Android ")[1])||void 0),he.add("safari",!s.includes("Safari")||he("wp")||he("chrome")||he("android")||he("edge")||he("opr")?void 0:parseFloat(s.split("Version/")[1])),he.add("mac",s.includes("Macintosh")),!he("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));he.add(o,l),he.add("ios",l)}he.add("trident",parseFloat(s.split("Trident/")[1])||void 0),he("webkit")||(!r.includes("Gecko")||he("wp")||he("khtml")||he("trident")||he("edge")||he.add("mozilla",n),he("mozilla")&&he.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&he.add("esri-mobile",t),i&&he.add("esri-iPhone",i),he.add("esri-geolocation",!!navigator.geolocation)}he.add("esri-canvas-svg-support",!he("trident")),he.add("esri-wasm","WebAssembly"in globalThis),he.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),he.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),he.add("esri-atomics","Atomics"in globalThis),he.add("esri-workers","Worker"in globalThis),he.add("web-feat:cache","caches"in globalThis),he.add("esri-workers-arraybuffer-transfer",!he("safari")||Number(he("safari"))>=12),he.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),he.add("featurelayer-simplify-payload-size-factors",[1,1,4]),he.add("featurelayer-snapshot-enabled",!0),he.add("featurelayer-snapshot-point-min-threshold",8e4),he.add("featurelayer-snapshot-point-max-threshold",4e5),he.add("featurelayer-snapshot-point-coverage",.1),he.add("featurelayer-advanced-symbols",!1),he.add("featurelayer-pbf",!0),he.add("featurelayer-pbf-statistics",!1),he.add("feature-layers-workers",!0),he.add("feature-polyline-generalization-factor",1),he.add("mapview-transitions-duration",200),he.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),he.add("mapserver-pbf-enabled",!1),he.add("mapimagelayer-popup-identify-max-tolerance",20),he.add("heatmap-allow-raster-fallback",!0),he.add("heatmap-force-raster",!1),he("host-webworker")||he("host-browser")&&(he.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),he.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{he.add("esri-image-decode",!0,!0,!0)}).catch(()=>{he.add("esri-image-decode",!1,!0,!0)})}return!1}),he.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();const p1=null;function _(e){return e!=null}function R(e){return e==null}function rn(e,t){return _(e)?t(e):p1}function hTt(e){return e}function nRe(e,t){if(R(e))throw new Error(t);return e}function vt(e,t){return _(e)?e:typeof t=="function"?t():t}function dTt(e,t){return _(e)?e:t}function lt(e){return _(e)&&e.destroy(),null}function Ze(e){return _(e)&&e.dispose(),null}function cn(e){return _(e)&&e.remove(),null}function Hh(e){return _(e)&&e.abort(),null}function Ki(e){return _(e)&&e.release(),null}function oRe(e,t,i){return _(e)&&_(t)?_(i)?i(e,t):e.equals(t):e===t}function aRe(e){return null}function pTt(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);_(s)&&i.push(s)}),i}function fTt(e,t){const i=new Array;for(const r of e)i.push(gu(r,null,t));return i}function mTt(e,t){for(const i of e)rn(i,t)}function gu(e,t,i){return _(e)?i(e):t}function gTt(e){return e.filter(t=>_(t))}function xr(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function yTt(e){return e}class Rh{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*Rh._m:t}getInt(){return this._seed=(Rh._a*this._seed+Rh._c)%Rh._m,this._seed}getFloat(){return this.getInt()/(Rh._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/Rh._m*r}}Rh._m=2147483647,Rh._a=48271,Rh._c=0;function w3(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function Hv(e,t,i){if(R(e)&&R(t))return!0;if(R(e)||R(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function fW(e,t){let i=e.length!==t.length;e.length=t.length;for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function lRe(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(o=>i(o,n))),s=e.filter(n=>!t.some(o=>i(o,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function cRe(e){return e&&typeof e.length=="number"}function uRe(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const hRe=!!Array.prototype.fill;function vTt(e,t){if(hRe)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function dRe(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function whe(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}function xhe(e){return e.reduce((t,i)=>t.concat(i||[]),[])}class The{constructor(){this.last=0}}const She=new The;function Ehe(e,t,i,r){r=r||She;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function A5(e,t,i,r){const s=i==null?e.length:i,n=Ehe(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const ld=new Set;function pRe(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;ld.clear();for(let a=0;a<r;++a)ld.add(t[a]);s=s||She;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(ld.has(e[a])&&(n&&n.push(e[a]),ld.delete(e[a]),e[a]=e[i-1],--i,--a,ld.size===0||i===0))return ld.clear(),i;for(let a=0;a<o;++a)if(ld.has(e[a])&&(n&&n.push(e[a]),ld.delete(e[a]),e[a]=e[i-1],--i,--a,ld.size===0||i===0))return ld.clear(),i;return ld.clear(),i}function fRe(e){return e?(TK.seed=e,()=>TK.getFloat()):Math.random}function _Tt(e,t){const i=fRe(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const TK=new Rh;function mW(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}function mRe(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function gW(e,t,i){if(e.slice)return e.slice(t,i);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),i===void 0?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function gC(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function gRe(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function lb(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function yRe(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function Che(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function HN(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function Ahe(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function qN(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function Rhe(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function Mhe(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function vRe(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function FP(e){return R(e)?0:128+e.buffer.byteLength+64}function Ohe(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&Ohe(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function re(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=Lhe(e);if(_(t))return t;if(Phe(e))return e.clone();if(Ihe(e))return e.map(re);if($he(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=re(e[r]);return i}function Z8(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=Lhe(e);if(_(t))return t;if(Ihe(e)){let i=!0;const r=e.map(s=>{const n=Z8(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(Phe(e))return e.clone();if(!$he(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=Z8(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function Phe(e){return typeof e.clone=="function"}function Ihe(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function $he(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function SK(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function Lhe(e){if(gRe(e)||lb(e)||yRe(e)||Che(e)||HN(e)||Ahe(e)||qN(e)||Rhe(e)||Mhe(e))return gW(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((i,r)=>{t.set(r,re(i))}),t}if(e instanceof Set){const t=new Set;return e.forEach(i=>{t.add(re(i))}),t}return null}function yW(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function _Re(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&Hv(e,t):e instanceof Set?t instanceof Set&&wRe(e,t):e instanceof Map?t instanceof Map&&xRe(e,t):!!SK(e)&&SK(t)&&bRe(e,t))}function bRe(e,t){if(e===null||t===null)return!1;const i=Object.keys(e);if(t===null||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}function wRe(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function xRe(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function Dhe(e,t,i=!1){return Fhe(e,t,i)}function kE(e,t){if(t!=null)return t[e]||Nhe(e.split("."),!1,t)}function Sc(e,t,i){const r=e.split("."),s=r.pop(),n=Nhe(r,!0,i);n&&s&&(n[s]=t)}function Nhe(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function Fhe(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=r[s],o=t[s];return n===o?r:n===void 0?(r[s]=re(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=Fhe(n,o,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=o),r)},e||{}):e}var ghe;const Fi={apiKey:void 0,applicationUrl:(ghe=globalThis.location)==null?void 0:ghe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Dhe(Fi,globalThis.esriConfig,!0),delete Fi.has),!Fi.assetsPath){const e="4.24.5";Fi.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}Fi.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(Fi,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),Fi.request.corsEnabledServers=[],Fi.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const TRe=/\{([^\}]+)\}/g;function EK(e){return e==null?"":e}function qf(e,t){return e.replace(TRe,typeof t=="object"?(i,r)=>EK(kE(r,t)):(i,r)=>EK(t(r)))}function khe(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function vW(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function bTt(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const CK={info:0,warn:1,error:2,none:3};class fe{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,fe._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=fe.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=fe._loggers;return fe._loggers=t,i},set throttlingDisabled(t){fe._throttlingDisabled=t}}}static getLogger(t){let i=fe._loggers[t];return i||(i=new fe({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!fe._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=fe._tickCounter)return;this._loggedMessages[t].set(s,fe._tickCounter),fe._scheduleTickCounterIncrement()}for(const s of Fi.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;_(r);){const s=r[t];if(_(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=Fi.log.level?Fi.log.level:"warn";return CK[this._parentWithMember("level",i)]<=CK[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return vW(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){fe._tickCounterScheduled||(fe._tickCounterScheduled=!0,Promise.resolve().then(()=>{fe._tickCounter++,fe._tickCounterScheduled=!1}))}}fe._loggers={},fe._tickCounter=0,fe._tickCounterScheduled=!1,fe._throttlingDisabled=!1;function sn(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function wTt(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function _W(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const YS=fe.getLogger("esri.core.Accessor");function SRe(e){return e==null?e:new Date(e)}function ERe(e){return e==null?e:!!e}function x3(e){return e==null?e:e.toString()}function Mh(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function bW(e){return e==null?e:Math.round(parseFloat(e))}function Uhe(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function WN(e,t){return t!=null&&e&&!(t instanceof e)}function zhe(e){return e&&"isCollection"in e}function AK(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function CRe(e,t){if(!t||!t.constructor||!zhe(t.constructor))return Y8(e,t)?t:new e(t);const i=AK(e.prototype.itemType),r=AK(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(Y8(e,t),t):new e(t):t}function Y8(e,t){return!!Uhe(t)&&(YS.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+R5(e)+"'"),!0)}function A2(e,t){return t==null?t:zhe(e)?CRe(e,t):WN(e,t)?Y8(e,t)?t:new e(t):t}function R5(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const ARe=new WeakMap;function RRe(e){switch(e){case Number:return Mh;case Br:return bW;case Boolean:return ERe;case String:return x3;case Date:return SRe;default:return _W(ARe,e,()=>A2.bind(null,e))}}function Bs(e,t){const i=RRe(e);return arguments.length===1?i:i(t)}function HM(e,t,i){return arguments.length===1?HM.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function MRe(e,t){return arguments.length===1?HM(Bs.bind(null,e)):HM(Bs.bind(null,e),t)}function Vhe(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>Vhe(e,t-1,r)):e(i)}function XN(e,t,i){if(arguments.length===2)return XN.bind(null,e,t);if(!i)return i;let r=t,s=i=Vhe(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function ORe(e,t,i){return arguments.length===2?XN(Bs.bind(null,e),t):XN(Bs.bind(null,e),t,i)}function Bhe(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function Q8(e,t){if(arguments.length===2)return Q8(e).call(null,t);const i=new Set,r=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!WN(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),YS.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>R5(p)).join(", ")),YS.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):YS.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function wp(e,t){if(arguments.length===2)return wp(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];i[l]=Bs(c),r.push(R5(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!WN(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=i[c];if(!h)return YS.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!WN(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!Uhe(l)){const p={};for(const f in l)f!==e.key&&(p[f]=l[f]);return h(p)}return h(l)}}class Br{}const xTt={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function PRe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function Ghe(e){switch(e.type){case"native":return Bs(e.value);case"array":return HM(Ghe(e.value));case"one-of":return IRe(e);default:return null}}function IRe(e){let t=null;return(i,r)=>K8(i,e)?i:(t==null&&(t=J8(e)),YS.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function J8(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Br:return"integer";case Date:return"date";default:return R5(e.value)}case"array":return`array of ${J8(e.value)}`;case"one-of":{const t=e.values.map(i=>J8(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function K8(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case Br:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!K8(i,t.value));case"one-of":return t.values.some(i=>K8(e,i))}}function $Re(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=kE(r,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class M5{constructor(t,i,r){this.name=t,this.details=r,this.message=void 0,this instanceof M5&&(this.message=i&&$Re(i,r)||"")}toString(){return"["+this.name+"]: "+this.message}}class ja extends M5{constructor(t,i,r){if(super(t,i,r),!(this instanceof ja))return new ja(t,i,r)}}ja.prototype.type="warning";function R2(e){return qh(()=>e.forEach(t=>_(t)&&t.remove()))}function qh(e){return{remove:()=>{e&&(e(),e=void 0)}}}function TTt(e){return qh(_(e)?()=>e.destroy():void 0)}function LRe(e,t){const i=setTimeout(e,t);return qh(()=>clearTimeout(i))}function ua(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function DRe(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function zL(e,t,i){return i?ZN(e,t,{policy:i,path:""}):ZN(e,t,null)}function ZN(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace")return r[s]=t[s],r;if(r[s]===void 0)return r[s]=re(t[s]),r;let a=r[s],l=t[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=ZN(a,l,i),i.path=c}else r[s]=ZN(a,l,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=l);return r},e||{}):e}function jhe(e){return Array.isArray(e)?e:e.split(".")}function RK(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function NRe(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...RK(i));return t}return RK(e)}function Hhe(e,t,i,r){const s=NRe(t);if(s.length!==1){const n=s.map(o=>r(e,o,i));return R2(n)}return r(e,s[0],i)}function wW(e){let t=!1;return()=>{t||(t=!0,e())}}class MK{constructor(t){this.autoDestroy=!1,this.properties=t}}function T3(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const r=Object.create(t.properties),s=t.autoDestroy;for(const n in r)r[n]=re(r[n]);t=new MK(r),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new MK({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function FRe(e){return T3(e).properties}function S3(e,t){const i=FRe(e);let r=i[t];return r||(r=i[t]={}),r}function kRe(e,t){return zL(e,t,zRe)}const URe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function zRe(e){return URe.test(e)?"replace":"merge"}function qhe(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const e9=fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function OK(e,t,i){var r,s;e&&(!i&&!t.read||((r=t.read)==null?void 0:r.reader)||((s=t.read)==null?void 0:s.enabled)===!1||GRe(e)&&Sc("read.reader",UE(e),t))}function UE(e){var i,r,s;const t=(i=e.ndimArray)!=null?i:0;if(t>1)return BRe(e);if(t===1)return PK(e);if("type"in e&&Xhe(e.type)){const n=(s=(r=e.type.prototype)==null?void 0:r.itemType)==null?void 0:s.Type,o=PK(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return xW(e)}function xW(e){return"type"in e?VRe(e.type):jRe(e.types)}function VRe(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void e9.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function Whe(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>Whe(e,s,i,r-1)):e(t,void 0,i)}function BRe(e){var s;const t=xW(e),i=Whe.bind(null,t),r=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=i(n,a,r);let l=r,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function PK(e){const t=xW(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function Xhe(e){if(!qhe(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?TW(t.Type):Zhe(t.Type))}function GRe(e){return"types"in e?Zhe(e.types):TW(e.type)}function TW(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||Xhe(e))}function Zhe(e){for(const t in e.typeMap)if(!TW(e.typeMap[t]))return!1;return!0}function jRe(e){var r;let t=null;const i=(r=e.errorContext)!=null?r:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void e9.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=HRe(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const f=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new ja(`${i}:unsupported`,f,{definition:s,context:o})),void e9.error(f)}const p=new h;return p.read(s,o),p}}function HRe(e){var i,r;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=T3(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;((i=a.json)==null?void 0:i.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function Yhe(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=ua(t);return DRe(r,i)?r.get(i):t[i]}function Qhe(e,t,i){if(e==null)return e;const r=Yhe(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:Qhe(r,t,i+1)}function E3(e,t,i=0){return typeof t!="string"||t.includes(".")?Qhe(e,jhe(t),i):Yhe(t,e)}function YN(e,t){return E3(e,t)}function IK(e,t){return E3(t,e)!==void 0}class j extends M5{constructor(t,i,r){if(super(t,i,r),!(this instanceof j))return new j(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return re(i)}catch{return"[object]"}}))}}catch(t){throw fe.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new j(t.name,t.message,t.details)}}j.prototype.type="error";function QN(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))QN(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void QN(YN(e,s),n,i)}const r=e.__accessor__;r!=null&&qRe(t,r),e[t]=i}}function qRe(e,t){if(he("esri-unknown-property-errors")&&!WRe(e,t))throw new j("set:unknown-property",XRe(e,t))}function WRe(e,t){return t.metadatas[e]!=null}function XRe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}fe.getLogger("esri.core.accessorSupport.set");function d(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=S3(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&fe.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=YN(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const f=YN(this,h);f&&(p=p.bind(f))}return p},s.readOnly||(s.set=c?function(p){p!==void 0?this._override(i,p):this._clearOverride(i)}:function(p){QN(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=ZRe(o):a&&(Array.isArray(a)?s.cast=HM(wp(a[0])):s.cast=wp(a))),e.range&&(s.cast=YRe(s.cast,e.range)),kRe(s,e)}}function SW(e,t,i){const r=S3(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function ZRe(e){let t=0,i=e;if(PRe(e))return Ghe(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(Bhe(r))return t===0?Q8(r):XN(Q8(r),t);if(t===1)return MRe(r);if(t>1)return ORe(r,t);const s=e;return s.from?s.from:Bs(s)}function YRe(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}class wi{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=i,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&Sc(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const i=this.apiToJSON[t];return this.options.useNumericKeys?+i:i}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function fa(){return function(e,t){return new wi(e,F({ignoreUnknown:!0},t))}}function at(e,t={}){var s;const i=e instanceof wi?e:new wi(e,t),r={type:((s=t==null?void 0:t.ignoreUnknown)!=null?s:1)?i.apiValues:String,json:{type:i.jsonValues,read:!(t==null?void 0:t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(r.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(r.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(r.json.name=t.name),d(r)}function Ie(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=SW(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}var Pf;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(Pf||(Pf={}));var _r;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(_r||(_r={}));let JN,IA=[];const QRe=fe.getLogger("esri.core.Accessor");function ei(e){JN!==void 0&&JN.onObservableAccessed(e)}let VL=!1,BL=!1;function Zg(e,t,i){if(VL)return EW(e,t,i);Jhe(e);const r=t.call(i);return Khe(),r}function JRe(e,t){return Zg(void 0,e,t)}function EW(e,t,i){const r=VL;VL=!0,Jhe(e);let s=null;try{s=t.call(i)}catch(n){BL&&QRe.error(n)}return Khe(),VL=r,s}function Jhe(e){JN=e,IA.push(e)}function Khe(){const e=IA.pop();JN=IA.length>0?IA[IA.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function ede(e,t){if(t.flags&_r.DepTrackingInitialized)return;const i=BL;BL=!1,t.flags&_r.AutoTracked?EW(t,t.metadata.get,e):tde(e,t),BL=i}const KRe=[];function tde(e,t){t.flags&_r.ExplicitlyTracking||(t.flags|=_r.ExplicitlyTracking,EW(t,()=>{const i=t.metadata.dependsOn||KRe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=jhe(r);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=$K(o,s[n],n!==s.length-1)}else $K(e,r,!1)}),t.flags&=~_r.ExplicitlyTracking)}function $K(e,t,i){var n;const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=ua(e))==null?void 0:n.properties.get(r);return s&&(ei(s),ede(e,s)),i?e[r]:void 0}function eMe(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}function tMe(e){if(e.json||(e.json={}),DK(e.json),NK(e.json),LK(e.json),e.json.origins)for(const t in e.json.origins)DK(e.json.origins[t]),NK(e.json.origins[t]),LK(e.json.origins[t]);return!0}function LK(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function DK(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function NK(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const iMe=fe.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function FK(e,t){var r;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const i=(r=e==null?void 0:e.ndimArray)!=null?r:0;e&&(i===1||"type"in e&&qhe(e.type))?t.write.writer=nMe:i>1?t.write.writer=oMe(i):t.types?Array.isArray(t.types)?t.write.writer=sMe(t.types[0]):t.write.writer=rMe(t.types):t.write.writer=qM}function rMe(e){return(t,i,r,s)=>t?ide(t,e,s)?qM(t,i,r,s):void 0:qM(t,i,r,s)}function ide(e,t,i){var r,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i==null?void 0:i.messages){const n=(r=t.errorContext)!=null?r:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new j(`${n}:unsupported`,o,{definition:e,context:i})),iMe.error(o)}return!1}function sMe(e){return(t,i,r,s)=>!t||!Array.isArray(t)?qM(t,i,r,s):qM(t.filter(n=>ide(n,e,s)),i,r,s)}function qM(e,t,i,r){Sc(i,KN(e,r),t)}function KN(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?eF(e):e}function eF(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function nMe(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>KN(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[KN(e,r)],Sc(i,s,t)}function rde(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>rde(r,t,i-1)):KN(e,t)}function oMe(e){return(t,i,r,s)=>{let n;if(t===null)n=null;else{n=rde(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}Sc(r,n,i)}}function t9(e,t){return CW(e,"read",t)}function sde(e,t){return CW(e,"write",t)}function CW(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function aMe(e){const t=lMe(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?cMe(r):t;OK(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write=F({},e.json.write)),FK(s,r)}OK(t,e.json,!0),FK(t,e.json)}function lMe(e){return e.json.types?i9(e.json):e.type?nde(e):i9(e)}function cMe(e){return e.type?nde(e):i9(e)}function nde(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!Bhe(i);)i=i[0],t++;return{type:i,ndimArray:t}}function i9(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function uMe(e){tMe(e)&&(eMe(e),aMe(e))}const Vz=new Set,Bz=new Set;function P(e){return t=>{t.prototype.declaredClass=e,dMe(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!Vz.has(s.initialize)&&(Vz.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!Bz.has(s.destroy)&&(Bz.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);Vz.clear(),Bz.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<r.length;c++)r[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=T3(t.prototype),n.prototype.declaredClass=e,n}}function hMe(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;ei(i);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function dMe(e){const t=e.prototype,i=T3(t).properties,r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];uMe(n),r[s]={enumerable:!0,configurable:!0,get:hMe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===Pf.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,r)}function qe(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=SW(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var M2;function pMe(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return M2.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return M2.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(M2||(M2={}));function STt(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function ETt(e,t){for(const i of e)if(i!=null&&t(i))return i}function ode(e){return e!=null&&typeof e[Symbol.iterator]=="function"}function fMe(e){return e&&e.release&&typeof e.release=="function"}function mMe(e){return e&&e.acquire&&typeof e.acquire=="function"}class Cs{constructor(t,i,r,s=1,n=0){if(this.ctor=t,this.acquireFunction=i,this.releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let o=0;o<n;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(Cs.test.disabled)i=new this.ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this.ctor}i=this._pool.pop()}return this.acquireFunction?this.acquireFunction(i,...t):mMe(i)&&i.acquire(...t),i}release(t){t&&!Cs.test.disabled&&(this.releaseFunction?this.releaseFunction(t):fMe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}Cs.test={disabled:!1};var Vt;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(Vt||(Vt={}));const r9=Vt.USER+1;function Ag(e){switch(e){case"defaults":return Vt.DEFAULTS;case"service":return Vt.SERVICE;case"portal-item":return Vt.PORTAL_ITEM;case"web-scene":return Vt.WEB_SCENE;case"web-map":return Vt.WEB_MAP;case"user":return Vt.USER}}function tF(e){switch(e){case Vt.DEFAULTS:return"defaults";case Vt.SERVICE:return"service";case Vt.PORTAL_ITEM:return"portal-item";case Vt.WEB_SCENE:return"web-scene";case Vt.WEB_MAP:return"web-map";case Vt.USER:return"user"}return void 0}function gMe(e){return tF(e)}class ade{constructor(t,i){this._observers=t,this._observer=i}remove(){mW(this._observers,this._observer)}}class kK{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=_r.Dirty|(r.nonNullable?_r.NonNullable:0)|(r.hasOwnProperty("value")?_r.HasDefaultValue:0)|(r.get===void 0?_r.DepTrackingInitialized:0)|(r.dependsOn===void 0?_r.AutoTracked:0)}destroy(){if(this.flags&_r.Dirty&&this._observers){const t=this._observers.slice();for(const i of t)i.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){ei(this);const t=this.properties.store,i=this.propertyName,r=this.flags,s=t.get(i);if(r&_r.Computing||~r&_r.Dirty&&t.has(i))return s;this.flags|=_r.Computing;const n=this.properties.host;let o;r&_r.AutoTracked?o=Zg(this,this.metadata.get,n):(tde(n,this),o=this.metadata.get.call(n)),t.set(i,o,Vt.COMPUTED);const a=t.get(i);return a===s?this.flags&=~_r.Dirty:JRe(this.commit,this),this.flags&=~_r.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=_r.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new ade(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&_r.Overriden&&(this.flags|=_r.Dirty);const t=this._observers;if(t!==null)for(let i=0;i<t.length;++i)t[i].onInvalidated()}commit(){this.flags&=~_r.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let i=0;i<t.length;++i)t[i].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class AW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new AW;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,re(r))}),i}get(t){return this._values.get(t)}originOf(){return Vt.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function kP(e,t,i){return e!==void 0}function UK(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&_r.NonNullable)||(r.lifecycle,Pf.INITIALIZING,!1))}function yMe(e){return e&&typeof e.destroy=="function"}fe.getLogger("esri.core.accessorSupport.Properties");class vMe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Pf.INITIALIZING,this.store=new AW,this._origin=Vt.USER;const i=this.host.constructor.__accessorMetadata__,r=i.properties;for(const s in r){const n=new kK(this,s,r[s]);this.properties.set(s,n)}this.metadatas=r,this._autoDestroy=i.autoDestroy}initialize(){this.lifecycle=Pf.CONSTRUCTING}constructed(){this.lifecycle=Pf.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,i]of this.properties){const r=this.internalGet(t);r&&yMe(r)&&(r.destroy(),~i.flags&_r.NonNullable&&this._internalSet(i,null)),i.destroy()}else for(const[t,i]of this.properties)i.destroy()}get initialized(){return this.lifecycle!==Pf.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();ei(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.flags&_r.HasDefaultValue)return"defaults"}return tF(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(kP(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);kP(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!kP(s))return"";const n=new Set,o=Zg({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${r}${t.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof kK))continue;const c=l.properties.host,h=l.propertyName,p=ua(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(t,i,r){const s=this.properties.get(t);if(kP(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.flags&_r.Overriden)}clearOverride(t){const i=this.properties.get(t);i!==void 0&&i.flags&_r.Overriden&&(i.flags&=~_r.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!UK(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(Gz.release(n),!o)return;i=a}r.flags|=_r.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!UK(r,t,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(Gz.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=Ag(t)}getDefaultOrigin(){return tF(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==Pf.INITIALIZING?this._origin:Vt.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&yW(i,s.get(n))&&~t.flags&_r.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),ede(this.host,t))}_cast(t,i){const r=Gz.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class _Me{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const Gz=new Cs(_Me);function bMe(e){e.length=0}class uc{constructor(t=50,i=50){this._pool=new Cs(Array,void 0,bMe,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return jz.acquire()}static release(t){return jz.release(t)}static prune(){jz.prune()}}const jz=new uc(100);class lde extends Cs{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=aRe(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const UP=[];function O2(e){UP.push(e),UP.length===1&&queueMicrotask(()=>{const t=UP.slice();UP.length=0;for(const i of t)i()})}const wMe=29;class Iv{constructor(t,i=wMe){this.name=t,this._counter=0,this._items=new Array(i)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,i)=>t-i)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,i)=>t+i,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var s9;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,f=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const m=n[h-1];if(l(m,f)<=0)break;n[c-1]=m,c=h}n[c-1]=f},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=r,e.iterableSort=s})(s9||(s9={}));const zK=s9,xMe=1.5,TMe=1.1;class Wt{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new The,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>VK(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,VK(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=Ehe(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){const i=A5(this.data,t,this.length,this._hint);return i!==void 0&&(this.length=this.length-1),this._shrink(),i}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=pRe(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){t>=this.length||i>=this.length||t===i||([this.data[t],this.data[i]]=[this.data[i],this.data[t]])}sort(t){zK.sort(this.data,0,this.length,t)}iterableSort(t){return zK.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function VK(e){e.data.length>xMe*e.length&&(e.data.length=Math.floor(e.length*TMe))}function SMe(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const O5=SMe(globalThis),BK=new Set;function EMe(e,t,i=!1){i&&BK.has(t)||(i&&BK.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function CMe(e,t,i={}){if(he("esri-deprecation-warnings")){const{moduleName:r}=i;cde(e,`Property: ${(r?r+"::":"")+t}`,i)}}function cde(e,t,i={}){if(he("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),EMe(e,a,o)}}function P5(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function C3(e,t,i){if(!P5(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function ude(e,t,i){if(!P5(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=C3(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}const AMe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function cb({key:e}){return AMe[e]||e}function mi(e="Aborted"){return new j("AbortError",e)}function fi(e,t="Aborted"){if(nn(e))throw mi(t)}function I5(e){return _(e)?"aborted"in e?e:e.signal:e}function nn(e){const t=I5(e);return _(t)&&t.aborted}function bc(e){if(Jr(e))throw e}function n9(e){if(!Jr(e))throw e}function ha(e,t){const i=I5(e);if(!R(i)){if(!i.aborted)return ude(i,"abort",()=>t());t()}}function RW(e,t){const i=I5(e);if(!R(i))return fi(i),ude(i,"abort",()=>t(mi()))}function RMe(e,t){const i=I5(t);return R(i)?e:new Promise((r,s)=>{let n=ha(t,()=>s(mi()));const o=()=>n=cn(n);e.then(o,o),e.then(r,s)})}function Jr(e){return e&&e.name==="AbortError"}async function o9(e){try{return await e}catch(t){if(!Jr(t))throw t}}async function CTt(e,t=fe.getLogger("esri")){try{return await e}catch(i){Jr(i)||t.error(i)}}function qv(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}async function gs(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(o=>e[o]),s=await gs(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function MMe(e){return(await gs(e)).filter(t=>!!t.value).map(t=>t.value)}function P2(e,t,i){const r=new AbortController;return ha(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);ha(r,()=>{o&&(clearTimeout(o),n(mi()))})})}function Vu(e){return e&&typeof e.then=="function"}function a9(e){return Vu(e)?e:Promise.resolve(e)}function $5(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(mi()),n=qv();const f=n.promise;if(o){const m=o;o=null,m.abort()}return f}if(s=n||qv(),n=null,t>0){const f=new AbortController;i=a9(e(...l,f.signal));const m=i;P2(t).then(()=>{i===m&&(n?f.abort():o=f)})}else i=1,i=a9(e(...l));const c=()=>{const f=r;r=s=i=o=null,f!=null&&a(...f)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function xp(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>O5.setTimeout(()=>r.reject(n),s),r.promise=i,r}function ATt(e,t){return e.then(t,t)}function A3(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),_(i)&&(i.remove(),i=null),r=null};return s.then(o,o),i=ha(t,()=>{_(n)&&n.abort()}),n}async function GK(e){await Promise.resolve(),fi(e)}function hde(e){return 1e3*e}function MW(e){return .001*e}class OMe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class PMe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let l9=0,c9=0;const yC={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},u9=["prepare","preRender","render","postRender","update","finish"],h9=[],cw=new Wt;class IMe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const iF={frameTasks:cw,willDispatch:!1,clearFrameTasks:$Me,dispatch:fde,executeFrameTasks:DMe};function zE(e){const t=new PMe(e);return h9.push(t),iF.willDispatch||(iF.willDispatch=!0,O2(fde)),t}function uw(e){const t=new OMe(e);return cw.push(t),rF==null&&(l9=performance.now(),rF=requestAnimationFrame(dde)),new IMe(t)}let rF=null;function $Me(e=!1){cw.forAll(t=>{t.removed=!0}),e&&pde()}function LMe(e){c9=Math.max(0,e)}function dde(){const e=performance.now();rF=null,rF=cw.length>0?requestAnimationFrame(dde):null,iF.executeFrameTasks(e)}function DMe(e){const t=e-l9;l9=e;const i=c9>0?c9:1e3/60,r=Math.max(0,t-i);for(let s=0;s<u9.length;s++){const n=performance.now(),o=u9[s];cw.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(yC.time=e,yC.deltaTime=a.ticks===0?0:t,yC.elapsedFrameTime=performance.now()-e,yC.frameDuration=i-r,(l=a.phases[o])==null||l.call(a,yC)))}),NMe[s].record(performance.now()-n)}pde(),FMe.record(performance.now()-e)}const zP=new Wt;function pde(){cw.forAll(e=>{e.removed&&zP.push(e)}),cw.removeUnorderedMany(zP.data,zP.length),zP.clear()}function fde(){for(;h9.length;){const e=h9.shift();e.isActive&&e.callback()}iF.willDispatch=!1}function RTt(e=1,t){const i=xp(),r=()=>{nn(t)?i.reject(mi()):e===0?i():(--e,O2(()=>r()))};return r(),i.promise}const NMe=u9.map(e=>new Iv(e)),FMe=new Iv("total");function GL(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}let kMe=0;const UMe=0;function Cl(){return++kMe}class L5{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed;for(let r=0;r<i.length;++r)t.push(i[r].observe(this));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}let QS=!1;const sF=[];function mde(e,t){let i=new L5(n),r=null,s=!1;function n(){if(!i||s)return;if(QS)return void vde(n);const a=r;i.clear(),QS=!0,s=!0,r=Zg(i,e),s=!1,QS=!1,t(r,a),_de()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=Zg(i,e),s=!1,{remove:o}}function gde(e,t){let i=new L5(s),r=null;function s(){t(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=Zg(i,e),r):null}return o(),{remove:n}}function yde(e){let t=new L5(r),i=!1;function r(){t&&!i&&(QS?vde(r):(t.clear(),QS=!0,i=!0,Zg(t,e),i=!1,QS=!1,_de()))}function s(){t&&(t.destroy(),t=null)}return i=!0,Zg(t,e),i=!1,{remove:s}}function vde(e){sF.includes(e)||sF.unshift(e)}function _de(){for(;sF.length;)sF.pop()()}var JR;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(JR||(JR={}));class WM{constructor(){this.uid=Cl(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(JR.Untracked,t,i,r,s,n,yW)}static acquireTracked(t,i,r,s){return this.pool.acquire(JR.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===JR.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,o,a){this.uid=Cl(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Cl(),this.removed=!0}}WM.pool=new lde(WM);const jL=new uc,Lg=new Set;let nF;function oF(e){Lg.delete(e),Lg.add(e),nF||(nF=zE(BMe))}function zMe(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function VMe(e){for(const t of Lg.values())t.target===e&&(t.removed=!0)}function BMe(){let e=10;for(;nF&&e--;){nF=null;const t=GMe(),i=jL.acquire();for(const r of t){const s=r.uid;zMe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Lg)r.removed&&(i.push(r),Lg.delete(r));for(const r of i)WM.pool.release(r);jL.release(i),jL.release(t),d9.forEach(r=>r())}}function GMe(){const e=jL.acquire();e.length=Lg.size;let t=0;for(const i of Lg)e[t]=i,++t;return Lg.clear(),e}const d9=new Set;function bde(e){return d9.add(e),{remove(){d9.delete(e)}}}function jMe(e,t,i){let r=Hhe(e,t,i,(s,n,o)=>{let a,l,c=gde(()=>E3(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=WM.acquireUntracked(h,o,p,s,n),l=a.uid),oF(a))});return{remove:wW(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,oF(a)),a=null),r=c=null})}});return r}function HMe(e,t,i){const r=Hhe(e,t,i,(s,n,o)=>{let a=!1;return mde(()=>E3(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,yW(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function qMe(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?HMe(e,t,i):jMe(e,t,i)}function WMe(e,t,i){let r,s,n=gde(e,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=WM.acquireTracked(o,t,a,i),s=r.uid),oF(r))});return{remove:wW(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,oF(r)),r=null),n=null})}}function XMe(e,t,i){let r=!1;return mde(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function ZMe(e,t,i=!1,r=_Re){return i?XMe(e,t,r):WMe(e,t,r)}function jK(e){return GL(Lg,t=>t.oldValue===e)}var wde;function YMe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const $A=Symbol("Accessor-Handles");class Se{constructor(...t){if(this[wde]=null,this.constructor===Se)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new vMe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}T3(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...f){if(n.prototype[a])return n.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=h,f}return this.inherited=h,p}:t[a]}for(const a in i){const l=YMe(i[a]);d(l)(o.prototype,a)}return P(r)(o)}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(rn(this[$A],t=>{t.forEach(i=>i.remove())}),this[$A]=null,VMe(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===Pf.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return YN(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return QN(this,t,i),this}watch(t,i,r){return qMe(this,t,i,r)}own(t){let i=this[$A];if(R(i)&&(i=this[$A]=new Set),ode(t))for(const r of t)i.add(r);else i.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,i){return this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}wde=$A;class OW{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new OW;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,re(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(r=(i=this._values.get(t))==null?void 0:i.origin)!=null?r:Vt.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===Vt.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new QMe(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===Vt.DEFAULTS?t:Vt.USER}}class QMe{constructor(t,i){this.value=t,this.origin=i}}function xde(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),Vt.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),Vt.DEFAULTS)})}function JMe(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&IK(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&IK(s,i))return!0;return!1}function KMe(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function eOe(e,t,i,r,s){let n=t9(t[i],s);KMe(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=t9(t[o],s),JMe(n,i,r)&&(e[o]=!0)}function tOe(e,t,i,r){const s=i.metadatas,n=CW(s[t],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,r):o;a!==void 0&&i.set(t,a)}const Tde={origin:"service"};function Sde(e,t,i=Tde){if(!t||typeof t!="object")return;const r=ua(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))eOe(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=t9(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?E3(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||tOe(e,o,r,i)}r.setDefaultOrigin("user")}function iOe(e,t,i,r=Tde){var n;const s=ye(F({},r),{messages:[]});i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(o):e.loadWarnings.push(o)})}const rOe=fe.getLogger("esri.core.accessorSupport.write");function sOe(e,t,i,r,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,r,n,i,s),n}function Ede(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(e,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new j("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&rOe.error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===Vt.DEFAULTS)&&nOe(e,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<Ag(n.origin))}function nOe(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,i);return Hv(o,s)}return!1}return n===s}function oOe(e,t,i,r){const s=ua(e),n=s.metadatas,o=sde(n[t],r);return!!o&&Ede(e,s,t,o,i,r)}function Cde(e,t,i){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return zL(t,e.toJSON(i));const r=ua(e),s=r.metadatas;for(const a in s){const l=sde(s[a],i);if(!Ede(e,r,a,l,void 0,i))continue;const c=e.get(a),h=sOe(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(t=zL(t,h),((o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)==null?void 0:o.length)&&Promise.all(i.resources.pendingOperations).then(()=>zL(t,h)),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:gMe(r.store.originOf(a)),newOrigin:i.origin}))}return t}const Yw=e=>{let t=class extends e{constructor(...i){super(...i);const r=ua(this),s=r.store,n=new OW;r.store=n,xde(r,s,n)}read(i,r){Sde(this,i,r)}write(i={},r){return Cde(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return aOe.call(this,i,r)}};return t=u([P("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function aOe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let ve=class extends Yw(Se){};ve=u([P("esri.core.JSONSupport")],ve);var Dh;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(Dh||(Dh={}));let g;const N={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)N[g]=0;for(g=2056;g<=2065;g++)N[g]=0;for(g=2067;g<=2135;g++)N[g]=0;for(g=2137;g<=2154;g++)N[g]=0;for(g=2161;g<=2170;g++)N[g]=0;for(g=2172;g<=2193;g++)N[g]=0;for(g=2195;g<=2198;g++)N[g]=0;for(g=2200;g<=2203;g++)N[g]=0;for(g=2205;g<=2217;g++)N[g]=0;for(g=2222;g<=2224;g++)N[g]=1;for(g=2225;g<=2250;g++)N[g]=2;for(g=2251;g<=2253;g++)N[g]=1;for(g=2257;g<=2264;g++)N[g]=2;for(g=2274;g<=2279;g++)N[g]=2;for(g=2280;g<=2282;g++)N[g]=1;for(g=2283;g<=2289;g++)N[g]=2;for(g=2290;g<=2292;g++)N[g]=0;for(g=2308;g<=2313;g++)N[g]=0;for(g=2315;g<=2491;g++)N[g]=0;for(g=2494;g<=2866;g++)N[g]=0;for(g=2867;g<=2869;g++)N[g]=1;for(g=2870;g<=2888;g++)N[g]=2;for(g=2891;g<=2895;g++)N[g]=2;for(g=2896;g<=2898;g++)N[g]=1;for(g=2902;g<=2908;g++)N[g]=2;for(g=2915;g<=2920;g++)N[g]=2;for(g=2921;g<=2923;g++)N[g]=1;for(g=2924;g<=2930;g++)N[g]=2;for(g=2931;g<=2962;g++)N[g]=0;for(g=2964;g<=2968;g++)N[g]=2;for(g=2969;g<=2973;g++)N[g]=0;for(g=2975;g<=2991;g++)N[g]=0;for(g=2995;g<=3051;g++)N[g]=0;for(g=3054;g<=3079;g++)N[g]=0;for(g=3081;g<=3088;g++)N[g]=0;for(g=3092;g<=3101;g++)N[g]=0;for(g=3106;g<=3138;g++)N[g]=0;for(g=3146;g<=3151;g++)N[g]=0;for(g=3153;g<=3166;g++)N[g]=0;for(g=3168;g<=3172;g++)N[g]=0;for(g=3174;g<=3203;g++)N[g]=0;for(g=3294;g<=3358;g++)N[g]=0;for(g=3367;g<=3403;g++)N[g]=0;for(g=3408;g<=3416;g++)N[g]=0;for(g=3417;g<=3438;g++)N[g]=2;for(g=3441;g<=3446;g++)N[g]=2;for(g=3447;g<=3450;g++)N[g]=0;for(g=3451;g<=3459;g++)N[g]=2;for(g=3460;g<=3478;g++)N[g]=0;for(g=3554;g<=3559;g++)N[g]=0;for(g=3560;g<=3570;g++)N[g]=2;for(g=3571;g<=3581;g++)N[g]=0;for(g=3594;g<=3597;g++)N[g]=0;for(g=3601;g<=3604;g++)N[g]=0;for(g=3637;g<=3639;g++)N[g]=0;for(g=3665;g<=3667;g++)N[g]=0;for(g=3693;g<=3695;g++)N[g]=0;for(g=3701;g<=3727;g++)N[g]=0;for(g=3728;g<=3739;g++)N[g]=2;for(g=3740;g<=3751;g++)N[g]=0;for(g=3753;g<=3760;g++)N[g]=2;for(g=3761;g<=3773;g++)N[g]=0;for(g=3775;g<=3777;g++)N[g]=0;for(g=3779;g<=3781;g++)N[g]=0;for(g=3783;g<=3785;g++)N[g]=0;for(g=3788;g<=3791;g++)N[g]=0;for(g=3797;g<=3802;g++)N[g]=0;for(g=3814;g<=3816;g++)N[g]=0;for(g=3825;g<=3829;g++)N[g]=0;for(g=3832;g<=3841;g++)N[g]=0;for(g=3844;g<=3852;g++)N[g]=0;for(g=3873;g<=3885;g++)N[g]=0;for(g=3890;g<=3893;g++)N[g]=0;for(g=3907;g<=3912;g++)N[g]=0;for(g=3942;g<=3950;g++)N[g]=0;for(g=3968;g<=3970;g++)N[g]=0;for(g=3973;g<=3976;g++)N[g]=0;for(g=3986;g<=3989;g++)N[g]=0;for(g=3994;g<=3997;g++)N[g]=0;for(g=4048;g<=4051;g++)N[g]=0;for(g=4056;g<=4063;g++)N[g]=0;for(g=4093;g<=4096;g++)N[g]=0;for(g=4390;g<=4398;g++)N[g]=0;for(g=4399;g<=4413;g++)N[g]=2;for(g=4418;g<=4433;g++)N[g]=2;for(g=4455;g<=4457;g++)N[g]=2;for(g=4484;g<=4489;g++)N[g]=0;for(g=4491;g<=4554;g++)N[g]=0;for(g=4568;g<=4589;g++)N[g]=0;for(g=4652;g<=4656;g++)N[g]=0;for(g=4766;g<=4800;g++)N[g]=0;for(g=5014;g<=5016;g++)N[g]=0;for(g=5069;g<=5072;g++)N[g]=0;for(g=5105;g<=5130;g++)N[g]=0;for(g=5173;g<=5188;g++)N[g]=0;for(g=5253;g<=5259;g++)N[g]=0;for(g=5269;g<=5275;g++)N[g]=0;for(g=5292;g<=5311;g++)N[g]=0;for(g=5329;g<=5331;g++)N[g]=0;for(g=5343;g<=5349;g++)N[g]=0;for(g=5355;g<=5357;g++)N[g]=0;for(g=5387;g<=5389;g++)N[g]=0;for(g=5459;g<=5463;g++)N[g]=0;for(g=5479;g<=5482;g++)N[g]=0;for(g=5518;g<=5520;g++)N[g]=0;for(g=5530;g<=5539;g++)N[g]=0;for(g=5550;g<=5552;g++)N[g]=0;for(g=5562;g<=5583;g++)N[g]=0;for(g=5623;g<=5625;g++)N[g]=2;for(g=5631;g<=5639;g++)N[g]=0;for(g=5649;g<=5653;g++)N[g]=0;for(g=5663;g<=5680;g++)N[g]=0;for(g=5682;g<=5685;g++)N[g]=0;for(g=5875;g<=5877;g++)N[g]=0;for(g=5896;g<=5899;g++)N[g]=0;for(g=5921;g<=5940;g++)N[g]=0;for(g=6050;g<=6125;g++)N[g]=0;for(g=6244;g<=6275;g++)N[g]=0;for(g=6328;g<=6348;g++)N[g]=0;for(g=6350;g<=6356;g++)N[g]=0;for(g=6366;g<=6372;g++)N[g]=0;for(g=6381;g<=6387;g++)N[g]=0;for(g=6393;g<=6404;g++)N[g]=0;for(g=6480;g<=6483;g++)N[g]=0;for(g=6511;g<=6514;g++)N[g]=0;for(g=6579;g<=6581;g++)N[g]=0;for(g=6619;g<=6624;g++)N[g]=0;for(g=6625;g<=6627;g++)N[g]=2;for(g=6628;g<=6632;g++)N[g]=0;for(g=6634;g<=6637;g++)N[g]=0;for(g=6669;g<=6692;g++)N[g]=0;for(g=6707;g<=6709;g++)N[g]=0;for(g=6720;g<=6723;g++)N[g]=0;for(g=6732;g<=6738;g++)N[g]=0;for(g=6931;g<=6933;g++)N[g]=0;for(g=6956;g<=6959;g++)N[g]=0;for(g=7005;g<=7007;g++)N[g]=0;for(g=7057;g<=7070;g++)N[g]=2;for(g=7074;g<=7082;g++)N[g]=0;for(g=7109;g<=7118;g++)N[g]=0;for(g=7119;g<=7127;g++)N[g]=1;for(g=7374;g<=7376;g++)N[g]=0;for(g=7528;g<=7586;g++)N[g]=0;for(g=7587;g<=7645;g++)N[g]=2;for(g=7692;g<=7696;g++)N[g]=0;for(g=7755;g<=7787;g++)N[g]=0;for(g=7791;g<=7795;g++)N[g]=0;for(g=7799;g<=7801;g++)N[g]=0;for(g=7803;g<=7805;g++)N[g]=0;for(g=7825;g<=7831;g++)N[g]=0;for(g=7845;g<=7859;g++)N[g]=0;for(g=8013;g<=8032;g++)N[g]=0;for(g=8065;g<=8068;g++)N[g]=1;for(g=8518;g<=8529;g++)N[g]=2;for(g=8533;g<=8536;g++)N[g]=2;for(g=8538;g<=8540;g++)N[g]=2;for(g=8677;g<=8679;g++)N[g]=0;for(g=8836;g<=8840;g++)N[g]=0;for(g=8857;g<=8859;g++)N[g]=0;for(g=8908;g<=8910;g++)N[g]=0;for(g=9154;g<=9159;g++)N[g]=0;for(g=9205;g<=9218;g++)N[g]=0;for(g=9271;g<=9273;g++)N[g]=0;for(g=9295;g<=9297;g++)N[g]=0;for(g=9356;g<=9360;g++)N[g]=0;for(g=9404;g<=9407;g++)N[g]=0;for(g=9476;g<=9482;g++)N[g]=0;for(g=9487;g<=9494;g++)N[g]=0;for(g=9697;g<=9699;g++)N[g]=0;for(g=20002;g<=20032;g++)N[g]=0;for(g=20062;g<=20092;g++)N[g]=0;for(g=20135;g<=20138;g++)N[g]=0;for(g=20248;g<=20258;g++)N[g]=0;for(g=20348;g<=20358;g++)N[g]=0;for(g=20436;g<=20440;g++)N[g]=0;for(g=20822;g<=20824;g++)N[g]=0;for(g=20904;g<=20932;g++)N[g]=0;for(g=20934;g<=20936;g++)N[g]=0;for(g=21004;g<=21032;g++)N[g]=0;for(g=21035;g<=21037;g++)N[g]=0;for(g=21095;g<=21097;g++)N[g]=0;for(g=21148;g<=21150;g++)N[g]=0;for(g=21207;g<=21264;g++)N[g]=0;for(g=21307;g<=21364;g++)N[g]=0;for(g=21413;g<=21423;g++)N[g]=0;for(g=21453;g<=21463;g++)N[g]=0;for(g=21473;g<=21483;g++)N[g]=0;for(g=21780;g<=21782;g++)N[g]=0;for(g=21891;g<=21894;g++)N[g]=0;for(g=21896;g<=21899;g++)N[g]=0;for(g=22171;g<=22177;g++)N[g]=0;for(g=22181;g<=22187;g++)N[g]=0;for(g=22191;g<=22197;g++)N[g]=0;for(g=22234;g<=22236;g++)N[g]=0;for(g=22521;g<=22525;g++)N[g]=0;for(g=22991;g<=22994;g++)N[g]=0;for(g=23028;g<=23038;g++)N[g]=0;for(g=23830;g<=23853;g++)N[g]=0;for(g=23866;g<=23872;g++)N[g]=0;for(g=23877;g<=23884;g++)N[g]=0;for(g=23886;g<=23894;g++)N[g]=0;for(g=23946;g<=23948;g++)N[g]=0;for(g=24311;g<=24313;g++)N[g]=0;for(g=24342;g<=24347;g++)N[g]=0;for(g=24370;g<=24374;g++)N[g]=10;for(g=24375;g<=24381;g++)N[g]=0;for(g=24718;g<=24721;g++)N[g]=0;for(g=24817;g<=24821;g++)N[g]=0;for(g=24877;g<=24882;g++)N[g]=0;for(g=24891;g<=24893;g++)N[g]=0;for(g=25391;g<=25395;g++)N[g]=0;for(g=25828;g<=25838;g++)N[g]=0;for(g=26191;g<=26195;g++)N[g]=0;for(g=26391;g<=26393;g++)N[g]=0;for(g=26701;g<=26722;g++)N[g]=0;for(g=26729;g<=26799;g++)N[g]=2;for(g=26801;g<=26803;g++)N[g]=2;for(g=26811;g<=26813;g++)N[g]=2;for(g=26847;g<=26870;g++)N[g]=2;for(g=26891;g<=26899;g++)N[g]=0;for(g=26901;g<=26923;g++)N[g]=0;for(g=26929;g<=26946;g++)N[g]=0;for(g=26948;g<=26998;g++)N[g]=0;for(g=27037;g<=27040;g++)N[g]=0;for(g=27205;g<=27232;g++)N[g]=0;for(g=27258;g<=27260;g++)N[g]=0;for(g=27391;g<=27398;g++)N[g]=0;for(g=27561;g<=27564;g++)N[g]=0;for(g=27571;g<=27574;g++)N[g]=0;for(g=27581;g<=27584;g++)N[g]=0;for(g=27591;g<=27594;g++)N[g]=0;for(g=28191;g<=28193;g++)N[g]=0;for(g=28348;g<=28358;g++)N[g]=0;for(g=28402;g<=28432;g++)N[g]=0;for(g=28462;g<=28492;g++)N[g]=0;for(g=29118;g<=29122;g++)N[g]=0;for(g=29168;g<=29172;g++)N[g]=0;for(g=29177;g<=29185;g++)N[g]=0;for(g=29187;g<=29195;g++)N[g]=0;for(g=29900;g<=29903;g++)N[g]=0;for(g=30161;g<=30179;g++)N[g]=0;for(g=30491;g<=30494;g++)N[g]=0;for(g=30729;g<=30732;g++)N[g]=0;for(g=31251;g<=31259;g++)N[g]=0;for(g=31265;g<=31268;g++)N[g]=0;for(g=31275;g<=31279;g++)N[g]=0;for(g=31281;g<=31297;g++)N[g]=0;for(g=31461;g<=31469;g++)N[g]=0;for(g=31491;g<=31495;g++)N[g]=0;for(g=31917;g<=31922;g++)N[g]=0;for(g=31965;g<=32e3;g++)N[g]=0;for(g=32001;g<=32003;g++)N[g]=2;for(g=32005;g<=32031;g++)N[g]=2;for(g=32033;g<=32060;g++)N[g]=2;for(g=32064;g<=32067;g++)N[g]=2;for(g=32074;g<=32077;g++)N[g]=2;for(g=32081;g<=32086;g++)N[g]=0;for(g=32107;g<=32130;g++)N[g]=0;for(g=32133;g<=32158;g++)N[g]=0;for(g=32164;g<=32167;g++)N[g]=2;for(g=32180;g<=32199;g++)N[g]=0;for(g=32201;g<=32260;g++)N[g]=0;for(g=32301;g<=32360;g++)N[g]=0;for(g=32601;g<=32662;g++)N[g]=0;for(g=32664;g<=32667;g++)N[g]=2;for(g=32701;g<=32761;g++)N[g]=0;for(g=53001;g<=53004;g++)N[g]=0;for(g=53008;g<=53019;g++)N[g]=0;for(g=53021;g<=53032;g++)N[g]=0;for(g=53034;g<=53037;g++)N[g]=0;for(g=53042;g<=53046;g++)N[g]=0;for(g=53074;g<=53080;g++)N[g]=0;for(g=54001;g<=54004;g++)N[g]=0;for(g=54008;g<=54019;g++)N[g]=0;for(g=54021;g<=54032;g++)N[g]=0;for(g=54034;g<=54037;g++)N[g]=0;for(g=54042;g<=54046;g++)N[g]=0;for(g=54048;g<=54053;g++)N[g]=0;for(g=54074;g<=54080;g++)N[g]=0;for(g=54098;g<=54101;g++)N[g]=0;for(g=102001;g<=102040;g++)N[g]=0;for(g=102042;g<=102063;g++)N[g]=0;for(g=102065;g<=102067;g++)N[g]=0;for(g=102070;g<=102117;g++)N[g]=0;for(g=102122;g<=102216;g++)N[g]=0;for(g=102221;g<=102377;g++)N[g]=0;for(g=102382;g<=102388;g++)N[g]=0;for(g=102389;g<=102398;g++)N[g]=2;for(g=102399;g<=102444;g++)N[g]=0;for(g=102445;g<=102447;g++)N[g]=2;for(g=102448;g<=102458;g++)N[g]=0;for(g=102459;g<=102468;g++)N[g]=2;for(g=102469;g<=102499;g++)N[g]=0;for(g=102500;g<=102519;g++)N[g]=1;for(g=102520;g<=102524;g++)N[g]=0;for(g=102525;g<=102529;g++)N[g]=2;for(g=102530;g<=102588;g++)N[g]=0;for(g=102590;g<=102598;g++)N[g]=0;for(g=102601;g<=102603;g++)N[g]=0;for(g=102605;g<=102628;g++)N[g]=0;for(g=102629;g<=102646;g++)N[g]=2;for(g=102648;g<=102700;g++)N[g]=2;for(g=102701;g<=102703;g++)N[g]=0;for(g=102707;g<=102730;g++)N[g]=2;for(g=102733;g<=102758;g++)N[g]=2;for(g=102767;g<=102900;g++)N[g]=0;for(g=102901;g<=102933;g++)N[g]=2;for(g=102934;g<=102950;g++)N[g]=13;for(g=102951;g<=102955;g++)N[g]=0;for(g=102961;g<=102963;g++)N[g]=0;for(g=102965;g<=102969;g++)N[g]=0;for(g=102971;g<=102973;g++)N[g]=0;for(g=102975;g<=102989;g++)N[g]=0;for(g=102990;g<=102992;g++)N[g]=1;for(g=102997;g<=103002;g++)N[g]=0;for(g=103003;g<=103008;g++)N[g]=2;for(g=103009;g<=103011;g++)N[g]=0;for(g=103012;g<=103014;g++)N[g]=2;for(g=103019;g<=103021;g++)N[g]=0;for(g=103022;g<=103024;g++)N[g]=2;for(g=103029;g<=103031;g++)N[g]=0;for(g=103032;g<=103034;g++)N[g]=2;for(g=103065;g<=103068;g++)N[g]=0;for(g=103074;g<=103076;g++)N[g]=0;for(g=103077;g<=103079;g++)N[g]=1;for(g=103080;g<=103082;g++)N[g]=0;for(g=103083;g<=103085;g++)N[g]=2;for(g=103090;g<=103093;g++)N[g]=0;for(g=103097;g<=103099;g++)N[g]=0;for(g=103100;g<=103102;g++)N[g]=2;for(g=103107;g<=103109;g++)N[g]=0;for(g=103110;g<=103112;g++)N[g]=2;for(g=103113;g<=103116;g++)N[g]=0;for(g=103117;g<=103120;g++)N[g]=2;for(g=103153;g<=103157;g++)N[g]=0;for(g=103158;g<=103162;g++)N[g]=2;for(g=103163;g<=103165;g++)N[g]=0;for(g=103166;g<=103168;g++)N[g]=1;for(g=103169;g<=103171;g++)N[g]=2;for(g=103186;g<=103188;g++)N[g]=0;for(g=103189;g<=103191;g++)N[g]=2;for(g=103192;g<=103195;g++)N[g]=0;for(g=103196;g<=103199;g++)N[g]=2;for(g=103200;g<=103224;g++)N[g]=0;for(g=103225;g<=103227;g++)N[g]=1;for(g=103232;g<=103237;g++)N[g]=0;for(g=103238;g<=103243;g++)N[g]=2;for(g=103244;g<=103246;g++)N[g]=0;for(g=103247;g<=103249;g++)N[g]=2;for(g=103254;g<=103256;g++)N[g]=0;for(g=103257;g<=103259;g++)N[g]=2;for(g=103264;g<=103266;g++)N[g]=0;for(g=103267;g<=103269;g++)N[g]=2;for(g=103300;g<=103375;g++)N[g]=0;for(g=103381;g<=103383;g++)N[g]=0;for(g=103384;g<=103386;g++)N[g]=1;for(g=103387;g<=103389;g++)N[g]=0;for(g=103390;g<=103392;g++)N[g]=2;for(g=103397;g<=103399;g++)N[g]=0;for(g=103400;g<=103471;g++)N[g]=2;for(g=103476;g<=103478;g++)N[g]=0;for(g=103479;g<=103481;g++)N[g]=2;for(g=103486;g<=103488;g++)N[g]=0;for(g=103489;g<=103491;g++)N[g]=2;for(g=103492;g<=103495;g++)N[g]=0;for(g=103496;g<=103499;g++)N[g]=2;for(g=103528;g<=103543;g++)N[g]=0;for(g=103544;g<=103548;g++)N[g]=2;for(g=103549;g<=103551;g++)N[g]=0;for(g=103552;g<=103554;g++)N[g]=1;for(g=103555;g<=103557;g++)N[g]=2;for(g=103558;g<=103560;g++)N[g]=0;for(g=103571;g<=103573;g++)N[g]=0;for(g=103574;g<=103576;g++)N[g]=2;for(g=103577;g<=103580;g++)N[g]=0;for(g=103581;g<=103583;g++)N[g]=2;for(g=103595;g<=103694;g++)N[g]=0;for(g=103696;g<=103699;g++)N[g]=0;for(g=103700;g<=103793;g++)N[g]=2;for(g=103794;g<=103887;g++)N[g]=0;for(g=103900;g<=103971;g++)N[g]=2;const lOe={102113:!0,102100:!0,3857:!0,3785:!0},cOe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},HK='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',VP=[-20037508342788905e-9,20037508342788905e-9],BP=[-20037508342787e-6,20037508342787e-6],Ade={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:VP,origin:BP,dx:1e-5},102100:{wkTemplate:HK,valid:VP,origin:BP,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:VP,origin:BP,dx:1e-5},3857:{wkTemplate:HK,valid:VP,origin:BP,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function Mc(e,t){return!R(e)&&!R(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||hw(e)&&hw(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function $v(e){return Pl(e)&&e.wkid&&Ade[e.wkid]||null}function Rde(e){return!!Pl(e)&&(e.wkid?N[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function XM(e){return!(lm(e)||cm(e))}function ZM(e){return Pl(e)&&e.wkid===4326}function Mde(e){return Pl(e)&&e.wkid===Dh.CGCS2000}function hw(e){return Pl(e)&&e.wkid!=null&&lOe[e.wkid]===!0}function YM(e){return Pl(e)&&e.wkid===32662}function PW(e){return e===Dh.GCSMARS2000||e===Dh.GCSMARS2000_SPHERE}function lm(e){return Pl(e)&&e.wkid!=null&&PW(e.wkid)}function IW(e){return e===Dh.GCSMOON2000}function cm(e){return Pl(e)&&e.wkid!=null&&IW(e.wkid)}function uOe(e){return Pl(e)&&e.wkid!=null&&cOe[e.wkid]===!0}function Pl(e){return _(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const hOe={wkid:4326,wkt:qf(Ade[4326].wkTemplate,{Central_Meridian:"0.0"})},dOe={wkid:102100,latestWkid:3857},pOe={wkid:32662};var Qp;let Er=Qp=class extends ve{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return Qp.WebMercator;if(e.wkid===4326)return Qp.WGS84}const t=new Qp;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return ZM(this)}get isWebMercator(){return hw(this)}get isGeographic(){return Rde(this)}get isWrappable(){return uOe(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===Qp.WGS84)return Qp.WGS84;if(this===Qp.WebMercator)return Qp.WebMercator;const e=new Qp;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=re(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return Mc(this,e)}toJSON(e){return this.write(void 0,e)}};Er.GCS_NAD_1927=null,Er.WGS84=null,Er.WebMercator=null,Er.PlateCarree=null,u([d({readOnly:!0})],Er.prototype,"isWGS84",null),u([d({readOnly:!0})],Er.prototype,"isWebMercator",null),u([d({readOnly:!0})],Er.prototype,"isGeographic",null),u([d({readOnly:!0})],Er.prototype,"isWrappable",null),u([d({type:Br,json:{write:!0}})],Er.prototype,"latestWkid",void 0),u([d({type:Br,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Er.prototype,"wkid",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Er.prototype,"wkt",void 0),u([qe("wkt"),qe("web-scene","wkt")],Er.prototype,"writeWkt",null),u([d({type:Br,json:{write:!0}})],Er.prototype,"vcsWkid",void 0),u([d({type:Br,json:{write:!0}})],Er.prototype,"latestVcsWkid",void 0),u([d()],Er.prototype,"imageCoordinateSystem",void 0),Er=Qp=u([P("esri.geometry.SpatialReference")],Er),Er.prototype.toJSON.isDefaultToJSON=!0,Er.GCS_NAD_1927=new Er({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Er.WGS84=new Er(hOe),Er.WebMercator=new Er(dOe),Er.PlateCarree=new Er(pOe),Object.freeze&&(Object.freeze(Er.GCS_NAD_1927),Object.freeze(Er.WGS84),Object.freeze(Er.WebMercator));const et=Er;let Jp=class extends ve{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=et.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof et)return e;if(e!=null){const i=new et;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([d()],Jp.prototype,"type",void 0),u([d({readOnly:!0})],Jp.prototype,"cache",null),u([d({readOnly:!0})],Jp.prototype,"extent",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Jp.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Jp.prototype,"hasZ",void 0),u([d({type:et,json:{write:!0}})],Jp.prototype,"spatialReference",void 0),u([Ie("spatialReference")],Jp.prototype,"readSpatialReference",null),Jp=u([P("esri.geometry.Geometry")],Jp);const Ec=Jp,fOe=Object.prototype.toString;function mOe(e){const t="__accessorMetadata__"in e?Bs(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return gOe.apply(this,i)}}function gOe(e,t,i,r){S3(e,t).cast=r}function yOe(e){return(t,i)=>{S3(t,e).cast=t[i]}}function qt(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&fOe.call(e[0])==="[object Function]"?mOe(e[0]):e.length===1&&typeof e[0]=="string"?yOe(e[0]):void 0}function vOe(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,r!=null&&(e.z=((s=e.z)!=null?s:0)+r),e}function _Oe(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}class $W{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Pi=new $W(6378137,1/298.257223563,3e5,.006694379990137799),Uf=new $W(3396190,1/169.8944472236118,23e4),Yg=new $W(1737400,0,0),bOe=57.29577951308232,wOe=.017453292519943;function qK(e){return e*bOe}function WK(e){return e*wOe}function XK(e){return e/Pi.radius}function aF(e){return Math.PI/2-2*Math.atan(Math.exp(-e/Pi.radius))}function p9(e){return e.wkid!=null||e.wkt!=null}const Hz=[0,0];function lF(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,Hz,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,Hz,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,Hz,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(t(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Lv(e,t){const i=e&&(p9(e)?e:e.spatialReference),r=t&&(p9(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!Mc(r,i)||hw(r)&&ZM(i)||hw(i)&&ZM(r))}function Qw(e,t){if(R(e))return null;const i=e.spatialReference,r=t&&(p9(t)?t:t.spatialReference);return Lv(i,r)?Mc(i,r)?re(e):hw(r)?lF(e,xS,et.WebMercator,!1,re(e)):ZM(r)?lF(e,KR,et.WGS84,!1,re(e)):null:null}function xS(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=WK(t);return i[0]=WK(e)*Pi.radius,i[1]=Pi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function KR(e,t,i=[0,0],r=!1){const s=qK(e/Pi.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=qK(Math.PI/2-2*Math.atan(Math.exp(-t/Pi.radius))),i}function Dg(e,t=!1,i=re(e)){return lF(e,xS,et.WebMercator,t,i)}function LA(e,t=!1,i=re(e)){return lF(e,KR,et.WGS84,t,i)}var HL;const vC=[0,0];function ZK(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const GP=fe.getLogger("esri.geometry.Point");let nl=HL=class extends Ec{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new et(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)GP.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)GP.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=xS(n.longitude,n.latitude,vC);e=a[0],t=a[1]}}}else ZK(i)?(s=i,i=null):ZK(r)&&(s=r,r=null);const o={x:e,y:t};return o.x==null&&o.y!=null?GP.warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&GP.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return KR(t,i,vC)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",xS(i,e,vC)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return KR(e,t,vC)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",xS(e,t,vC)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new HL;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return HL.copy(e,this),this}equals(e){if(R(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=xS(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=KR(l,c),h=n}return t===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(e,t,i){return vOe(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=$v(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return _Oe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],nl.prototype,"cache",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],nl.prototype,"hasM",null),u([d({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],nl.prototype,"hasZ",null),u([d({type:Number})],nl.prototype,"latitude",null),u([d({type:Number})],nl.prototype,"longitude",null),u([d({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),qt(e=>isNaN(e)?e:Mh(e))],nl.prototype,"x",void 0),u([qe("x")],nl.prototype,"writeX",null),u([Ie("x")],nl.prototype,"readX",null),u([d({type:Number,json:{write:!0}})],nl.prototype,"y",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],nl.prototype,"z",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],nl.prototype,"m",void 0),nl=HL=u([P("esri.geometry.Point")],nl),nl.prototype.toJSON.isDefaultToJSON=!0;const ot=nl,qz=[0,0];function LW(e,t){return!!_(t)&&La(e,t.x,t.y,t.z)}function MTt(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!I2(e,i))return!1;return!0}function xOe(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?La(e,i,r,s)&&La(e,i,o,s)&&La(e,n,o,s)&&La(e,n,r,s)&&La(e,i,r,a)&&La(e,i,o,a)&&La(e,n,o,a)&&La(e,n,r,a):La(e,i,r)&&La(e,i,o)&&La(e,n,o)&&La(e,n,r)}function I2(e,t){return La(e,t[0],t[1])}function TOe(e,t){return La(e,t[0],t[1],t[2])}function La(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function SOe(e,t){return qz[1]=t.y,qz[0]=t.x,EOe(e,qz)}function EOe(e,t){return Ode(e.rings,t)}function Ode(e,t){if(!e)return!1;if(COe(e))return YK(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=YK(i,e[r],t);return i}function COe(e){return!Array.isArray(e[0][0])}function YK(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,f]=t[o];(h<s&&f>=s||f<s&&h>=s)&&c+(s-h)/(f-h)*(p-c)<r&&(n=!n)}return n}function AOe(e,t){return LW(e,t)}function ROe(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function MOe(e,t){const{points:i,hasZ:r}=t,s=r?TOe:I2;for(const n of i)if(s(e,n))return!0;return!1}const dw=[0,0],pw=[0,0],fw=[0,0],mw=[0,0],OOe=[dw,pw,fw,mw],Pde=[[fw,dw],[dw,pw],[pw,mw],[mw,fw]];function POe(e,t){return IOe(e,t.rings)}function IOe(e,t){dw[0]=e.xmin,dw[1]=e.ymax,pw[0]=e.xmax,pw[1]=e.ymax,fw[0]=e.xmin,fw[1]=e.ymin,mw[0]=e.xmax,mw[1]=e.ymin;for(const i of OOe)if(Ode(t,i))return!0;for(const i of t){if(!i.length)continue;let r=i[0];if(I2(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(I2(e,n)||Ide(r,n,Pde))return!0;r=n}}return!1}function $Oe(e,t){dw[0]=e.xmin,dw[1]=e.ymax,pw[0]=e.xmax,pw[1]=e.ymax,fw[0]=e.xmin,fw[1]=e.ymin,mw[0]=e.xmax,mw[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(I2(e,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(I2(e,o)||Ide(s,o,Pde))return!0;s=o}}return!1}const To=[0,0];function LOe(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(f9(n,o,c,h,To)&&!(To[0]===n[0]&&To[1]===n[1]||To[0]===c[0]&&To[1]===c[1]||To[0]===o[0]&&To[1]===o[1]||To[0]===h[0]&&To[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(f9(o,a,c,h,To)&&!(To[0]===o[0]&&To[1]===o[1]||To[0]===c[0]&&To[1]===c[1]||To[0]===a[0]&&To[1]===a[1]||To[0]===h[0]&&To[1]===h[1]))return!0}}}return!1}function Ide(e,t,i){for(let r=0;r<i.length;r++)if(f9(e,t,i[r][0],i[r][1]))return!0;return!1}function f9(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,h]=i,[p,f]=r,m=p-c,y=n-c,v=a-n,w=f-h,b=o-h,S=l-o,T=w*v-m*S;if(T===0)return!1;const E=(m*b-w*y)/T,C=(v*b-S*y)/T;return E>=0&&E<=1&&C>=0&&C<=1&&(s&&(s[0]=n+E*(a-n),s[1]=o+E*(l-o)),!0)}function DOe(e){switch(e){case"esriGeometryEnvelope":case"extent":return ROe;case"esriGeometryMultipoint":case"multipoint":return MOe;case"esriGeometryPoint":case"point":return AOe;case"esriGeometryPolygon":case"polygon":return POe;case"esriGeometryPolyline":case"polyline":return $Oe}}var nh;function NOe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function Ey(e,t,i){return t==null?i:i==null?t:e(t,i)}let Qn=nh=class extends Ec{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return NOe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?et.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s==null?et.WGS84:s}}static fromBounds(e,t){return new nh({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new nh({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new ot({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new nh;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Lv(t,i)&&(e=t.isWebMercator?Dg(e):LA(e,!0)),e.type==="point"?LW(this,e):e.type==="extent"&&xOe(this,e)}equals(e){if(this===e)return!0;if(R(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Lv(t,i)&&(e=t.isWebMercator?Dg(e):LA(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(R(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Lv(t,i)&&(e=t.isWebMercator?Dg(e):LA(e,!0)),DOe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Ey(Math.min,this.zmin,e.zmin),this.zmax=Ey(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Ey(Math.min,this.mmin,e.mmin),this.mmax=Ey(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:R(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Ey(Math.max,this.zmin,e.zmin),this.zmax=Ey(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Ey(Math.max,this.mmin,e.mmin),this.mmax=Ey(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=$v(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?LA(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new et(qf(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||$v(r)))return this;const s=this._getParts(i).map(a=>a.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach(a=>{a.hasZ||(n=!1),a.hasM||(o=!1)}),{rings:s.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(n){const c=(a.zmax-a.zmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}if(o){const c=(a.mmax-a.mmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}return l}),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||$v(o);const[p,f]=e.valid;h=this._normalizeX(this.xmin,e);const m=h.x,y=h.frameId;h=this._normalizeX(this.xmax,e);const v=h.x,w=h.frameId,b=m===v&&a>0;if(a>2*f){const S=new nh(l<c?m:v,s,f,n,o),T=new nh(p,s,l<c?v:m,n,o),E=new nh(0,s,f,n,o),C=new nh(p,s,0,n,o),A=[],I=[];S.contains(E)&&A.push(y),S.contains(C)&&I.push(y),T.contains(E)&&A.push(w),T.contains(C)&&I.push(w);for(let D=y+1;D<w;D++)A.push(D),I.push(D);t.push({extent:S,frameIds:[y]},{extent:T,frameIds:[w]},{extent:E,frameIds:A},{extent:C,frameIds:I})}else m>v||b?t.push({extent:new nh(m,s,f,n,o),frameIds:[y]},{extent:new nh(p,s,v,n,o),frameIds:[w]}):t.push({extent:new nh(m,s,v,n,o),frameIds:[y]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([d({readOnly:!0})],Qn.prototype,"cache",null),u([d({readOnly:!0})],Qn.prototype,"center",null),u([d({readOnly:!0})],Qn.prototype,"extent",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Qn.prototype,"hasM",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Qn.prototype,"hasZ",null),u([d({readOnly:!0})],Qn.prototype,"height",null),u([d({readOnly:!0})],Qn.prototype,"width",null),u([d({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Qn.prototype,"xmin",void 0),u([d({type:Number,json:{write:!0}})],Qn.prototype,"ymin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Qn.prototype,"mmin",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Qn.prototype,"zmin",void 0),u([d({type:Number,json:{write:!0}})],Qn.prototype,"xmax",void 0),u([d({type:Number,json:{write:!0}})],Qn.prototype,"ymax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Qn.prototype,"mmax",void 0),u([d({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Qn.prototype,"zmax",void 0),Qn=nh=u([P("esri.geometry.Extent")],Qn),Qn.prototype.toJSON.isDefaultToJSON=!0;const ai=Qn;function $2(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var m9;function QK(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function FOe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let h0=m9=class extends Ec{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):FOe(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new ai,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=QK(Math.min),a=QK(Math.max);let l,c,h,p,[f,m]=n,[y,v]=n;for(let w=0,b=e.length;w<b;w++){const S=e[w],[T,E]=S;if(f=o(f,T),m=o(m,E),y=a(y,T),v=a(v,E),i&&S.length>2){const C=S[2];l=o(l,C),h=a(h,C)}if(r&&S.length>s){const C=S[s];c=o(c,C),p=a(p,C)}}return t.xmin=f,t.ymin=m,t.xmax=y,t.ymax=v,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),r?(t.mmin=c,t.mmax=p):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=re(this.points)}addPoint(e){return $2(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:re(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new m9(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new ot(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new ot(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?($2(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([d({readOnly:!0})],h0.prototype,"cache",null),u([d()],h0.prototype,"extent",null),u([d({type:[[Number]],json:{write:{isRequired:!0}}})],h0.prototype,"points",void 0),u([qe("points")],h0.prototype,"writePoints",null),h0=m9=u([P("esri.geometry.Multipoint")],h0),h0.prototype.toJSON.isDefaultToJSON=!0;const Jw=h0;function DW(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function $de(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function kOe(e,t){return $de(e,t,.5)}function Lde(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=DW(e[r],e[r+1]);return i}function Dde(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=DW(e[s],e[s+1]);if(t-r<n){const o=(t-r)/n;return $de(e[s],e[s+1],o)}r+=n}return e[i-1]}function NW(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function OTt(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}function PTt(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function UOe(e){return e?Nde(e.rings,e.hasZ):null}function Nde(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=zOe(e[n],t,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?VOe(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function zOe(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let f=0;f<e.length;f++){const m=e[f],y=e[(f+1)%e.length],[v,w,b]=m,S=v-l,T=w-c,E=t?b-h:void 0,[C,A,I]=y,D=C-l,L=A-c,z=t?I-h:void 0,B=S*L-D*T;if(o+=B,r+=(S+D)*B,s+=(T+L)*B,t&&m.length>2&&y.length>2){const V=S*z-D*E;n+=(E+z)*V,a+=V}v<i[0]&&(i[0]=v),v>i[1]&&(i[1]=v),w<i[2]&&(i[2]=w),w>i[3]&&(i[3]=w),t&&(b<i[4]&&(i[4]=b),b>i[5]&&(i[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function VOe(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],t&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const f=DW(i,r);if(f){s+=f;const m=kOe(h,p);n+=f*m[0],o+=f*m[1],t&&m.length>2&&(a+=f*m[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function Fde(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function kde(e){return e.points!==void 0}function Ude(e){return e.x!==void 0&&e.y!==void 0}function zde(e){return e.paths!==void 0}function Vde(e){return e.rings!==void 0}function Bde(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}const fv=Bde(Math.min),mv=Bde(Math.max);function ITt(e,t){return zde(t)?L2(e,t.paths,!1,!1):Vde(t)?L2(e,t.rings,!1,!1):kde(t)?FW(e,t.points,!1,!1,!1,!1):Fde(t)?Gde(e,t):(Ude(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function $Tt(e,t){return zde(t)?L2(e,t.paths,!0,!1):Vde(t)?L2(e,t.rings,!0,!1):kde(t)?FW(e,t.points,!0,!1,!0,!1):Fde(t)?Gde(e,t,!0,!1,!0,!1):(Ude(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function L2(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,f]=t[0][0];for(let m=0;m<t.length;m++){const y=t[m];for(let v=0;v<y.length;v++){const w=y[v],[b,S]=w;if(c=fv(c,b),h=fv(h,S),p=mv(p,b),f=mv(f,S),i&&w.length>2){const T=w[2];n=fv(n,T),o=mv(o,T)}if(r&&w.length>s){const T=w[s];a=fv(n,T),l=mv(o,T)}}}return i?r?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=f,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=f,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=f,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=f,e.length=4,e)}function Gde(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,f=t.mmin,m=t.mmax;return s?(h=h||0,p=p||0,n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=h,e[3]=f,e[4]=a,e[5]=c,e[6]=p,e[7]=m,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(f=f||0,m=m||0,e[0]=o,e[1]=l,e[2]=f,e[3]=a,e[4]=c,e[5]=m,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function FW(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let c,h,p,f,[m,y]=t[0],[v,w]=t[0];for(let b=0;b<t.length;b++){const S=t[b],[T,E]=S;if(m=fv(m,T),y=fv(y,E),v=mv(v,T),w=mv(w,E),l&&S.length>2){const C=S[2];c=fv(c,C),h=mv(h,C)}if(a&&S.length>o){const C=S[o];p=fv(c,C),f=mv(h,C)}}return s?(c=c||0,h=h||0,n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=c,e[3]=p,e[4]=v,e[5]=w,e[6]=h,e[7]=f,e):(e[0]=m,e[1]=y,e[2]=c,e[3]=v,e[4]=w,e[5]=h,e)):n?(p=p||0,f=f||0,e[0]=m,e[1]=y,e[2]=p,e[3]=v,e[4]=w,e[5]=f,e):(e[0]=m,e[1]=y,e[2]=v,e[3]=w,e)}function BOe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function GOe(e){return e.points!==void 0}function jOe(e){return e.x!==void 0&&e.y!==void 0}function HOe(e){return e.paths!==void 0}function qOe(e){return e.rings!==void 0}const kW=[];function jde(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function Hde(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function qde(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function Wde(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function UW(e,t=!1,i=!1){return t?i?Wde(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Hde(e[0],e[1],e[2],e[3],e[4],e[5]):i?qde(e[0],e[1],e[2],e[3],e[4],e[5]):jde(e[0],e[1],e[2],e[3])}function LTt(e){return e?BOe(e)?e:jOe(e)?XOe(e):qOe(e)?Xde(e):HOe(e)?Zde(e):GOe(e)?WOe(e):null:null}function WOe(e){const{hasZ:t,hasM:i,points:r}=e;return UW(FW(kW,r,t,i),t,i)}function XOe(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?Wde(t,i,r,s,t,i,r,s):Hde(t,i,r,t,i,r):n?qde(t,i,s,t,i,s):jde(t,i,t,i)}function Xde(e){const{hasZ:t,hasM:i,rings:r}=e,s=L2(kW,r,t,i);return s?UW(s,t,i):null}function Zde(e){const{hasZ:t,hasM:i,paths:r}=e,s=L2(kW,r,t,i);return s?UW(s,t,i):null}var qL;function JK(e){return!Array.isArray(e[0])}let Kp=qL=class extends Ec{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const o of t)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new qL(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||et.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=UOe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new ot;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Xde(this);if(!t)return null;const i=new ai(t);return i.spatialReference=e,i}get isSelfIntersecting(){return LOe(this.rings)}writeRings(e,t){t.rings=re(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(JK(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new qL;return e.spatialReference=this.spatialReference,e.rings=re(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(R(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(_(t)!==_(i)||_(t)&&_(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!Hv(n,o,r))return!1}return!0}contains(e){if(!e)return!1;const t=Qw(e,this.spatialReference);return SOe(this,_(t)?t:e)}isClockwise(e){let t;return t=JK(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,NW(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new ot(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new ot(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new ot(i[0],i[1],i[2],i[3],this.spatialReference):new ot(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?($2(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new ot(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new ot(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?($2(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],Kp.prototype,"cache",null),u([d({readOnly:!0})],Kp.prototype,"centroid",null),u([d({readOnly:!0})],Kp.prototype,"extent",null),u([d({readOnly:!0})],Kp.prototype,"isSelfIntersecting",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],Kp.prototype,"rings",void 0),u([qe("rings")],Kp.prototype,"writeRings",null),Kp=qL=u([P("esri.geometry.Polygon")],Kp),Kp.prototype.toJSON.isDefaultToJSON=!0;const Go=Kp;var g9;function ZOe(e){return!Array.isArray(e[0])}let d0=g9=class extends Ec{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||et.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=Zde(this);if(!t)return null;const i=new ai(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=re(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(ZOe(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new g9;return e.spatialReference=this.spatialReference,e.paths=re(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new ot(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new ot(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new ot(i[0],i[1],i[2],i[3],this.spatialReference):new ot(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?($2(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new ot(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new ot(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?($2(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([d({readOnly:!0})],d0.prototype,"cache",null),u([d({readOnly:!0})],d0.prototype,"extent",null),u([d({type:[[[Number]]],json:{write:{isRequired:!0}}})],d0.prototype,"paths",void 0),u([qe("paths")],d0.prototype,"writePaths",null),d0=g9=u([P("esri.geometry.Polyline")],d0),d0.prototype.toJSON.isDefaultToJSON=!0;const Su=d0,Yde=fa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),KK=fa()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Qde(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function zW(e){return e.points!==void 0}function VW(e){return e.x!==void 0&&e.y!==void 0}function BW(e){return e.paths!==void 0}function qb(e){return e.rings!==void 0}function Qg(e){return R(e)?null:e instanceof Ec?e:VW(e)?ot.fromJSON(e):BW(e)?Su.fromJSON(e):qb(e)?Go.fromJSON(e):zW(e)?Jw.fromJSON(e):Qde(e)?ai.fromJSON(e):null}function VE(e){return e?VW(e)?"esriGeometryPoint":BW(e)?"esriGeometryPolyline":qb(e)?"esriGeometryPolygon":Qde(e)?"esriGeometryEnvelope":zW(e)?"esriGeometryMultipoint":null:null}const YOe={esriGeometryPoint:ot,esriGeometryPolyline:Su,esriGeometryPolygon:Go,esriGeometryEnvelope:ai,esriGeometryMultipoint:Jw};function Jde(e){return e&&YOe[e]||null}const Kw={base:Ec,key:"type",typeMap:{extent:ai,multipoint:Jw,point:ot,polyline:Su,polygon:Go}};wp(Kw);let Wz;function Wf(){return Wz||(Wz=(async()=>{const e=await import("./arcadeUtils.602ddc11.js").then(function(t){return t.t});return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),Wz}const QOe=(e,t,i)=>R3.create(e,t,i,null,["$feature"]),JOe=(e,t,i)=>R3.create(e,t,i,null,["$feature","$view"]),KOe=(e,t,i,r)=>R3.create(e,t,i,r,["$feature","$view"]);class R3{constructor(t,i,r,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=i,this._arcadeDictionary=r,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Wf(),h=et.fromJSON(i),p=a.parseScript(t,o),f=n.reduce((C,A)=>ye(F({},C),{[A]:null}),{});let m=null;_(s)&&(m=new c(s),m.immutable=!0,f.$config=null);const y=a.scriptUsesGeometryEngine(p)&&a.enableGeometrySupport(),v=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),w=a.scriptIsAsync(p)&&a.enableAsyncSupport(),b={vars:f,spatialReference:h,useAsync:!!w},S=new c;S.immutable=!1,S.setField("scale",0);const T=a.compileScript(p,b),E=C=>("$view"in C&&C.$view&&(S.setField("scale",C.$view.scale),C.$view=S),m&&(C.$config=m),T({vars:C,spatialReference:h}));return await Promise.all([y,v,w]),new R3(t,a,c,p,E,new l,r,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const e3e=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],t3e=["field","normalizationField"];function cF(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(eee(e3e,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)eee(t3e,r,t)}}function eee(e,t,i){if(e)for(const r of e){const s=kE(r,t),n=s&&typeof s!="function"&&i.get(s);n&&Sc(r,n.name,t)}}function Kde(e,t){if(e!=null&&(t==null?void 0:t.fields.length))if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const Xz=new Set;function epe(e,t){return e&&t?(Xz.clear(),QM(Xz,e,t),Array.from(Xz).sort()):[]}function QM(e,t,i){var r;if(i)if((r=t==null?void 0:t.fields)==null?void 0:r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)Gh(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)e.add(s)}}function Gh(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function DTt(e,t){return R(t)||R(e)?[]:t.includes("*")?e.fields.map(i=>i.name):t}async function Il(e,t,i){var n;if(!i)return;const{arcadeUtils:r}=await Wf(),s=r.extractFieldNames(i,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)Gh(e,t,o)}async function tpe(e,t,i){if(i&&i!=="1=1"){const r=(await import("./WhereClause.7b12305d.js")).WhereClause.create(i,t);if(!r.isStandardized)throw new j("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});QM(e,t,r.fieldNames)}}function i3e({displayField:e,fields:t}){return e||(t&&t.length?Zz(t,"name-or-title")||Zz(t,"unique-identifier")||Zz(t,"type-or-category")||r3e(t):null)}function r3e(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function Zz(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function NTt(e,t){if(!t)return;const i=kE("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function s3e(e,t,i){i.outStatistic.onStatisticValueExpression?Il(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function FTt(e,t,i){var s,n;if(!t||!i||!("fields"in i))return;const r=[];if(((s=i.popupTemplate)==null?void 0:s.expressionInfos)&&r.push(...i.popupTemplate.expressionInfos.map(o=>Il(e,t.fieldsIndex,o.expression))),Array.isArray((n=i.popupTemplate)==null?void 0:n.content)){const o=i.popupTemplate.content;for(const a of o)a.type==="expression"&&a.expressionInfo&&r.push(Il(e,t.fieldsIndex,a.expressionInfo.expression))}i.fields&&r.push(...i.fields.map(o=>s3e(e,t.fieldsIndex,o))),await Promise.all(r)}async function kTt(e,t,i){t&&(t.timeInfo&&_(i)&&i.timeExtent&&QM(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&QM(e,t.fieldsIndex,[t.floorInfo.floorField]),_(i)&&_(i.where)&&await tpe(e,t.fieldsIndex,i.where))}async function UTt(e,t,i){t&&i&&await Promise.all(i.map(r=>n3e(e,t,r)))}async function n3e(e,t,i){t&&i&&(i.valueExpression?await Il(e,t.fieldsIndex,i.valueExpression):i.field&&Gh(e,t.fieldsIndex,i.field))}function zTt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?epe(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function VTt(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>o3e(e,r,s)))}async function o3e(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Il(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{Gh(e,t,o.slice(1,-1))})}await tpe(e,t,s)}function a3e(e){const t=e.defaultValue;return t!==void 0&&spe(e,t)?t:e.nullable?null:void 0}function ipe(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function l3e(e){return e===null||ipe(e)}const GW="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function c3e(e){return e===null||GW(e)}function rpe(e){return e!=null&&typeof e=="string"}function u3e(e){return e===null||rpe(e)}function h3e(){return!0}function spe(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?c3e:GW;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?l3e:ipe;break;case"string":case"esriFieldTypeString":i=e.nullable?u3e:rpe;break;default:i=h3e}return arguments.length===1?i:i(t)}const d3e=["integer","small-integer","single","double"],p3e=new Set([...d3e,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function D5(e){return e!=null&&p3e.has(e.type)}function BTt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function f3e(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}var uF,hF;function GTt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function jTt(e,t){return e.nullable&&t===null?null:D5(e)&&!m3e(e.type,Number(t))?uF.OUT_OF_RANGE:spe(e,t)?e.domain?pMe(e.domain,t):null:hF.INVALID_TYPE}function m3e(e,t){const i=typeof e=="string"?npe(e):e;return!!i&&(i.isInteger?GW(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}function npe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return g3e;case"esriFieldTypeInteger":case"integer":return y3e;case"esriFieldTypeSingle":case"single":return v3e;case"esriFieldTypeDouble":case"double":return _3e}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(uF||(uF={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(hF||(hF={}));const g3e={min:-32768,max:32767,isInteger:!0},y3e={min:-2147483648,max:2147483647,isInteger:!0},v3e={min:-34e37,max:12e37,isInteger:!1},_3e={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function HTt(e,t,i){switch(e){case M2.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case M2.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case hF.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case uF.OUT_OF_RANGE:{const{min:r,max:s}=npe(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function b3e(e,t){return!w3e(e,t,null)}function w3e(e,t,i){if(!t||!t.attributes||!e){if(_(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!_(i))break;i.add(n)}return s}function ope(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}const dF={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function ape(e){return dF[e]||dF[e.toLowerCase()]}function jW(e){var t;return(t=dF[e])!=null?t:dF[e.toLowerCase()]}function x3e(e){return[...jW(e)]}function Yz(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function lpe(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*Yz(o,n,s+1/3)),Math.round(255*Yz(o,n,s)),Math.round(255*Yz(o,n,s-1/3)),r]}function T3e(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function O(){return[0,0,0]}function Vs(e){return[e[0],e[1],e[2]]}function Ue(e,t,i){return[e,t,i]}function yl(e){const t=O(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function HW(e,t){return new Float64Array(e,t,3)}function cpe(){return O()}function upe(){return Ue(1,1,1)}function hpe(){return Ue(1,0,0)}function dpe(){return Ue(0,1,0)}function qW(){return Ue(0,0,1)}const Ba=cpe(),Nf=upe(),S3e=hpe(),E3e=dpe(),ppe=qW();Object.freeze(Object.defineProperty({__proto__:null,create:O,clone:Vs,fromValues:Ue,fromArray:yl,createView:HW,zeros:cpe,ones:upe,unitX:hpe,unitY:dpe,unitZ:qW,ZEROS:Ba,ONES:Nf,UNIT_X:S3e,UNIT_Y:E3e,UNIT_Z:ppe},Symbol.toStringTag,{value:"Module"}));const Ct=1e-6,rp=Math.random,C3e=Math.PI/180,A3e=180/Math.PI;function N5(e){return e*C3e}function R3e(e){return e*A3e}function M3e(e,t){return Math.abs(e-t)<=Ct*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:Ct,RANDOM:rp,toRadian:N5,toDegree:R3e,equals:M3e},Symbol.toStringTag,{value:"Module"}));function Me(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function ae(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function se(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function de(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function pe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function F5(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function pF(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function O3e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function P3e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function y9(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function fpe(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function mpe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function I3e(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function $3e(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function le(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Rb(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function ur(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function Sn(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function Ua(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function ca(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function L3e(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function we(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function xe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ct(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function pn(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function D3e(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*h,e}function N3e(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,f=l*n;return e[0]=t[0]*c+i[0]*h+r[0]*p+s[0]*f,e[1]=t[1]*c+i[1]*h+r[1]*p+s[1]*f,e[2]=t[2]*c+i[2]*h+r[2]*p+s[2]*f,e}function F3e(e,t){t=t||1;const i=2*rp()*Math.PI,r=2*rp()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e}function ze(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function mc(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function Au(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-r*c,f=r*l-s*a,m=s*f-n*p,y=n*h-r*f,v=r*p-s*h;const w=2*o;return h*=w,p*=w,f*=w,m*=2,y*=2,v*=2,e[0]=a+h+m,e[1]=l+p+y,e[2]=c+f+v,e}function k3e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function U3e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function z3e(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function V3e(e,t){ae(jP,e),ae(HP,t),we(jP,jP),we(HP,HP);const i=xe(jP,HP);return i>1?0:i<-1?Math.PI:Math.acos(i)}const jP=O(),HP=O();function B3e(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Tl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function gw(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(i-n)<=Ct*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Ct*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Ct*Math.max(1,Math.abs(s),Math.abs(a))}function uy(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const Cc=pe,G3e=F5,j3e=pF,WW=ur,XW=Sn,ZW=Me,v9=Ua,tee=Object.freeze(Object.defineProperty({__proto__:null,length:Me,copy:ae,set:se,add:de,subtract:pe,multiply:F5,divide:pF,ceil:O3e,floor:P3e,abs:y9,sign:fpe,min:mpe,max:I3e,round:$3e,scale:le,scaleAndAdd:Rb,distance:ur,squaredDistance:Sn,squaredLength:Ua,negate:ca,inverse:L3e,normalize:we,dot:xe,cross:ct,lerp:pn,hermite:D3e,bezier:N3e,random:F3e,transformMat4:ze,transformMat3:mc,transformQuat:Au,rotateX:k3e,rotateY:U3e,rotateZ:z3e,angle:V3e,str:B3e,exactEquals:Tl,equals:gw,direction:uy,sub:Cc,mul:G3e,div:j3e,dist:WW,sqrDist:XW,len:ZW,sqrLen:v9},Symbol.toStringTag,{value:"Module"}));function sp(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ji(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function YW(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function gpe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function ype(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function vpe(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function H3e(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function q3e(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function W3e(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function X3e(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function Z3e(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function M3(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Y3e(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function _pe(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function fF(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function QW(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function JW(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function Q3e(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function J3e(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function bpe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function wpe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function k5(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function K3e(e,t){let i,r,s,n,o,a;t=t||1;do i=2*rp()-1,r=2*rp()-1,o=i*i+r*r;while(o>=1);do s=2*rp()-1,n=2*rp()-1,a=s*s+n*n;while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*s*l,e[3]=t*n*l,e}function Eu(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function ePe(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,f=c*n+o*s-a*r,m=-o*r-a*s-l*n;return e[0]=h*c+m*-o+p*-l-f*-a,e[1]=p*c+m*-a+f*-o-h*-l,e[2]=f*c+m*-l+h*-a-p*-o,e[3]=t[3],e}function tPe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function JM(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function xpe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Ct*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Ct*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Ct*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Ct*Math.max(1,Math.abs(n),Math.abs(c))}const iPe=gpe,rPe=ype,sPe=vpe,nPe=_pe,oPe=fF,aPe=QW,lPe=JW,Tpe=Object.freeze(Object.defineProperty({__proto__:null,copy:sp,set:Ji,add:YW,subtract:gpe,multiply:ype,divide:vpe,ceil:H3e,floor:q3e,min:W3e,max:X3e,round:Z3e,scale:M3,scaleAndAdd:Y3e,distance:_pe,squaredDistance:fF,length:QW,squaredLength:JW,negate:Q3e,inverse:J3e,normalize:bpe,dot:wpe,lerp:k5,random:K3e,transformMat4:Eu,transformQuat:ePe,str:tPe,exactEquals:JM,equals:xpe,sub:iPe,mul:rPe,div:sPe,dist:nPe,sqrDist:oPe,len:aPe,sqrLen:lPe},Symbol.toStringTag,{value:"Module"})),iee=new Float32Array(1);function D2(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function De(e,t,i){return Math.min(Math.max(e,t),i)}function N2(e){return(e&e-1)==0}function qTt(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function WTt(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function Yt(e,t,i){return e+(t-e)*i}function Dt(e){return e*Math.PI/180}function Ac(e){return 180*e/Math.PI}function _9(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function fn(e){return Math.acos(De(e,-1,1))}function Tp(e){return Math.asin(De(e,-1,1))}function cPe(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function JS(e,t,i=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=i}function uPe(e){return Spe(Math.max(-b9,Math.min(e,b9)))}function Spe(e){return iee[0]=e,iee[0]}function F2(e,t,i){const r=De((i-e)/(t-e),0,1);return r*r*(3-2*r)}function ree(e,t){const i=Me(e),r=Tp(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return se(t,i,r,s),t}function XTt(e,t,i){return Ji(e,t[0],t[1],t[2],t[3]*i)}function ZTt(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(JS(t,1)&&JS(i,1)&&JS(r,1))}const b9=Spe(34028234663852886e22);function qP(e){return De(bW(e),0,255)}function WP(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class _n{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,i,r,s=new _n){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),_n.fromArray(a,i)}return _n.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return _n.fromArray(lpe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new _n){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(t,i=new _n){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=ape(t)?jW(t):null;return r&&_n.fromArray(r,i)||_n.fromRgb(t,i)||_n.fromHex(t,i)}static fromJSON(t){return t&&new _n([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return _(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return _(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var i,r,s,n;return typeof t=="string"?_n.fromString(t,this):Array.isArray(t)?_n.fromArray(t,this):(this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof _n||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=_n.AlphaMode.ALWAYS){const i=qP(this.r),r=qP(this.g),s=qP(this.b);return t===_n.AlphaMode.ALWAYS||this.a!==1?[i,r,s,qP(255*this.a)]:[i,r,s]}clone(){return new _n(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return _(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(WP(this.r,0,255)),this.g=Math.round(WP(this.g,0,255)),this.b=Math.round(WP(this.b,0,255)),this.a=WP(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}_n.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(_n||(_n={}));const Pe=_n,see=new wi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let hPe=0,ST=class extends ve{constructor(e){super(e),this.id="sym"+hPe++,this.type=null,this.color=new Pe([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([d({type:see.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:see.write}}})],ST.prototype,"type",void 0),u([d({type:Pe,json:{write:{allowNull:!0}}})],ST.prototype,"color",void 0),u([Ie("color")],ST.prototype,"readColor",null),ST=u([P("esri.symbols.Symbol")],ST);const Oc=ST;var w9;let p0=w9=class extends Oc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return Il(e,t,n.expression)});await Promise.all(r)}}}clone(){return new w9({data:re(this.data)})}hash(){return vW(JSON.stringify(this.data)).toString()}};u([d({json:{write:!1}})],p0.prototype,"color",void 0),u([d({json:{write:!0}})],p0.prototype,"data",void 0),u([Ie("data",["symbol"])],p0.prototype,"readData",null),u([qe("data",{})],p0.prototype,"writeData",null),u([at({CIMSymbolReference:"cim"},{readOnly:!0})],p0.prototype,"type",void 0),p0=w9=u([P("esri.symbols.CIMSymbol")],p0);const BE=p0;let ET=class extends ve{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};u([d({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],ET.prototype,"enabled",void 0),u([qe("enabled")],ET.prototype,"writeEnabled",null),u([d({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],ET.prototype,"type",void 0),ET=u([P("esri.symbols.Symbol3DLayer")],ET);const um=ET,dPe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,pPe="screenUtils.toPt: input not recognized!",Epe=96;function gi(e){return e?e/72*Epe:0}function $l(e){return e?72*e/Epe:0}function ir(e){if(typeof e=="string"){const t=e.match(dPe);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?$l(i):i;return s?-n:n}return console.warn(pPe),null}return e}function Sp(e=0,t=0){return{x:e,y:t}}function Yr(e=0,t=0){return[e,t]}function fPe(e=0,t=0){return[e,t]}function Fo(e=0,t=0,i=0){return[e,t,i]}function YTt(e){return e}function QTt(e){return e}function JTt(e){return e}function Tg(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function U5(e){const t=bW(100*(1-e));return Math.max(0,Math.min(t,100))}function k2(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function mPe(e,t){const i=t.transparency!=null?k2(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new Pe([r[0]||0,r[1]||0,r[2]||0,i]):null}function gPe(e,t){t.color=e.toJSON().slice(0,3);const i=U5(e.a);i!==0&&(t.transparency=i)}const hy={type:Pe,json:{type:[Br],default:null,read:{source:["color","transparency"],reader:mPe},write:{target:{color:{type:[Br]},transparency:{type:Br}},writer:gPe}}},Xf={type:Number,cast:ir,json:{write:!0}};let f1=class extends ve{constructor(e){super(e),this.color=new Pe([0,0,0,1]),this.extensionLength=0,this.size=$l(1)}clone(){}cloneProperties(){return{color:re(this.color),size:this.size,extensionLength:this.extensionLength}}};u([d({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],f1.prototype,"type",void 0),u([d(hy)],f1.prototype,"color",void 0),u([d(ye(F({},Xf),{json:{write:{overridePolicy:e=>({enabled:!!e})}}}))],f1.prototype,"extensionLength",void 0),u([d(Xf)],f1.prototype,"size",void 0),f1=u([P("esri.symbols.edges.Edges3D")],f1);const KW=f1;var x9;let WL=x9=class extends KW{constructor(e){super(e),this.type="sketch"}clone(){return new x9(this.cloneProperties())}};u([at({sketch:"sketch"},{readOnly:!0})],WL.prototype,"type",void 0),WL=x9=u([P("esri.symbols.edges.SketchEdges3D")],WL);const yPe=WL;var T9;let XL=T9=class extends KW{constructor(e){super(e),this.type="solid"}clone(){return new T9(this.cloneProperties())}};u([at({solid:"solid"},{readOnly:!0})],XL.prototype,"type",void 0),XL=T9=u([P("esri.symbols.support.SolidEdges3D")],XL);const vPe=XL,Cpe={types:{key:"type",base:KW,typeMap:{solid:vPe,sketch:yPe}},json:{write:!0}};var S9;let Ru=S9=class extends ve{constructor(e){super(e),this.color=null}clone(){const e={color:_(this.color)?this.color.clone():null};return new S9(e)}};u([d(hy)],Ru.prototype,"color",void 0),Ru=S9=u([P("esri.symbols.support.Symbol3DMaterial")],Ru);var E9;let f0=E9=class extends um{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new E9({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([at({Extrude:"extrude"},{readOnly:!0})],f0.prototype,"type",void 0),u([d({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],f0.prototype,"size",void 0),u([d({type:Ru,json:{write:!0}})],f0.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],f0.prototype,"castShadows",void 0),u([d(Cpe)],f0.prototype,"edges",void 0),f0=E9=u([P("esri.symbols.ExtrudeSymbol3DLayer")],f0);const Ape=f0;let DA=class extends Oc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([at({esriSLS:"simple-line"},{readOnly:!0})],DA.prototype,"type",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],DA.prototype,"width",void 0),DA=u([P("esri.symbols.LineSymbol")],DA);const _Pe=DA,bPe=["begin","end","begin-end"],Rpe=["arrow","circle","square","diamond","cross","x"];var C9;let ef=C9=class extends ve{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new C9({color:re(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([d({type:["begin","end","begin-end"],json:{write:!0}})],ef.prototype,"placement",void 0),u([at({"line-marker":"line-marker"},{readOnly:!0}),d({json:{origins:{"web-map":{write:!1}}}})],ef.prototype,"type",void 0),u([d({type:Rpe})],ef.prototype,"style",void 0),u([qe("style")],ef.prototype,"writeStyle",null),u([d({type:Pe,value:null,json:{write:{allowNull:!0}}})],ef.prototype,"color",null),u([Ie("color")],ef.prototype,"readColor",null),u([qe("color")],ef.prototype,"writeColor",null),ef=C9=u([P("esri.symbols.LineSymbolMarker")],ef);const wPe=ef;var A9;const Qz=new wi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let zm=A9=class extends _Pe{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),i!=null&&(o.width=ir(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=ir(n)),o}clone(){var e;return new A9({color:re(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([at({esriSLS:"simple-line"},{readOnly:!0})],zm.prototype,"type",void 0),u([d({type:Qz.apiValues,json:{read:Qz.read,write:Qz.write}})],zm.prototype,"style",void 0),u([d({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],zm.prototype,"cap",void 0),u([d({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],zm.prototype,"join",void 0),u([d({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":wPe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],zm.prototype,"marker",void 0),u([d({type:Number,json:{read:!1,write:!1}})],zm.prototype,"miterLimit",void 0),zm=A9=u([P("esri.symbols.SimpleLineSymbol")],zm);const Pc=zm;let NA=class extends Oc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Pc}},json:{default:null,write:!0}})],NA.prototype,"outline",void 0),u([d({type:["simple-fill","picture-fill"],readOnly:!0})],NA.prototype,"type",void 0),NA=u([P("esri.symbols.FillSymbol")],NA);const Mpe=NA;let ZL=class extends ve{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],ZL.prototype,"type",void 0),ZL=u([P("esri.symbols.patterns.LinePattern3D")],ZL);const Ope=ZL,xPe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var R9;const TPe=fa()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let FA=R9=class extends Ope{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new R9(e)}};u([d({type:["style"]})],FA.prototype,"type",void 0),u([at(TPe),d({type:xPe})],FA.prototype,"style",void 0),FA=R9=u([P("esri.symbols.patterns.LineStylePattern3D")],FA);const eX=FA;let YL=class extends ve{constructor(e){super(e)}clone(){}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],YL.prototype,"type",void 0),YL=u([P("esri.symbols.patterns.Pattern3D")],YL);const Ppe=YL,SPe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var M9;let kA=M9=class extends Ppe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new M9(e)}};u([d({type:["style"]})],kA.prototype,"type",void 0),u([d({type:SPe,json:{read:!0,write:!0}})],kA.prototype,"style",void 0),kA=M9=u([P("esri.symbols.patterns.StylePattern3D")],kA);const Ipe=kA,EPe={types:{key:"type",base:Ppe,typeMap:{style:Ipe}},json:{write:!0}},$pe={types:{key:"type",base:Ope,typeMap:{style:eX}},json:{write:!0}},eM=new Pe("white");new Pe("black");const CPe=new Pe([255,255,255,0]);function APe(e){return e.r===0&&e.g===0&&e.b===0}var O9;let tM=O9=class extends Ru{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:_(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new O9(e)}};u([at({multiply:"multiply",replace:"replace",tint:"tint"})],tM.prototype,"colorMixMode",void 0),tM=O9=u([P("esri.symbols.support.Symbol3DFillMaterial")],tM);function kt(e=PPe){return[e[0],e[1],e[2],e[3]]}function KTt(e){return[e[0],e[1],e[2],e[3]]}function Jg(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function tX(e,t,i,r,s=kt()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Lpe(e,t=kt()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function z5(e,t){return new ai({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function KS(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Wb(e,t,i){if(R(t))Jg(i,e);else if("length"in t)I9(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function Jz(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function P9(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function bu(e){return R(e)||e[0]>=e[2]?0:e[2]-e[0]}function Ep(e){return e[1]>=e[3]?0:e[3]-e[1]}function Dpe(e){return bu(e)*Ep(e)}function iX(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Npe(e,t){return rX(e,t[0],t[1])}function nee(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function eSt(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=i,p=(w,b)=>(h-l)*w+(a-c)*b+(c*l-a*h)<0,f=p(r,o),m=p(n,o),y=p(n,s),v=p(r,s);return!(f===m&&m===y&&y===v&&v===f||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function tSt(e,t){return rX(e,t.x,t.y)}function rX(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function UA(e,t,i,r){return t>=e[0]-r&&i>=e[1]-r&&t<=e[2]+r&&i<=e[3]+r}function RPe(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function O3(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function oee(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function QL(e,t,i){if(R(t))return Jg(i,e);const r=t[0],s=t[1],n=t[2],o=t[3];return i[0]=De(e[0],r,n),i[1]=De(e[1],s,o),i[2]=De(e[2],r,n),i[3]=De(e[3],s,o),i}function MPe(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-bu(e)/2,0),n=Math.max(Math.abs(t[1]-r)-Ep(e)/2,0);return Math.sqrt(s*s+n*n)}function mF(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function Lu(e){return e?Jg(e,$9):kt($9)}function I9(e){return e!=null&&e.length===4}function OPe(e){return!(bu(e)!==0&&isFinite(e[0])||Ep(e)!==0&&isFinite(e[1]))}function Xb(e,t){return I9(e)&&I9(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const iSt=[-1/0,-1/0,1/0,1/0],$9=[1/0,1/0,-1/0,-1/0],PPe=[0,0,0,0];function Gs(e=Vpe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function yw(e,t,i,r,s,n,o=Gs()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function rSt(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new ai(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function U2(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function IPe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function Zf(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Cu(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<r;h++)s=Math.min(s,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),c=Math.max(c,t[i+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function Kz(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function $Pe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function ex(e){return e[0]>=e[3]?0:e[3]-e[0]}function tx(e){return e[1]>=e[4]?0:e[4]-e[1]}function m_(e){return e[2]>=e[5]?0:e[5]-e[2]}function Fpe(e){const t=ex(e),i=m_(e),r=tx(e);return Math.sqrt(t*t+i*i+r*r)}function np(e,t=[0,0,0]){return t[0]=e[0]+ex(e)/2,t[1]=e[1]+tx(e)/2,t[2]=e[2]+m_(e)/2,t}function XP(e,t=[0,0,0]){return t[0]=ex(e),t[1]=tx(e),t[2]=m_(e),t}function LPe(e){return Math.max(ex(e),m_(e),tx(e))}function sX(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function sSt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function DPe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function op(e,t){return!!R(t)||DPe(e,t)}function kpe(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function nSt(e,t,i=e){const r=e[0]+ex(e)/2,s=e[1]+tx(e)/2,n=e[2]+m_(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function Upe(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function zpe(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function V5(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function mr(e){return e?V5(e,lee):Gs(lee)}function nX(e,t){return t||(t=kt()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function oSt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function aee(e){return e.length===6}function B5(e){return ex(e)===0&&tx(e)===0&&m_(e)===0}function aSt(e,t,i){if(R(e)||R(t))return e===t;if(!aee(e)||!aee(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function NPe(e,t,i,r,s,n){return yw(e,t,i,r,s,n,FPe)}const lSt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],lee=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Vpe=[0,0,0,0,0,0],FPe=Gs();function e6(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const o=Ue(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const kPe=yw(-.5,-.5,-.5,.5,.5,.5),UPe=yw(-.5,-.5,0,.5,.5,1),zPe=yw(-.5,-.5,0,.5,.5,.5);function VPe(e){switch(e){case"sphere":case"cube":case"diamond":return kPe;case"cylinder":case"cone":case"inverted-cone":return UPe;case"tetrahedron":return zPe;default:return}}const oX=["butt","square","round"],BPe=[...oX,"none"],Bpe=["miter","bevel","round"];var L9;let m1=L9=class extends ve{constructor(e){super(e),this.color=new Pe([0,0,0,1]),this.size=$l(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size,pattern:_(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new L9(e)}};u([d(hy)],m1.prototype,"color",void 0),u([d(Xf)],m1.prototype,"size",void 0),u([d($pe)],m1.prototype,"pattern",void 0),u([d({type:oX,json:{default:"butt",write:{overridePolicy(){return{enabled:_(this.pattern)}}}}})],m1.prototype,"patternCap",void 0),m1=L9=u([P("esri.symbols.support.Symbol3DOutline")],m1);var JL;let Vm=JL=class extends um{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:_(this.edges)?this.edges.clone():null,enabled:this.enabled,material:_(this.material)?this.material.clone():null,pattern:_(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:_(this.outline)?this.outline.clone():null};return new JL(e)}static fromSimpleFillSymbol(e){var r,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new eX({style:e.outline.style}):null,i={size:(s=(r=e.outline)==null?void 0:r.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:eM).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(i.patternCap=e.outline.cap),new JL({material:new tM({color:((l=e.color)!=null?l:CPe).clone()}),pattern:e.style&&e.style!=="solid"?new Ipe({style:e.style}):null,outline:i})}};u([at({Fill:"fill"},{readOnly:!0})],Vm.prototype,"type",void 0),u([d({type:tM,json:{write:!0}})],Vm.prototype,"material",void 0),u([d(EPe)],Vm.prototype,"pattern",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Vm.prototype,"castShadows",void 0),u([d({type:m1,json:{write:!0}})],Vm.prototype,"outline",void 0),u([d(Cpe)],Vm.prototype,"edges",void 0),Vm=JL=u([P("esri.symbols.FillSymbol3DLayer")],Vm);const G5=Vm,GPe=["none","underline","line-through"],jPe=["normal","italic","oblique"],HPe=["normal","lighter","bold","bolder"],Gpe={type:Number,cast:e=>{const t=Mh(e);return t===0?1:De(t,.1,4)},nonNullable:!0},qPe=["left","right","center"],WPe=["baseline","top","middle","bottom"],jpe={type:qPe,nonNullable:!0},Hpe={type:WPe,nonNullable:!0};var D9;let Bm=D9=class extends ve{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return ir(e)}clone(){return new D9({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([d({type:GPe,json:{default:"none",write:!0}})],Bm.prototype,"decoration",void 0),u([d({type:String,json:{write:!0}})],Bm.prototype,"family",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],Bm.prototype,"size",void 0),u([qt("size")],Bm.prototype,"castSize",null),u([d({type:jPe,json:{default:"normal",write:!0}})],Bm.prototype,"style",void 0),u([d({type:HPe,json:{default:"normal",write:!0}})],Bm.prototype,"weight",void 0),Bm=D9=u([P("esri.symbols.Font")],Bm);const j5=Bm,XPe=fe.getLogger("esri.core.urlUtils"),GE=Fi.request,cee="esri/config: esriConfig.request.proxyUrl is not set.",qpe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Wpe=/^\s*http:/i,ZPe=/^\s*https:/i,YPe=/^\s*file:/i,QPe=/:\d+$/,JPe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,KPe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),eIe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class e2{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(KPe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(eIe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const ZP={},tIe=new e2(Fi.applicationUrl);let za=tIe;const iIe=rIe();let aX=iIe;const lX=()=>za,cSt=()=>aX;function rIe(){const e=za.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${za.scheme}://${za.host}${za.port!=null?`:${za.port}`:""}`}${t}`}function js(e){const t={path:null,query:null},i=new e2(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=Xpe(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function Xpe(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function uee(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function KM(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>uee(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):uee(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function sIe(e=!1){let t,i=GE.proxyUrl;if(typeof e=="string"){t=uIe(e);const r=H5(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw XPe.warn(cee),new j("urlutils:proxy-not-set",cee);return t&&N9()&&(i=pX(i)),js(i)}function uSt(e){const t=H5(e);let i,r;if(t){const s=cX(t.proxyUrl);i=s.path,r=s.query?Xpe(s.query):null}if(i){const s=js(e);e=i+"?"+s.path;const n=KM(F(F({},r),s.query));n&&(e=`${e}?${n}`)}return e}const _C={path:"",query:""};function cX(e){const t=e.indexOf("?");return t!==-1?(_C.path=e.slice(0,t),_C.query=e.slice(t+1)):(_C.path=e,_C.query=null),_C}function Zpe(e){return e=(e=gF(e=mIe(e=cX(e).path),!0)).toLowerCase()}function nIe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:Zpe(e.urlPrefix)},i=GE.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function H5(e){const t=GE.proxyRules,i=Zpe(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function Ype(e,t){return e=hee(e),t=hee(t),gF(e)===gF(t)}function hee(e){const t=(e=fp(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function Qpe(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=GE.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function eO(e,t,i=!1){const r=k9(e),s=k9(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function uX(e){if(typeof e=="string"){if(!wc(e))return!0;e=k9(e)}if(eO(e,za))return!0;const t=GE.trustedServers||[];for(let i=0;i<t.length;i++){const r=oIe(t[i]);for(let s=0;s<r.length;s++)if(eO(e,r[s]))return!0}return!1}function oIe(e){return ZP[e]||(dX(e)||Yf(e)?ZP[e]=[new e2(zh(e))]:ZP[e]=[new e2(`http://${e}`),new e2(`https://${e}`)]),ZP[e]}function zh(e,t=aX,i){return Yf(e)?i&&i.preserveProtocolRelative?e:za.scheme==="http"&&za.authority===mp(e).slice(2)?`http:${e}`:`https:${e}`:dX(e)?e:Ll(e[0]==="/"?fIe(t):t,e)}function hX(e,t=aX,i){if(!wc(e))return e;const r=fp(e),s=r.toLowerCase(),n=fp(t).toLowerCase().replace(/\/+$/,""),o=i?fp(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,f,m)=>(m=p.indexOf(f,m))===-1?p.length:m;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function fp(e){return e=vIe(e=yIe(e=gIe(e=zh(e=e.trim()))))}function Ll(...e){const t=e.filter(_);if(!t||!t.length)return;const i=[];if(wc(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),dIe(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function mp(e,t=!1){if(Wv(e)||hm(e))return null;let i=e.indexOf("://");if(i===-1&&Yf(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=gF(e,!0)),e}function wc(e){return Yf(e)||dX(e)}function Wv(e){return e!=null&&e.slice(0,5)==="blob:"}function hm(e){return e.slice(0,5)==="data:"}function Jpe(e){const t=q5(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function hSt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const aIe=/^data:(.*?)(;base64)?,(.*)$/;function q5(e){const t=e.match(aIe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function Kpe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function dSt(e,t){lIe(e,t)||cIe(e,t)}function lIe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function cIe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function Yf(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function dX(e){return qpe.test(e)}function uIe(e){return ZPe.test(e)||za.scheme==="https"&&Yf(e)}function hIe(e){return Wpe.test(e)||za.scheme==="http"&&Yf(e)}function dIe(e){return YPe.test(e)}function pX(e){return Yf(e)?`https:${e}`:e.replace(Wpe,"https:")}function pIe(){return za.scheme==="http"}function N9(){return za.scheme==="https"}function gF(e,t=!1){return Yf(e)?e.slice(2):(e=e.replace(qpe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function fIe(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function fX(e){let t=0;if(wc(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function pSt(e,t){if(!e)return"";const i=js(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(t==null?void 0:t.length))return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function mIe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function efe(e){return e.replace(/\/+$/,"")}function gIe(e){if(/^https?:\/\//i.test(e)){const t=cX(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function yIe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function vIe(e){const t=GE.httpsDomains;if(!hIe(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),QPe.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return pIe()&&r===za.authority&&!JPe.test(e)||(N9()&&r===za.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||N9()&&!H5(e))&&(e=pX(e)),e}function F9(e,t,i){if(!(t&&i&&e&&wc(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function k9(e){return typeof e=="string"?new e2(zh(e)):(e.scheme||(e.scheme=za.scheme),e)}function mX(e){return bIe.test(e)}function tfe(e,t){const i=js(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function ife(e,t,i){const r=js(e),s=r.query||{};return s[t]=String(i),`${r.path}?${KM(s)}`}function KL(e,t){const i=js(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=KM(r);return s?`${i.path}?${s}`:i.path}function gX(e){if(R(e))return null;const t=e.match(_Ie);return t?t[1]:null}const _Ie=/.*?\.([^\/]*)$/,bIe=/(^data:image\/svg|\.svg$)/i;function Qf(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=zh(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=hX(e,t.portalItem.itemUrl);xIe.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return U9(e,t&&t.portal)}function Kg(e,t,i=z2.YES){if(!e)return e;!wc(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=zh(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=U9(s,t.portal);r=hX(U9(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=sfe(r,t&&t.portal),wc(r)&&(r=fp(r)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!wc(r)&&!hm(r)&&i===z2.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function W5(e,t,i){return Qf(e,i)}function Xv(e,t,i,r){const s=Kg(e,r);s!==void 0&&(t[i]=s)}const wIe=/\/items\/([^\/]+)\/resources\//,xIe=/^\.\/resources\//;function rfe(e){const t=_(e)?e.match(wIe):null;return _(t)?t[1]:null}function sfe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?F9(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function U9(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=lX();return eO(r,`${r.scheme}://${i}`)?F9(e,t.portalHostname,i):F9(e,i,t.portalHostname)}var z2;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(z2||(z2={}));const TIe=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:Qf,toJSON:Kg,read:W5,write:Xv,itemIdFromResourceUrl:rfe,ensureMainOnlineDomain:sfe,get MarkKeep(){return z2}},Symbol.toStringTag,{value:"Module"}));var z9;const SIe=fa()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let g1=z9=class extends ve{constructor(e){super(e)}readHref(e,t,i){return e?Qf(e,i):t.dataURI}writeHref(e,t,i,r){e&&(hm(e)?t.dataURI=e:(t.href=Kg(e,r),wc(t.href)&&(t.href=fp(t.href))))}clone(){return new z9({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],g1.prototype,"href",void 0),u([Ie("href")],g1.prototype,"readHref",null),u([qe("href",{href:{type:String},dataURI:{type:String}})],g1.prototype,"writeHref",null),u([at(SIe)],g1.prototype,"primitive",void 0),g1=z9=u([P("esri.symbols.support.IconSymbol3DLayerResource")],g1);const nfe="circle";var V9;let TS=V9=class extends Se{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new V9({x:this.x,y:this.y})}};u([d({type:Number})],TS.prototype,"x",void 0),u([d({type:Number})],TS.prototype,"y",void 0),TS=V9=u([P("esri.symbols.support.Symbol3DAnchorPosition2D")],TS);var B9;let zA=B9=class extends ve{constructor(e){super(e),this.color=new Pe([0,0,0,1]),this.size=$l(1)}clone(){const e={color:_(this.color)?this.color.clone():null,size:this.size};return new B9(e)}};u([d(hy)],zA.prototype,"color",void 0),u([d(Xf)],zA.prototype,"size",void 0),zA=B9=u([P("esri.symbols.support.Symbol3DIconOutline")],zA);var CT;const EIe=fe.getLogger("esri.symbols.IconSymbol3DLayer");let tf=CT=class extends um{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new CT({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:_(this.material)?this.material.clone():null,outline:_(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||eM,i=dee(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||eM).clone()}:null;return new CT({size:e.size,resource:{primitive:AIe(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||APe(e.color)?eM:e.color,i=dee(e);return new CT({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new CT({resource:{href:Kpe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function dee(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=pee(e.xoffset),s=pee(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function pee(e){return isFinite(e)?e:0}u([d({type:Ru,json:{write:!0}})],tf.prototype,"material",void 0),u([d({type:g1,json:{write:!0}})],tf.prototype,"resource",void 0),u([at({Icon:"icon"},{readOnly:!0})],tf.prototype,"type",void 0),u([d(Xf)],tf.prototype,"size",void 0),u([at({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),d({json:{default:"center"}})],tf.prototype,"anchor",void 0),u([d({type:TS,json:{type:[Number],read:{reader:e=>new TS({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],tf.prototype,"anchorPosition",void 0),u([d({type:zA,json:{write:!0}})],tf.prototype,"outline",void 0),tf=CT=u([P("esri.symbols.IconSymbol3DLayer")],tf);const CIe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function AIe(e){return CIe[e]||(EIe.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const gv=tf;class t2{constructor(){this._emitter=new t2.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this.target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return R2(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([P("esri.core.Evented")],s),s};let i=class extends Se{constructor(){super(...arguments),this._emitter=new t2.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([P("esri.core.Evented")],i),e.EventedAccessor=i})(t2||(t2={}));const as=t2;var Yi;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(Yi||(Yi={}));function yX(e){return(t,i)=>{t[i]=e}}class ofe{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new ade(this._observers,t)}notify(){const t=this._observers.slice();for(let i=0;i<t.length;++i){const r=t[i];r.onInvalidated(),r.onCommitted()}}}var bg;class RIe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const qu=new Cs(RIe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),MIe=()=>{};function t6(e){return e?e instanceof ub?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function i6(e){if(e&&e.length)return e[0]}function OIe(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function afe(e,t,i,r){t&&t.forEach((s,n,o)=>{e.push(s),afe(e,i.call(r,s,n,o),i,r)})}const Cy=new Set,Ay=new Set,Ry=new Set,r6=new Map;let PIe=0,ub=bg=class extends as.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new ofe,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:PIe++})}static isCollection(e){return e!=null&&e instanceof bg}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof bg?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return ei(this._observable),this._items}set items(e){this._emitBeforeChanges(Yi.ADD)||(this._splice(0,this.length,t6(e)),this._emitAfterChanges(Yi.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=MIe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(ei(this._observable),this._emitBeforeChanges(Yi.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(Yi.ADD),this}addMany(e,t=this._items.length){if(ei(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(Yi.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,t6(e)),this._emitAfterChanges(Yi.ADD),this}at(e){if(ei(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(Yi.REMOVE),e}clone(){return ei(this._observable),this._createNewInstance({items:this._items.map(re)})}concat(...e){ei(this._observable);const t=e.map(t6);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(Yi.REMOVE)}every(e,t){return ei(this._observable),this._items.every(e,t)}filter(e,t){let i;return ei(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return ei(this._observable),this._items.find(e,t)}findIndex(e,t){return ei(this._observable),this._items.findIndex(e,t)}flatten(e,t){ei(this._observable);const i=[];return afe(i,this,e,t),new bg(i)}forEach(e,t){return ei(this._observable),this._items.forEach(e,t)}getItemAt(e){return ei(this._observable),this._items[e]}getNextIndex(e){ei(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return ei(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return ei(this._observable),this._items.indexOf(e,t)}join(e=","){return ei(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return ei(this._observable),this._items.lastIndexOf(e,t)}map(e,t){ei(this._observable);const i=this._items.map(e,t);return new bg({items:i})}reorder(e,t=this.length-1){ei(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(Yi.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(Yi.MOVE)}return e}}pop(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const e=i6(this._splice(this.length-1,1));return this._emitAfterChanges(Yi.REMOVE),e}push(...e){return ei(this._observable),this._emitBeforeChanges(Yi.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(Yi.ADD)),this.length}reduce(e,t){ei(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){ei(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return ei(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(ei(this._observable),e<0||e>=this.length||this._emitBeforeChanges(Yi.REMOVE))return;const t=i6(this._splice(e,1));return this._emitAfterChanges(Yi.REMOVE),t}removeMany(e){if(ei(this._observable),!e||!e.length||this._emitBeforeChanges(Yi.REMOVE))return[];const t=e instanceof bg?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=i.indexOf(o);if(a>-1){const l=1+OIe(t,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(Yi.REMOVE),r}reverse(){if(ei(this._observable),this._emitBeforeChanges(Yi.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(Yi.MOVE),this}shift(){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.REMOVE))return;const e=i6(this._splice(0,1));return this._emitAfterChanges(Yi.REMOVE),e}slice(e=0,t=this.length){return ei(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return ei(this._observable),this._items.some(e,t)}sort(e){if(ei(this._observable),!this.length||this._emitBeforeChanges(Yi.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(Yi.MOVE),this}splice(e,t,...i){ei(this._observable);const r=(t?Yi.REMOVE:0)|(i.length?Yi.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return ei(this._observable),this._items.slice()}toJSON(){return ei(this._observable),this.toArray()}toLocaleString(){return ei(this._observable),this._items.toLocaleString()}toString(){return ei(this._observable),this._items.toString()}unshift(...e){return ei(this._observable),!e.length||this._emitBeforeChanges(Yi.ADD)||(this._splice(0,0,e),this._emitAfterChanges(Yi.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=zE(()=>this._dispatchChange())),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const a=qu.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(e,0,n),e+=1,l-=1,c-=1);qu.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=qu.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);qu.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const f=s.ensureType(p);f==null&&p!=null||h.push(f)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=qu.acquire();h.target=this,h.cancellable=!0;const p=qu.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(h.reset(f),this.emit("before-add",h),h.defaultPrevented||(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(e++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));qu.release(p),qu.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=qu.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,qu.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=qu.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),qu.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;Cy.clear(),Ay.clear(),Ry.clear();for(const{added:l,removed:c}of i){if(l)if(Ry.size===0&&Ay.size===0)for(const h of l)Cy.add(h);else for(const h of l)Ay.has(h)?(Ry.add(h),Ay.delete(h)):Ry.has(h)||Cy.add(h);if(c)if(Ry.size===0&&Cy.size===0)for(const h of c)Ay.add(h);else for(const h of c)Cy.has(h)?Cy.delete(h):(Ry.delete(h),Ay.add(h))}const r=uc.acquire();Cy.forEach(l=>{r.push(l)});const s=uc.acquire();Ay.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=uc.acquire();if(Ry.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}uc.release(r),uc.release(s),uc.release(a)}Cy.clear(),Ay.clear(),Ry.clear()}};ub.ofType=e=>{if(!e)return bg;if(r6.has(e))return r6.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends bg{};return u([yX({Type:e,ensureType:typeof e=="function"?Bs(e):wp(e)})],i.prototype,"itemType",void 0),i=u([P(`esri.core.Collection<${t}>`)],i),r6.set(e,i),i},u([d()],ub.prototype,"length",void 0),u([d()],ub.prototype,"items",null),ub=bg=u([P("esri.core.Collection")],ub);const ut=ub;function vw(e,t,i=ut){return t||(t=new i),t===e||(t.removeAll(),IIe(e)?t.addMany(e):e&&t.add(e)),t}function lfe(e){return e}function IIe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const cfe="20220630",ufe="5a46844c5ac1b721521da79fb0304de9e8457e2c",hfe="4.24",$Ie={async request(e,t){var a;const{default:i}=await Promise.resolve().then(function(){return gfe}),r=e.options,s=r.responseType;r.signal=t==null?void 0:t.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":["blob","json","text"].includes(s)&&((a=Qpe(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await i(e.url,r),o={data:n.data,ssl:n.ssl};switch(n.requestOptions.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Gr;function fSt(e){Gr=e}function LIe(e){const t=Gr&&Gr.findCredential(e);return t&&t.token?ife(e,"token",t.token):e}he("host-webworker")||(he("edge")||he("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const DIe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function dfe(e){const t=mp(e,!0);return t&&t.endsWith(".arcgis.com")&&!DIe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function pfe(e,t,i=!1,r){return new Promise((s,n)=>{if(nn(r))return void n(fee());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(fee())};const c=()=>{he("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,_(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};_(r)&&r.addEventListener("abort",l),he("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function fee(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function NIe(e){Fi.request.crossOriginNoCorsDomains||(Fi.request.crossOriginNoCorsDomains={});const t=Fi.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[mp(i)]=0:(t[mp("http://"+i)]=0,t[mp("https://"+i)]=0)}function FIe(e){const t=Fi.request.crossOriginNoCorsDomains;if(t){let i=mp(e);if(i)return i=i.toLowerCase(),!eO(i,lX())&&t[i]<Date.now()-36e5}return!1}async function kIe(e){var r;const t=Fi.request.crossOriginNoCorsDomains;t&&(t[mp(e).toLowerCase()]=Date.now());const i=js(e);e=i.path,((r=i.query)==null?void 0:r.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function Zt(e,t){var c;const i=hm(e),r=Wv(e);r||i||(e=fp(e));const s={url:e,requestOptions:F({},t)};let n=Qpe(e);if(n){const h=await qIe(n,s);if(h!=null)return{data:h,getHeader:vX,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(he("host-webworker")||he("host-node"))throw ap("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw ap("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw ap("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw ap("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await GIe(),yF)return yF.execute(e,t);const o=new AbortController;ha(t,()=>o.abort());const a={controller:o,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:jd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await XIe(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let yF;const jd=Fi.request,ffe="FormData"in globalThis,UIe=[499,498,403,401],zIe=["COM_0056","COM_0057","SB_0008"],VIe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],vX=()=>null,G9=Symbol();function BIe(e){const t=mp(e);t&&!Zt._corsServers.includes(t)&&Zt._corsServers.push(t)}function mee(e){const t=mp(e);return!t||t.endsWith(".arcgis.com")||Zt._corsServers.includes(t)||uX(t)}function ap(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:vX,ssl:!1};if(t instanceof j)return t.details?(t.details=re(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=G9 in t?t[G9]:t}return Jr(t)?mi():new j(e,s,n)}async function GIe(){he("host-webworker")?yF||(yF=await import("./request.bae2d222.js")):Zt._abortableFetch||(Zt._abortableFetch=globalThis.fetch.bind(globalThis))}async function j9(){Gr||await import("./IdentityManager.1559c751.js")}async function jIe(e){var a;const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null;if(ffe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:i.cacheBust&&!Zt._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:jd.priority,redirect:"follow",signal:r},(n||o)&&(e.fetchOptions.body=n||o),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=i.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&Fi.apiKey&&dfe(t)&&(i.query||(i.query={}),i.query.token=Fi.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!mfe(t)&&!nn(r)){let l;i.authMode==="immediate"?(await j9(),l=await Gr.getCredential(t,{signal:r}),e.credential=l):i.authMode==="no-prompt"?(await j9(),l=await Gr.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=l):Gr&&(l=Gr.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function mfe(e){return VIe.some(t=>t.test(e))}async function HIe(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=Wv(t)||hm(t),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:jd.timeout;let a=!1;if(!s){e.useSSL&&(t=pX(t)),i.cacheBust&&r.cache==="default"&&(t=ife(t,"request.preventCache",Date.now()));let f=F({},i.query);e.credentialToken&&(f.token=e.credentialToken);let m=KM(f);he("esri-url-encodes-apostrophe")&&(m=m.replace(/'/g,"%27"));const y=t.length+1+m.length;let v;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||y>jd.maxUrlLength;const w=i.useProxy||!!H5(t);if(w){const b=sIe(t);v=b.path,!a&&v.length+1+y>jd.maxUrlLength&&(a=!0),b.query&&(f=F(F({},b.query),f))}if(r.method==="HEAD"&&(a||w)){if(a)throw y>jd.maxUrlLength?ap("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):ap("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(w)throw ap("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=KL(t,f):(r.body=KM(f),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=KL(t,f),w&&(e.useProxy=!0,t=`${v}?${t}`),f.token&&ffe&&r.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!eO(t,lX())){if(uX(t))e.withCredentials=!0;else if(Gr){const b=Gr.findServerInfo(t);b&&b.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include",FIe(t)&&await kIe(a?KL(t,f):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||WIe(i.headers)||!s&&!e.useProxy&&jd.proxyUrl&&!mee(t)){if(l=await Zt._abortableFetch(t,r),e.useProxy||BIe(t),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=gee(c,"application/xml");break;case"document":c=gee(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const f=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(f)&&c[n==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}n==="image"&&c instanceof Blob&&(c=await yee(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await yee(t,e)}catch(f){if(f.name==="AbortError")throw p?new Error("Timeout exceeded"):mi("Request canceled");if(!(!l&&f instanceof TypeError&&jd.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||mee(t))throw f;e.redoRequest=!0,nIe({proxyUrl:jd.proxyUrl,urlPrefix:mp(t)})}finally{h&&clearTimeout(h)}return[l,c]}async function qIe(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers=F(F({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=F(F({},t.requestOptions.query),e.query)),e.before){let i,r;try{r=await e.before(t)}catch(s){i=ap("request:interceptor",s,t)}if((r instanceof Error||r instanceof j)&&(i=ap("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function WIe(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function gee(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function XIe(e){var n;let t,i;await jIe(e);try{do[t,i]=await HIe(e);while(!await ZIe(e,t,i))}catch(o){const a=ap("request:server",o,e.params,t);throw a.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a}const r=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!e.hasToken&&!e.credentialToken&&((n=i.user)==null?void 0:n.username)&&!uX(r)){const o=mp(r,!0);o&&jd.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&NIe(i.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&Gr){const o=Gr.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=Gr.findCredential(a,s.userId);l&&Gr._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:t?o=>t.headers.get(o):vX,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function ZIe(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[G9]=i,s;(i==null?void 0:i.error)&&(s=i.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&UIe.includes(n)&&!mfe(e.params.url)&&(n!==403||!zIe.includes(a)&&(o==null||o===2&&e.credentialToken))){await j9();try{const c=await Gr.getCredential(e.params.url,{error:ap("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=c}}if(s)throw s;return!0}function yee(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=jd.priority,s.src=e,pfe(s,e,i,r)}Zt._abortableFetch=null,Zt._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var gfe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Zt}),q0;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(q0||(q0={}));class YIe{constructor(t){this.instance=t,this._resolver=qv(),this._status=q0.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=q0.RESOLVED,this._cleanUp()},()=>{this._status=q0.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===q0.RESOLVED}isRejected(){return this._status===q0.REJECTED}isFulfilled(){return this._status!==q0.PENDING}abort(){this._resolver.reject(mi())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=qv(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||Jr(s)||this._resolver.reject(s)}),t.resolve()}}const X5=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new YIe(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=u([P("esri.core.Promise")],t),t};let vF=class extends X5(Se){};vF=u([P("esri.core.Promise")],vF);const QIe="not-loaded",JIe="loading",KIe="failed",vee="loaded",yfe=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=RW(n,l);this.destroyed&&l(new j("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===QIe){this._set("loadStatus",JIe);const a=this._loadController=new AbortController;s({signal:a.signal}),ha(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",vee),this._loadController=null},r=>{this._set("loadStatus",KIe),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===vee}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new j("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([d({readOnly:!0})],t.prototype,"loaded",null),u([d({readOnly:!0})],t.prototype,"loadError",void 0),u([d({clonable:!1})],t.prototype,"loadStatus",void 0),u([d({type:[ja],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([P("esri.core.Loadable")],t),t};let VA=class extends yfe(vF){};VA=u([P("esri.core.Loadable")],VA),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=yfe,e.isLoadable=t}(VA||(VA={}));const ey=VA;let iM;var yhe,vhe,_he;const s6=(_he=(yhe=globalThis.esriConfig)==null?void 0:yhe.locale)!=null?_he:(vhe=globalThis.dojoConfig)==null?void 0:vhe.locale;function vfe(){var e,t;return(t=s6!=null?s6:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function Mu(){return iM===void 0&&(iM=vfe()),iM}const rM=[];function _fe(e){return rM.push(e),{remove(){rM.splice(rM.indexOf(e),1)}}}const H9=[];function _X(e){return H9.push(e),{remove(){rM.splice(H9.indexOf(e),1)}}}function e$e(){const e=vfe();iM!==e&&(iM=e,[...H9].forEach(t=>{t.call(null,e)}),[...rM].forEach(t=>{t.call(null,e)}))}var bhe;(bhe=globalThis.addEventListener)==null||bhe.call(globalThis,"languagechange",e$e);var q9;const t$e=new wi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let oh=q9=class extends Se{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new q9({categories:this.categories?re(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=Qw(this.extent,et.WGS84);_(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>t$e.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:F(F({},t),n)}}};u([d()],oh.prototype,"categories",void 0),u([d()],oh.prototype,"disableExtraQuery",void 0),u([d({type:ai})],oh.prototype,"extent",void 0),u([d()],oh.prototype,"filter",void 0),u([d()],oh.prototype,"num",void 0),u([d()],oh.prototype,"query",void 0),u([d()],oh.prototype,"sortField",void 0),u([d()],oh.prototype,"sortOrder",null),u([d()],oh.prototype,"start",void 0),oh=q9=u([P("esri.portal.PortalQueryParams")],oh);const Sg=oh;let y1=class extends Se{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([d()],y1.prototype,"nextQueryParams",void 0),u([d()],y1.prototype,"queryParams",void 0),u([d()],y1.prototype,"results",void 0),u([d()],y1.prototype,"total",void 0),y1=u([P("esri.portal.PortalQueryResult")],y1);const i$e=y1;let Gm=class extends ve{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new j("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([d({type:Date})],Gm.prototype,"created",void 0),u([d()],Gm.prototype,"id",void 0),u([d()],Gm.prototype,"portal",void 0),u([d()],Gm.prototype,"title",void 0),u([d({readOnly:!0})],Gm.prototype,"url",null),u([d()],Gm.prototype,"username",void 0),Gm=u([P("esri.portal.PortalFolder")],Gm);const r$e=Gm;let Jn=class extends ve{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new j("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=Bs(Sg,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new Sg,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new Sg,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(i=>{const r=i.contentCategorySetsGroupQuery;if(r){const s=new Sg;return s.disableExtraQuery=!0,s.num=1,s.query=r,this.portal.queryGroups(s,t)}throw new j("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],s=new Sg;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new j("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(r=>{const s=r&&r.categorySchema;return s&&s.length?s:[]}):[])}};u([d()],Jn.prototype,"access",void 0),u([d({type:Date})],Jn.prototype,"created",void 0),u([d()],Jn.prototype,"description",void 0),u([d()],Jn.prototype,"id",void 0),u([d()],Jn.prototype,"isInvitationOnly",void 0),u([d({type:Date})],Jn.prototype,"modified",void 0),u([d()],Jn.prototype,"owner",void 0),u([d()],Jn.prototype,"portal",void 0),u([d()],Jn.prototype,"snippet",void 0),u([d()],Jn.prototype,"sortField",void 0),u([d()],Jn.prototype,"sortOrder",void 0),u([d()],Jn.prototype,"tags",void 0),u([d()],Jn.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Jn.prototype,"thumbnailUrl",null),u([d()],Jn.prototype,"title",void 0),u([d({readOnly:!0})],Jn.prototype,"url",null),Jn=u([P("esri.portal.PortalGroup")],Jn);const W9=Jn;var s$e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:W9}),X9;let es=X9=class extends ve{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=r$e.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=W9.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then(function(){return Z_e}).then(({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})}).then(r=>{let s;return r&&r.items?(s=r.items.map(n=>{const o=t.fromJSON(n);return o.portal=this.portal,o}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:r.nextStart,total:r.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new W9({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new j("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new j("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new X9;return t.sourceJSON=e,t.read(e),t}};u([d()],es.prototype,"access",void 0),u([d({type:Date})],es.prototype,"created",void 0),u([d()],es.prototype,"culture",void 0),u([d()],es.prototype,"description",void 0),u([d()],es.prototype,"email",void 0),u([d()],es.prototype,"favGroupId",void 0),u([d()],es.prototype,"fullName",void 0),u([d({type:Date})],es.prototype,"modified",void 0),u([d()],es.prototype,"orgId",void 0),u([d()],es.prototype,"portal",void 0),u([d()],es.prototype,"preferredView",void 0),u([d()],es.prototype,"privileges",void 0),u([d()],es.prototype,"region",void 0),u([d()],es.prototype,"role",void 0),u([d()],es.prototype,"roleId",void 0),u([d()],es.prototype,"sourceJSON",void 0),u([d()],es.prototype,"thumbnail",void 0),u([d({readOnly:!0})],es.prototype,"thumbnailUrl",null),u([d()],es.prototype,"units",void 0),u([d({readOnly:!0})],es.prototype,"userContentUrl",null),u([d({readOnly:!0})],es.prototype,"url",null),u([d()],es.prototype,"username",void 0),u([d()],es.prototype,"userType",void 0),es=X9=u([P("esri.portal.PortalUser")],es);const bX=es;var n$e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:bX}),Wc;let n6;const _ee={PortalGroup:()=>Promise.resolve().then(function(){return s$e}),PortalItem:()=>Promise.resolve().then(function(){return Z_e}),PortalUser:()=>Promise.resolve().then(function(){return n$e})};let Be=Wc=class extends Yw(ey){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Fi.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)Fi.request.trustedServers.includes(t)||Fi.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=bX.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then(function(){return WHe}).then(({default:i})=>{fi(e),n6=i}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(i=>{if(Gr){const r=Gr;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==Wc.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await import("./ElevationLayer.2437575f.js")).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}fetchBasemaps(e,t){const i=new Sg;return i.query=e||(Fi.apiKey&&dfe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new n6({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):nn(e)?Promise.reject(mi()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new Sg;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return nn(e)?Promise.reject(mi()):Promise.resolve([])}fetchRegions(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Mu();return this._request(this.restUrl+"/portals/regions",ye(F({},e),{query:{culture:t}}))}fetchSettings(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Mu();return this._request(this.restUrl+"/portals/self/settings",ye(F({},e),{query:{culture:t}}))}static getDefault(){return Wc._default&&!Wc._default.destroyed||(Wc._default=new Wc),Wc._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new j("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Wc({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new j("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new j("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s=F({authMode:e,query:{culture:Mu().toLowerCase()}},i);return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=Bs(Sg,t),n=o=>this._request(this.restUrl+e,F(F({},s.toRequestOptions(this)),r)).then(a=>{const l=s.clone();return l.start=a.nextStart,new i$e({nextQueryParams:l,queryParams:s,total:a.total,results:Wc._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(bc(l),a)));return i&&_ee[i]?_ee[i]().then(({default:o})=>(fi(r),n(o))):n()}_signIn(){if(this.authMode===Wc.AUTH_MODE_ANONYMOUS)return Promise.reject(new j("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return Gr?Gr.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then(r=>{const s=Wc._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=n6.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i=F({f:"json"},t.query),{authMode:r=this.authMode===Wc.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return Zt(this._normalizeSSL(e),c).then(h=>h.data)}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=_(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};Be.AUTH_MODE_ANONYMOUS="anonymous",Be.AUTH_MODE_AUTO="auto",Be.AUTH_MODE_IMMEDIATE="immediate",u([d()],Be.prototype,"access",void 0),u([d()],Be.prototype,"allSSL",void 0),u([d()],Be.prototype,"authMode",void 0),u([d()],Be.prototype,"authorizedCrossOriginDomains",void 0),u([Ie("authorizedCrossOriginDomains")],Be.prototype,"readAuthorizedCrossOriginDomains",null),u([d()],Be.prototype,"basemapGalleryGroupQuery",void 0),u([d()],Be.prototype,"bingKey",void 0),u([d()],Be.prototype,"canListApps",void 0),u([d()],Be.prototype,"canListData",void 0),u([d()],Be.prototype,"canListPreProvisionedItems",void 0),u([d()],Be.prototype,"canProvisionDirectPurchase",void 0),u([d()],Be.prototype,"canSearchPublic",void 0),u([d()],Be.prototype,"canShareBingPublic",void 0),u([d()],Be.prototype,"canSharePublic",void 0),u([d()],Be.prototype,"canSignInArcGIS",void 0),u([d()],Be.prototype,"canSignInIDP",void 0),u([d()],Be.prototype,"colorSetsGroupQuery",void 0),u([d()],Be.prototype,"commentsEnabled",void 0),u([d({type:Date})],Be.prototype,"created",void 0),u([d()],Be.prototype,"credential",void 0),u([d()],Be.prototype,"culture",void 0),u([d()],Be.prototype,"currentVersion",void 0),u([d()],Be.prototype,"customBaseUrl",void 0),u([d()],Be.prototype,"defaultBasemap",void 0),u([Ie("defaultBasemap")],Be.prototype,"readDefaultBasemap",null),u([d()],Be.prototype,"defaultDevBasemap",void 0),u([Ie("defaultDevBasemap")],Be.prototype,"readDefaultDevBasemap",null),u([d({type:ai})],Be.prototype,"defaultExtent",void 0),u([d()],Be.prototype,"defaultVectorBasemap",void 0),u([Ie("defaultVectorBasemap")],Be.prototype,"readDefaultVectorBasemap",null),u([d()],Be.prototype,"description",void 0),u([d()],Be.prototype,"devBasemapGalleryGroupQuery",void 0),u([d()],Be.prototype,"eueiEnabled",void 0),u([d({readOnly:!0})],Be.prototype,"extraQuery",null),u([d()],Be.prototype,"featuredGroups",void 0),u([d()],Be.prototype,"featuredItemsGroupQuery",void 0),u([d()],Be.prototype,"galleryTemplatesGroupQuery",void 0),u([d()],Be.prototype,"livingAtlasGroupQuery",void 0),u([d()],Be.prototype,"hasCategorySchema",void 0),u([d()],Be.prototype,"helpBase",void 0),u([d()],Be.prototype,"helperServices",void 0),u([d()],Be.prototype,"helpMap",void 0),u([d()],Be.prototype,"homePageFeaturedContent",void 0),u([d()],Be.prototype,"homePageFeaturedContentCount",void 0),u([d()],Be.prototype,"httpPort",void 0),u([d()],Be.prototype,"httpsPort",void 0),u([d()],Be.prototype,"id",void 0),u([d()],Be.prototype,"ipCntryCode",void 0),u([d({readOnly:!0})],Be.prototype,"isOrganization",null),u([d()],Be.prototype,"isPortal",void 0),u([d()],Be.prototype,"isReadOnly",void 0),u([d()],Be.prototype,"layerTemplatesGroupQuery",void 0),u([d()],Be.prototype,"maxTokenExpirationMinutes",void 0),u([d({type:Date})],Be.prototype,"modified",void 0),u([d()],Be.prototype,"name",void 0),u([d()],Be.prototype,"portalHostname",void 0),u([d()],Be.prototype,"portalMode",void 0),u([d()],Be.prototype,"portalProperties",void 0),u([d()],Be.prototype,"region",void 0),u([d({readOnly:!0})],Be.prototype,"restUrl",null),u([d()],Be.prototype,"rotatorPanels",void 0),u([d()],Be.prototype,"showHomePageDescription",void 0),u([d()],Be.prototype,"sourceJSON",void 0),u([d()],Be.prototype,"staticImagesUrl",void 0),u([d({json:{name:"2DStylesGroupQuery"}})],Be.prototype,"stylesGroupQuery2d",void 0),u([d({json:{name:"stylesGroupQuery"}})],Be.prototype,"stylesGroupQuery3d",void 0),u([d()],Be.prototype,"supportsHostedServices",void 0),u([d()],Be.prototype,"symbolSetsGroupQuery",void 0),u([d()],Be.prototype,"templatesGroupQuery",void 0),u([d()],Be.prototype,"thumbnail",void 0),u([d({readOnly:!0})],Be.prototype,"thumbnailUrl",null),u([d()],Be.prototype,"units",void 0),u([d()],Be.prototype,"url",void 0),u([d()],Be.prototype,"urlKey",void 0),u([Ie("urlKey")],Be.prototype,"readUrlKey",null),u([d()],Be.prototype,"user",void 0),u([Ie("user")],Be.prototype,"readUser",null),u([d()],Be.prototype,"useStandardizedQuery",void 0),u([d()],Be.prototype,"useVectorBasemaps",void 0),u([d()],Be.prototype,"vectorBasemapGalleryGroupQuery",void 0),Be=Wc=u([P("esri.portal.Portal")],Be);const Gn=Be;fe.getLogger("esri.core.Clonable");const Ic=e=>{let t=class extends e{clone(){var l;const i=nRe(ua(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),f=h.clonable;if(h.readOnly||f===!1||p!==Vt.USER&&p!==Vt.DEFAULTS&&p!==Vt.WEB_MAP&&p!==Vt.WEB_SCENE)continue;const m=this[c];let y=null;y=typeof f=="function"?f(m):f==="reference"?m:Z8(m),m!=null&&y==null||(p===Vt.DEFAULTS?o.set(c,y):n[c]=y)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=ua(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Vt.DEFAULTS)}return a}};return t=u([P("esri.core.Clonable")],t),t};let bee=class extends Ic(Se){};bee=u([P("esri.core.Clonable")],bee);let v1=class extends Ic(ve){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return _(e)&&e.placement===this.placement&&e.style===this.style&&(R(this.color)&&R(e.color)||_(this.color)&&_(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([d({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],v1.prototype,"type",void 0),u([d({type:bPe,json:{default:"begin-end",write:!0}})],v1.prototype,"placement",void 0),u([d({type:Rpe,json:{default:"arrow",write:!0}})],v1.prototype,"style",void 0),u([d({type:Pe,json:{type:[Br],default:null,write:!0}})],v1.prototype,"color",void 0),v1=u([P("esri.symbols.LineStyleMarker3D")],v1);const Z9=v1;var eD;let rf=eD=class extends um{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=$l(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:_(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:_(this.pattern)?this.pattern.clone():null,marker:_(this.marker)?this.marker.clone():null};return new eD(e)}static fromSimpleLineSymbol(e){var i,r,s;const t={enabled:!0,size:(i=e.width)!=null?i:$l(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new eX({style:e.style}):null,material:new Ru({color:(e.color||eM).clone()}),marker:e.marker?new Z9({placement:e.marker.placement,style:e.marker.style,color:(s=(r=e.marker.color)==null?void 0:r.clone())!=null?s:null}):null};return new eD(t)}};u([d({type:Ru,json:{write:!0}})],rf.prototype,"material",void 0),u([at({Line:"line"},{readOnly:!0})],rf.prototype,"type",void 0),u([d({type:Bpe,json:{write:!0,default:"miter"}})],rf.prototype,"join",void 0),u([d({type:oX,json:{write:!0,default:"butt"}})],rf.prototype,"cap",void 0),u([d(Xf)],rf.prototype,"size",void 0),u([d($pe)],rf.prototype,"pattern",void 0),u([d({types:{key:"type",base:Z9,typeMap:{style:Z9}},json:{write:!0}})],rf.prototype,"marker",void 0),rf=eD=u([P("esri.symbols.LineSymbol3DLayer")],rf);const P3=rf;var Y9;const o$e=fa()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let BA=Y9=class extends ve{clone(){return new Y9({href:this.href,primitive:this.primitive})}};u([d({type:String,json:{read:W5,write:Xv}})],BA.prototype,"href",void 0),u([at(o$e)],BA.prototype,"primitive",void 0),BA=Y9=u([P("esri.symbols.support.ObjectSymbol3DLayerResource")],BA);const wX="sphere";var Q9;let hb=Q9=class extends Se{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Q9({x:this.x,y:this.y,z:this.z})}};u([d({type:Number})],hb.prototype,"x",void 0),u([d({type:Number})],hb.prototype,"y",void 0),u([d({type:Number})],hb.prototype,"z",void 0),hb=Q9=u([P("esri.symbols.support.Symbol3DAnchorPosition3D")],hb);var J9;let wa=J9=class extends um{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new J9({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([d({type:Ru,json:{write:!0}})],wa.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],wa.prototype,"castShadows",void 0),u([d({type:BA,json:{write:!0}})],wa.prototype,"resource",void 0),u([at({Object:"object"},{readOnly:!0})],wa.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"width",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"height",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"depth",void 0),u([at({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),d({json:{default:"origin"}})],wa.prototype,"anchor",void 0),u([d({type:hb,json:{type:[Number],read:{reader:e=>new hb({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],wa.prototype,"anchorPosition",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"heading",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"tilt",void 0),u([d({type:Number,json:{write:!0}})],wa.prototype,"roll",void 0),u([d({readOnly:!0})],wa.prototype,"isPrimitive",null),wa=J9=u([P("esri.symbols.ObjectSymbol3DLayer")],wa);const xX=wa;var K9;let ol=K9=class extends um{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new K9({enabled:this.enabled,material:_(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([d({type:Ru,json:{write:!0}})],ol.prototype,"material",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ol.prototype,"castShadows",void 0),u([at({Path:"path"},{readOnly:!0})],ol.prototype,"type",void 0),u([d({type:["circle","quad"],json:{write:!0,default:"circle"}})],ol.prototype,"profile",void 0),u([d({type:Bpe,json:{write:!0,default:"miter"}})],ol.prototype,"join",void 0),u([d({type:BPe,json:{write:!0,default:"butt"}})],ol.prototype,"cap",void 0),u([d({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],ol.prototype,"width",void 0),u([Ie("width",["width","size","height"])],ol.prototype,"readWidth",null),u([d({type:Number,json:{write:!0}})],ol.prototype,"height",void 0),u([Ie("height",["height","size","width"])],ol.prototype,"readHeight",null),u([d({type:["center","bottom","top"],json:{write:!0,default:"center"}})],ol.prototype,"anchor",void 0),u([d({type:["heading","all"],json:{write:!0,default:"all"}})],ol.prototype,"profileRotation",void 0),ol=K9=u([P("esri.symbols.PathSymbol3DLayer")],ol);const TX=ol;var eG;let SS=eG=class extends ve{constructor(){super(...arguments),this.color=new Pe([0,0,0,1]),this.size=0}clone(){const e={color:re(this.color),size:this.size};return new eG(e)}};u([d(hy)],SS.prototype,"color",void 0),u([d(Xf)],SS.prototype,"size",void 0),SS=eG=u([P("esri.symbols.support.Symbol3DHalo")],SS);let sM=class extends Ic(ve){constructor(e){super(e),this.color=null}};u([d(hy)],sM.prototype,"color",void 0),sM=u([P("esri.symbols.support.Symbol3DTextBackground")],sM);var tD;let ql=tD=class extends um{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){_(e)&&_(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s=ye(F({},r),{textSymbol3D:!0});t.font=e.write({},s),delete t.font.size}get size(){return _(this._userSize)?this._userSize:_(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,_(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new tD({enabled:this.enabled,font:this.font&&re(this.font),halo:this.halo&&re(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:_(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:re(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new tD({font:_(e.font)?e.font.clone():new j5,halo:a$e(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new Ru({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new sM({color:e.backgroundColor.clone()}):null})}};function a$e(e,t){return e&&t>0?new SS({color:re(e),size:t}):null}u([d({type:j5,json:{write:!0}})],ql.prototype,"font",null),u([qe("font")],ql.prototype,"writeFont",null),u([d({type:SS,json:{write:!0}})],ql.prototype,"halo",void 0),u([d(ye(F({},jpe),{json:{default:"center",write:!0}}))],ql.prototype,"horizontalAlignment",void 0),u([d(ye(F({},Gpe),{json:{default:1,write:!0}}))],ql.prototype,"lineHeight",void 0),u([d({type:Ru,json:{write:!0}})],ql.prototype,"material",void 0),u([d({type:sM,json:{write:!0}})],ql.prototype,"background",void 0),u([d(Xf)],ql.prototype,"size",null),u([d({type:String,json:{write:!0}})],ql.prototype,"text",void 0),u([at({Text:"text"},{readOnly:!0})],ql.prototype,"type",void 0),u([d(ye(F({},Hpe),{json:{default:"baseline",write:!0}}))],ql.prototype,"verticalAlignment",void 0),ql=tD=u([P("esri.symbols.TextSymbol3DLayer")],ql);const ix=ql;var tG;let m0=tG=class extends um{constructor(e){super(e),this.color=iG.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new tG({color:re(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([d({type:Pe,nonNullable:!0,json:{type:[Br],write:(e,t,i)=>t[i]=e.toArray(Pe.AlphaMode.UNLESS_OPAQUE),default:()=>iG.clone(),defaultEquals:e=>e.toCss(!0)===iG.toCss(!0)}})],m0.prototype,"color",void 0),u([at({Water:"water"},{readOnly:!0})],m0.prototype,"type",void 0),u([d({type:["small","medium","large"],json:{write:!0,default:"medium"}})],m0.prototype,"waterbodySize",void 0),u([d({type:Number,json:{write:!0,default:null}})],m0.prototype,"waveDirection",void 0),u([d({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],m0.prototype,"waveStrength",void 0),m0=tG=u([P("esri.symbols.WaterSymbol3DLayer")],m0);const iG=new Pe([0,119,190]),bfe=m0;var rG;let _1=rG=class extends Se{constructor(){super(...arguments),this.portal=null}clone(){return new rG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([d({type:String})],_1.prototype,"name",void 0),u([d({type:String})],_1.prototype,"styleUrl",void 0),u([d({type:String})],_1.prototype,"styleName",void 0),u([d({type:Gn})],_1.prototype,"portal",void 0),_1=rG=u([P("esri.symbols.support.StyleOrigin")],_1);const tO=_1;var sG;let Zb=sG=class extends Se{clone(){return new sG({url:this.url})}};u([d({type:String})],Zb.prototype,"url",void 0),Zb=sG=u([P("esri.symbols.support.Thumbnail")],Zb);const wfe={icon:gv,object:xX,line:P3,path:TX,fill:G5,extrude:Ape,text:ix,water:bfe},l$e=ut.ofType({base:um,key:"type",typeMap:wfe,errorContext:"symbol-layer"}),c$e=fe.getLogger("esri.symbols.Symbol3D");let sf=class extends Oc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||ut;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&c$e.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){vw(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=Qf(e.styleUrl,i);return new tO({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new tO({portal:i&&i.portal||Gn.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new ja("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=Kg(e.styleUrl,r);wc(s)&&(s=fp(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!Ype(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new ja("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof um||e&&wfe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([d({json:{read:!1,write:!1}})],sf.prototype,"color",null),u([d({type:l$e,nonNullable:!0,json:{write:!0}}),qt(lfe)],sf.prototype,"symbolLayers",null),u([d({type:tO})],sf.prototype,"styleOrigin",void 0),u([Ie("styleOrigin")],sf.prototype,"readStyleOrigin",null),u([qe("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],sf.prototype,"writeStyleOrigin",null),u([d({type:Zb,json:{read:!1}})],sf.prototype,"thumbnail",void 0),u([d({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],sf.prototype,"type",void 0),sf=u([P("esri.symbols.Symbol3D")],sf);const jE=sf;let GA=class extends ve{constructor(e){super(e),this.visible=!0}clone(){}};u([d({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],GA.prototype,"type",void 0),u([d({readOnly:!0})],GA.prototype,"visible",void 0),GA=u([P("esri.symbols.callouts.Callout3D")],GA);const xfe=GA;var nG;let iD=nG=class extends ve{constructor(){super(...arguments),this.color=new Pe("white")}clone(){return new nG({color:re(this.color)})}};u([d(hy)],iD.prototype,"color",void 0),iD=nG=u([P("esri.symbols.callouts.LineCallout3DBorder")],iD);const Tfe=iD;Object.freeze(Object.defineProperty({__proto__:null,default:Tfe},Symbol.toStringTag,{value:"Module"}));var oG;let g0=oG=class extends xfe{constructor(e){super(e),this.type="line",this.color=new Pe([0,0,0,1]),this.size=$l(1),this.border=null}get visible(){return this.size>0&&_(this.color)&&this.color.a>0}clone(){return new oG({color:re(this.color),size:this.size,border:re(this.border)})}};u([at({line:"line"},{readOnly:!0})],g0.prototype,"type",void 0),u([d(hy)],g0.prototype,"color",void 0),u([d(Xf)],g0.prototype,"size",void 0),u([d({type:Tfe,json:{write:!0}})],g0.prototype,"border",void 0),u([d({readOnly:!0})],g0.prototype,"visible",null),g0=oG=u([P("esri.symbols.callouts.LineCallout3D")],g0);const u$e=g0;function SX(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function Sfe(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!SX(e)}function EX(e){return e.type==="point-3d"||e.type==="label-3d"}function Efe(e){return e.horizontalAlignment==="center"}const Cfe={types:{key:"type",base:xfe,typeMap:{line:u$e}},json:{write:!0}};var aG;let db=aG=class extends ve{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new aG({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([d(Xf)],db.prototype,"screenLength",void 0),u([d({type:Number,json:{write:!0,default:0}})],db.prototype,"minWorldLength",void 0),u([d({type:Number,json:{write:!0}})],db.prototype,"maxWorldLength",void 0),db=aG=u([P("esri.symbols.support.Symbol3DVerticalOffset")],db);var rD;const Afe=ut.ofType({base:null,key:"type",typeMap:{text:ix}});let y0=rD=class extends jE{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Afe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Sfe(this)}hasVisibleVerticalOffset(){return SX(this)}clone(){return new rD({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail),callout:re(this.callout),verticalOffset:re(this.verticalOffset)})}static fromTextSymbol(e){return new rD({symbolLayers:[ix.fromTextSymbol(e)]})}};u([d({type:db,json:{write:!0}})],y0.prototype,"verticalOffset",void 0),u([d(Cfe)],y0.prototype,"callout",void 0),u([d({json:{read:!1,write:!1}})],y0.prototype,"styleOrigin",void 0),u([d({type:Afe})],y0.prototype,"symbolLayers",void 0),u([at({LabelSymbol3D:"label-3d"},{readOnly:!0})],y0.prototype,"type",void 0),y0=rD=u([P("esri.symbols.LabelSymbol3D")],y0);const Z5=y0;var sD;const Rfe=ut.ofType({base:null,key:"type",typeMap:{line:P3,path:TX}}),h$e=ut.ofType({base:null,key:"type",typeMap:{line:P3,path:TX}});let jA=sD=class extends jE{constructor(e){super(e),this.symbolLayers=new Rfe,this.type="line-3d"}clone(){return new sD({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleLineSymbol(e){return new sD({symbolLayers:[P3.fromSimpleLineSymbol(e)]})}};u([d({type:Rfe,json:{type:h$e}})],jA.prototype,"symbolLayers",void 0),u([at({LineSymbol3D:"line-3d"},{readOnly:!0})],jA.prototype,"type",void 0),jA=sD=u([P("esri.symbols.LineSymbol3D")],jA);const Y5=jA;let v0=class extends Oc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],v0.prototype,"angle",void 0),u([d({type:["simple-marker","picture-marker"],readOnly:!0})],v0.prototype,"type",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],v0.prototype,"xoffset",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],v0.prototype,"yoffset",void 0),u([d({type:Number,cast:e=>e==="auto"?e:ir(e),json:{write:!0}})],v0.prototype,"size",void 0),v0=u([P("esri.symbols.MarkerSymbol")],v0);const Mfe=v0;var lG;const Ofe=ut.ofType({base:null,key:"type",typeMap:{fill:G5}});let HA=lG=class extends jE{constructor(e){super(e),this.symbolLayers=new Ofe,this.type="mesh-3d"}clone(){return new lG({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}};u([d({type:Ofe})],HA.prototype,"symbolLayers",void 0),u([at({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],HA.prototype,"type",void 0),HA=lG=u([P("esri.symbols.MeshSymbol3D")],HA);const CX=HA;function d$e(e,t,i){return t.imageData?Kpe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):Pfe(t.url,i)}function Pfe(e,t){return f$e(t)&&!wc(e)&&t.layer.parsedUrl?Ll(t.layer.parsedUrl.path,"images",e):Qf(e,t)}function p$e(e,t,i,r){if(hm(e)){const s=q5(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&Xv(i.url,t,"url",r)}else Xv(e,t,"url",r)}const Ife={json:{read:{source:["imageData","url"],reader:d$e},write:{writer(e,t,i,r){p$e(e,t,this.source,r)}}}},$fe={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=Pfe(t.url,i)),r}}}};function f$e(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var cG;let ah=cG=class extends Mpe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=ir(i)),r!=null&&(s.height=ir(r)),s}clone(){const e=new cG({color:re(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",re(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([at({esriPFS:"picture-fill"},{readOnly:!0})],ah.prototype,"type",void 0),u([d(Ife)],ah.prototype,"url",void 0),u([d({type:Number,json:{write:!0}})],ah.prototype,"xscale",void 0),u([d({type:Number,json:{write:!0}})],ah.prototype,"yscale",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],ah.prototype,"width",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],ah.prototype,"height",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],ah.prototype,"xoffset",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],ah.prototype,"yoffset",void 0),u([d($fe)],ah.prototype,"source",void 0),ah=cG=u([P("esri.symbols.PictureFillSymbol")],ah);const Lfe=ah;var uG;let bd=uG=class extends Mfe{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=ir(t)),i!=null&&(r.height=ir(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new uG({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",re(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([d({json:{write:!1}})],bd.prototype,"color",void 0),u([at({esriPMS:"picture-marker"},{readOnly:!0})],bd.prototype,"type",void 0),u([d(Ife)],bd.prototype,"url",void 0),u([d($fe)],bd.prototype,"source",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],bd.prototype,"height",void 0),u([Ie("height",["height","size"])],bd.prototype,"readHeight",null),u([d({type:Number,cast:ir,json:{write:!0}})],bd.prototype,"width",void 0),u([d({json:{write:!1}})],bd.prototype,"size",void 0),bd=uG=u([P("esri.symbols.PictureMarkerSymbol")],bd);const Q5=bd;var _0;const Dfe=ut.ofType({base:null,key:"type",typeMap:{icon:gv,object:xX,text:ix}});let b1=_0=class extends jE{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new Dfe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Sfe(this)}hasVisibleVerticalOffset(){return SX(this)}clone(){return new _0({verticalOffset:re(this.verticalOffset),callout:re(this.callout),styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new _0({symbolLayers:[gv.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new _0({symbolLayers:[gv.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var i,r;return((r=(i=e.data)==null?void 0:i.symbol)==null?void 0:r.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new _0({symbolLayers:[gv.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new _0({symbolLayers:[gv.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new _0({symbolLayers:[ix.fromTextSymbol(e)]})}};u([d({type:db,json:{write:!0}})],b1.prototype,"verticalOffset",void 0),u([d(Cfe)],b1.prototype,"callout",void 0),u([d({type:Dfe,json:{origins:{"web-scene":{write:!0}}}})],b1.prototype,"symbolLayers",void 0),u([at({PointSymbol3D:"point-3d"},{readOnly:!0})],b1.prototype,"type",void 0),b1=_0=u([P("esri.symbols.PointSymbol3D")],b1);const yv=b1;var qA;const Nfe=ut.ofType({base:null,key:"type",typeMap:{extrude:Ape,fill:G5,icon:gv,line:P3,object:xX,text:ix,water:bfe}});let WA=qA=class extends jE{constructor(e){super(e),this.symbolLayers=new Nfe,this.type="polygon-3d"}clone(){return new qA({styleOrigin:re(this.styleOrigin),symbolLayers:re(this.symbolLayers),thumbnail:re(this.thumbnail)})}static fromJSON(e){const t=new qA;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:_(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new qA({symbolLayers:[G5.fromSimpleFillSymbol(e)]})}};u([d({type:Nfe,json:{write:!0}})],WA.prototype,"symbolLayers",void 0),u([at({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],WA.prototype,"type",void 0),WA=qA=u([P("esri.symbols.PolygonSymbol3D")],WA);const I3=WA;var hG;const o6=new wi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let w1=hG=class extends Mpe{constructor(...e){super(...e),this.color=new Pe([0,0,0,.25]),this.outline=new Pc,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new hG({color:re(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([d()],w1.prototype,"color",void 0),u([d()],w1.prototype,"outline",void 0),u([at({esriSFS:"simple-fill"},{readOnly:!0})],w1.prototype,"type",void 0),u([d({type:o6.apiValues,json:{read:o6.read,write:o6.write}})],w1.prototype,"style",void 0),w1=hG=u([P("esri.symbols.SimpleFillSymbol")],w1);const dm=w1;var dG;const a6=new wi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let nf=dG=class extends Mfe{constructor(...e){super(...e),this.color=new Pe([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Pc}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=ir(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new dG({angle:this.angle,color:re(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([d()],nf.prototype,"color",void 0),u([qe("color")],nf.prototype,"writeColor",null),u([at({esriSMS:"simple-marker"},{readOnly:!0})],nf.prototype,"type",void 0),u([d()],nf.prototype,"size",void 0),u([d({type:a6.apiValues,json:{read:a6.read,write:a6.write}})],nf.prototype,"style",void 0),u([d({type:String,json:{write:!0}})],nf.prototype,"path",null),u([d({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Pc}},json:{default:null,write:!0}})],nf.prototype,"outline",void 0),nf=dG=u([P("esri.symbols.SimpleMarkerSymbol")],nf);const xc=nf;var pG;let us=pG=class extends Oc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new j5,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return ir(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new pG({angle:this.angle,backgroundColor:re(this.backgroundColor),borderLineColor:re(this.borderLineColor),borderLineSize:this.borderLineSize,color:re(this.color),font:this.font&&this.font.clone(),haloColor:re(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([d({type:Pe,json:{write:!0}})],us.prototype,"backgroundColor",void 0),u([d({type:Pe,json:{write:!0}})],us.prototype,"borderLineColor",void 0),u([d({type:Number,json:{write:!0}})],us.prototype,"borderLineSize",void 0),u([d({type:j5,json:{write:!0}})],us.prototype,"font",void 0),u([d(ye(F({},jpe),{json:{write:!0}}))],us.prototype,"horizontalAlignment",void 0),u([d({type:Boolean,json:{write:!0}})],us.prototype,"kerning",void 0),u([d({type:Pe,json:{write:!0}})],us.prototype,"haloColor",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],us.prototype,"haloSize",void 0),u([d({type:Boolean,json:{write:!0}})],us.prototype,"rightToLeft",void 0),u([d({type:Boolean,json:{write:!0}})],us.prototype,"rotated",void 0),u([d({type:String,json:{write:!0}})],us.prototype,"text",void 0),u([at({esriTS:"text"},{readOnly:!0})],us.prototype,"type",void 0),u([d(ye(F({},Hpe),{json:{write:!0}}))],us.prototype,"verticalAlignment",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],us.prototype,"xoffset",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],us.prototype,"yoffset",void 0),u([d({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],us.prototype,"angle",void 0),u([d({type:Number,json:{write:!0}})],us.prototype,"width",void 0),u([d({type:Number})],us.prototype,"lineWidth",void 0),u([qe("lineWidth")],us.prototype,"writeLineWidth",null),u([qt("lineWidth")],us.prototype,"castLineWidth",null),u([d(Gpe)],us.prototype,"lineHeight",void 0),u([qe("lineHeight")],us.prototype,"writeLineHeight",null),us=pG=u([P("esri.symbols.TextSymbol")],us);const HE=us;var fG;const m$e=fe.getLogger("esri.symbols.WebStyleSymbol");let wd=fG=class extends Oc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=_(this.portal)?this.portal:Gn.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new fG({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=_(t)?t.cache:null,r=i?this.fetchCacheKey:null;if(_(i)){const a=i.get(r);if(a)return a.clone()}const s=await g$e();fi(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{m$e.error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(_(i)&&i.set(r,o.clone()),o):null}};function g$e(){return Promise.resolve().then(function(){return Zwt})}u([d({json:{write:!1}})],wd.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],wd.prototype,"styleName",void 0),u([d({type:Gn,json:{write:!1}})],wd.prototype,"portal",void 0),u([d({type:String,json:{read:W5,write:Xv}})],wd.prototype,"styleUrl",void 0),u([d({type:Zb,json:{read:!1}})],wd.prototype,"thumbnail",void 0),u([d({type:String,json:{write:!0}})],wd.prototype,"name",void 0),u([at({styleSymbolReference:"web-style"},{readOnly:!0})],wd.prototype,"type",void 0),u([d()],wd.prototype,"fetchCacheKey",null),wd=fG=u([P("esri.symbols.WebStyleSymbol")],wd);const rx=wd;function J5(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function Jf(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Yb={base:Oc,key:"type",typeMap:{"simple-fill":dm,"picture-fill":Lfe,"picture-marker":Q5,"simple-line":Pc,"simple-marker":xc,text:HE,"label-3d":Z5,"line-3d":Y5,"mesh-3d":CX,"point-3d":yv,"polygon-3d":I3,"web-style":rx,cim:BE},errorContext:"symbol"},y$e={base:Oc,key:"type",typeMap:{"picture-marker":Q5,"simple-marker":xc,text:HE,"web-style":rx,cim:BE},errorContext:"symbol"},v$e=UE({types:Yb}),Ffe={base:Oc,key:"type",typeMap:{"simple-fill":dm,"picture-fill":Lfe,"picture-marker":Q5,"simple-line":Pc,"simple-marker":xc,text:HE,"line-3d":Y5,"mesh-3d":CX,"point-3d":yv,"polygon-3d":I3,"web-style":rx,cim:BE},errorContext:"symbol"},_$e={base:Oc,key:"type",typeMap:{text:HE,"label-3d":Z5},errorContext:"symbol"},wee={base:Oc,key:"type",typeMap:{"line-3d":Y5,"mesh-3d":CX,"point-3d":yv,"polygon-3d":I3,"web-style":rx,cim:BE},errorContext:"symbol"},b$e={base:Oc,key:"type",typeMap:{"label-3d":Z5},errorContext:"symbol"},kfe=wp(Yb),w$e=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function mG(e){return e instanceof Se}function xee(e){return e instanceof ut?Object.keys(e.items):mG(e)?ua(e).keys():e?Object.keys(e):[]}function YP(e,t){return e instanceof ut?e.items[t]:e[t]}function x$e(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function nM(e){return e?e.declaredClass:null}function Ufe(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=xee(e),s=xee(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||x$e(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&YP(e,p)!==YP(t,p)).concat(n,o).sort(),l=nM(e);if(l&&w$e.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=mG(e)&&mG(t);for(const p of a){const f=YP(e,p),m=YP(t,p);let y;if((h||typeof f!="function"&&typeof m!="function")&&f!==m&&(f!=null||m!=null)){if(i&&i[p]&&typeof i[p]=="function")y=i[p](f,m);else if(f instanceof Date&&m instanceof Date){if(f.getTime()===m.getTime())continue;y={type:"complete",oldValue:f,newValue:m}}else y=typeof f=="object"&&typeof m=="object"&&nM(f)===nM(m)?Ufe(f,m):{type:"complete",oldValue:f,newValue:m};_(y)&&(_(c)?c.diff[p]=y:c={type:"partial",diff:{[p]:y}})}}return c}function T$e(e,t){if(R(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function mSt(e,t){for(const i of t)if(T$e(e,i))return!0;return!1}function S$e(e,t){if(!(typeof e=="function"||typeof t=="function"||R(e)&&R(t)))return R(e)||R(t)||typeof e=="object"&&typeof t=="object"&&nM(e)!==nM(t)?{type:"complete",oldValue:e,newValue:t}:Ufe(e,t)}function QP(e){if(R(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!QP(i))return!1;for(const i of t.removed)if(!QP(i))return!1;for(const i of t.changed)if(!QP(i))return!1;return!0}case"partial":for(const t in e.diff)if(!QP(e.diff[t]))return!1;return!0}}var gG;let XA=gG=class extends ve{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new gG({minValue:this.minValue,maxValue:this.maxValue})}};u([d({type:Number,json:{write:!0}})],XA.prototype,"minValue",void 0),u([d({type:Number,json:{write:!0}})],XA.prototype,"maxValue",void 0),XA=gG=u([P("esri.renderer.support.AuthoringInfoClassBreakInfo")],XA);var yG;let W0=yG=class extends ve{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new yG({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:re(this.classBreakInfos)})}};u([d({type:String,json:{write:!0}})],W0.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],W0.prototype,"normalizationField",void 0),u([d({type:String,json:{write:!0}})],W0.prototype,"label",void 0),u([d({type:[XA],json:{write:!0}})],W0.prototype,"classBreakInfos",void 0),W0=yG=u([P("esri.renderers.support.AuthoringInfoFieldInfo")],W0);var vG;const JP=new wi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),KP=new wi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Tee={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},See=["high-to-low","above-and-below","centered-on","extremes"],Eee=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],Cee=["seconds","minutes","hours","days","months","years"];let Wl=vG=class extends ve{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new vG({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([d({types:Tee,json:{write:!0}})],Wl.prototype,"endTime",void 0),u([qt("endTime")],Wl.prototype,"castEndTime",null),u([d({type:String,json:{write:!0}})],Wl.prototype,"field",void 0),u([d({type:Number,json:{write:!0}})],Wl.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0}})],Wl.prototype,"minSliderValue",void 0),u([d({types:Tee,json:{write:!0}})],Wl.prototype,"startTime",void 0),u([qt("startTime")],Wl.prototype,"castStartTime",null),u([d({type:JP.apiValues,value:null,json:{type:JP.jsonValues,read:JP.read,write:JP.write}})],Wl.prototype,"style",null),u([d({type:Eee,value:null,json:{type:Eee,origins:{"web-scene":{type:See,write:{writer:(e,t)=>{See.includes(e)&&(t.theme=e)}}}},write:!0}})],Wl.prototype,"theme",null),u([d({type:KP.apiValues,json:{type:KP.jsonValues,read:KP.read,write:KP.write}})],Wl.prototype,"type",void 0),u([d({type:Cee,json:{type:Cee,write:!0}})],Wl.prototype,"units",void 0),Wl=vG=u([P("esri.renderers.support.AuthoringInfoVisualVariable")],Wl);const E$e=Wl;let nD=class extends ve{constructor(e){super(e),this.type=null}};u([d({readOnly:!0,json:{read:!1,write:!0}})],nD.prototype,"type",void 0),nD=u([P("esri.rest.support.ColorRamp")],nD);const AX=nD;var _G;let x1=_G=class extends AX{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new _G({fromColor:re(this.fromColor),toColor:re(this.toColor),algorithm:this.algorithm})}};u([at({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],x1.prototype,"algorithm",void 0),u([d({type:Pe,json:{type:[Br],write:!0}})],x1.prototype,"fromColor",void 0),u([d({type:Pe,json:{type:[Br],write:!0}})],x1.prototype,"toColor",void 0),u([d({type:["algorithmic"]})],x1.prototype,"type",void 0),x1=_G=u([P("esri.rest.support.AlgorithmicColorRamp")],x1);const RX=x1;var bG;let ZA=bG=class extends AX{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new bG({colorRamps:re(this.colorRamps)})}};u([d({type:[RX],json:{write:!0}})],ZA.prototype,"colorRamps",void 0),u([d({type:["multipart"]})],ZA.prototype,"type",void 0),ZA=bG=u([P("esri.rest.support.MultipartColorRamp")],ZA);const zfe=ZA,C$e={key:"type",base:AX,typeMap:{algorithmic:RX,multipart:zfe}};function A$e(e){return e&&e.type?e.type==="algorithmic"?RX.fromJSON(e):e.type==="multipart"?zfe.fromJSON(e):null:null}var wG;const M_=new wi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),eI=new wi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),Aee=new wi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),Ree=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],R$e=["high-to-low","above-and-below","above","below","90-10"],M$e=["flow-line","wave-front"],O$e=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let yn=wG=class extends ve{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return A$e(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new wG({classificationMethod:this.classificationMethod,colorRamp:re(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:re(this.field1),field2:re(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([d({type:M_.apiValues,value:null,json:{type:M_.jsonValues,read:M_.read,write:M_.write,origins:{"web-document":{default:"manual",type:M_.jsonValues,read:M_.read,write:M_.write}}}})],yn.prototype,"classificationMethod",null),u([d({types:C$e,json:{write:!0}})],yn.prototype,"colorRamp",void 0),u([Ie("colorRamp")],yn.prototype,"readColorRamp",null),u([d({type:[String],value:null,json:{write:!0}})],yn.prototype,"fields",null),u([d({type:W0,value:null,json:{write:!0}})],yn.prototype,"field1",null),u([d({type:W0,value:null,json:{write:!0}})],yn.prototype,"field2",null),u([d({type:M$e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],yn.prototype,"flowTheme",null),u([d({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],yn.prototype,"focus",null),u([d({type:Number,value:null,json:{type:Br,write:!0}})],yn.prototype,"numClasses",null),u([d({type:Ree,json:{type:Ree,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],yn.prototype,"lengthUnit",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],yn.prototype,"maxSliderValue",void 0),u([d({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],yn.prototype,"minSliderValue",void 0),u([d({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],yn.prototype,"statistics",null),u([d({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],yn.prototype,"standardDeviationInterval",null),u([d({type:eI.apiValues,value:null,json:{type:eI.jsonValues,read:eI.read,write:eI.write,origins:{"web-scene":{type:Aee.jsonValues,write:{writer:Aee.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],yn.prototype,"type",null),u([d({type:[E$e],json:{write:!0}})],yn.prototype,"visualVariables",void 0),u([d({type:O$e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],yn.prototype,"univariateSymbolStyle",null),u([d({type:R$e,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],yn.prototype,"univariateTheme",null),yn=wG=u([P("esri.renderers.support.AuthoringInfo")],yn);const Vfe=yn,l6=new wi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let YA=class extends ve{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([d({type:Vfe,json:{write:!0}})],YA.prototype,"authoringInfo",void 0),u([d({type:l6.apiValues,readOnly:!0,json:{type:l6.jsonValues,read:!1,write:{writer:l6.write,ignoreOrigin:!0}}})],YA.prototype,"type",void 0),YA=u([P("esri.renderers.Renderer")],YA);const dy=YA;var xG;let i2=xG=class extends ve{constructor(){super(...arguments),this.title=null}clone(){return new xG({title:this.title})}};u([d({type:String,json:{write:!0}})],i2.prototype,"title",void 0),i2=xG=u([P("esri.renderers.support.LegendOptions")],i2);var TG;let oD=TG=class extends i2{constructor(){super(...arguments),this.showLegend=null}clone(){return new TG({title:this.title,showLegend:this.showLegend})}};u([d({type:Boolean,json:{write:!0}})],oD.prototype,"showLegend",void 0),oD=TG=u([P("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],oD);const Bfe=oD,P$e=fe.getLogger("esri.renderers.visualVariables.VisualVariable"),c6=new wi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let xd=class extends ve{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(P$e.error(".field: field must be a string value"),null):x3(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([d()],xd.prototype,"index",void 0),u([d({type:c6.apiValues,readOnly:!0,json:{read:c6.read,write:c6.write}})],xd.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],xd.prototype,"field",void 0),u([qt("field")],xd.prototype,"castField",null),u([d({type:String,json:{write:!0}})],xd.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],xd.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],xd.prototype,"arcadeRequired",null),u([d({type:Bfe,json:{write:!0}})],xd.prototype,"legendOptions",void 0),xd=u([P("esri.renderers.visualVariables.VisualVariable")],xd);const $3=xd;var SG;let T1=SG=class extends ve{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e==null?0:e}clone(){return new SG({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([d({type:Pe,json:{type:[Br],write:!0}})],T1.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],T1.prototype,"label",void 0),u([d({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],T1.prototype,"value",void 0),u([qe("value")],T1.prototype,"writeValue",null),T1=SG=u([P("esri.renderers.visualVariables.support.ColorStop")],T1);const I$e=T1;var EG;let S1=EG=class extends $3{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new EG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],S1.prototype,"cache",null),u([d({type:["color"],json:{type:["colorInfo"]}})],S1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],S1.prototype,"normalizationField",void 0),u([d({type:[I$e],json:{write:!0}})],S1.prototype,"stops",null),S1=EG=u([P("esri.renderers.visualVariables.ColorVariable")],S1);const Gfe=S1;var CG;let b0=CG=class extends ve{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return k2(t.transparency)}writeOpacity(e,t,i){t[i]=U5(e)}clone(){return new CG({label:this.label,opacity:this.opacity,value:this.value})}};u([d({type:String,json:{write:!0}})],b0.prototype,"label",void 0),u([d({type:Number,json:{type:Br,write:{target:"transparency"}}})],b0.prototype,"opacity",void 0),u([Ie("opacity",["transparency"])],b0.prototype,"readOpacity",null),u([qe("opacity")],b0.prototype,"writeOpacity",null),u([d({type:Number,json:{write:!0}})],b0.prototype,"value",void 0),b0=CG=u([P("esri.renderers.visualVariables.support.OpacityStop")],b0);const $$e=b0;var AG;let E1=AG=class extends $3{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new AG({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],E1.prototype,"cache",null),u([d({type:["opacity"],json:{type:["transparencyInfo"]}})],E1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],E1.prototype,"normalizationField",void 0),u([d({type:[$$e],json:{write:!0}})],E1.prototype,"stops",null),E1=AG=u([P("esri.renderers.visualVariables.OpacityVariable")],E1);const jfe=E1;var RG;let jm=RG=class extends $3{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new j("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new RG({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([d({readOnly:!0})],jm.prototype,"cache",null),u([d({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],jm.prototype,"axis",void 0),u([d({type:["rotation"],json:{type:["rotationInfo"]}})],jm.prototype,"type",void 0),u([d({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],jm.prototype,"rotationType",void 0),u([d({type:String,json:{write:!0}})],jm.prototype,"valueExpressionTitle",void 0),u([qe("web-scene","valueExpressionTitle")],jm.prototype,"writeValueExpressionTitleWebScene",null),jm=RG=u([P("esri.renderers.visualVariables.RotationVariable")],jm);const Hfe=jm;var MG;let AT=MG=class extends ve{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new MG({label:this.label,size:this.size,value:this.value})}};u([d({type:String,json:{write:!0}})],AT.prototype,"label",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],AT.prototype,"size",void 0),u([d({type:Number,json:{write:!0}})],AT.prototype,"value",void 0),AT=MG=u([P("esri.renderers.visualVariables.support.SizeStop")],AT);const L$e=AT;var OG;let aD=OG=class extends Bfe{constructor(){super(...arguments),this.customValues=null}clone(){return new OG({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([d({type:[Number],json:{write:!0}})],aD.prototype,"customValues",void 0),aD=OG=u([P("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],aD);const qfe=aD;var Ng,uo;function ES(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function iO(e){return e!=null&&!isNaN(e)&&isFinite(e)}function Wfe(e){return e.valueExpression?Ng.Expression:e.field&&typeof e.field=="string"?Ng.Field:Ng.Unknown}function D$e(e,t){const i=t||Wfe(e),r=e.valueUnit||"unknown";return i===Ng.Unknown?uo.Constant:e.stops?uo.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?uo.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?uo.Proportional:uo.Additive:uo.Identity:uo.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(Ng||(Ng={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(uo||(uo={}));let lD=class extends ve{constructor(e){super(e),this.type=null}};u([d({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],lD.prototype,"type",void 0),lD=u([P("esri.popup.content.Content")],lD);const sx=lD;var PG;let C1=PG=class extends sx{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new PG({description:this.description,displayType:this.displayType,title:this.title})}};u([d({type:String,json:{write:!0}})],C1.prototype,"description",void 0),u([d({type:["auto","preview","list"],json:{write:!0}})],C1.prototype,"displayType",void 0),u([d({type:String,json:{write:!0}})],C1.prototype,"title",void 0),u([d({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],C1.prototype,"type",void 0),C1=PG=u([P("esri.popup.content.AttachmentsContent")],C1);const rO=C1;var IG;let A1=IG=class extends sx{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new IG({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?re(this.outFields):null})}};u([d()],A1.prototype,"creator",void 0),u([d()],A1.prototype,"destroyer",void 0),u([d()],A1.prototype,"outFields",void 0),u([d({type:["custom"],readOnly:!0})],A1.prototype,"type",void 0),A1=IG=u([P("esri.popup.content.CustomContent")],A1);const N$e=A1;var $G;let RT=$G=class extends ve{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new $G({title:this.title,expression:this.expression})}};u([d({type:String,json:{write:!0}})],RT.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],RT.prototype,"expression",void 0),u([d({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],RT.prototype,"returnType",void 0),RT=$G=u([P("esri.popup.ElementExpressionInfo")],RT);const Xfe=RT;var LG;let QA=LG=class extends sx{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new LG({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([d({type:Xfe,json:{write:!0}})],QA.prototype,"expressionInfo",void 0),u([d({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],QA.prototype,"type",void 0),QA=LG=u([P("esri.popup.content.ExpressionContent")],QA);const MX=QA,sO=fa()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});sO.toJSON.bind(sO);sO.fromJSON.bind(sO);const Pp={year:"numeric",month:"numeric",day:"numeric"},bC={year:"numeric",month:"long",day:"numeric"},wC={year:"numeric",month:"short",day:"numeric"},xC={year:"numeric",month:"long",weekday:"long",day:"numeric"},lh={hour:"numeric",minute:"numeric"},cd=ye(F({},lh),{second:"numeric"}),OX={"short-date":Pp,"short-date-short-time":F(F({},Pp),lh),"short-date-short-time-24":ye(F(F({},Pp),lh),{hour12:!1}),"short-date-long-time":F(F({},Pp),cd),"short-date-long-time-24":ye(F(F({},Pp),cd),{hour12:!1}),"short-date-le":Pp,"short-date-le-short-time":F(F({},Pp),lh),"short-date-le-short-time-24":ye(F(F({},Pp),lh),{hour12:!1}),"short-date-le-long-time":F(F({},Pp),cd),"short-date-le-long-time-24":ye(F(F({},Pp),cd),{hour12:!1}),"long-month-day-year":bC,"long-month-day-year-short-time":F(F({},bC),lh),"long-month-day-year-short-time-24":ye(F(F({},bC),lh),{hour12:!1}),"long-month-day-year-long-time":F(F({},bC),cd),"long-month-day-year-long-time-24":ye(F(F({},bC),cd),{hour12:!1}),"day-short-month-year":wC,"day-short-month-year-short-time":F(F({},wC),lh),"day-short-month-year-short-time-24":ye(F(F({},wC),lh),{hour12:!1}),"day-short-month-year-long-time":F(F({},wC),cd),"day-short-month-year-long-time-24":ye(F(F({},wC),cd),{hour12:!1}),"long-date":xC,"long-date-short-time":F(F({},xC),lh),"long-date-short-time-24":ye(F(F({},xC),lh),{hour12:!1}),"long-date-long-time":F(F({},xC),cd),"long-date-long-time-24":ye(F(F({},xC),cd),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":lh,"long-time":cd},nO=fa()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});nO.apiValues;nO.toJSON.bind(nO);nO.fromJSON.bind(nO);const F$e={ar:"ar-u-nu-latn-ca-gregory"};let cD=new WeakMap,Zfe=OX["short-date-short-time"];function k$e(e){const t=e||Zfe;if(!cD.has(t)){const i=Mu(),r=F$e[Mu()]||i;cD.set(t,new Intl.DateTimeFormat(r,t))}return cD.get(t)}function K5(e){return OX[e]||null}function Kf(e,t){return k$e(t).format(e)}_X(()=>{cD=new WeakMap,Zfe=OX["short-date-short-time"]});const U$e={ar:"ar-u-nu-latn"};let uD=new WeakMap,Yfe={};function z$e(e){const t=e||Yfe;if(!uD.has(t)){const i=Mu(),r=U$e[Mu()]||i;uD.set(t,new Intl.NumberFormat(r,e))}return uD.get(t)}function Qfe(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Wh(e,t){return e===-0&&(e=0),z$e(t).format(e)}_X(()=>{uD=new WeakMap,Yfe={}});var DG;let R1=DG=class extends ve{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new DG({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Kf(e,F(F({},K5(this.dateFormat)),this.dateTimeFormatOptions)):Wh(e,Qfe(this))}formatRasterPixelValue(e){let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(";")?(t=";",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,this)):this.format(Number(e))}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(s=>this.format(Number(s))).join(i):e}};u([at(sO)],R1.prototype,"dateFormat",void 0),u([d({type:Object,json:{read:!1}})],R1.prototype,"dateTimeFormatOptions",void 0),u([d({type:Boolean,json:{write:!0}})],R1.prototype,"digitSeparator",void 0),u([d({type:Br,json:{write:!0}})],R1.prototype,"places",void 0),R1=DG=u([P("esri.popup.support.FieldInfoFormat")],R1);const CS=R1;var NG;let Td=NG=class extends ve{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new NG({fieldName:this.fieldName,format:this.format?re(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([d({type:String,json:{write:!0}})],Td.prototype,"fieldName",void 0),u([d({type:CS,json:{write:!0}})],Td.prototype,"format",void 0),u([d({type:Boolean,json:{write:!0,default:!1}})],Td.prototype,"isEditable",void 0),u([d({type:String,json:{write:!0}})],Td.prototype,"label",void 0),u([at(new wi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Td.prototype,"stringFieldOption",void 0),u([d({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Td.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],Td.prototype,"tooltip",void 0),u([d({type:Boolean,json:{write:!0}})],Td.prototype,"visible",void 0),Td=NG=u([P("esri.popup.FieldInfo")],Td);const L3=Td;var FG;let Hm=FG=class extends sx{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new FG(re({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([d({type:Object,json:{write:!0}})],Hm.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Hm.prototype,"description",void 0),u([d({type:[L3]})],Hm.prototype,"fieldInfos",void 0),u([qe("fieldInfos")],Hm.prototype,"writeFieldInfos",null),u([d({type:String,json:{write:!0}})],Hm.prototype,"title",void 0),u([d({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Hm.prototype,"type",void 0),Hm=FG=u([P("esri.popup.content.FieldsContent")],Hm);const V2=Hm;let M1=class extends ve{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([d({type:String,json:{write:!0}})],M1.prototype,"altText",void 0),u([d({type:String,json:{write:!0}})],M1.prototype,"caption",void 0),u([d({type:String,json:{write:!0}})],M1.prototype,"title",void 0),u([d({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],M1.prototype,"type",void 0),M1=u([P("esri.popup.content.mixins.MediaInfo")],M1);const PX=M1;var kG;let MT=kG=class extends Se{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new kG({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([d()],MT.prototype,"fieldName",void 0),u([d()],MT.prototype,"tooltip",void 0),u([d()],MT.prototype,"value",void 0),MT=kG=u([P("esri.popup.content.support.ChartMediaInfoValueSeries")],MT);const Jfe=MT;var UG;let O1=UG=class extends ve{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new UG({fields:re(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([d({type:[String],json:{write:!0}})],O1.prototype,"fields",void 0),u([d({type:String,json:{write:!0}})],O1.prototype,"normalizeField",void 0),u([d({type:[Jfe],json:{read:!1}})],O1.prototype,"series",void 0),u([d({type:String,json:{write:!0}})],O1.prototype,"tooltipField",void 0),O1=UG=u([P("esri.popup.content.support.ChartMediaInfoValue")],O1);const V$e=O1;let JA=class extends PX{constructor(e){super(e),this.type=null,this.value=null}};u([d({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],JA.prototype,"type",void 0),u([d({type:V$e,json:{write:!0}})],JA.prototype,"value",void 0),JA=u([P("esri.popup.content.mixins.ChartMediaInfo")],JA);const ek=JA,tk=fa()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var zG;let hD=zG=class extends ek{constructor(e){super(e),this.type="bar-chart"}clone(){return new zG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:tk.write}})],hD.prototype,"type",void 0),hD=zG=u([P("esri.popup.content.BarChartMediaInfo")],hD);const Kfe=hD;var VG;let dD=VG=class extends ek{constructor(e){super(e),this.type="column-chart"}clone(){return new VG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:tk.write}})],dD.prototype,"type",void 0),dD=VG=u([P("esri.popup.content.ColumnChartMediaInfo")],dD);const eme=dD;var BG;let KA=BG=class extends ve{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new BG({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([d({type:String,json:{write:!0}})],KA.prototype,"linkURL",void 0),u([d({type:String,json:{write:!0}})],KA.prototype,"sourceURL",void 0),KA=BG=u([P("esri.popup.content.support.ImageMediaInfoValue")],KA);const B$e=KA;var GG;let OT=GG=class extends PX{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new GG({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([d({type:Number,json:{write:!0}})],OT.prototype,"refreshInterval",void 0),u([d({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],OT.prototype,"type",void 0),u([d({type:B$e,json:{write:!0}})],OT.prototype,"value",void 0),OT=GG=u([P("esri.popup.content.ImageMediaInfo")],OT);const tme=OT;var jG;let pD=jG=class extends ek{constructor(e){super(e),this.type="line-chart"}clone(){return new jG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:tk.write}})],pD.prototype,"type",void 0),pD=jG=u([P("esri.popup.content.LineChartMediaInfo")],pD);const ime=pD;var HG;let fD=HG=class extends ek{constructor(e){super(e),this.type="pie-chart"}clone(){return new HG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([d({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:tk.write}})],fD.prototype,"type",void 0),fD=HG=u([P("esri.popup.content.PieChartMediaInfo")],fD);const rme=fD,sme={base:PX,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Kfe,"column-chart":eme,"line-chart":ime,"pie-chart":rme,image:tme}};var qG;let Sd=qG=class extends sx{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?tme.fromJSON(t):t.type==="barchart"?Kfe.fromJSON(t):t.type==="columnchart"?eme.fromJSON(t):t.type==="linechart"?ime.fromJSON(t):t.type==="piechart"?rme.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new qG(re({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([d()],Sd.prototype,"activeMediaInfoIndex",void 0),u([d({type:Object,json:{write:!0}})],Sd.prototype,"attributes",void 0),u([d({type:String,json:{write:!0}})],Sd.prototype,"description",void 0),u([d({types:[sme]})],Sd.prototype,"mediaInfos",void 0),u([Ie("mediaInfos")],Sd.prototype,"readMediaInfos",null),u([qe("mediaInfos")],Sd.prototype,"writeMediaInfos",null),u([d({type:String,json:{write:!0}})],Sd.prototype,"title",void 0),u([d({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Sd.prototype,"type",void 0),Sd=qG=u([P("esri.popup.content.MediaContent")],Sd);const oO=Sd;var WG;let eR=WG=class extends sx{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new WG({text:this.text})}};u([d({type:String,json:{write:!0}})],eR.prototype,"text",void 0),u([d({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],eR.prototype,"type",void 0),eR=WG=u([P("esri.popup.content.TextContent")],eR);const B2=eR,G$e={base:null,key:"type",typeMap:{attachment:rO,media:oO,text:B2,expression:MX,field:V2}};var XG;let P1=XG=class extends ve{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new XG({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],P1.prototype,"name",void 0),u([d({type:String,json:{write:!0}})],P1.prototype,"title",void 0),u([d({type:String,json:{write:!0}})],P1.prototype,"expression",void 0),u([d({type:["string","number"],json:{write:!0}})],P1.prototype,"returnType",void 0),P1=XG=u([P("esri.popup.ExpressionInfo")],P1);const nme=P1;var ZG;let tR=ZG=class extends ve{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new ZG({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([d({type:Boolean,json:{write:!0}})],tR.prototype,"returnTopmostRaster",void 0),u([d({type:Boolean,json:{write:!0}})],tR.prototype,"showNoDataRecords",void 0),tR=ZG=u([P("esri.popup.LayerOptions")],tR);const j$e=tR;var YG;let iR=YG=class extends ve{constructor(e){super(e),this.field=null,this.order=null}clone(){return new YG({field:this.field,order:this.order})}};u([d({type:String,json:{write:!0}})],iR.prototype,"field",void 0),u([d({type:["asc","desc"],json:{write:!0}})],iR.prototype,"order",void 0),iR=YG=u([P("esri.popup.support.RelatedRecordsInfoFieldOrder")],iR);const ome=iR;var QG;let rR=QG=class extends ve{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new QG({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?re(this.orderByFields):null})}};u([d({type:Boolean,json:{write:!0}})],rR.prototype,"showRelatedRecords",void 0),u([d({type:[ome],json:{write:!0}})],rR.prototype,"orderByFields",void 0),rR=QG=u([P("esri.popup.RelatedRecordsInfo")],rR);const H$e=rR;let q$e=0;const IX=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+q$e++})}};return t=u([P("esri.core.Identifiable")],t),t};let Mee=class extends IX(class{}){};Mee=u([P("esri.core.Identifiable")],Mee);var JG;let Ed=JG=class extends IX(Se){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new JG({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([d()],Ed.prototype,"active",void 0),u([d()],Ed.prototype,"className",void 0),u([d()],Ed.prototype,"disabled",void 0),u([d()],Ed.prototype,"id",void 0),u([d()],Ed.prototype,"indicator",void 0),u([d()],Ed.prototype,"title",void 0),u([d()],Ed.prototype,"type",void 0),u([d()],Ed.prototype,"visible",void 0),Ed=JG=u([P("esri.support.actions.ActionBase")],Ed);const ik=Ed;var KG;let mD=KG=class extends ik{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new KG({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([d()],mD.prototype,"image",void 0),mD=KG=u([P("esri.support.Action.ActionButton")],mD);const qE=mD;var e7;let sR=e7=class extends ik{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new e7({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([d()],sR.prototype,"image",void 0),u([d()],sR.prototype,"value",void 0),sR=e7=u([P("esri.support.Action.ActionToggle")],sR);const ame=sR;var t7;const W$e=ut.ofType({key:"type",defaultKeyValue:"button",base:ik,typeMap:{button:qE,toggle:ame}}),X$e={base:sx,key:"type",typeMap:{media:oO,custom:N$e,text:B2,attachments:rO,fields:V2,expression:MX}},lme="esri.PopupTemplate",Z$e=fe.getLogger(lme),Y$e=["attachments","fields","media","text","expression"];let Rn=t7=class extends ve{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>wp(X$e,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Vu(e)?e:(Z$e.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>Y$e.includes(s.type)).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(r);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?re(e.toArray()):[];return new t7({actions:t,content:Array.isArray(this.content)?re(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?re(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?re(this.fieldInfos):null,layerOptions:this.layerOptions?re(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?re(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?re(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),QM(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=re(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=re(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),oO.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),B2.fromJSON(s)):s.type==="attachments"?rO.fromJSON(s):s.type==="fields"?V2.fromJSON(s):s.type==="expression"?MX.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new B2({text:e})):r.push(new V2),Array.isArray(t)&&t.length&&r.push(oO.fromJSON({mediaInfos:t})),i&&r.push(rO.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((r,s)=>[...r,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>Il(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([d({type:W$e})],Rn.prototype,"actions",void 0),u([d()],Rn.prototype,"content",void 0),u([qt("content")],Rn.prototype,"castContent",null),u([Ie("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],Rn.prototype,"readContent",null),u([qe("content",{popupElements:{type:ut.ofType(G$e)},showAttachments:{type:Boolean},mediaInfos:{type:ut.ofType(sme)},description:{type:String}})],Rn.prototype,"writeContent",null),u([d({type:[nme],json:{write:!0}})],Rn.prototype,"expressionInfos",void 0),u([d({type:[L3]})],Rn.prototype,"fieldInfos",void 0),u([qe("fieldInfos")],Rn.prototype,"writeFieldInfos",null),u([d({type:j$e})],Rn.prototype,"layerOptions",void 0),u([qe("layerOptions")],Rn.prototype,"writeLayerOptions",null),u([d({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Rn.prototype,"lastEditInfoEnabled",void 0),u([d()],Rn.prototype,"outFields",void 0),u([d()],Rn.prototype,"overwriteActions",void 0),u([d()],Rn.prototype,"returnGeometry",void 0),u([d({json:{type:String}})],Rn.prototype,"title",void 0),u([qe("title")],Rn.prototype,"writeTitle",null),u([d({type:H$e,json:{write:!0}})],Rn.prototype,"relatedRecordsInfo",void 0),Rn=t7=u([P(lme)],Rn);const WE=Rn;function Q$e(e){if(!e)return null;const t={};for(const i in e){const r=Qg(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function J$e(e){if(!_(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let Xl=class extends Ic(ve){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Cl(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&_(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:J$e(this.aggregateGeometries),geometry:_(this.geometry)?this.geometry.toJSON():null,symbol:_(this.symbol)?this.symbol.toJSON():null,attributes:F({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){_(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};u([d({value:null,json:{read:Q$e}})],Xl.prototype,"aggregateGeometries",null),u([d({value:null})],Xl.prototype,"attributes",null),u([d({value:null,types:Kw,json:{read:Qg}})],Xl.prototype,"geometry",null),u([d({type:Boolean})],Xl.prototype,"isAggregate",void 0),u([d({clonable:"reference"})],Xl.prototype,"layer",void 0),u([d({type:WE})],Xl.prototype,"popupTemplate",void 0),u([d({clonable:"reference"})],Xl.prototype,"sourceLayer",void 0),u([d({value:null,types:Yb})],Xl.prototype,"symbol",null),u([d({type:Boolean,value:!0})],Xl.prototype,"visible",null),Xl=u([P("esri.Graphic")],Xl),function(e){e.generateUID=Cl}(Xl||(Xl={}));const Ha=Xl;function gSt(e){}function K$e(e){return()=>e}function $X(e){return new et({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const cme=$X(Pi),_F=$X(Uf),bF=$X(Yg),eLe=new et({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Pi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function em(e){return e&&(lm(e)||e===_F)?_F:e&&(cm(e)||e===bF)?bF:cme}function Ci(e){return e&&(lm(e)||e===_F)?Uf:e&&(cm(e)||e===bF)?Yg:Pi}function ySt(e){return PW(e)?Uf:IW(e)?Yg:Pi}const ume=39.37,tLe=Pi.radius*Math.PI/200,hme=/UNIT\[([^\]]+)\]\]$/i,Qb=N,dme=/UNIT\[([^\]]+)\]/i,iLe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),rLe=fa()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Ip=e=>e*e,My=e=>e*e*e,aO={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Ip(.001)},"square-centimeters":{inBaseUnits:Ip(.01)},"square-decimeters":{inBaseUnits:Ip(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Ip(1e3)},"square-inches":{inBaseUnits:Ip(.0254)},"square-feet":{inBaseUnits:Ip(.3048)},"square-yards":{inBaseUnits:Ip(.9144)},"square-miles":{inBaseUnits:Ip(1609.344)},"square-us-feet":{inBaseUnits:Ip(1200/3937)},acres:{inBaseUnits:.0015625*Ip(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*My(.001)},"cubic-centimeters":{inBaseUnits:1e3*My(.01)},"cubic-decimeters":{inBaseUnits:1e3*My(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*My(1e3)},"cubic-inches":{inBaseUnits:1e3*My(.0254)},"cubic-feet":{inBaseUnits:1e3*My(.3048)},"cubic-yards":{inBaseUnits:1e3*My(.9144)},"cubic-miles":{inBaseUnits:1e3*My(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},sLe=(()=>{const e={};for(const t in aO)for(const i in aO[t].units)e[i]=t;return e})();function nLe(e,t,i){return e*aO[i].units[t].inBaseUnits}function oLe(e,t,i){return e/aO[i].units[t].inBaseUnits}const aLe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function i7(e){const t=sLe[e];if(!t)throw new Error("unknown type");return t}function Oee(e,t=null){return t=t||i7(e),aO[t].baseUnit===e}function tn(e,t,i){if(t===i)return e;const r=i7(t);if(r!==i7(i))throw new Error("incompatible units");const s=Oee(t,r)?e:nLe(e,t,r);return Oee(i,r)?s:oLe(s,i,r)}function lLe(e,t){const i=tn(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function cLe(e,t){const i=tn(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function uLe(e,t){const i=tn(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function hLe(e,t){const i=tn(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function vSt(e,t){const i=tn(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function _St(e,t){const i=tn(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function dLe(e,t,i){return tn(e,t,"meters")/(i*Math.PI/180)}function pme(e){return rLe.fromJSON(e.toLowerCase())||null}function G2(e){if(e&&typeof e=="object"&&!XM(e))return 1;const t=$c(e);return t>1e5?1:t}function pLe(e){return $c(e)>=(e instanceof et?Ci(e).metersPerDegree:1e5)?"meters":LX(e)}function $c(e,t=Pi.metersPerDegree){return vt(fLe(e,!0),t)}function fLe(e,t=!1){let i,r,s=null;if(e!=null&&(typeof e=="object"?(i=e.wkid,r=e.wkt):typeof e=="number"?i=e:typeof e=="string"&&(r=e)),i){if(PW(i))return Uf.metersPerDegree;if(IW(i))return Yg.metersPerDegree;s=Qb.values[Qb[i]],!s&&t&&iLe.has(i)&&(s=tLe)}else r&&(gme(r)?s=Pee(hme.exec(r),s):mme(r)&&(s=Pee(dme.exec(r),s)));return s}function Pee(e,t){return e&&e[1]?fme(e[1]):t}function fme(e){return parseFloat(e.split(",")[1])}function LX(e){let t,i,r=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,i=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(i=e)),t)r=Qb.units[Qb[t]];else if(i){const s=gme(i)?hme:mme(i)?dme:null;if(s){const n=s.exec(i);n&&n[1]&&(r=gLe(n[1]))}}return _(r)?pme(r):null}function bSt(e){const t=LX(e);return R(t)||!aLe.includes(t)?null:t}function mme(e){return/^GEOCCS/i.test(e)}function gme(e){return/^PROJCS/i.test(e)}const mLe=1e-7;function gLe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!Qb.units.includes(i)){const r=fme(e);i=null;const s=Qb.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<mLe){i=Qb.units[n];break}}return i}function yLe(e){const t=LX(e);if(R(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function wSt(e){var s,n,o;const t="metric";if(R(e))return t;const i=e.map,r=i&&"portalItem"in i?(s=i.portalItem)==null?void 0:s.portal:null;if(r)switch((o=(n=r==null?void 0:r.user)==null?void 0:n.units)!=null?o:r.units){case t:return t;case"english":return"imperial"}return vt(yLe(e.spatialReference),t)}const yme={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},vme={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},vLe=fa()(yme),_Le=fa()(vme);fa()(F(F({},yme),vme));const j2={inches:tn(1,"meters","inches"),feet:tn(1,"meters","feet"),"us-feet":tn(1,"meters","us-feet"),yards:tn(1,"meters","yards"),miles:tn(1,"meters","miles"),"nautical-miles":tn(1,"meters","nautical-miles"),millimeters:tn(1,"meters","millimeters"),centimeters:tn(1,"meters","centimeters"),decimeters:tn(1,"meters","decimeters"),meters:tn(1,"meters","meters"),kilometers:tn(1,"meters","kilometers"),"decimal-degrees":1/dLe(1,"meters",Pi.radius)},Zv=fe.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Iee=new Ha,gD=Math.PI,_me=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function bme(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Zv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].color}if(typeof a!="number")if(h){if(R(i)||R(i.arcade))return void Zv.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,w=v.getViewInfo(y),b=v.createExecContext(n,w);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=NX(a,c);if(y){const v=y[0],w=y[1],b=v===w?r.stops[v].color:Pe.blendColors(r.stops[v].color,r.stops[w].color,y[2],_(i)?i.color:void 0);return new Pe(b)}}}function wme(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(y=>y.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Zv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const y=r.stops;return y&&y[0]&&y[0].opacity}if(typeof a!="number")if(h){if(R(i)||R(i.arcade))return void Zv.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,w=v.getViewInfo(y),b=v.createExecContext(n,w);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}a=v.executeFunction(p,b)}else o&&(a=o[l]);const f=r.normalizationField,m=o?parseFloat(o[f]):void 0;if(a!=null&&(!f||s||!isNaN(m)&&m!==0)){isNaN(m)||s||(a/=m);const y=NX(a,c);if(y){const v=y[0],w=y[1];if(v===w)return r.stops[v].opacity;{const b=r.stops[v].opacity;return b+(r.stops[w].opacity-b)*y[2]}}}}function xme(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(m=>m.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Zv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!h)return f;if(h){if(R(i)||R(i.arcade))return void Zv.error("Use of arcade expressions requires an arcade context");const m={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},y=i.arcade.arcadeUtils,v=y.getViewInfo(m),w=y.createExecContext(a,v);if(!p){const b=y.createSyntaxTree(r.valueExpression);p=y.createFunction(b),r.cache.compiledFunc=p}f=y.executeFunction(p,w)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:n+o*f,f}function bLe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=_(i)?i.scale:void 0,p=_(i)?i.view:void 0;o=h==null||p==="3d"?wLe(e):h}else if(!r)switch(e.inputValueType){case Ng.Expression:{if(R(i)||R(i.arcade))return void Zv.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(h),m=p.createExecContext(s,f);if(!l){const y=p.createSyntaxTree(e.valueExpression);l=p.createFunction(y),e.cache.compiledFunc=l}o=p.executeFunction(l,m);break}case Ng.Field:n&&(o=n[e.field]);break;case Ng.Unknown:o=null}if(!iO(o))return null;if(r||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return iO(c)&&c!==0?o/c:null}function wLe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function rk(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Zv.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=Sme(bLe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Tc(e,t,i){return e==null?null:ES(e)?rk(e,t,i):iO(e)?e:null}function Tme(e,t,i){return iO(i)&&e>i?i:iO(t)&&e<t?t:e}function xLe(e,t,i,r){return e+(Tc(t.minSize,i,r)||t.minDataValue)}function TLe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),Tc(s,t,i)}function SLe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Tc(t.minSize,i,r),o=Tc(t.maxSize,i,r),a=_(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?gD*(n/2)**2:n*n,h=c+s*((l?gD*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/gD):Math.sqrt(h)}return n+s*(o-n)}function ELe(e,t,i,r){const s=_(r)?r.shape:void 0,n=e/t.minDataValue,o=Tc(t.minSize,i,r),a=Tc(t.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,Tme(l,o,a)}function CLe(e,t,i,r,s){const[n,o,a]=NX(e,s);if(n===o)return Tc(t.stops[n].size,i,r);{const l=Tc(t.stops[n].size,i,r);return l+(Tc(t.stops[o].size,i,r)-l)*a}}function ALe(e,t,i,r){const s=(_(r)&&r.resolution?r.resolution:1)*j2[t.valueUnit],n=Tc(t.minSize,i,r),o=Tc(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/gD)/s:a==="radius"||a==="distance"?2*e/s:e/s,Tme(l,n,o)}function Sme(e,t,i,r,s){switch(t.transformationType){case uo.Additive:return xLe(e,t,i,r);case uo.Constant:return TLe(t,i,r);case uo.ClampedLinear:return SLe(e,t,i,r);case uo.Proportional:return ELe(e,t,i,r);case uo.Stops:return CLe(e,t,i,r,s);case uo.RealWorldSize:return ALe(e,t,i,r);case uo.Identity:return e;case uo.Unknown:return null}}function RLe(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=Tc(e.minSize,Iee,s),o=Tc(e.maxSize,Iee,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function DX(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=bme(l,t,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=wme(l,t,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=xme(l,t,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=rk(l,t,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function NX(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function MLe(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":rk(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}var nx=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAllSizes:MLe,getColor:bme,getOpacity:wme,getRotationAngle:xme,getSize:rk,getSizeForValue:Sme,getSizeFromNumberOrVariable:Tc,getSizeRangeAtScale:RLe,getVisualVariableValues:DX,viewScaleRE:_me}),r7;const gx=fe.getLogger("esri.renderers.visualVariables.SizeVariable"),tI=new wi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),s7=new wi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function $ee(e){if(e!=null)return typeof e=="string"||typeof e=="number"?ir(e):e.type==="size"?ES(e)?e:(delete(e=F({},e)).type,new nr(e)):void 0}function Lee(e,t,i){if(typeof e!="object")return e;const r=new nr;return r.read(e,i),r}let nr=r7=class extends $3{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:_me.test(this.valueExpression)}}set expression(e){gx.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){ES(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),ES(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return Wfe(this)}set maxDataValue(e){e&&this.stops&&(gx.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(gx.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return $ee(e)}readMaxSize(e,t,i){return Lee(e,t,i)}set minDataValue(e){e&&this.stops&&(gx.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(gx.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return $ee(e)}readMinSize(e,t,i){return Lee(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(gx.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return D$e(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new j("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?s7.read(e):null}clone(){return new r7({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:ES(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:ES(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===uo.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===uo.Stops){const e=this.stops,t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([d({readOnly:!0})],nr.prototype,"cache",null),u([d({type:tI.apiValues,json:{type:tI.jsonValues,origins:{"web-map":{read:!1}},read:tI.read,write:tI.write}})],nr.prototype,"axis",void 0),u([d({type:String,value:null,json:{read:!1}})],nr.prototype,"expression",null),u([d()],nr.prototype,"index",null),u([d({type:String,readOnly:!0})],nr.prototype,"inputValueType",null),u([d({type:qfe,json:{write:!0}})],nr.prototype,"legendOptions",void 0),u([d({type:Number,value:null,json:{write:!0}})],nr.prototype,"maxDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],nr.prototype,"maxSize",null),u([qt("maxSize")],nr.prototype,"castMaxSize",null),u([Ie("maxSize")],nr.prototype,"readMaxSize",null),u([d({type:Number,value:null,json:{write:!0}})],nr.prototype,"minDataValue",null),u([d({type:Number,value:null,json:{write:!0}})],nr.prototype,"minSize",null),u([qt("minSize")],nr.prototype,"castMinSize",null),u([Ie("minSize")],nr.prototype,"readMinSize",null),u([d({type:String,json:{write:!0}})],nr.prototype,"normalizationField",void 0),u([d({readOnly:!0})],nr.prototype,"arcadeRequired",null),u([d({type:String})],nr.prototype,"scaleBy",void 0),u([d({type:[L$e],value:null,json:{write:!0}})],nr.prototype,"stops",null),u([d({type:["outline"],json:{write:!0}})],nr.prototype,"target",void 0),u([d({type:String,readOnly:!0})],nr.prototype,"transformationType",null),u([d({type:["size"],json:{type:["sizeInfo"]}})],nr.prototype,"type",void 0),u([d({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],nr.prototype,"useSymbolValue",void 0),u([d({type:String,json:{write:!0}})],nr.prototype,"valueExpression",void 0),u([Ie("valueExpression",["valueExpression","expression"])],nr.prototype,"readValueExpression",null),u([qe("web-scene","valueExpression")],nr.prototype,"writeValueExpressionWebScene",null),u([d({type:["radius","diameter","area","width","distance"],json:{write:!0}})],nr.prototype,"valueRepresentation",void 0),u([d({type:s7.apiValues,json:{write:s7.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],nr.prototype,"valueUnit",void 0),u([Ie("valueUnit")],nr.prototype,"readValueUnit",null),nr=r7=u([P("esri.renderers.visualVariables.SizeVariable")],nr);const FX=nr,OLe=fe.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),PLe={color:Gfe,size:FX,opacity:jfe,rotation:Hfe},ILe=new wi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),$Le=/^\[([^\]]+)\]$/i;let yD=class extends Se{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match($Le),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=ILe.read(a.type),c=PLe[l];c||(OLe.warn(`Unknown variable type: ${l}`),i&&i.messages&&i.messages.push(new ja("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:i})));const h=new c;return h.read(a,i),h})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([d()],yD.prototype,"visualVariables",null),yD=u([P("esri.renderers.visualVariables.VisualVariableFactory")],yD);const LLe=yD,DLe={base:$3,key:"type",typeMap:{opacity:jfe,color:Gfe,rotation:Hfe,size:FX}},XE=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new LLe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&Gh(i,r,n.field),n.normalizationField&&Gh(i,r,n.normalizationField),n.valueExpression&&await Il(i,r,n.valueExpression))}};return u([d({types:[DLe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([Ie("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([qe("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([P("esri.renderers.mixins.VisualVariablesMixin")],t),t},TC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function H2(e,t=TC){var a,l;if(!e)return{symbol:null};const{retainId:i=TC.retainId,ignoreDrivers:r=TC.ignoreDrivers,hasLabelingContext:s=TC.hasLabelingContext,retainCIM:n=TC.retainCIM}=t;let o;if(Jf(e)||e instanceof rx)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new j("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():yv.fromCIMSymbol(e)}else if(e instanceof Pc)o=Y5.fromSimpleLineSymbol(e);else if(e instanceof xc)o=yv.fromSimpleMarkerSymbol(e);else if(e instanceof Q5)o=yv.fromPictureMarkerSymbol(e);else if(e instanceof dm)o=I3.fromSimpleFillSymbol(e);else{if(!(e instanceof HE))return{error:new j("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?Z5.fromTextSymbol(e):yv.fromTextSymbol(e)}if(i&&o.type!=="cim"&&(o.id=e.id),r&&Jf(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const NLe=["building-scene","integrated-mesh","point-cloud","scene"];function wF(e,t,i,r){const s=Eme(e,{},{context:r,isLabelSymbol:!1});_(s)&&(t[i]=s)}function Dee(e,t,i,r){const s=Eme(e,{},{context:r,isLabelSymbol:!0});_(s)&&(t[i]=s)}function Nee(e){return e instanceof jE||e instanceof rx}function Eme(e,t,i){var a;if(R(e))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!Nee(e)){const l=H2(e,{retainCIM:!0,hasLabelingContext:s});return _(l.symbol)?l.symbol.write(t,r):(o==null||o.push(new j("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:l.error})),null)}return(n==="web-map"||n==="portal-item"&&!NLe.includes((a=r==null?void 0:r.layer)==null?void 0:a.type))&&Nee(e)?(o==null||o.push(new j("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function Cme(e,t){return v$e(e,null,t)}const D3={types:Ffe,json:{write:{writer:wF},origins:{"web-scene":{types:wee,write:{writer:wF},read:{reader:UE({types:wee})}}}}},Ame={types:{base:Oc,key:"type",typeMap:{"simple-fill":Yb.typeMap["simple-fill"],"picture-fill":Yb.typeMap["picture-fill"],"polygon-3d":Yb.typeMap["polygon-3d"]}},json:{write:{writer:wF},origins:{"web-scene":{type:I3,write:{writer:wF}}}}};var n7;let w0=n7=class extends ve{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new n7({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([d({type:String,json:{write:!0}})],w0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],w0.prototype,"label",void 0),u([d(D3)],w0.prototype,"symbol",void 0),u([d({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],w0.prototype,"value",void 0),u([qt("value")],w0.prototype,"castValue",null),w0=n7=u([P("esri.renderers.support.UniqueValueInfo")],w0);const xF=w0,FLe=()=>!!he("enable-feature:force-wosr"),xSt=()=>!!he("enable-feature:direct-3d-object-feature-layer-display"),u6={};async function kLe(e,t){try{return{data:(await kX(e,t)).data,baseUrl:fX(e),styleUrl:e}}catch(i){return bc(i),null}}function ULe(e,t,i){const r=_(t.portal)?t.portal:Gn.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return u6[n]||(u6[n]=zLe(e,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl,styleName:e}))),u6[n]}function zLe(e,t,i){return t.load(i).then(()=>{const r=new Sg({disableExtraQuery:!0,query:`owner:${Fee} AND type:${kee} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords.some(a=>a.toLowerCase()===n)&&o.type===kee&&o.owner===Fee){s=o;break}}if(!s)throw new j("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function Rme(e,t,i){return e.styleUrl?kLe(e.styleUrl,i):e.styleName?ULe(e.styleName,t,i):Promise.reject(new j("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function Mme(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function VLe(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!FLe()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function kX(e,t){const i=F({responseType:"json",query:{f:"json"}},t);return Zt(fp(e),i)}const Fee="esri_en",kee="Style",BLe="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var nR;const O_=fe.getLogger("esri.renderers.UniqueValueRenderer"),GLe=Bs(xF);let Os=nR=class extends XE(dy){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(a=>a.value===i[n].value);o?S$e(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:x3(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new j("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):O_.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||Gn.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=Qf(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Kg(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?O_.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void O_.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?GLe(e):new xF({value:e,symbol:kfe(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)O_.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(R(t)||R(t.arcade))&&(i=ye(F({},i),{arcade:await Wf()})),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(R(t)||R(t.arcade)))return void O_.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(R(i)||R(i.arcade))){const s=await Wf(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=ye(F({},i),{arcade:s})}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new nR({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:re(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:re(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=re(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(re(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Il(e,t,this.valueExpression)];Gh(e,t,this.field),Gh(e,t,this.field2),Gh(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return Rme(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const r=new rx({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new xF({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=vt(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(i[t]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new nR(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||Gn.getDefault());const r=i.populateFromStyle();return r.catch(s=>{O_.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new nR(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{O_.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([d({readOnly:!0})],Os.prototype,"_cache",null),u([at({uniqueValue:"unique-value"})],Os.prototype,"type",void 0),u([d(Ame)],Os.prototype,"backgroundFillSymbol",void 0),u([d({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Os.prototype,"field",void 0),u([qt("field")],Os.prototype,"castField",null),u([qe("field")],Os.prototype,"writeField",null),u([d({type:String,json:{write:!0}})],Os.prototype,"field2",void 0),u([d({type:String,json:{write:!0}})],Os.prototype,"field3",void 0),u([d({type:String,json:{write:!0}})],Os.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Os.prototype,"valueExpressionTitle",void 0),u([d({type:i2,json:{write:!0}})],Os.prototype,"legendOptions",void 0),u([d({type:String,json:{write:!0}})],Os.prototype,"defaultLabel",void 0),u([d(Dhe(F({},D3),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Os.prototype,"defaultSymbol",null),u([d({type:String,json:{write:!0}})],Os.prototype,"fieldDelimiter",void 0),u([d({type:Gn,readOnly:!0})],Os.prototype,"portal",void 0),u([Ie("portal",["styleName"])],Os.prototype,"readPortal",null),u([d({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Os.prototype,"styleOrigin",void 0),u([Ie("styleOrigin",["styleName","styleUrl"])],Os.prototype,"readStyleOrigin",null),u([qe("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Os.prototype,"writeStyleOrigin",null),u([d({type:[xF],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Os.prototype,"uniqueValueInfos",null),Os=nR=u([P("esri.renderers.UniqueValueRenderer")],Os);const UX=Os;class Yv{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return De(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function zX(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const jLe=zX(new Yv(0,2*Math.PI)),Qv=zX(new Yv(-Math.PI,Math.PI)),VX=zX(new Yv(0,360));let qm=class extends Ic(ve){constructor(...e){super(...e),this.position=new ot([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=Mh(e.x||0),s.y=Mh(e.y||0),s.z=e.hasZ?Mh(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new ot;return i.read(e,t),i.x=Mh(i.x||0),i.y=Mh(i.y||0),i.z=i.hasZ?Mh(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([d({type:ot,json:{write:{isRequired:!0}}})],qm.prototype,"position",void 0),u([qe("position")],qm.prototype,"writePosition",null),u([Ie("position")],qm.prototype,"readPosition",null),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),qt(e=>VX.normalize(Mh(e)))],qm.prototype,"heading",void 0),u([d({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),qt(e=>De(Mh(e),-180,180))],qm.prototype,"tilt",void 0),u([d({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],qm.prototype,"fov",void 0),qm=u([P("esri.Camera")],qm);const Rc=qm;var o7;let x0=o7=class extends ve{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new o7({rotation:this.rotation,scale:this.scale,targetGeometry:_(this.targetGeometry)?this.targetGeometry.clone():null,camera:_(this.camera)?this.camera.clone():null})}};function h6(){return{enabled:!this.camera}}u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:h6}}}}})],x0.prototype,"rotation",void 0),u([qt("rotation")],x0.prototype,"castRotation",null),u([d({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:h6}}}}})],x0.prototype,"scale",void 0),u([d({types:Kw,json:{read:Qg,write:!0,origins:{"web-scene":{read:Qg,write:{overridePolicy:h6}}}}})],x0.prototype,"targetGeometry",void 0),u([d({type:Rc,json:{write:!0}})],x0.prototype,"camera",void 0),x0=o7=u([P("esri.Viewpoint")],x0);const Xh=x0;function sk(e){return typeof e=="string"?document.getElementById(e):e}function Ome(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function Uee(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function zee(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}function ie(e,t,i={}){return BX(e,t,i,Pme)}function jo(e,t,i={}){return BX(e,t,i,Ime)}function BX(e,t,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(cn(s),t(o,a))}:(o,a)=>{r(o)&&t(o,a)};if(s=ZMe(e,n,i.sync,i.equals),i.initial){const o=e();n(o,o)}return s}function ns(e,t,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&cn(o),i(h)}const c=ie(e,(h,p)=>{var f;a(),P5(h)&&(s=h,n=C3(h,t,l),(f=r.onListenerAdd)==null||f.call(r,h))},{sync:r.sync,initial:!0});return o=qh(()=>{c.remove(),a()}),o}function _w(e,t){return HLe(e,Ime,t)}function HLe(e,t,i){if(nn(i))return Promise.reject(mi());const r=e();if(t==null?void 0:t(r))return Promise.resolve(r);let s=null;function n(){s=cn(s)}return new Promise((o,a)=>{s=R2([ha(i,()=>{n(),a(mi())}),BX(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:Pme)])})}function Pme(e){return!0}function Ime(e){return!!e}function qLe(e,t,i={}){let r=!1;const s=ie(e,(n,o)=>{r||t(n,o)},i);return{remove(){s.remove()},pause(){r=!0},resume(){r=!1}}}const qi={sync:!0},Rt={initial:!0},Us={sync:!0,initial:!0};class a7{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}var Al;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(Al||(Al={}));let WLe=0;function $me(){return WLe++}function XLe(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function TF(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function Lme(e,t,i,r){if(t.type===Al.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==Al.INVOKE&&t.type!==Al.RESPONSE)return void e.postMessage(t);let s;XLe(i)?(s=Vee(i.transferList),t.data=i.result):(s=Vee(r),t.data=i),s?e.postMessage(t,s):e.postMessage(t)}function lO(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function Vee(e){if(!e||!e.length)return null;if(he("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!ZLe(i));return t.length?t:null}function ZLe(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const YLe={statsWorker:()=>import("./statsWorker.ee22c79b.js"),geometryEngineWorker:()=>import("./geometryEngineWorker.6b706bcf.js"),CSVSourceWorker:()=>import("./CSVSourceWorker.f7d26610.js"),EdgeProcessingWorker:()=>Promise.resolve().then(function(){return S0t}),ElevationSamplerWorker:()=>import("./ElevationSamplerWorker.bf3e2d6d.js"),FeatureServiceSnappingSourceWorker:()=>import("./FeatureServiceSnappingSourceWorker.eae56c17.js"),GeoJSONSourceWorker:()=>import("./GeoJSONSourceWorker.ad0091a1.js"),LercWorker:()=>import("./LercWorker.25b1beb6.js"),MemorySourceWorker:()=>import("./MemorySourceWorker.8f784ed3.js"),PBFDecoderWorker:()=>import("./PBFDecoderWorker.acf65d02.js"),Pipeline:()=>import("./Pipeline.04668f50.js").then(function(e){return e.P}),PointCloudWorker:()=>import("./PointCloudWorker.4e83e4ab.js"),RasterWorker:()=>import("./RasterWorker.62daa095.js"),SceneLayerSnappingSourceWorker:()=>import("./SceneLayerSnappingSourceWorker.0789ee9a.js"),SceneLayerWorker:()=>import("./SceneLayerWorker.5b164f93.js").then(function(e){return e.S}),WFSSourceWorker:()=>import("./WFSSourceWorker.9f3f0edc.js"),WorkerTileHandler:()=>import("./WorkerTileHandler.80b95bd4.js")},{CLOSE:Bee,ABORT:Gee,INVOKE:jee,RESPONSE:SC,OPEN_PORT:Hee,ON:QLe}=Al,JLe=2;class KLe{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===Al.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class dc{constructor(t,i,r){this._port=t,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new KLe(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new dc(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),dc.clients.set(s,r),i.port2}static loadWorker(t){const i=YLe[t];return i?i():Promise.resolve(null)}close(){this._post({type:Bee}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new j("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const o=$me();return new Promise((a,l)=>{if(nn(s))return this._processWork(),void l(mi());const c=ha(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),cn(p.abortHandle),this._post({type:Gee,jobId:o}),l(mi()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:jee,jobId:o,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:Al.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:Al.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:Hee,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=JLe)return;const t=this._getNextJob();if(!t)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=t;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{cn(t.abortHandle),t.reject(mi(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){_(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=lO(t);if(i)switch(i.type){case SC:this._onResponseMessage(i);break;case jee:this._invokeQueue.push(i);break;case Gee:this._onAbortMessage(i);break;case Bee:this._onCloseMessage();break;case Hee:this._onOpenPortMessage(i);break;case QLe:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&dc.clients.get(this)===t&&t.destroy(),dc.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],h=c[p[f+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:SC,jobId:r,error:TF(p)})}Vu(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:SC,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),Jr(p)||this._post({type:SC,jobId:r,error:TF(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:SC,jobId:r},l)}_onOpenPortMessage(t){new dc(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=C3(t.port,"message",n=>{lO(n).type===Al.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);this._processWork(),n.delete(i),cn(o.abortHandle),r?o.reject(j.fromJSON(JSON.parse(r))):o.resolve(s)}_post(t,i,r){return Lme(this._port,t,i,r)}}dc.kernelInfo={revision:ufe,version:hfe,buildDate:cfe},dc.clients=new Map;const eDe=fe.getLogger("esri.core.workers.Connection");class tDe{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new a7}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const o=a=>{fi(i.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];Vu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new dc(c,i,()=>this._ongoingJobsQueue.pop()),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new dc(l,i,()=>this._ongoingJobsQueue.pop()),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject(mi(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,i,r){let s=null;Array.isArray(r)?(eDe.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=qv();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l.jobAdded())}return n.promise}on(t,i){return Promise.all(this._clientPromises).then(()=>R2(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{i[s]=n.openPort(),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const iDe=fe.getLogger("esri.assets");function rDe(e,t){return Zt(xi(e),t)}function xi(e){if(!Fi.assetsPath)throw iDe.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new j("assets:path-not-set","config.assetsPath is not set");return Ll(Fi.assetsPath,e)}const Dme=fe.getLogger("esri.intl");function _h(e,t,i={}){const{format:r={}}=i;return qf(e,s=>sDe(s,t,r))}function sDe(e,t,i){let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=kE(r,t);if(o==null)return"";const a=i[s]||i[r];return a?nDe(o,a):s?oDe(o,s):GX(o)}function nDe(e,t){switch(t.type){case"date":return Kf(e,t.intlOptions);case"number":return Wh(e,t.intlOptions);default:return Dme.warn("missing format descriptor for key {key}"),GX(e)}}function oDe(e,t){switch(t.toLowerCase()){case"dateformat":return Kf(e);case"numberformat":return Wh(e);default:return Dme.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Kf(e):/^numberformat/i.test(t)?Wh(e):GX(e)}}function GX(e){switch(typeof e){case"string":return e;case"number":return Wh(e);case"boolean":return""+e;default:return e instanceof Date?Kf(e):""}}const qee=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,aDe={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Wee(e){var t;return(t=aDe[e])!=null?t:!1}const oR=[],r2=new Map;function Xee(e){for(const t of r2.keys())Fme(e.pattern,t)&&r2.delete(t)}function lDe(e){return oR.includes(e)||(Xee(e),oR.unshift(e)),{remove(){const t=oR.indexOf(e);t>-1&&(oR.splice(t,1),Xee(e))}}}async function Nme(e){const t=Mu();r2.has(e)||r2.set(e,uDe(e,t));const i=r2.get(e);return await hDe.add(i),i}function cDe(e){if(!qee.test(e))return null;const[,t,i]=qee.exec(e),r=t+(i?"-"+i.toUpperCase():"");return Wee(r)?r:Wee(t)?t:null}async function uDe(e,t){const i=[];for(const r of oR)if(Fme(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new j("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new j("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function Fme(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}_X(()=>{r2.clear()});const hDe=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=qv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function dDe(e,t,i,r){const s=t.exec(i);if(!s)throw new j("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=cDe(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await Zee(e(c))}catch(p){if(c===l)throw new j("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await Zee(e(l))}catch(f){throw new j("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return h}async function Zee(e){if(_(Yee.fetchBundleAsset))return Yee.fetchBundleAsset(e);const t=await Zt(e,{responseType:"text"});return JSON.parse(t.data)}class pDe{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return dDe(this.getAssetUrl,this.matcher,t,i)}}function fDe(e){return new pDe(e)}const Yee={};lDe(fDe({pattern:"esri/",location:xi}));const Qee={};function mDe(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}function gDe(e){var i;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:F({},e.has),map:F({},e.map),packages:e.packages&&e.packages.concat()||[],paths:F({},e.paths)};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=Qee.baseUrl),(i=Qee.packages)==null||i.forEach(r=>{mDe(t.packages,r)}),t}class yDe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class vD{constructor(){this._dispatcher=new yDe,this._workerPostMessage({type:Al.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){O2(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){O2(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=lO(t);if(i&&i.type===Al.OPEN){const{modulePath:r,jobId:s}=i;let n=await dc.loadWorker(r);n||(n=await import(r));const o=dc.connect(n);this._workerPostMessage({type:Al.OPENED,jobId:s,data:o})}}}const l7=fe.getLogger("esri.core.workers"),{HANDSHAKE:vDe}=Al,_De='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let iI,rI;const Jee="Failed to create Worker. Fallback to execute module in main thread";async function bDe(){if(!he("esri-workers")||(he("mozilla"),0))return Kee(new vD);if(!iI&&!rI)try{const t=_De.replace('"{CONFIGURATION}"',`'${wDe()}'`);iI=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){rI=t||{}}let e;if(iI)try{e=new Worker(iI,{name:"esri-worker-"+xDe++})}catch{l7.warn(Jee,rI),e=new vD}else l7.warn(Jee,rI),e=new vD;return Kee(e)}async function Kee(e){return new Promise(t=>{function i(s){const n=lO(s);n&&n.type===vDe&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),l7.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new vD).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function wDe(){let e;if(Fi.default!=null){const s=F({},Fi);delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(Fi));e.assetsPath=zh(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=Mu(),e.has={"esri-csp-restrictions":he("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":he("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":he("esri-2d-query-centroid-enabled"),"featurelayer-pbf":he("featurelayer-pbf"),"featurelayer-simplify-thresholds":he("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":he("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":he("featurelayer-simplify-mobile-factor"),"esri-atomics":he("esri-atomics"),"esri-shared-array-buffer":he("esri-shared-array-buffer"),"esri-tiles-debug":he("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":he("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":he("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=zh(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=zh(e.workers.workerPath):e.workers.workerPath=zh(xi("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=Fi.workers.loaderConfig,i=gDe({baseUrl:t==null?void 0:t.baseUrl,locale:Mu(),has:F({"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1},t==null?void 0:t.has),map:F({},t==null?void 0:t.map),paths:F({},t==null?void 0:t.paths),packages:(t==null?void 0:t.packages)||[]}),r={version:hfe,buildDate:cfe,revision:ufe};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let xDe=0;const TDe=fe.getLogger("esri.core.workers"),{ABORT:ete,INVOKE:SDe,OPEN:EDe,OPENED:CDe,RESPONSE:EC}=Al;class jX{constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),TDe.error(r)})}static async create(t){const i=await bDe();return new jX(i,t)}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=$me();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:RW(r,()=>{this._outJobs.delete(s),this._post({type:ete,jobId:s})})};this._outJobs.set(s,a),this._post({type:EDe,jobId:s,modulePath:t})})}_onMessage(t){const i=lO(t);if(i)switch(i.type){case CDe:this._onOpenedMessage(i);break;case EC:this._onResponseMessage(i);break;case ete:this._onAbortMessage(i);break;case SDe:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=$Ie[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:EC,jobId:r,error:TF(h)})}Vu(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:EC,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Jr(h)||this._post({type:EC,jobId:r,error:TF(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:EC,jobId:r},c)}_onOpenedMessage(t){const{jobId:i,data:r}=t,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),cn(s.abortHandle),s.resolve(r))}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),cn(n.abortHandle),r?n.reject(j.fromJSON(JSON.parse(r))):n.resolve(s))}_post(t,i,r){return Lme(this.worker,t,i,r)}}let Mb=he("esri-workers-debug")?1:he("host-browser")?navigator.hardwareConcurrency-1:0;Mb||(Mb=he("safari")&&he("mac")||he("trident")?7:2);let tte=0;const _D=[];function ADe(){Ume()}async function sI(e,t){const i=new tDe;return await i.open(e,t),i}async function kme(e,t={}){if(typeof e!="string")throw new j("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(he("host-webworker")&&!he("esri-workers")&&(i="local"),i==="local"){let r=await dc.loadWorker(e);r||(r=await import(e)),fi(t.signal);const s=t.client||r;return sI([dc.connect(r)],ye(F({},t),{client:s}))}if(await Ume(),fi(t.signal),i==="dedicated"){const r=tte++%Mb;return sI([await _D[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,Mb);if(r<Mb){const s=new Array(r);for(let n=0;n<r;++n){const o=tte++%Mb;s[n]=_D[o].open(e,t)}return sI(s,t)}}return sI(_D.map(r=>r.open(e,t)),t)}let nI=null;async function Ume(){if(nI)return nI;new AbortController;const e=[];for(let t=0;t<Mb;t++){const i=jX.create(t).then(r=>(_D[t]=r,r));e.push(i)}return nI=Promise.all(e),nI}let bD=class extends Se{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!ut.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||ut.isCollection(e)?e.forEach(r=>this._isHandle(r)&&i.push(r)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||ut.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};u([d({readOnly:!0})],bD.prototype,"size",null),bD=u([P("esri.core.Handles")],bD);const Nt=bD;let zf=class extends Se{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new Nt,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,ie)}addWhen(e,t,i={}){return this._installWatch(e,t,i,jo)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const s=++this.handleId;return this.handles.add([ns(e,"after-changes",this._createSyncUpdatingCallback(),qi),ns(e,"change",t,{onListenerAdd:i?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:r?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this.handles.remove(s)}}addPromise(e){if(R(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(oI)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=ie(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(oI),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(zE(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(oI))}),oI)}}};u([d({readOnly:!0})],zf.prototype,"updating",void 0),zf=u([P("esri.core.support.WatchUpdatingTracking")],zf);const oI=-42;var ite;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(ite||(ite={}));const g_=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new Nt}get updatingHandles(){return this._get("updatingHandles")||new zf}};return u([d({readOnly:!0})],t.prototype,"handles",null),u([d({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([P("esri.core.HandleOwner")],t),t};let q2=class extends g_(Se){};q2=u([P("esri.core.HandleOwner")],q2);fe.getLogger("esri.core.support.OwningCollection");let oM=class extends g_(ut){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{R(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(ut.ofType(this.itemType.Type))(e):new ut(e)}};function c7(e,t){return{type:e,cast:lfe,set(i){const r=vw(i,this._get(t),e);r.owner=this,this._set(t,r)}}}u([d()],oM.prototype,"owner",null),oM=u([P("esri.core.support.OwningCollection")],oM);var aR;const SF=fa()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),zme=SF.jsonValues.slice();A5(zme,"orthometric");const aM=fa()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Cd=aR=class extends ve{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return SF.write(e,t,i)}readHeightModel(e,t,i){return SF.read(e)||(i&&i.messages&&i.messages.push(RDe(e,{context:i})),null)}readHeightUnit(e,t,i){return aM.read(e)||(i&&i.messages&&i.messages.push(rte(e,{context:i})),null)}readHeightUnitService(e,t,i){return pme(e)||aM.read(e)||(i&&i.messages&&i.messages.push(rte(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new aR({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=pLe(t);return new aR({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t=F({origin:"web-scene"},t),super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new aR;return t.read(e,{origin:"web-scene"}),t}};function rte(e,t){return new ja("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function RDe(e,t){return new ja("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([d({type:SF.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:zme,default:"ellipsoidal"}}}})],Cd.prototype,"heightModel",void 0),u([qe("web-scene","heightModel")],Cd.prototype,"writeHeightModel",null),u([Ie(["web-scene","service"],"heightModel")],Cd.prototype,"readHeightModel",null),u([d({type:aM.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:aM.jsonValues,write:aM.write}}}})],Cd.prototype,"heightUnit",void 0),u([Ie("web-scene","heightUnit")],Cd.prototype,"readHeightUnit",null),u([Ie("service","heightUnit")],Cd.prototype,"readHeightUnitService",null),u([d({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Cd.prototype,"vertCRS",void 0),u([Ie("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Cd.prototype,"readVertCRS",null),Cd=aR=u([P("esri.geometry.HeightModelInfo")],Cd);const ox=Cd;function Ss(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function pm(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v,w){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=f,e[12]=m,e[13]=y,e[14]=v,e[15]=w,e}function tm(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Dl(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function _s(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,C=r*l-s*a,A=r*c-n*a,I=s*c-n*l,D=h*v-p*y,L=h*w-f*y,z=h*b-m*y,B=p*w-f*v,V=p*b-m*v,Q=f*b-m*w;let Z=S*Q-T*V+E*B+C*z-A*L+I*D;return Z?(Z=1/Z,e[0]=(a*Q-l*V+c*B)*Z,e[1]=(s*V-r*Q-n*B)*Z,e[2]=(v*I-w*A+b*C)*Z,e[3]=(f*A-p*I-m*C)*Z,e[4]=(l*z-o*Q-c*L)*Z,e[5]=(i*Q-s*z+n*L)*Z,e[6]=(w*E-y*I-b*T)*Z,e[7]=(h*I-f*E+m*T)*Z,e[8]=(o*V-a*z+c*D)*Z,e[9]=(r*z-i*V-n*D)*Z,e[10]=(y*A-v*E+b*S)*Z,e[11]=(p*E-h*A-m*S)*Z,e[12]=(a*L-o*B-l*D)*Z,e[13]=(i*B-r*L+s*D)*Z,e[14]=(v*T-y*C-w*S)*Z,e[15]=(h*C-p*T+f*S)*Z,e):null}function MDe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15];return e[0]=a*(f*b-m*w)-p*(l*b-c*w)+v*(l*m-c*f),e[1]=-(r*(f*b-m*w)-p*(s*b-n*w)+v*(s*m-n*f)),e[2]=r*(l*b-c*w)-a*(s*b-n*w)+v*(s*c-n*l),e[3]=-(r*(l*m-c*f)-a*(s*m-n*f)+p*(s*c-n*l)),e[4]=-(o*(f*b-m*w)-h*(l*b-c*w)+y*(l*m-c*f)),e[5]=i*(f*b-m*w)-h*(s*b-n*w)+y*(s*m-n*f),e[6]=-(i*(l*b-c*w)-o*(s*b-n*w)+y*(s*c-n*l)),e[7]=i*(l*m-c*f)-o*(s*m-n*f)+h*(s*c-n*l),e[8]=o*(p*b-m*v)-h*(a*b-c*v)+y*(a*m-c*p),e[9]=-(i*(p*b-m*v)-h*(r*b-n*v)+y*(r*m-n*p)),e[10]=i*(a*b-c*v)-o*(r*b-n*v)+y*(r*c-n*a),e[11]=-(i*(a*m-c*p)-o*(r*m-n*p)+h*(r*c-n*a)),e[12]=-(o*(p*w-f*v)-h*(a*w-l*v)+y*(a*f-l*p)),e[13]=i*(p*w-f*v)-h*(r*w-s*v)+y*(r*f-s*p),e[14]=-(i*(a*w-l*v)-o*(r*w-s*v)+y*(r*l-s*a)),e[15]=i*(a*f-l*p)-o*(r*f-s*p)+h*(r*l-s*a),e}function ODe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],m=e[12],y=e[13],v=e[14],w=e[15];return(t*o-i*n)*(p*w-f*v)-(t*a-r*n)*(h*w-f*y)+(t*l-s*n)*(h*v-p*y)+(i*a-r*o)*(c*w-f*m)-(i*l-s*o)*(c*v-p*m)+(r*l-s*a)*(c*y-h*m)}function Hr(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=t[9],m=t[10],y=t[11],v=t[12],w=t[13],b=t[14],S=t[15];let T=i[0],E=i[1],C=i[2],A=i[3];return e[0]=T*r+E*a+C*p+A*v,e[1]=T*s+E*l+C*f+A*w,e[2]=T*n+E*c+C*m+A*b,e[3]=T*o+E*h+C*y+A*S,T=i[4],E=i[5],C=i[6],A=i[7],e[4]=T*r+E*a+C*p+A*v,e[5]=T*s+E*l+C*f+A*w,e[6]=T*n+E*c+C*m+A*b,e[7]=T*o+E*h+C*y+A*S,T=i[8],E=i[9],C=i[10],A=i[11],e[8]=T*r+E*a+C*p+A*v,e[9]=T*s+E*l+C*f+A*w,e[10]=T*n+E*c+C*m+A*b,e[11]=T*o+E*h+C*y+A*S,T=i[12],E=i[13],C=i[14],A=i[15],e[12]=T*r+E*a+C*p+A*v,e[13]=T*s+E*l+C*f+A*w,e[14]=T*n+E*c+C*m+A*b,e[15]=T*o+E*h+C*y+A*S,e}function qa(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],f=t[6],m=t[7],y=t[8],v=t[9],w=t[10],b=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=f,e[7]=m,e[8]=y,e[9]=v,e[10]=w,e[11]=b,e[12]=o*r+h*s+y*n+t[12],e[13]=a*r+p*s+v*n+t[13],e[14]=l*r+f*s+w*n+t[14],e[15]=c*r+m*s+b*n+t[15]}return e}function nk(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function gc(e,t,i,r){let s,n,o,a,l,c,h,p,f,m,y,v,w,b,S,T,E,C,A,I,D,L,z,B,V=r[0],Q=r[1],Z=r[2],ce=Math.sqrt(V*V+Q*Q+Z*Z);return ce<Ct?null:(ce=1/ce,V*=ce,Q*=ce,Z*=ce,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],f=t[5],m=t[6],y=t[7],v=t[8],w=t[9],b=t[10],S=t[11],T=V*V*o+n,E=Q*V*o+Z*s,C=Z*V*o-Q*s,A=V*Q*o-Z*s,I=Q*Q*o+n,D=Z*Q*o+V*s,L=V*Z*o+Q*s,z=Q*Z*o-V*s,B=Z*Z*o+n,e[0]=a*T+p*E+v*C,e[1]=l*T+f*E+w*C,e[2]=c*T+m*E+b*C,e[3]=h*T+y*E+S*C,e[4]=a*A+p*I+v*D,e[5]=l*A+f*I+w*D,e[6]=c*A+m*I+b*D,e[7]=h*A+y*I+S*D,e[8]=a*L+p*z+v*B,e[9]=l*L+f*z+w*B,e[10]=c*L+m*z+b*B,e[11]=h*L+y*z+S*B,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function W2(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+h*r,e[6]=a*s+p*r,e[7]=l*s+f*r,e[8]=c*s-n*r,e[9]=h*s-o*r,e[10]=p*s-a*r,e[11]=f*s-l*r,e}function ok(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-h*r,e[2]=a*s-p*r,e[3]=l*s-f*r,e[8]=n*r+c*s,e[9]=o*r+h*s,e[10]=a*r+p*s,e[11]=l*r+f*s,e}function X2(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+h*r,e[2]=a*s+p*r,e[3]=l*s+f*r,e[4]=c*s-n*r,e[5]=h*s-o*r,e[6]=p*s-a*r,e[7]=f*s-l*r,e}function ak(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function PDe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Du(e,t,i){let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Ct?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Vme(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function IDe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bme(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Gme(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,f=r*c,m=s*l,y=s*c,v=n*c,w=o*a,b=o*l,S=o*c;return e[0]=1-(m+v),e[1]=p+S,e[2]=f-b,e[3]=0,e[4]=p-S,e[5]=1-(h+v),e[6]=y+w,e[7]=0,e[8]=f+b,e[9]=y-w,e[10]=1-(h+m),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function $De(e,t){const i=LDe,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),Gme(e,t,i),e}const LDe=O();function DDe(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function jme(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function NDe(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function FDe(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,f=s*c,m=s*h,y=n*c,v=n*h,w=o*h,b=a*l,S=a*c,T=a*h,E=r[0],C=r[1],A=r[2];return e[0]=(1-(y+w))*E,e[1]=(f+T)*E,e[2]=(m-S)*E,e[3]=0,e[4]=(f-T)*C,e[5]=(1-(p+w))*C,e[6]=(v+b)*C,e[7]=0,e[8]=(m+S)*A,e[9]=(v-b)*A,e[10]=(1-(p+y))*A,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function kDe(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,f=n*c,m=n*h,y=n*p,v=o*h,w=o*p,b=a*p,S=l*c,T=l*h,E=l*p,C=r[0],A=r[1],I=r[2],D=s[0],L=s[1],z=s[2],B=(1-(v+b))*C,V=(m+E)*C,Q=(y-T)*C,Z=(m-E)*A,ce=(1-(f+b))*A,oe=(w+S)*A,$=(y+T)*I,U=(w-S)*I,G=(1-(f+v))*I;return e[0]=B,e[1]=V,e[2]=Q,e[3]=0,e[4]=Z,e[5]=ce,e[6]=oe,e[7]=0,e[8]=$,e[9]=U,e[10]=G,e[11]=0,e[12]=i[0]+D-(B*D+Z*L+$*z),e[13]=i[1]+L-(V*D+ce*L+U*z),e[14]=i[2]+z-(Q*D+oe*L+G*z),e[15]=1,e}function UDe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,v=n*o,w=n*a,b=n*l;return e[0]=1-p-y,e[1]=h+b,e[2]=f-w,e[3]=0,e[4]=h-b,e[5]=1-c-y,e[6]=m+v,e[7]=0,e[8]=f+w,e[9]=m-v,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hme(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function zDe(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}function VDe(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function HX(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function lk(e,t,i,r){let s,n,o,a,l,c,h,p,f,m;const y=t[0],v=t[1],w=t[2],b=r[0],S=r[1],T=r[2],E=i[0],C=i[1],A=i[2];return Math.abs(y-E)<Ct&&Math.abs(v-C)<Ct&&Math.abs(w-A)<Ct?tm(e):(h=y-E,p=v-C,f=w-A,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,s=S*f-T*p,n=T*h-b*f,o=b*p-S*h,m=Math.sqrt(s*s+n*n+o*o),m?(m=1/m,s*=m,n*=m,o*=m):(s=0,n=0,o=0),a=p*o-f*n,l=f*s-h*o,c=h*n-p*s,m=Math.sqrt(a*a+l*l+c*c),m?(m=1/m,a*=m,l*=m,c*=m):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=f,e[11]=0,e[12]=-(s*y+n*v+o*w),e[13]=-(a*y+l*v+c*w),e[14]=-(h*y+p*v+f*w),e[15]=1,e)}function qme(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],f=o-i[2],m=h*h+p*p+f*f;m>0&&(m=1/Math.sqrt(m),h*=m,p*=m,f*=m);let y=l*f-c*p,v=c*h-a*f,w=a*p-l*h;return m=y*y+v*v+w*w,m>0&&(m=1/Math.sqrt(m),y*=m,v*=m,w*=m),e[0]=y,e[1]=v,e[2]=w,e[3]=0,e[4]=p*w-f*v,e[5]=f*y-h*w,e[6]=h*v-p*y,e[7]=0,e[8]=h,e[9]=p,e[10]=f,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function BDe(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function GDe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function jDe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function Wme(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function HDe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function qDe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function WDe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Xme(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],m=e[11],y=e[12],v=e[13],w=e[14],b=e[15],S=t[0],T=t[1],E=t[2],C=t[3],A=t[4],I=t[5],D=t[6],L=t[7],z=t[8],B=t[9],V=t[10],Q=t[11],Z=t[12],ce=t[13],oe=t[14],$=t[15];return Math.abs(i-S)<=Ct*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(r-T)<=Ct*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(s-E)<=Ct*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(n-C)<=Ct*Math.max(1,Math.abs(n),Math.abs(C))&&Math.abs(o-A)<=Ct*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(a-I)<=Ct*Math.max(1,Math.abs(a),Math.abs(I))&&Math.abs(l-D)<=Ct*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(c-L)<=Ct*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(h-z)<=Ct*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(p-B)<=Ct*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(f-V)<=Ct*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(m-Q)<=Ct*Math.max(1,Math.abs(m),Math.abs(Q))&&Math.abs(y-Z)<=Ct*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(v-ce)<=Ct*Math.max(1,Math.abs(v),Math.abs(ce))&&Math.abs(w-oe)<=Ct*Math.max(1,Math.abs(w),Math.abs(oe))&&Math.abs(b-$)<=Ct*Math.max(1,Math.abs(b),Math.abs($))}function qX(e){const t=Ct,i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const XDe=Hr,ZDe=Wme;Object.freeze(Object.defineProperty({__proto__:null,copy:Ss,set:pm,identity:tm,transpose:Dl,invert:_s,adjoint:MDe,determinant:ODe,multiply:Hr,translate:qa,scale:nk,rotate:gc,rotateX:W2,rotateY:ok,rotateZ:X2,fromTranslation:ak,fromScaling:PDe,fromRotation:Du,fromXRotation:Vme,fromYRotation:IDe,fromZRotation:Bme,fromRotationTranslation:Gme,fromQuat2:$De,getTranslation:DDe,getScaling:jme,getRotation:NDe,fromRotationTranslationScale:FDe,fromRotationTranslationScaleOrigin:kDe,fromQuat:UDe,frustum:Hme,perspective:zDe,perspectiveFromFieldOfView:VDe,ortho:HX,lookAt:lk,targetTo:qme,str:BDe,frob:GDe,add:jDe,subtract:Wme,multiplyScalar:HDe,multiplyScalarAndAdd:qDe,exactEquals:WDe,equals:Xme,isOrthoNormal:qX,mul:XDe,sub:ZDe},Symbol.toStringTag,{value:"Module"}));let d6,ne=null;function Zme(){return!!ne}function YDe(){return!!he("esri-wasm")}function Yme(){return d6||(d6=import("./pe-wasm.41ba155b.js").then(e=>e.p).then(({default:e})=>e({locateFile:t=>xi(`esri/geometry/support/${t}`)})).then(e=>{Jme(e)}),d6)}var u7,ds,h7;(function(e){function t(n,o,a){ne.ensureCache.prepare();const l=pb(a),c=a===l,h=ne.ensureFloat64(l),p=ne._pe_geog_to_proj(ne.getPointer(n),o,h);return p&&sv(a,o,h,c),p}function i(n,o,a,l){switch(l){case ds.PE_TRANSFORM_P_TO_G:return r(n,o,a);case ds.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ne.ensureCache.prepare();const c=pb(a),h=a===c,p=ne.ensureFloat64(c),f=ne._pe_proj_to_geog_center(ne.getPointer(n),o,p,l);return f&&sv(a,o,p,h),f}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(u7||(u7={})),function(e){function t(){e.PE_BUFFER_MAX=ne.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=ne.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=ne.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=ne.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=ne.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=ne.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=ne.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=ne.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=ne.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=ne.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=ne.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=ne.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=ne.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=ne.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=ne.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=ne.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=ne.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=ne.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=ne.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=ne.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=ne.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=ne.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=ne.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=ne.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=ne.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=ne.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=ne.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=ne.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=ne.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=ne.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(ds||(ds={})),function(e){const t={},i={},r=m=>{if(m){const y=m.getType();switch(y){case ds.PE_TYPE_GEOGCS:m=ne.castObject(m,ne.PeGeogcs);break;case ds.PE_TYPE_PROJCS:m=ne.castObject(m,ne.PeProjcs);break;case ds.PE_TYPE_GEOGTRAN:m=ne.castObject(m,ne.PeGeogtran);break;default:y&ds.PE_TYPE_UNIT&&(m=ne.castObject(m,ne.PeUnit))}}return m};function s(){ne.PeFactory.prototype.initialize(null)}function n(m){return o(ds.PE_TYPE_COORDSYS,m)}function o(m,y){let v=null,w=t[m];if(w||(w={},t[m]=w),w.hasOwnProperty(String(y)))v=w[y];else{const b=ne.PeFactory.prototype.factoryByType(m,y);ne.compare(b,ne.NULL)||(v=b,w[y]=v)}return v=r(v),v}function a(m,y){let v=null,w=i[m];if(w||(w={},i[m]=w),w.hasOwnProperty(y))v=w[y];else{const b=ne.PeFactory.prototype.fromString(m,y);ne.compare(b,ne.NULL)||(v=b,w[y]=v)}return v=r(v),v}function l(m){return o(ds.PE_TYPE_GEOGCS,m)}function c(m){return o(ds.PE_TYPE_GEOGTRAN,m)}function h(m){return ne.PeFactory.prototype.getCode(m)}function p(m){return o(ds.PE_TYPE_PROJCS,m)}function f(m){return o(ds.PE_TYPE_UNIT,m)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=f}(h7||(h7={}));let Qme=null;var EF,d7,p7,f7,CF,m7,AF,RF,g7;function Jme(e){function t(n,o,a){n[o]=a(n[o])}ne=e,ds.init(),EF.init(),CF.init(),AF.init(),RF.init(),Qme=class extends ne.PeGCSExtent{destroy(){ne.destroy(this)}};const i=[ne.PeDatum,ne.PeGeogcs,ne.PeGeogtran,ne.PeObject,ne.PeParameter,ne.PePrimem,ne.PeProjcs,ne.PeSpheroid,ne.PeUnit];for(const n of i)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(ds.PE_NAME_MAX))});for(const n of[ne.PeGeogtran,ne.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(ds.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ne.getValue(l,"*");a[c]=h?ne.wrapPointer(h,ne.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(ne.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return sv(a,o,n.call(this)),a}),t(ne.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ne._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ne.compare(l,ne.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ne.getPointer(l);for(let p=1;p<c;p++)a.push(ne.wrapPointer(h+o*p,ne.PeGTlistExtendedGTs))}}return a}});const r=ne._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ne.compare(l,ne.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ne.getPointer(l);for(let p=1;p<c;p++)a.push(ne.wrapPointer(h+r*p,ne.PeHorizon))}}return o.set(n,a),a};t(ne.PeProjcs.prototype,"horizonGcsGenerate",s),t(ne.PeProjcs.prototype,"horizonPcsGenerate",s),ne.PeObject.prototype.toString=function(n=ds.PE_STR_OPTS_NONE){ne.ensureCache.prepare();const o=ne.getPointer(this),a=ne.ensureInt8(new Array(ds.PE_BUFFER_MAX));return ne.UTF8ToString(ne._pe_object_to_string_ext(o,n,a))}}function Tm(e){if(!e)return;const t=ne.getClass(e);if(!t)return;const i=ne.getCache(t);if(!i)return;const r=ne.getPointer(e);r&&delete i[r]}function aI(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(ne.ensureInt8(r));return i}function pb(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function sv(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=ne.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=ne.getValue(i,"double"),e[n][1]=ne.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=ne.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=ne._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new ne.PeInteger(c);try{const f=ne.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[f],c>1)){const m=ne.getPointer(f);for(let y=1;y<c;y++)h.push(ne.wrapPointer(m+t*y,ne.PeGTlistExtendedEntry))}}finally{ne.destroy(p)}return h}e.init=i,e.getGTlist=r})(EF||(EF={})),function(e){function t(i){if(i&&i.length){for(const r of i)Tm(r),r.getEntries().forEach(s=>{Tm(s);const n=s.getGeogtran();Tm(n),n.getParameters().forEach(Tm),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{Tm(o);const a=o.getDatum();Tm(a),Tm(a.getSpheroid()),Tm(o.getPrimem()),Tm(o.getUnit())})});ne.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(d7||(d7={})),function(e){function t(i,r,s,n,o){ne.ensureCache.prepare();const a=pb(s),l=s===a,c=ne.ensureFloat64(a);let h=0;n&&(h=ne.ensureFloat64(n));const p=ne._pe_geog_to_geog(ne.getPointer(i),r,c,h,o);return p&&sv(s,r,c,l),p}e.geogToGeog=t}(p7||(p7={})),function(e){const t=(c,h,p,f,m,y)=>{let v,w;switch(ne.ensureCache.prepare(),c){case"dd":v=ne._pe_geog_to_dd,w=ds.PE_DD_MAX;break;case"ddm":v=ne._pe_geog_to_ddm,w=ds.PE_DDM_MAX;break;case"dms":v=ne._pe_geog_to_dms,w=ds.PE_DMS_MAX}let b=0;h&&(b=ne.getPointer(h));const S=pb(f),T=ne.ensureFloat64(S),E=aI(p,w),C=v(b,p,T,m,ne.ensureInt32(E));if(C)for(let A=0;A<p;A++)y[A]=ne.UTF8ToString(E[A]);return C},i=(c,h,p,f,m)=>{let y;switch(ne.ensureCache.prepare(),c){case"dd":y=ne._pe_dd_to_geog;break;case"ddm":y=ne._pe_ddm_to_geog;break;case"dms":y=ne._pe_dms_to_geog}let v=0;h&&(v=ne.getPointer(h));const w=f.map(E=>ne.ensureString(E)),b=ne.ensureInt32(w),S=ne.ensureFloat64(new Array(2*p)),T=y(v,p,b,S);return T&&sv(m,p,S),T};function r(c,h,p,f,m){return t("dms",c,h,p,f,m)}function s(c,h,p,f){return i("dms",c,h,p,f)}function n(c,h,p,f,m){return t("ddm",c,h,p,f,m)}function o(c,h,p,f){return i("ddm",c,h,p,f)}function a(c,h,p,f,m){return t("dd",c,h,p,f,m)}function l(c,h,p,f){return i("dd",c,h,p,f)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(f7||(f7={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=ne.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=ne.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){ne.ensureCache.prepare();let p=0;s&&(p=ne.getPointer(s));const f=pb(o),m=ne.ensureFloat64(f),y=aI(n,ds.PE_MGRS_MAX),v=ne.ensureInt32(y),w=ne._pe_geog_to_mgrs_extended(p,n,m,a,l,c,v);if(w)for(let b=0;b<n;b++)h[b]=ne.UTF8ToString(y[b]);return w}function r(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const h=o.map(y=>ne.ensureString(y)),p=ne.ensureInt32(h),f=ne.ensureFloat64(new Array(2*n)),m=ne._pe_mgrs_to_geog_extended(c,n,p,a,f);return m&&sv(l,n,f),m}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(CF||(CF={})),function(e){function t(r,s,n,o,a,l,c){ne.ensureCache.prepare();let h=0;r&&(h=ne.getPointer(r));const p=pb(n),f=ne.ensureFloat64(p),m=aI(s,ds.PE_MGRS_MAX),y=ne.ensureInt32(m),v=ne._pe_geog_to_usng(h,s,f,o,a,l,y);if(v)for(let w=0;w<s;w++)c[w]=ne.UTF8ToString(m[w]);return v}function i(r,s,n,o){ne.ensureCache.prepare();let a=0;r&&(a=ne.getPointer(r));const l=n.map(f=>ne.ensureString(f)),c=ne.ensureInt32(l),h=ne.ensureFloat64(new Array(2*s)),p=ne._pe_usng_to_geog(a,s,c,h);return p&&sv(o,s,h),p}e.geogToUsng=t,e.usngToGeog=i}(m7||(m7={})),function(e){function t(){e.PE_UTM_OPTS_NONE=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=ne.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const h=pb(o),p=ne.ensureFloat64(h),f=aI(n,ds.PE_UTM_MAX),m=ne.ensureInt32(f),y=ne._pe_geog_to_utm(c,n,p,a,m);if(y)for(let v=0;v<n;v++)l[v]=ne.UTF8ToString(f[v]);return y}function r(s,n,o,a,l){ne.ensureCache.prepare();let c=0;s&&(c=ne.getPointer(s));const h=o.map(y=>ne.ensureString(y)),p=ne.ensureInt32(h),f=ne.ensureFloat64(new Array(2*n)),m=ne._pe_utm_to_geog(c,n,p,a,f);return m&&sv(l,n,f),m}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(AF||(AF={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=ne.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=ne.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o,a;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=ne.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=i,e.generate=r}(RF||(RF={})),function(e){function t(){return ne.PeVersion.prototype.version_string()}e.versionString=t}(g7||(g7={}));const QDe=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return ne},isLoaded:Zme,isSupported:YDe,load:Yme,get PeCSTransformations(){return u7},get PeDefs(){return ds},get PeFactory(){return h7},get PeGCSExtent(){return Qme},get PeGTlistExtended(){return EF},get PeGTlistExtendedEntry(){return d7},get PeGTTransformations(){return p7},get PeNotationDms(){return f7},get PeNotationMgrs(){return CF},get PeNotationUsng(){return m7},get PeNotationUtm(){return AF},get PePCSInfo(){return RF},get PeVersion(){return g7},_init:Jme},Symbol.toStringTag,{value:"Module"})),TSt=Math.PI/180,SSt=/SPHEROID\[([^\]]+)]/i,Oy=Pi.radius,ud=Pi.eccentricitySquared,JDe={a1:Oy*ud,a2:Oy*ud*Oy*ud,a3:Oy*ud*ud/2,a4:Oy*ud*Oy*ud*2.5,a5:Oy*ud+Oy*ud*ud/2,a6:1-ud},ESt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Pi.radius,f:Pi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Yg.radius,f:Yg.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Uf.radius,f:Uf.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Uf.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let lI=0;class s2{constructor(t=null){this.uid=lI++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const i=new s2;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=lI++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=lI++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=lI++}getInverse(){const t=new s2;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class vv{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof s2?this.steps.push(i):this.steps.push(new s2({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new vv;let r="";for(const s of t.steps){const n=s2.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cached_projection={},i._gtlistentry=null,i._chain=r,i}getInverse(){const t=new vv;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cached_projection[vv.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const s=this._cached_projection[vv.cacheKey(t,i)];return s===void 0?null:s}}function Kme(e,t,i){if(R(t)||R(i)||i.vcsWkid||Mc(t,i))return null;const r=G2(t)/G2(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>KDe(s,r);case"polyline":case"esriGeometryPolyline":return s=>tNe(s,r);case"polygon":case"esriGeometryPolygon":return s=>eNe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>iNe(s,r);case"extent":case"esriGeometryExtent":return s=>rNe(s,r);default:return null}}function KDe(e,t){e&&e.z!=null&&(e.z*=t)}function eNe(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function tNe(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function iNe(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function rNe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let Dv=null,MF=null,p6=null,f6={};const ege=new ofe;function WX(){return!!Dv&&Zme()}function OF(e){return R(p6)&&(p6=Promise.all([Yme(),import("./geometryEngineBase.f43341a0.js").then(t=>t.g),import("./hydrated.981f356b.js")])),p6.then(([,t,{hydratedAdapter:i}])=>{fi(e),MF=i,Dv=t.default,Dv._enableProjection(QDe),ege.notify()})}function N3(e,t,i=null,r=null){return Array.isArray(e)?e.length===0?[]:ste(MF,e,e[0].spatialReference,t,i,r):ste(MF,[e],e.spatialReference,t,i,r)[0]}function ste(e,t,i,r,s=null,n=null){if(R(i)||R(r))return t;if(im(i,r,s))return t.map(o=>tge(o,i,r));if(R(s)){const o=vv.cacheKey(i,r);f6[o]!==void 0?s=f6[o]:(s=sNe(i,r,null),R(s)&&(s=new vv),f6[o]=s)}if(R(Dv))throw new XX;return _(n)?Dv._project(e,t,i,r,s,n):Dv._project(e,t,i,r,s)}function CSt(e,t){return R(e)?{pending:null,geometry:null}:Mc(e.spatialReference,t)?{pending:null,geometry:e}:Pl(e.spatialReference)&&Pl(t)?im(e.spatialReference,t)||WX()?{pending:null,geometry:nNe(e,t)}:(ei(ege),{pending:OF(),geometry:null}):{pending:null,geometry:null}}function sNe(e,t,i=null){if(R(Dv))throw new XX;if(R(e)||R(t))return null;const r=Dv._getTransformation(MF,e,t,i,i==null?void 0:i.spatialReference);return r!==null?vv.fromGE(r):null}class XX extends j{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var J;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(J||(J={}));function nNe(e,t){try{const i=N3(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=Kme(i.type,e.spatialReference,t);return _(r)&&r(i),i}catch(i){if(!(i instanceof XX))throw i;return null}}function im(e,t,i){return!i&&(!!Mc(e,t)||Pl(e)&&Pl(t)&&!!JX(e,t,eZ))}async function ASt(e,t,i,r){if(WX())return GK(r);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!im(s,n,o))return OF(r)}else if(!im(e,t,i))return OF(r);return GK(r)}function RSt(e,t){switch(JX(e,t,eZ)){case vr:return"copy3";case bv:return"wgs84ToSphericalECEF";case bw:return"wgs84ToWebMercator";case _v:return"wgs84ToPlateCarree";case xv:return"wgs84ToWGS84ECEF";case Jb:return"webMercatorToWGS84";case lge:return"webMercatorToSphericalECEF";case cge:return"webMercatorToWGS84ECEF";case uge:return"webMercatorToPlateCarree";case Tv:return"wgs84ECEFToWGS84";case pge:return"wgs84ECEFToSphericalECEF";case fge:return"wgs84ECEFToWebMercator";case wv:return"sphericalECEFToWGS84";case hge:return"sphericalECEFToWebMercator";case b7:return"sphericalMarsPCPFToMars2000";case _7:return"sphericalMoonPCPFToMoon2000";case dge:return"sphericalECEFToWGS84ECEF";case v7:return"mars2000ToSphericalPCPF";case y7:return"moon2000ToSphericalPCPF";default:return null}}function tge(e,t,i){return e?"x"in e?ige(e,t,new ot,i,0):"xmin"in e?cNe(e,t,new ai,i,0):"rings"in e?sge(e,t,new Go,i,0):"paths"in e?lNe(e,t,new Su,i,0):"points"in e?aNe(e,t,new Jw,i,0):null:null}function oNe(e,t,i=t.spatialReference,r=0){return!R(i)&&_(ige(e,e.spatialReference,t,i,r))}function ige(e,t,i,r,s){Gi[0]=e.x,Gi[1]=e.y;const n=e.z;return Gi[2]=n!==void 0?n:s,dr(Gi,t,0,Gi,r,0,1)?(i.x=Gi[0],i.y=Gi[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=Gi[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function aNe(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!dr(h,t,0,h,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,m=h[f],y=h[f+1];o&&a?l.push([m,y,h[f+2],n[p][3]]):o?l.push([m,y,h[f+2]]):a?l.push([m,y,n[p][2]]):l.push([m,y])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function lNe(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return oge(n,o,a,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function rge(e,t,i=t.spatialReference,r=0){return _(i)&&_(sge(e,e.spatialReference,t,i,r))}function sge(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return oge(n,o,a,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function cNe(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return nte(n,o,c?e.zmin:s,t,Gi,r)?(i.xmin=Gi[0],i.ymin=Gi[1],c&&(i.zmin=Gi[2]),nte(a,l,c?e.zmax:s,t,Gi,r)?(i.xmax=Gi[0],i.ymax=Gi[1],c&&(i.zmax=Gi[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function Jv(e,t,i){if(R(t)||R(i))return null;const r=new ot({spatialReference:i});return dr(e,t,0,Gi,i,0,1)?(r.x=Gi[0],r.y=Gi[1],r.z=Gi[2],r):null}function nge(e,t,i){return dr(e,t,0,Gi,i.spatialReference,0,1)?(i.x=Gi[0],i.y=Gi[1],i.z=Gi[2],i):null}function jn(e,t,i,r=0){Gi[0]=e.x,Gi[1]=e.y;const s=e.z;return Gi[2]=s!==void 0?s:r,dr(Gi,e.spatialReference,0,t,i,0,1)}function nte(e,t,i,r,s,n){return Zr[0]=e,Zr[1]=t,Zr[2]=i,dr(Zr,r,0,s,n,0,1)}function un(e,t,i,r){return!(R(t)||R(r)||e.length<2)&&(e.length===2&&(Zr[0]=e[0],Zr[1]=e[1],Zr[2]=0,e=Zr),dr(e,t,0,i,r,0,1))}function uNe(e,t){Gi[0]=e.x,Gi[1]=e.y;const i=e.z;return Gi[2]=i!==void 0?i:0,hNe(Gi,e.spatialReference,t)}function hNe(e,t,i){return dNe(e,t,i)}function dNe(e,t,i){if(R(t))return!1;const r=Kv(t,uk),s=Ff[r][J.WGS84_COMPARABLE_LON_LAT];return!R(s)&&(s(e,0,Zr,0),i!==Zr&&(i[0]=Zr[0],i[1]=Zr[1],i.length>2&&(i[2]=Zr[2])),!0)}function dr(e,t,i,r,s,n,o=1){const a=JX(t,s,eZ);if(R(a))return!1;if(a===vr){if(e===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=e[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(e,c,r,h);return!0}function MSt(e,t,i,r,s){ae(Gi,e),de(cI,e,t),un(Gi,i,Gi,s),un(cI,i,cI,s),pe(r,cI,Gi),we(r,r)}function oge(e,t,i,r,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!dr(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&i?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function pNe(e,t,i,r){if(R(t)||R(r))return!1;const s=mge(t,r,wNe);if(s.projector===vr)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(R(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===J.WEB_MERCATOR){const a=Ff[n.spatialReferenceId][J.WGS84];return!R(a)&&(a(e,0,Bd,0),bw(Bd,0,i,0),i[3]=ote(Bd[1],e[2],e[3],Pi.radius),!0)}if(n.spatialReferenceId!==J.WGS84&&n.spatialReferenceId!==J.CGCS2000||o.spatialReferenceId!==J.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*n.metersPerUnit/o.metersPerUnit;else{const a=Ff[n.spatialReferenceId][J.SPHERICAL_ECEF],l=Ff[J.SPHERICAL_ECEF][J.PLATE_CARREE];let c=e[3];_(a)&&_(l)&&(c=ote(e[1],e[2],e[3],Pi.radius)),s.projector(e,0,i,0),i[3]=c}return!0}function ote(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(lp*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function ck(e,t,i,r){return e!=null&&(Mc(t,r)?(Jg(i,e),!0):(Zr[0]=e[0],Zr[1]=e[1],Zr[2]=0,!!dr(Zr,t,0,Zr,r,0,1)&&(i[0]=Zr[0],i[1]=Zr[1],Zr[0]=e[2],Zr[1]=e[3],Zr[2]=0,!!dr(Zr,t,0,Zr,r,0,1)&&(i[2]=Zr[0],i[3]=Zr[1],!0))))}function OSt(e,t,i,r){if(R(t)||R(r))return!1;const s=Kv(t,uk),n=Kv(r,gge);if(s===n&&s!==J.UNKNOWN||Mc(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===J.SPHERICAL_ECEF){const o=Me(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/Pi.radius;if(n===J.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===J.WGS84||n===J.CGCS2000){const c=lM;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===J.PLATE_CARREE){if(n===J.WGS84||n===J.CGCS2000)return i[0]=lM,i[1]=lM,i[2]=1,!0;if(n===J.WEB_MERCATOR){const o=e[1]/Pi.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function Nu(e,t,i,r){if(R(e)||R(r))return!1;const s=Kv(e,uk),n=Kv(r,gge);if(s===n&&!ate(n)&&(s!==J.UNKNOWN||Mc(e,r)))return ak(i,t),!0;if(ate(n)){const o=Ff[s][J.LON_LAT],a=Ff[J.LON_LAT][n];return!R(o)&&!R(a)&&(o(t,0,Bd,0),a(Bd,0,Py,0),age(lp*Bd[0],lp*Bd[1],i),i[12]=Py[0],i[13]=Py[1],i[14]=Py[2],!0)}if((n===J.WEB_MERCATOR||n===J.PLATE_CARREE)&&(s===J.WGS84||s===J.CGCS2000&&n===J.PLATE_CARREE||s===J.SPHERICAL_ECEF||s===J.WEB_MERCATOR)){const o=Ff[s][J.LON_LAT],a=Ff[J.LON_LAT][n];return!R(o)&&!R(a)&&(o(t,0,Bd,0),a(Bd,0,Py,0),s===J.SPHERICAL_ECEF?fNe(lp*Bd[0],lp*Bd[1],i):tm(i),i[12]=Py[0],i[13]=Py[1],i[14]=Py[2],!0)}return!1}function ate(e){return e===J.SPHERICAL_ECEF||e===J.SPHERICAL_MARS_PCPF||e===J.SPHERICAL_MOON_PCPF}function age(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function fNe(e,t,i){return age(e,t,i),Dl(i,i),i}function Kv(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=$c(e,1)),e.wkt===cme.wkt?t.spatialReferenceId=J.SPHERICAL_ECEF:ZM(e)?t.spatialReferenceId=J.WGS84:hw(e)?t.spatialReferenceId=J.WEB_MERCATOR:YM(e)?t.spatialReferenceId=J.PLATE_CARREE:e.wkt===eLe.wkt?t.spatialReferenceId=J.WGS84_ECEF:e.wkid===Dh.CGCS2000?t.spatialReferenceId=J.CGCS2000:e.wkt===_F.wkt?t.spatialReferenceId=J.SPHERICAL_MARS_PCPF:e.wkt===bF.wkt?t.spatialReferenceId=J.SPHERICAL_MOON_PCPF:lm(e)?t.spatialReferenceId=J.GCSMARS2000:cm(e)?t.spatialReferenceId=J.GCSMOON2000:t.spatialReferenceId=J.UNKNOWN)}function vr(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function Jb(e,t,i,r){i[r++]=Z2*(e[t++]/Pi.radius),i[r++]=Z2*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/Pi.radius))),i[r]=e[t]}function lge(e,t,i,r){Jb(e,t,i,r),bv(i,r,i,r)}function cge(e,t,i,r){Jb(e,t,i,r),xv(i,r,i,r)}function ZX(e,t,i,r,s){const n=.4999999*Math.PI,o=De(lp*e[t+1],-n,n),a=Math.sin(o);i[r++]=lp*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function bw(e,t,i,r){ZX(e,t,i,r,Pi)}const lte=Pi.radius*Math.PI/180,lM=180/(Pi.radius*Math.PI);function _v(e,t,i,r){i[r]=e[t]*lte,i[r+1]=e[t+1]*lte,i[r+2]=e[t+2]}function Ob(e,t,i,r){i[r]=e[t]*lM,i[r+1]=e[t+1]*lM,i[r+2]=e[t+2]}function uge(e,t,i,r){Jb(e,t,i,r),_v(i,r,i,r)}function mNe(e,t,i,r){Tv(e,t,i,r),_v(i,r,i,r)}function gNe(e,t,i,r){wv(e,t,i,r),_v(i,r,i,r)}function yNe(e,t,i,r){Ob(e,t,i,r),bv(i,r,i,r)}function vNe(e,t,i,r){Ob(e,t,i,r),bw(i,r,i,r)}function _Ne(e,t,i,r){Ob(e,t,i,r),xv(i,r,i,r)}function ww(e){if(R(e))return!1;const t=Kv(e,uk);return!!Ff[t][J.WGS84_COMPARABLE_LON_LAT]}function CC(e,t,i,r){const s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}function YX(e,t,i,r,s){const n=s+e[t+2],o=lp*e[t+1],a=lp*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function y7(e,t,i,r){YX(e,t,i,r,Yg.radius)}function v7(e,t,i,r){YX(e,t,i,r,Uf.radius)}function bv(e,t,i,r){YX(e,t,i,r,Pi.radius)}function QX(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=Tp(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=Z2*h,i[r++]=Z2*c,i[r]=l-s}function _7(e,t,i,r){QX(e,t,i,r,Yg.radius)}function b7(e,t,i,r){QX(e,t,i,r,Uf.radius)}function wv(e,t,i,r){QX(e,t,i,r,Pi.radius)}function hge(e,t,i,r){wv(e,t,i,r),bw(i,r,i,r)}function dge(e,t,i,r){wv(e,t,i,r),xv(i,r,i,r)}function bNe(e,t,i,r,s){const n=lp*e[t],o=lp*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function xv(e,t,i,r){bNe(e,t,i,r,Pi)}function Tv(e,t,i,r){const s=JDe,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,f,m,y,v,w,b,S,T,E,C,A,I,D,L,z,B,V;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),B=Math.atan2(o,n),m=a*a/p,y=c/p,C=s.a2/f,A=s.a3-s.a4/f,y>.3?(v=l/f*(1+y*(s.a1+C+m*A)/f),z=Math.asin(v),b=v*v,w=Math.sqrt(1-b)):(w=h/f*(1-m*(s.a5-C-y*A)/f),z=Math.acos(w),b=1-w*w,v=Math.sqrt(b)),S=1-Pi.eccentricitySquared*b,T=Pi.radius/Math.sqrt(S),E=s.a6*T,C=h-T*w,A=l-E*v,D=w*C+v*A,I=w*A-v*C,L=I/(E/S+D),z+=L,V=D+I*L/2,a<0&&(z=-z),i[r++]=Z2*B,i[r++]=Z2*z,i[r]=V}function pge(e,t,i,r){Tv(e,t,i,r),bv(i,r,i,r)}function fge(e,t,i,r){Tv(e,t,i,r),bw(i,r,i,r)}const Ff={[J.WGS84]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:vr,[J.WGS84_COMPARABLE_LON_LAT]:vr,[J.SPHERICAL_ECEF]:bv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:bw,[J.PLATE_CARREE]:_v,[J.WGS84]:vr,[J.WGS84_ECEF]:xv},[J.CGCS2000]:{[J.CGCS2000]:vr,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:vr,[J.WGS84_COMPARABLE_LON_LAT]:vr,[J.SPHERICAL_ECEF]:bv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:_v,[J.WGS84]:null,[J.WGS84_ECEF]:xv},[J.GCSMARS2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:vr,[J.GCSMOON2000]:null,[J.LON_LAT]:vr,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:v7,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.GCSMOON2000]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:vr,[J.LON_LAT]:vr,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:y7,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.WEB_MERCATOR]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Jb,[J.WGS84_COMPARABLE_LON_LAT]:Jb,[J.SPHERICAL_ECEF]:lge,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:vr,[J.PLATE_CARREE]:uge,[J.WGS84]:Jb,[J.WGS84_ECEF]:cge},[J.WGS84_ECEF]:{[J.CGCS2000]:Tv,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Tv,[J.WGS84_COMPARABLE_LON_LAT]:Tv,[J.SPHERICAL_ECEF]:pge,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:fge,[J.PLATE_CARREE]:mNe,[J.WGS84]:Tv,[J.WGS84_ECEF]:vr},[J.SPHERICAL_ECEF]:{[J.CGCS2000]:wv,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:wv,[J.WGS84_COMPARABLE_LON_LAT]:wv,[J.SPHERICAL_ECEF]:vr,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:hge,[J.PLATE_CARREE]:gNe,[J.WGS84]:wv,[J.WGS84_ECEF]:dge},[J.SPHERICAL_MARS_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:b7,[J.GCSMOON2000]:null,[J.LON_LAT]:b7,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:vr,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.SPHERICAL_MOON_PCPF]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:_7,[J.LON_LAT]:_7,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:vr,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.UNKNOWN]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:null,[J.WGS84_COMPARABLE_LON_LAT]:null,[J.SPHERICAL_ECEF]:null,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:vr,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:null,[J.WGS84]:null,[J.WGS84_ECEF]:null},[J.LON_LAT]:{[J.CGCS2000]:vr,[J.GCSMARS2000]:vr,[J.GCSMOON2000]:vr,[J.LON_LAT]:vr,[J.WGS84_COMPARABLE_LON_LAT]:vr,[J.SPHERICAL_ECEF]:bv,[J.SPHERICAL_MARS_PCPF]:v7,[J.SPHERICAL_MOON_PCPF]:y7,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:bw,[J.PLATE_CARREE]:_v,[J.WGS84]:vr,[J.WGS84_ECEF]:xv},[J.WGS84_COMPARABLE_LON_LAT]:{[J.CGCS2000]:null,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:vr,[J.WGS84_COMPARABLE_LON_LAT]:vr,[J.SPHERICAL_ECEF]:bv,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:null,[J.PLATE_CARREE]:_v,[J.WGS84]:vr,[J.WGS84_ECEF]:xv},[J.PLATE_CARREE]:{[J.CGCS2000]:Ob,[J.GCSMARS2000]:null,[J.GCSMOON2000]:null,[J.LON_LAT]:Ob,[J.WGS84_COMPARABLE_LON_LAT]:Ob,[J.SPHERICAL_ECEF]:yNe,[J.SPHERICAL_MARS_PCPF]:null,[J.SPHERICAL_MOON_PCPF]:null,[J.UNKNOWN]:null,[J.WEB_MERCATOR]:vNe,[J.PLATE_CARREE]:vr,[J.WGS84]:Ob,[J.WGS84_ECEF]:_Ne}};function JX(e,t,i=KX()){return R(e)||R(t)?null:mge(e,t,i).projector}function mge(e,t,i){if(R(e)||R(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=Kv(e,i.source),s=Kv(t,i.dest);return r===J.UNKNOWN&&s===J.UNKNOWN?Mc(e,t)?i.projector=vr:i.projector=null:i.projector=Ff[r][s],i}function KX(){return{source:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:J.UNKNOWN,metersPerUnit:1},projector:vr}}const uk={spatialReference:null,spatialReferenceId:J.UNKNOWN},gge={spatialReference:null,spatialReferenceId:J.UNKNOWN},eZ=KX(),wNe=KX(),lp=Dt(1),Z2=Ac(1),Zr=O(),Bd=O(),Py=O(),Gi=O(),cI=O();class py{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&O2(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*cte);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,cte));t++)this._items.push(this.allocator())}}const cte=1024;function Ae(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Kb(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function tZ(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v){return[e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v]}function yge(e,t){return new Float64Array(e,t,16)}const hn=Ae();Object.freeze(Object.defineProperty({__proto__:null,create:Ae,clone:Kb,fromValues:tZ,createView:yge,IDENTITY:hn},Symbol.toStringTag,{value:"Module"}));var Ou;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Ou||(Ou={}));function xNe(e){return 32+e.length}function TNe(){return 16}function vge(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=xNe(r);break;case"number":t+=TNe();break;case"boolean":t+=4}}return t}function PSt(e,t){return 32+e.length*t}var Y2;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(Y2||(Y2={}));function Or(){return[1,0,0,0,1,0,0,0,1]}function SNe(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function ENe(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]}function _ge(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Or,clone:SNe,fromValues:ENe,createView:_ge},Symbol.toStringTag,{value:"Module"}));function fy(){return[0,0,0,1]}function CNe(e){return[e[0],e[1],e[2],e[3]]}function ANe(e,t,i,r){return[e,t,i,r]}function bge(e,t){return new Float64Array(e,t,4)}const RNe=fy();Object.freeze(Object.defineProperty({__proto__:null,create:fy,clone:CNe,fromValues:ANe,createView:bge,IDENTITY:RNe},Symbol.toStringTag,{value:"Module"}));function it(){return[0,0]}function lR(e){return[e[0],e[1]]}function Di(e,t){return[e,t]}function wge(e){const t=it(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function xge(e,t){return new Float64Array(e,t,2)}function Tge(){return it()}function Sge(){return Di(1,1)}function Ege(){return Di(1,0)}function Cge(){return Di(0,1)}const Zh=Tge(),Age=Sge(),MNe=Ege(),ONe=Cge();Object.freeze(Object.defineProperty({__proto__:null,create:it,clone:lR,fromValues:Di,fromArray:wge,createView:xge,zeros:Tge,ones:Sge,unitX:Ege,unitY:Cge,ZEROS:Zh,ONES:Age,UNIT_X:MNe,UNIT_Y:ONe},Symbol.toStringTag,{value:"Module"}));function Xt(){return[0,0,0,0]}function hk(e){return[e[0],e[1],e[2],e[3]]}function bi(e,t,i,r){return[e,t,i,r]}function iZ(e){const t=Xt(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function Rge(e,t){return new Float64Array(e,t,4)}function Mge(){return Xt()}function Oge(){return bi(1,1,1,1)}function Pge(){return bi(1,0,0,0)}function Ige(){return bi(0,1,0,0)}function $ge(){return bi(0,0,1,0)}function Lge(){return bi(0,0,0,1)}const Vf=Mge(),Nh=Oge(),PNe=Pge(),INe=Ige(),$Ne=$ge(),LNe=Lge();Object.freeze(Object.defineProperty({__proto__:null,create:Xt,clone:hk,fromValues:bi,fromArray:iZ,createView:Rge,zeros:Mge,ones:Oge,unitX:Pge,unitY:Ige,unitZ:$ge,unitW:Lge,ZEROS:Vf,ONES:Nh,UNIT_X:PNe,UNIT_Y:INe,UNIT_Z:$Ne,UNIT_W:LNe},Symbol.toStringTag,{value:"Module"}));class yu{constructor(t,i,r){this.itemByteSize=t,this.itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){this._itemsPtr===0&&O2(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(i,r*this.itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=yx){return new yu(16,xge,t)}static createVec3f64(t=yx){return new yu(24,HW,t)}static createVec4f64(t=yx){return new yu(32,Rge,t)}static createMat3f64(t=yx){return new yu(72,_ge,t)}static createMat4f64(t=yx){return new yu(128,yge,t)}static createQuatf64(t=yx){return new yu(32,bge,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const yx=4*Y2.KILOBYTES,ISt=yu.createVec2f64(),He=yu.createVec3f64(),rZ=yu.createVec4f64();yu.createMat3f64();const sZ=yu.createMat4f64(),$St=yu.createQuatf64();function fm(e){return e?{origin:Vs(e.origin),vector:Vs(e.vector)}:{origin:O(),vector:O()}}function DNe(e,t){const i=FNe.get();return i.origin=e,i.vector=t,i}function LSt(e,t=fm()){return NNe(e.origin,e.vector,t)}function NNe(e,t,i=fm()){return ae(i.origin,e),ae(i.vector,t),i}function ew(e,t,i=fm()){return ae(i.origin,e),pe(i.vector,t,e),i}function nZ(e,t){const i=pe(He.get(),t,e.origin),r=xe(e.vector,i),s=xe(e.vector,e.vector),n=De(r/s,0,1),o=pe(He.get(),le(He.get(),e.vector,n),i);return xe(o,o)}function DSt(e,t,i){return w7(e,t,0,1,i)}function NSt(e,t,i){return de(i,e.origin,le(i,e.vector,t))}function w7(e,t,i,r,s){const{vector:n,origin:o}=e,a=pe(He.get(),t,o),l=xe(n,a)/Ua(n);return le(s,n,De(l,i,r)),de(s,s,e.origin)}function FSt(e,t){if(Nge(e,DNe(t.origin,t.direction),!1,PF)){const{tA:i,pB:r,distance2:s}=PF;if(i>=0&&i<=1)return s;if(i<0)return Sn(e.origin,r);if(i>1)return Sn(de(He.get(),e.origin,e.vector),r)}return null}function Dge(e,t,i){return!!Nge(e,t,!0,PF)&&(ae(i,PF.pA),!0)}function Nge(e,t,i,r){const n=e.origin,o=de(He.get(),n,e.vector),a=t.origin,l=de(He.get(),a,t.vector),c=He.get(),h=He.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=He.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],m=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],y=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],w=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*v-m*m;if(Math.abs(w)<1e-6)return!1;let b=(f*m-y*v)/w,S=(f+m*b)/v;i&&(b=De(b,0,1),S=De(S,0,1));const T=He.get(),E=He.get();return T[0]=n[0]+b*p[0],T[1]=n[1]+b*p[1],T[2]=n[2]+b*p[2],E[0]=a[0]+S*h[0],E[1]=a[1]+S*h[1],E[2]=a[2]+S*h[2],r.tA=b,r.tB=S,r.pA=T,r.pB=E,r.distance2=Sn(T,E),!0}const PF={tA:0,tB:0,pA:O(),pB:O(),distance2:0},FNe=new py(()=>({origin:null,vector:null}));function fo(e){return e?{origin:Vs(e.origin),direction:Vs(e.direction)}:{origin:O(),direction:O()}}function kSt(e,t){return Hv(e.origin,t.origin)&&Hv(e.direction,t.direction)}function Fu(e,t){const i=BNe.get();return i.origin=e,i.direction=t,i}function IF(e,t=fo()){return Fge(e.origin,e.direction,t)}function kNe(e,t,i=fo()){return ae(i.origin,e),pe(i.direction,t,e),i}function Fge(e,t,i=fo()){return ae(i.origin,e),ae(i.direction,t),i}function UNe(e,t){const i=ct(He.get(),we(He.get(),e.direction),pe(He.get(),t,e.origin));return xe(i,i)}function zNe(e,t,i){const r=xe(e.direction,pe(i,t,e.origin));return de(i,e.origin,le(i,e.direction,r)),i}function VNe(){return{origin:null,direction:null}}const BNe=new py(VNe);function cM(e,t){return xe(e,t)/Me(e)}function oZ(e,t){const i=xe(e,t)/(Me(e)*Me(t));return-fn(i)}function GNe(e,t,i){we(uI,e),we(m6,t);const r=xe(uI,m6),s=fn(r),n=ct(uI,uI,m6);return xe(n,i)<0?2*Math.PI-s:s}const uI=O(),m6=O(),jNe=fe.getLogger("esri.geometry.support.sphere");function En(){return Xt()}function Q2(e,t=En()){return sp(t,e)}function kge(e,t){return bi(e[0],e[1],e[2],t)}function HNe(e){return e}function Uge(e){e[0]=e[1]=e[2]=e[3]=0}function dk(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function Fg(e){return e[3]}function qNe(e){return e}function zge(e,t,i,r){return bi(e,t,i,r)}function WNe(e,t,i){return e!==i&&ae(i,e),i[3]=e[3]+t,i}function XNe(e,t,i){return jNe.error("sphere.setExtent is not yet supported"),e===i?i:Q2(e,i)}function y_(e,t,i){if(R(t))return!1;const{origin:r,direction:s}=t,n=ZNe;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const ZNe=O();function x7(e,t){return y_(e,t,null)}function YNe(e,t,i){if(y_(e,t,i))return i;const r=ZE(e,t,He.get());return de(i,t.origin,le(He.get(),t.direction,ur(t.origin,r)/Me(t.direction))),i}function ZE(e,t,i){const r=He.get(),s=sZ.get();ct(r,t.origin,t.direction);const n=Fg(e);ct(i,r,t.origin),le(i,i,1/Me(i)*n);const o=Gge(e,t.origin),a=oZ(t.origin,i);return Du(s,a+o,r),ze(i,i,s),i}function QNe(e,t,i){return y_(e,t,i)?i:(zNe(t,e,i),Vge(e,i,i))}function Vge(e,t,i){const r=pe(He.get(),t,e),s=le(He.get(),r,e[3]/Me(r));return de(i,s,e)}function Bge(e,t){const i=pe(He.get(),t,e),r=Ua(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function Gge(e,t){const i=pe(He.get(),t,e),r=Me(i),s=Fg(e),n=s+Math.abs(s-r);return fn(s/n)}const g6=O();function jge(e,t,i,r){const s=pe(g6,t,e);switch(i){case Ou.X:{const n=ree(s,g6)[2];return se(r,-Math.sin(n),Math.cos(n),0)}case Ou.Y:{const n=ree(s,g6),o=n[1],a=n[2],l=Math.sin(o);return se(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Ou.Z:return we(r,s);default:return}}function Hge(e,t){const i=pe(T7,t,e);return Me(i)-e[3]}function JNe(e,t,i,r){const s=Hge(e,t),n=jge(e,t,Ou.Z,T7),o=le(T7,n,i-s);return de(r,t,o)}function KNe(e,t){const i=Sn(e,t),r=Fg(e);return i<=r*r}const T7=O(),pk=En(),eFe=Object.freeze(Object.defineProperty({__proto__:null,create:En,copy:Q2,fromCenterAndRadius:kge,wrap:HNe,clear:Uge,fromRadius:dk,getRadius:Fg,getCenter:qNe,fromValues:zge,elevate:WNe,setExtent:XNe,intersectRay:y_,intersectsRay:x7,intersectRayClosestSilhouette:YNe,closestPointOnSilhouette:ZE,closestPoint:QNe,projectPoint:Vge,distanceToSilhouette:Bge,angleToSilhouette:Gge,axisAt:jge,altitudeAt:Hge,setAltitudeAt:JNe,containsPoint:KNe,tmpSphere:pk},Symbol.toStringTag,{value:"Module"}));function xw(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function tFe(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return se(e,i,r,s),e}function USt(e,t,i){i=i||e;const r=xe(e,t);se(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),we(i,i)}function zSt(e,t,i){Math.abs(e[0])>Math.abs(e[1])?se(t,0,1,0):se(t,1,0,0),ct(i,e,t),we(t,t),ct(t,i,e),we(i,i)}function hI(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function iFe(e,t,i,r=O()){const s=Me(e),n=Me(t),o=xe(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return le(Pb,e,c),le(Ib,t,h),de(r,Pb,Ib)}return pn(r,e,t,i)}function VSt(e,t,i,r=O(),s=O()){const n=Me(e),o=Me(t),a=xe(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*n+i*o;{const m=f/c,y=m/o*h;le(Pb,e,m/n*p),le(Ib,t,y),de(r,Pb,Ib)}{const m=1/n*(-Math.cos((1-i)*l)*l*f+p*(-n+o));le(Pb,e,m);const y=1/o*(Math.cos(i*l)*l*f+h*(-n+o));le(Ib,t,y),de(s,Pb,Ib),le(s,s,1/c)}return s}return pn(r,e,t,i),pe(s,t,e),we(s,s),s}function wD(e,t,i){e=we(Pb,e),t=we(Ib,t);const r=fn(xe(e,t));if(i){const s=ct(rFe,e,t);if(xe(s,i)<0)return-r}return r}function xD(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function BSt(e,t,i,r){pe(ute,t,e),pe(hte,i,e),ct(r,ute,hte),we(r,r),r[3]=-xe(e,r)}const ute=O(),hte=O(),rFe=O(),Pb=O(),Ib=O();function Si(e=cR){return[e[0],e[1],e[2],e[3]]}function sFe(e=cR[0],t=cR[1],i=cR[2],r=cR[3]){return aZ(e,t,i,r,rZ.get())}function fk(e,t){return aZ(t[0],t[1],t[2],t[3],e)}function aZ(e,t,i,r,s=Si()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function qge(e,t,i){return ae(i,e),i[3]=t,i}function J2(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function na(e,t,i,r=Si()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,f=s*l-n*a,m=h*h+p*p+f*f,y=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=h*y,r[1]=p*y,r[2]=f*y,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function Wge(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,AC);let n=r,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,vx),n++,o=!Tl(AC,vx);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,fb),n++,pe(dI,AC,vx),we(dI,dI),pe(pI,vx,fb),we(pI,pI),o=!Tl(AC,fb)&&!Tl(vx,fb)&&Math.abs(xe(dI,pI))<nFe;return o?(na(AC,vx,fb,t),!0):(i!==0||r!==1||s!==2)&&Wge(e,t,0,1,2)}const nFe=.99619469809,AC=O(),vx=O(),fb=O(),dI=O(),pI=O();function S7(e,t,i){return t!==e&&fk(e,t),e[3]=-xe(e,i),e}function E7(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function cO(e,t,i,r){return ct(fb,t,e),J2(i,fb,r)}function GSt(e,t,i,r){return mk(e,t,pe(He.get(),i,t),dFe,r)}function ax(e,t,i){return!!_(t)&&mk(e,t.origin,t.direction,pFe,i)}function oFe(e,t,i){return mk(e,t.origin,t.vector,Bf.NONE,i)}function aFe(e,t,i){return mk(e,t.origin,t.vector,Bf.CLAMP,i)}function Xge(e,t){return lr(e,t)>=0}function lFe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function cFe(e,t){const i=xe(e,t.ray.direction),r=-lr(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function uFe(e,t){const i=xe(e,t.ray.direction),r=-lr(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function hFe(e,t,i){const r=le(He.get(),e,-e[3]),s=C7(e,pe(He.get(),t,r),He.get());return de(i,s,r),i}function C7(e,t,i){const r=le(He.get(),e,xe(e,t));return pe(i,t,r),i}function lr(e,t){return xe(e,t)+e[3]}function mk(e,t,i,r,s){const n=xe(e,i);if(n===0)return!1;let o=-(xe(e,t)+e[3])/n;return r&Bf.CLAMP&&(o=De(o,0,1)),!(!(r&Bf.INFINITE_MIN)&&o<0||!(r&Bf.INFINITE_MAX)&&o>1)&&(de(s,t,le(s,i,o)),!0)}function jSt(e){return e}const cR=[0,0,1,0];var Bf;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(Bf||(Bf={}));const dFe=Bf.INFINITE_MIN|Bf.INFINITE_MAX,pFe=Bf.INFINITE_MAX,y6=fe.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class Zge{constructor(){this.plane=Si(),this.origin=O(),this.basis1=O(),this.basis2=O()}}function v_(e=oye){return{plane:Si(e.plane),origin:Vs(e.origin),basis1:Vs(e.basis1),basis2:Vs(e.basis2)}}function fFe(e,t,i){const r=CFe.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=sFe(0,0,0,0),gk(r),r}function lx(e,t=v_()){return lZ(e.origin,e.basis1,e.basis2,t)}function mFe(e,t){ae(t.origin,e.origin),ae(t.basis1,e.basis1),ae(t.basis2,e.basis2),fk(t.plane,e.plane)}function lZ(e,t,i,r=v_()){return ae(r.origin,e),ae(r.basis1,t),ae(r.basis2,i),gk(r),SFe(r,"fromValues()"),r}function gk(e){cO(e.basis2,e.basis1,e.origin,e.plane)}function Yge(e,t,i){e!==i&&lx(e,i);const r=le(He.get(),ty(e),t);return de(i.origin,i.origin,r),i.plane[3]-=t,i}function gFe(e,t,i){return Qge(t,i),Yge(i,dZ(e,e.origin),i),i}function Qge(e,t=v_()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return se(t.origin,e[0]+i,e[1]+r,0),se(t.basis1,i,0,0),se(t.basis2,0,r,0),aZ(0,0,1,0,t.plane),t}function cZ(e,t,i){return!!ax(e.plane,t,i)&&sye(e,i)}function yFe(e,t,i){if(cZ(e,t,i))return i;const r=Jge(e,t,He.get());return de(i,t.origin,le(He.get(),t.direction,ur(t.origin,r)/Me(t.direction))),i}function Jge(e,t,i){const r=$F.get();nye(e,t,r,$F.get());let s=Number.POSITIVE_INFINITY;for(const n of fZ){const o=pZ(e,n,yk.get()),a=He.get();if(oFe(r,o,a)){const l=uy(He.get(),t.origin,a),c=Math.abs(fn(xe(t.direction,l)));c<s&&(s=c,ae(i,a))}}return s===Number.POSITIVE_INFINITY?Kge(e,t,i):i}function Kge(e,t,i){if(cZ(e,t,i))return i;const r=$F.get(),s=$F.get();nye(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of fZ){const a=pZ(e,o,yk.get()),l=He.get();if(aFe(r,a,l)){const c=UNe(t,l);if(!Xge(s,l))continue;c<n&&(n=c,ae(i,l))}}return uZ(e,t.origin)<n&&eye(e,t.origin,i),i}function eye(e,t,i){const r=hFe(e.plane,t,He.get()),s=w7(dte(e,e.basis1),r,-1,1,He.get()),n=w7(dte(e,e.basis2),r,-1,1,He.get());return pe(i,de(He.get(),s,n),e.origin),i}function tye(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=pe(He.get(),t,r),a=cM(s,o),l=cM(n,o),c=cM(ty(e),o);return se(i,a,l,c)}function uZ(e,t){const i=tye(e,t,He.get()),{basis1:r,basis2:s}=e,n=Me(r),o=Me(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function vFe(e,t){return Math.sqrt(uZ(e,t))}function _Fe(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of fZ){const s=pZ(e,r,yk.get()),n=nZ(s,t);n>i&&(i=n)}return Math.sqrt(i)}function hZ(e,t){return Xge(e.plane,t)&&sye(e,t)}function bFe(e,t,i,r){return TFe(e,i,r)}function dZ(e,t){const i=-e.plane[3];return cM(ty(e),t)-i}function wFe(e,t,i,r){const s=dZ(e,t),n=le(EFe,ty(e),i-s);return de(r,t,n),r}function iye(e,t){return Tl(e.basis1,t.basis1)&&Tl(e.basis2,t.basis2)&&Tl(e.origin,t.origin)}function rye(e,t,i){return e!==i&&lx(e,i),_s(_x,t),Dl(_x,_x),ze(i.basis1,e.basis1,_x),ze(i.basis2,e.basis2,_x),ze(i.plane,e.plane,_x),ze(i.origin,e.origin,t),S7(i.plane,i.plane,i.origin),i}function xFe(e,t,i,r){return e!==r&&lx(e,r),Du(v6,t,i),ze(r.basis1,e.basis1,v6),ze(r.basis2,e.basis2,v6),gk(r),r}function ty(e){return e.plane}function TFe(e,t,i){switch(t){case Ou.X:ae(i,e.basis1),we(i,i);break;case Ou.Y:ae(i,e.basis2),we(i,i);break;case Ou.Z:ae(i,ty(e))}return i}function sye(e,t){const i=pe(He.get(),t,e.origin),r=Ua(e.basis1),s=Ua(e.basis2),n=xe(e.basis1,i),o=xe(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function dte(e,t){const i=yk.get();return ae(i.origin,e.origin),ae(i.vector,t),i}function pZ(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=le(He.get(),r,t.origin[0]),a=le(He.get(),s,t.origin[1]);de(i.origin,o,a),de(i.origin,i.origin,n);const l=le(He.get(),r,t.direction[0]),c=le(He.get(),s,t.direction[1]);return le(i.vector,de(l,l,c),2),i}function SFe(e,t){Math.abs(xe(e.basis1,e.basis2)/(Me(e.basis1)*Me(e.basis2)))>1e-6&&y6.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(xe(e.basis1,ty(e)))>1e-6&&y6.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-xe(ty(e),e.origin)-e.plane[3])>1e-6&&y6.warn(t,"Plane offset is not consistent with plane origin")}function nye(e,t,i,r){const s=ty(e);cO(s,t.direction,t.origin,i),cO(i,s,t.origin,r)}const oye={plane:Si(),origin:Ue(0,0,0),basis1:Ue(1,0,0),basis2:Ue(0,1,0)},$F=new py(Si),yk=new py(fm),EFe=O(),CFe=new py(()=>({origin:null,basis1:null,basis2:null,plane:null})),fZ=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],_x=Ae(),v6=Ae(),AFe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Zge,create:v_,wrap:fFe,copy:lx,copyWithoutVerify:mFe,fromValues:lZ,updateUnboundedPlane:gk,elevate:Yge,setExtent:gFe,fromAABoundingRect:Qge,intersectRay:cZ,intersectRayClosestSilhouette:yFe,closestPointOnSilhouette:Jge,closestPoint:Kge,projectPoint:eye,projectPointLocal:tye,distance2:uZ,distance:vFe,distanceToSilhouette:_Fe,extrusionContainsPoint:hZ,axisAt:bFe,altitudeAt:dZ,setAltitudeAt:wFe,equals:iye,transform:rye,rotate:xFe,normal:ty,UP:oye},Symbol.toStringTag,{value:"Module"}));function RFe(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function MFe(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function OFe(e){return{operations:e,value:e.create()}}function aye(e,t,i=OFe(e)){return i.operations=e,e.copy(t,i.value),i}function PFe(e){return aye(eFe,zge(0,0,0,Ci(e).radius))}const pte=2**50;function IFe(){return aye(AFe,lZ([0,0,0],[pte,0,0],[0,pte,0]))}function $Fe(e,t,i){return e.operations.axisAt(e.value,t,Ou.Z,i)}function LFe(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function DFe(e,t,i){return e.operations.intersectRay(e.value,t,i)}function NFe(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function FFe(e,t){return e.operations.altitudeAt(e.value,t)}function lye(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function kFe(e,t,i,r){return t!==r&&Ss(r,t),se(bx,r[12],r[13],r[14]),lye(e,bx,i,bx),r[12]=bx[0],r[13]=bx[1],r[14]=bx[2],r}function _6(e,t,i){return e.operations.elevate(e.value,t,i.value)}const bx=O();function fte(e,t,i,r,s){return s[0]=xe(e,t),s[1]=xe(e,i),s[2]=xe(e,r),s}function A7(e,t,i,r,s){ae(i,e),ae(fI,t),we(fI,fI),ct(r,fI,i),ct(s,r,i)}function cye(e,t){return e?em(t):t.isGeographic?et.PlateCarree:t}const fI=O(),uye=96;function HSt(e,t){const i=t||e.extent,r=e.width,s=$c(i&&i.spatialReference);return i&&r?i.width/r*s*ume*uye:0}function hye(e,t){return e/($c(t)*ume*uye)}function uM(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function mte(e){return(e==null?void 0:e.type)==="voxel"}function gte(e){return(e==null?void 0:e.type)==="imagery-tile"}function dye(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function mZ(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function qSt(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function R7(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function UFe(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}const zFe=fe.getLogger("esri.support.AnalysesCollection");let K2=class extends oM{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{R(t.item)||t.item.parent===this.owner&&(zFe.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};K2=u([P("esri.support.AnalysesCollection")],K2);const TD={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},b6={xsmall:544,small:768,medium:992,large:1200};function VFe(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function w6(e,t){return t?TD[e].valueToClassName[t].split(" "):[]}const BFe=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new Nt,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=b6}initialize(){this._breakpointsHandles.add(ie(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),Rt))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=lt(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=VFe(i);if(!r){const s=JSON.stringify(b6,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:b6,this._set("breakpoints",F({},i))}_updateClassNames(){if(!this.container)return;const i=uc.acquire(),r=uc.acquire();let s,n=!1;for(s in TD){const o=this[s],a=TD[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,w6(s,o).forEach(l=>r.push(l)),w6(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),uc.release(i),uc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in TD)w6(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([d()],t.prototype,"breakpoints",null),u([d()],t.prototype,"orientation",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),u([d()],t.prototype,"heightBreakpoint",void 0),t=u([P("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var GFe="[object Object]";function jFe(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function HFe(e,t){return function(i){return e(t(i))}}var qFe=Function.prototype,pye=Object.prototype,fye=qFe.toString,WFe=pye.hasOwnProperty,XFe=fye.call(Object),ZFe=pye.toString,YFe=HFe(Object.getPrototypeOf,Object);function QFe(e){return!!e&&typeof e=="object"}function JFe(e){if(!QFe(e)||ZFe.call(e)!=GFe||jFe(e))return!1;var t=YFe(e);if(t===null)return!0;var i=WFe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&fye.call(i)==XFe}var KFe=JFe,mb={exports:{}},qs={},uO={exports:{}},cx={};function mye(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function e4e(e,t,i){}function t4e(e,t,i){}var i4e=/javascript\s*\:/img;function r4e(e,t){return i4e.test(t)?"":t}cx.whiteList=mye();cx.getDefaultWhiteList=mye;cx.onAttr=e4e;cx.onIgnoreAttr=t4e;cx.safeAttrValue=r4e;var s4e={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},RC=s4e;function n4e(e,t){e=RC.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=RC.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var f=RC.trim(h.slice(0,p)),m=RC.trim(h.slice(p+1));if(f){var y=t(s,o.length,f,m,h);y&&(o+=y+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return RC.trim(o)}var o4e=n4e,mI=cx,a4e=o4e;function yte(e){return e==null}function l4e(e){var t={};for(var i in e)t[i]=e[i];return t}function gye(e){e=l4e(e||{}),e.whiteList=e.whiteList||mI.whiteList,e.onAttr=e.onAttr||mI.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||mI.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||mI.safeAttrValue,this.options=e}gye.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=a4e(e,function(l,c,h,p,f){var m=r[h],y=!1;if(m===!0?y=m:typeof m=="function"?y=m(p):m instanceof RegExp&&(y=m.test(p)),y!==!0&&(y=!1),p=o(h,p),!!p){var v={position:c,sourcePosition:l,source:f,isWhite:y};if(y){var w=s(h,p,v);return yte(w)?h+":"+p:w}else{var w=n(h,p,v);if(!yte(w))return w}}});return a};var c4e=gye;(function(e,t){var i=cx,r=c4e;function s(o,a){var l=new r(a);return l.process(o)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})(uO,uO.exports);var gZ={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},u4e=uO.exports.FilterCSS,h4e=uO.exports.getDefaultWhiteList,LF=gZ;function yye(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var vye=new u4e;function d4e(e,t,i){}function p4e(e,t,i){}function f4e(e,t,i){}function m4e(e,t,i){}function _ye(e){return e.replace(y4e,"&lt;").replace(v4e,"&gt;")}function g4e(e,t,i,r){if(i=Eye(i),t==="href"||t==="src"){if(i=LF.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(gI.lastIndex=0,gI.test(i))return""}else if(t==="style"){if(vte.lastIndex=0,vte.test(i)||(_te.lastIndex=0,_te.test(i)&&(gI.lastIndex=0,gI.test(i))))return"";r!==!1&&(r=r||vye,i=r.process(i))}return i=Cye(i),i}var y4e=/</g,v4e=/>/g,_4e=/"/g,b4e=/&quot;/g,w4e=/&#([a-zA-Z0-9]*);?/gim,x4e=/&colon;?/gim,T4e=/&newline;?/gim,gI=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,vte=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,_te=/u\s*r\s*l\s*\(.*/gi;function bye(e){return e.replace(_4e,"&quot;")}function wye(e){return e.replace(b4e,'"')}function xye(e){return e.replace(w4e,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Tye(e){return e.replace(x4e,":").replace(T4e," ")}function Sye(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return LF.trim(t)}function Eye(e){return e=wye(e),e=xye(e),e=Tye(e),e=Sye(e),e}function Cye(e){return e=bye(e),e=_ye(e),e}function S4e(){return""}function E4e(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(o){return i?!0:LF.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return LF.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function C4e(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function A4e(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}qs.whiteList=yye();qs.getDefaultWhiteList=yye;qs.onTag=d4e;qs.onIgnoreTag=p4e;qs.onTagAttr=f4e;qs.onIgnoreTagAttr=m4e;qs.safeAttrValue=g4e;qs.escapeHtml=_ye;qs.escapeQuote=bye;qs.unescapeQuote=wye;qs.escapeHtmlEntities=xye;qs.escapeDangerHtml5Entities=Tye;qs.clearNonPrintableCharacter=Sye;qs.friendlyAttrValue=Eye;qs.escapeAttrValue=Cye;qs.onIgnoreTagStripAll=S4e;qs.StripTagBody=E4e;qs.stripCommentTag=C4e;qs.stripBlankChar=A4e;qs.cssFilter=vye;qs.getDefaultCSSWhiteList=h4e;var vk={},X0=gZ;function R4e(e){var t=X0.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=X0.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function M4e(e){return e.slice(0,2)==="</"}function O4e(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(e.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(e.slice(s,n)),h=e.slice(n,a+1),c=R4e(h),r+=t(n,r.length,c,h,M4e(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var f=1,m=e.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=p;continue e}m=e.charAt(a-++f)}}else if(p===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var P4e=/[^a-zA-Z0-9_:\.\-]/gim;function I4e(e,t){var i=0,r=[],s=!1,n=e.length;function o(p,f){if(p=X0.trim(p),p=p.replace(P4e,"").toLowerCase(),!(p.length<1)){var m=t(p,f||"");m&&r.push(m)}}for(var a=0;a<n;a++){var l=e.charAt(a),c,h;if(s===!1&&l==="="){s=e.slice(i,a),i=a+1;continue}if(s!==!1&&a===i&&(l==='"'||l==="'")&&e.charAt(a-1)==="="){if(h=e.indexOf(l,a+1),h===-1)break;c=X0.trim(e.slice(i+1,h)),o(s,c),s=!1,a=h,i=a+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(h=$4e(e,a),h===-1){c=X0.trim(e.slice(i,a)),o(c),s=!1,i=a+1;continue}else{a=h-1;continue}else if(h=L4e(e,a-1),h===-1){c=X0.trim(e.slice(i,a)),c=bte(c),o(s,c),s=!1,i=a+1;continue}else continue}return i<e.length&&(s===!1?o(e.slice(i)):o(s,bte(X0.trim(e.slice(i))))),X0.trim(r.join(" "))}function $4e(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function L4e(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function D4e(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function bte(e){return D4e(e)?e.substr(1,e.length-2):e}vk.parseTag=O4e;vk.parseAttr=I4e;var N4e=uO.exports.FilterCSS,Gd=qs,Aye=vk,F4e=Aye.parseTag,k4e=Aye.parseAttr,SD=gZ;function yI(e){return e==null}function U4e(e){var t=SD.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=SD.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=SD.trim(e.slice(0,-1))),{html:e,closing:i}}function z4e(e){var t={};for(var i in e)t[i]=e[i];return t}function Rye(e){e=z4e(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Gd.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||Gd.whiteList,e.onTag=e.onTag||Gd.onTag,e.onTagAttr=e.onTagAttr||Gd.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Gd.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Gd.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Gd.safeAttrValue,e.escapeHtml=e.escapeHtml||Gd.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new N4e(e.css))}Rye.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=Gd.stripBlankChar(e)),i.allowCommentTag||(e=Gd.stripCommentTag(e));var p=!1;if(i.stripIgnoreTagBody){var p=Gd.StripTagBody(i.stripIgnoreTagBody,n);n=p.onIgnoreTag}var f=F4e(e,function(m,y,v,w,b){var S={sourcePosition:m,position:y,isClosing:b,isWhite:r.hasOwnProperty(v)},T=s(v,w,S);if(!yI(T))return T;if(S.isWhite){if(S.isClosing)return"</"+v+">";var E=U4e(w),C=r[v],A=k4e(E.html,function(D,L){var z=SD.indexOf(C,D)!==-1,B=o(v,D,L,z);if(!yI(B))return B;if(z)return L=l(v,D,L,h),L?D+'="'+L+'"':D;var B=a(v,D,L,z);return yI(B)?void 0:B}),w="<"+v;return A&&(w+=" "+A),E.closing&&(w+=" /"),w+=">",w}else{var T=n(v,w,S);return yI(T)?c(w):T}},c);return p&&(f=p.remove(f)),f};var V4e=Rye;(function(e,t){var i=qs,r=vk,s=V4e;function n(l,c){var h=new s(c);return h.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var o in i)t[o]=i[o];for(var o in r)t[o]=r[o];function a(){return typeof self!="undefined"&&typeof DedicatedWorkerGlobalScope!="undefined"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=e.exports)})(mb,mb.exports);var B4e=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):mb.exports.safeAttrValue(n,o,a,l)}};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new mb.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t=="undefined"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i!=null?i:{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?mb.exports.escapeAttrValue(t):!n&&!s?mb.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):mb.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(KFe(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof t=="undefined"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const _k=new Map;function Mye(){_k.clear()}function G4e(e){return _k.get(e)}function j4e(e,t){_k.set(e,t)}function x6(e){_k.delete(e)}var Tw,eE,H4e=function(e){if("WebkitTransition"in e.style)Tw="webkitTransitionEnd",eE="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");Tw="transitionend",eE="animationend"}},Oye=function(e){Tw||H4e(e)},q4e=function(e,t){return t===void 0&&(t=e+"-active"),function(i){Oye(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(Tw,s),i.removeEventListener(eE,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(Tw,s),i.addEventListener(eE,s),requestAnimationFrame(function(){i.classList.add(t)})}},W4e=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){Oye(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(Tw,n),i.removeEventListener(eE,n),r())};i.classList.add(e),i.addEventListener(Tw,n),i.addEventListener(eE,n),requestAnimationFrame(function(){i.classList.add(t)})}};const X4e=fe.getLogger("esri.widgets.support.widgetUtils");function AS(e){const t=uc.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const i=t.join(" ");return uc.release(t),i}(()=>{const e=new Map,t=new ResizeObserver(i=>{Mye();for(const r of i)e.get(r.target)(r)});return(i,r,s)=>(e.has(i)&&X4e.error("Already observing element",i),e.set(i,r),t.observe(i,s),qh(()=>{t.unobserve(i),e.delete(i)}))})();function cp(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function wte(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function M7(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function Z4e(e,t){return(e==="enter"?q4e:W4e)(t)}const Y4e=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],Q4e=Y4e.reduce((e,t)=>(e[t]=[],e),{}),J4e=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Pye=new B4e({whiteList:Q4e,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(J4e.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function K4e(e){return e==="Enter"||e===" "}const Iye="http://www.w3.org/",bk=`${Iye}2000/svg`,$ye=`${Iye}1999/xlink`;let DF,xte=[],yZ=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},vZ=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Lye=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},e5e=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(vZ(e[r],t))return r}return-1},T6=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n?n.key===void 0?n.bind:n.key:void 0)){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(vZ(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},t5e=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},O7=[],P7=!1,Dye=e=>{(e.children||[]).forEach(Dye),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},Tte=()=>{P7=!1,O7.forEach(Dye),O7.length=0},Ste=e=>{O7.push(e),P7||(P7=!0,typeof window!="undefined"&&"requestIdleCallback"in window?window.requestIdleCallback(Tte,{timeout:16}):setTimeout(Tte,16))},Ete=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),Ste(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),Ste(e))},i5e=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")I7(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p];l[f]&&e.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let f=c[p],m=l[f];m&&(Lye(m),i.styleApplyer(e,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):i.namespace===bk?a==="href"?e.setAttributeNS($ye,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=Pye.sanitize(l):e.setAttribute(a,l):e[a]=l}}},r5e=(e,t,i)=>{if(t)for(let r of t)RS(r,e,void 0,i)},Nye=(e,t,i)=>{r5e(e,t.children,i),t.text&&(e.textContent=t.text),i5e(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},RS=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=yZ(r,{namespace:bk})),r.namespace!==void 0?s=e.domNode=a.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}Nye(s,e,r)}},I7=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},s5e=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=t[l];if(l==="class")h!==c&&(I7(e,h,!1),I7(e,c,!0));else if(l==="classes"){let p=e.classList,f=Object.keys(c),m=f.length;for(let y=0;y<m;y++){let v=f[y],w=!!c[v];w!==!!h[v]&&(s=!0,w?p.add(v):p.remove(v))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let m=0;m<f;m++){let y=p[m],v=c[y];v!==h[y]&&(s=!0,v?(Lye(v),r.styleApplyer(e,y,v)):r.styleApplyer(e,y,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===bk?l==="href"?e.setAttributeNS($ye,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=Pye.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},n5e=(e,t,i,r,s)=>{if(i===r)return!1;r=r||xte;let n,o=(i=i||xte).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&vZ(p,f))h=DF(p,f,s)||h,l++;else{let m=e5e(i,f,l+1);if(m>=0){for(n=l;n<m;n++)Ete(i[n]),T6(i,n,e,"removed");h=DF(i[m],f,s)||h,l=m+1}else RS(f,t,l<o?i[l].domNode:void 0,s),t5e(f),T6(r,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)Ete(i[n]),T6(i,n,e,"removed");return h};DF=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(o,r),t.domNode=o,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=yZ(i,{namespace:bk})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=n5e(t,r,e.children,t.children,i)||n,n=s5e(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let MC=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,DF(r,i,t)},domNode:e.domNode});const o5e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let PT=e=>yZ(o5e,e),Sv={create:(e,t)=>(t=PT(t),RS(e,document.createElement("div"),void 0,t),MC(e,t)),append:(e,t,i)=>(i=PT(i),RS(t,e,void 0,i),MC(t,i)),insertBefore:(e,t,i)=>(i=PT(i),RS(t,e.parentNode,e,i),MC(t,i)),merge:(e,t,i)=>(i=PT(i),t.domNode=e,Nye(e,t,i),MC(t,i)),replace:(e,t,i)=>(i=PT(i),RS(t,e.parentNode,e,i),e.parentNode.removeChild(e),MC(t,i))},Fye,a5e=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};Fye=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let l5e=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?Fye(i.children,s=>s.domNode===r):void 0}),i},c5e=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),o=a5e(s.currentTarget,n.domNode);o.reverse();let a,l=l5e(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},NF=e=>{let t,i,r=PT(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,f,m)=>{let y,v=()=>y;r.eventHandlerInterceptor=c5e(t,v,s),y=p(f,m(),r),a.push(y),l.push(m)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();s("rendered",void 0),a[p].update(f),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,f)=>{c(Sv.append,p,f)},insertBefore:(p,f)=>{c(Sv.insertBefore,p,f)},merge:(p,f)=>{c(Sv.merge,p,f)},replace:(p,f)=>{c(Sv.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},t},T0=class extends Se{constructor(){super(...arguments),this.items=new ut,this._watchUpdatingTracking=new zf,this._callbacks=new Map,this._projector=NF(),this._hiddenProjector=NF()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}};u([d({readOnly:!0})],T0.prototype,"surface",void 0),u([d({readOnly:!0})],T0.prototype,"items",void 0),u([d({readOnly:!0})],T0.prototype,"needsRender",null),u([d({readOnly:!0})],T0.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],T0.prototype,"updating",void 0),T0=u([P("esri.views.overlay.ViewOverlay")],T0);const Cte=T0;function _Z(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function Xe(e,t){const i=t?ye(F({},t),{source:e}):e;return d({aliasOf:i})}const u5e="randomUUID"in crypto;function bZ(){if(u5e)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const h5e={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},d5e={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},p5e=e=>F(F({},d5e),e),f5e=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},m5e=(e,t)=>e.find(t),Ate=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{const o=(r==null?void 0:r.children)?m5e(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==t.length-1||(r=o)}),r},g5e=e=>{let t;const i=F(F({},h5e),e),r=p5e(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(f,m,y)=>{var b;let v;r.eventHandlerInterceptor=(S,T,E,C)=>function(A){let I;s("domEvent",A);const D=f5e(A.currentTarget,v.domNode),L=D.some(B=>{var V;return customElements.get((V=B==null?void 0:B.tagName)==null?void 0:V.toLowerCase())});if(A.eventPhase===Event.CAPTURING_PHASE||!L)D.reverse(),I=Ate(v.getLastRender(),D);else{const B=A.composedPath(),V=B.slice(B.indexOf(A.currentTarget),B.indexOf(v.domNode)).filter(Q=>Q.getRootNode()===Q.ownerDocument).reverse();I=Ate(v.getLastRender(),V,!0)}let z;return I&&(z=i.handleInterceptedEvent(t,I,this,A)),s("domEventProcessed",A),z},(b=i.postProcessProjectionOptions)==null||b.call(i,r);const w=y();v=f(m,w,r),l.push(v),c.push(y),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(v,w)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();s("rendered",void 0),l[f].update(m),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(f,m)=>{h(Sv.append,f,m)},insertBefore:(f,m)=>{h(Sv.insertBefore,f,m)},merge:(f,m)=>{h(Sv.merge,f,m)},replace:(f,m)=>{h(Sv.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},Oi={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let IT,kye,wk,Uye=!1,FF=!1,wZ=!1,lu=!1,Rte=null,$7=!1;const YE=typeof window!="undefined"?window:{};Oi.cssVarShim&&YE.CSS;const gp=YE.document||{head:{}},WSt=YE.HTMLElement||class{},da={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},kF=Oi.shadowDomShim&&Oi.shadowDom?(()=>(gp.head.attachShadow+"").indexOf("[native")>-1)():!0,y5e=(()=>{let e=!1;try{gp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),v5e=e=>Promise.resolve(e),_5e=Oi.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,zye=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=w5e(e,s),l=b5e(t,o),c=x5e(s);da.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>da.rel(a,n,l,c))})},b5e=(e,t)=>i=>{try{Oi.lazyLoad||e.$hostElement$[t](i)}catch(r){F3(r)}},w5e=(e,t)=>t&4?gp:t&8?YE:t&16?gp.body:e,x5e=e=>y5e?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Mte="http://www.w3.org/1999/xlink",Sw=(e,t="")=>()=>{},Ote=new WeakMap,T5e=(e,t,i)=>{let r=VF.get(e);_5e&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,VF.set(e,r)},S5e=(e,t,i,r)=>{let s=Vye(t,i),n=VF.get(s);if(e=e.nodeType===11?e:gp,n)if(typeof n=="string"){e=e.head||e;let o=Ote.get(e),a;o||Ote.set(e,o=new Set),o.has(s)||(a=gp.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},E5e=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=Sw("attachStyles",t.$tagName$),n=S5e(kF&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},Vye=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),C5e=e=>ike.map(t=>t(e)).find(t=>!!t),Pte={},A5e="http://www.w3.org/2000/svg",R5e="http://www.w3.org/1999/xhtml",M5e=e=>e!=null,xZ=e=>(e=typeof e,e==="object"||e==="function"),Bye=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!xZ(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?UF(null,r):r),a=o)};if(c(i),t&&(Oi.isDev&&e==="input"&&$5e(t),Oi.vdomKey&&t.key&&(s=t.key),Oi.slotRelocation&&t.name&&(n=t.name),Oi.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(Oi.isDev&&l.some(Gye)&&tke(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Oi.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,P5e);const h=UF(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Oi.vdomKey&&(h.$key$=s),Oi.slotRelocation&&(h.$name$=n),h},UF=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Oi.vdomAttribute&&(i.$attrs$=null),Oi.vdomKey&&(i.$key$=null),Oi.slotRelocation&&(i.$name$=null),i},O5e={},Gye=e=>e&&e.$tag$===O5e,P5e={forEach:(e,t)=>e.map(Ite).forEach(t),map:(e,t)=>e.map(Ite).map(t).map(I5e)},Ite=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),I5e=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),Bye(e.vtag,i,...e.vchildren||[])}const t=UF(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},$5e=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&Kye('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},$te=(e,t,i,r,s,n)=>{if(i!==r){let o=Fte(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Lte(i),h=Lte(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Fte(YE,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&da.rel(e,t,i,!1),r&&da.ael(e,t,r,!1);else{const l=xZ(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(Mte,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(Mte,t,r):e.setAttribute(t,r))}}},L5e=/\s/,Lte=e=>e?e.split(L5e):[],jye=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||Pte,o=t.$attrs$||Pte;for(r in n)r in o||$te(s,r,n[r],void 0,i,t.$flags$);for(r in o)$te(s,r,n[r],o[r],i,t.$flags$)},zF=(e,t,i,r)=>{let s=t.$children$[i],n=0,o,a,l;if(Uye||(wZ=!0,s.$tag$==="slot"&&(IT&&r.classList.add(IT+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=gp.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=gp.createTextNode("");else{if(lu||(lu=s.$tag$==="svg"),o=s.$elm$=gp.createElementNS(lu?A5e:R5e,s.$flags$&2?"slot-fb":s.$tag$),lu&&s.$tag$==="foreignObject"&&(lu=!1),jye(null,s,lu),M5e(IT)&&o["s-si"]!==IT&&o.classList.add(o["s-si"]=IT),s.$children$)for(n=0;n<s.$children$.length;++n)a=zF(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?lu=!1:o.tagName==="foreignObject"&&(lu=!0)}return o["s-hn"]=wk,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=kye,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&hO(e.$elm$,!1)),o},hO=(e,t)=>{da.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==wk&&s["s-ol"]&&(Wye(s).insertBefore(s,TZ(s)),s["s-ol"].remove(),s["s-ol"]=void 0,wZ=!0),t&&hO(s,t)}da.$flags$&=-2},Hye=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===wk&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=zF(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,TZ(t))))},qye=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,Yye(r),FF=!0,s["s-ol"]?s["s-ol"].remove():hO(s,!0),s.remove())},D5e=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],y,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(vI(c,f))$T(c,f),c=t[++s],f=r[++n];else if(vI(h,m))$T(h,m),h=t[--l],m=r[--p];else if(vI(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&hO(c.$elm$.parentNode,!1),$T(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(vI(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&hO(h.$elm$.parentNode,!1),$T(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?y=zF(t&&t[n],i,o,e):($T(v,f),t[o]=void 0,y=v.$elm$),f=r[++n]):(y=zF(t&&t[n],i,n,e),f=r[++n]),y&&Wye(c.$elm$).insertBefore(y,TZ(c.$elm$))}s>l?Hye(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&qye(t,s,l)},vI=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,TZ=e=>e&&e["s-ol"]||e,Wye=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,$T=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(lu=n==="svg"?!0:n==="foreignObject"?!1:lu,n==="slot"||jye(e,t,lu),r!==null&&s!==null?D5e(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),Hye(i,null,t,s,0,s.length-1)):r!==null&&qye(r,0,r.length-1),lu&&n==="svg"&&(lu=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},Xye=e=>{let t=e.childNodes,i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}Xye(i)}},Zd=[],Zye=e=>{let t,i,r,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(Dte(i,s)?(n=Zd.find(h=>h.$nodeToRelocate$===i),FF=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:Zd.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&Zd.map(h=>{Dte(h.$nodeToRelocate$,i["s-sn"])&&(n=Zd.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Zd.some(h=>h.$nodeToRelocate$===i)||Zd.push({$nodeToRelocate$:i}));t.nodeType===1&&Zye(t)}},Dte=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",Yye=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(Yye)},N5e=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||UF(null,null),n=Gye(t)?t:Bye(null,null,t);wk=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,IT=i["s-sc"],kye=i["s-cr"],Uye=kF&&(r.$flags$&1)!==0,FF=!1,$T(s,n);{if(da.$flags$|=1,wZ){Zye(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Zd.length;f++)o=Zd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=gp.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Zd.length;f++)if(o=Zd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}FF&&Xye(n.$elm$),da.$flags$&=-2,Zd.length=0}},F5e=e=>Oi.lazyLoad?QE(e).$hostElement$:e,XSt=(e,t,i)=>{const r=F5e(e);return{emit:s=>(Oi.isDev&&!r.isConnected&&Kye(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),k5e(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},k5e=(e,t,i)=>{const r=da.ce(t,i);return e.dispatchEvent(r),r},U5e=(e,t)=>{},SZ=(e,t)=>(e.$flags$|=16,U5e(e,e.$ancestorComponent$),nke(()=>z5e(e,t))),z5e=(e,t)=>{const i=e.$hostElement$,r=Sw("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=n2(s,"componentWillLoad"):n=n2(s,"componentWillUpdate"),n=Nte(n,()=>n2(s,"componentWillRender")),r(),Nte(n,()=>V5e(e,s,t))},V5e=async(e,t,i)=>{const r=e.$hostElement$,s=Sw("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&E5e(e);const n=Sw("render",e.$cmpMeta$.$tagName$);B5e(e,t,r),n(),s(),G5e(e)},B5e=(e,t,i)=>{try{Rte=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Oi.hasRenderFn||Oi.reflect)&&(Oi.vdomRender||Oi.reflect)&&(Oi.hydrateServerSide||N5e(e,t))}catch(a){F3(a,e.$hostElement$)}return Rte=null,null},G5e=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=Sw("postUpdate",t),s=i;e.$ancestorComponent$,n2(s,"componentDidRender"),e.$flags$&64?(n2(s,"componentDidUpdate"),r()):(e.$flags$|=64,n2(s,"componentDidLoad"),r())},ZSt=e=>{if(Oi.updatable){const t=QE(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&SZ(t,!1),i}return!1},n2=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){F3(r)}},Nte=(e,t)=>e&&e.then?e.then(t):t(),j5e=(e,t)=>e!=null&&!xZ(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,H5e=(e,t)=>QE(e).$instanceValues$.get(t),q5e=(e,t,i,r)=>{const s=QE(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=j5e(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(m){F3(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;SZ(s,!1)}}}},W5e=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return H5e(this,n)},set(a){q5e(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){da.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},X5e=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=C5e(e)]);const a=Vye(i,t.$modeName$);if(!VF.has(a)){const l=Sw("registerStyles",i.$tagName$);T5e(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>SZ(t,!0))()},Z5e=e=>{},Y5e=e=>{if((da.$flags$&1)===0){const t=QE(e),i=t.$cmpMeta$,r=Sw("connectedCallback",i.$tagName$);t.$flags$&1?(zye(e,t,i.$listeners$),Z5e(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&Q5e(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),X5e(e,t,i)),r()}},Q5e=e=>{const t=e["s-cr"]=gp.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},J5e=e=>{if((da.$flags$&1)===0){const t=QE(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},YSt=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};Oi.member&&(i.$members$=t[2]),Oi.hostListener&&(i.$listeners$=t[3]),Oi.watchCallback&&(i.$watchers$=e.$watchers$),Oi.reflect&&(i.$attrsToReflect$=[]),Oi.shadowDom&&!kF&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){eke(this,i)},connectedCallback(){Y5e(this),Oi.connectedCallback&&r&&r.call(this)},disconnectedCallback(){J5e(this),Oi.disconnectedCallback&&s&&s.call(this)},__attachShadow(){kF?Oi.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,W5e(e,i)},QSt=e=>{const t=new URL(e,da.$resourcesUrl$);return t.origin!==YE.location.origin?t.href:t.pathname},K5e=e=>da.$resourcesUrl$=e,Qye=new WeakMap,QE=e=>Qye.get(e),eke=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Oi.isDev&&(i.$renderCount$=0),Oi.method&&Oi.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),Oi.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),zye(e,i,t.$listeners$),Qye.set(e,i)},Fte=(e,t)=>t in e,F3=(e,t)=>(0,console.error)(e,t),Jye=Oi.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],tke=(...e)=>console.error(...Jye,...e),Kye=(...e)=>console.warn(...Jye,...e),VF=new Map,ike=[],kte=[],e0e=[],rke=(e,t)=>i=>{e.push(i),$7||($7=!0,t&&da.$flags$&4?ske(L7):da.raf(L7))},Ute=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){F3(i)}e.length=0},L7=()=>{Ute(kte),Ute(e0e),($7=kte.length>0)&&da.raf(L7)},ske=e=>v5e().then(e),nke=rke(e0e,!0),JSt={isDev:!!Oi.isDev,isBrowser:!0,isServer:!1,isTesting:!!Oi.isTesting};let t0e;function oke(){K5e(zh(xi(t0e)))}t0e="components/assets";const i0e=Symbol("widget"),ake=[],lke={},BF=new WeakMap;function r0e(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=r0e(e,i[s]);else i=ake;const r=t.vnodeSelector;if(EZ(r)){const s=t.properties||lke,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:cke,afterUpdate:uke,afterRemoved:s0e,parentWidget:e,widgetConstructor:r,widgetProperties:ye(F({},s),{key:n,children:i})},children:void 0,text:void 0,domNode:null}}return t}function cke(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,BF.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),r._internalHandles.add(qh(()=>s0e(e)))}function uke(e,t,i,{widgetProperties:r}){var n;const s=BF.get(e);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,e))}function s0e(e){const t=BF.get(e);t&&(t.destroy(),BF.delete(e))}function EZ(e){return typeof e=="function"&&e[i0e]}const zte=new Set;function hke(e){zte.add(e),e.finally(()=>zte.delete(e))}const n0e="esri.widgets.Widget",dke=fe.getLogger(n0e);let pke=0;const fke={widgetIcon:"esri-icon-checkbox-unchecked"};function o0e(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?o0e(e[i],t[i]):e[i]=t[i]);return e}const mke=g5e({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,o)=>{const a=t(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=m=>a.call(n,m);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),p()}}return a}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(Mye(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let S6=!1,Mn=class extends X5(as.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Nt,this._projector=mke,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=fke.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=$5(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await gs(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await Nme(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=o0e(re(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&dke.error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),oke();const i="esri-widget-uid-"+bZ(),r=this.render.bind(this);this._trackingTarget=new L5(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const n=r();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=i),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(EZ(p.vnodeSelector))return;let{properties:f}=p;f||(p.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),r0e(this,n)};this.render=()=>{if(S6)return s();let n=G4e(this);if(n)return n;this._trackingTarget.clear(),S6=!0;try{n=Zg(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{S6=!1}return j4e(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),hke(this._resourcesFetch)}normalizeCtorArgs(e,t){const i=F({},e);return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(n9)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(lt(this._trackingTarget),lt(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,x6(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return sk(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+pke++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(x6(this),this._projector.scheduleRender())}classes(...e){return AS.apply(this,e)}renderNow(){x6(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),((t=this._delegatedEventNames)==null?void 0:t.length)&&this._internalHandles.add(ie(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&P5(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>C3(i,s,n=>{this.emit(s,n)})),"delegated-events")},Rt)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(n9),this.scheduleRender()};this._internalHandles.add([_fe(e),ie(()=>this.uiStrings,e),jo(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};Mn[i0e]=!0,u([d()],Mn.prototype,"_readyForTrueRender",void 0),u([d({value:null})],Mn.prototype,"container",null),u([qt("container")],Mn.prototype,"castContainer",null),u([d({aliasOf:"container"})],Mn.prototype,"domNode",void 0),u([d()],Mn.prototype,"iconClass",void 0),u([d()],Mn.prototype,"id",null),u([d()],Mn.prototype,"label",void 0),u([d()],Mn.prototype,"renderable",null),u([d()],Mn.prototype,"uiStrings",void 0),u([d()],Mn.prototype,"viewModel",void 0),u([d()],Mn.prototype,"visible",void 0),u([d()],Mn.prototype,"key",void 0),u([d()],Mn.prototype,"children",void 0),u([d()],Mn.prototype,"afterCreate",void 0),u([d()],Mn.prototype,"afterUpdate",void 0),u([d()],Mn.prototype,"afterRemoved",void 0),Mn=u([P(n0e)],Mn);const Wn=Mn;function gke(e,t,i){return e.units[t][i]}function xk(e,t,i,r=2,s="abbr"){return`${Wh(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${gke(e,i,s)}`}function KSt(e,t,i,r=2,s="abbr"){const n=lLe(t,i);return xk(e,tn(t,i,n),n,r,s)}function e2t(e,t,i,r=2,s="abbr"){const n=cLe(t,i);return xk(e,tn(t,i,n),n,r,s)}function t2t(e,t,i,r=2,s="abbr"){const n=uLe(t,i);return xk(e,tn(t,i,n),n,r,s)}function i2t(e,t,i,r=2,s="abbr"){const n=hLe(t,i);return xk(e,tn(t,i,n),n,r,s)}const Vte=["B","kB","MB","GB","TB"];function yke(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(Y2.KILOBYTES));i=De(i,0,Vte.length-1);const r=Wh(t/Y2.KILOBYTES**i,{maximumFractionDigits:2});return qf(e.units.bytes[Vte[i]],{fileSize:r})}function vke(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?_ke({tagName:r,tags:s.tags}):null}function _ke(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var D7;const bke={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let Zl=D7=class extends ve{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=vke({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return bke[t]||null}clone(){return new D7({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([d({type:String})],Zl.prototype,"contentType",void 0),u([d()],Zl.prototype,"exifInfo",void 0),u([d({readOnly:!0})],Zl.prototype,"orientationInfo",null),u([d({type:Br})],Zl.prototype,"id",void 0),u([d({type:String})],Zl.prototype,"globalId",void 0),u([d({type:String})],Zl.prototype,"keywords",void 0),u([d({type:String})],Zl.prototype,"name",void 0),u([d({json:{read:!1}})],Zl.prototype,"parentGlobalId",void 0),u([d({json:{read:!1}})],Zl.prototype,"parentObjectId",void 0),u([d({type:Br})],Zl.prototype,"size",void 0),u([d({json:{read:!1}})],Zl.prototype,"url",void 0),Zl=D7=u([P("esri.layers.support.AttachmentInfo")],Zl);const wke=Zl;var N7;let Ro=N7=class extends ve{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new N7(re({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([d({type:[String],json:{write:!0}})],Ro.prototype,"attachmentTypes",void 0),u([d({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ro.prototype,"attachmentsWhere",void 0),u([d({type:Boolean,json:{write:!0}})],Ro.prototype,"cacheHint",void 0),u([d({type:[String],json:{write:!0}})],Ro.prototype,"keywords",void 0),u([d({type:[Number],json:{write:!0}})],Ro.prototype,"globalIds",void 0),u([d({json:{write:!0}})],Ro.prototype,"name",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Ro.prototype,"num",void 0),u([d({type:[Number],json:{write:!0}})],Ro.prototype,"objectIds",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Ro.prototype,"returnMetadata",void 0),u([d({type:[Number],json:{write:!0}})],Ro.prototype,"size",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Ro.prototype,"start",void 0),u([qe("start"),qe("num")],Ro.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ro.prototype,"where",void 0),Ro=N7=u([P("esri.rest.support.AttachmentQuery")],Ro),Ro.from=Bs(Ro);const F7=Ro,xke="esri.widgets.Feature.support.featureUtils",Bte=fe.getLogger(xke),Tke=/href=(""|'')/gi,Ske=/(\{([^\{\r\n]+)\})/g,Eke=/\'/g,a0e=/^\s*expression\//i,Cke=/(\n)/gi,Ake=/[\u00A0-\u9999<>\&]/gim,Rke=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,Mke=/^(?:mailto:|tel:)/,l0e="relationships/",k7=K5("short-date-short-time");function c0e(e){if(!R(e))return e.get("sourceLayer")||e.get("layer")}async function GF(e,t){return typeof e=="function"?e.call(null,t):e}function u0e(e=""){if(e)return!Mke.test(e.trim().toLowerCase())}function h0e(e){return!!e&&a0e.test(e)}function Oke(e,t){if(!h0e(t)||!e)return null;const i=t.replace(a0e,"").toLowerCase();let r;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function d0e(e,t){const i=Oke(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function Pke(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function Ike(e){return e.replace(Tke,"")}function jF(e,t){const i=CZ(t,e);return i?i.name:e}function $ke(e,t){return e&&e.map(i=>jF(i,t))}function CZ(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function p0e(e){return`${e}`.trim()}function $b({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?U7({formattedAttributes:t,template:Fke(r,F(F(F({},t),s),e),i),fieldInfoMap:n}):""}function U7({formattedAttributes:e,template:t,fieldInfoMap:i}){return p0e(Ike(qf(qf(t,r=>Pke(r,i)),e)))}function Lke(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(Eke,s);t[e]=n}}function Dke(e,t=!1){const i=F({},e);return Object.keys(i).forEach(r=>Lke(r,i,t)),i}function Nke(e,t,i){const r=(t=p0e(t))&&t[0]!=="{";return qf(e,Dke(i,r))}function z7(e,t){return e.replace(Ske,(i,r,s)=>{const n=CZ(t,s);return n?`{${n.name}}`:r})}function Fke(e,t,i){const r=z7(e,i);return r&&r.replace(Rke,(s,n,o)=>Nke(s,n||o,t))}function kke(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function Uke(e){return(e==null?void 0:e.type)==="feature"}function Gte(e){return!!(e==null?void 0:e.layer)}function zke(e){return(e==null?void 0:e.type)==="map-image"}function Vke(e,t){var c;const i=t.fieldInfos,r=t.fieldName,s=(c=f0e(i,r))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=CZ(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new CS;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!Gte(o)&&Uke(o)&&o.datesInUnknownTimezone||Gte(o)&&zke(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&ope(r)&&l?l.formatRasterPixelValue(e):typeof(e=kke(e,l))=="string"||e==null||l==null?k3(e):n?Wh(e,ye(F({},Qfe(l)),{minimumFractionDigits:0,maximumFractionDigits:20})):l.format(e)}function f0e(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function Bke({fieldName:e,graphic:t,layer:i}){if(Rg(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function Gke({fieldName:e,value:t,graphic:i,layer:r}){if(Rg(e)||!r||typeof r.getFieldDomain!="function")return null;const s=r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function jke(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:Kf(o,k7),user:l}}const a=t[r];if(typeof a=="number"){const l=t[i];return{type:"create",date:Kf(a,k7),user:l}}return null}function Hke(e,t){const i=new Map;return e&&e.forEach(r=>{const s=jF(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function jte(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function AZ(e){return e.replace(Ake,t=>`&#${t.charCodeAt(0)};`)}function k3(e){return typeof e=="string"?e.replace(Cke,'<br class="esri-text-new-line" />'):e}function m0e(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=Gke({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=Bke({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return Vke(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Kf(t,k7):k3(t)}function E6({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>Yke({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:i})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=m0e({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function qke(e,t){var h,p;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const f="Could not query required fields for the specified feature. The feature's ID is invalid.",m={layer:i,graphic:r,objectId:l,requiredFields:s};return Bte.warn(f,m),null}if(!((p=(h=i.capabilities)==null?void 0:h.operations)==null?void 0:p.supportsQuery)){const f="The specified layer cannot be queried. The following fields will not be available.",m={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return Bte.warn(f,m),null}const c=i.createQuery();return c.objectIds=n,c.outFields=(s==null?void 0:s.length)?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}async function Wke(e){var r;if(!((r=e.expressionInfos)==null?void 0:r.length))return!1;const t=await Wf(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}async function Xke({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=b3e(a,e),c=l?[]:a,h=t.returnGeometry||await Wke(t);if(l&&!h)return;const p=await qke({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes=F(F({},e.attributes),p.attributes)))}function Rg(e=""){return!!e&&e.includes(l0e)}function Zke(e){return e?`${l0e}${e.layerId}/${e.fieldName}`:""}function Hte({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach(o=>{const a=Zke({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=m0e({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function Yke({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>Hte({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>Hte({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})))}const qte=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},g0e=({layer:e,method:t,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)==null?void 0:a.supportsCacheHint)||t==="attachments")return;const s=_(i.where)&&i.where,n=_(i.geometry)&&i.geometry;qte(r)||qte(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},Qke=({query:e,layer:t,method:i})=>{g0e({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},Jke=({queryPayload:e,layer:t,method:i})=>{g0e({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},Wte={editing:!1,operations:{add:!0,update:!0,delete:!0}},y0e=ut.ofType(wke),Kke="graphic.layer.capabilities.operations.supportsResizeAttachments";let Ad=class extends Se{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=F({},Wte),this.activeAttachmentInfo=null,this.attachmentInfos=new y0e,this.graphic=null,this.mode="view",this.own(ie(()=>this.graphic,()=>this._graphicChanged(),Rt))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return F(F({},Wte),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(Kke)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new j("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new F7({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(a=>a[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new j("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new j("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new j("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then(a=>this._queryAttachment(a.objectId)),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new j("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new j("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new j("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new j("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new j("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new j("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex(c=>c===t);if(!i||typeof i.updateAttachment!="function")throw new j("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new j("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new F7({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then(s=>s[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=c0e(e);this._attachmentLayer=t?t.type==="scene"&&_(t.associatedLayer)?t.associatedLayer:t:null}};u([d()],Ad.prototype,"abilities",void 0),u([qt("abilities")],Ad.prototype,"castAbilities",null),u([d()],Ad.prototype,"activeAttachmentInfo",void 0),u([d({readOnly:!0,type:y0e})],Ad.prototype,"attachmentInfos",void 0),u([d({type:Ha})],Ad.prototype,"graphic",void 0),u([d()],Ad.prototype,"mode",void 0),u([d({readOnly:!0})],Ad.prototype,"state",null),u([d({readOnly:!0})],Ad.prototype,"supportsResizeAttachments",null),Ad=u([P("esri.widgets.Attachments.AttachmentsViewModel")],Ad);const RZ=Ad;function eUe(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function tUe(e){const t=xi("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function dn(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var iUe=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},v0e=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?v0e(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=iUe(s)),t.push(s))}},rUe=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return v0e(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function k(e,t,...i){return typeof e!="function"||EZ(e)?rUe(e,t,...i):e(t,...i)}const Xte={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},tt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},C6=window.CSS;let xa=class extends Wn{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new RZ,this.visibleElements=F({},Xte),this._supportsImageOrientation=C6&&C6.supports&&C6.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([ns(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),Rt)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return F(F({},Xte),e)}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new j("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new j("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new j("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return k("div",{class:this.classes(tt.base,tt.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?k("div",{key:"error-message",class:tt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return k("div",{class:tt.loaderContainer,key:"loader"},k("div",{class:tt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?k("div",{class:tt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?k("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(tt.esriButton,tt.esriButtonTertiary,tt.esriButtonSmall,tt.esriButtonHalf,e&&tt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?k("button",{type:"submit",disabled:i,class:this.classes(tt.esriButton,tt.esriButtonSecondary,tt.esriButtonSmall,tt.esriButtonHalf,{[tt.buttonDisabled]:i})},this.messages.add):null,n=t?k("span",{key:"file-name",class:tt.fileName},t.name):null,o=k("form",{bind:this,afterCreate:M7,afterRemoved:wte,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},k("fieldset",{class:tt.fileFieldset},n,k("label",{class:this.classes(tt.fileLabel,tt.esriButton,tt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,k("input",{class:tt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return k("div",{key:"add-form-container",class:tt.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,c=s||!r,h=l.editing&&l.operations.delete&&t.deleteButton?k("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:S=>this._submitDeleteAttachment(S,e),class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonTertiary,tt.deleteButton,{[tt.buttonDisabled]:s})},this.messages.delete):null,p=l.editing&&l.operations.update&&t.updateButton?k("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonThird,{[tt.buttonDisabled]:c})},this.messages.update):null,f=this.visibleElements.cancelUpdateButton?k("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(tt.esriButton,tt.esriButtonSmall,tt.esriButtonTertiary,tt.esriButtonThird,{[tt.buttonDisabled]:s})},this.messages.cancel):null,m=r?k("span",{key:"file-name",class:tt.fileName},r.name):null,y=l.editing&&l.operations.update?k("fieldset",{key:"file",class:tt.fileFieldset},m,k("label",{class:this.classes(tt.fileLabel,tt.esriButton,tt.esriButtonSecondary)},this.messages.changeFile,k("input",{class:tt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,v=k("fieldset",{key:"size",class:tt.metadataFieldset},k("label",null,yke(this.messagesUnits,o))),w=k("fieldset",{key:"content-type",class:tt.metadataFieldset},k("label",null,n)),b=k("form",{bind:this,afterCreate:M7,afterRemoved:wte,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},k("div",{class:tt.metadata},v,w),y,k("div",{class:tt.actions},h,f,p));return k("div",{key:"edit-form-container",class:tt.formNode},k("a",{class:tt.itemLink,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),k("div",{class:tt.itemLinkOverlay},k("span",{class:tt.itemLinkOverlayIcon},k("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},k("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),k("path",{fill:"none",d:"M0 0h32v32H0z"}))))),b)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&eUe(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",h=o?`${n}${c}w=${t}`:tUe(r),p={[tt.itemMaskIcon]:!o},f={[tt.itemImageResizable]:i};return k("div",{class:this.classes(p,tt.itemMask)},k("img",{styles:l,alt:s,src:h,class:this.classes(f,tt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),a=r.editing?k("span",{"aria-hidden":"true",class:this.classes(tt.itemChevronIcon,cp(this.container)?tt.iconLeft:tt.iconRight)}):null,l=[o,k("label",{class:tt.itemLabel},k("span",{class:tt.itemFilename},s||this.messages.noTitle),a)],c=r.editing?k("button",{key:"details-button",bind:this,class:tt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):k("a",{key:"details-link",class:tt.itemButton,href:n,target:"_blank"},l);return k("li",{class:tt.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={[tt.containerList]:e!=="preview",[tt.containerPreview]:e==="preview"},a=s.editing&&s.operations.add&&i.addButton?k("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(tt.esriButton,tt.esriButtonTertiary,tt.addAttachmentButton),type:"button"},k("span",{"aria-hidden":"true",class:this.classes(tt.itemAddIcon,tt.iconPlus)}),this.messages.add):null,l=n?k("ul",{class:tt.items},r.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):k("div",{class:tt.empty},this.messages.noAttachments);return k("div",{key:"attachments-container",class:this.classes(tt.container,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([Xe("viewModel.abilities")],xa.prototype,"abilities",void 0),u([d()],xa.prototype,"displayType",void 0),u([d({readOnly:!0})],xa.prototype,"effectiveDisplayType",null),u([Xe("viewModel.graphic")],xa.prototype,"graphic",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],xa.prototype,"label",void 0),u([d(),dn("esri/widgets/Attachments/t9n/Attachments")],xa.prototype,"messages",void 0),u([d(),dn("esri/core/t9n/Units")],xa.prototype,"messagesUnits",void 0),u([d({readOnly:!0})],xa.prototype,"selectedFile",void 0),u([d({readOnly:!0})],xa.prototype,"submitting",void 0),u([d({readOnly:!0})],xa.prototype,"error",void 0),u([d({type:RZ})],xa.prototype,"viewModel",void 0),u([d()],xa.prototype,"visibleElements",void 0),u([qt("visibleElements")],xa.prototype,"castVisibleElements",null),xa=u([P("esri.widgets.Attachments")],xa);const sUe=xa;let uR=class extends RZ{constructor(e){super(e),this.description=null,this.title=null}};u([d()],uR.prototype,"description",void 0),u([d()],uR.prototype,"title",void 0),uR=u([P("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],uR);const MZ=uR,nUe={heading:"esri-widget__heading"};function tw(e,t){const i=_0e(e.level),r=`h${i}`;return delete e.level,k(r,ye(F({},e),{class:AS(nUe.heading,e.class),role:"heading","aria-level":String(i)}),t)}function _0e(e){return De(Math.ceil(e),1,6)}function oUe(e,t=1){return _0e(e+t)}const A6={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let LT=class extends Wn{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return k("div",{class:A6.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?k(tw,{level:this.headingLevel,class:A6.title},e):null}renderDescription(){const{description:e}=this;return e?k("div",{key:"description",class:A6.description},e):null}};u([d()],LT.prototype,"description",void 0),u([d()],LT.prototype,"headingLevel",void 0),u([d()],LT.prototype,"title",void 0),LT=u([P("esri.widgets.Feature.support.FeatureElementInfo")],LT);const OZ=LT,aUe={base:"esri-feature-attachments"};let of=class extends Wn{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new sUe,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new MZ}initialize(){this._featureElementInfo=new OZ,this.own([ie(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),Rt),ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,Rt)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return k("div",{class:aUe.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};u([d({readOnly:!0})],of.prototype,"attachmentsWidget",void 0),u([Xe("viewModel.description")],of.prototype,"description",void 0),u([Xe("attachmentsWidget.displayType")],of.prototype,"displayType",void 0),u([Xe("viewModel.graphic")],of.prototype,"graphic",void 0),u([d()],of.prototype,"headingLevel",void 0),u([Xe("viewModel.title")],of.prototype,"title",void 0),u([d({type:MZ})],of.prototype,"viewModel",void 0),of=u([P("esri.widgets.Feature.FeatureAttachments")],of);const lUe=of;let S0=class extends g_(Se){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(ie(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},Rt))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(GF(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=GF(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};u([d({readOnly:!0})],S0.prototype,"created",void 0),u([d()],S0.prototype,"creator",void 0),u([d()],S0.prototype,"destroyer",void 0),u([d({type:Ha})],S0.prototype,"graphic",void 0),u([d({readOnly:!0})],S0.prototype,"state",null),S0=u([P("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],S0);const HF=S0;function gl(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:uUe(e[t])}}}function cUe(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function uUe(e){return function(t,...i){cUe(t)?K4e(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function hUe(e){return e.split(",").map(t=>t.trim())}function b0e(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:hUe(e);i.push(...r)}}const w0e="calcite-theme-";function dUe(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function PZ(){return dUe().startsWith("dark")}function pUe(){return`${w0e}${PZ()?"dark":"light"}`}function fUe(e){mUe(e),e.classList.add(pUe())}function mUe(e){Array.from(e.classList).forEach(t=>{t.startsWith(w0e)&&e.classList.remove(t)})}function qF(e){return e&&typeof e.render=="function"}function x0e(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const R6={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let DT=class extends Wn{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{u0e(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}renderLoading(){return k("div",{class:R6.loaderContainer,key:"loader"},k("div",{class:R6.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?k("div",{key:e,bind:e,afterCreate:this._attachToNode}):qF(e)?k("div",{key:e},!e.destroyed&&e.render()):k("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return k("div",{class:R6.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([Xe("viewModel.creator")],DT.prototype,"creator",void 0),u([Xe("viewModel.graphic")],DT.prototype,"graphic",void 0),u([d({type:HF})],DT.prototype,"viewModel",void 0),DT=u([P("esri.widgets.Feature.FeatureContent")],DT);const ED=DT;let Wm=class extends Se{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=d0e(s,e),i.push(s)}),i}};u([d()],Wm.prototype,"attributes",void 0),u([d({type:[nme]})],Wm.prototype,"expressionInfos",void 0),u([d()],Wm.prototype,"description",void 0),u([d({type:[L3]})],Wm.prototype,"fieldInfos",void 0),u([d({readOnly:!0})],Wm.prototype,"formattedFieldInfos",null),u([d()],Wm.prototype,"title",void 0),Wm=u([P("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Wm);const Tk=Wm,gUe=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function yUe(e){let t=null;return gUe.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function vUe(e,t){if(typeof t!="string"||!t)return t;const i=yUe(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=qf(qf(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const OC={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let Rd=class extends Wn{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new Tk,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new OZ,this.own(ie(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Rt))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):vUe(this.messagesURIUtils,n),l={[OC.fieldDataDate]:o};return k("tr",{key:`fields-element-info-row-${r}-${t}`},k("th",{key:`fields-element-info-row-header-${r}-${t}`,class:OC.fieldHeader,innerHTML:s}),k("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(OC.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return(e==null?void 0:e.length)?k("table",{class:OC.esriTable,summary:this.messages.fieldsSummary},k("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return k("div",{class:OC.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([Xe("viewModel.attributes")],Rd.prototype,"attributes",void 0),u([Xe("viewModel.description")],Rd.prototype,"description",void 0),u([Xe("viewModel.expressionInfos")],Rd.prototype,"expressionInfos",void 0),u([Xe("viewModel.fieldInfos")],Rd.prototype,"fieldInfos",void 0),u([Xe("viewModel.title")],Rd.prototype,"title",void 0),u([d({type:Tk})],Rd.prototype,"viewModel",void 0),u([d(),dn("esri/widgets/Feature/t9n/Feature")],Rd.prototype,"messages",void 0),u([d(),dn("esri/widgets/support/t9n/uriUtils")],Rd.prototype,"messagesURIUtils",void 0),Rd=u([P("esri.widgets.Feature.FeatureFields")],Rd);const T0e=Rd,_Ue=/^-?(\d+)(\.(\d+))?$/i;function bUe(e,t){return e-t}function wUe(e,t){let i,r;return i=Number(e.toFixed(t)),i<e?r=i+1/10**t:(r=i,i-=1/10**t),i=Number(i.toFixed(t)),r=Number(r.toFixed(t)),[i,r]}function xUe(e,t,i,r,s){const n=CD(e,t,i,r),o=n.previous==null||n.previous<=s,a=n.next==null||n.next<=s;return o&&a||n.previous+n.next<=2*s}function WF(e){const t=String(e),i=t.match(_Ue);if(i&&i[1])return{integer:i[1].split("").length,fractional:i[3]?i[3].split("").length:0};if(t.toLowerCase().includes("e")){const r=t.split("e"),s=r[0],n=r[1];if(s&&n){const o=Number(s);let a=Number(n);const l=a>0;l||(a=Math.abs(a));const c=WF(o);return l?(c.integer+=a,a>c.fractional?c.fractional=0:c.fractional-=a):(c.fractional+=a,a>c.integer?c.integer=1:c.integer-=a),c}}return{integer:0,fractional:0}}function CD(e,t,i,r){const s={previous:null,next:null};if(i!=null){const n=e-i,o=t-i-n;s.previous=Math.floor(Math.abs(100*o/n))}if(r!=null){const n=r-e,o=r-t-n;s.next=Math.floor(Math.abs(100*o/n))}return s}function XF(e,t={}){const i=e.slice(0),{tolerance:r=2,strictBounds:s=!1,indexes:n=i.map((o,a)=>a)}=t;n.sort(bUe);for(let o=0;o<n.length;o++){const a=n[o],l=i[a],c=a===0?null:i[a-1],h=a===i.length-1?null:i[a+1],p=WF(l).fractional;if(p){let f,m=0,y=!1;for(;m<=p&&!y;){const v=wUe(l,m);f=s&&o===0?v[1]:v[0],y=xUe(l,f,c,h,r),m++}y&&(i[a]=f)}}return i}const TUe={maximumFractionDigits:20};function SUe(e){return Wh(e,TUe)}function Sk(e,t,i){return gs(e.map((r,s)=>t.apply(i,[r,s])))}async function EUe(e,t,i){return(await gs(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}async function ku(e){if(R(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function r2t(e){try{return{ok:!0,value:await e}}catch(t){return bc(t),{ok:!1,error:t}}}function s2t(e){if(e.ok===!0)return e.value;throw e.error}function U3(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function CUe(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function AUe(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v){const w=new Float32Array(16);return w[0]=e,w[1]=t,w[2]=i,w[3]=r,w[4]=s,w[5]=n,w[6]=o,w[7]=a,w[8]=l,w[9]=c,w[10]=h,w[11]=p,w[12]=f,w[13]=m,w[14]=y,w[15]=v,w}function RUe(e,t){return new Float32Array(e,t,16)}const MUe=U3();Object.freeze(Object.defineProperty({__proto__:null,create:U3,clone:CUe,fromValues:AUe,createView:RUe,IDENTITY:MUe},Symbol.toStringTag,{value:"Module"}));const OUe=(e,t)=>{const i=pm(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Dl(i,i)},PUe=(e,t)=>{const i=pm(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Dl(i,i)},IUe=(e,t)=>{const i=1-t,r=pm(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Dl(r,r)},$Ue=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=pm(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Dl(s,s)},LUe=(e,t)=>{const i=1-2*t,r=pm(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return Dl(r,r)},DUe=(e,t)=>{const i=pm(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Dl(i,i)},NUe=(e,t)=>{const i=1-t,r=pm(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Dl(r,r)};class Ek{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=ac(t.strength,i.strength,r),this.radius=ac(t.radius,i.radius,r),this.threshold=ac(t.threshold,i.threshold,r)}clone(){return new Ek(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:hM(this.radius),strength:this.strength,threshold:this.threshold}}}class Ck{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(ac(t.radius,i.radius,r))}clone(){return new Ck(this.radius)}toJSON(){return{type:"blur",radius:hM(this.radius)}}}class dO{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=ac(t.amount,i.amount,r),this._updateMatrix()}clone(){return new dO(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||U3();switch(this.type){case"brightness":this._colorMatrix=OUe(t,this.amount);break;case"contrast":this._colorMatrix=PUe(t,this.amount);break;case"grayscale":this._colorMatrix=IUe(t,this.amount);break;case"invert":this._colorMatrix=LUe(t,this.amount);break;case"saturate":this._colorMatrix=DUe(t,this.amount);break;case"sepia":this._colorMatrix=NUe(t,this.amount)}}}class Ak{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=ac(t.offsetX,i.offsetX,r),this.offsetY=ac(t.offsetY,i.offsetY,r),this.blurRadius=ac(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(ac(t.color[0],i.color[0],r)),this.color[1]=Math.round(ac(t.color[1],i.color[1],r)),this.color[2]=Math.round(ac(t.color[2],i.color[2],r)),this.color[3]=ac(t.color[3],i.color[3],r)}clone(){return new Ak(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:hM(this.offsetX),yoffset:hM(this.offsetY),blurRadius:hM(this.blurRadius),color:t}}}class Rk{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=ac(t.angle,i.angle,r),this._updateMatrix()}clone(){return new Rk(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||U3();this._colorMatrix=$Ue(t,this.angle)}}class Mk{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=ac(t.amount,i.amount,r)}clone(){return new Mk(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function ac(e,t,i){return e+(t-e)*i}function hM(e){return Math.round(1e3*$l(e))/1e3}function FUe(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new dO(e.type,0);case"saturate":case"brightness":case"contrast":return new dO(e.type,1);case"opacity":return new Mk(1);case"hue-rotate":return new Rk(0);case"blur":return new Ck(0);case"drop-shadow":return new Ak(0,0,0,[...jW("transparent")]);case"bloom":return new Ek(0,0,1)}}var n2t=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function o2t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a2t(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function S0e(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function E0e(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(FUe(i[s]))}function kUe(e){const t=e[0];return!!t&&"type"in t}var Zte,Yte,C0e={exports:{}};function IZ(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=Qte(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new j("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Qte(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!S0e(t[i].effects,t[i+1].effects))throw new j("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});E0e(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function Qte(e){let t;if(!e)return[];try{t=C0e.exports.parse(e)}catch(i){throw new j("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>UUe(i))}function UUe(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return zUe(e);case"opacity":return VUe(e);case"hue-rotate":return BUe(e);case"blur":return GUe(e);case"drop-shadow":return jUe(e);case"bloom":return HUe(e)}}catch(t){throw t.details.filter=e,t}throw new j("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function zUe(e){let t=1;return JE(e.parameters,1),e.parameters.length===1&&(t=Hd(e.parameters[0])),new dO(e.name,t)}function VUe(e){let t=1;return JE(e.parameters,1),e.parameters.length===1&&(t=Hd(e.parameters[0])),new Mk(t)}function BUe(e){let t=0;return JE(e.parameters,1),e.parameters.length===1&&(t=QUe(e.parameters[0])),new Rk(t)}function GUe(e){let t=0;return JE(e.parameters,1),e.parameters.length===1&&(t=DZ(e.parameters[0]),z3(t,e.parameters[0])),new Ck(t)}function jUe(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new j("effect:type-error","Accepts only one color",{});i=JUe(r)}else{const s=DZ(r);if(Object.isFrozen(t))throw new j("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&z3(s,r)}if(t.length<2||t.length>3)throw new j("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new Ak(t[0],t[1],t[2]||0,i||A0e("black"))}function HUe(e){let t=1,i=0,r=0;return JE(e.parameters,3),e.parameters[0]&&(t=Hd(e.parameters[0])),e.parameters[1]&&(i=DZ(e.parameters[1]),z3(i,e.parameters[1])),e.parameters[2]&&(r=Hd(e.parameters[2])),new Ek(t,i,r)}function JE(e,t){if(e.length>t)throw new j("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function Ok(e){if(e.type==="color")return"<color>";if(e.unit){if(LZ[e.unit])return"<length>";if($Z[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function z3(e,t){if(e<0)throw new j("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function qUe(e){if(e.type!=="quantity"||e.unit!==null)throw new j("effect:type-error",`Expected <double>, Actual: ${Ok(e)}`,{term:e})}function WUe(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new j("effect:type-error",`Expected <double> or <percentage>, Actual: ${Ok(e)}`,{term:e})}Yte=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:vK},h=vK,p="none",f=")",m=",",y="(",v="%",w="px",b="cm",S="mm",T="in",E="pt",C="pc",A="deg",I="rad",D="grad",L="turn",z="#",B=".",V="e",Q=/^[ \t\n\r]/,Z=/^[a-z\-]/,ce=/^[0-9a-fA-F]/,oe=/^[+\-]/,$=/^[0-9]/,U=ad("none"),G=Cn("none",!1),W=Cn(")",!1),X=Cn(",",!1),ee=ad("whitespace"),q=R_([" ","	",`
`,"\r"],!1,!1),te=ad("function"),ge=Cn("(",!1),Te=ad("identifier"),ke=R_([["a","z"],"-"],!1,!1),_e=ad("percentage"),me=Cn("%",!1),Ce=ad("length"),Fe=Cn("px",!1),Li=Cn("cm",!1),zi=Cn("mm",!1),li=Cn("in",!1),Vi=Cn("pt",!1),hi=Cn("pc",!1),Bi=ad("angle"),qr=Cn("deg",!1),cs=Cn("rad",!1),st=Cn("grad",!1),Pr=Cn("turn",!1),Xn=ad("number"),Za=ad("color"),ma=Cn("#",!1),nd=R_([["0","9"],["a","f"],["A","F"]],!1,!1),od=R_(["+","-"],!1,!1),ga=R_([["0","9"]],!1,!1),S_=Cn(".",!1),$z=Cn("e",!1),Lz=function(){return[]},wP=function(Y,be){return{type:"function",name:Y,parameters:be||[]}},xP=function(Y,be){return be.length>0?tRe(Y,be,3):[Y]},TP=function(Y){return{type:"quantity",value:Y.value,unit:Y.unit}},SP=function(Y){return{type:"color",colorType:Y.type,value:Y.value}},Dz=function(Y){return Y},Nz=function(){return A_()},Fz=function(Y){return{value:Y,unit:"%"}},kz=function(Y){return{value:Y,unit:"px"}},fC=function(Y){return{value:Y,unit:"cm"}},EP=function(Y){return{value:Y,unit:"mm"}},CP=function(Y){return{value:Y,unit:"in"}},AP=function(Y){return{value:Y,unit:"pt"}},Ii=function(Y){return{value:Y,unit:"pc"}},qo=function(Y){return{value:Y,unit:"deg"}},wo=function(Y){return{value:Y,unit:"rad"}},Ul=function(Y){return{value:Y,unit:"grad"}},E_=function(Y){return{value:Y,unit:"turn"}},RP=function(Y){return{value:Y,unit:null}},MP=function(){return{type:"hex",value:A_()}},OP=function(Y){return{type:"function",value:Y}},PP=function(){return{type:"named",value:A_()}},Op=function(){return parseFloat(A_())},ue=0,Ir=0,mx=[{line:1,column:1}],Gu=0,C_=[],ht=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function A_(){return s.substring(Ir,ue)}function Cn(Y,be){return{type:"literal",text:Y,ignoreCase:be}}function R_(Y,be,Oe){return{type:"class",parts:Y,inverted:be,ignoreCase:Oe}}function IP(){return{type:"end"}}function ad(Y){return{type:"other",description:Y}}function mC(Y){var be,Oe=mx[Y];if(Oe)return Oe;for(be=Y-1;!mx[be];)be--;for(Oe={line:(Oe=mx[be]).line,column:Oe.column};be<Y;)s.charCodeAt(be)===10?(Oe.line++,Oe.column=1):Oe.column++,be++;return mx[Y]=Oe,Oe}function $P(Y,be){var Oe=mC(Y),_i=mC(be);return{source:l,start:{offset:Y,line:Oe.line,column:Oe.column},end:{offset:be,line:_i.line,column:_i.column}}}function Jt(Y){ue<Gu||(ue>Gu&&(Gu=ue,C_=[]),C_.push(Y))}function jAe(Y,be,Oe){return new t(t.buildMessage(Y,be),Y,be,Oe)}function vK(){var Y;return(Y=HAe())===a&&(Y=qAe()),Y}function HAe(){var Y,be;return ht++,Y=ue,xo(),s.substr(ue,4)===p?(be=p,ue+=4):(be=a,ht===0&&Jt(G)),be!==a?(xo(),Ir=Y,Y=Lz()):(ue=Y,Y=a),ht--,Y===a&&ht===0&&Jt(U),Y}function qAe(){var Y,be;if(Y=[],(be=Uz())!==a)for(;be!==a;)Y.push(be),be=Uz();else Y=a;return Y}function Uz(){var Y,be,Oe,_i;return Y=ue,xo(),(be=XAe())!==a?(xo(),(Oe=WAe())===a&&(Oe=null),xo(),s.charCodeAt(ue)===41?(_i=f,ue++):(_i=a,ht===0&&Jt(W)),_i!==a?(xo(),Ir=Y,Y=wP(be,Oe)):(ue=Y,Y=a)):(ue=Y,Y=a),Y}function WAe(){var Y,be,Oe,_i,Wo,Rs,Hu,LP;if(Y=ue,(be=zz())!==a){for(Oe=[],_i=ue,Wo=xo(),s.charCodeAt(ue)===44?(Rs=m,ue++):(Rs=a,ht===0&&Jt(X)),Rs===a&&(Rs=null),Hu=xo(),(LP=zz())!==a?_i=Wo=[Wo,Rs,Hu,LP]:(ue=_i,_i=a);_i!==a;)Oe.push(_i),_i=ue,Wo=xo(),s.charCodeAt(ue)===44?(Rs=m,ue++):(Rs=a,ht===0&&Jt(X)),Rs===a&&(Rs=null),Hu=xo(),(LP=zz())!==a?_i=Wo=[Wo,Rs,Hu,LP]:(ue=_i,_i=a);Ir=Y,Y=xP(be,Oe)}else ue=Y,Y=a;return Y}function zz(){var Y,be;return Y=ue,(be=ZAe())===a&&(be=YAe())===a&&(be=QAe())===a&&(be=JAe()),be!==a&&(Ir=Y,be=TP(be)),(Y=be)===a&&(Y=ue,(be=KAe())!==a&&(Ir=Y,be=SP(be)),Y=be),Y}function xo(){var Y,be;for(ht++,Y=[],Q.test(s.charAt(ue))?(be=s.charAt(ue),ue++):(be=a,ht===0&&Jt(q));be!==a;)Y.push(be),Q.test(s.charAt(ue))?(be=s.charAt(ue),ue++):(be=a,ht===0&&Jt(q));return ht--,be=a,ht===0&&Jt(ee),Y}function XAe(){var Y,be,Oe;return ht++,Y=ue,(be=_K())!==a?(s.charCodeAt(ue)===40?(Oe=y,ue++):(Oe=a,ht===0&&Jt(ge)),Oe!==a?(Ir=Y,Y=Dz(be)):(ue=Y,Y=a)):(ue=Y,Y=a),ht--,Y===a&&(be=a,ht===0&&Jt(te)),Y}function _K(){var Y,be,Oe;if(ht++,Y=ue,be=[],Z.test(s.charAt(ue))?(Oe=s.charAt(ue),ue++):(Oe=a,ht===0&&Jt(ke)),Oe!==a)for(;Oe!==a;)be.push(Oe),Z.test(s.charAt(ue))?(Oe=s.charAt(ue),ue++):(Oe=a,ht===0&&Jt(ke));else be=a;return be!==a&&(Ir=Y,be=Nz()),ht--,(Y=be)===a&&(be=a,ht===0&&Jt(Te)),Y}function ZAe(){var Y,be,Oe;return ht++,Y=ue,xo(),(be=ju())!==a?(s.charCodeAt(ue)===37?(Oe=v,ue++):(Oe=a,ht===0&&Jt(me)),Oe!==a?(Ir=Y,Y=Fz(be)):(ue=Y,Y=a)):(ue=Y,Y=a),ht--,Y===a&&ht===0&&Jt(_e),Y}function YAe(){var Y,be,Oe;return ht++,Y=ue,xo(),(be=ju())!==a?(s.substr(ue,2)===w?(Oe=w,ue+=2):(Oe=a,ht===0&&Jt(Fe)),Oe!==a?(Ir=Y,Y=kz(be)):(ue=Y,Y=a)):(ue=Y,Y=a),Y===a&&(Y=ue,xo(),(be=ju())!==a?(s.substr(ue,2)===b?(Oe=b,ue+=2):(Oe=a,ht===0&&Jt(Li)),Oe!==a?(Ir=Y,Y=fC(be)):(ue=Y,Y=a)):(ue=Y,Y=a),Y===a&&(Y=ue,xo(),(be=ju())!==a?(s.substr(ue,2)===S?(Oe=S,ue+=2):(Oe=a,ht===0&&Jt(zi)),Oe!==a?(Ir=Y,Y=EP(be)):(ue=Y,Y=a)):(ue=Y,Y=a),Y===a&&(Y=ue,xo(),(be=ju())!==a?(s.substr(ue,2)===T?(Oe=T,ue+=2):(Oe=a,ht===0&&Jt(li)),Oe!==a?(Ir=Y,Y=CP(be)):(ue=Y,Y=a)):(ue=Y,Y=a),Y===a&&(Y=ue,xo(),(be=ju())!==a?(s.substr(ue,2)===E?(Oe=E,ue+=2):(Oe=a,ht===0&&Jt(Vi)),Oe!==a?(Ir=Y,Y=AP(be)):(ue=Y,Y=a)):(ue=Y,Y=a),Y===a&&(Y=ue,xo(),(be=ju())!==a?(s.substr(ue,2)===C?(Oe=C,ue+=2):(Oe=a,ht===0&&Jt(hi)),Oe!==a?(Ir=Y,Y=Ii(be)):(ue=Y,Y=a)):(ue=Y,Y=a)))))),ht--,Y===a&&ht===0&&Jt(Ce),Y}function QAe(){var Y,be,Oe;return ht++,Y=ue,(be=ju())!==a?(s.substr(ue,3)===A?(Oe=A,ue+=3):(Oe=a,ht===0&&Jt(qr)),Oe!==a?(Ir=Y,Y=qo(be)):(ue=Y,Y=a)):(ue=Y,Y=a),Y===a&&(Y=ue,(be=ju())!==a?(s.substr(ue,3)===I?(Oe=I,ue+=3):(Oe=a,ht===0&&Jt(cs)),Oe!==a?(Ir=Y,Y=wo(be)):(ue=Y,Y=a)):(ue=Y,Y=a),Y===a&&(Y=ue,(be=ju())!==a?(s.substr(ue,4)===D?(Oe=D,ue+=4):(Oe=a,ht===0&&Jt(st)),Oe!==a?(Ir=Y,Y=Ul(be)):(ue=Y,Y=a)):(ue=Y,Y=a),Y===a&&(Y=ue,(be=ju())!==a?(s.substr(ue,4)===L?(Oe=L,ue+=4):(Oe=a,ht===0&&Jt(Pr)),Oe!==a?(Ir=Y,Y=E_(be)):(ue=Y,Y=a)):(ue=Y,Y=a)))),ht--,Y===a&&(be=a,ht===0&&Jt(Bi)),Y}function JAe(){var Y,be;return ht++,Y=ue,xo(),(be=ju())!==a?(Ir=Y,Y=RP(be)):(ue=Y,Y=a),ht--,Y===a&&ht===0&&Jt(Xn),Y}function KAe(){var Y,be,Oe,_i;if(ht++,Y=ue,s.charCodeAt(ue)===35?(be=z,ue++):(be=a,ht===0&&Jt(ma)),be!==a){if(Oe=[],ce.test(s.charAt(ue))?(_i=s.charAt(ue),ue++):(_i=a,ht===0&&Jt(nd)),_i!==a)for(;_i!==a;)Oe.push(_i),ce.test(s.charAt(ue))?(_i=s.charAt(ue),ue++):(_i=a,ht===0&&Jt(nd));else Oe=a;Oe!==a?(Ir=Y,Y=MP()):(ue=Y,Y=a)}else ue=Y,Y=a;return Y===a&&(Y=ue,(be=Uz())!==a&&(Ir=Y,be=OP(be)),(Y=be)===a&&(Y=ue,(be=_K())!==a&&(Ir=Y,be=PP()),Y=be)),ht--,Y===a&&(be=a,ht===0&&Jt(Za)),Y}function ju(){var Y,be,Oe,_i,Wo,Rs,Hu;for(Y=ue,oe.test(s.charAt(ue))?(s.charAt(ue),ue++):ht===0&&Jt(od),be=ue,Oe=[],$.test(s.charAt(ue))?(_i=s.charAt(ue),ue++):(_i=a,ht===0&&Jt(ga));_i!==a;)Oe.push(_i),$.test(s.charAt(ue))?(_i=s.charAt(ue),ue++):(_i=a,ht===0&&Jt(ga));if(s.charCodeAt(ue)===46?(_i=B,ue++):(_i=a,ht===0&&Jt(S_)),_i!==a){if(Wo=[],$.test(s.charAt(ue))?(Rs=s.charAt(ue),ue++):(Rs=a,ht===0&&Jt(ga)),Rs!==a)for(;Rs!==a;)Wo.push(Rs),$.test(s.charAt(ue))?(Rs=s.charAt(ue),ue++):(Rs=a,ht===0&&Jt(ga));else Wo=a;Wo!==a?be=Oe=[Oe,_i,Wo]:(ue=be,be=a)}else ue=be,be=a;if(be===a)if(be=[],$.test(s.charAt(ue))?(Oe=s.charAt(ue),ue++):(Oe=a,ht===0&&Jt(ga)),Oe!==a)for(;Oe!==a;)be.push(Oe),$.test(s.charAt(ue))?(Oe=s.charAt(ue),ue++):(Oe=a,ht===0&&Jt(ga));else be=a;if(be!==a){if(Oe=ue,s.charCodeAt(ue)===101?(_i=V,ue++):(_i=a,ht===0&&Jt($z)),_i!==a){if(oe.test(s.charAt(ue))?(Wo=s.charAt(ue),ue++):(Wo=a,ht===0&&Jt(od)),Wo===a&&(Wo=null),Rs=[],$.test(s.charAt(ue))?(Hu=s.charAt(ue),ue++):(Hu=a,ht===0&&Jt(ga)),Hu!==a)for(;Hu!==a;)Rs.push(Hu),$.test(s.charAt(ue))?(Hu=s.charAt(ue),ue++):(Hu=a,ht===0&&Jt(ga));else Rs=a;Rs!==a?Oe=_i=[_i,Wo,Rs]:(ue=Oe,Oe=a)}else ue=Oe,Oe=a;Oe===a&&(Oe=null),Ir=Y,Y=Op()}else ue=Y,Y=a;return Y}function eRe(Y,be){return Y.map(function(Oe){return Oe[be]})}function tRe(Y,be,Oe){return[Y].concat(eRe(be,Oe))}if((o=h())!==a&&ue===s.length)return o;throw o!==a&&ue<s.length&&Jt(IP()),jAe(C_,Gu<s.length?s.charAt(Gu):null,Gu<s.length?$P(Gu,Gu+1):$P(Gu,Gu))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length),f=a[l.line-1],m=l.line===h.line?h.column:f.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+f+`
`+p+" | "+i("",l.column-1)+i("",m-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var y=m.parts.map(function(v){return Array.isArray(v)?c(v[0])+"-"+c(v[1]):c(v)});return"["+(m.inverted?"^":"")+y+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(y){return"\\x0"+a(y)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(y){return"\\x"+a(y)})}function h(m){return o[m.type](m)}function p(m){var y,v,w=m.map(h);if(w.sort(),w.length>0){for(y=1,v=1;y<w.length;y++)w[y-1]!==w[y]&&(w[v]=w[y],v++);w.length=v}switch(w.length){case 1:return w[0];case 2:return w[0]+" or "+w[1];default:return w.slice(0,-1).join(", ")+", or "+w[w.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+p(s)+" but "+f(n)+" found."},{SyntaxError:t,parse:r}},(Zte=C0e).exports&&(Zte.exports=Yte());const $Z={deg:1,grad:.9,rad:180/Math.PI,turn:360};function XUe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&$Z[e.unit]!=null))throw new j("effect:type-error",`Expected <angle>, Actual: ${Ok(e)}`,{term:e})}const LZ={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function ZUe(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&LZ[e.unit]!=null))throw new j("effect:type-error",`Expected <length>, Actual: ${Ok(e)}`,{term:e})}function Hd(e){WUe(e);const t=e.value;return z3(t,e),e.unit==="%"?.01*t:t}function YUe(e){return qUe(e),z3(e.value,e),e.value}function QUe(e){return XUe(e),e.value*$Z[e.unit]||0}function DZ(e){return ZUe(e),e.value*LZ[e.unit]||0}function JUe(e){switch(e.colorType){case"hex":return T3e(e.value);case"named":return A0e(e.value);case"function":return tze(e.value)}}function A0e(e){if(!ape(e))throw new j("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return x3e(e)}const KUe=/^rgba?/i,eze=/^hsla?/i;function tze(e){if(JE(e.parameters,4),KUe.test(e.name))return[Hd(e.parameters[0]),Hd(e.parameters[1]),Hd(e.parameters[2]),e.parameters[3]?Hd(e.parameters[3]):1];if(eze.test(e.name))return lpe(YUe(e.parameters[0]),Hd(e.parameters[1]),Hd(e.parameters[2]),e.parameters[3]?Hd(e.parameters[3]):1);throw new j("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function NZ(e,t,i){var r;try{return rze(e)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function FZ(e,t,i,r){try{const s=ize(e);Sc(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function ize(e){const t=IZ(e);return t?kUe(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function rze(e){if(!e||e.length===0)return null;if(sze(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:ZF(i.value)});return t}return ZF(e)}function sze(e){const t=e[0];return!!t&&"scale"in t}function ZF(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[Sm(i,"amount")];break;case"blur":r=[Sm(i,"radius","pt")];break;case"hue-rotate":r=[Sm(i,"angle","deg")];break;case"drop-shadow":r=[Sm(i,"xoffset","pt"),Sm(i,"yoffset","pt"),Sm(i,"blurRadius","pt"),nze(i,"color")];break;case"bloom":r=[Sm(i,"strength"),Sm(i,"radius","pt"),Sm(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;IZ(s),t.push(s)}return t.join(" ")}function Sm(e,t,i){if(e[t]==null)throw new j("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function nze(e,t){if(e[t]==null)throw new j("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const AD=-3;var wg;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(wg||(wg={}));class oze{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class kZ{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Wt,this._users=new Wt}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,wg.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,wg.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,AD)-AD;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,wg.SOME);if(!(_(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>t[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(t["Priority "+(o+AD-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,wg.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,wg.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,wg.SOME);_(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class aze{constructor(t,i){this._storage=new kZ,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function lze(e){return typeof e=="function"}function l2t(e,t,i,r){return lze(e)?e(t,i,r):e}function c2t(e){return[e.r,e.g,e.b,e.a]}function u2t(e,t,i){const r=` /-,
`,s=l=>{let c=l.length;for(;c--;)if(!r.includes(l.charAt(c)))return!1;return!0},n=[];let o=0,a=-1;do if(a=t.indexOf("[",o),a>=o){if(a>o){const l=t.substr(o,a-o);n.push([l,null,s(l)])}if(o=a+1,a=t.indexOf("]",o),a>=o){if(a>o){const l=e[t.substr(o,a-o)];l&&n.push([null,l,!1])}o=a+1}}while(a!==-1);if(o<t.length-1){const l=t.substr(o);n.push([l,null,s(l)])}return l=>{let c="",h=null;for(const p of n){const[f,m,y]=p;if(f)y?h=f:(h&&(c+=h,h=null),c+=f);else{const v=l.attributes[m];v&&(h&&(c+=h,h=null),c+=v)}}return cze(c,i)}}function cze(e,t){switch(typeof e!="string"&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function h2t(e,t,i,r,s,n,o=!0){const a=t/s,l=i/n,c=Math.ceil(a/2),h=Math.ceil(l/2);for(let p=0;p<n;p++)for(let f=0;f<s;f++){const m=4*(f+(o?n-p-1:p)*s);let y=0,v=0,w=0,b=0,S=0,T=0,E=0;const C=(p+.5)*l;for(let A=Math.floor(p*l);A<(p+1)*l;A++){const I=Math.abs(C-(A+.5))/h,D=(f+.5)*a,L=I*I;for(let z=Math.floor(f*a);z<(f+1)*a;z++){let B=Math.abs(D-(z+.5))/c;const V=Math.sqrt(L+B*B);V>=-1&&V<=1&&(y=2*V*V*V-3*V*V+1,y>0&&(B=4*(z+A*t),E+=y*e[B+3],w+=y,e[B+3]<255&&(y=y*e[B+3]/250),b+=y*e[B],S+=y*e[B+1],T+=y*e[B+2],v+=y))}}r[m]=b/v,r[m+1]=S/v,r[m+2]=T/v,r[m+3]=E/w}}function uze(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function Pk(e){var t;return(t=e.data)==null?void 0:t.symbol}function YF(e){return e.type==="CIMVectorMarker"||e.type==="CIMPictureMarker"||e.type==="CIMBarChartMarker"||e.type==="CIMCharacterMarker"||e.type==="CIMPieChartMarker"||e.type==="CIMStackedBarChartMarker"}function QF(e){return e.type==="CIMGradientStroke"||e.type==="CIMPictureStroke"||e.type==="CIMSolidStroke"}function R0e(e){return e.type==="CIMGradientFill"||e.type==="CIMHatchFill"||e.type==="CIMPictureFill"||e.type==="CIMSolidFill"||e.type==="CIMWaterFill"}function JF(e){return e.type==="CIMMarkerPlacementAlongLineRandomSize"||e.type==="CIMMarkerPlacementAlongLineSameSize"||e.type==="CIMMarkerPlacementAlongLineVariableSize"||e.type==="CIMMarkerPlacementAtExtremities"||e.type==="CIMMarkerPlacementAtMeasuredUnits"||e.type==="CIMMarkerPlacementAtRatioPositions"||e.type==="CIMMarkerPlacementOnLine"||e.type==="CIMMarkerPlacementOnVertices"}const d2t=e=>isNaN(e)||!e?0:e,p2t=e=>{if(!e)return!1;for(const t of e)switch(t.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function f2t(){return import("./geometryEngineJSON.2762c1dd.js")}function hze(e){const t=Pk(e);if(t.type==="CIMTextSymbol")return t.height;let i=0;if(t.symbolLayers)for(const r of t.symbolLayers)YF(r)&&r.size>i?i=r.size:QF(r)&&r.width>i?i=r.width:R0e(r);return i}function m2t(e,t,i){const r=Pk(e),s=hze(e);if(s===0)return void dze(r,t);UZ(r,t/s,!1,i)}function dze(e,t){if(e.type!=="CIMTextSymbol"){if(e.symbolLayers)for(const i of e.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":i.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":i.width=t}}else e.height=t}function UZ(e,t,i,r){if(e.type!=="CIMTextSymbol"){if(i&&e.effects)for(const s of e.effects)mze(s,t);if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":pze(s,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r==null?void 0:r.preserveOutlineWidth)&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":UZ(s.lineSymbol,t,!0,ye(F({},r),{preserveOutlineWidth:!1})),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}}else e.height*=t}function pze(e,t,i){if(e.markerPlacement&&fze(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,e.type==="CIMVectorMarker"&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||UZ(r.symbol,t,!0,i)}function fze(e,t){switch(JF(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map(r=>r*t);e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function mze(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map(r=>r*t);e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function gze(e){const t=[];return V7(Pk(e),t),t.length?new Pe(uze(t[0])):null}function V7(e,t){let i;i=e.type==="CIMTextSymbol"?e.symbol:e;const r=e.type==="CIMPolygonSymbol";if(i.symbolLayers){for(const s of i.symbolLayers)if(!(s.colorLocked||r&&(QF(s)||YF(s)&&s.markerPlacement&&JF(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Jte(t,s.tintColor);break;case"CIMVectorMarker":s.markerGraphics.forEach(n=>{V7(n.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":Jte(t,s.color);break;case"CIMHatchFill":V7(s.lineSymbol,t)}}}function Jte(e,t){for(const i of e)if(i.join(".")===t.join("."))return;e.push(t)}function M0e(e,t,i){t instanceof Pe||(t=new Pe(t));const r=Pk(e);r&&B7(r,t,i)}function B7(e,t,i){let r;r=e.type==="CIMTextSymbol"?e.symbol:e;const s=r.type==="CIMPolygonSymbol";if(r.symbolLayers)for(const n of r.symbolLayers){if(n.colorLocked)continue;if(s){if(i){const{layersToColor:a}=i;if((QF(n)||YF(n)&&n.markerPlacement&&JF(n.markerPlacement))&&a==="fill"||R0e(n)&&a==="outline")continue}else if(QF(n)||YF(n)&&n.markerPlacement&&JF(n.markerPlacement))continue}const o=t.toArray();switch(n.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":n.tintColor=o;break;case"CIMVectorMarker":n.markerGraphics.forEach(a=>{B7(a.symbol,t,i)});break;case"CIMSolidStroke":case"CIMSolidFill":n.color=o;break;case"CIMHatchFill":B7(n.lineSymbol,t,i)}}}const O0e="picture-fill",P0e="simple-fill",yze="simple-line",I0e="simple-marker",vze="text",_ze="cim",M6=new aze(1e3);function bze(e){const t=e.style;let i=null;if(e)switch(e.type){case I0e:t!=="cross"&&t!=="x"&&(i=e.color);break;case P0e:t==="solid"?i=e.color:t!=="none"&&(i={type:"pattern",x:0,y:0,src:xi(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case O0e:i={type:"pattern",src:e.url,width:gi(e.width)*e.xscale,height:gi(e.height)*e.yscale,x:gi(e.xoffset),y:gi(e.yoffset)};break;case vze:i=e.color;break;case _ze:i=gze(e)}return i}function wze(e,t){const i=e+"-"+t;return M6.get(i)!==void 0?Promise.resolve(M6.get(i)):Zt(e,{responseType:"image"}).then(r=>{const s=r.data,n=s.naturalWidth,o=s.naturalHeight,a=document.createElement("canvas");a.width=n,a.height=o;const l=a.getContext("2d");l.fillStyle=t,l.fillRect(0,0,n,o),l.globalCompositeOperation="destination-in",l.drawImage(s,0,0);const c=a.toDataURL();return M6.put(i,c),c})}function pO(e){if(!e)return null;let t;switch(e.type){case P0e:case O0e:case I0e:t=pO(e.outline);break;case yze:{const i=gi(e.width);e.style!=="none"&&i!==0&&(t={color:e.color,style:zZ(e.style),width:i,cap:e.cap,join:e.join==="miter"?gi(e.miterLimit):e.join});break}default:t=null}return t}const zZ=(()=>{const e={};return t=>{if(e[t])return e[t];const i=t.replace(/-/g,"");return e[t]=i,i}})(),xze=new Pe([128,128,128]),Kte=/\/resource\/(.*?)\.svg$/,Tze=new Pe("white");function Sze(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1);return"outline"in i?xr(i,"outline","size"):void 0}function Eze(e){if(!e)return 0;if(Jf(e)){const i=Sze(e);return _(i)?i:0}const t=pO(e);return t&&$l(t.width)||0}function Ik(e){if(R(e)||!("symbolLayers"in e)||R(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(t=>t.type==="object");case"line-3d":return e.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return e.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function $0e(e,t){const i=t.resource.href;return!he("esri-canvas-svg-support")&&e.styleOrigin&&Kte.test(i)?i.replace(Kte,"/resource/png/$1.png"):i}function wx(e,t){if(!e)return null;let i=null;return Jf(e)?i=Cze(e):J5(e)&&(i=e.color?new Pe(e.color):null),i?fO(i,t):null}function Cze(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(r=>{r.type==="object"&&r.resource.href!=null||(i=r.type==="water"?r.color:_(r.material)?r.material.color:null)}),i?new Pe(i):null}function fO(e,t){if(t==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new Pe(i)}function Aze(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{const o=_(n)?n:null;return fO(t=t||o||i!=null&&Tze,i)};r.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const o=_(n.material)?n.material.color:null,a=s(o);R(n.material)?n.material=new Ru({color:a}):n.material.color=a,i!=null&&"outline"in n&&_(n.outline)&&_(n.outline.color)&&(n.outline.color=fO(n.outline.color,i))}})}function Rze(e,t,i){(t=t||e.color)&&(e.color=fO(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=fO(e.outline.color,i))}function O6(e,t,i){e&&(t||i!=null)&&(t&&(t=new Pe(t)),Jf(e)?Aze(e,t,i):J5(e)&&Rze(e,t,i))}async function Mze(e,t){const i=e.symbolLayers;i&&await Sk(i,async r=>Oze(r,t))}async function Oze(e,t){switch(e.type){case"extrude":Ize(e,t);break;case"icon":case"line":case"text":Pze(e,t);break;case"path":Lze(e,t);break;case"object":await $ze(e,t)}}function Pze(e,t){const i=L0e(t);_(i)&&(e.size=i)}function L0e(e){for(const t of e)if(typeof t=="number")return t;return null}function Ize(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function $ze(e,t){const{resourceSize:i,symbolSize:r}=await Dze(e),s=D0e(t,i,r);e.width=dM(t[0],r[0],i[0],s),e.depth=dM(t[1],r[1],i[1],s),e.height=dM(t[2],r[2],i[2],s)}function Lze(e,t){const i=D0e(t,Nf,[e.width,void 0,e.height]);e.width=dM(t[0],e.width,1,i),e.height=dM(t[2],e.height,1,i)}function D0e(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return i[r]!=null?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function Dze(e){const t=await import("./symbolLayerUtils.13583e34.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++)if(o[l]!=null){a=o[l]/i[l];break}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function dM(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function Nze(e,t){const i=L0e(t);if(!R(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function Fze(e,t){if(e&&t)return Jf(e)?Mze(e,t):void(J5(e)&&Nze(e,t))}function kze(e,t,i){if(e&&t!=null)if(Jf(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else J5(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function mO(e){if(!e)return null;const t=e.effects.filter(i=>i.type!=="bloom").map(i=>i.toJSON());return ZF(t)}const N0e="<",F0e=">",Uze=K5("short-date");function k0e(e,t,i,r){let s="";t===0?s=`${N0e} `:t===i&&(s=`${F0e} `);let n=null;return n=r?Kf(e,Uze):SUe(e),s+n}const zze=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function G7(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find(o=>o.type==="color");if(!t)return null;let i=null,r=null;if(t.stops){if(t.stops.length===1)return t.stops[0].color;i=t.stops[0].value,r=t.stops[t.stops.length-1].value}const s=i+(r-i)/2,{getColor:n}=await Promise.resolve().then(function(){return nx});return n(t,s)}async function U0e(e,t){const i=e.trailCap,r=e.trailWidth||1,s=t||await G7(e)||e.color;return new Pc({cap:i,color:s,width:r})}const Vze=new Pe([64,64,64]);function z0e(e,t){const i=[],r=e.length-1;return e.length===5?i.push(0,2,4):i.push(0,r),e.map((s,n)=>i.includes(n)?k0e(s,n,r,t):null)}async function j7(e,t,i){let r=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:z0e(s,i);return(await Promise.all(s.map(async(c,h)=>({value:c,color:e.type==="opacity"?await Bze(c,e,t):(await Promise.resolve().then(function(){return nx})).getColor(e,c),label:r?n[h]:l[h]})))).reverse()}async function Bze(e,t,i=Vze){const r=new Pe(i),s=(await Promise.resolve().then(function(){return nx})).getOpacity(t,e);return s!=null&&(r.a=s),r}function Gze(e){let t=!1,i=[],r=[];i=e.map(a=>a.value),t=e.some(a=>!!a.label),t&&(r=e.map(a=>a.label));const s=i[0],n=i[i.length-1];if(s==null&&n==null)return null;const o=t?null:z0e(i,!1);return i.map((a,l)=>({value:a,color:V0e(a,e),label:t?r[l]:o[l]})).reverse()}function V0e(e,t){const{startIndex:i,endIndex:r,weight:s}=jze(e,t);if(i===r)return t[i].color;const n=Pe.blendColors(t[i].color,t[r].color,s);return new Pe(n)}function jze(e,t){let i=0,r=t.length-1;return t.some((s,n)=>e<s.value?(r=n,!0):(i=n,!1)),{startIndex:i,endIndex:r,weight:(e-t[i].value)/(t[r].value-t[i].value)}}function Hze(e,t){let i=[];if(e&&e.type==="multipart")e.colorRamps.reverse().forEach((r,s)=>{s===0?i.push({value:t.max,color:new Pe(r.toColor),label:"high"}):i.push({value:null,color:new Pe(r.toColor),label:""}),s===e.colorRamps.length-1?i.push({value:t.min,color:new Pe(r.fromColor),label:"low"}):i.push({value:null,color:new Pe(r.fromColor),label:""})});else{let r,s;e&&e.type==="algorithmic"?(r=e.fromColor,s=e.toColor):(r=[0,0,0,1],s=[255,255,255,1]),i=[{value:t.max,color:new Pe(s),label:"high"},{value:t.min,color:new Pe(r),label:"low"}]}return i}var H7;let hR=H7=class extends ve{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new H7({color:this.color,ratio:this.ratio})}};u([d({type:Pe,json:{type:[Br],default:null,write:!0}})],hR.prototype,"color",void 0),u([d({type:Number,json:{write:!0}})],hR.prototype,"ratio",void 0),hR=H7=u([P("esri.renderers.support.HeatmapColorStop")],hR);const pM=hR;function B0e(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=t.length-1;if(t&&t[0]){const r=t[i];r&&r.ratio!==1&&(t.push(new pM({ratio:1,color:r.color})),i++)}return t.map((r,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}fe.getLogger("esri.renderers.support.utils");function Nc(e,t,i){_W(e,t,()=>[]).push(...i)}async function qze(e){var i,r;const t=new Map;if("visualVariables"in e&&e.visualVariables){const s=e.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=n.field||n.valueExpression,a=(await j7(n)).map(l=>l.color);Nc(t,o,a)}}if(e.type==="heatmap"){const s=B0e(e).map(n=>n.color);Nc(t,e.field,s)}else if(e.type==="pie-chart"){for(const s of e.attributes)Nc(t,s.field,[s.color]);Nc(t,null,[(i=e==null?void 0:e.othersCategory)==null?void 0:i.color,wx(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const s of e.attributes)Nc(t,s.field,[s.color]);Nc(t,null,[e.backgroundColor])}else if(e.type==="unique-value")if(((r=e.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of e.uniqueValueInfos)Nc(t,s.value.toString(),[wx(s.symbol,null)]);else{const s=e.uniqueValueInfos.map(c=>wx(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=e;(n||l)&&Nc(t,n||l,s),o&&Nc(t,o,s),a&&Nc(t,a,s)}else if(e.type==="class-breaks"){const s=e.classBreakInfos.map(n=>wx(n.symbol,null));Nc(t,e.field||e.valueExpression,s)}else e.type==="simple"&&Nc(t,null,[wx(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&Nc(t,null,[wx(e.defaultSymbol,null)]),t.forEach((s,n)=>{const o=w3(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));t.set(n,o)}),t}var q7;let dR=q7=class extends ve{constructor(e){super(e),this.name=null,this.code=null}clone(){return new q7({name:this.name,code:this.code})}};u([d({type:String,json:{write:!0}})],dR.prototype,"name",void 0),u([d({type:[String,Number],json:{write:!0}})],dR.prototype,"code",void 0),dR=q7=u([P("esri.layers.support.CodedValue")],dR);const Wze=new wi({inherited:"inherited",codedValue:"coded-value",range:"range"});let pR=class extends ve{constructor(e){super(e),this.name=null,this.type=null}};u([d({type:String,json:{write:!0}})],pR.prototype,"name",void 0),u([at(Wze)],pR.prototype,"type",void 0),pR=u([P("esri.layers.support.Domain")],pR);const $k=pR;var W7;let fR=W7=class extends $k{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new W7({codedValues:re(this.codedValues),name:this.name})}};u([d({type:[dR],json:{write:!0}})],fR.prototype,"codedValues",void 0),u([at({codedValue:"coded-value"})],fR.prototype,"type",void 0),fR=W7=u([P("esri.layers.support.CodedValueDomain")],fR);const G0e=fR;var X7;let RD=X7=class extends $k{constructor(e){super(e),this.type="inherited"}clone(){return new X7}};u([at({inherited:"inherited"})],RD.prototype,"type",void 0),RD=X7=u([P("esri.layers.support.InheritedDomain")],RD);const j0e=RD;var Z7;let NT=Z7=class extends $k{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new Z7({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],NT.prototype,"maxValue",void 0),u([d({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],NT.prototype,"minValue",void 0),u([at({range:"range"})],NT.prototype,"type",void 0),NT=Z7=u([P("esri.layers.support.RangeDomain")],NT);const H0e=NT,q0e={key:"type",base:$k,typeMap:{range:H0e,"coded-value":G0e,inherited:j0e}};function VZ(e){if(!e||!e.type)return null;switch(e.type){case"range":return H0e.fromJSON(e);case"codedValue":return G0e.fromJSON(e);case"inherited":return j0e.fromJSON(e)}return null}const Xze=new wi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var Y7;const Zze=new wi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let al=Y7=class extends ve{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?Zze.fromJSON(i.fieldValueType):null}clone(){return new Y7({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};u([d({type:String,json:{write:!0}})],al.prototype,"alias",void 0),u([d({type:[String,Number],json:{write:{allowNull:!0}}})],al.prototype,"defaultValue",void 0),u([d()],al.prototype,"description",void 0),u([Ie("description")],al.prototype,"readDescription",null),u([d({types:q0e,json:{read:{reader:VZ},write:!0}})],al.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],al.prototype,"editable",void 0),u([d({type:Br,json:{write:!0}})],al.prototype,"length",void 0),u([d({type:String,json:{write:!0}})],al.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0}})],al.prototype,"nullable",void 0),u([at(Xze)],al.prototype,"type",void 0),u([d()],al.prototype,"valueType",void 0),u([Ie("valueType",["description"])],al.prototype,"readValueType",null),al=Y7=u([P("esri.layers.support.Field")],al);const V3=al;var Q7;let FT=Q7=class extends ve{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new Q7({mapLayerId:e,gdbVersion:t})}};u([at({mapLayer:"map-layer"})],FT.prototype,"type",void 0),u([d({type:Br,json:{write:!0}})],FT.prototype,"mapLayerId",void 0),u([d({type:String,json:{write:!0}})],FT.prototype,"gdbVersion",void 0),FT=Q7=u([P("esri.layers.support.source.MapLayerSource")],FT);var J7;let Xm=J7=class extends ve{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:i,spatialReference:(o=r==null?void 0:r.clone())!=null?o:void 0,geometryType:s};return new J7(n)}};u([at({queryTable:"query-table"})],Xm.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Xm.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],Xm.prototype,"query",void 0),u([d({type:String,json:{write:!0}})],Xm.prototype,"oidFields",void 0),u([d({type:et,json:{write:!0}})],Xm.prototype,"spatialReference",void 0),u([at(Yde)],Xm.prototype,"geometryType",void 0),Xm=J7=u([P("esri.layers.support.source.QueryTableDataSource")],Xm);var K7;let kT=K7=class extends ve{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new K7({workspaceId:e,dataSourceName:t})}};u([at({raster:"raster"})],kT.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],kT.prototype,"dataSourceName",void 0),u([d({type:String,json:{write:!0}})],kT.prototype,"workspaceId",void 0),kT=K7=u([P("esri.layers.support.source.RasterDataSource")],kT);var ej;let I1=ej=class extends ve{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new ej({workspaceId:e,gdbVersion:t,dataSourceName:i})}};u([at({table:"table"})],I1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],I1.prototype,"workspaceId",void 0),u([d({type:String,json:{write:!0}})],I1.prototype,"gdbVersion",void 0),u([d({type:String,json:{write:!0}})],I1.prototype,"dataSourceName",void 0),I1=ej=u([P("esri.layers.support.source.TableDataSource")],I1);var tj,ij;const Yze=fa()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Xc=tj=class extends ve{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return eie()(e,t,i)}castLeftTableSource(e){return wp(rj(),e)}readRightTableSource(e,t,i){return eie()(e,t,i)}castRightTableSource(e){return wp(rj(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=i==null?void 0:i.clone())!=null?o:void 0,rightTableSource:(a=r==null?void 0:r.clone())!=null?a:void 0,joinType:s};return new tj(n)}};u([at({joinTable:"join-table"})],Xc.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],Xc.prototype,"leftTableKey",void 0),u([d({type:String,json:{write:!0}})],Xc.prototype,"rightTableKey",void 0),u([d({json:{write:!0}})],Xc.prototype,"leftTableSource",void 0),u([Ie("leftTableSource")],Xc.prototype,"readLeftTableSource",null),u([qt("leftTableSource")],Xc.prototype,"castLeftTableSource",null),u([d({json:{write:!0}})],Xc.prototype,"rightTableSource",void 0),u([Ie("rightTableSource")],Xc.prototype,"readRightTableSource",null),u([qt("rightTableSource")],Xc.prototype,"castRightTableSource",null),u([at(Yze)],Xc.prototype,"joinType",void 0),Xc=tj=u([P("esri.layers.support.source.JoinTableDataSource")],Xc);let P6=null;function eie(){return P6||(P6=UE({types:rj()})),P6}let I6=null;function rj(){return I6||(I6={key:"type",base:null,typeMap:{"data-layer":qd,"map-layer":FT}}),I6}const Qze={key:"type",base:null,typeMap:{"join-table":Xc,"query-table":Xm,raster:kT,table:I1}};let qd=ij=class extends ve{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new ij({fields:e,dataSource:t})}};u([at({dataLayer:"data-layer"})],qd.prototype,"type",void 0),u([d({type:[V3],json:{write:!0}})],qd.prototype,"fields",void 0),u([d({types:Qze,json:{write:!0}})],qd.prototype,"dataSource",void 0),qd=ij=u([P("esri.layers.support.source.DataLayerSource")],qd),qd.from=Bs(qd);function Jze(e,t){return t?ye(F({},t),{query:F(F({},e),t.query)}):{query:e}}function W0e(e){return typeof e=="string"?js(e):re(e)}function Kze(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=Kze(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=t?o:JSON.stringify(o)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}const _I={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Su({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:et.WebMercator}),minus180Line:new Su({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:et.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Su({paths:[[[180,-180],[180,180]]],spatialReference:et.WGS84}),minus180Line:new Su({paths:[[[-180,-180],[-180,180]]],spatialReference:et.WGS84})}};function Lb(e,t){return Math.ceil((e-t)/(2*t))}function X0e(e,t){const i=fM(e);for(const r of i)for(const s of r)s[0]+=t;return e}function fM(e){return qb(e)?e.rings:e.paths}async function e6e(e,t,i,r){const s=typeof e=="string"?js(e):e,n=t[0].spatialReference,o=ye(F({},r),{query:ye(F({},s.query),{f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:VE(t[0]),geometries:t}),cutter:JSON.stringify(i)})}),a=await Zt(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=Qg(h);return p.spatialReference=n,p})}}async function t6e(e,t,i){const r=typeof e=="string"?js(e):e,s=t[0].spatialReference,n=VE(t[0]),o=ye(F({},i),{query:ye(F({},r.query),{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(i6e(t))})});return r6e((await Zt(r.path+"/simplify",o)).data,n,s)}function i6e(e){return{geometryType:VE(e[0]),geometries:e.map(t=>t.toJSON())}}function r6e(e,t,i){const r=Jde(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}const Z0e=fe.getLogger("esri.geometry.support.normalizeUtils");function s6e(e){return e.type==="polygon"}function n6e(e){return e[0].type==="polygon"}function o6e(e){return e[0].type==="polyline"}function a6e(e,t){if(!(e instanceof Su||e instanceof Go)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw Z0e.error(s),new j(s)}const i=fM(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),f=(h-l)/p,m=(c-a)/p,y=p/t;if(y>1){for(let S=1;S<=y-1;S++){const T=S*t,E=m*T+a,C=f*T+l;n.push([E,C])}const v=(p+Math.floor(y-1)*t)/2,w=m*v+a,b=f*v+l;n.push([w,b])}n.push([c,h])}}return s6e(e)?new Go({rings:r,spatialReference:e.spatialReference}):new Su({paths:r,spatialReference:e.spatialReference})}function tie(e,t,i){if(t){const r=a6e(e,1e6);e=LA(r,!0)}return i&&(e=X0e(e,i)),e}function iie(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=Lb(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=Lb(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=Lb(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=Lb(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function l6e(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=fM(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let f=0;f<l.length;f++){const m=l[f][0];h=m>h?m:h}h=Number(h.toFixed(9));const p=-360*Lb(h,180);for(let f=0;f<l.length;f++){const m=n.getPoint(a,f);n.setPoint(a,f,m.clone().offset(p,0))}return!0}})}if(s===i){if(n6e(e))for(const a of fM(n))e[s]=e[s].addRing(a);else if(o6e(e))for(const a of fM(n))e[s]=e[s].addPath(a)}else i=s,e[s]=n}return e}async function Y0e(e,t,i){var E;if(!Array.isArray(e))return Y0e([e],t);t&&typeof t!="string"&&Z0e.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:(E=t==null?void 0:t.url)!=null?E:Fi.geometryServiceUrl;let s,n,o,a,l,c,h,p,f=0;const m=[],y=[];for(const C of e)if(R(C))y.push(C);else if(s||(s=C.spatialReference,n=$v(s),o=s.isWebMercator,c=o?102100:4326,a=_I[c].maxX,l=_I[c].minX,h=_I[c].plus180Line,p=_I[c].minus180Line),n)if(C.type==="mesh")y.push(C);else if(C.type==="point")y.push(iie(C.clone(),a,l));else if(C.type==="multipoint"){const A=C.clone();A.points=A.points.map(I=>iie(I,a,l)),y.push(A)}else if(C.type==="extent"){const A=C.clone()._normalize(!1,!1,n);y.push(A.rings?new Go(A):A)}else if(C.extent){const A=C.extent,I=Lb(A.xmin,l)*(2*a);let D=I===0?C.clone():X0e(C.clone(),I);A.offset(I,0),A.intersects(h)&&A.xmax!==a?(f=A.xmax>f?A.xmax:f,D=tie(D,o),m.push(D),y.push("cut")):A.intersects(p)&&A.xmin!==l?(f=A.xmax*(2*a)>f?A.xmax*(2*a):f,D=tie(D,o,360),m.push(D),y.push("cut")):y.push(D)}else y.push(C.clone());else y.push(C);let v=Lb(f,a),w=-90;const b=v,S=new Su;for(;v>0;){const C=360*v-180;S.addPath([[C,w],[C,-1*w]]),w*=-1,v--}if(m.length>0&&b>0){const C=l6e(m,await e6e(r,m,S,i)),A=[],I=[];for(let z=0;z<y.length;z++){const B=y[z];if(B!=="cut")I.push(B);else{const V=C.shift(),Q=e[z];_(Q)&&Q.type==="polygon"&&Q.rings&&Q.rings.length>1&&V.rings.length>=Q.rings.length?(A.push(V),I.push("simplify")):I.push(o?Dg(V):V)}}if(!A.length)return I;const D=await t6e(r,A,i),L=[];for(let z=0;z<I.length;z++){const B=I[z];B!=="simplify"?L.push(B):L.push(o?Dg(D.shift()):D.shift())}return L}const T=[];for(let C=0;C<y.length;C++){const A=y[C];if(A!=="cut")T.push(A);else{const I=m.shift();T.push(o===!0?Dg(I):I)}}return T}function Q0e(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=Q0e(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}var Z0;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(Z0||(Z0={}));const rie=4294967296,c6e=new TextDecoder("utf-8"),u6e=he("safari")||he("ios")?6:he("ff")?12:32;class iw{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=Z0.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}clone(){return new iw(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*rie;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*rie;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),o=t(n,i,r,s);return n.release(),o}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=iw.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){iw.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case Z0.varint:this._decodeVarint();break;case Z0.fixed64:this._skip(8);break;case Z0.delimited:this._skip(this._getLength());break;case Z0.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i,r=this._pos,s=0;if(this._end-r>=10)do{if(i=t[r++],s|=127&i,(128&i)==0||(i=t[r++],s|=(127&i)<<7,(128&i)==0)||(i=t[r++],s|=(127&i)<<14,(128&i)==0)||(i=t[r++],s|=(127&i)<<21,(128&i)==0)||(i=t[r++],s+=268435456*(127&i),(128&i)==0)||(i=t[r++],s+=34359738368*(127&i),(128&i)==0)||(i=t[r++],s+=4398046511104*(127&i),(128&i)==0)||(i=t[r++],s+=562949953421312*(127&i),(128&i)==0)||(i=t[r++],s+=72057594037927940*(127&i),(128&i)==0)||(i=t[r++],s+=9223372036854776e3*(127&i),(128&i)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(i=t[r],(128&i)!=0);)++r,s+=(127&i)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=i*n}return this._pos=r,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==Z0.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>u6e){const o=t.subarray(i,r);return c6e.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}iw.pool=new Cs(iw,null,e=>{e._data=null,e._dataView=null});class Rl{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}static fromRect(t){const[i,r,s,n]=t,o=s-i,a=n-r;return new Rl([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new Rl(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new Rl(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class rm{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new rm(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function h6e(e){return!(R(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class g2t extends rm{}class Lk{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new Lk;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const J0e=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class y2t{constructor(t){this.options=t,this.geometryTypes=J0e,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new Lk}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||Mc(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=G2(this.options.sourceSpatialReference)/G2(t.spatialReference);if(i!==1)for(const r of t.features){if(!h6e(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new rm}createSpatialReference(){return{wkid:0}}createGeometry(){return new Rl}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new Rl}}const sie=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],nie=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],oie=["upperLeft","lowerLeft"];function aie(e){return e>=sie.length?null:sie[e]}function d6e(e){return e>=nie.length?null:nie[e]}function lie(e){return e>=oie.length?null:oie[e]}function cie(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p6e(e,t,i){const s=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),o=e.pos()+n;let a=0;for(;e.pos()<o;)t.addCoordinatePoint(s,e.getSInt64(),a++);break}default:e.skip()}return s}function f6e(e,t,i){const n=t.createGeometry(i),o=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(;e.pos()<l;)t.addLength(n,e.getUInt32(),c++);break}case 3:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),c++,c===o&&(c=0);break}default:e.skip()}return n}function m6e(e){const s=new Rl;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.lengths.push(e.getUInt32());break}case 3:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.coords.push(e.getSInt64());break}case 1:n=J0e[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function g6e(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function y6e(e){const a={type:aie(0)};for(;e.next();)switch(e.tag()){case 1:a.name=e.getString();break;case 2:a.type=aie(e.getEnum());break;case 3:a.alias=e.getString();break;case 4:a.sqlType=d6e(e.getEnum());break;case 5:e.skip();break;case 6:a.defaultValue=e.getString();break;default:e.skip()}return a}function v6e(e){const r={};for(;e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.isSystemMaintained=e.getBool();break;default:e.skip()}return r}function _6e(e,t,i,r){const a=t.createFeature(i);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=r[l++].name;a.attributes[c]=e.processMessage(g6e);break}case 2:a.geometry=e.processMessageWithArgs(f6e,t,i);break;case 4:a.centroid=e.processMessageWithArgs(p6e,t,i);break;default:e.skip()}return a}function b6e(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function w6e(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function x6e(e){const s={originPosition:lie(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=lie(e.getEnum());break;case 2:s.scale=e.processMessage(b6e);break;case 3:s.translate=e.processMessage(w6e);break;default:e.skip()}return s}function T6e(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function S6e(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function E6e(e,t){const v=t.createFeatureResult();v.geometryType=cie(t,0);let w=!1;for(;e.next();)switch(e.tag()){case 1:v.objectIdFieldName=e.getString();break;case 3:v.globalIdFieldName=e.getString();break;case 4:v.geohashFieldName=e.getString();break;case 5:v.geometryProperties=e.processMessage(T6e);break;case 7:v.geometryType=cie(t,e.getEnum());break;case 8:v.spatialReference=e.processMessageWithArgs(S6e,t);break;case 10:v.hasZ=e.getBool();break;case 11:v.hasM=e.getBool();break;case 12:v.transform=e.processMessage(x6e);break;case 9:{const b=e.getBool();v.exceededTransferLimit=b;break}case 13:t.addField(v,e.processMessage(y6e));break;case 15:w||(t.prepareFeatures(v),w=!0),t.addFeature(v,e.processMessageWithArgs(_6e,t,v,v.fields));break;case 2:v.uniqueIdField=e.processMessage(v6e);break;default:e.skip()}return t.finishFeatureResult(v),v}function C6e(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(m6e);break;case 1:s.featureResult=e.processMessageWithArgs(E6e,t);break;default:e.skip()}return _(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function A6e(e,t){try{const r=new iw(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(C6e,t):r.skip();return s}catch(i){throw new j("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function R6e(e,t){const i=A6e(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function sj(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=Kme(i.geometryType,t,e.outSpatialReference);if(!R(r))for(const s of i.features)r(s.geometry)}const uie="Layer does not support extent calculation.";function K0e(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function eve(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(_(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=VE(i),s.geometry=K0e(i,e.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&_(o)&&_(e.quantizationParameters)&&_(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c==null?"null":c},${h==null?"null":h}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&_(o)&&_(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function tve(e,t,i,r){const s=_(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await KE(e,t,"json",r);return sj(t,i,s.data),s}async function M6e(e,t,i,r){if(_(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await ive(e,t,r),n=s;return n.data=R6e(s.data,i),n}function ive(e,t,i){return KE(e,t,"pbf",i)}function O6e(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):KE(e,t,"json",i,{returnIdsOnly:!0})}function P6e(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):KE(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function I6e(e,t,i){return _(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):KE(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(uie);if(s.hasOwnProperty("count"))throw new Error(uie);return r})}function KE(e,t,i,r={},s={}){const n=typeof e=="string"?js(e):e,o=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",Y0e(o,null,r).then(a=>{const l=a&&a[0];_(l)&&((t=t.clone()).geometry=l);const c=Q0e(F(F(ye(F({},n.query),{f:i}),s),eve(t,s)));return Zt(Ll(n.path,"query"),ye(F({},r),{query:F(F({},c),r.query)}))})}var v2t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",encodeGeometry:K0e,executeQuery:tve,executeQueryForCount:P6e,executeQueryForExtent:I6e,executeQueryForIds:O6e,executeQueryPBF:M6e,executeQueryPBFBuffer:ive,queryToQueryStringParameters:eve,runQuery:KE}),nj;const oj=new wi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Mo=nj=class extends ve{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const i=et.fromJSON(t.spatialReference),r=[];for(let n=0;n<e.length;n++){const o=e[n],a=Ha.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;_(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&_(h))for(const p in h){const f=h[p],m=(s=c[p])==null?void 0:s.spatialReference;_(f)&&!m&&(f.spatialReference=i)}r.push(a)}return r}writeGeometryType(e,t,i,r){if(e)return void oj.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&_(n.geometry))return void oj.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=Qg(e);return!i&&t.spatialReference&&(r.spatialReference=et.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&_(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new nj(this.cloneProperties())}cloneProperties(){return re({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=c=>Math.round((c-r)/t),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)_(h)&&c(h);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=t(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=qb(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,i);c&&n.push(c)}return n.length>0?(qb(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=qb(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const f=c[h];h>0?(n+=f[0],o+=f[1]):(n=f[0],o=f[1]),f[0]=t(n),f[1]=i(o)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=i(o)}}:void 0}};u([d({type:String,json:{write:!0}})],Mo.prototype,"displayFieldName",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mo.prototype,"exceededTransferLimit",void 0),u([d({type:[Ha],json:{write:!0}})],Mo.prototype,"features",void 0),u([Ie("features")],Mo.prototype,"readFeatures",null),u([d({type:[V3],json:{write:!0}})],Mo.prototype,"fields",void 0),u([d({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:oj.read}}})],Mo.prototype,"geometryType",void 0),u([qe("geometryType")],Mo.prototype,"writeGeometryType",null),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mo.prototype,"hasM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mo.prototype,"hasZ",void 0),u([d({types:Kw,json:{write:!0}})],Mo.prototype,"queryGeometry",void 0),u([Ie("queryGeometry")],Mo.prototype,"readQueryGeometry",null),u([d({type:et,json:{write:!0}})],Mo.prototype,"spatialReference",void 0),u([qe("spatialReference")],Mo.prototype,"writeSpatialReference",null),u([d({json:{write:!0}})],Mo.prototype,"transform",void 0),Mo=nj=u([P("esri.rest.support.FeatureSet")],Mo),Mo.prototype.toJSON.isDefaultToJSON=!0;const Dk=Mo;var _2t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Dk});const hie={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},$6e={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function L6e(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function rw(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=$6e[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=L6e(r.getFullYear(),r.getMonth()+t);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+t*a)}return r}function die(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function D6e(e,t,i){return e===0?0:e*hie[t]/hie[i]}var Md;let ou=Md=class extends ve{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return pie}static get empty(){return N6e}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(Md.allTime)}get isEmpty(){return this.equals(Md.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new Md({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=_(this.start)?this.start.getTime():this.start,i=_(this.end)?this.end.getTime():this.end,r=_(e.start)?e.start.getTime():e.start,s=_(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=rn(this.start,r=>die(r,e)),i=rn(this.end,r=>rw(die(r,e),1,e));return new Md({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return Md.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=gu(this.start,-1/0,a=>a.getTime()),i=gu(this.end,1/0,a=>a.getTime()),r=gu(e.start,-1/0,a=>a.getTime()),s=gu(e.end,1/0,a=>a.getTime());let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),!isNaN(n)&&!isNaN(o)){const a=new Md;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Md.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Md,{start:r,end:s}=this;return _(r)&&(i.start=rw(r,e,t)),_(s)&&(i.end=rw(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return pie.clone();const t=_(this.start)&&_(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=_(this.end)&&_(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new Md({start:t,end:i})}};u([d({type:Date,json:{write:{allowNull:!0}}})],ou.prototype,"end",void 0),u([Ie("end")],ou.prototype,"readEnd",null),u([qe("end")],ou.prototype,"writeEnd",null),u([d({readOnly:!0,json:{read:!1}})],ou.prototype,"isAllTime",null),u([d({readOnly:!0,json:{read:!1}})],ou.prototype,"isEmpty",null),u([d({type:Date,json:{write:{allowNull:!0}}})],ou.prototype,"start",void 0),u([Ie("start")],ou.prototype,"readStart",null),u([qe("start")],ou.prototype,"writeStart",null),ou=Md=u([P("esri.TimeExtent")],ou);const pie=new ou,N6e=new ou({start:void 0,end:void 0}),mm=ou;var aj;const fie=new wi({upperLeft:"upper-left",lowerLeft:"lower-left"});let $1=aj=class extends ve{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new aj(re({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([d({type:ai,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],$1.prototype,"extent",void 0),u([d({type:["view","edit"],json:{write:!0}})],$1.prototype,"mode",void 0),u([d({type:String,json:{read:fie.read,write:fie.write}})],$1.prototype,"originPosition",void 0),u([d({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],$1.prototype,"tolerance",void 0),$1=aj=u([P("esri.rest.support.QuantizationParameters")],$1);const F6e=$1;var lj;const mie=new wi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let Od=lj=class extends ve{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=re(e))}clone(){return new lj({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:re(this.statisticParameters)})}};u([d({type:Number,json:{write:!0}})],Od.prototype,"maxPointCount",void 0),u([d({type:Number,json:{write:!0}})],Od.prototype,"maxRecordCount",void 0),u([d({type:Number,json:{write:!0}})],Od.prototype,"maxVertexCount",void 0),u([d({type:String,json:{write:!0}})],Od.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],Od.prototype,"outStatisticFieldName",void 0),u([d({type:String,json:{read:{source:"statisticType",reader:mie.read},write:{target:"statisticType",writer:mie.write}}})],Od.prototype,"statisticType",void 0),u([d({type:Object})],Od.prototype,"statisticParameters",void 0),u([qe("statisticParameters")],Od.prototype,"writeStatisticParameters",null),Od=lj=u([P("esri.rest.support.StatisticDefinition")],Od);const rve=Od;var o2;const k6e=new wi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),U6e=new wi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Mt=o2=class extends ve{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return A2(o2,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new o2(re({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:_(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};Mt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([d({json:{write:!0}})],Mt.prototype,"aggregateIds",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"cacheHint",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"compactGeometryEnabled",void 0),u([d({json:{write:!0}})],Mt.prototype,"datumTransformation",void 0),u([qt("datumTransformation")],Mt.prototype,"castDatumTransformation",null),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"defaultSpatialReferenceEnabled",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],Mt.prototype,"distance",void 0),u([d({type:qd,json:{write:!0}})],Mt.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"formatOf3DObjects",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"gdbVersion",void 0),u([d({types:Kw,json:{read:Qg,write:!0}})],Mt.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],Mt.prototype,"geometryPrecision",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"groupByFieldsForStatistics",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"having",void 0),u([d({type:Date})],Mt.prototype,"historicMoment",void 0),u([qe("historicMoment")],Mt.prototype,"writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],Mt.prototype,"maxAllowableOffset",void 0),u([d({type:Number,cast:e=>e<1?1:e>o2.MAX_MAX_RECORD_COUNT_FACTOR?o2.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],Mt.prototype,"maxRecordCountFactor",void 0),u([d({type:["xyFootprint"],json:{write:!0}})],Mt.prototype,"multipatchOption",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],Mt.prototype,"num",void 0),u([d({json:{write:!0}})],Mt.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],Mt.prototype,"outFields",void 0),u([d({type:et,json:{name:"outSR",write:!0}})],Mt.prototype,"outSpatialReference",void 0),u([d({type:[rve],json:{write:{enabled:!0,overridePolicy(){return{enabled:_(this.outStatistics)&&this.outStatistics.length>0}}}}})],Mt.prototype,"outStatistics",void 0),u([d({json:{write:!0}})],Mt.prototype,"parameterValues",void 0),u([qe("parameterValues")],Mt.prototype,"writeParameterValues",null),u([d({type:ot,json:{write:!0}})],Mt.prototype,"pixelSize",void 0),u([d({type:F6e,json:{write:!0}})],Mt.prototype,"quantizationParameters",void 0),u([d({type:[Object],json:{write:!0}})],Mt.prototype,"rangeValues",void 0),u([d({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],Mt.prototype,"relationParameter",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"resultType",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnCentroid",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnDistinctValues",void 0),u([d({type:Boolean,json:{default:!0,write:!0}})],Mt.prototype,"returnExceededLimitFeatures",void 0),u([d({type:Boolean,json:{write:!0}})],Mt.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnQueryGeometry",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mt.prototype,"returnZ",void 0),u([d({type:et,json:{write:!0}})],Mt.prototype,"sourceSpatialReference",void 0),u([at(k6e,{ignoreUnknown:!1,name:"spatialRel"})],Mt.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],Mt.prototype,"start",void 0),u([qe("start"),qe("num")],Mt.prototype,"writeStart",null),u([d({type:String,json:{write:!0}})],Mt.prototype,"sqlFormat",void 0),u([d({type:String,json:{write:!0}})],Mt.prototype,"text",void 0),u([d({type:mm,json:{write:!0}})],Mt.prototype,"timeExtent",void 0),u([d({type:Boolean,json:{default:!1,write:!0}})],Mt.prototype,"timeReferenceUnknownClient",void 0),u([at(U6e,{ignoreUnknown:!1}),d({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],Mt.prototype,"units",void 0),u([d({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],Mt.prototype,"where",void 0),u([qe("where")],Mt.prototype,"writeWhere",null),Mt=o2=u([P("esri.rest.support.Query")],Mt);const Fh=Mt;async function $6(e,t,i){const r=await z6e(e,t,i);return Dk.fromJSON(r)}async function z6e(e,t,i){const r=W0e(e),s=F({},i),n=Fh.from(t),{data:o}=await tve(r,n,n.sourceSpatialReference,s);return o}function pa(e,t){return e?t?4:3:t?3:2}const B3=fe.getLogger("esri.layers.graphics.featureConversionUtils"),sve={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},nve=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},KF=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},V6e=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},ove=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function BZ(e,t,i,r){if(e){if(i)return t&&r?ove:KF;if(t&&r)return V6e}else if(t&&r)return KF;return nve}function L6({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function D6({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function gie({scale:e,translate:t},i){return i*e[0]+t[0]}function yie({scale:e,translate:t},i){return t[1]-i*e[1]}function b2t(e,t,i){return e?t?i?HZ(e):GZ(e):i?jZ(e):Nk(e):null}function Nk(e){const t=e.coords;return{x:t[0],y:t[1]}}function ave(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function GZ(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function B6e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function jZ(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function G6e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function HZ(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function j6e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function H6e(e,t,i,r){let s=Nk;i&&r?s=HZ:i?s=GZ:r&&(s=jZ);for(const n of t){const{geometry:o,attributes:a}=n,l=_(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function qZ(e,t){return e&&t?j6e:e?B6e:t?G6e:ave}function q6e(e,t,i,r,s){const n=qZ(i,r);for(const o of t){const{geometry:a,attributes:l}=o;let c;a&&(c=n(new Rl,a)),e.push(new rm(c,l,null,l[s]))}return e}function w2t(e,t,i=qZ(t.z!=null,t.m!=null)){return i(e,t)}function W6e(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;n&&(a=lve(n,i,r)),e.push({attributes:o,geometry:a})}return e}function lve(e,t,i){if(R(e))return null;const r=pa(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(e.coords[n+a]);s.push(o)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function X6e(e,t,i,r,s){const n=pa(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=cve(new Rl,a,n)),e.push(new rm(c,l,null,l[s]))}return e}function cve(e,t,i=pa(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let o=0;o<i;o++)r[s++]=n[o];return e}function Z6e(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;_(n)&&(a=uve(n,i,r)),e.push({attributes:o,geometry:a})}return e}function uve(e,t,i){if(!e)return null;const r=pa(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function Y6e(e,t,i,r,s){const n=pa(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=hve(new Rl,a,n)),e.push(new rm(c,l,null,l[s]))}return e}function hve(e,t,i=pa(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return e}function Q6e(e,t,i,r){for(const s of t){const{geometry:n,attributes:o,centroid:a}=s;let l;if(_(n)&&(l=dve(n,i,r)),_(a)){const c=Nk(a);e.push({attributes:o,centroid:c,geometry:l})}else e.push({attributes:o,geometry:l})}return e}function dve(e,t,i){if(!e)return null;const r=pa(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let f=0;f<r;f++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function J6e(e,t,i,r,s){for(const n of t){const o=n.geometry,a=n.centroid,l=n.attributes;let c;o&&(c=pve(new Rl,o,i,r)),_(a)?e.push(new rm(c,l,ave(new Rl,a),l[s])):e.push(new rm(c,l,null,l[s]))}return e}function pve(e,t,i=t.hasZ,r=t.hasM){return K6e(e,t.rings,i,r),e}function K6e(e,t,i,r){const s=pa(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const a2=[],mM=[];function x2t(e,t,i,r,s){a2[0]=e;const[n]=fve(mM,a2,t,i,r,s);return a2.length=mM.length=0,n}function fve(e,t,i,r,s,n){if(e.length=0,!i){for(const o of t){const a=o.attributes[n];e.push(new rm(null,o.attributes,null,a))}return e}switch(i){case"esriGeometryPoint":return q6e(e,t,r,s,n);case"esriGeometryMultipoint":return X6e(e,t,r,s,n);case"esriGeometryPolyline":return Y6e(e,t,r,s,n);case"esriGeometryPolygon":return J6e(e,t,r,s,n);default:B3.error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function T2t(e,t,i,r){mM[0]=e,mve(a2,mM,t,i,r);const s=a2[0];return a2.length=mM.length=0,s}function eVe(e,t,i){if(R(e))return null;const r=new Rl;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),VW(e)?qZ(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):qb(e)?pve(r,e,t,i):BW(e)?hve(r,e,pa(t,i)):zW(e)?cve(r,e,pa(t,i)):void B3.error("convertFromGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${e}'`))}function tVe(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(R(s))return null;switch(t){case"esriGeometryPoint":{let n=Nk;return i&&r?n=HZ:i?n=GZ:r&&(n=jZ),n(s)}case"esriGeometryMultipoint":return lve(s,i,r);case"esriGeometryPolyline":return uve(s,i,r);case"esriGeometryPolygon":return dve(s,i,r);default:return void B3.error("convertToGeometry:unknown-geometry",new j(`Unable to parse unknown geometry type '${t}'`))}}function iVe(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function mve(e,t,i,r,s){if(e.length=0,R(i))return iVe(e,t);switch(i){case"esriGeometryPoint":return H6e(e,t,r,s);case"esriGeometryMultipoint":return W6e(e,t,r,s);case"esriGeometryPolyline":return Z6e(e,t,r,s);case"esriGeometryPolygon":return Q6e(e,t,r,s);default:B3.error("convertToFeatureSet:unknown-geometry",new j(`Unable to parse unknown geometry type '${i}'`))}return e}function S2t(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:f}=e,m={features:mve([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:h,queryGeometry:tVe(p,f,!1,!1)};return r&&(m.transform=r),c&&(m.exceededTransferLimit=c),n&&(m.hasM=n),o&&(m.hasZ=o),m}function E2t(e,t){const i=new Lk,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(i.fields=p),i.geometryType=l,i.objectIdFieldName=o||t,i.spatialReference=a,i.objectIdFieldName?(n&&fve(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(B3.error(new j("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function C2t(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)_(n.geometry)&&_ie(n.geometry,n.geometry,r,s,t),_(n.centroid)&&_ie(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function A2t(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Rl,vie(l.geometry,a.geometry,s,n,i,e),a.centroid&&(l.centroid=new Rl,vie(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),r[o]=l}return t.transform=e,t}function vie(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),R(t)||!t.coords.length)return null;const l=sve[s],{coords:c,lengths:h}=t,p=pa(i,r),f=pa(i&&o,r&&a),m=BZ(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,L6(n,c[0]),D6(n,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y,v,w,b,S=0,T=0,E=T;for(const C of h){if(C<l)continue;let A=0;T=E,w=y=L6(n,c[S]),b=v=D6(n,c[S+1]),m(e.coords,c,T,S,w,b),A++,S+=p,T+=f;for(let I=1;I<C;I++,S+=p)w=L6(n,c[S]),b=D6(n,c[S+1]),w===y&&b===v||(m(e.coords,c,T,S,w-y,b-v),T+=f,A++,y=w,v=b);A>=l&&(e.lengths.push(A),E=T)}return e.coords.length=E,e.coords.length?e:null}function R2t(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=sve[s],{coords:c,lengths:h}=t,p=pa(i,r),f=pa(i&&o,r&&a),m=BZ(i,r,o,a);if(!h.length)return m(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let y=0;const v=n*n;for(const w of h){if(w<l){y+=w*p;continue}const b=e.coords.length/f,S=y,T=y+(w-1)*p;m(e.coords,c,e.coords.length,S,c[S],c[S+1]),cj(e.coords,c,p,v,m,S,T),m(e.coords,c,e.coords.length,T,c[T],c[T+1]);const E=e.coords.length/f-b;E>=l?e.lengths.push(E):e.coords.length=b*f,y+=w*p}return e.coords.length?e:null}function rVe(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let h=o,p=a,f=l-h,m=c-p;if(f!==0||m!==0){const y=((s-h)*f+(n-p)*m)/(f*f+m*m);y>1?(h=l,p=c):y>0&&(h+=f*y,p+=m*y)}return f=s-h,m=n-p,f*f+m*m}function cj(e,t,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=rVe(t,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&cj(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&cj(e,t,i,r,s,c,o))}function M2t(e,t,i,r){if(R(t)||!t.coords||!t.coords.length)return null;const s=pa(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],f=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function _ie(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?ove:KF:r?KF:nve,l=pa(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,gie(s,n[0]),yie(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let p=0;for(let f=0;f<o.length;f++){const m=o[f];e.lengths[f]=m;let y=gie(s,n[p]),v=yie(s,n[p+1]);a(e.coords,n,p,p,y,v),p+=l;for(let w=1;w<m;w++,p+=l)y+=n[p]*c,v-=n[p+1]*h,a(e.coords,n,p,p,y,v)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function O2t(e,t,i,r,s,n){const o=pa(i,r),a=BZ(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function sVe(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const l=n+e[r*(t+a)],c=o+e[r*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function P2t(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++)n+=sVe(i,s,r[o],t),s+=o;return Math.abs(n)}function I2t(e,t){if(R(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[t*n],c=r[t*n+1];for(let h=1;h<a;h++){const p=l+r[t*(n+h)],f=c+r[t*(n+h)+1];i.coords[t*(n+h)]=p,i.coords[t*(n+h)+1]=f,l=p,c=f}n+=a}return i}var uj;let bs=uj=class extends ve{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new uj(re({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([d({type:Boolean,json:{write:!0}})],bs.prototype,"cacheHint",void 0),u([d({type:qd,json:{write:!0}})],bs.prototype,"dynamicDataSource",void 0),u([d({type:String,json:{write:!0}})],bs.prototype,"gdbVersion",void 0),u([d({type:Number,json:{write:!0}})],bs.prototype,"geometryPrecision",void 0),u([d({type:Date})],bs.prototype,"historicMoment",void 0),u([qe("historicMoment")],bs.prototype,"_writeHistoricMoment",null),u([d({type:Number,json:{write:!0}})],bs.prototype,"maxAllowableOffset",void 0),u([d({type:[Number],json:{write:!0}})],bs.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],bs.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],bs.prototype,"outFields",void 0),u([d({type:et,json:{read:{source:"outSR"},write:{target:"outSR"}}})],bs.prototype,"outSpatialReference",void 0),u([d({json:{write:!0}})],bs.prototype,"relationshipId",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],bs.prototype,"start",void 0),u([qe("start"),qe("num")],bs.prototype,"writeStart",null),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],bs.prototype,"num",void 0),u([d({json:{write:!0}})],bs.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],bs.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],bs.prototype,"returnZ",void 0),u([d({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],bs.prototype,"where",void 0),bs=uj=u([P("esri.rest.support.RelationshipQuery")],bs),bs.from=Bs(bs);const hj=bs;var dj;let UT=dj=class extends ve{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new dj({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([d({type:[String],json:{write:!0}})],UT.prototype,"groupByFields",void 0),u([d({type:Number,json:{write:!0}})],UT.prototype,"topCount",void 0),u([d({type:[String],json:{write:!0}})],UT.prototype,"orderByFields",void 0),UT=dj=u([P("esri.rest.support.TopFilter")],UT);const nVe=UT;var pj;const bie=new wi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),wie=new wi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ts=pj=class extends ve{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new pj(re({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([d({type:Boolean,json:{write:!0}})],ts.prototype,"cacheHint",void 0),u([d({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],ts.prototype,"distance",void 0),u([d({types:Kw,json:{read:Qg,write:!0}})],ts.prototype,"geometry",void 0),u([d({type:Number,json:{write:!0}})],ts.prototype,"geometryPrecision",void 0),u([d({type:Number,json:{write:!0}})],ts.prototype,"maxAllowableOffset",void 0),u([d({type:Number,json:{read:{source:"resultRecordCount"}}})],ts.prototype,"num",void 0),u([d({json:{write:!0}})],ts.prototype,"objectIds",void 0),u([d({type:[String],json:{write:!0}})],ts.prototype,"orderByFields",void 0),u([d({type:[String],json:{write:!0}})],ts.prototype,"outFields",void 0),u([d({type:et,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ts.prototype,"outSpatialReference",void 0),u([d({type:String,json:{write:!0}})],ts.prototype,"resultType",void 0),u([d({json:{write:!0}})],ts.prototype,"returnGeometry",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ts.prototype,"returnM",void 0),u([d({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ts.prototype,"returnZ",void 0),u([d({type:Number,json:{read:{source:"resultOffset"}}})],ts.prototype,"start",void 0),u([qe("start"),qe("num")],ts.prototype,"writeStart",null),u([d({type:String,json:{read:{source:"spatialRel",reader:bie.read},write:{target:"spatialRel",writer:bie.write}}})],ts.prototype,"spatialRelationship",void 0),u([d({type:mm,json:{write:!0}})],ts.prototype,"timeExtent",void 0),u([d({type:nVe,json:{write:!0}})],ts.prototype,"topFilter",void 0),u([d({type:String,json:{read:wie.read,write:{writer:wie.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],ts.prototype,"units",void 0),u([d({type:String,json:{write:!0}})],ts.prototype,"where",void 0),ts=pj=u([P("esri.rest.support.TopFeaturesQuery")],ts),ts.from=Bs(ts);const bI=ts,oVe="esri.widgets.Feature.support.relatedFeatureUtils",xie=fe.getLogger(oVe),Tie=new Map;function fj(e){if(!Rg(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function aVe(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function lVe({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===e.id&&(r=s),!!r)),r}function cVe(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function uVe(e,t){const i=aVe(e,t);if(!!i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function hVe(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function dVe(e,t,i,r){const s=new hj;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}function pVe(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function fVe(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t,p=lVe({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const m=(await dVe(e,p,i,r))[e.attributes[i.objectIdField]];if(!m)return null;const y=m.features.map(v=>v.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const v=new Fh;v.where=pVe(n.objectIdField,y,1e3),v.outFields=a,v.outStatistics=l,v.sourceSpatialReference=h;const w={features:Promise.resolve(m),statsFeatures:$6(c,v)};return gs(w)}}const f=p==null?void 0:p.keyField;if(f){const m=D5(_Ve(n.fields,f)),y=cVe(e.attributes,o.keyField),v=m?`${f}=${y}`:`${f}='${y}'`,w=$6(c,new Fh({where:v,outFields:t.relatedFields,sourceSpatialReference:h}),r),b=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?$6(c,new Fh({where:v,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),r):null,S={features:w};return b&&(S.statsFeatures=b),gs(S)}return null}function mVe(e,t){return Zt(e,{query:{f:"json"},signal:t&&t.signal})}function gVe({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new j("relation-required","A relation is required on a layer to retrieve related records.");throw xie.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new j("A related table ID is required on a layer to retrieve related records.");throw xie.error(p),p}const l=`${t.url}/${a}`,c=Tie.get(l),h=c||mVe(l,i);c||Tie.set(l,h),r[n]=h}),gs(r)}function yVe({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=fVe(e,n,i,r))}),gs(s)}function vVe({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new rve({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}function _Ve(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const Sie={chartAnimation:!0};let Kn=class extends Se{constructor(e){super(e),this.abilities=F({},Sie),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return F(F({},Sie),e)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=$b({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.title}),a.caption=$b({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.caption}),a.altText=$b({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:i,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:i,layer:n}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const a=z7(o,s);i.sourceURL=U7({formattedAttributes:r,template:a,fieldInfoMap:t})}if(n){const a=z7(n,s);i.linkURL=U7({formattedAttributes:r,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=$ke(l,n),c&&(t.normalizeField=jF(c,n)),!l.some(p=>!!(r[p]!=null||Rg(p)&&a.size)))return;const h=o==null?void 0:o.fieldInfos;l.forEach(p=>{if(Rg(p))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:p,formattedAttributes:r,chartType:s,value:t})]);const f=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:p,fieldInfos:h});t.series.push(f)})}_getRelatedChartInfos(e){var y;const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n}=e,o=[],a=fj(i),{layerId:l,fieldName:c}=a,h=(y=this.relatedInfos)==null?void 0:y.get(l.toString());if(!h)return o;const{relatedFeatures:p,relation:f}=h;if(!f||!p)return o;const{cardinality:m}=f;return p.forEach(v=>{const{attributes:w}=v;w&&Object.keys(w).forEach(b=>{b===c&&o.push(this._getChartOption({value:n,attributes:w,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:b,fieldInfos:t}))})}),m==="one-to-many"||m==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var T,E,C,A,I,D;const{value:t,attributes:i,formattedAttributes:r,fieldName:s,relatedFieldName:n,fieldInfos:o,chartType:a}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:h,tooltipField:p}=t,f=h?Rg(h)?i[fj(h).fieldName]:i[h]:null,m=n&&i[n]!==void 0?i[n]:i[s]!==void 0?i[s]:r[s],y=new Jfe({fieldName:s,value:m===void 0?null:m&&f?m/f:m});if(Rg(s)){const L=c.get(s.toLowerCase()),z=c.get(p.toLowerCase()),B=(T=L==null?void 0:L.fieldName)!=null?T:s,V=(I=(A=(C=r[(E=z==null?void 0:z.fieldName)!=null?E:p])!=null?C:L==null?void 0:L.label)!=null?A:L==null?void 0:L.fieldName)!=null?I:n,Q=r[B];return y.tooltip=this._getTooltip({label:V,value:Q,chartType:a}),y}const v=f0e(o,s),w=jF(s,l),b=p&&r[p]!==void 0?r[p]:d0e(v||new L3({fieldName:w}),(D=this.popupTemplate)==null?void 0:D.expressionInfos),S=r[w];return y.tooltip=this._getTooltip({label:b,value:S,chartType:a}),y}};u([d()],Kn.prototype,"abilities",void 0),u([qt("abilities")],Kn.prototype,"castAbilities",null),u([d()],Kn.prototype,"activeMediaInfoIndex",void 0),u([d({readOnly:!0})],Kn.prototype,"activeMediaInfo",null),u([d()],Kn.prototype,"attributes",void 0),u([d()],Kn.prototype,"description",void 0),u([d()],Kn.prototype,"fieldInfoMap",void 0),u([d()],Kn.prototype,"formattedAttributes",void 0),u([d()],Kn.prototype,"expressionAttributes",void 0),u([d({readOnly:!0})],Kn.prototype,"formattedMediaInfos",null),u([d()],Kn.prototype,"layer",void 0),u([d({readOnly:!0})],Kn.prototype,"formattedMediaInfoCount",null),u([d()],Kn.prototype,"mediaInfos",void 0),u([d()],Kn.prototype,"popupTemplate",void 0),u([d()],Kn.prototype,"relatedInfos",void 0),u([d()],Kn.prototype,"title",void 0),Kn=u([P("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Kn);const Db=Kn;var Eie=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],bVe=[].concat(Eie.slice(30,39),Eie.slice(28,30).reverse()),wVe=[{name:"default",colors:bVe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const Cie="en-us",WZ=new Map([["ar",()=>import("./ar.e1b88440.js").then(e=>e.a)],["bg-bg",()=>import("./bg_BG.a6b4daaf.js").then(e=>e.b)],["bs-ba",()=>import("./bs_BA.21a31830.js").then(e=>e.b)],["ca-es",()=>import("./ca_ES.e8d00188.js").then(e=>e.c)],["cs-cz",()=>import("./cs_CZ.80d7545a.js").then(e=>e.c)],["da-dk",()=>import("./da_DK.a6e41cbf.js").then(e=>e.d)],["de-de",()=>import("./de_DE.0301e850.js").then(e=>e.d)],["de-ch",()=>import("./de_CH.d707acdd.js").then(e=>e.d)],["el-gr",()=>import("./el_GR.822d7540.js").then(e=>e.e)],["en-us",()=>import("./en_US.ec8e3f9f.js").then(e=>e.e)],["en-ca",()=>import("./en_CA.998b83cf.js").then(e=>e.e)],["es-es",()=>import("./es_ES.4175d6f0.js").then(e=>e.e)],["et-ee",()=>import("./et_EE.b68730a4.js").then(e=>e.e)],["fi-fi",()=>import("./fi_FI.0f3d47e1.js").then(e=>e.f)],["fr-fr",()=>import("./fr_FR.da1caa97.js").then(e=>e.f)],["he-il",()=>import("./he_IL.5ad226ac.js").then(e=>e.h)],["hr-hr",()=>import("./hr_HR.937dba66.js").then(e=>e.h)],["hu-hu",()=>import("./hu_HU.41429451.js").then(e=>e.h)],["id-id",()=>import("./id_ID.416e50f6.js").then(e=>e.i)],["it-it",()=>import("./it_IT.d20d55ea.js").then(e=>e.i)],["ja-jp",()=>import("./ja_JP.0c8914f9.js").then(e=>e.j)],["ko-kr",()=>import("./ko_KR.af58c977.js").then(e=>e.k)],["lt-lt",()=>import("./lt_LT.1ea999d1.js").then(e=>e.l)],["lv-lv",()=>import("./lv_LV.2c2e7d87.js").then(e=>e.l)],["nb-no",()=>import("./nb_NO.c8797760.js").then(e=>e.n)],["nl-nl",()=>import("./nl_NL.c90f71f5.js").then(e=>e.n)],["pl-pl",()=>import("./pl_PL.b12f7eea.js").then(e=>e.p)],["pt-br",()=>import("./pt_BR.6eaf92c9.js").then(e=>e.p)],["pt-pt",()=>import("./pt_PT.c367f9fb.js").then(e=>e.p)],["ro-ro",()=>import("./ro_RO.ed7e3c5f.js").then(e=>e.r)],["ru-ru",()=>import("./ru_RU.87afb136.js").then(e=>e.r)],["sk-sk",()=>import("./sk_SK.5309b9d9.js").then(e=>e.s)],["sl-sl",()=>import("./sl_SL.169f1abe.js").then(e=>e.s)],["sr-rs",()=>import("./sr_RS.8bf42647.js").then(e=>e.s)],["sv-se",()=>import("./sv_SE.0e89d1fa.js").then(e=>e.s)],["th-th",()=>import("./th_TH.550e4219.js").then(e=>e.t)],["tr-tr",()=>import("./tr_TR.e0aa06d5.js").then(e=>e.t)],["uk-ua",()=>import("./uk_UA.982f6e11.js").then(e=>e.u)],["vi-vn",()=>import("./vi_VN.7ab2174d.js").then(e=>e.v)],["zh-cn",()=>import("./zh_Hans.00bd1923.js").then(e=>e.z)],["zh-hk",()=>import("./zh_Hant.1dc713ba.js").then(e=>e.z)],["zh-tw",()=>import("./zh_Hant.1dc713ba.js").then(e=>e.z)]]);function xVe(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of WZ.keys())if(r.startsWith(t)){i=r;break}return i}function TVe(e){return e?WZ.has(e.toLowerCase())?e.toLowerCase():xVe(e)||Cie:Cie}let xx,PC;async function SVe(e=Mu()){if(e=TVe(e),xx&&e===PC)return xx;xx=import("./index.48a5ae46.js").then(t=>t.i),PC=e;try{const[t,i]=await Promise.all([xx,WZ.get(PC)()]);PC===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return xx=null,PC=null,null}return xx}function EVe(e,t="default"){const i=wVe.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const Ms={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},N6=.05,F6=.95,k6=15,Em="color",Iy="tooltip",IC="value",Aie="default-line-value";let Yl=class extends Wn{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Db,this.messages=null,this._getChartDependencies=async i=>{const r=await SVe(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(r);this._renderChart({chartDiv:i,mediaInfo:o,chartsModule:r,colorMap:a})}}initialize(){this._featureElementInfo=new OZ,this.own([ie(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),Rt),ie(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),Rt)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return k("div",{bind:this,class:Ms.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?k("div",{key:"media-element-container",class:Ms.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=u0e(h)?"_blank":"_self",f=p==="_blank"?"noreferrer":"",m=n?t:null,y=m?m.timestamp:0,v=m?m.sourceURL:c,w=k("img",{alt:o||a,key:`media-${l}-${i}-${r}-${y}`,src:v});return(h?k("a",{title:a,href:h,rel:f,target:p},w):null)||w}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return k("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:Ms.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?k("div",{key:"media-title",class:Ms.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?k("div",{key:"media-caption",class:Ms.mediaItemCaption,innerHTML:e.caption}):null;return k("div",{key:"media-container",class:Ms.mediaItemContainer},k("div",{key:"media-item-container",class:Ms.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(Ms.mediaButton,Ms.mediaPrevious):this.classes(Ms.mediaButton,Ms.mediaNext),s=t?this.classes(Ms.mediaIcon,Ms.mediaPreviousIconLTR,Ms.iconLeftTriangleArrow):this.classes(Ms.mediaIcon,Ms.mediaNextIconLTR,Ms.iconRightTriangleArrow),n=t?this.classes(Ms.mediaIcon,Ms.mediaPreviousIconRTL,Ms.iconRightTriangleArrow):this.classes(Ms.mediaIcon,Ms.mediaNextIconRTL,Ms.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return k("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},k("span",{"aria-hidden":"true",class:s}),k("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var n;const{am4core:t}=e,i=(n=this.viewModel)==null?void 0:n.layer,r=new Map;if(!i)return r;const s=await qze(i.renderer);return s.delete(null),Array.from(s.values()).every(o=>(o==null?void 0:o.length)===1)&&(r.set(Aie,t.color({r:50,g:50,b:50,a:1})),Array.from(s.keys()).forEach(o=>{o&&r.set(o,t.color(s.get(o)[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=cb(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=i,c=EVe(l);function h(m){m instanceof l.ColorSet&&c&&(m.list=c)}PZ()&&l.useTheme(i.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme(h);const f=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),f.data=o.series.map(m=>({[Iy]:m.tooltip,[IC]:m.value,[Em]:n.get(m.fieldName)})).filter(m=>a!=="pie-chart"||m.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=cp(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=IC,o.dataFields.category=Iy,this._customizeChartTooltip(o.tooltip,r),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",o.slices.template.propertyFields.fill=Em,o.slices.template.propertyFields.stroke=Em,n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=Iy,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=N6,l.renderer.maxLabelPosition=F6,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueY=IC,h.dataFields.categoryX=Iy,h.columns.template.propertyFields.fill=Em,h.columns.template.propertyFields.stroke=Em,e.cursor=new o.XYCursor,s.series.length>k6&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=Iy,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=N6,l.renderer.maxLabelPosition=F6,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueX=IC,h.dataFields.categoryY=Iy,h.columns.template.propertyFields.fill=Em,h.columns.template.propertyFields.stroke=Em,e.cursor=new o.XYCursor,s.series.length>k6&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r,colorMap:s}=t,{value:n}=r,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=Iy,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new a.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=N6,c.renderer.maxLabelPosition=F6,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),h.wrap=!0;const p=e.series.push(new a.LineSeries);p.dataFields.categoryX=Iy,p.dataFields.valueY=IC,p.strokeWidth=1;const f=s.get(Aie);f&&(p.stroke=f);const m=p.bullets.push(new a.CircleBullet);m.propertyFields.fill=Em,m.propertyFields.stroke=Em,e.cursor=new a.XYCursor,n.series.length>k6&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=cp(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};u([Xe("viewModel.attributes")],Yl.prototype,"attributes",void 0),u([Xe("viewModel.activeMediaInfoIndex")],Yl.prototype,"activeMediaInfoIndex",void 0),u([Xe("viewModel.description")],Yl.prototype,"description",void 0),u([Xe("viewModel.fieldInfoMap")],Yl.prototype,"fieldInfoMap",void 0),u([Xe("viewModel.layer")],Yl.prototype,"layer",void 0),u([Xe("viewModel.mediaInfos")],Yl.prototype,"mediaInfos",void 0),u([Xe("viewModel.popupTemplate")],Yl.prototype,"popupTemplate",void 0),u([Xe("viewModel.relatedInfos")],Yl.prototype,"relatedInfos",void 0),u([Xe("viewModel.title")],Yl.prototype,"title",void 0),u([d({type:Db})],Yl.prototype,"viewModel",void 0),u([d(),dn("esri/widgets/Feature/t9n/Feature")],Yl.prototype,"messages",void 0),Yl=u([P("esri.widgets.Feature.FeatureMedia")],Yl);const gve=Yl;class CVe{constructor(t,i){this.definition=null,this.context=null,this.definition=t,this.context=i}}class gm{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let i=0;i<this.length();i++)t.push(this.get(i));return t}}class ux extends gm{constructor(t,i,r,s,n,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=i,this._hasZ=r,this._hasM=s,this._cacheId=n,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const i=this._elements[t];if(i===void 0)return;const r=this._hasZ,s=this._hasM;let n=null;n=r&&!s?new ot(i[0],i[1],i[2],void 0,this._spRef):s&&!r?new ot(i[0],i[1],void 0,i[2],this._spRef):r&&s?new ot(i[0],i[1],i[2],i[3],this._spRef):new ot(i[0],i[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof ux&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class XZ extends gm{constructor(t,i,r,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=i,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const i=this._elements[t];if(i===void 0)return;this._lazyPath[t]=new ux(i,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof XZ&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class hx extends Error{}class AVe extends hx{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class RVe extends hx{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class MVe extends hx{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class mR extends hx{}class yve extends hx{constructor(t){super(`Invalid unit ${t}`)}}class Oh extends hx{}class $y extends hx{constructor(){super("Zone is an abstract class")}}const Ye="numeric",Cp="short",Pu="long",mj={year:Ye,month:Ye,day:Ye},vve={year:Ye,month:Cp,day:Ye},OVe={year:Ye,month:Cp,day:Ye,weekday:Cp},_ve={year:Ye,month:Pu,day:Ye},bve={year:Ye,month:Pu,day:Ye,weekday:Pu},wve={hour:Ye,minute:Ye},xve={hour:Ye,minute:Ye,second:Ye},Tve={hour:Ye,minute:Ye,second:Ye,timeZoneName:Cp},Sve={hour:Ye,minute:Ye,second:Ye,timeZoneName:Pu},Eve={hour:Ye,minute:Ye,hourCycle:"h23"},Cve={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23"},Ave={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:Cp},Rve={hour:Ye,minute:Ye,second:Ye,hourCycle:"h23",timeZoneName:Pu},Mve={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye},Ove={year:Ye,month:Ye,day:Ye,hour:Ye,minute:Ye,second:Ye},Pve={year:Ye,month:Cp,day:Ye,hour:Ye,minute:Ye},Ive={year:Ye,month:Cp,day:Ye,hour:Ye,minute:Ye,second:Ye},PVe={year:Ye,month:Cp,day:Ye,weekday:Cp,hour:Ye,minute:Ye},$ve={year:Ye,month:Pu,day:Ye,hour:Ye,minute:Ye,timeZoneName:Cp},Lve={year:Ye,month:Pu,day:Ye,hour:Ye,minute:Ye,second:Ye,timeZoneName:Cp},Dve={year:Ye,month:Pu,day:Ye,weekday:Pu,hour:Ye,minute:Ye,timeZoneName:Pu},Nve={year:Ye,month:Pu,day:Ye,weekday:Pu,hour:Ye,minute:Ye,second:Ye,timeZoneName:Pu};function Qi(e){return typeof e=="undefined"}function sw(e){return typeof e=="number"}function Fk(e){return typeof e=="number"&&e%1===0}function IVe(e){return typeof e=="string"}function $Ve(e){return Object.prototype.toString.call(e)==="[object Date]"}function Fve(){try{return typeof Intl!="undefined"&&!!Intl.RelativeTimeFormat}catch{return!1}}function LVe(e){return Array.isArray(e)?e:[e]}function Rie(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function DVe(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function tE(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Mg(e,t,i){return Fk(e)&&e>=t&&e<=i}function NVe(e,t){return e-t*Math.floor(e/t)}function Un(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function Y0(e){if(!(Qi(e)||e===null||e===""))return parseInt(e,10)}function P_(e){if(!(Qi(e)||e===null||e===""))return parseFloat(e)}function ZZ(e){if(!(Qi(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function YZ(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function G3(e){return e%4===0&&(e%100!==0||e%400===0)}function gM(e){return G3(e)?366:365}function e4(e,t){const i=NVe(t-1,12)+1,r=e+(t-i)/12;return i===2?G3(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function QZ(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function t4(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function gj(e){return e>99?e:e>60?1900+e:2e3+e}function kve(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o=F({timeZoneName:t},n),a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function kk(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function Uve(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new Oh(`Invalid unit value ${e}`);return t}function i4(e,t){const i={};for(const r in e)if(tE(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=Uve(s)}return i}function yM(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${Un(i,2)}:${Un(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${Un(i,2)}${Un(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function Uk(e){return DVe(e,["hour","minute","second","millisecond"])}const zve=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,FVe=["January","February","March","April","May","June","July","August","September","October","November","December"],Vve=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],kVe=["J","F","M","A","M","J","J","A","S","O","N","D"];function Bve(e){switch(e){case"narrow":return[...kVe];case"short":return[...Vve];case"long":return[...FVe];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const Gve=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],jve=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],UVe=["M","T","W","T","F","S","S"];function Hve(e){switch(e){case"narrow":return[...UVe];case"short":return[...jve];case"long":return[...Gve];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const qve=["AM","PM"],zVe=["Before Christ","Anno Domini"],VVe=["BC","AD"],BVe=["B","A"];function Wve(e){switch(e){case"narrow":return[...BVe];case"short":return[...VVe];case"long":return[...zVe];default:return null}}function GVe(e){return qve[e.hour<12?0:1]}function jVe(e,t){return Hve(t)[e.weekday-1]}function HVe(e,t){return Bve(t)[e.month-1]}function qVe(e,t){return Wve(t)[e.year<0?0:1]}function WVe(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Mie(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const XVe={D:mj,DD:vve,DDD:_ve,DDDD:bve,t:wve,tt:xve,ttt:Tve,tttt:Sve,T:Eve,TT:Cve,TTT:Ave,TTTT:Rve,f:Mve,ff:Pve,fff:$ve,ffff:Dve,F:Ove,FF:Ive,FFF:Lve,FFFF:Nve};class yc{static create(t,i={}){return new yc(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return XVe[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).formatToParts()}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,F(F({},this.opts),i)).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return Un(t,i);const r=F({},this.opts);return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(m,y)=>this.loc.extract(t,m,y),o=m=>t.isOffsetFixed&&t.offset===0&&m.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,m.format):"",a=()=>r?GVe(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,y)=>r?HVe(t,m):n(y?{month:m}:{month:m,day:"numeric"},"month"),c=(m,y)=>r?jVe(t,m):n(y?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),h=m=>{const y=yc.macroTokenToFormatOpts(m);return y?this.formatWithSystemDefault(t,y):m},p=m=>r?qVe(t,m):n({era:m},"era"),f=m=>{switch(m){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(m)}};return Mie(yc.parseFormat(i),f)}formatDurationFromString(t,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=yc.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(r).filter(l=>l));return Mie(n,s(a))}}class up{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class j3{get type(){throw new $y}get name(){throw new $y}get ianaName(){return this.name}get isUniversal(){throw new $y}offsetName(t,i){throw new $y}formatOffset(t,i){throw new $y}offset(t){throw new $y}equals(t){throw new $y}get isValid(){throw new $y}}let U6=null;class JZ extends j3{static get instance(){return U6===null&&(U6=new JZ),U6}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return kve(t,i,r)}formatOffset(t,i){return yM(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let MD={};function ZVe(e){return MD[e]||(MD[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),MD[e]}const YVe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function QVe(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function JVe(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=YVe[n];n==="era"?r[a]=o:Qi(a)||(r[a]=parseInt(o,10))}return r}let wI={};class iy extends j3{static create(t){return wI[t]||(wI[t]=new iy(t)),wI[t]}static resetCache(){wI={},MD={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super();this.zoneName=t,this.valid=iy.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return kve(t,i,r,this.name)}formatOffset(t,i){return yM(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=ZVe(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?JVe(r,i):QVe(r,i);a==="BC"&&(s=-Math.abs(s)+1);const f=QZ({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let m=+i;const y=m%1e3;return m-=y>=0?y:1e3+y,(f-m)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let z6=null;class Sl extends j3{static get utcInstance(){return z6===null&&(z6=new Sl(0)),z6}static instance(t){return t===0?Sl.utcInstance:new Sl(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Sl(kk(i[1],i[2]))}return null}constructor(t){super();this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${yM(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${yM(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return yM(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class KVe extends j3{constructor(t){super();this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function nv(e,t){if(Qi(e)||e===null)return t;if(e instanceof j3)return e;if(IVe(e)){const i=e.toLowerCase();return i==="local"||i==="system"?t:i==="utc"||i==="gmt"?Sl.utcInstance:Sl.parseSpecifier(i)||iy.create(e)}else return sw(e)?Sl.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new KVe(e)}let Oie=()=>Date.now(),Pie="system",Iie=null,$ie=null,Lie=null,Die;class lo{static get now(){return Oie}static set now(t){Oie=t}static set defaultZone(t){Pie=t}static get defaultZone(){return nv(Pie,JZ.instance)}static get defaultLocale(){return Iie}static set defaultLocale(t){Iie=t}static get defaultNumberingSystem(){return $ie}static set defaultNumberingSystem(t){$ie=t}static get defaultOutputCalendar(){return Lie}static set defaultOutputCalendar(t){Lie=t}static get throwOnInvalid(){return Die}static set throwOnInvalid(t){Die=t}static resetCaches(){Fs.resetCache(),iy.resetCache()}}let Nie={};function eBe(e,t={}){const i=JSON.stringify([e,t]);let r=Nie[i];return r||(r=new Intl.ListFormat(e,t),Nie[i]=r),r}let yj={};function vj(e,t={}){const i=JSON.stringify([e,t]);let r=yj[i];return r||(r=new Intl.DateTimeFormat(e,t),yj[i]=r),r}let _j={};function tBe(e,t={}){const i=JSON.stringify([e,t]);let r=_j[i];return r||(r=new Intl.NumberFormat(e,t),_j[i]=r),r}let bj={};function iBe(e,t={}){const o=t,{base:i}=o,r=NP(o,["base"]),s=JSON.stringify([e,r]);let n=bj[s];return n||(n=new Intl.RelativeTimeFormat(e,t),bj[s]=n),n}let gR=null;function rBe(){return gR||(gR=new Intl.DateTimeFormat().resolvedOptions().locale,gR)}function sBe(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let i;const r=e.substring(0,t);try{i=vj(e).resolvedOptions()}catch{i=vj(r).resolvedOptions()}const{numberingSystem:s,calendar:n}=i;return[r,s,n]}}function nBe(e,t,i){return(i||t)&&(e+="-u",i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function oBe(e){const t=[];for(let i=1;i<=12;i++){const r=ii.utc(2016,i,1);t.push(e(r))}return t}function aBe(e){const t=[];for(let i=1;i<=7;i++){const r=ii.utc(2016,11,13+i);t.push(e(r))}return t}function xI(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function lBe(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class cBe{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const a=r,{padTo:s,floor:n}=a,o=NP(a,["padTo","floor"]);if(!i||Object.keys(o).length>0){const l=F({useGrouping:!1},r);r.padTo>0&&(l.minimumIntegerDigits=r.padTo),this.inf=tBe(t,l)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):YZ(t,3);return Un(i,this.padTo)}}}class uBe{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&iy.create(a).valid?(s=a,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:ii.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n=F({},this.opts);s&&(n.timeZone=s),this.dtf=vj(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class hBe{constructor(t,i,r){this.opts=F({style:"long"},r),!i&&Fve()&&(this.rtf=iBe(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):WVe(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class Fs{static fromOpts(t){return Fs.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||lo.defaultLocale,o=n||(s?"en-US":rBe()),a=i||lo.defaultNumberingSystem,l=r||lo.defaultOutputCalendar;return new Fs(o,a,l,n)}static resetCache(){gR=null,yj={},_j={},bj={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return Fs.create(t,i,r)}constructor(t,i,r,s){const[n,o,a]=sBe(t);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=nBe(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=lBe(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:Fs.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone(ye(F({},t),{defaultToEN:!0}))}redefaultToSystem(t={}){return this.clone(ye(F({},t),{defaultToEN:!1}))}months(t,i=!1,r=!0){return xI(this,t,r,Bve,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=oBe(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return xI(this,t,r,Hve,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=aBe(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return xI(this,void 0,t,()=>qve,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[ii.utc(2016,11,13,9),ii.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return xI(this,t,i,Wve,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[ii.utc(-40,1,1),ii.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(t={}){return new cBe(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new uBe(t,this.intl,i)}relFormatter(t={}){return new hBe(this.intl,this.isEnglish(),t)}listFormatter(t={}){return eBe(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function eC(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function tC(...e){return t=>e.reduce(([i,r,s],n)=>{const[o,a,l]=n(t,s);return[F(F({},i),o),a||r,l]},[{},null,1]).slice(0,2)}function iC(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function Xve(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=Y0(t[i+s]);return[r,null,i+s]}}const Zve=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,dBe=`(?:${Zve.source}?(?:\\[(${zve.source})\\])?)?`,KZ=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Yve=RegExp(`${KZ.source}${dBe}`),eY=RegExp(`(?:T${Yve.source})?`),pBe=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,fBe=/(\d{4})-?W(\d\d)(?:-?(\d))?/,mBe=/(\d{4})-?(\d{3})/,gBe=Xve("weekYear","weekNumber","weekDay"),yBe=Xve("year","ordinal"),vBe=/(\d{4})-(\d\d)-(\d\d)/,Qve=RegExp(`${KZ.source} ?(?:${Zve.source}|(${zve.source}))?`),_Be=RegExp(`(?: ${Qve.source})?`);function l2(e,t,i){const r=e[t];return Qi(r)?i:Y0(r)}function bBe(e,t){return[{year:l2(e,t),month:l2(e,t+1,1),day:l2(e,t+2,1)},null,t+3]}function rC(e,t){return[{hours:l2(e,t,0),minutes:l2(e,t+1,0),seconds:l2(e,t+2,0),milliseconds:ZZ(e[t+3])},null,t+4]}function H3(e,t){const i=!e[t]&&!e[t+1],r=kk(e[t+1],e[t+2]),s=i?null:Sl.instance(r);return[{},s,t+3]}function q3(e,t){const i=e[t]?iy.create(e[t]):null;return[{},i,t+1]}const wBe=RegExp(`^T?${KZ.source}$`),xBe=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function TBe(e){const[t,i,r,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",f=(m,y=!1)=>m!==void 0&&(y||m&&h)?-m:m;return[{years:f(P_(i)),months:f(P_(r)),weeks:f(P_(s)),days:f(P_(n)),hours:f(P_(o)),minutes:f(P_(a)),seconds:f(P_(l),l==="-0"),milliseconds:f(ZZ(c),p)}]}const SBe={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function tY(e,t,i,r,s,n,o){const a={year:t.length===2?gj(Y0(t)):Y0(t),month:Vve.indexOf(i)+1,day:Y0(r),hour:Y0(s),minute:Y0(n)};return o&&(a.second=Y0(o)),e&&(a.weekday=e.length>3?Gve.indexOf(e)+1:jve.indexOf(e)+1),a}const EBe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function CBe(e){const[,t,i,r,s,n,o,a,l,c,h,p]=e,f=tY(t,s,r,i,n,o,a);let m;return l?m=SBe[l]:c?m=0:m=kk(h,p),[f,new Sl(m)]}function ABe(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const RBe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,MBe=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,OBe=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Fie(e){const[,t,i,r,s,n,o,a]=e;return[tY(t,s,r,i,n,o,a),Sl.utcInstance]}function PBe(e){const[,t,i,r,s,n,o,a]=e;return[tY(t,a,i,r,s,n,o),Sl.utcInstance]}const IBe=eC(pBe,eY),$Be=eC(fBe,eY),LBe=eC(mBe,eY),DBe=eC(Yve),Jve=tC(bBe,rC,H3,q3),NBe=tC(gBe,rC,H3,q3),FBe=tC(yBe,rC,H3,q3),kBe=tC(rC,H3,q3);function UBe(e){return iC(e,[IBe,Jve],[$Be,NBe],[LBe,FBe],[DBe,kBe])}function zBe(e){return iC(ABe(e),[EBe,CBe])}function VBe(e){return iC(e,[RBe,Fie],[MBe,Fie],[OBe,PBe])}function BBe(e){return iC(e,[xBe,TBe])}const GBe=tC(rC);function jBe(e){return iC(e,[wBe,GBe])}const HBe=eC(vBe,_Be),qBe=eC(Qve),WBe=tC(rC,H3,q3);function XBe(e){return iC(e,[HBe,Jve],[qBe,WBe])}const ZBe="Invalid Duration",Kve={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},YBe=F({years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3}},Kve),Wu=146097/400,Tx=146097/4800,QBe=F({years:{quarters:4,months:12,weeks:Wu/7,days:Wu,hours:Wu*24,minutes:Wu*24*60,seconds:Wu*24*60*60,milliseconds:Wu*24*60*60*1e3},quarters:{months:3,weeks:Wu/28,days:Wu/4,hours:Wu*24/4,minutes:Wu*24*60/4,seconds:Wu*24*60*60/4,milliseconds:Wu*24*60*60*1e3/4},months:{weeks:Tx/7,days:Tx,hours:Tx*24,minutes:Tx*24*60,seconds:Tx*24*60*60,milliseconds:Tx*24*60*60*1e3}},Kve),L1=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],JBe=L1.slice(0).reverse();function I_(e,t,i=!1){const r={values:i?t.values:F(F({},e.values),t.values||{}),loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new or(r)}function KBe(e){return e<0?Math.floor(e):Math.ceil(e)}function e_e(e,t,i,r,s){const n=e[s][i],o=t[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?KBe(o):Math.trunc(o);r[s]+=l,t[i]-=l*n}function e8e(e,t){JBe.reduce((i,r)=>Qi(t[r])?i:(i&&e_e(e,t,i,t,r),r),null)}class or{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||Fs.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i?QBe:YBe,this.isLuxonDuration=!0}static fromMillis(t,i){return or.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new Oh(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new or({values:i4(t,or.normalizeUnit),loc:Fs.fromObject(i),conversionAccuracy:i.conversionAccuracy})}static fromDurationLike(t){if(sw(t))return or.fromMillis(t);if(or.isDuration(t))return t;if(typeof t=="object")return or.fromObject(t);throw new Oh(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=BBe(t);return r?or.fromObject(r,i):or.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=jBe(t);return r?or.fromObject(r,i):or.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new Oh("need to specify a reason the Duration is invalid");const r=t instanceof up?t:new up(t,i);if(lo.throwOnInvalid)throw new MVe(r);return new or({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new yve(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r=ye(F({},i),{floor:i.round!==!1&&i.floor!==!1});return this.isValid?yc.create(this.loc,r).formatDurationFromString(this,t):ZBe}toHuman(t={}){const i=L1.map(r=>{const s=this.values[r];return Qi(s)?null:this.loc.numberFormatter(ye(F({style:"unit",unitDisplay:"long"},t),{unit:r.slice(0,-1)})).format(s)}).filter(r=>r);return this.loc.listFormatter(F({type:"conjunction",style:t.listStyle||"narrow"},t)).format(i)}toObject(){return this.isValid?F({},this.values):{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=YZ(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t=F({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},t);const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=or.fromDurationLike(t),r={};for(const s of L1)(tE(i.values,s)||tE(this.values,s))&&(r[s]=i.get(s)+this.get(s));return I_(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=or.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=Uve(t(this.values[r],r));return I_(this,{values:i},!0)}get(t){return this[or.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i=F(F({},this.values),i4(t,or.normalizeUnit));return I_(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i}),n={loc:s};return r&&(n.conversionAccuracy=r),I_(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return e8e(this.matrix,t),I_(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>or.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of L1)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;sw(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)L1.indexOf(c)>L1.indexOf(o)&&e_e(this.matrix,s,c,i,o)}else sw(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return I_(this,{values:i},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return I_(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of L1)if(!i(this.values[r],t.values[r]))return!1;return!0}}const $C="Invalid Interval";function t8e(e,t){return!e||!e.isValid?Qs.invalid("missing or invalid start"):!t||!t.isValid?Qs.invalid("missing or invalid end"):t<e?Qs.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class Qs{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new Oh("need to specify a reason the Interval is invalid");const r=t instanceof up?t:new up(t,i);if(lo.throwOnInvalid)throw new RVe(r);return new Qs({invalid:r})}static fromDateTimes(t,i){const r=NC(t),s=NC(i),n=t8e(r,s);return n==null?new Qs({start:r,end:s}):n}static after(t,i){const r=or.fromDurationLike(i),s=NC(t);return Qs.fromDateTimes(s,s.plus(r))}static before(t,i){const r=or.fromDurationLike(i),s=NC(t);return Qs.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,o;try{n=ii.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=ii.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return Qs.fromDateTimes(n,a);if(o){const c=or.fromISO(s,i);if(c.isValid)return Qs.after(n,c)}else if(l){const c=or.fromISO(r,i);if(c.isValid)return Qs.before(a,c)}}return Qs.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?Qs.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(NC).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(Qs.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(t){const i=or.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(Qs.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:Qs.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return Qs.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(Qs.fromDateTimes(i,l.time)),i=null);return Qs.merge(s)}difference(...t){return Qs.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:$C}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:$C}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:$C}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:$C}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:$C}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):or.invalid(this.invalidReason)}mapEndpoints(t){return Qs.fromDateTimes(t(this.s),t(this.e))}}class TI{static hasDST(t=lo.defaultZone){const i=ii.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return iy.isValidZone(t)}static normalizeZone(t){return nv(t,lo.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Fs.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||Fs.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Fs.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||Fs.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return Fs.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return Fs.create(i,null,"gregory").eras(t)}static features(){return{relative:Fve()}}}function kie(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(or.fromMillis(r).as("days"))}function i8e(e,t,i){const r=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=kie(a,l);return(c-c%7)/7}],["days",kie]],s={};let n,o;for(const[a,l]of r)if(i.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function r8e(e,t,i,r){let[s,n,o,a]=i8e(e,t,i);const l=t-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=or.fromObject(n,r);return c.length>0?or.fromMillis(l,r).shiftTo(...c).plus(h):h}const iY={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Uie={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},s8e=iY.hanidec.replace(/[\[|\]]/g,"").split("");function n8e(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(iY.hanidec)!==-1)t+=s8e.indexOf(e[i]);else for(const s in Uie){const[n,o]=Uie[s];r>=n&&r<=o&&(t+=r-n)}}return parseInt(t,10)}else return t}function hd({numberingSystem:e},t=""){return new RegExp(`${iY[e||"latn"]}${t}`)}const o8e="missing Intl.DateTimeFormat.formatToParts support";function yr(e,t=i=>i){return{regex:e,deser:([i])=>t(n8e(i))}}const a8e=String.fromCharCode(160),t_e=`[ ${a8e}]`,i_e=new RegExp(t_e,"g");function l8e(e){return e.replace(/\./g,"\\.?").replace(i_e,t_e)}function zie(e){return e.replace(/\./g,"").replace(i_e," ").toLowerCase()}function dd(e,t){return e===null?null:{regex:RegExp(e.map(l8e).join("|")),deser:([i])=>e.findIndex(r=>zie(i)===zie(r))+t}}function Vie(e,t){return{regex:e,deser:([,i,r])=>kk(i,r),groups:t}}function V6(e){return{regex:e,deser:([t])=>t}}function c8e(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function u8e(e,t){const i=hd(t),r=hd(t,"{2}"),s=hd(t,"{3}"),n=hd(t,"{4}"),o=hd(t,"{6}"),a=hd(t,"{1,2}"),l=hd(t,"{1,3}"),c=hd(t,"{1,6}"),h=hd(t,"{1,9}"),p=hd(t,"{2,4}"),f=hd(t,"{4,6}"),m=w=>({regex:RegExp(c8e(w.val)),deser:([b])=>b,literal:!0}),v=(w=>{if(e.literal)return m(w);switch(w.val){case"G":return dd(t.eras("short",!1),0);case"GG":return dd(t.eras("long",!1),0);case"y":return yr(c);case"yy":return yr(p,gj);case"yyyy":return yr(n);case"yyyyy":return yr(f);case"yyyyyy":return yr(o);case"M":return yr(a);case"MM":return yr(r);case"MMM":return dd(t.months("short",!0,!1),1);case"MMMM":return dd(t.months("long",!0,!1),1);case"L":return yr(a);case"LL":return yr(r);case"LLL":return dd(t.months("short",!1,!1),1);case"LLLL":return dd(t.months("long",!1,!1),1);case"d":return yr(a);case"dd":return yr(r);case"o":return yr(l);case"ooo":return yr(s);case"HH":return yr(r);case"H":return yr(a);case"hh":return yr(r);case"h":return yr(a);case"mm":return yr(r);case"m":return yr(a);case"q":return yr(a);case"qq":return yr(r);case"s":return yr(a);case"ss":return yr(r);case"S":return yr(l);case"SSS":return yr(s);case"u":return V6(h);case"uu":return V6(a);case"uuu":return yr(i);case"a":return dd(t.meridiems(),0);case"kkkk":return yr(n);case"kk":return yr(p,gj);case"W":return yr(a);case"WW":return yr(r);case"E":case"c":return yr(i);case"EEE":return dd(t.weekdays("short",!1,!1),1);case"EEEE":return dd(t.weekdays("long",!1,!1),1);case"ccc":return dd(t.weekdays("short",!0,!1),1);case"cccc":return dd(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Vie(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Vie(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return V6(/[a-z_+-/]{1,256}?/i);default:return m(w)}})(e)||{invalidReason:o8e};return v.token=e,v}const h8e={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function d8e(e,t,i){const{type:r,value:s}=e;if(r==="literal")return{literal:!0,val:s};const n=i[r];let o=h8e[r];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function p8e(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function f8e(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const o in i)if(tE(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function m8e(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Qi(e.z)||(i=iy.create(e.z)),Qi(e.Z)||(i||(i=new Sl(e.Z)),r=e.Z),Qi(e.q)||(e.M=(e.q-1)*3+1),Qi(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),Qi(e.u)||(e.S=ZZ(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),i,r]}let B6=null;function g8e(){return B6||(B6=ii.fromMillis(1555555555555)),B6}function y8e(e,t){if(e.literal)return e;const i=yc.macroTokenToFormatOpts(e.val);if(!i)return e;const n=yc.create(t,i).formatDateTimeParts(g8e()).map(o=>d8e(o,t,i));return n.includes(void 0)?e:n}function v8e(e,t){return Array.prototype.concat(...e.map(i=>y8e(i,t)))}function r_e(e,t,i){const r=v8e(yc.parseFormat(i),e),s=r.map(o=>u8e(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[o,a]=p8e(s),l=RegExp(o,"i"),[c,h]=f8e(t,l,a),[p,f,m]=h?m8e(h):[null,null,void 0];if(tE(h,"a")&&tE(h,"H"))throw new mR("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:f,specificOffset:m}}}function _8e(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=r_e(e,t,i);return[r,s,n,o]}const s_e=[0,31,59,90,120,151,181,212,243,273,304,334],n_e=[0,31,60,91,121,152,182,213,244,274,305,335];function Vh(e,t){return new up("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function o_e(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function a_e(e,t,i){return i+(G3(e)?n_e:s_e)[t-1]}function l_e(e,t){const i=G3(e)?n_e:s_e,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function wj(e){const{year:t,month:i,day:r}=e,s=a_e(t,i,r),n=o_e(t,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=t4(a)):o>t4(t)?(a=t+1,o=1):a=t,F({weekYear:a,weekNumber:o,weekday:n},Uk(e))}function Bie(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=o_e(t,1,4),n=gM(t);let o=i*7+r-s-3,a;o<1?(a=t-1,o+=gM(a)):o>n?(a=t+1,o-=gM(t)):a=t;const{month:l,day:c}=l_e(a,o);return F({year:a,month:l,day:c},Uk(e))}function G6(e){const{year:t,month:i,day:r}=e,s=a_e(t,i,r);return F({year:t,ordinal:s},Uk(e))}function Gie(e){const{year:t,ordinal:i}=e,{month:r,day:s}=l_e(t,i);return F({year:t,month:r,day:s},Uk(e))}function b8e(e){const t=Fk(e.weekYear),i=Mg(e.weekNumber,1,t4(e.weekYear)),r=Mg(e.weekday,1,7);return t?i?r?!1:Vh("weekday",e.weekday):Vh("week",e.week):Vh("weekYear",e.weekYear)}function w8e(e){const t=Fk(e.year),i=Mg(e.ordinal,1,gM(e.year));return t?i?!1:Vh("ordinal",e.ordinal):Vh("year",e.year)}function c_e(e){const t=Fk(e.year),i=Mg(e.month,1,12),r=Mg(e.day,1,e4(e.year,e.month));return t?i?r?!1:Vh("day",e.day):Vh("month",e.month):Vh("year",e.year)}function u_e(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=Mg(t,0,23)||t===24&&i===0&&r===0&&s===0,o=Mg(i,0,59),a=Mg(r,0,59),l=Mg(s,0,999);return n?o?a?l?!1:Vh("millisecond",s):Vh("second",r):Vh("minute",i):Vh("hour",t)}const j6="Invalid DateTime",jie=864e13;function SI(e){return new up("unsupported zone",`the zone "${e.name}" is not supported`)}function H6(e){return e.weekData===null&&(e.weekData=wj(e.c)),e.weekData}function LC(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new ii(ye(F(F({},i),t),{old:i}))}function h_e(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Hie(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function OD(e,t,i){return h_e(QZ(e),t,i)}function qie(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n=ye(F({},e.c),{year:r,month:s,day:Math.min(e.c.day,e4(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7}),o=or.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=QZ(n);let[l,c]=h_e(a,i,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function DC(e,t,i,r,s,n){const{setZone:o,zone:a}=i;if(e&&Object.keys(e).length!==0){const l=t||a,c=ii.fromObject(e,ye(F({},i),{zone:l,specificOffset:n}));return o?c:c.setZone(a)}else return ii.invalid(new up("unparsable",`the input "${s}" can't be parsed as ${r}`))}function EI(e,t,i=!0){return e.isValid?yc.create(Fs.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function q6(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=Un(e.c.year,i?6:4),t?(r+="-",r+=Un(e.c.month),r+="-",r+=Un(e.c.day)):(r+=Un(e.c.month),r+=Un(e.c.day)),r}function Wie(e,t,i,r,s,n){let o=Un(e.c.hour);return t?(o+=":",o+=Un(e.c.minute),(e.c.second!==0||!i)&&(o+=":")):o+=Un(e.c.minute),(e.c.second!==0||!i)&&(o+=Un(e.c.second),(e.c.millisecond!==0||!r)&&(o+=".",o+=Un(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=Un(Math.trunc(-e.o/60)),o+=":",o+=Un(Math.trunc(-e.o%60))):(o+="+",o+=Un(Math.trunc(e.o/60)),o+=":",o+=Un(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const d_e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},x8e={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},T8e={ordinal:1,hour:0,minute:0,second:0,millisecond:0},p_e=["year","month","day","hour","minute","second","millisecond"],S8e=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],E8e=["year","ordinal","hour","minute","second","millisecond"];function Xie(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new yve(e);return t}function Zie(e,t){const i=nv(t.zone,lo.defaultZone),r=Fs.fromObject(t),s=lo.now();let n,o;if(Qi(e.year))n=s;else{for(const c of p_e)Qi(e[c])&&(e[c]=d_e[c]);const a=c_e(e)||u_e(e);if(a)return ii.invalid(a);const l=i.offset(s);[n,o]=OD(e,l,i)}return new ii({ts:n,zone:i,loc:r,o})}function Yie(e,t,i){const r=Qi(i.round)?!0:i.round,s=(o,a)=>(o=YZ(o,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,i.units[i.units.length-1])}function Qie(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class ii{constructor(t){const i=t.zone||lo.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new up("invalid input"):null)||(i.isValid?null:SI(i));this.ts=Qi(t.ts)?lo.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const a=i.offset(this.ts);s=Hie(this.ts,a),r=Number.isNaN(s.year)?new up("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=t.loc||Fs.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new ii({})}static local(){const[t,i]=Qie(arguments),[r,s,n,o,a,l,c]=i;return Zie({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,i]=Qie(arguments),[r,s,n,o,a,l,c]=i;return t.zone=Sl.utcInstance,Zie({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,i={}){const r=$Ve(t)?t.valueOf():NaN;if(Number.isNaN(r))return ii.invalid("invalid input");const s=nv(i.zone,lo.defaultZone);return s.isValid?new ii({ts:r,zone:s,loc:Fs.fromObject(i)}):ii.invalid(SI(s))}static fromMillis(t,i={}){if(sw(t))return t<-jie||t>jie?ii.invalid("Timestamp out of range"):new ii({ts:t,zone:nv(i.zone,lo.defaultZone),loc:Fs.fromObject(i)});throw new Oh(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(sw(t))return new ii({ts:t*1e3,zone:nv(i.zone,lo.defaultZone),loc:Fs.fromObject(i)});throw new Oh("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=nv(i.zone,lo.defaultZone);if(!r.isValid)return ii.invalid(SI(r));const s=lo.now(),n=Qi(i.specificOffset)?r.offset(s):i.specificOffset,o=i4(t,Xie),a=!Qi(o.ordinal),l=!Qi(o.year),c=!Qi(o.month)||!Qi(o.day),h=l||c,p=o.weekYear||o.weekNumber,f=Fs.fromObject(i);if((h||a)&&p)throw new mR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new mR("Can't mix ordinal dates with month/day");const m=p||o.weekday&&!h;let y,v,w=Hie(s,n);m?(y=S8e,v=x8e,w=wj(w)):a?(y=E8e,v=T8e,w=G6(w)):(y=p_e,v=d_e);let b=!1;for(const D of y){const L=o[D];Qi(L)?b?o[D]=v[D]:o[D]=w[D]:b=!0}const S=m?b8e(o):a?w8e(o):c_e(o),T=S||u_e(o);if(T)return ii.invalid(T);const E=m?Bie(o):a?Gie(o):o,[C,A]=OD(E,n,r),I=new ii({ts:C,zone:r,o:A,loc:f});return o.weekday&&h&&t.weekday!==I.weekday?ii.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${I.toISO()}`):I}static fromISO(t,i={}){const[r,s]=UBe(t);return DC(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=zBe(t);return DC(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=VBe(t);return DC(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(Qi(t)||Qi(i))throw new Oh("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=Fs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=_8e(o,t,i);return h?ii.invalid(h):DC(a,l,r,`format ${i}`,t,c)}static fromString(t,i,r={}){return ii.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=XBe(t);return DC(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new Oh("need to specify a reason the DateTime is invalid");const r=t instanceof up?t:new up(t,i);if(lo.throwOnInvalid)throw new AVe(r);return new ii({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?H6(this).weekYear:NaN}get weekNumber(){return this.isValid?H6(this).weekNumber:NaN}get weekday(){return this.isValid?H6(this).weekday:NaN}get ordinal(){return this.isValid?G6(this.c).ordinal:NaN}get monthShort(){return this.isValid?TI.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?TI.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?TI.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?TI.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return G3(this.year)}get daysInMonth(){return e4(this.year,this.month)}get daysInYear(){return this.isValid?gM(this.year):NaN}get weeksInWeekYear(){return this.isValid?t4(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=yc.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(Sl.instance(t),i)}toLocal(){return this.setZone(lo.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=nv(t,lo.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),o=this.toObject();[s]=OD(o,n,t)}return LC(this,{ts:s,zone:t})}else return ii.invalid(SI(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return LC(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=i4(t,Xie),r=!Qi(i.weekYear)||!Qi(i.weekNumber)||!Qi(i.weekday),s=!Qi(i.ordinal),n=!Qi(i.year),o=!Qi(i.month)||!Qi(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new mR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new mR("Can't mix ordinal dates with month/day");let c;r?c=Bie(F(F({},wj(this.c)),i)):Qi(i.ordinal)?(c=F(F({},this.toObject()),i),Qi(i.day)&&(c.day=Math.min(e4(c.year,c.month),c.day))):c=Gie(F(F({},G6(this.c)),i));const[h,p]=OD(c,this.o,this.zone);return LC(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const i=or.fromDurationLike(t);return LC(this,qie(this,i))}minus(t){if(!this.isValid)return this;const i=or.fromDurationLike(t).negate();return LC(this,qie(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=or.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?yc.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):j6}toLocaleString(t=mj,i={}){return this.isValid?yc.create(this.loc.clone(i),t).formatDateTime(this):j6}toLocaleParts(t={}){return this.isValid?yc.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=q6(this,o);return a+="T",a+=Wie(this,o,i,r,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?q6(this,t==="extended"):null}toISOWeekDate(){return EI(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Wie(this,o==="extended",i,t,r,n):null}toRFC2822(){return EI(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return EI(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?q6(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),EI(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():j6}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i=F({},this.c);return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return or.invalid("created by diffing an invalid DateTime");const s=F({locale:this.locale,numberingSystem:this.numberingSystem},r),n=LVe(i).map(or.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=r8e(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",i={}){return this.diff(ii.now(),t,i)}until(t){return this.isValid?Qs.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||ii.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),Yie(i,this.plus(r),ye(F({},t),{numeric:"always",units:s,unit:n}))}toRelativeCalendar(t={}){return this.isValid?Yie(t.base||ii.fromObject({},{zone:this.zone}),this,ye(F({},t),{numeric:"auto",units:["years","months","days"],calendary:!0})):null}static min(...t){if(!t.every(ii.isDateTime))throw new Oh("min requires all arguments be DateTimes");return Rie(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(ii.isDateTime))throw new Oh("max requires all arguments be DateTimes");return Rie(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=Fs.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return r_e(o,t,i)}static fromStringExplain(t,i,r={}){return ii.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return mj}static get DATE_MED(){return vve}static get DATE_MED_WITH_WEEKDAY(){return OVe}static get DATE_FULL(){return _ve}static get DATE_HUGE(){return bve}static get TIME_SIMPLE(){return wve}static get TIME_WITH_SECONDS(){return xve}static get TIME_WITH_SHORT_OFFSET(){return Tve}static get TIME_WITH_LONG_OFFSET(){return Sve}static get TIME_24_SIMPLE(){return Eve}static get TIME_24_WITH_SECONDS(){return Cve}static get TIME_24_WITH_SHORT_OFFSET(){return Ave}static get TIME_24_WITH_LONG_OFFSET(){return Rve}static get DATETIME_SHORT(){return Mve}static get DATETIME_SHORT_WITH_SECONDS(){return Ove}static get DATETIME_MED(){return Pve}static get DATETIME_MED_WITH_SECONDS(){return Ive}static get DATETIME_MED_WITH_WEEKDAY(){return PVe}static get DATETIME_FULL(){return $ve}static get DATETIME_FULL_WITH_SECONDS(){return Lve}static get DATETIME_HUGE(){return Dve}static get DATETIME_HUGE_WITH_SECONDS(){return Nve}}function NC(e){if(ii.isDateTime(e))return e;if(e&&e.valueOf&&sw(e.valueOf()))return ii.fromJSDate(e);if(e&&typeof e=="object")return ii.fromObject(e);throw new Oh(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const W6={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function f_e(e){e||(e=Mu());let t=e in W6;if(!t){const n=e.split("-");n.length>1&&n[0]in W6&&(e=n[0],t=!0),t||(e="en")}const[i,r,s="#,##0.###"]=W6[e];return{decimal:i,group:r,pattern:s}}function C8e(e,t){const i=f_e((t=F({},t)).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:A8e(e,r,t)}const m_e=/[#0,]*[#0](?:\.0*#*)?/;function A8e(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=m_e,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return i.fractional===!1&&(i.places=0),t.replace(a,R8e(e,l[0],{decimal:s,group:r,places:i.places,round:i.round}))}function R8e(e,t,i){(i=i||{}).places===!0&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s=typeof i.places=="string"&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const y=i.places!==void 0?i.places:r[1]&&r[1].lastIndexOf("0")+1;y>a.length&&(o[1]=a.padEnd(Number(y),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=r[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,f=r[0].lastIndexOf(",");if(f!==-1){h=r[0].length-f-1;const y=r[0].substr(0,f);f=y.lastIndexOf(","),f!==-1&&(p=y.length-f-1)}const m=[];for(let y=o[0];y;){const v=y.length-h;m.push(v>0?y.substr(v):y),y=v>0?y.slice(0,v):"",p&&(h=p,p=void 0)}return o[0]=m.reverse().join(i.group||","),o.join(i.decimal||".")}function M8e(e){const t=f_e((e=e||{}).locale),i=e.pattern||t.pattern,r=t.group,s=t.decimal;let n=1;if(i.includes("%"))n/=100;else if(i.includes("\u2030"))n/=1e3;else if(i.includes("\xA4"))throw new Error("currency notation not supported");const o=i.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:gO(o,l=>(l="(?:"+khe(l,".")+")").replace(m_e,c=>{const h={signed:!1,separator:e.strict?r:[r,""],fractional:e.fractional,decimal:s,exponent:!1},p=c.split(".");let f=e.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||f===0?h.fractional=!1:(f===void 0&&(f=e.pattern?p[1].lastIndexOf("0")+1:1/0),f&&e.fractional==null&&(h.fractional=!0),!e.places&&f<p[1].length&&(f+=","+p[1].length),h.places=f);const m=p[0].split(",");return m.length>1&&(h.groupSize=m.pop().length,m.length>1&&(h.groupSize2=m.pop().length)),"("+P8e(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:s,factor:n}}function O8e(e,t){const i=M8e(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function P8e(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=Jie(e),i=gO(e.fractional,s=>{let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+gO(e.exponent,s=>s?"([eE]"+Jie({signed:e.eSigned})+")":"")}function Jie(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",gO(e.signed,t=>t?"[-+]":"",!0)+gO(e.separator,t=>{if(!t)return"(?:\\d+)";(t=khe(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const i=e.groupSize,r=e.groupSize2;if(r){const s="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})";return i-r>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0)}const gO=(e,t,i)=>{if(!(e instanceof Array))return t(e);const r=[];for(let s=0;s<e.length;s++)r.push(t(e[s]));return I8e(r.join("|"),i)},I8e=(e,t)=>"("+(t?"?:":"")+e+")";var Kie,ere;function $2t(e){return V3.fromJSON(e.toJSON())}function $8e(e){return e.toJSON?e.toJSON():e}function L2t(e){return typeof e=="string"||e instanceof String}function D2t(e){return typeof e=="number"}function tre(e){return e instanceof Date}function N2t(e,t){return e===t||!(!tre(e)||!tre(t))&&e.getTime()===t.getTime()}function F2t(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function k2t(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new ai({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function U2t(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(Kie||(Kie={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(ere||(ere={}));const z2t=1e3,V2t={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},ire={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},B2t={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function G2t(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function j2t(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}class g_e{constructor(t){this.value=t}}class y_e{constructor(t){this.value=t}}class rY{constructor(t){this.fn=t}}class sY{constructor(t,i){this.paramCount=i,this.fn=t}}const L8e=rY,D8e=y_e,N8e=g_e,F8e=sY,fu={type:"VOID"},k8e={type:"BREAK"},U8e={type:"CONTINUE"};function yO(e,t,i){return t===""||t==null||t===i||t===i?e:e=e.split(t).join(i)}function nY(e){return e instanceof rY||e instanceof CVe||e instanceof sY}function r4(e){return!!sa(e)||!!_l(e)||!!Na(e)||!!vl(e)||e===null||e===fu||typeof e=="number"}function z8e(e,t){return e===void 0?t:e}function sa(e){return typeof e=="string"||e instanceof String}function vl(e){return typeof e=="boolean"}function _l(e){return typeof e=="number"}function V8e(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function Yh(e){return e instanceof Array}function B8e(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function G8e(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function j8e(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function Ew(e){return e instanceof gm}function Na(e){return e instanceof Date}function H8e(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function q8e(e){return e<0?-Math.round(-e):Math.round(e)}function W8e(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?i:3&i|8).toString(16)})}function oY(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=yO(t,"\u2030",""),t=yO(t,"\xA4",""),C8e(e,{pattern:t})):e.toString()}function zk(e,t){const i=ii.fromJSDate(e);return t==null||t===""?i.toISO({suppressMilliseconds:!0}):i.toFormat(v_e(t),{locale:Mu(),numberingSystem:"latn"})}function v_e(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function Sr(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function X8e(e,t,i){if(e===null){if(t===null||t===fu)return Sr(null,null,i);if(_l(t))return Sr(0,t,i);if(sa(t)||vl(t))return Sr(0,Ls(t),i);if(Na(t))return Sr(0,t.getTime(),i)}if(e===fu){if(t===null||t===fu)return Sr(null,null,i);if(_l(t))return Sr(0,t,i);if(sa(t)||vl(t))return Sr(0,Ls(t),i);if(Na(t))return Sr(0,t.getTime(),i)}else if(_l(e)){if(_l(t))return Sr(e,t,i);if(vl(t))return Sr(e,Ls(t),i);if(t===null||t===fu)return Sr(e,0,i);if(sa(t))return Sr(e,Ls(t),i);if(Na(t))return Sr(e,t.getTime(),i)}else if(sa(e)){if(sa(t))return Sr(Nv(e),Nv(t),i);if(Na(t))return Sr(Ls(e),t.getTime(),i);if(_l(t))return Sr(Ls(e),t,i);if(t===null||t===fu)return Sr(Ls(e),0,i);if(vl(t))return Sr(Ls(e),Ls(t),i)}else if(Na(e)){if(Na(t))return Sr(e,t,i);if(t===null||t===fu)return Sr(e.getTime(),0,i);if(_l(t))return Sr(e.getTime(),t,i);if(vl(t)||sa(t))return Sr(e.getTime(),Ls(t),i)}else if(vl(e)){if(vl(t))return Sr(e,t,i);if(_l(t))return Sr(Ls(e),Ls(t),i);if(Na(t))return Sr(Ls(e),t.getTime(),i);if(t===null||t===fu)return Sr(Ls(e),0,i);if(sa(t))return Sr(Ls(e),Ls(t),i)}return!!__e(e,t)&&(i==="<="||i===">=")}function __e(e,t){if(e===t||e===null&&t===fu||t===null&&e===fu)return!0;if(Na(e)&&Na(t))return e.getTime()===t.getTime();if(e instanceof XZ||e instanceof ux)return e.equalityTest(t);if(e instanceof ot&&t instanceof ot){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(i!=null)return i===r}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function Nv(e,t){if(sa(e))return e;if(e===null)return"";if(_l(e))return oY(e,t);if(vl(e))return e.toString();if(Na(e))return zk(e,t);if(e instanceof Ec)return JSON.stringify(e.toJSON());if(Yh(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=s4(e[r]);return"["+i.join(",")+"]"}if(e instanceof gm){const i=[];for(let r=0;r<e.length();r++)i[r]=s4(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():nY(e)?"object, Function":""}function Z8e(e){const t=[];if(Yh(e)===!1)return null;if(e instanceof gm){for(let i=0;i<e.length();i++)t[i]=Ls(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=Ls(e[i]);return t}function PD(e,t){if(sa(e))return e;if(e===null)return"";if(_l(e))return oY(e,t);if(vl(e))return e.toString();if(Na(e))return zk(e,t);if(e instanceof Ec)return e instanceof ai?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+xj(e.spatialReference)+"}":xj(e.toJSON(),(i,r)=>i.key===r.key?0:i.key==="spatialReference"?1:r.key==="spatialReference"||i.key<r.key?-1:i.key>r.key?1:0);if(Yh(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=s4(e[r]);return"["+i.join(",")+"]"}if(e instanceof gm){const i=[];for(let r=0;r<e.length();r++)i[r]=s4(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():nY(e)?"object, Function":""}function s4(e){if(e===null)return"null";if(vl(e)||_l(e)||sa(e))return JSON.stringify(e);if(e instanceof Ec||e instanceof gm||e instanceof Array)return PD(e);if(e instanceof Date)return JSON.stringify(zk(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===fu)return"null";return"null"}function Ls(e,t){return _l(e)?e:e===null||e===""?0:Na(e)?NaN:vl(e)?e?1:0:Yh(e)||e===""||e===void 0?NaN:t!==void 0&&sa(e)?(t=yO(t,"\u2030",""),t=yO(t,"\xA4",""),O8e(e,{pattern:t})):e===fu?0:Number(e)}function Y8e(e){if(Na(e))return e;if(sa(e)){const t=b_e(e);if(t)return t.toJSDate()}return null}function Q8e(e){return Na(e)?ii.fromJSDate(e):sa(e)?b_e(e):null}function b_e(e){const t=/ (\d\d)/;let i=ii.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=ii.fromISO(e),i.isValid)?i:null}function J8e(e){return vl(e)?e:sa(e)?(e=e.toLowerCase())==="true":!!_l(e)&&e!==0&&!isNaN(e)}function K8e(e,t){return R(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function e9e(e){if(e===null)return null;if(e instanceof ot)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof Go){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof Su){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof Jw?e.points.length===0?null:e:e instanceof ai?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function w_e(e,t){if(!e||!e.domain)return t;let i=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=Nv(t);else{if(t==null)return null;if(t==="")return t;t=Ls(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return i===null?t:i.name}function x_e(e,t){if(!e||!e.domain)return t;let i=null;t=Nv(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return i===null?t:i.code}function Vk(e,t,i=null,r=null){if(!t||!t.fields)return null;let s,n,o=null;for(let a=0;a<t.fields.length;a++){const l=t.fields[a];l.name.toLowerCase()===e.toString().toLowerCase()&&(o=l)}if(o===null)throw new Error("Field not found");return r===null&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),r!=null&&t.types.some(function(a){return a.id===r&&(s=a.domains&&a.domains[o.name],s&&s.type==="inherited"&&(s=rre(o.name,t),n=!0),!0)}),n||s||(s=rre(e,t)),{field:o,domain:s}}function rre(e,t){let i;return t.fields.some(function(r){return r.name.toLowerCase()===e.toLowerCase()&&(i=r.domain),!!i}),i}function xj(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const f=p[l],m=o(a[f]);m&&(c&&(c+=","),c+=JSON.stringify(f)+":"+m)}return n.splice(h,1),"{"+c+"}"}(e)}function t9e(e){if(e===null)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&i.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(i.geometry()):t.push(i);return t}function iE(e,t){if(!(t instanceof ot))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function i9e(e,t){if(Yh(e)||Ew(e)){let i=!1,r=!1,s=[],n=t;if(Yh(e)){for(const o of e)iE(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof ux)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!Ew(e))throw new Error("Invalid Argument");for(const o of e.toArray())iE(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(NW(s,r,i)===!1&&(s=s.slice(0).reverse()),new Go({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function r9e(e,t){if(Yh(e)||Ew(e)){let i=!1,r=!1,s=[],n=t;if(Yh(e)){for(const o of e)iE(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof ux)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(Ew(e)){for(const o of e.toArray())iE(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Su({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function s9e(e,t){if(Yh(e)||Ew(e)){let i=!1,r=!1,s=[],n=t;if(Yh(e)){for(const o of e)iE(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof ux)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(Ew(e)){for(const o of e.toArray())iE(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Jw({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function n9e(e,t=!1){const i=[];if(e===null)return i;if(Yh(e)===!0){for(let r=0;r<e.length;r++){const s=Nv(e[r]);s===""&&t!==!0||i.push(s)}return i}if(e instanceof gm){for(let r=0;r<e.length();r++){const s=Nv(e.get(r));s===""&&t!==!0||i.push(s)}return i}if(r4(e)){const r=Nv(e);return r===""&&t!==!0||i.push(r),i}return[]}let X6=0;function o9e(e){return X6++,X6%100==0?(X6=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function a9e(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function vO(e,t=null){return e==null?null:vl(e)||_l(e)||sa(e)?e:e instanceof Ec?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof gm?e.toArray().map(i=>vO(i,t)):e instanceof Array?e.map(i=>vO(i,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function l9e(e,t,i,r,s){const n=await aY(e,t,i);s[r]=n}async function aY(e,t=null,i=null){if(e instanceof gm&&(e=e.toArray()),e==null)return null;if(r4(e)||e instanceof Ec||e instanceof Date)return vO(e,i);if(e instanceof Array){const r=[],s=[];for(const n of e)n===null||r4(n)||n instanceof Ec||n instanceof Date?s.push(vO(n,i)):(s.push(null),r.push(l9e(n,t,i,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,i):null}function c9e(e,t,i){const r=e.fullSchema();return r===null||!r.fields?null:Vk(t,r,e,i)}function u9e(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(i=>({name:i.name,code:i.id})):[]}:null}function h9e(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=Vk(t,s,e,r);if(i===void 0)try{i=e.field(t)}catch{return null}return w_e(n,i)}function d9e(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;if(i===void 0){try{i=e.field(t)}catch{return null}return i}return x_e(Vk(t,s,e,r),i)}function p9e(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const i=[];for(const r of t.fields)i.push($8e(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:ire[t.geometryType]===void 0?"":ire[t.geometryType],fields:i}}const H2t=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:g_e,ImplicitResultE:y_e,NativeFunctionE:rY,SizzleFunctionE:sY,NativeFunction:L8e,ImplicitResult:D8e,ReturnResult:N8e,SizzleFunction:F8e,voidOperation:fu,breakResult:k8e,continueResult:U8e,multiReplace:yO,isFunctionParameter:nY,isSimpleType:r4,defaultUndefined:z8e,isString:sa,isBoolean:vl,isNumber:_l,isInteger:V8e,isArray:Yh,isFeature:B8e,isFeatureSet:G8e,isFeatureSetCollection:j8e,isImmutableArray:Ew,isDate:Na,pcCheck:H8e,absRound:q8e,generateUUID:W8e,formatNumber:oY,formatDate:zk,standardiseDateFormat:v_e,greaterThanLessThan:X8e,equalityTest:__e,toString:Nv,toNumberArray:Z8e,toStringExplicit:PD,toNumber:Ls,toDate:Y8e,toDateTime:Q8e,toBoolean:J8e,fixSpatialReference:K8e,fixNullGeometry:e9e,getDomainValue:w_e,getDomainCode:x_e,getDomain:Vk,stableStringify:xj,autoCastFeatureToGeometry:t9e,autoCastArrayOfPointsToPolygon:i9e,autoCastArrayOfPointsToPolyline:r9e,autoCastArrayOfPointsToMultiPoint:s9e,toStringArray:n9e,tick:o9e,binaryOperator:a9e,castAsJson:vO,castAsJsonAsync:aY,featureFullDomain:c9e,featureSubtypes:u9e,featureDomainValueLookup:h9e,featureDomainCodeLookup:d9e,featureSchema:p9e},Symbol.toStringTag,{value:"Module"}));var Tj;let E0=Tj=class extends ve{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new Tj({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([d({type:String,json:{write:!0}})],E0.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],E0.prototype,"label",void 0),u([d({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],E0.prototype,"minValue",void 0),u([d({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],E0.prototype,"maxValue",void 0),u([d(D3)],E0.prototype,"symbol",void 0),E0=Tj=u([P("esri.renderers.support.ClassBreakInfo")],E0);const n4=E0;var Sj;const CI=fe.getLogger("esri.renderers.ClassBreaksRenderer"),T_e="log",ID="percent-of-total",$D="field",AI=new wi({esriNormalizeByLog:T_e,esriNormalizeByPercentOfTotal:ID,esriNormalizeByField:$D}),f9e=Bs(n4);let On=Sj=class extends XE(dy){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new n4;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(CI.error(".field: field must be a string value"),null):x3(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&$D||i&&ID||null,t&&i&&CI.warn("warning: both normalizationField and normalizationTotal are set!")):e!==$D&&e!==ID||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new n4({minValue:e,maxValue:t,symbol:kfe(i)}):f9e(re(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(R(t)||R(t.arcade))&&CI.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(R(t)||R(t.arcade))&&(i=ye(F({},i),{arcade:await Wf()}));const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(R(t)||R(t.arcade)))return void CI.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(R(t)||R(t.arcade))){const s=await Wf(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i=ye(F({},i),{arcade:s})}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new Sj({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:re(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:re(this.visualVariables),legendOptions:re(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Il(e,t,this.valueExpression)];Gh(e,t,this.field),Gh(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=vt(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,o=parseFloat(i[this.normalizationField]);if(r===T_e)s=Math.log(s)*Math.LOG10E;else if(r!==ID||isNaN(n)){if(r===$D&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};u([d(Ame)],On.prototype,"backgroundFillSymbol",void 0),u([d({type:[n4]})],On.prototype,"classBreakInfos",void 0),u([Ie("classBreakInfos")],On.prototype,"readClassBreakInfos",null),u([qe("classBreakInfos")],On.prototype,"writeClassBreakInfos",null),u([d({type:String,json:{write:!0}})],On.prototype,"defaultLabel",void 0),u([d(D3)],On.prototype,"defaultSymbol",void 0),u([d({type:String,json:{write:!0}})],On.prototype,"field",void 0),u([qt("field")],On.prototype,"castField",null),u([d({type:Boolean})],On.prototype,"isMaxInclusive",void 0),u([d({type:i2,json:{write:!0}})],On.prototype,"legendOptions",void 0),u([d({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],On.prototype,"minValue",null),u([d({type:String,json:{write:!0}})],On.prototype,"normalizationField",void 0),u([d({type:Number,cast:e=>Mh(e),json:{write:!0}})],On.prototype,"normalizationTotal",void 0),u([d({type:AI.apiValues,value:null,json:{type:AI.jsonValues,read:AI.read,write:AI.write}})],On.prototype,"normalizationType",null),u([at({classBreaks:"class-breaks"})],On.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],On.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],On.prototype,"valueExpressionTitle",void 0),On=Sj=u([P("esri.renderers.ClassBreaksRenderer")],On);const S_e=On;class m9e{constructor(t,i){this._storage=new kZ,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const sre=fe.getLogger("esri.renderers.support.DictionaryLoader"),g9e={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class lY{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new m9e(100),this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(m){if(Jr(m))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const m of this._symbolFields){const y=this.fieldMap[m];if(y&&t.attributes[y]!=null){const v=""+t.attributes[y];s[m]=v}else s[m]=""}const n=r(s,i);if(!n||typeof n!="string")return null;const o=vW(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const m of l)if(m)if(m.includes("po:")){const y=m.substr(3).split("|");if(y.length===3){const v=y[0],w=y[1];let b=y[2];if(w==="DashTemplate")b=b.split(" ").map(S=>Number(S));else if(w==="Color"){const S=new Pe(b).toRgba();b=[S[0],S[1],S[2],255*S[3]]}else b=Number(b);h.push({primitiveName:v,propertyName:w,value:b})}}else if(m.includes("|")){for(const y of m.split("|"))if(this._itemNames.has(y)){c.push(y);break}}else this._itemNames.has(m)&&c.push(m);const p=!_(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",f=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,f,1),f}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void sre.error("no valid URL!");const i=Zt(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:_(t)?t.signal:null}),[{data:r}]=await Promise.all([i,Wf()]);if(!r)throw this._dictionaryPromise=null,new j("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const l=this.config;for(const c in l)o[c]=l[c]}if(n.configuration)for(const l of n.configuration)o.hasOwnProperty(l.name)||(o[l.name]=l.value);const a=[];if(_(t)&&t.fields&&this.fieldMap)for(const l of this._symbolFields){const c=this.fieldMap[l],h=t.fields.filter(p=>p.name===c);h.length>0&&a.push(ye(F({},h[0]),{name:l}))}return this._dictionaryPromise=KOe(s,_(t)?t.spatialReference:null,a,o).then(l=>{const c={scale:0};return(h,p)=>{const f=l.repurposeFeature({geometry:null,attributes:h});return c.scale=_(p)?p.scale:void 0,l.evaluate({$feature:f,$view:c})}}).catch(l=>(sre.error("Creating dictinoary expression failed:",l),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;for(const l of o)E_e(l,a);return new BE({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=Zt(r,F({responseType:"json",query:{f:"json"}},i));this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s=F({},t[0]);if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=g9e),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function E_e(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&y9e(s,t)}}function y9e(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":E_e(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}var q2t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",DictionaryLoader:lY}),Ej;let Pd=Ej=class extends XE(dy){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new lY(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){(r==null?void 0:r.origin)||super.writeVisualVariables(e,t,i,r)}clone(){return new Ej({config:re(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:re(this.fieldMap),url:re(this.url),visualVariables:re(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Il(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([d({type:lY})],Pd.prototype,"_loader",null),u([d({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Pd.prototype,"config",void 0),u([d({type:Object,json:{write:!0}})],Pd.prototype,"fieldMap",void 0),u([d({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Pd.prototype,"scaleExpression",void 0),u([qe("scaleExpression")],Pd.prototype,"writeData",null),u([d({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],Pd.prototype,"scaleExpressionTitle",void 0),u([d({type:String,json:{write:!0}})],Pd.prototype,"url",void 0),u([qe("visualVariables")],Pd.prototype,"writeVisualVariables",null),Pd=Ej=u([P("esri.renderers.DictionaryRenderer")],Pd);const v9e=Pd;var Cj;const _9e=fe.getLogger("esri.renderers.support.AttributeColorInfo");let Zm=Cj=class extends ve{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(_9e.error(".field: field must be a string value"),null):x3(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new Cj({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Pe,json:{type:[Number],write:!0}})],Zm.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],Zm.prototype,"field",void 0),u([qt("field")],Zm.prototype,"castField",null),u([d({type:String,json:{write:!0}})],Zm.prototype,"label",void 0),u([d({type:String,json:{write:!0}})],Zm.prototype,"valueExpression",void 0),u([d({type:String,json:{write:!0}})],Zm.prototype,"valueExpressionTitle",void 0),Zm=Cj=u([P("esri.renderers.support.AttributeColorInfo")],Zm);const C_e=Zm;var Aj;let LD=Aj=class extends ve{constructor(){super(...arguments),this.unit=null}clone(){return new Aj({unit:this.unit})}};u([d({type:String,json:{write:!0}})],LD.prototype,"unit",void 0),LD=Aj=u([P("esri.renderers.support.DotDensityLegendOptions")],LD);const b9e=LD;var Rj;let Ta=Rj=class extends XE(dy){constructor(e){super(e),this.attributes=null,this.backgroundColor=new Pe([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Pc,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new dm({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Rj({attributes:re(this.attributes),backgroundColor:re(this.backgroundColor),dotBlendingEnabled:re(this.dotBlendingEnabled),dotShape:re(this.dotShape),dotSize:re(this.dotSize),dotValue:re(this.dotValue),legendOptions:re(this.legendOptions),outline:re(this.outline),referenceScale:re(this.referenceScale),visualVariables:re(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Il(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[C_e],json:{write:!0}})],Ta.prototype,"attributes",void 0),u([d({type:Pe,json:{write:!0}})],Ta.prototype,"backgroundColor",void 0),u([d({type:Boolean}),Xe("dotBlendingEnabled")],Ta.prototype,"blendDots",void 0),u([d({type:Boolean,json:{write:!0}})],Ta.prototype,"dotBlendingEnabled",void 0),u([d({type:String,json:{write:!1}})],Ta.prototype,"dotShape",void 0),u([d({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],Ta.prototype,"dotSize",void 0),u([d({type:b9e,json:{write:!0}})],Ta.prototype,"legendOptions",void 0),u([d({type:Pc,json:{default:null,write:!0}})],Ta.prototype,"outline",void 0),u([d({type:Number,json:{write:!0}})],Ta.prototype,"dotValue",void 0),u([d({type:Number}),Xe("dotValue")],Ta.prototype,"referenceDotValue",void 0),u([d({type:Number,json:{write:!0}})],Ta.prototype,"referenceScale",void 0),u([d({type:Number,json:{write:!0}})],Ta.prototype,"seed",void 0),u([at({dotDensity:"dot-density"})],Ta.prototype,"type",void 0),Ta=Rj=u([P("esri.renderers.DotDensityRenderer")],Ta);const w9e=Ta;let zT=class extends Ic(ve){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([d({type:String,json:{write:!0}})],zT.prototype,"minLabel",void 0),u([d({type:String,json:{write:!0}})],zT.prototype,"maxLabel",void 0),u([d({type:String,json:{write:!0}})],zT.prototype,"title",void 0),zT=u([P("esri.renderers.support.HeatmapLegendOptions")],zT);const cY=2.4;function x9e(e){return $l(e*cY)}function T9e(e){return gi(e)/cY}function S9e(e,t,i,r){let{color:s,ratio:n}=t,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=De((r-n)/(a-n),0,1);k5(e,s.toArray(),o.toArray(),l)}function W2t(e){const i=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return i;let r=e[0],s=e[0],n=1;const o=Xt();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)r=s,s=e[n++];S9e(o,r,s,l),i.set(o,4*a)}return i}function X2t(e,t,i,r){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round(gi(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=C9e(o,n),f=new Set;for(const m of e){const y=m.getCursor();for(;y.next();){const v=y.getObjectId();if(f.has(v))continue;f.add(v);const w=y.readLegacyPointGeometry(),b=128;if(w.x<-b||w.x>=i+b||w.y<-b||w.y>r+b)continue;const S=+p(y),T=Math.max(0,Math.round(w.x)-a),E=Math.max(0,Math.round(w.y)-a),C=Math.min(r,Math.round(w.y)+a),A=Math.min(i,Math.round(w.x)+a);for(let I=E;I<C;I++)for(let D=T;D<A;D++){const L=I*i+D,z=E9e(w.x-D,w.y-I,a);c=l[L]+=z*S,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function E9e(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function Z2t(e,t){return typeof e=="function"?e:e?typeof t=="string"?i=>-1*+i[e]:i=>+i[e]+t:()=>1}function C9e(e,t){return e!=null?typeof t=="string"?i=>-1*+i.readAttribute(e):i=>+i.readAttribute(e)+t:i=>1}var Mj;const A9e=fe.getLogger("esri.renderers.HeatmapRenderer");function nre(e){if(e!=null){const{maxDensity:i,minDensity:r,radius:s}=e;if(i!=null||r!=null||s!=null){const t=e,{blurRadius:n,maxPixelIntensity:o,minPixelIntensity:a}=t;return NP(t,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return e}let eo=Mj=class extends dy{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new pM({ratio:0,color:new Pe("rgba(255, 140, 0, 0)")}),new pM({ratio:.75,color:new Pe("rgba(255, 140, 0, 1)")}),new pM({ratio:.9,color:new Pe("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return nre(e)}get blurRadius(){return T9e(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",x9e(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(cY**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||ua(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,zE(()=>{CMe(A9e,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=nre(e),super.read(e,t)}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(this.radius*e,$l(256));return new xc({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await Gh(e,t,i),r&&typeof r=="string"&&await Il(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new Mj({colorStops:re(this.colorStops),field:this.field,legendOptions:re(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([d({type:Vfe,json:{write:!1}})],eo.prototype,"authoringInfo",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],eo.prototype,"blurRadius",null),u([d({type:[pM],json:{write:!0}})],eo.prototype,"colorStops",void 0),u([d({type:String,json:{write:!0}})],eo.prototype,"field",void 0),u([d({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],eo.prototype,"fieldOffset",void 0),u([d({type:zT,json:{write:!0}})],eo.prototype,"legendOptions",void 0),u([d({type:Number,json:{write:!0}})],eo.prototype,"maxDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],eo.prototype,"maxPixelIntensity",null),u([d({type:Number,json:{write:!0}})],eo.prototype,"minDensity",void 0),u([d({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],eo.prototype,"minPixelIntensity",null),u([d({type:Number,cast:ir,json:{write:!0}})],eo.prototype,"radius",void 0),u([d({type:Number,range:{min:0},json:{default:0,write:!0}})],eo.prototype,"referenceScale",void 0),u([at({heatmap:"heatmap"})],eo.prototype,"type",void 0),u([d({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],eo.prototype,"valueExpression",void 0),u([d({type:String})],eo.prototype,"valueExpressionTitle",void 0),u([d({readOnly:!0})],eo.prototype,"_pixelIntensityToDensity",null),eo=Mj=u([P("esri.renderers.HeatmapRenderer")],eo);const A_e=eo;let gb=class extends Ic(ve){constructor(){super(...arguments),this.color=new Pe([0,0,0,0]),this.label=null,this.threshold=0}};u([d({type:Pe,json:{write:!0}})],gb.prototype,"color",void 0),u([d({type:String,json:{write:!0}})],gb.prototype,"label",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],gb.prototype,"threshold",void 0),gb=u([P("esri.renderers.support.OthersCategory")],gb);let DD=class extends Ic(ve){constructor(){super(...arguments),this.title=null}};u([d({type:String,json:{write:!0}})],DD.prototype,"title",void 0),DD=u([P("esri.renderers.support.PieChartLegendOptions")],DD);let Zc=class extends XE(Ic(dy)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new Pe([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new gb,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new xc({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Il(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([d({type:[C_e],json:{write:!0}})],Zc.prototype,"attributes",void 0),u([d({type:dm,json:{default:null,write:!0}})],Zc.prototype,"backgroundFillSymbol",void 0),u([d({type:Pe,json:{write:!0}})],Zc.prototype,"defaultColor",void 0),u([d({type:String,json:{write:!0}})],Zc.prototype,"defaultLabel",void 0),u([d({type:Number,range:{min:0,max:1},json:{write:!0}})],Zc.prototype,"holePercentage",void 0),u([d({type:gb,json:{write:!0}})],Zc.prototype,"othersCategory",void 0),u([d({type:DD,json:{write:!0}})],Zc.prototype,"legendOptions",void 0),u([d({type:Pc,json:{default:null,write:!0}})],Zc.prototype,"outline",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],Zc.prototype,"size",void 0),u([at({pieChart:"pie-chart"})],Zc.prototype,"type",void 0),Zc=u([P("esri.renderers.PieChartRenderer")],Zc);const R9e=Zc;var Oj;let D1=Oj=class extends XE(dy){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new Oj({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:re(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([d({type:String,json:{write:!0}})],D1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],D1.prototype,"label",void 0),u([d(D3)],D1.prototype,"symbol",void 0),u([at({simple:"simple"})],D1.prototype,"type",void 0),D1=Oj=u([P("esri.renderers.SimpleRenderer")],D1);const uY=D1,Bk={key:"type",base:dy,typeMap:{heatmap:A_e,simple:uY,"unique-value":UX,"class-breaks":S_e,"dot-density":w9e,dictionary:v9e,"pie-chart":R9e},errorContext:"renderer"},R_e={key:"type",base:dy,typeMap:{simple:uY,"unique-value":UX,"class-breaks":S_e,heatmap:A_e},errorContext:"renderer"};function M9e(e,t){return M_e(e,null,t)}const O9e=UE({types:Bk});function M_e(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new ja("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):O9e(e,t,i):null}class hY{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(r9),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new hY,r=this._originStores[Vt.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,re(s),Vt.DEFAULTS)});for(let s=Vt.SERVICE;s<r9;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||i.set(a,re(o),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=Vt.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=Vt.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||Vt.DEFAULTS}forEach(t){this._values.forEach(t)}}const O_e=e=>{let t=class extends e{constructor(...i){super(...i);const r=ua(this),s=r.store,n=new hY;r.store=n,xde(r,s,n)}read(i,r){Sde(this,i,r)}getAtOrigin(i,r){const s=Z6(this),n=Ag(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return tF(this.originIdOf(i))}originIdOf(i){return Z6(this).originOf(i)}revert(i,r){const s=Z6(this),n=Ag(r),o=ua(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function Z6(e){return ua(e).store}let ore=class extends O_e(Se){};ore=u([P("esri.core.ReadOnlyMultiOriginJSONSupport")],ore);const P9e=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return Y6(this).delete(i,Ag(r))}write(i={},r){return Cde(this,i=i||{},r),i}setAtOrigin(i,r,s){ua(this).setAtOrigin(i,r,Ag(s))}removeOrigin(i){const r=Y6(this),s=Ag(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Vt.USER)}updateOrigin(i,r){const s=Y6(this),n=Ag(r),o=this.get(i);for(let a=n+1;a<r9;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return t=u([P("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function Y6(e){return ua(e).store}const Gk=e=>{let t=class extends P9e(O_e(e)){constructor(...i){super(...i)}};return t=u([P("esri.core.MultiOriginJSONSupport")],t),t};let are=class extends Gk(Se){};are=u([P("esri.core.MultiOriginJSONSupport")],are);async function I9e(e,t){const{WhereClause:i}=await import("./WhereClause.7b12305d.js");return i.create(e,t)}function P_e(e,t){return _(e)?_(t)?`(${e}) AND (${t})`:e:t}var Pj;let N1=Pj=class extends ve{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new Pj({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([d({type:String,json:{write:!0}})],N1.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],N1.prototype,"name",void 0),u([d({type:["boolean","date","number","string"],json:{write:!0}})],N1.prototype,"returnType",void 0),u([d({type:String,json:{write:!0}})],N1.prototype,"title",void 0),N1=Pj=u([P("esri.form.ExpressionInfo")],N1);const $9e=N1;let F1=class extends ve{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([d({type:String,json:{write:!0}})],F1.prototype,"description",void 0),u([d({type:String,json:{write:!0}})],F1.prototype,"label",void 0),u([d()],F1.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],F1.prototype,"visibilityExpression",void 0),F1=u([P("esri.form.elements.Element")],F1);const rE=F1;var Ij;let ND=Ij=class extends ve{constructor(e){super(e),this.type=null}clone(){return new Ij({type:this.type})}};u([d({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],ND.prototype,"type",void 0),ND=Ij=u([P("esri.form.elements.inputs.AttachmentInput")],ND);const L9e=ND;var $j;let k1=$j=class extends rE{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new $j({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({type:String,json:{write:!0}})],k1.prototype,"attachmentKeyword",void 0),u([d({type:Boolean,json:{write:!0}})],k1.prototype,"editable",void 0),u([d({type:L9e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],k1.prototype,"input",void 0),u([d({type:["attachment"],json:{read:!1,write:!0}})],k1.prototype,"type",void 0),k1=$j=u([P("esri.form.elements.AttachmentElement")],k1);const lre=k1;let FD=class extends ve{constructor(e){super(e),this.type=null}};u([d()],FD.prototype,"type",void 0),FD=u([P("esri.form.elements.inputs.Input")],FD);const sC=FD;let yR=class extends sC{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([d({type:Number,json:{write:!0}})],yR.prototype,"maxLength",void 0),u([d({type:Number,json:{write:!0}})],yR.prototype,"minLength",void 0),yR=u([P("esri.form.elements.inputs.TextInput")],yR);const dY=yR;var Lj;let kD=Lj=class extends dY{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new Lj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["barcode-scanner"],json:{read:!1,write:!0}})],kD.prototype,"type",void 0),kD=Lj=u([P("esri.form.elements.inputs.BarcodeScannerInput")],kD);const D9e=kD;var Dj;let VT=Dj=class extends sC{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new Dj({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([d({type:String,json:{write:!0}})],VT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],VT.prototype,"showNoValueOption",void 0),u([d({type:["combo-box"],json:{read:!1,write:!0}})],VT.prototype,"type",void 0),VT=Dj=u([P("esri.form.elements.inputs.ComboBoxInput")],VT);const N9e=VT;var Nj;function cre(e){return e!=null?new Date(e):null}function ure(e){return e?e.getTime():null}let Id=Nj=class extends sC{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return cre(t.max)}writeMax(e,t){t.max=ure(e)}readMin(e,t){return cre(t.min)}writeMin(e,t){t.min=ure(e)}clone(){return new Nj({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([d({type:Boolean,json:{write:!0}})],Id.prototype,"includeTime",void 0),u([d({type:Date,json:{type:Number,write:!0}})],Id.prototype,"max",void 0),u([Ie("max")],Id.prototype,"readMax",null),u([qe("max")],Id.prototype,"writeMax",null),u([d({type:Date,json:{type:Number,write:!0}})],Id.prototype,"min",void 0),u([Ie("min")],Id.prototype,"readMin",null),u([qe("min")],Id.prototype,"writeMin",null),u([d({type:["datetime-picker"],json:{read:!1,write:!0}})],Id.prototype,"type",void 0),Id=Nj=u([P("esri.form.elements.inputs.DateTimePickerInput")],Id);const F9e=Id;var Fj;let BT=Fj=class extends sC{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new Fj({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([d({type:String,json:{write:!0}})],BT.prototype,"noValueOptionLabel",void 0),u([d({type:Boolean,json:{write:!0}})],BT.prototype,"showNoValueOption",void 0),u([d({type:["radio-buttons"],json:{read:!1,write:!0}})],BT.prototype,"type",void 0),BT=Fj=u([P("esri.form.elements.inputs.RadioButtonsInput")],BT);const k9e=BT;var kj;let GT=kj=class extends sC{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new kj({offValue:this.offValue,onValue:this.onValue})}};u([d({type:[String,Number],json:{write:!0}})],GT.prototype,"offValue",void 0),u([d({type:[String,Number],json:{write:!0}})],GT.prototype,"onValue",void 0),u([d({type:["switch"],json:{read:!1,write:!0}})],GT.prototype,"type",void 0),GT=kj=u([P("esri.form.elements.inputs.SwitchInput")],GT);const U9e=GT;var Uj;let UD=Uj=class extends dY{constructor(e){super(e),this.type="text-area"}clone(){return new Uj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-area"],json:{read:!1,write:!0}})],UD.prototype,"type",void 0),UD=Uj=u([P("esri.form.elements.inputs.TextAreaInput")],UD);const z9e=UD;var zj;let zD=zj=class extends dY{constructor(e){super(e),this.type="text-box"}clone(){return new zj({maxLength:this.maxLength,minLength:this.minLength})}};u([d({type:["text-box"],json:{read:!1,write:!0}})],zD.prototype,"type",void 0),zD=zj=u([P("esri.form.elements.inputs.TextBoxInput")],zD);const V9e=zD,B9e={base:sC,key:"type",typeMap:{"barcode-scanner":D9e,"combo-box":N9e,"datetime-picker":F9e,"radio-buttons":k9e,switch:U9e,"text-area":z9e,"text-box":V9e}};var Vj;let ch=Vj=class extends rE{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new Vj({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([d({types:q0e,json:{read:{reader:VZ},write:!0}})],ch.prototype,"domain",void 0),u([d({type:Boolean,json:{write:!0}})],ch.prototype,"editable",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"editableExpression",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"fieldName",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"hint",void 0),u([d({types:B9e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],ch.prototype,"input",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"requiredExpression",void 0),u([d({type:String,json:{read:!1,write:!0}})],ch.prototype,"type",void 0),u([d({type:String,json:{write:!0}})],ch.prototype,"valueExpression",void 0),ch=Vj=u([P("esri.form.elements.FieldElement")],ch);const hre=ch;var Bj;let Ym=Bj=class extends rE{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Bj({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:re(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([d({type:Number,json:{write:!0}})],Ym.prototype,"displayCount",void 0),u([d({type:["list"],json:{write:!0}})],Ym.prototype,"displayType",void 0),u([d({type:Boolean,json:{write:!0}})],Ym.prototype,"editable",void 0),u([d({type:[ome],json:{write:!0}})],Ym.prototype,"orderByFields",void 0),u([d({type:Number,json:{write:!0}})],Ym.prototype,"relationshipId",void 0),u([d({type:["relationship"],json:{read:!1,write:!0}})],Ym.prototype,"type",void 0),Ym=Bj=u([P("esri.form.elements.RelationshipElement")],Ym);const dre=Ym;function I_e(e){return{typesWithGroup:{base:rE,key:"type",typeMap:{attachment:lre,field:hre,group:e,relationship:dre}},typesWithoutGroup:{base:rE,key:"type",typeMap:{attachment:lre,field:hre,relationship:dre}}}}function $_e(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function L_e(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function D_e(e,t,i=!0){return e?e.map(r=>wp(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var Gj;let xf=Gj=class extends rE{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return D_e(e,Q6,!1)}readElements(e,t){return $_e(t.formElements,Q6,!1)}writeElements(e,t){t.formElements=L_e(e,Q6,!1)}clone(){return new Gj({description:this.description,elements:re(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([d({json:{write:!0}})],xf.prototype,"elements",void 0),u([qt("elements")],xf.prototype,"castElements",null),u([Ie("elements",["formElements"])],xf.prototype,"readElements",null),u([qe("elements")],xf.prototype,"writeElements",null),u([d({type:["collapsed","expanded"],json:{write:!0}})],xf.prototype,"initialState",void 0),u([d({type:String,json:{read:!1,write:!0}})],xf.prototype,"type",void 0),xf=Gj=u([P("esri.form.elements.GroupElement")],xf);const Q6=I_e(xf),G9e=xf;var jj;const J6=I_e(G9e);let af=jj=class extends ve{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return D_e(e,J6)}readElements(e,t){return $_e(t.formElements,J6)}writeElements(e,t){t.formElements=L_e(e,J6)}clone(){return new jj({description:this.description,expressionInfos:re(this.expressionInfos),elements:re(this.elements),title:this.title})}};u([d({type:String,json:{write:!0}})],af.prototype,"description",void 0),u([d({json:{write:!0}})],af.prototype,"elements",void 0),u([qt("elements")],af.prototype,"castElements",null),u([Ie("elements",["formElements"])],af.prototype,"readElements",null),u([qe("elements")],af.prototype,"writeElements",null),u([d({type:[$9e],json:{write:!0}})],af.prototype,"expressionInfos",void 0),u([d({type:String,json:{write:!0}})],af.prototype,"title",void 0),af=jj=u([P("esri.form.FormTemplate")],af);const j9e=af,H9e=fe.getLogger("esri.layers.support.fromPortalItem");async function q9e(e){const t="portalItem"in e?e:{portalItem:e},i=await import("./portalLayers.d5d1b49c.js");try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||Fi.portalUrl;throw H9e.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let W9e=0,to=class extends as.EventedMixin(IX(ey)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new ai(-180,-90,180,90,et.WGS84),this.id=Date.now().toString(16)+"-layer-"+W9e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=et.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await import("./arcgisLayers.4906484e.js")).fromUrl(t)}static fromPortalItem(e){return q9e(e)}initialize(){this.when().catch(e=>{var t,i;Jr(e)||fe.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?js(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await Zt(e,{query:{f:"json"},responseType:"json"})).data;throw new j("layer:no-attribution-data","Layer does not have attribution data")}};u([d({type:String})],to.prototype,"attributionDataUrl",void 0),u([d({type:ai})],to.prototype,"fullExtent",void 0),u([d({readOnly:!0})],to.prototype,"hasAttributionData",null),u([d({type:String,clonable:!1})],to.prototype,"id",void 0),u([d({type:Boolean,nonNullable:!0})],to.prototype,"legendEnabled",void 0),u([d({type:["show","hide","hide-children"]})],to.prototype,"listMode",void 0),u([d({type:Number,range:{min:0,max:1},nonNullable:!0})],to.prototype,"opacity",void 0),u([d({clonable:!1})],to.prototype,"parent",void 0),u([d({readOnly:!0})],to.prototype,"parsedUrl",null),u([d({type:Boolean})],to.prototype,"popupEnabled",void 0),u([d({type:Boolean})],to.prototype,"attributionVisible",void 0),u([d({type:et})],to.prototype,"spatialReference",void 0),u([d({type:String})],to.prototype,"title",void 0),u([d({readOnly:!0,json:{read:!1}})],to.prototype,"type",void 0),u([d()],to.prototype,"url",void 0),u([d({type:Boolean,nonNullable:!0})],to.prototype,"visible",void 0),to=u([P("esri.layers.Layer")],to);const sE=to;function pre(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function X9e(e,t,i){if(!e&&!t||!i)return;const r=G2(i);fre(e,i,r),fre(t,i,r)}function fre(e,t,i){if(e)for(const r of e)Z9e(r.geometry,t,i)}function Z9e(e,t,i){if(R(e)||!e.spatialReference||Mc(e.spatialReference,t))return;const r=G2(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)pre(e,e.rings,r);else if("paths"in e)pre(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}let Y9e=0;const K6=fe.getLogger("esri.layers.graphics.sources.MemorySource");let pg=class extends ey.LoadableMixin(X5(g_(ut))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=_(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);sj(e,this.layer.spatialReference,i);const r=Dk.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new j("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return sj(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:ai.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new j("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&r.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}X9e(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||R(e))return;const i=[];for(const{geometry:r}of e)!_(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new j("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!r&&_(o.geometry)&&(r=o.geometry.type),i[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return(i=(e=this.layer)==null?void 0:e.geometryType)!=null?i:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(Y9e++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return R(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?Go.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await kme("MemorySourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",f=>{K6.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),f.preventDefault()}));const c={features:l.features,fields:t&&t.map(f=>f.toJSON()),geometryType:KK.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const f of h.warnings)K6.warn(f.message,{layer:this.layer,warning:f});h.featureErrors.length&&K6.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=KK.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([yX({Type:Ha,ensureType:Bs(Ha)})],pg.prototype,"itemType",void 0),u([d()],pg.prototype,"type",void 0),u([d({constructOnly:!0})],pg.prototype,"layer",void 0),u([d({readOnly:!0})],pg.prototype,"workerGeometryType",null),u([d()],pg.prototype,"sourceJSON",void 0),pg=u([P("esri.layers.graphics.sources.MemorySource")],pg);function Q9e(e){return"portalItem"in e}const pY=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):Q9e(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([d({type:String})],t.prototype,"apiKey",null),t=u([P("esri.layers.mixins.APIKeyMixin")],t),t},N_e={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},F_e=Object.values(N_e),k_e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${F_e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),J9e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${F_e.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),K9e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function Y2t(e){return!!k_e.test(e)}function Cw(e){if(R(e))return null;const t=js(e),i=t.path.match(k_e)||t.path.match(J9e);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:jk(a!==-1?s.slice(a+1):s),serverType:N_e[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function eGe(e){const t=js(e).path.match(K9e);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function jk(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function U_e(e,t){const i=[];if(e){const r=Cw(e);_(r)&&r.title&&i.push(r.title)}if(t){const r=jk(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function z_e(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(i)||e.includes(r)||e.includes(s);return n&&o}function tGe(e,t){return e&&efe(tfe(e,t))}function V_e(e){let{url:t}=e;if(!t)return{url:t};t=tfe(t,e.logger);const i=js(t),r=Cw(i.path);let s;if(_(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=eGe(i.path);_(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:efe(t),layerId:s}}function B_e(e,t,i,r,s){Xv(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=Ll(r.url,i,e.layerId.toString()))}function Q2t(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}const fY=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=Cw(this.url);if(_(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",tGe(i,fe.getLogger(this.declaredClass)))}};return u([d()],t.prototype,"title",null),u([d({type:String})],t.prototype,"url",null),t=u([P("esri.layers.mixins.ArcGISService")],t),t},mre={read:{reader:NZ},write:{allowNull:!0,writer:FZ}},iGe=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([d({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([d({json:{read:!1,write:!1,origins:{"web-map":mre,"portal-item":mre}}})],t.prototype,"effect",void 0),t=u([P("esri.layers.mixins.BlendLayer")],t),t},rGe=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([d({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([P("esri.layers.mixins.CustomParametersMixin")],t),t};var Hj;const eV=new wi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),tV=new wi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let lf=Hj=class extends ve{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new Fh(F({geometry:re(i),objectIds:re(n),spatialRelationship:r,timeExtent:re(s),where:t,units:o,distance:a},e))}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new Hj({geometry:re(t),objectIds:re(s),spatialRelationship:i,timeExtent:re(r),where:e,units:n,distance:o})}};u([d({type:String,json:{write:!0}})],lf.prototype,"where",void 0),u([d({types:Kw,json:{write:!0}})],lf.prototype,"geometry",void 0),u([d({type:eV.apiValues,json:{name:"spatialRel",read:{reader:eV.read},write:{allowNull:!1,writer:eV.write,overridePolicy(){return{enabled:_(this.geometry)}}}}})],lf.prototype,"spatialRelationship",void 0),u([d({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],lf.prototype,"distance",void 0),u([d({type:[Number],json:{write:!0}})],lf.prototype,"objectIds",void 0),u([d({type:tV.apiValues,json:{read:tV.read,write:{writer:tV.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],lf.prototype,"units",void 0),u([d({type:mm,json:{write:!0}})],lf.prototype,"timeExtent",void 0),lf=Hj=u([P("esri.layers.support.FeatureFilter")],lf);const sGe=lf;var qj;const gre={read:{reader:NZ},write:{writer:FZ,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},yre={read:{reader:NZ},write:{writer:FZ,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},vre={name:"showExcludedLabels",default:!0};let U1=qj=class extends ve{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var r,s;const i=super.write(e,t);if(t==null?void 0:t.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new j("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new j("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new qj({filter:_(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([d({type:sGe,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?Sc(i,s,t):Sc(i,null,t)}}}})],U1.prototype,"filter",void 0),u([d({json:{write:!0,origins:{"web-map":gre,"portal-item":gre}}})],U1.prototype,"includedEffect",void 0),u([d({json:{write:!0,origins:{"web-map":yre,"portal-item":yre}}})],U1.prototype,"excludedEffect",void 0),u([d({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":vre,"portal-item":vre}}})],U1.prototype,"excludedLabelsVisible",void 0),U1=qj=u([P("esri.layers.support.FeatureEffect")],U1);const nGe=U1,_re={write:{allowNull:!0}},oGe=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([d({type:nGe,json:{origins:{"web-map":_re,"portal-item":_re}}})],t.prototype,"featureEffect",void 0),t=u([P("esri.layers.mixins.FeatureEffectLayer")],t),t},aGe={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function lGe(e){if(!e)return e;const{start:t,end:i}=e;return new mm({start:_(t)?rw(t,-t.getTimezoneOffset(),"minutes"):t,end:_(i)?rw(i,-i.getTimezoneOffset(),"minutes"):i})}function cGe(e){if(!e)return e;const{start:t,end:i}=e;return new mm({start:_(t)?rw(t,t.getTimezoneOffset(),"minutes"):t,end:_(i)?rw(i,i.getTimezoneOffset(),"minutes"):i})}var Wj;let vR=Wj=class extends ve{async collectRequiredFields(e,t){return Il(e,t,this.expression)}clone(){return new Wj({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([d({type:String,json:{write:!0}})],vR.prototype,"expression",void 0),u([d({type:String,json:{write:!0}})],vR.prototype,"title",void 0),vR=Wj=u([P("esri.layers.support.FeatureExpressionInfo")],vR);const bre=vR;function uGe(e){return j2[e]!=null}function hGe(e){return 1/(j2[e]||1)}function dGe(){const e=Object.keys(j2);return e.sort(),e}const pGe=dGe();var Xj;const RI=fa()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),wre=new wi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let Qm=Xj=class extends ve{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):_(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new Xj({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&oRe(this.featureExpressionInfo,e.featureExpressionInfo)}};u([d({type:bre,json:{write:!0}})],Qm.prototype,"featureExpressionInfo",void 0),u([Ie("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],Qm.prototype,"readFeatureExpressionInfo",null),u([qe("featureExpressionInfo",{featureExpressionInfo:{type:bre},"featureExpression.value":{type:[0]}})],Qm.prototype,"writeFeatureExpressionInfo",null),u([d({type:RI.apiValues,nonNullable:!0,json:{type:RI.jsonValues,read:RI.read,write:{writer:RI.write,isRequired:!0}}})],Qm.prototype,"mode",null),u([d({type:Number,json:{write:!0}})],Qm.prototype,"offset",void 0),u([d({type:pGe,json:{type:String,read:wre.read,write:wre.write}})],Qm.prototype,"unit",null),Qm=Xj=u([P("esri.layers.support.ElevationInfo")],Qm);const fGe=Qm,G_e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},Hk={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},qk={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},j_e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Xv}}},H_e={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},mY={value:null,type:fGe,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function J2t(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const VD={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},mGe=ye(F({},VD),{json:ye(F({},VD.json),{origins:{"web-document":ye(F({},VD.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?k2(t.layerDefinition.drawingInfo.transparency):void 0:k2(t.drawingInfo.transparency)}})}),gGe={type:mm,readOnly:!0,get(){var a,l;if(!((a=this.layer)==null?void 0:a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=cGe(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=lGe(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},K2t={type:ai,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=ai.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=et.fromJSON(t.spatialReference)),i}}}},read:!1}},q_e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},yGe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},vGe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},W_e={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},gY=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&oOe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i||"Layer"}read(i,r){r&&(r.layer=this),iOe(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r==null?void 0:r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=aGe[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new j("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,ye(F({},r),{layer:this})),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof j&&l.name==="web-document-write:property-required").length;return Wv(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new j("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([d({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([d(W_e)],t.prototype,"listMode",void 0),u([qe("listMode")],t.prototype,"writeListMode",null),u([d({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([qe("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([d(VD)],t.prototype,"opacity",void 0),u([d({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([qe([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),u([d({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([P("esri.layers.mixins.OperationalLayer")],t),t};var Zj;const iV=new wi({asc:"ascending",desc:"descending"});let jT=Zj=class extends ve{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Zj({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([d({type:String,json:{write:!0}})],jT.prototype,"field",void 0),u([d({type:String,json:{write:!0}})],jT.prototype,"valueExpression",void 0),u([d({type:iV.apiValues,json:{read:iV.read,write:iV.write}})],jT.prototype,"order",void 0),jT=Zj=u([P("esri.layers.support.OrderByInfo")],jT);const X_e=jT;function _Ge(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new X_e;return s.read(r,i),[s]}function bGe(e,t,i,r){const s=e.find(n=>!!n.field);s&&Sc(i,[s.toJSON()],t)}const wGe=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([d({type:[X_e],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:_Ge},write:{target:"layerDefinition.orderBy",writer:bGe}}})],t.prototype,"orderBy",void 0),t=u([P("esri.layers.mixins.OrderedLayer")],t),t},xGe=fe.getLogger("esri.portal.PortalItemResource");let C0=class extends Se{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?ye(F({},e),{path:this._normalizePath(e.path,e.portalItem)}):e}set path(e){_(e)&&wc(e)?xGe.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(R(i))throw new j("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:xr(t,"signal")})}async update(e,t){return(await Promise.resolve().then(function(){return XR})).addOrUpdateResource(this,"update",e,t)}hasPath(){return _(this.path)}_normalizePath(e,t){return R(e)?e:(e=e.replace(/^\/+/,""),_(t)&&wc(e)&&(e=hX(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([d()],C0.prototype,"portalItem",void 0),u([d({type:String,value:null})],C0.prototype,"path",null),u([qt("path")],C0.prototype,"_castPath",null),u([d({type:String,readOnly:!0})],C0.prototype,"url",null),u([d({type:String,readOnly:!0})],C0.prototype,"itemRelativeUrl",null),C0=u([P("esri.portal.PortalItemResource")],C0);const TGe=C0;let _R=class extends Se{constructor(e){super(e),this.created=null,this.rating=null}};u([d()],_R.prototype,"created",void 0),u([d()],_R.prototype,"rating",void 0),_R=u([P("esri.portal.PortalRating")],_R);const rV=_R;var HT;let ci=HT=class extends Yw(ey){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return A2(HT,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(i="Instant App"),i}readExtent(e){return e&&e.length?new ai(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",s?xi(i+s+r+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Gn.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:_(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof rV&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new rV({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:re(this.applicationProxies),avgRating:this.avgRating,categories:re(this.categories),created:re(this.created),culture:this.culture,description:this.description,extent:re(this.extent),groupCategories:re(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:re(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:re(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new HT({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const i of["tags","typeKeywords","categories"])e[i]&&(e[i]=e[i].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",ye(F({responseType:e},t),{query:{token:this.apiKey}}))}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",F({query:{token:this.apiKey}},e)).then(t=>t.rating!=null?(t.created=new Date(t.created),new rV(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",F({query:ye(F({},e),{token:this.apiKey})},t),HT)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new j("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")hm(t)?r.query={data:t}:r.query={url:zh(t)},_(i)&&(r.query.filename=i);else{const s=new FormData;_(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new j("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await Promise.resolve().then(function(){return XR})).fetchResources(this,e,t)}async addResource(e,t,i){const r=await Promise.resolve().then(function(){return XR});return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await Promise.resolve().then(function(){return XR});if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new j("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await Promise.resolve().then(function(){return XR})).removeAllResources(this,e)}resourceFromPath(e){return new TGe({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:re(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:re(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:re(this.typeKeywords),url:this.url};return Ohe(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new HT({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([d({type:["private","shared","org","public"]})],ci.prototype,"access",void 0),u([d()],ci.prototype,"accessInformation",void 0),u([d({type:String})],ci.prototype,"apiKey",void 0),u([d({json:{read:{source:"appProxies"}}})],ci.prototype,"applicationProxies",void 0),u([d()],ci.prototype,"avgRating",void 0),u([d()],ci.prototype,"categories",void 0),u([d({type:Date})],ci.prototype,"created",void 0),u([d()],ci.prototype,"culture",void 0),u([d()],ci.prototype,"description",void 0),u([d({readOnly:!0})],ci.prototype,"displayName",null),u([d({type:ai})],ci.prototype,"extent",void 0),u([Ie("extent")],ci.prototype,"readExtent",null),u([d()],ci.prototype,"groupCategories",void 0),u([d({readOnly:!0})],ci.prototype,"iconUrl",null),u([d()],ci.prototype,"id",void 0),u([d({readOnly:!0})],ci.prototype,"isLayer",null),u([d()],ci.prototype,"itemControl",void 0),u([d({readOnly:!0})],ci.prototype,"itemUrl",null),u([d()],ci.prototype,"licenseInfo",void 0),u([d({type:Date})],ci.prototype,"modified",void 0),u([d()],ci.prototype,"name",void 0),u([d()],ci.prototype,"numComments",void 0),u([d()],ci.prototype,"numRatings",void 0),u([d()],ci.prototype,"numViews",void 0),u([d()],ci.prototype,"owner",void 0),u([d()],ci.prototype,"ownerFolder",void 0),u([d({type:Gn})],ci.prototype,"portal",void 0),u([d()],ci.prototype,"screenshots",void 0),u([d()],ci.prototype,"size",void 0),u([d()],ci.prototype,"snippet",void 0),u([d()],ci.prototype,"sourceJSON",void 0),u([d({type:String})],ci.prototype,"spatialReference",void 0),u([d()],ci.prototype,"tags",void 0),u([d()],ci.prototype,"thumbnail",void 0),u([d({readOnly:!0})],ci.prototype,"thumbnailUrl",null),u([d()],ci.prototype,"title",void 0),u([d()],ci.prototype,"type",void 0),u([d()],ci.prototype,"typeKeywords",void 0),u([d({type:String,json:{read(e,t){var r;if(t.type!=="KML")return e;const i=(r=this.portal)==null?void 0:r.restUrl;return e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null),e}}})],ci.prototype,"url",void 0),u([d({readOnly:!0})],ci.prototype,"userItemUrl",null),ci=HT=u([P("esri.portal.PortalItem")],ci);const nE=ci;var Z_e=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:nE});const SGe=fe.getLogger("esri.layers.mixins.PortalLayer"),yY=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var i;(i=this.portalItem)==null||i.destroy(),this.portalItem=null}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new nE({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await import("./layersLoader.37e61b06.js").then(function(n){return n.l});return fi(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData},r)}catch(s){throw Jr(s)||SGe.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(bc(r),!0)))}async _fetchUserHasEditingPrivileges(i){const r=this.url?Gr==null?void 0:Gr.findCredential(this.url):null;if(!r)return!0;const s=MI.credential===r?MI.user:await this._fetchEditingUser(i);return MI.credential=r,MI.user=s,R(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const s=Gr.findServerInfo(this.url);if(!(s==null?void 0:s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Gn.getDefault();if(o&&o.loaded&&fp(o.restUrl)===fp(n))return o.user;const a=`${n}/community/self`,l=_(i)?i.signal:null,c=await ku(Zt(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?bX.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Gn.getDefault());return s&&n&&!Ype(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new j("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,ye(F({},r),{layer:this}))}};return u([d({type:nE})],t.prototype,"portalItem",null),u([Ie("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([qe("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([d({clonable:!1})],t.prototype,"resourceReferences",void 0),u([d({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([P("esri.layers.mixins.PortalLayer")],t),t},MI={credential:null,user:null},_O=new ut,vM=new WeakMap;function EGe(e){Y_e(e)&&_O.push(e)}function CGe(e){Y_e(e)&&_O.includes(e)&&_O.remove(e)}function Y_e(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function Q_e(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:Q_e(t,e%t):0}let sV=0,OI=0;function AGe(){var t;const e=Date.now();for(const i of _O)i.refreshInterval&&e-((t=vM.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&(vM.set(i,e),i.refresh(e))}yde(()=>{const e=Date.now();let t=0;for(const i of _O)t=Q_e(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?vM.get(i)||vM.set(i,e):vM.delete(i);if(t!==OI){if(OI=t,clearInterval(sV),OI===0)return void(sV=0);sV=setInterval(AGe,OI)}});function RGe(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const MGe=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=$5(()=>this.hasDataChanged()),this.when().then(()=>{EGe(this)},()=>{})}destroy(){CGe(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){o9(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{fe.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([d({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([d({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([d()],t.prototype,"refreshParameters",null),t=u([P("esri.layers.mixins.RefreshableLayer")],t),t},vY=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&OGe(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([P("esri.layers.mixins.ScaleRangeLayer")],t),t};function OGe(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const Nb=fa()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var Yj;let bR=Yj=class extends ve{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return D6e(this.value,this.unit,"milliseconds")}clone(){return new Yj({value:this.value,unit:this.unit})}};u([d({type:Number,json:{write:!0},nonNullable:!0})],bR.prototype,"value",void 0),u([d({type:Nb.apiValues,json:{type:Nb.jsonValues,read:Nb.read,write:Nb.write},nonNullable:!0})],bR.prototype,"unit",void 0),bR=Yj=u([P("esri.TimeInterval")],bR);const bO=bR;var Qj;let qT=Qj=class extends ve{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new Qj({respectsDaylightSaving:e,timezone:t})}};u([d({type:Boolean,json:{write:!0}})],qT.prototype,"respectsDaylightSaving",void 0),u([Ie("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],qT.prototype,"readRespectsDaylightSaving",null),u([d({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],qT.prototype,"timezone",void 0),qT=Qj=u([P("esri.layers.support.TimeReference")],qT);const PGe=qT;var Jj;let Sa=Jj=class extends ve{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new mm({start:i,end:r})}writeFullTimeExtent(e,t){e&&_(e.start)&&_(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new bO({value:t.timeInterval,unit:Nb.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new bO({value:t.defaultTimeInterval,unit:Nb.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new Jj({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:re(n),fullTimeExtent:re(o),trackIdField:a,useTime:l})}};u([d({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],Sa.prototype,"cumulative",void 0),u([d({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],Sa.prototype,"endField",void 0),u([d({type:mm,json:{write:{enabled:!0,allowNull:!0}}})],Sa.prototype,"fullTimeExtent",void 0),u([Ie("fullTimeExtent",["timeExtent"])],Sa.prototype,"readFullTimeExtent",null),u([qe("fullTimeExtent")],Sa.prototype,"writeFullTimeExtent",null),u([d({type:Boolean,json:{write:!0}})],Sa.prototype,"hasLiveData",void 0),u([d({type:bO,json:{write:{enabled:!0,allowNull:!0}}})],Sa.prototype,"interval",void 0),u([Ie("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Sa.prototype,"readInterval",null),u([qe("interval")],Sa.prototype,"writeInterval",null),u([d({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],Sa.prototype,"startField",void 0),u([d({type:PGe,json:{write:{enabled:!0,allowNull:!0}}})],Sa.prototype,"timeReference",void 0),u([d({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Sa.prototype,"trackIdField",void 0),u([d({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],Sa.prototype,"useTime",void 0),Sa=Jj=u([P("esri.layers.support.TimeInfo")],Sa);const J_e=Sa,IGe=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=Nb.fromJSON(s.timeOffsetUnits);return n&&o?new bO({value:n,unit:o}):null}set timeInfo(i){Kde(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([d({type:mm,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([d({type:bO})],t.prototype,"timeOffset",void 0),u([Ie("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([d({value:null,type:J_e,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([d({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([P("esri.layers.mixins.TemporalLayer")],t),t};var Kj;let fg=Kj=class extends ve{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new Kj({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};u([d({constructOnly:!0})],fg.prototype,"name",void 0),u([d({constructOnly:!0})],fg.prototype,"fields",void 0),u([d({constructOnly:!0})],fg.prototype,"isAscending",void 0),u([d({constructOnly:!0})],fg.prototype,"isUnique",void 0),u([d({constructOnly:!0})],fg.prototype,"description",void 0),fg=Kj=u([P("esri.layers.support.FeatureIndex")],fg);let kg=class extends ve{constructor(){super(...arguments),this.type=null}};u([d({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],kg.prototype,"type",void 0),kg=u([P("esri.layers.support.FeatureReduction")],kg);var eH;let WT=eH=class extends ve{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new eH({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};u([d({type:String,json:{write:!0}})],WT.prototype,"statisticType",void 0),u([d({type:String,json:{write:!0}})],WT.prototype,"onStatisticField",void 0),u([d({type:String,json:{write:!0}})],WT.prototype,"onStatisticValueExpression",void 0),WT=eH=u([P("esri.layers.support.OutStatistic")],WT);const $Ge=WT;var tH;let wR=tH=class extends ve{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new tH({name:this.name,outStatistic:this.outStatistic.clone()})}};u([d({type:String,json:{write:!0}})],wR.prototype,"name",void 0),u([d({type:$Ge,json:{write:!0}})],wR.prototype,"outStatistic",void 0),wR=tH=u([P("esri.layers.support.AggregateField")],wR);const K_e=wR,_Y="__begin__",bY="__end__",LGe=new RegExp(_Y,"ig"),DGe=new RegExp(bY,"ig"),xre=new RegExp("^"+_Y,"i"),Tre=new RegExp(bY+"$","i"),o4='"',NGe=o4+" + ",FGe=" + "+o4;function kGe(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function UGe(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function Wk(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=kGe(e.labelExpression),t.type="conventional"),t}function zGe(e){const t=Wk(e);if(!t)return null;switch(t.type){case"conventional":return iH(t.expression);case"arcade":return t.expression}return null}function VGe(e){const t=Wk(e);if(!t)return null;switch(t.type){case"conventional":return GGe(t.expression);case"arcade":return wY(t.expression)}return null}function iH(e){let t;return e?(t=qf(e,i=>_Y+'$feature["'+i+'"]'+bY),t=xre.test(t)?t.replace(xre,""):o4+t,t=Tre.test(t)?t.replace(Tre,""):t+o4,t=t.replace(LGe,NGe).replace(DGe,FGe)):t='""',t}const BGe=/^\s*\{([^}]+)\}\s*$/i;function GGe(e){const t=e.match(BGe);return t&&t[1].trim()||null}const jGe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,HGe=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,qGe=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function wY(e){if(!e)return null;let t=jGe.exec(e)||HGe.exec(e);return t?t[1]||t[3]:(t=qGe.exec(e),t?t[2]:null)}var rH;let A0=rH=class extends ve{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?iH(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=iH(this.value)),e!=null&&(t[i]=e)}clone(){return new rH({expression:this.expression,title:this.title,value:this.value})}};u([d({type:String,json:{write:{writerEnsuresNonNull:!0}}})],A0.prototype,"expression",void 0),u([Ie("expression",["expression","value"])],A0.prototype,"readExpression",null),u([qe("expression")],A0.prototype,"writeExpression",null),u([d({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],A0.prototype,"title",void 0),u([d({json:{read:!1,write:!1}})],A0.prototype,"value",void 0),A0=rH=u([P("esri.layers.support.LabelExpressionInfo")],A0);const e1e=A0,t1e=[252,146,31,255],eEt=[153,153,153,255],WGe={type:"esriSMS",style:"esriSMSCircle",size:6,color:t1e,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},XGe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:t1e},ZGe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},YGe={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},QGe={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},JGe={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},KGe={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},tEt=xc.fromJSON(WGe),iEt=Pc.fromJSON(XGe),rEt=dm.fromJSON(ZGe),e7e=HE.fromJSON(YGe);xc.fromJSON(QGe);Pc.fromJSON(JGe);dm.fromJSON(KGe);var sH;const PI=new wi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function i1e(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function t7e(e){return(e==null?void 0:e.type)==="map-image"}function r1e(e){var t,i;return!!t7e(e)&&!!((i=(t=e.capabilities)==null?void 0:t.exportMap)==null?void 0:i.supportsArcadeExpressionForLabeling)}function i7e(e){return i1e(e)||r1e(e.layer)}let Zs=sH=class extends ve{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=e7e,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],o=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=UGe(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=wY(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&i1e(r))e=new e1e({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return Wk(this)}getLabelExpressionArcade(){return zGe(this)}getLabelExpressionSingleField(){return VGe(this)}hash(){return JSON.stringify(this)}clone(){return new sH({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:re(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:re(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([d({type:String,json:{write:!0}})],Zs.prototype,"name",void 0),u([d({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],Zs.prototype,"allowOverrun",void 0),u([d({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],Zs.prototype,"deconflictionStrategy",void 0),u([d({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&r1e(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],Zs.prototype,"labelExpression",void 0),u([Ie("labelExpression")],Zs.prototype,"readLabelExpression",null),u([qe("labelExpression")],Zs.prototype,"writeLabelExpression",null),u([d({type:e1e,json:{write:{overridePolicy:(e,t,i)=>i7e(i)?{allowNull:!0}:{enabled:!1}}}})],Zs.prototype,"labelExpressionInfo",void 0),u([qe("labelExpressionInfo")],Zs.prototype,"writeLabelExpressionInfo",null),u([d({type:PI.apiValues,json:{type:PI.jsonValues,read:PI.read,write:PI.write}})],Zs.prototype,"labelPlacement",void 0),u([d({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],Zs.prototype,"labelPosition",void 0),u([d({type:Number})],Zs.prototype,"maxScale",void 0),u([qe("maxScale")],Zs.prototype,"writeMaxScale",null),u([d({type:Number})],Zs.prototype,"minScale",void 0),u([qe("minScale")],Zs.prototype,"writeMinScale",null),u([d({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],Zs.prototype,"repeatLabel",void 0),u([d({type:Number,cast:ir,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Zs.prototype,"repeatLabelDistance",void 0),u([d({types:_$e,json:{origins:{"web-scene":{types:b$e,write:Dee,default:null}},write:Dee,default:null}})],Zs.prototype,"symbol",void 0),u([d({type:Boolean,json:{write:!0}})],Zs.prototype,"useCodedValues",void 0),u([d({type:String,json:{write:!0}})],Zs.prototype,"where",void 0),Zs=sH=u([P("esri.layers.support.LabelClass")],Zs);const W3=Zs;var nH;let $d=nH=class extends kg{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new nH({fields:re(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate),renderer:re(this.renderer)})}};u([at({binning:"binning"})],$d.prototype,"type",void 0),u([d({type:Number,json:{write:!0}})],$d.prototype,"fixedBinLevel",void 0),u([d({type:[W3],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],$d.prototype,"labelingInfo",void 0),u([d(qk)],$d.prototype,"labelsVisible",void 0),u([d(Hk)],$d.prototype,"popupEnabled",void 0),u([d({type:WE,json:{name:"popupInfo",write:!0}})],$d.prototype,"popupTemplate",void 0),u([d({type:[K_e],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],$d.prototype,"fields",void 0),u([d({types:Bk,json:{write:!0}})],$d.prototype,"renderer",void 0),$d=nH=u([P("esri.layers.support.FeatureReductionBinning")],$d);const r7e=$d;var oH;let Ql=oH=class extends ve{constructor(e){super(e),this.type="cluster",this.clusterRadius=ir("80px"),this.clusterMinSize=ir("12px"),this.clusterMaxSize=ir("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new oH({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:re(this.labelingInfo),labelsVisible:this.labelsVisible,fields:re(this.fields),renderer:re(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:re(this.popupTemplate)})}};u([d({type:["cluster"],readOnly:!0,json:{write:!0}})],Ql.prototype,"type",void 0),u([d({type:Number,cast:e=>e==="auto"?e:ir(e),json:{write:!0}})],Ql.prototype,"clusterRadius",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],Ql.prototype,"clusterMinSize",void 0),u([d({type:Number,cast:ir,json:{write:!0}})],Ql.prototype,"clusterMaxSize",void 0),u([d(Hk)],Ql.prototype,"popupEnabled",void 0),u([d({type:WE,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ql.prototype,"popupTemplate",void 0),u([d({types:Bk,json:{write:!0}})],Ql.prototype,"renderer",void 0),u([d({types:y$e})],Ql.prototype,"symbol",void 0),u([d({type:[W3],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ql.prototype,"labelingInfo",void 0),u([d(qk)],Ql.prototype,"labelsVisible",void 0),u([d({type:[K_e],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Ql.prototype,"fields",void 0),Ql=oH=u([P("esri.layers.support.FeatureReductionCluster")],Ql);const s1e=Ql;var aH;let BD=aH=class extends kg{constructor(e){super(e),this.type="selection"}clone(){return new aH}};u([d({type:["selection"]})],BD.prototype,"type",void 0),BD=aH=u([P("esri.layers.support.FeatureReductionSelection")],BD);const lH=BD,Sre={key:"type",base:kg,typeMap:{selection:s1e}},s7e={types:{key:"type",base:kg,typeMap:{selection:lH,cluster:s1e,binning:r7e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Sre},"portal-item":{types:Sre},"web-scene":{types:{key:"type",base:kg,typeMap:{selection:lH}}}}}},Ere=new wi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let R0=class extends Ic(ve){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([d({json:{write:!0}})],R0.prototype,"name",void 0),u([d({json:{write:!0}})],R0.prototype,"description",void 0),u([d({json:{read:Ere.read,write:Ere.write}})],R0.prototype,"drawingTool",void 0),u([d({json:{write:!0}})],R0.prototype,"prototype",void 0),u([d({json:{write:!0}})],R0.prototype,"thumbnail",void 0),R0=u([P("esri.layers.support.FeatureTemplate")],R0);const xY=R0;let Jm=class extends Ic(ve){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=VZ(e[i]);return t}writeDomains(e,t){var r;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON());t.domains=i}};u([d({json:{write:!0}})],Jm.prototype,"id",void 0),u([d({json:{write:!0}})],Jm.prototype,"name",void 0),u([d({json:{write:!0}})],Jm.prototype,"domains",void 0),u([Ie("domains")],Jm.prototype,"readDomains",null),u([qe("domains")],Jm.prototype,"writeDomains",null),u([d({type:[xY],json:{write:!0}})],Jm.prototype,"templates",void 0),Jm=u([P("esri.layers.support.FeatureType")],Jm);const n1e=Jm;function n7e(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function Cre(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function Are(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class o1e{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const i=[];for(const r of t){const s=r&&r.name;if(s){const n=Rre(s);this._fieldsMap.set(s,r),this._fieldsMap.set(n,r),i.push(n),n7e(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):D5(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),Cre(r)||Are(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)Cre(t)||Are(t)||t.nullable||a3e(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(Rre(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const i=this.get(t);if(i)return i.name}}function Rre(e){return e.toLowerCase().trim()}const o7e=fe.getLogger("esri.layers.support.fieldProperties");function a1e(){return{fields:{type:[V3],value:null},fieldsIndex:{readOnly:!0,get(){return new o1e(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||o7e.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return epe(this.fieldsIndex,e)}}}}let XT=class extends Ic(ve){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([d({type:String,json:{read:{source:"shapeAreaFieldName"}}})],XT.prototype,"shapeAreaField",void 0),u([d({type:String,json:{read:{source:"shapeLengthFieldName"}}})],XT.prototype,"shapeLengthField",void 0),u([d({type:String,json:{read:e=>vLe.read(e)||_Le.read(e)}})],XT.prototype,"units",void 0),XT=u([P("esri.layers.support.GeometryFieldsInfo")],XT);const a7e=XT,l7e=/\[([^\[\]]+)\]/gi;function a4(e,t,i){return e?e.map(r=>{const s=new W3;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(l7e,(o,a)=>`[${c7e(a,n)}]`)}return s}):null}function c7e(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}var cH;let ZT=cH=class extends ve{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new ut}clone(){return new cH({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([d({type:String,json:{write:!0}})],ZT.prototype,"floorField",void 0),u([d({json:{read:!1,write:!1}})],ZT.prototype,"viewAllMode",void 0),u([d({json:{read:!1,write:!1}})],ZT.prototype,"viewAllLevelIds",void 0),ZT=cH=u([P("esri.layers.support.LayerFloorInfo")],ZT);const l1e=ZT,Mre=new wi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),Ore=new wi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let uh=class extends Ic(ve){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([d({json:{read:Mre.read,write:Mre.write}})],uh.prototype,"cardinality",void 0),u([d({json:{read:!0,write:!0}})],uh.prototype,"composite",void 0),u([d({json:{read:!0,write:!0}})],uh.prototype,"id",void 0),u([d({json:{read:!0,write:!0}})],uh.prototype,"keyField",void 0),u([d({json:{read:!0,write:!0}})],uh.prototype,"keyFieldInRelationshipTable",void 0),u([d({json:{read:!0,write:!0}})],uh.prototype,"name",void 0),u([d({json:{read:!0,write:!0}})],uh.prototype,"relatedTableId",void 0),u([d({json:{read:!0,write:!0}})],uh.prototype,"relationshipTableId",void 0),u([d({json:{read:Ore.read,write:Ore.write}})],uh.prototype,"role",void 0),uh=u([P("esri.layers.support.Relationship")],uh);const u7e=uh,Ld=[];function h7e(e,t){if(z_e(e.url))return!0;const{wkid:i}=t;for(const r of Ld){if(e.version>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}Ld.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),Ld.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),Ld.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),Ld.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),Ld.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),Ld.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),Ld.push([10.61,()=>new Set([102497])]),Ld.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),Ld.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),Ld.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function c1e(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await ku(r.populateFromStyle());if(fi(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new ja("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const d7e=["oid","global-id"],p7e=["oid","global-id","guid"];function u1e({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=_7e({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=x7e({titleBase:s,fields:i,displayField:e}),l=w7e();return new WE({title:a,content:l,fieldInfos:o})}const f7e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],m7e=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!h1e(e.name,t)&&(!i||e.name!==i)&&!d7e.includes(e.type)&&!f7e.some(s=>s.test(e.name));function g7e(e,t){const i=e;return t&&(e=e.filter(r=>!t.includes(r.type))),e===i&&(e=e.slice()),e.sort(y7e),e}function y7e(e,t){return e.type==="oid"?-1:t.type==="oid"?1:Pre(e)?-1:Pre(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function h1e(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function v7e(e,t){return e.editable&&!p7e.includes(e.type)&&!h1e(e.name,t)}function _7e({editFieldsInfo:e,fields:t,objectIdField:i},r){return g7e(t,(r==null?void 0:r.ignoreFieldTypes)||T7e).map(s=>new L3({fieldName:s.name,isEditable:v7e(s,e),label:s.alias,format:b7e(s),visible:m7e(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function b7e(e){switch(e.type){case"small-integer":case"integer":case"single":return new CS({digitSeparator:!0,places:0});case"double":return new CS({digitSeparator:!0,places:2});case"date":return new CS({dateFormat:"long-month-day-year"});default:return e.type==="string"&&ope(e.name)?new CS({digitSeparator:!0,places:0}):null}}function w7e(){return[new V2,new rO]}function x7e(e){const t=i3e(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}function Pre(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const T7e=["geometry","blob","raster","guid","xml"],nV=new wi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),S7e={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},Xs="FeatureLayer",Ire=fe.getLogger("esri.layers.FeatureLayer");function II(e,t){return new j("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function $re(e){return e&&e instanceof ut}function Ut(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function $I(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function E7e(e){var i;const t=(i=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(t==null?void 0:t.includes("envelopeaggregate")),centroid:!!(t==null?void 0:t.includes("centroidaggregate")),convexHull:!!(t==null?void 0:t.includes("convexhullaggregate"))}}function FC(e,t){var r;const i=(r=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i==null?void 0:i.includes(t.toLowerCase()))}const oV=a1e();function aV(e,t,i){const r=!!(i==null?void 0:i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Le=class extends oGe(iGe(wGe(IGe(vY(MGe(fY(gY(yY(Gk(rGe(pY(Ic(sE))))))))))))){constructor(...e){super(...e),this._handles=new Nt,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=et.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(ut.ofType(fg)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=lt(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}load(e){const t=_(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(r=>this._initLayerProperties(r)));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(bc).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(t);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new j("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:i.lastEditDate!=null?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){(r==null?void 0:r.writeLayerSchema)&&Sc(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}get parsedUrl(){const e=this.url?js(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=Ll(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Ll(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){cF(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const s=M_e(r,t,i)||void 0;return s||Ire.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),s}if(t.defaultSymbol)return t.types&&t.types.length?new UX({defaultSymbol:lV(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:lV(s.symbol,s,i)}))}):new uY({symbol:lV(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&($re(t)&&this._resetMemorySource(t),$re(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof ut?new pg({layer:this,items:e}):e:null}readSource(e,t){const i=Dk.fromJSON(t.featureSet);return new pg({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>xY.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?U_e(this.url,i):i;let n=i;if(!n&&this.url){const o=Cw(this.url);_(o)&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),jk(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=n1e.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}set url(e){const t=V_e({layer:this,url:e,nonStandardUrlAllowed:!0,logger:Ire});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){B_e(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new j(Xs,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,i){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new j(Xs,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)})}async applyEdits(e,t){const i=await import("./editingSupport.311b5f05.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return u1e(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await RMe(import("./FeatureLayerSource.694d31cc.js"),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new Fh,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"];const r=_(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,s=P_e(this.definitionExpression,r);e.where=s||"1=1";const{timeOffset:n,timeExtent:o}=this;return e.timeExtent=n!=null&&o!=null?o.offset(-n.value,n.unit):o||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new j(Xs,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new j(Xs,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=F7.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new j(Xs,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:r,globalIds:s,num:n,size:o,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=r&&r.length>1,h=i&&i.length,p=s&&s.length,f=o&&o.length;if(c||h||p||f||n||a||l)throw new j(Xs,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||l))throw new j(Xs,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new j(Xs,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(Fh.from(e)||this.createQuery(),t)).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(Fh.from(e)||this.createQuery(),t);throw new j(Xs,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(Fh.from(e)||this.createQuery(),t);throw new j(Xs,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(Fh.from(e)||this.createQuery(),t);throw new j(Xs,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(hj.from(e),t);throw new j(Xs,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(hj.from(e),t);throw new j(Xs,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(bI.from(e),t).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i});throw new j(Xs,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(bI.from(e),t);throw new j(Xs,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(bI.from(e),t);throw new j(Xs,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(bI.from(e),t);throw new j(Xs,"Layer source does not support queryFeatureCount capability")})}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var n;t=ye(F({},t),{writeLayerSchema:(n=t==null?void 0:t.writeLayerSchema)!=null?n:this._hasMemorySource()});const{origin:i,layerContainerType:r,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(II(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&r!=="tables")return s==null||s.push(II(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(II(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&r==="tables")return s==null||s.push(II(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new j(Xs,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||h7e(this,e))}async save(e){return(await import("./featureLayerUtils.d5fbb577.js")).save(this,e)}async saveAs(e,t){return(await import("./featureLayerUtils.d5fbb577.js")).saveAs(this,e,t)}_readEditingEnabled(e,t,i){var s;let r=(s=e.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){var s,n;if(!e){const o=((n=(s=this.capabilities)==null?void 0:s.operations)==null?void 0:n.supportsSync)?"Query,Sync":"Query";Sc("layerDefinition.capabilities",o,t),i&&!(r==null?void 0:r.writeLayerSchema)&&(t.capabilities=o)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new j(Xs,`feature is missing the identifying attribute ${i}`)):Promise.reject(new j(Xs,"'attributes' are required on a feature to query attachments")):Promise.reject(new j(Xs,"A feature is required to add/delete/update attachments")):Promise.reject(new j(Xs,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return Zt(this.url,{query:ye(F({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),cF(this.renderer,this.fieldsIndex),Kde(this.timeInfo,this.fieldsIndex),c1e(this,{origin:"service"})}async hasDataChanged(){var e,t;if((e=this.source)==null?void 0:e.refresh)try{const{dataChanged:i,updates:r}=await((t=this.source)==null?void 0:t.refresh());if(_(r)&&(this.sourceJSON=F(F({},this.sourceJSON),r),this.read(r,{origin:"service",url:this.parsedUrl})),i)return!0}catch{}if(this.definitionExpression)try{return(await I9e(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var t;const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((t=this.fields)==null?void 0:t.some(i=>i.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new j("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new j("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:FC(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:FC(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:Ut(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(r=>{const s=S7e[r.name];s&&(i[s]=!!r.isEnabled)}),i}_readDataCapabilities(e){return{isVersioned:Ut(e,"isDataVersioned",!1),supportsAttachment:Ut(e,"hasAttachments",!1),supportsM:Ut(e,"hasM",!1),supportsZ:Ut(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:Ut(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map(p=>p.trim()):[],r=this.url?Cw(this.url):null,s=i.includes(_(r)&&r.serverType==="MapServer"?"data":"query"),n=i.includes("editing")&&!t.datesInUnknownTimezone;let o=n&&i.includes("create"),a=n&&i.includes("delete"),l=n&&i.includes("update");const c=i.includes("changetracking"),h=t.advancedQueryCapabilities;return n&&!(o||a||l)&&(o=a=l=!0),{supportsCalculate:Ut(t,"supportsCalculate",!1),supportsTruncate:Ut(t,"supportsTruncate",!1),supportsValidateSql:Ut(t,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:a,supportsEditing:n,supportsChangeTracking:c,supportsQuery:s,supportsQueryAnalytics:Ut(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:Ut(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:Ut(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:Ut(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:Ut(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var l;const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=(l=this.url)==null?void 0:l.includes("MapServer"),n=!he("mapserver-pbf-enabled")&&s&&this.version<10.81,o=z_e(this.url),a=(e.supportedQueryFormats||"").split(",").reduce((c,h)=>{const p=h.toLowerCase().trim();return p&&c.add(p),c},new Set);return{supportsStatistics:Ut(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:Ut(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:Ut(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:E7e(t),supportsCentroid:Ut(t,"supportsReturningGeometryCentroid",!1),supportsDistance:Ut(t,"supportsQueryWithDistance",!1),supportsDistinct:Ut(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:Ut(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:Ut(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:Ut(t,"supportsHavingClause",!1),supportsOrderBy:Ut(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:Ut(t,"supportsPagination",!1),supportsQuantization:Ut(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:Ut(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:Ut(e,"supportsReturningQueryGeometry",!1),supportsResultType:Ut(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:Ut(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:Ut(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:Ut(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:Ut(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:Ut(i,"allowOthersToQuery",!0),supportsHistoricMoment:Ut(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!n&&a.has("pbf"),supportsDisjointSpatialRelationship:Ut(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:Ut(t,"supportsQueryWithCacheHint",!1)||FC(t,"query"),supportsDefaultSpatialReference:Ut(t,"supportsDefaultSR",!1),supportsCompactGeometry:o,maxRecordCountFactor:$I(e,"maxRecordCountFactor",void 0),maxRecordCount:$I(e,"maxRecordCount",void 0),standardMaxRecordCount:$I(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:$I(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=Ut(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:Ut(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:FC(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:FC(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:Ut(e,"allowGeometryUpdates",!0),supportsGlobalId:Ut(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:Ut(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:Ut(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:Ut(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:Ut(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:Ut(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:Ut(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:Ut(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:Ut(t,"allowOthersToUpdate",!0)}}};u([d({readOnly:!0,json:{read:!1}})],Le.prototype,"capabilities",void 0),u([Ie("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Le.prototype,"readCapabilities",null),u([d({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Le.prototype,"charts",void 0),u([d({readOnly:!0})],Le.prototype,"createQueryVersion",null),u([d({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Le.prototype,"copyright",void 0),u([d({type:Boolean})],Le.prototype,"datesInUnknownTimezone",void 0),u([d({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Le.prototype,"displayField",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Le.prototype,"definitionExpression",void 0),u([d({types:Yb,readOnly:!0})],Le.prototype,"defaultSymbol",void 0),u([d({type:qd})],Le.prototype,"dynamicDataSource",void 0),u([d({readOnly:!0})],Le.prototype,"editFieldsInfo",void 0),u([d({type:Boolean})],Le.prototype,"editingEnabled",null),u([Ie(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Le.prototype,"readEditingEnabled",null),u([Ie("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Le.prototype,"readEditingEnabledFromWebMap",null),u([qe(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Le.prototype,"writeEditingEnabled",null),u([qe("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Le.prototype,"writeEditingEnabledToWebMap",null),u([d({readOnly:!0})],Le.prototype,"editingInfo",void 0),u([Ie("editingInfo")],Le.prototype,"readEditingInfo",null),u([d((()=>{const e=re(mY),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],Le.prototype,"elevationInfo",void 0),u([d(s7e)],Le.prototype,"featureReduction",void 0),u([d(ye(F({},oV.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:aV}}}}}))],Le.prototype,"fields",void 0),u([d(oV.fieldsIndex)],Le.prototype,"fieldsIndex",void 0),u([d({type:l1e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Le.prototype,"floorInfo",void 0),u([d({type:j9e,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Le.prototype,"formTemplate",void 0),u([d({type:ai,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Le.prototype,"fullExtent",void 0),u([d()],Le.prototype,"gdbVersion",void 0),u([d({readOnly:!0,type:a7e,json:{read:{source:"geometryProperties"}}})],Le.prototype,"geometryFieldsInfo",void 0),u([d({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:nV.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:aV,writer(e,t,i){const r=e?nV.toJSON(e):null;r&&Sc(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:nV.read}}})],Le.prototype,"geometryType",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Le.prototype,"hasM",void 0),u([d({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Le.prototype,"hasZ",void 0),u([d({readOnly:!0,type:ox})],Le.prototype,"heightModelInfo",void 0),u([d({type:Date})],Le.prototype,"historicMoment",void 0),u([d(q_e)],Le.prototype,"id",void 0),u([d({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Le.prototype,"infoFor3D",void 0),u([d({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Le.prototype,"isTable",void 0),u([Ie("service","isTable",["type","geometryType"]),Ie("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Le.prototype,"readIsTable",null),u([qe("web-map","isTable")],Le.prototype,"writeIsTable",null),u([d(qk)],Le.prototype,"labelsVisible",void 0),u([d({type:[W3],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:a4},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:a4},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Le.prototype,"labelingInfo",void 0),u([d((()=>{const e=re(mGe);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,i,r){Sc(r,U5(t),i)}}},e})())],Le.prototype,"opacity",void 0),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],Le.prototype,"layerId",void 0),u([d(H_e)],Le.prototype,"legendEnabled",void 0),u([d({type:["show","hide"],json:(()=>{const e=re(W_e.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],Le.prototype,"listMode",void 0),u([d(yGe)],Le.prototype,"minScale",void 0),u([Ie("service","minScale",["minScale","effectiveMinScale"])],Le.prototype,"readMinScale",null),u([d(vGe)],Le.prototype,"maxScale",void 0),u([Ie("service","maxScale",["maxScale","effectiveMaxScale"])],Le.prototype,"readMaxScale",null),u([d({type:String})],Le.prototype,"globalIdField",void 0),u([Ie("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),Ie("service","globalIdField",["globalIdField","fields"])],Le.prototype,"readGlobalIdFieldFromService",null),u([d({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:aV}}}}})],Le.prototype,"objectIdField",void 0),u([Ie("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),Ie("service","objectIdField",["objectIdField","fields"])],Le.prototype,"readObjectIdFieldFromService",null),u([d({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Le.prototype,"operationalLayerType",void 0),u([d(oV.outFields)],Le.prototype,"outFields",void 0),u([d({readOnly:!0})],Le.prototype,"parsedUrl",null),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Le.prototype,"path",void 0),u([d(Hk)],Le.prototype,"popupEnabled",void 0),u([d({type:WE,json:{name:"popupInfo",write:!0}})],Le.prototype,"popupTemplate",void 0),u([d({readOnly:!0})],Le.prototype,"defaultPopupTemplate",null),u([d({type:[u7e],readOnly:!0})],Le.prototype,"relationships",void 0),u([d({types:Bk,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:R_e,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Le.prototype,"renderer",null),u([Ie("service","renderer",["drawingInfo.renderer","defaultSymbol"]),Ie("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Le.prototype,"readRenderer",null),u([d()],Le.prototype,"sourceJSON",void 0),u([d({type:Boolean})],Le.prototype,"returnM",void 0),u([d({type:Boolean})],Le.prototype,"returnZ",void 0),u([d((()=>{const e=re(G_e);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Le.prototype,"screenSizePerspectiveEnabled",void 0),u([d({clonable:!1})],Le.prototype,"source",null),u([qt("source")],Le.prototype,"castSource",null),u([Ie("portal-item","source",["featureSet"]),Ie("web-map","source",["featureSet"])],Le.prototype,"readSource",null),u([d({readOnly:!0})],Le.prototype,"serviceDefinitionExpression",void 0),u([Ie("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Le.prototype,"readServiceDefinitionExpression",null),u([d({type:et,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Le.prototype,"spatialReference",void 0),u([d({type:Number})],Le.prototype,"subtypeCode",void 0),u([d({type:String,json:{origins:{service:{read:!0}}}})],Le.prototype,"subtypeField",void 0),u([d({type:[xY]})],Le.prototype,"templates",void 0),u([Ie("templates",["editFieldsInfo","creatorField","editorField","templates"])],Le.prototype,"readTemplates",null),u([d({type:J_e})],Le.prototype,"timeInfo",void 0),u([d()],Le.prototype,"title",void 0),u([Ie("service","title",["name"]),Ie("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Le.prototype,"readTitle",null),u([Ie("web-map","title",["layerDefinition.name","title"])],Le.prototype,"readTitleFromWebMap",null),u([d({type:String})],Le.prototype,"sublayerTitleMode",void 0),u([d({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Le.prototype,"trackIdField",void 0),u([d({json:{read:!1}})],Le.prototype,"type",void 0),u([d({type:String})],Le.prototype,"typeIdField",void 0),u([Ie("service","typeIdField"),Ie("typeIdField",["layerDefinition.typeIdField"])],Le.prototype,"readTypeIdField",null),u([d({type:[n1e]})],Le.prototype,"types",void 0),u([Ie("service","types",["types"]),Ie("types",["layerDefinition.types"])],Le.prototype,"readTypes",null),u([d({readOnly:!0,json:{write:!1}})],Le.prototype,"serverGens",void 0),u([d({type:ut.ofType(fg),readOnly:!0})],Le.prototype,"indexes",void 0),u([d(j_e)],Le.prototype,"url",null),u([qe("url")],Le.prototype,"writeUrl",null),u([d({readOnly:!0})],Le.prototype,"userIsAdmin",void 0),u([d({json:{origins:{service:{read:!0}},read:!1}})],Le.prototype,"version",void 0),u([Ie("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Le.prototype,"readVersion",null),u([d({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Le.prototype,"visible",void 0),u([Ie("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Le.prototype,"readVisible",null),Le=u([P("esri.layers.FeatureLayer")],Le);const lV=UE({types:Ffe}),l4=Le;var sEt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:l4});const C7e=["$datastore","$map","$layer","$aggregatedfeatures"],A7e="esri.widgets.Feature.support.arcadeFeatureUtils",R7e=fe.getLogger(A7e);function M7e(e){return typeof e=="string"?k3(AZ(e)):Array.isArray(e)?O7e(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?P7e(e):e}function O7e(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?k3(AZ(t)):t}</li>`).join("")}</ul>`}function P7e(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?k3(AZ(i)):i}</td></tr>`}).join("")}</table>`}function I7e({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(r.vars[c]=t.convertMapToFeatureSetCollection(h)),c==="$layer"&&(r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(r.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:f,objectIdField:m,geometryType:y,spatialReference:v,displayField:w}=p,b=new l4(ye(F({fields:f,objectIdField:m,geometryType:y,spatialReference:v,displayField:w},p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null),{source:e}));r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:b,spatialReference:s.sr,interceptor:a})}})}function d1e(){return import("./arcadeUtils.602ddc11.js").then(function(e){return e.t})}async function $7e({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function p1e({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=C7e.filter(m=>t.hasVariable(a,m)),[c]=await Promise.all([$7e({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:r}),p=t.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,I7e({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const f=t.createFunction(a,p);return t.executeAsyncFunction(f,p).catch(m=>R7e.error("arcade-execution-error",{error:m,graphic:n,expressionInfo:e}))}async function L7e({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await d1e(),a={};for(const h of e)a[`expression/${h.name}`]=p1e({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await gs(a),c={};for(const h in l)c[h]=M7e(l[h].value);return c}const D7e=1;let Yc=class extends g_(Se){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var r,s;const t=(r=this.contentElement)==null?void 0:r.type;(s=this.contentElementViewModel)==null||s.destroy();const i=t==="fields"?new Tk:t==="media"?new Db:t==="text"?new HF:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=_Z(this._compile,D7e,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const l=await d1e();if(a!==this._abortController)return;const c=await p1e({arcadeUtils:l,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await aY(c,a.signal),p=h==null?void 0:h.type,f=p==="media"?oO.fromJSON(h):p==="text"?B2.fromJSON(h):p==="fields"?V2.fromJSON(h):null;this._set("contentElement",f)},this.handles.add([ie(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),Rt),ie(()=>[this.contentElement],()=>this._createVM(),Rt)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};u([d()],Yc.prototype,"_abortController",void 0),u([d({type:Xfe})],Yc.prototype,"expressionInfo",void 0),u([d({type:Ha})],Yc.prototype,"graphic",void 0),u([d({readOnly:!0})],Yc.prototype,"contentElement",void 0),u([d({readOnly:!0})],Yc.prototype,"contentElementViewModel",void 0),u([d()],Yc.prototype,"interceptor",void 0),u([d()],Yc.prototype,"spatialReference",null),u([d({readOnly:!0})],Yc.prototype,"state",null),u([d()],Yc.prototype,"map",null),u([d()],Yc.prototype,"view",void 0),Yc=u([P("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Yc);const TY=Yc,LI={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let GD=class extends Wn{constructor(e,t){super(e,t),this.viewModel=new TY}initialize(){this.own(ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),Rt))}destroy(){this._destroyContentWidget()}renderLoading(){return k("div",{key:"loading-container",class:LI.loadingSpinnerContainer},k("span",{class:this.classes(LI.iconLoading,LI.spinner)}))}render(){var t;const{state:e}=this.viewModel;return k("div",{class:LI.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new T0e({viewModel:e}):i==="media"?new gve({viewModel:e}):i==="text"?new ED({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};u([d({type:TY})],GD.prototype,"viewModel",void 0),GD=u([P("esri.widgets.Feature.FeatureExpression")],GD);const N7e=GD;class F7e{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var jD;const k7e=1,Lre="content-view-models",f1e="esri.widgets.FeatureViewModel",U7e=fe.getLogger(f1e),Dre={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let ws=jD=class extends Se{constructor(e){super(e),this._handles=new Nt,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=_Z(this._graphicChanged,k7e,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=F({},Dre),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&i.attachmentsContent||t.type==="custom"&&i.customContent||t.type==="fields"&&i.fieldsContent||t.type==="media"&&i.mediaContent||t.type==="text"&&i.textContent||t.type==="expression"&&i.expressionContent},this._handles.add(ie(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),Rt))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return _(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return Hke(jte(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return c0e(this.graphic)}castAbilities(e){return F(F({},Dre),e)}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Db&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Db&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Db&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){Jr(i)||(this._error=i,U7e.error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)):typeof e=="string"?this._compileText(new B2({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(Lre),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new TY({expressionInfo:i,graphic:r,interceptor:jD.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(ie(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),Rt),Lre),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new MZ(F({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new HF({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:$b({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:$b({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=F(F({},r.global),r.content[t]),n=(c=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>h0e(h)||Rg(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=e;return F({attributes:s,expressionInfos:o,fieldInfos:n},this._compileTitleAndDesc({title:l,description:a}))}_compileFields(e,t){const i=e.clone(),r=new Tk(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:h}=r,{description:p,mediaInfos:f,title:m}=e;return F({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,layer:l,fieldInfoMap:s,formattedAttributes:F(F({},n.global),n.content[t]),expressionAttributes:c,mediaInfos:f,popupTemplate:o,relatedInfos:a},this._compileTitleAndDesc({title:m,description:p}))}_compileMedia(e,t){const i=e.clone(),r=new Db(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=$b({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new HF(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?jke(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r,o=this.formattedAttributes.global;return $b({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.title;return GF(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.content;return GF(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await gs({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await Xke({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:h}}=await gs({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:L7e({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:r,map:o,interceptor:jD.interceptor,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes=F(F({},r.attributes),h),this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=E6({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:F(F({},l),e.attributes),layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=E6({fieldInfos:e.fieldInfos,graphic:r,attributes:F(F({},a),e.attributes),layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:E6({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,jte(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=_(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter(c=>c&&Rg(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await gVe({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var f;const h=r.get(c.toString()),p=(f=a[c])==null?void 0:f.value;h&&p&&(h.layerInfo=p.data)});const l=await yVe({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;hVe((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=fj(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||uVe(s,t);o&&(vVe({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};ws.interceptor=new F7e(Qke,Jke),u([d()],ws.prototype,"_error",void 0),u([d()],ws.prototype,"_featureAbortController",void 0),u([d({readOnly:!0})],ws.prototype,"_effectivePopupTemplate",null),u([d({readOnly:!0})],ws.prototype,"_fieldInfoMap",null),u([d({readOnly:!0})],ws.prototype,"_sourceLayer",null),u([d()],ws.prototype,"abilities",void 0),u([qt("abilities")],ws.prototype,"castAbilities",null),u([d({readOnly:!0})],ws.prototype,"content",void 0),u([d({readOnly:!0})],ws.prototype,"contentViewModels",void 0),u([d({type:Boolean})],ws.prototype,"defaultPopupTemplateEnabled",void 0),u([d({readOnly:!0})],ws.prototype,"state",null),u([d({readOnly:!0})],ws.prototype,"formattedAttributes",void 0),u([d({type:Ha,value:null})],ws.prototype,"graphic",null),u([d({readOnly:!0})],ws.prototype,"lastEditInfo",void 0),u([d({readOnly:!0})],ws.prototype,"relatedInfos",void 0),u([d()],ws.prototype,"spatialReference",null),u([d({readOnly:!0})],ws.prototype,"title",void 0),u([d()],ws.prototype,"map",null),u([d({readOnly:!0})],ws.prototype,"waitingForContent",null),u([d()],ws.prototype,"view",void 0),ws=jD=u([P(f1e)],ws);const SY=ws,m1e=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>qF(i)&&!i.destroyed?k("div",{key:i},i.render()):i instanceof HTMLElement?k("div",{key:i,bind:i,afterCreate:this._attachToNode}):x0e(i)?k("div",{key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=u([P("esri.widgets.Feature.ContentMixin")],t),t},Xo={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},Nre={title:!0,content:!0,lastEditedInfo:!0};let ea=class extends m1e(Wn){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=F({},Nre),this.map=null,this.view=null,this.viewModel=new SY}initialize(){this.own(ie(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),Rt))}loadDependencies(){return import("./calcite-notice.fe21908b.js")}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return F(F({},Nre),e)}render(){const{state:e}=this.viewModel,t=k("div",{class:Xo.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return k("div",{class:this.classes(Xo.base,Xo.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return k("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?k("div",{key:"error-title",slot:"title"},e.errorMessage):null,k("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return k("div",{key:"loading-container",class:Xo.loadingSpinnerContainer},k("span",{class:this.classes(Xo.iconLoading,Xo.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?k("div",{class:Xo.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?k(tw,{level:this.headingLevel,class:Xo.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?k("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:k("div",{key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?k("div",{key:this._buildKey("attachments-element",e),class:this.classes(Xo.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:k("div",{key:this._buildKey("expression-element",e),class:Xo.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?k("div",{key:this._buildKey("custom-element",t),class:Xo.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:k("div",{key:this._buildKey("fields-element",e),class:Xo.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:k("div",{key:this._buildKey("media-element",e),class:Xo.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=_h(n,{date:r,user:s});return k("div",{key:"edit-info-element",class:this.classes(Xo.lastEditedInfo,Xo.contentElement)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?k("div",{key:this._buildKey("text-element",t),class:this.classes(Xo.contentElement,Xo.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new lUe({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new T0e({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new gve({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new ED({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new ED({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new N7e({viewModel:r[n]}))},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new ED({viewModel:s}))}this.scheduleRender()}};u([Xe("viewModel.graphic")],ea.prototype,"graphic",void 0),u([Xe("viewModel.defaultPopupTemplateEnabled")],ea.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],ea.prototype,"headingLevel",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ea.prototype,"label",void 0),u([d(),dn("esri/widgets/Feature/t9n/Feature")],ea.prototype,"messages",void 0),u([d(),dn("esri/t9n/common")],ea.prototype,"messagesCommon",void 0),u([d(),dn("esri/widgets/support/t9n/uriUtils")],ea.prototype,"messagesURIUtils",void 0),u([Xe("viewModel.spatialReference")],ea.prototype,"spatialReference",void 0),u([Xe("viewModel.title")],ea.prototype,"title",void 0),u([d()],ea.prototype,"visibleElements",void 0),u([qt("visibleElements")],ea.prototype,"castVisibleElements",null),u([Xe("viewModel.map")],ea.prototype,"map",void 0),u([Xe("viewModel.view")],ea.prototype,"view",void 0),u([d({type:SY})],ea.prototype,"viewModel",void 0),ea=u([P("esri.widgets.Feature")],ea);const z7e=ea;var g1e;const HD=Symbol("anchorHandles");let z1=class extends as.EventedAccessor{constructor(e){super(e),this[g1e]=new Nt,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[HD].add([jo(()=>rn(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),ie(()=>this.screenLocation,(t,i)=>{_(t)&&_(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[HD]=lt(this[HD])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&_(e)&&_(t)&&t.ready?t.toScreen(e):null}};g1e=HD,u([d()],z1.prototype,"location",void 0),u([d()],z1.prototype,"screenLocation",null),u([d()],z1.prototype,"screenLocationEnabled",void 0),u([d()],z1.prototype,"view",void 0),z1=u([P("esri.widgets.support.AnchorElementViewModel")],z1);const y1e=z1,V7e="esri.widgets.CompassViewModel";let qD=class extends y1e{constructor(e){super(e),this.visible=!1}};u([d()],qD.prototype,"visible",void 0),qD=u([P(V7e)],qD);const v1e=qD,cV={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let V1=class extends Wn{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new v1e,this.visible=!1}initialize(){this.own([ie(()=>this.visible,e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[cV.spinnerStart]:r,[cV.spinnerFinish]:s},o=this._getPositionStyles();return k("div",{class:this.classes(cV.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=P2(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(R(t)||R(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([Xe("viewModel.location")],V1.prototype,"location",void 0),u([Xe("viewModel.view")],V1.prototype,"view",void 0),u([d({type:v1e})],V1.prototype,"viewModel",void 0),u([Xe("viewModel.visible")],V1.prototype,"visible",void 0),V1=u([P("esri.widgets.Spinner")],V1);const B7e=V1;var Hn;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(Hn||(Hn={}));const uH={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function G7e(e,t,i){const r=Hn.size;let s=r,n=r;e<1?s*=.75:e>1&&(n*=1.25);const o=0,a=0;let l=r,c=r;return t&&i&&(s=n=l=c=0),[{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[i?l:.875*l,o]},{command:"L",values:[i?s-.5*l:a,n-.5*c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l,o]},{command:"L",values:[l,t?o:.125*c]},{command:"L",values:[s-.5*l,t?n-.5*c:c]},{command:"L",values:[s-.5*l,n-.5*c]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[s-.5*l,n-.5*c]},{command:"L",values:[i?s-.5*l:a,n-.5*c]},{command:"L",values:[i?s-.5*l:a,t?n-.5*c:c]},{command:"L",values:[s-.5*l,t?n-.5*c:c]},{command:"Z",values:[]}]}]}function j7e(e){const t=Hn.size,i=.5*e,r=0,s=0;return[{type:"path",path:[{command:"M",values:[s,.7*t*.5]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+i]},{command:"L",values:[s,.7*t+i-.7*t*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+i]},{command:"L",values:[t,i]},{command:"L",values:[t,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,r]},{command:"L",values:[t,r]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[s,.7*t*.5]},{command:"Z",values:[]}]}]}function H7e(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function q7e(e,t){let i=t?Hn.tallSymbolWidth:e;const r=e,s=t?4:6;i<=Hn.size?i-=.5*s:i-=s;const n=0,o=0,a=t?.35*i:.5*i;return[{type:"path",path:[{command:"M",values:[.5*i,n]},{command:"L",values:[i,.5*a]},{command:"L",values:[.5*i,a]},{command:"L",values:[o,.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a]},{command:"L",values:[.5*i,a]},{command:"L",values:[.5*i,r]},{command:"L",values:[o,r-.5*a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*i,a]},{command:"L",values:[.5*i,r]},{command:"L",values:[i,r-.5*a]},{command:"L",values:[i,.5*a]},{command:"Z",values:[]}]}]}function W7e(e,t){let i=t?Hn.tallSymbolWidth:e;const r=e,s=t?4:6;i<=Hn.size?i-=.5*s:i-=s;const n=.5*i,o=.15*i,a=0,l=r-o;return[{type:"ellipse",cx:.5*i,cy:l,rx:n,ry:o},{type:"path",path:[{command:"M",values:[a,o]},{command:"L",values:[a,l]},{command:"L",values:[i,l]},{command:"L",values:[i,o]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*i,cy:o,rx:n,ry:o}]}function X7e(e,t){let i=t?Hn.tallSymbolWidth:e;const r=e,s=t?4:6;i<=Hn.size?i-=.5*s:i-=s;const n=.15*i,o=r-n;return[{type:"ellipse",cx:.5*i,cy:o,rx:.5*i,ry:n},{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,o]},{command:"L",values:[0,o]},{command:"Z",values:[]}]}]}function Z7e(e){let t=e;const i=e,r=6;t<Hn.size?t-=.5*r:t-=r;const s=.15*t,n=0;return[{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[t,n]},{command:"L",values:[.5*t,i-s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:n,rx:.5*t,ry:s}]}function Y7e(e){let t=e;const i=e,r=4;t<Hn.size?t-=.5*r:t-=r;const s=0,n=0,o=t,a=i,l=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,s]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[n,.5*a-l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"L",values:[.45*o,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*o,i]},{command:"L",values:[o,.5*a-l]},{command:"L",values:[.45*o-l,.5*a+l]},{command:"Z",values:[]}]}]}function Q7e(e){const t=e,i=2;let r=e;r<Hn.size?r-=.5*i:r-=i;const s=0,n=0;return[{type:"path",path:[{command:"M",values:[.45*t,s]},{command:"L",values:[t,r]},{command:"L",values:[.45*t,.6*r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*t,s]},{command:"L",values:[.45*t,.6*r]},{command:"L",values:[n,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,r]},{command:"L",values:[.45*t,.6*r]},{command:"L",values:[t,r]},{command:"Z",values:[]}]}]}function Fv(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function nEt(e,t){if("type"in e&&(e.type==="linear"||e.type==="pattern"))return e;const i=new Pe(e);return new Pe([Fv(i.r,t),Fv(i.g,t),Fv(i.b,t),i.a])}function J7e(e){return"r"in e&&"g"in e&&"b"in e}function _1e(e){return"h"in e&&"s"in e&&"v"in e}function b1e(e){return"l"in e&&"a"in e&&"b"in e}function w1e(e){return"l"in e&&"c"in e&&"h"in e}function K7e(e){return"x"in e&&"y"in e&&"z"in e}const eje=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],tje=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function x1e(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,o=e[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=e[r][s]*t[s];i.push(a)}return i}function T1e(e){const t=[e.r/255,e.g/255,e.b/255].map(r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4),i=x1e(eje,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function EY(e){const t=x1e(tje,[e.x/100,e.y/100,e.z/100]).map(i=>{const r=i<=.0031308?12.92*i:1.055*i**.4166666666666667-.055;return Math.min(1,Math.max(r,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function S1e(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(i=>i>.008856451679035631?i**.3333333333333333:7.787037037037035*i+.13793103448275862);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function E1e(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(r=>r>6/29?r**3:3*(6/29)**2*(r-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function ije(e){const t=e.l,i=e.a,r=e.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}function rje(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}function sje(e){return S1e(T1e(e))}function nje(e){return EY(E1e(e))}function oje(e){return ije(S1e(T1e(e)))}function aje(e){return EY(E1e(rje(e)))}function lje(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let o=s,a=n===0?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,l=n===0?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}function cje(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}function X3(e){return J7e(e)?e:w1e(e)?aje(e):b1e(e)?nje(e):K7e(e)?EY(e):_1e(e)?cje(e):e}function CY(e){return _1e(e)?e:lje(X3(e))}function oEt(e){return b1e(e)?e:sje(X3(e))}function aEt(e){return w1e(e)?e:oje(X3(e))}function c4(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function uje(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function hje(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function dje(e,t){return new Float32Array(e,t,6)}function C1e(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function pje(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)C1e(e,t,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:c4,clone:uje,fromValues:hje,createView:dje,transform:C1e,transformMany:pje},Symbol.toStringTag,{value:"Module"}));function fje(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Xk(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function mje(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e}function A1e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function gje(e){return e[0]*e[3]-e[1]*e[2]}function yb(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],p=i[2],f=i[3],m=i[4],y=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*p+n*f,e[3]=s*p+o*f,e[4]=r*m+n*y+a,e[5]=s*m+o*y+l,e}function Zk(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function AY(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function Yk(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function yje(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function vje(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function RY(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function _je(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function bje(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function wje(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function R1e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function xje(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function Tje(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function Sje(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Eje(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],f=t[4],m=t[5];return Math.abs(i-l)<=Ct*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Ct*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=Ct*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=Ct*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-f)<=Ct*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=Ct*Math.max(1,Math.abs(a),Math.abs(m))}const Cje=yb,Aje=R1e;Object.freeze(Object.defineProperty({__proto__:null,copy:fje,identity:Xk,set:mje,invert:A1e,determinant:gje,multiply:yb,rotate:Zk,scale:AY,translate:Yk,fromRotation:yje,fromScaling:vje,fromTranslation:RY,str:_je,frob:bje,add:wje,subtract:R1e,multiplyScalar:xje,multiplyScalarAndAdd:Tje,exactEquals:Sje,equals:Eje,mul:Cje,sub:Aje},Symbol.toStringTag,{value:"Module"}));const Rje="http://www.w3.org/2000/svg";let Mje=0,Oje=0;const Fre=he("android"),Pje=he("chrome")||Fre&&Fre>=4?"auto":"optimizeLegibility",Ije={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},$je=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let Dn={},fr={};const kre={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},Lje=Math.PI;let Dje=1;function MS(e,t){const i=e*(Lje/180);return Math.abs(t*Math.sin(i))+Math.abs(t*Math.cos(i))}function M1e(e){return e.map(t=>`${t.command} ${t.values.join(" ")}`).join(" ").trim()}function MY(e,t,i,r){if(e){if(e.type==="circle")return k("circle",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-dashoffset":i.dashOffset,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if(e.type==="ellipse")return k("ellipse",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if(e.type==="rect")return k("rect",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if(e.type==="image")return k("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if(e.type==="path"){const s=typeof e.path!="string"?M1e(e.path):e.path;return k("path",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:s})}if(e.type==="text")return k("text",{"alignment-baseline":r.alignBaseline,fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":r.align,"text-decoration":r.decoration,kerning:r.kerning,rotate:r.rotate,"text-rendering":Pje,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,"font-size":r.font.size,"font-family":r.font.family,x:e.x,y:e.y},e.text)}return null}function OY(e){const t={fill:"none",pattern:null,linearGradient:null};if(e){if("type"in e&&e.type==="pattern"){const i="patternId-"+ ++Mje;t.fill=`url(#${i})`,t.pattern={id:i,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&e.type==="linear"){const i="linearGradientId-"+ ++Oje;t.fill=`url(#${i})`,t.linearGradient={id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map(r=>({offset:r.offset,color:r.color&&new Pe(r.color).toString()}))}}else if(e){const i=new Pe(e);t.fill=i.toString()}}return t}function PY(e){const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(e&&(e.width!=null&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new Pe(e.color).toString()),e.dashArray&&(t.dashArray=e.dashArray),e.dashArray&&(t.dashOffset=e.dashoffset),e.style)){let i=null;if(e.style in kre&&(i=kre[e.style]),Array.isArray(i)){i=i.slice(0);for(let r=0;r<i.length;++r)i[r]*=e.width;if(e.cap!=="butt"){for(let r=0;r<i.length;r+=2)i[r]-=e.width,i[r]<1&&(i[r]=1);for(let r=1;r<i.length;r+=2)i[r]+=e.width}i=i.join(",")}t.dashArray=i}return t}function O1e(e,t){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return e&&(i.align=e.align,i.alignBaseline=e.alignBaseline,i.decoration=e.decoration,i.kerning=e.kerning?"auto":"0",i.rotate=e.rotated?"90":"0",i.font.style=t.style||"normal",i.font.variant=t.variant||"normal",i.font.weight=t.weight||"normal",i.font.size=t.size&&t.size.toString()||"10pt",i.font.family=t.family||"serif"),i}function P1e(e){const{pattern:t,linearGradient:i}=e;if(t)return k("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},k("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(i){const r=i.stops.map((s,n)=>k("stop",{key:`${n}-stop`,offset:s.offset,"stop-color":s.color}));return k("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},r)}return null}function Nje(e,t){if(!e)return null;const i=[];for(const r of e){const{shape:s,fill:n,stroke:o,font:a}=r,l=OY(n),c=PY(o),h=s.type==="text"?O1e(s,a):null;i.push(MY(s,l.fill,c,h))}return k("mask",{id:t,maskUnits:"userSpaceOnUse"},k("g",null,i))}function Ure(e,t,i){return Yk(e,Xk(e),[t,i])}function zre(e,t,i,r,s){return AY(e,Xk(e),[t,i]),e[4]=e[4]*t-r*t+r,e[5]=e[5]*i-s*i+s,e}function Fje(e,t,i,r){const s=t%360*Math.PI/180;Zk(e,Xk(e),s);const n=Math.cos(s),o=Math.sin(s),a=e[4],l=e[5];return e[4]=a*n-l*o+r*o-i*n+i,e[5]=l*n+a*o-i*o-r*n+r,e}function Ya(e,t){Dn&&"left"in Dn?(Dn.left>e&&(Dn.left=e),Dn.right<e&&(Dn.right=e),Dn.top>t&&(Dn.top=t),Dn.bottom<t&&(Dn.bottom=t)):Dn={left:e,bottom:t,right:e,top:t}}function Vre(e){const t=e.args,i=t.length;let r;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)Ya(t[r],t[r+1]);fr.x=t[i-2],fr.y=t[i-1];break;case"H":for(r=0;r<i;++r)Ya(t[r],fr.y);fr.x=t[i-1];break;case"V":for(r=0;r<i;++r)Ya(fr.x,t[r]);fr.y=t[i-1];break;case"m":{let s=0;for(("x"in fr)||(Ya(fr.x=t[0],fr.y=t[1]),s=2),r=s;r<i;r+=2)Ya(fr.x+=t[r],fr.y+=t[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)Ya(fr.x+=t[r],fr.y+=t[r+1]);break;case"h":for(r=0;r<i;++r)Ya(fr.x+=t[r],fr.y);break;case"v":for(r=0;r<i;++r)Ya(fr.x,fr.y+=t[r]);break;case"c":for(r=0;r<i;r+=6)Ya(fr.x+t[r],fr.y+t[r+1]),Ya(fr.x+t[r+2],fr.y+t[r+3]),Ya(fr.x+=t[r+4],fr.y+=t[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)Ya(fr.x+t[r],fr.y+t[r+1]),Ya(fr.x+=t[r+2],fr.y+=t[r+3]);break;case"A":for(r=0;r<i;r+=7)Ya(t[r+5],t[r+6]);fr.x=t[i-2],fr.y=t[i-1];break;case"a":for(r=0;r<i;r+=7)Ya(fr.x+=t[r+5],fr.y+=t[r+6])}}function Bre(e,t,i){const r=Ije[e.toLowerCase()];let s;typeof r=="number"&&(r?t.length>=r&&(s={action:e,args:t.slice(0,t.length-t.length%r)},i.push(s),Vre(s)):(s={action:e,args:[]},i.push(s),Vre(s)))}function kje(e){const t=(typeof e.path!="string"?M1e(e.path):e.path).match($je),i=[];if(Dn={},fr={},!t)return null;let r="",s=[];const n=t.length;for(let a=0;a<n;++a){const l=t[a],c=parseFloat(l);isNaN(c)?(r&&Bre(r,s,i),s=[],r=l):s.push(c)}Bre(r,s,i);const o={x:0,y:0,width:0,height:0};return Dn&&"left"in Dn&&(o.x=Dn.left,o.y=Dn.top,o.width=Dn.right-Dn.left,o.height=Dn.bottom-Dn.top),o}function I1e(e){const t={x:0,y:0,width:0,height:0};if(e.type==="circle")t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if(e.type==="ellipse")t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if(e.type==="image"||e.type==="rect")t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if(e.type==="path"){const i=kje(e);t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height}return t}function $1e(e){const t={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const n of e)i?(i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r=Math.max(r,n.x+n.width),s=Math.max(s,n.y+n.height)):(i=t,i.x=n.x,i.y=n.y,r=n.x+n.width,s=n.y+n.height);return i&&(i.width=r-i.x,i.height=s-i.y),i}function hH(e,t,i,r,s,n,o,a,l){let c=(o&&n?MS(n,t):t)/2,h=(o&&n?MS(n,i):i)/2;if(l){const S=l[0],T=l[1];c=(o&&n?MS(n,S):S)/2,h=(o&&n?MS(n,T):T)/2}const p=e.width+r,f=e.height+r,m=c4(),y=c4();let v=!1;if(s&&p!==0&&f!==0){const S=t!==i?t/i:p/f,T=t>i?t:i;let E=1,C=1;isNaN(T)||(S>1?(E=T/p,C=T/S/f):(C=T/f,E=T*S/p)),yb(y,y,zre(m,E,C,c,h)),v=!0}const w=e.x+(p-r)/2,b=e.y+(f-r)/2;if(yb(y,y,Ure(m,c-w,h-b)),!v&&(p>t||f>i)){const S=p/t>f/i,T=(S?t:i)/(S?p:f);yb(y,y,zre(m,T,T,w,b))}return n&&yb(y,y,Fje(m,n,w,b)),a&&yb(y,y,Ure(m,a[0],a[1])),`matrix(${y[0]},${y[1]},${y[2]},${y[3]},${y[4]},${y[5]})`}function Uje(e,t,i){const r=e==null?void 0:e.effects.find(c=>c.type==="bloom");if(!r)return null;const{strength:s,radius:n}=r,o=s>0?n:0,a=(s+o)*t,l=4*s+1;return k("filter",{id:`bloom${i}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},k("feMorphology",{operator:"dilate",radius:(s+.5*o)*(5**(t/100)*(.4+t/100)),in:"SourceGraphic",result:"dilate"}),k("feGaussianBlur",{in:"dilate",stdDeviation:a/25,result:"blur"}),k("feGaussianBlur",{in:"blur",stdDeviation:a/50,result:"intensityBlur"}),k("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},k("feFuncR",{type:"linear",slope:l}),k("feFuncG",{type:"linear",slope:l}),k("feFuncB",{type:"linear",slope:l})),k("feMerge",null,k("feMergeNode",{in:"intensityBlur"}),k("feMergeNode",{in:"intensityBrightness"}),k("feGaussianBlur",{stdDeviation:s/10})))}function L1e(e,t,i,r={}){var c;const s=[],n=[],o=++Dje,a=Uje(r.effectView,t,o);let l=null;if(a){const h=(c=r.effectView)==null?void 0:c.effects.find(y=>y.type==="bloom"),p=(h.strength?h.strength+h.radius/2:0)/3,f=t+t*p,m=i+i*p;l=[Math.max(f,10),Math.max(m,10)]}for(let h=0;h<e.length;h++){const p=e[h],f=[],m=[];let y=0,v=0,w=0;for(const T of p){const{shape:E,fill:C,stroke:A,font:I,offset:D}=T;r.ignoreStrokeWidth||(y+=A&&A.width||0);const L=OY(C),z=PY(A),B=E.type==="text"?O1e(E,I):null;s.push(P1e(L)),f.push(MY(E,L.fill,z,B)),m.push(I1e(E)),D&&(v+=D[0],w+=D[1])}const b=hH($1e(m),t,i,y,r.scale,r.rotation,r.useRotationSize,[v,w],l);let S=null;if(r.masking){const T=`mask-${h}`,E=r.masking[h];s.push(Nje(E,T)),S=`url(#${T})`}n.push(S?k("g",{mask:S},k("g",{transform:b},f)):k("g",{transform:b},f))}return r.useRotationSize&&r.rotation&&(t=MS(r.rotation,t),i=MS(r.rotation,i)),a&&(t=l[0],i=l[1]),k("svg",{xmlns:Rje,width:t,height:i,style:"display: block;"},a,k("defs",null,s),a?k("g",{filter:`url(#bloom${o})`},n):n)}const zje=NF();function Z3(e,t,i){const r=Math.ceil(t[0]),s=Math.ceil(t[1]);if(!e.some(o=>!!o.length))return null;const n=i&&i.node||document.createElement("div");return i.opacity!=null&&(n.style.opacity=i.opacity.toString()),i.effectView!=null&&(n.style.filter=mO(i.effectView)),zje.append(n,L1e.bind(null,e,r,s,i)),n}function Vje(e,t){e=Math.ceil(e),t=Math.ceil(t);const i=document.createElement("canvas");i.width=e,i.height=t,i.style.width=e+"px",i.style.height=t+"px";const r=i.getContext("2d");return r.clearRect(0,0,e,t),r}function Bje(e,t,i){return e?Zt(e,{responseType:"image"}).then(r=>{const s=r.data,n=s.width,o=s.height,a=n/o;let l=t;if(i){const c=Math.max(n,o);l=Math.min(l,c)}return{image:s,width:a<=1?Math.ceil(l*a):l,height:a<=1?l:Math.ceil(l/a)}}):Promise.reject(new j("renderUtils: imageDataSize","href not provided."))}function Gje(e,t){return!(!e||t==="ignore")&&(t!=="multiply"||e.r!==255||e.g!==255||e.b!==255||e.a!==1)}function jje(e,t,i,r,s){switch(s){case"multiply":e[t+0]*=i[0],e[t+1]*=i[1],e[t+2]*=i[2],e[t+3]*=i[3];break;default:{const n=CY({r:e[t+0],g:e[t+1],b:e[t+2]});n.h=r.h,n.s=r.s,n.v=n.v/100*r.v;const o=X3(n);e[t+0]=o.r,e[t+1]=o.g,e[t+2]=o.b,e[t+3]*=i[3];break}}}function Hje(e,t,i,r,s){return Bje(e,t,s).then(n=>{const o=n.width?n.width:t,a=n.height?n.height:t;if(n.image&&Gje(i,r)){let l=n.image.width,c=n.image.height;he("edge")&&/\.svg$/i.test(e)&&(l-=1,c-=1);const h=Vje(o,a);h.drawImage(n.image,0,0,l,c,0,0,o,a);const p=h.getImageData(0,0,o,a),f=[i.r/255,i.g/255,i.b/255,i.a],m=CY(i);for(let y=0;y<p.data.length;y+=4)jje(p.data,y,f,m,r);h.putImageData(p,0,0),e=h.canvas.toDataURL("image/png")}else{const l=Gr&&Gr.findCredential(e);if(l&&l.token){const c=e.includes("?")?"&":"?";e=`${e}${c}token=${l.token}`}}return{url:e,width:o,height:a}}).catch(()=>({url:e,width:t,height:t}))}let Sx=null;const Gre=[255,255,255];function jre(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function qje(e,t,i){const{backgroundColor:r,outline:s,dotSize:n}=e,o=i&&i.swatchSize||Hn.size,a=.8,l=Math.round(o*o/n**2*a),c=window.devicePixelRatio,h=document.createElement("canvas"),p=o*c;h.width=p,h.height=p,h.style.width=h.width/c+"px",h.style.height=h.height/c+"px";const f=h.getContext("2d");if(r&&(f.fillStyle=r.toCss(!0),f.fillRect(0,0,p,p),f.fill()),f.fillStyle=t.toCss(!0),Sx&&Sx.length/2===l)for(let y=0;y<2*l;y+=2){const v=Sx[y],w=Sx[y+1];f.fillRect(v,w,n*c,n*c),f.fill()}else{Sx=[];for(let y=0;y<2*l;y+=2){const v=jre(0,p),w=jre(0,p);Sx.push(v,w),f.fillRect(v,w,n*c,n*c),f.fill()}}s&&(s.color&&(f.strokeStyle=s.color.toCss(!0)),f.lineWidth=s.width,f.strokeRect(0,0,p,p));const m=new Image(o,o);return m.src=h.toDataURL(),m}function Wje(e,t={}){const i=t.radius||40,r=2*Math.PI*i,s=e.length,n=r/s,o=[],a=pO(t.outline);a&&(a.width*=2),(a||t.backgroundColor)&&o.push({shape:{type:"circle",cx:i,cy:i,r:i},fill:t.backgroundColor,stroke:a,offset:[0,0]});const l=t.values,c=l&&l.length===s&&l.reduce((y,v)=>y+v,0)===100,h=[0];for(let y=0;y<s;y++){const v=c?l[y]*r/100:null;c&&h.push(v+h[y]),o.push({shape:{type:"circle",cx:i,cy:i,r:i/2},fill:[0,0,0,0],stroke:{width:i,dashArray:`${v||n} ${r}`,dashoffset:"-"+(c?h[y]/2:y*(n/2)),color:e[y]},offset:[0,0]})}let p=null;const f=2*i+((a==null?void 0:a.width)||0),m=t.holePercentage;if(m){a&&o.push({shape:{type:"circle",cx:i,cy:i,r:i*m},fill:null,stroke:a,offset:[0,0]});const y=f/2;p=[[{shape:{type:"circle",cx:y,cy:y,r:y},fill:Gre,stroke:a?ye(F({},a),{color:Gre}):null,offset:[0,0]},{shape:{type:"circle",cx:y,cy:y,r:i*m},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return Z3([o],[f,f],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:p,rotation:-90})}function B1(e,t={}){const s=t.align==="horizontal",n=s?75:24,o=s?24:75,{width:a=n,height:l=o,gradient:c=!0}=t,h=window.devicePixelRatio,p=a*h,f=l*h,m=document.createElement("canvas");m.width=p,m.height=f,m.style.width=`${a}px`,m.style.height=`${l}px`;const y=m.getContext("2d"),v=s?p:0,w=s?0:f;if(c){const S=y.createLinearGradient(0,0,v,w),T=e.length,E=T===1?0:1/(T-1);e.forEach((C,A)=>S.addColorStop(A*E,C.toString())),y.fillStyle=S,y.fillRect(0,0,p,f)}else{const S=s?p/e.length:p,T=s?f:f/e.length;let E=0,C=0;for(const A of e)y.fillStyle=A.toString(),y.fillRect(E,C,S,T),E=s?E+S:0,C=s?0:C+T}const b=document.createElement("div");return b.style.width=`${a}px`,b.style.height=`${l}px`,Xje(b,t==null?void 0:t.effectList),b.appendChild(m),b}function Xje(e,t){if(!t)return;e.style.filter=mO(t);const i=t.effects;if(i){for(const r of i)if((r==null?void 0:r.type)==="drop-shadow"){r.offsetX<0?e.style.marginLeft=`${Math.abs(r.offsetX)}px`:e.style.marginRight=`${r.offsetX}px`;break}}}async function D1e(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:i}=await import("./previewWebStyleSymbol.49ac6c6a.js");return i(e,D1e,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await Promise.resolve().then(function(){return nxt});return i(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await import("./previewSymbol2D.f557db6d.js");return i(e,t)}case"cim":{const{previewCIMSymbol:i}=await import("./previewCIMSymbol.eacba5bb.js");return i(e,t)}default:return}}function N1e(e){return e&&"opacity"in e?e.opacity*N1e(e.parent):1}async function Zje(e,t){var w;if(!e)return;const i=e.sourceLayer,r=(w=_(t)&&t.useSourceLayer?i:e.layer)!=null?w:i,s=N1e(r);if(_(e.symbol)&&(!_(t)||t.ignoreGraphicSymbol!==!0)){const b=e.symbol.type==="web-style"?await e.symbol.fetchSymbol(ye(F({},t),{cache:_(t)?t.webStyleCache:null})):e.symbol.clone();return O6(b,null,s),b}const n=_(t)&&t.renderer||r&&"renderer"in r&&r.renderer;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol(ye(F({},t),{cache:_(t)?t.webStyleCache:null})):o.clone(),!("visualVariables"in n)||!n.visualVariables||!n.visualVariables.length)return O6(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(R(t)||R(t.arcade))){const b=F({},t);b.arcade=await Wf(),t=b}const a=await Promise.resolve().then(function(){return nx}),l=[],c=[],h=[],p=[];for(const b of n.visualVariables)switch(b.type){case"color":l.push(b);break;case"opacity":c.push(b);break;case"rotation":p.push(b);break;case"size":b.target||h.push(b)}const f=!!l.length&&l[l.length-1],m=f?a.getColor(f,e,t):null,y=!!c.length&&c[c.length-1];let v=y?a.getOpacity(y,e,t):null;if(s!=null&&(v=v!=null?v*s:s),O6(o,m,v),h.length){const b=a.getAllSizes(h,e,t);await Fze(o,b)}for(const b of p)kze(o,a.getRotationAngle(b,e,t),b.axis);return o}class ry{constructor(t,i){this.owner=i,this.properties={},this.afterDispatchHandle=null;for(const r in t){const s=t[r],n=new lde(s,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=bde(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const i=this.properties[t];for(const r of i.acquired)jK(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this.properties=null,this.owner=null}get(t){const i=this.owner._get(t),r=this.properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this.properties){const i=this.properties[t];let r=0;for(const s of i.acquired)jK(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}const Yje=he("mac")?"Meta":"Ctrl",Qk={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)Qk[e]=String.fromCharCode(e);for(let e=1;e<25;e++)Qk[111+e]=`F${e}`;for(let e=65;e<91;e++)Qk[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function Qje(e){if(e.key!==void 0)return cb(e);const t=Qk[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function Jje(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class Kje{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const Hre=fe.getLogger("esri.views.input.InputHandler");class Ho{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?Hre.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new Kje(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const f=p.indexOf(h);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new eHe(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new tHe(t,{onEmit:(r,s,n,o)=>{this._manager.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Hre.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const i=this._incoming[t.type];if(i){for(const r of i)if(r.match.matches(t)&&(r.callback(t),t.shouldStopPropagation()))break}}}class eHe{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class tHe{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class iHe extends Ho{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse",i.data.x,i.data.y)})}_setValue(t,i,r){t===this._value&&this._x===i&&this._y===r||(this._value=t,this._x=i,this._y=r,this._onChange(t,i,r))}}const uV=fe.getLogger("esri.views.input.InputManager");let M0=class extends Se{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=Yje,this.latestPointerType="mouse",this._propertiesPool=new ry({latestPointerLocation:sHe},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=kv.INTERNAL){if(this._nameToGroup[e])return void uV.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void uV.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(r,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):uV.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)Jje(o)||t.add(o)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const r=this._get("latestPointerLocation");if(R(r)||r.x!==t||r.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,i=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(r(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(r(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new iHe((e,t,i)=>this._setLatestPointer(e,t,i)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],kv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,kv.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new rHe(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new a7,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new a7;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.includes(n));if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};u([d({readOnly:!0})],M0.prototype,"hasPendingInputs",null),u([d()],M0.prototype,"eventSource",void 0),u([d()],M0.prototype,"recognizers",void 0),u([d({readOnly:!0})],M0.prototype,"latestPointerType",void 0),u([d({readOnly:!0})],M0.prototype,"latestPointerLocation",void 0),M0=u([P("esri.views.input.InputManager")],M0);class rHe{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=Q0.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Q0.STOPPED}shouldStopPropagation(){return(this._propagationState&Q0.STOPPED)!=0}async(t){this._propagationState|=Q0.PAUSED;const i=(r,s)=>{this._propagationState&=~Q0.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&Q0.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var Q0;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(Q0||(Q0={}));const kv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class sHe{}function qre(e){return e&&typeof e.highlight=="function"}function nHe(e){return e&&typeof e.maskOccludee=="function"}function lEt(e,t,i){return R(e)||e>i&&(t===0||e<t)}function cEt(e,t){return e>0||t>0}function uEt(e){var i,r;const t=e.effectiveScaleRange;return{minScale:(i=t==null?void 0:t.minScale)!=null?i:0,maxScale:(r=t==null?void 0:t.maxScale)!=null?r:0}}const Jk={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},Fb=new qE({id:"zoom-to-feature",title:"{messages.zoom}",className:Jk.iconZoom}),Wre=new qE({id:"remove-selected-feature",title:"{messages.remove}",className:Jk.iconTrash}),OS=new qE({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Jk.iconZoom}),PS=new qE({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Jk.iconBrowseClusteredFeatures}),oHe="esri.widgets.Popup.PopupViewModel",u4=fe.getLogger(oHe),aHe=e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new j("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new j("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new j("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new j("trigger-action:invalid-action","Action is disabled"));if(o===Fb.id)return cHe(s.viewModel).catch(n9);if(o===OS.id)return uHe(s.viewModel);if(o===PS.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Wre.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new j(`trigger-action:${Wre.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function F1e(e){const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?t||i:e.get("selectedFeature.geometry")||i:null}function vb(e){var t,i;return(e==null?void 0:e.isAggregate)&&((i=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:i.type)==="cluster"}function lHe(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{r=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new j("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});u4.error(s)}),r}return!0}async function cHe(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=F1e(e);if(!n){const c=new j("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw u4.error(c),c}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&lHe(i,r);Fb.active=!0,Fb.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{Fb.active=!1,Fb.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function uHe(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new j("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw u4.error(a),a}if(!vb(t)){const a=new j("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw u4.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],OS.active=!0,OS.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),OS.active=!1,OS.disabled=!1}async function hHe(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}async function dHe(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],PS.active=!0,PS.disabled=!0;const{features:o}=await s.queryFeatures(n);PS.active=!1,PS.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function pHe(e){const t=e.features.filter(i=>vb(i));t.length&&(e.features=t)}const IY=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([d()],t.prototype,"goToOverride",void 0),u([d()],t.prototype,"view",void 0),t=u([P("esri.widgets.support.GoTo")],t),t},_M=ut.ofType({key:"type",defaultKeyValue:"button",base:ik,typeMap:{button:qE,toggle:ame}}),fHe=()=>[Fb.clone()],mHe=()=>[OS.clone(),PS.clone()],k1e="esri.widgets.Popup.PopupViewModel",DI=fe.getLogger(k1e);let Ai=class extends IY(y1e){constructor(e){super(e),this._handles=new Nt,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new _M,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new Ha({symbol:new dm({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([ie(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),ie(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),ie(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),ie(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),ie(()=>this.location,e=>this._locationChange(e)),ie(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),ie(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),ie(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),ie(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>aHe({event:e,view:this.view})),jo(()=>!this.waitingForResult,()=>this._waitingForResultChange(),qi),ie(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),ie(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),jo(()=>!this.visible,()=>this.browseClusterEnabled=!1),ie(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new _M;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new _M;return e.removeAll(),e.addMany(vb(this.selectedFeature)?mHe():fHe()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Dg(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=F1e(this);if(!t){const i=new j("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return DI.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const r=new j("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return DI.error(r),Promise.reject(r)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t=ye(F({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){pHe(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?vb(t)?(await hHe(this),await dHe(this)):DI.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):DI.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(Fb.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(vb(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),vb(e)?void 0:(e.symbol=await Zje(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(vb(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(r.some((h,p)=>(h&&h.graphic===n&&(a=h,r.splice(p,1)),!!a)),a)s[o]=a;else{const h=new SY({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},kv.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return r.popup.open({location:a||i,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return R(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:t}_getHighlightTarget(e,t){const i=t.type==="imagery"?void 0:"objectIdField"in t&&t.objectIdField,r=e.attributes;return r&&i&&r[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof sE))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&qre(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof sE))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&qre(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};u([d()],Ai.prototype,"featurePage",void 0),u([d()],Ai.prototype,"isLoadingFeature",null),u([d({type:_M})],Ai.prototype,"actions",void 0),u([d({readOnly:!0})],Ai.prototype,"active",null),u([d()],Ai.prototype,"activeFeature",void 0),u([d({readOnly:!0})],Ai.prototype,"allActions",null),u([d({type:Boolean})],Ai.prototype,"defaultPopupTemplateEnabled",void 0),u([d()],Ai.prototype,"autoCloseEnabled",void 0),u([d()],Ai.prototype,"autoOpenEnabled",void 0),u([d()],Ai.prototype,"browseClusterEnabled",void 0),u([d()],Ai.prototype,"content",void 0),u([d({type:_M,readOnly:!0})],Ai.prototype,"defaultActions",null),u([d({readOnly:!0})],Ai.prototype,"featureCount",null),u([d()],Ai.prototype,"features",null),u([d()],Ai.prototype,"featuresPerPage",void 0),u([d()],Ai.prototype,"featureViewModelAbilities",void 0),u([d({readOnly:!0})],Ai.prototype,"featureViewModels",void 0),u([d()],Ai.prototype,"highlightEnabled",void 0),u([d()],Ai.prototype,"includeDefaultActions",void 0),u([d({type:ot})],Ai.prototype,"location",null),u([d({readOnly:!0})],Ai.prototype,"pendingPromisesCount",null),u([d({readOnly:!0})],Ai.prototype,"selectedClusterBoundaryFeature",void 0),u([d({readOnly:!0})],Ai.prototype,"waitingForResult",null),u([d({readOnly:!0})],Ai.prototype,"promiseCount",null),u([d()],Ai.prototype,"promises",null),u([d({value:null,readOnly:!0})],Ai.prototype,"selectedFeature",null),u([d({value:-1})],Ai.prototype,"selectedFeatureIndex",null),u([d({readOnly:!0})],Ai.prototype,"selectedFeatureViewModel",null),u([d({readOnly:!0})],Ai.prototype,"state",null),u([d()],Ai.prototype,"title",void 0),u([d()],Ai.prototype,"updateLocationEnabled",void 0),u([d()],Ai.prototype,"view",void 0),u([d()],Ai.prototype,"visible",void 0),u([d()],Ai.prototype,"zoomFactor",void 0),u([d()],Ai.prototype,"zoomToLocation",void 0),u([d()],Ai.prototype,"centerAtLocation",null),Ai=u([P(k1e)],Ai);const U1e=Ai,Xre="selected-index",gHe=0,Zre="popup-spinner",$e={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},Yre={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Qre="esri-popup";function Cm(e,t){return t===void 0?`${Qre}__${e}`:`${Qre}__${e}-${t}`}const z1e="esri.widgets.Popup",Jre=fe.getLogger(z1e),Kre={closeButton:!0,featureNavigation:!0};let St=class extends m1e(Wn){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Nt,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([i])=>{(i==null?void 0:i.isIntersecting)&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=_Z(()=>this._displaySpinner(),gHe),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new U1e,this.visible=null,this.visibleElements=F({},Kre),this._addSelectedFeatureIndexHandle(),this.own([ie(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),ie(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),ie(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,r)=>{!!i!=!!r&&this.reposition()}),ie(()=>{var i,r,s,n,o,a;return[(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),ie(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),ie(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.size},(i,r)=>this._updateDockEnabledForViewSize(i,r)),ie(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,r)=>this._viewChange(i,r)),ie(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.ready},(i,r)=>this._viewReadyChange(i,r)),ie(()=>{var i,r;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(r=this.viewModel)==null?void 0:r.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),ie(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),ie(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),jo(()=>!this.collapsed,()=>{var i,r;((r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),ns(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),ie(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),Rt),ie(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s,n,o;return!!(this.selectedFeatureWidget?((t=(e=this.selectedFeatureWidget)==null?void 0:e.viewModel)==null?void 0:t.waitingForContent)||((r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.state)==="error"||((n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.content):(o=this.viewModel)==null?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||Yre}set dockOptions(e){const t=F({},Yre),i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s=F(F({},t),e),n=F(F({},t.breakpoint),r),{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint=F(F({},n),o)),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s=ye(F({},t),{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new z7e({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return F(F({},Kre),e)}blur(){const{active:e}=this.viewModel;e||Jre.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||Jre.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(Xre);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var y,v,w,b;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:r,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=r,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(v=(y=this.selectedFeature)==null?void 0:y.layer)==null?void 0:v.title,f=(b=(w=this.selectedFeature)==null?void 0:w.layer)==null?void 0:b.id,m={[$e.alignTopCenter]:s==="top-center",[$e.alignBottomCenter]:s==="bottom-center",[$e.alignTopLeft]:s==="top-left",[$e.alignBottomLeft]:s==="bottom-left",[$e.alignTopRight]:s==="top-right",[$e.alignBottomRight]:s==="bottom-right",[$e.isDocked]:c,[$e.shadow]:h,[$e.isDockedTopLeft]:n==="top-left",[$e.isDockedTopCenter]:n==="top-center",[$e.isDockedTopRight]:n==="top-right",[$e.isDockedBottomLeft]:n==="bottom-left",[$e.isDockedBottomCenter]:n==="bottom-center",[$e.isDockedBottomRight]:n==="bottom-right",[$e.isFeatureMenuOpen]:i,[$e.isActionsMenuOpen]:l};return k("div",{class:this.classes($e.base,m),role:"presentation","data-layer-title":p,"data-layer-id":f,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return k("span",{"aria-hidden":"true",class:this.classes($e.icon,$e.iconLoading,$e.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?k("div",{key:Cm("loading-container"),role:"presentation",class:$e.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=cp(this.container),t={[$e.iconRightTriangleArrow]:e,[$e.paginationPreviousIconRTL]:e,[$e.iconLeftTriangleArrow]:!e,[$e.paginationPreviousIconLTR]:!e};return k("span",{"aria-hidden":"true",class:this.classes($e.icon,t)})}renderPreviousButton(){const{messages:e}=this;return k("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes($e.button,$e.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=cp(this.container),t={[$e.iconLeftTriangleArrow]:e,[$e.paginationNextIconRTL]:e,[$e.iconRightTriangleArrow]:!e,[$e.paginationNextIconLTR]:!e};return k("span",{"aria-hidden":"true",class:this.classes($e.icon,t)})}renderNextButton(){const{messages:e}=this;return k("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes($e.button,$e.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return k("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes($e.button,$e.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[$e.iconUndock]:e,[$e.iconDock]:!e,[$e.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[$e.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[$e.iconDockToTop]:!e&&t==="top-center",[$e.iconDockToBottom]:!e&&t==="bottom-center"};return k("span",{"aria-hidden":"true",class:this.classes(i,$e.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,i=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,r=e?t.undock:t.dock;return i!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?k("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes($e.button,$e.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[$e.headerContainerButton]:i},o=k(tw,{level:this.headingLevel,class:$e.headerTitle,innerHTML:e}),a=i?k("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes($e.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):k("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes($e.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return k("span",{"aria-hidden":"true",class:this.classes($e.icon,$e.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?k("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:$e.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return k("header",{class:$e.header},this.renderTitle(),k("div",{class:$e.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?k("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:$e.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?k("div",{key:Cm("actions-menu-button"),class:this.classes($e.button,$e.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},k("span",{"aria-hidden":"true",class:$e.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?k("ul",{id:e,role:"menu","aria-labelledby":t,key:Cm("actions"),class:$e.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?k("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:$e.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?k("section",{key:Cm("navigation"),class:this.classes($e.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[$e.footerHasPagination]:e,[$e.footerHasActions]:s,[$e.footerHasActionsMenu]:n};return e||s?k("div",{key:Cm("feature-buttons"),class:this.classes($e.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=_h(e.selectedFeatures,{total:t.length});return k("section",{key:Cm("menu"),class:$e.featureMenu},k("strong",{class:$e.featureMenuHeader},r),k("nav",{bind:this,class:$e.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:M7},this.renderFeatureMenu(),k("div",{class:$e.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?k("div",{class:$e.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:k("div",{key:Cm("pointer"),class:$e.pointer,role:"presentation"},k("div",{class:this.classes($e.pointerDirection,$e.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",f={[$e.shadow]:e,[$e.isCollapsible]:n,[$e.isCollapsed]:a};return k("div",{class:this.classes($e.main,$e.widget,f),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?k("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return k("span",{key:"text",class:$e.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[$e.iconLoading]:e.active,[$e.rotating]:e.active,[$e.icon]:!!t,[$e.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),k("span",{key:"icon","aria-hidden":"true",class:this.classes($e.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[$e.action]:t.type!=="toggle",[$e.actionToggle]:t.type==="toggle",[$e.actionToggleOn]:t.type==="toggle"&&t.value,[$e.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o=i==="menu-item"?k("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes($e.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):k("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes($e.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[$e.featureMenuSelected]:o},l=o?k("span",{key:Cm(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:$e.iconCheckMark}):null,c=k("span",{innerHTML:e.title||r.untitled});return k("li",{role:"menuitem",tabIndex:-1,key:Cm(`feature-menu-feature-${s}`),class:this.classes(a,$e.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},k("span",{class:$e.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?k("ol",{class:$e.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,o=s==="zoom-to-feature"?_h(e.title,{messages:t}):s==="remove-selected-feature"?_h(e.title,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?_h(e.title,{messages:t}):e.title;return o&&n?_h(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:$e.iconDefaultAction;return n&&i?_h(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?_h(r,i):r}_createFeatureUpdatedAnimation(){return Z4e("enter",$e.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(ie(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new ut:t.slice(0,i),menuActions:r?new ut:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,r;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){cb(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){cb(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=cb(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=cb(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===r);if(!i)return;const o=i.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=cb(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await _w(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=ie(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,Xre)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-t<o.top||s==="bottom"&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(R(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(T){return parseInt(T.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:f}=i.getBoundingClientRect(),m=f+t,y=Math.max(p,c,h)+t,v=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"right",view:o}),w=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"left",view:o}),b=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"top",view:o}),S=this._isOutsideView({popupHeight:y,popupWidth:m,screenLocation:n,side:"bottom",view:o});return w?b?"bottom-right":"top-right":v?b?"bottom-left":"top-left":b?S?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return cp(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,i=cp(this.container)?"top-left":"top-right";if(!t)return i;const r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(R(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var a,l;const t=e.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&r<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?_h(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,Zre),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new B7e({view:e}),e.ui.add(this._spinner,{key:Zre,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([d({readOnly:!0})],St.prototype,"actionsMenuId",null),u([d({readOnly:!0})],St.prototype,"actionsMenuButtonId",null),u([d({readOnly:!0})],St.prototype,"featureMenuId",null),u([d({readOnly:!0})],St.prototype,"titleId",null),u([d({readOnly:!0})],St.prototype,"contentId",null),u([d({readOnly:!0})],St.prototype,"hasContent",null),u([d({readOnly:!0})],St.prototype,"featureNavigationVisible",null),u([d({readOnly:!0})],St.prototype,"collapsible",null),u([d({readOnly:!0})],St.prototype,"featureMenuVisible",null),u([d({readOnly:!0})],St.prototype,"contentCollapsed",null),u([d({readOnly:!0})],St.prototype,"dividedActions",null),u([Xe("viewModel.actions")],St.prototype,"actions",void 0),u([d()],St.prototype,"actionsMenuOpen",null),u([d()],St.prototype,"alignment",void 0),u([Xe("viewModel.autoCloseEnabled")],St.prototype,"autoCloseEnabled",void 0),u([Xe("viewModel.autoOpenEnabled")],St.prototype,"autoOpenEnabled",void 0),u([Xe("viewModel.defaultPopupTemplateEnabled")],St.prototype,"defaultPopupTemplateEnabled",void 0),u([Xe("viewModel.content")],St.prototype,"content",void 0),u([d()],St.prototype,"collapsed",void 0),u([d()],St.prototype,"collapseEnabled",void 0),u([d({readOnly:!0})],St.prototype,"currentAlignment",null),u([d({readOnly:!0})],St.prototype,"currentDockPosition",null),u([d()],St.prototype,"dockOptions",null),u([d()],St.prototype,"dockEnabled",void 0),u([Xe("viewModel.featureCount")],St.prototype,"featureCount",void 0),u([d()],St.prototype,"featureMenuOpen",void 0),u([Xe("viewModel.features")],St.prototype,"features",void 0),u([Xe("viewModel.goToOverride")],St.prototype,"goToOverride",void 0),u([d()],St.prototype,"headingLevel",void 0),u([Xe("viewModel.highlightEnabled")],St.prototype,"highlightEnabled",void 0),u([Xe("viewModel.location")],St.prototype,"location",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],St.prototype,"label",void 0),u([d()],St.prototype,"maxInlineActions",void 0),u([d(),dn("esri/widgets/Popup/t9n/Popup")],St.prototype,"messages",void 0),u([d(),dn("esri/t9n/common")],St.prototype,"messagesCommon",void 0),u([Xe("viewModel.promises")],St.prototype,"promises",void 0),u([Xe("viewModel.selectedFeature")],St.prototype,"selectedFeature",void 0),u([Xe("viewModel.selectedFeatureIndex")],St.prototype,"selectedFeatureIndex",void 0),u([d({readOnly:!0})],St.prototype,"selectedFeatureWidget",null),u([d()],St.prototype,"spinnerEnabled",void 0),u([Xe("viewModel.title")],St.prototype,"title",void 0),u([Xe("viewModel.updateLocationEnabled")],St.prototype,"updateLocationEnabled",void 0),u([Xe("viewModel.view")],St.prototype,"view",void 0),u([d({type:U1e}),b0e(["triggerAction","trigger-action"])],St.prototype,"viewModel",void 0),u([Xe("viewModel.visible")],St.prototype,"visible",void 0),u([d()],St.prototype,"visibleElements",void 0),u([qt("visibleElements")],St.prototype,"castVisibleElements",null),u([gl()],St.prototype,"_close",null),u([gl()],St.prototype,"_toggleDockEnabled",null),u([gl()],St.prototype,"_toggleFeatureMenu",null),u([gl()],St.prototype,"_toggleActionsMenu",null),u([gl()],St.prototype,"_triggerAction",null),u([gl()],St.prototype,"_selectFeature",null),u([gl()],St.prototype,"_next",null),u([gl()],St.prototype,"_previous",null),St=u([P(z1e)],St);const ese=St,hV=[0,0];function yHe(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return hV[0]=i.left+t.pageXOffset,hV[1]=i.top+t.pageYOffset,hV}function tse(e){e&&(Ome(e),e.parentNode&&e.parentNode.removeChild(e))}function vHe(e){const t=document.createElement("div");return e.appendChild(t),t}const kC=16,NI=750,_He=512,bHe=2,wHe=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:kC,time:NI},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([ie(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),ie(()=>this.interacting,r=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",r.toString())})])}initialize(){this.handles.add(ie(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(i){const r=this._get("container");if(r===i)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),tse(this.root),this._set("root",null),zee(this.userContent,r),tse(this.userContent),this._set("userContent",null)),i){i.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",zee(i,n),i.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",i.insertBefore(o,i.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new Cte;o.appendChild(l.surface),this._set("overlay",l),ie(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=uw({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(ie(()=>this.size,c=>{const[h,p]=c,f="esri-view-surface--inset-outline";h>=document.body.clientWidth||p>=document.body.clientHeight?a.classList.add(f):a.classList.remove(f)},Rt),s),this._set("container",i),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get popup(){return this._get("popup")||new ese({view:this})}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n[0],r-=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n[0],r+=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([ie(()=>this.root,r=>{i.container=r?vHe(r):null},Rt),ie(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},Rt)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=kC,i.time=NI,this.handles.add([(()=>{const r=()=>{i.freq=kC,i.time=NI};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),uw({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=kC,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?kC:Math.min(NI,n.freq*bHe),!s&&n.freq>=_He&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=yHe(i);return(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([d({value:null,cast:i=>sk(i)})],t.prototype,"container",null),u([d({readOnly:!0})],t.prototype,"focused",null),u([d({readOnly:!0})],t.prototype,"height",void 0),u([d({type:ese})],t.prototype,"popup",null),u([d({type:Cte})],t.prototype,"overlay",void 0),u([d({readOnly:!0})],t.prototype,"position",void 0),u([d({readOnly:!0})],t.prototype,"resizing",void 0),u([d({readOnly:!0})],t.prototype,"root",void 0),u([d({value:null,readOnly:!0})],t.prototype,"size",null),u([d({readOnly:!0})],t.prototype,"surface",void 0),u([d({readOnly:!0})],t.prototype,"suspended",void 0),u([d()],t.prototype,"ui",void 0),u([d({readOnly:!0})],t.prototype,"userContent",void 0),u([d({readOnly:!0})],t.prototype,"width",void 0),u([d()],t.prototype,"widthBreakpoint",void 0),t=u([P("esri.views.DOMContainer")],t),t};function hEt(e){return e&&"focus"in e}const $Y=fe.getLogger("esri.layers.support.ElevationSampler");class V1e{queryElevation(t){return B1e(t.clone(),this)}on(){return CHe}projectIfRequired(t,i){return G1e(t,i)}}class xHe extends V1e{constructor(t,i,r){super(),this.tile=t,this.noDataValue=r,this.extent=z5(t.tile.extent,i.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const s=$c(i.spatialReference),n=i.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return!R(i)&&this.containsAt(i.x,i.y)}containsAt(t,i){return rX(this.aaExtent,t,i)}elevationAt(t,i){if(!this.containsAt(t,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return $Y.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return vt(this.tile.sample(t,i),this.noDataValue)}}class dEt extends V1e{constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(o=>new xHe(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=z5(kt(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,i){for(const r of this.samplers)if(r.containsAt(t,i))return r.elevationAt(t,i);return $Y.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler`),this.noDataValue}}function B1e(e,t){const i=G1e(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":THe(e,i,t);break;case"polyline":SHe(e,i,t);break;case"multipoint":EHe(e,i,t)}return e}function G1e(e,t){if(R(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=Qw(e,t);return r||$Y.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function THe(e,t,i){e.z=i.elevationAt(t.x,t.y)}function SHe(e,t,i){If.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];If.x=c[0],If.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(If.x,If.y)}}e.hasZ=!0}function EHe(e,t,i){If.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];If.x=o[0],If.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(If.x,If.y)}e.hasZ=!0}const If=new ot,CHe={remove(){}};var dH;let cf=dH=class extends ve{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new dH({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],cf.prototype,"cols",void 0),u([d({type:Br,json:{write:!0}})],cf.prototype,"level",void 0),u([d({type:String,json:{write:!0}})],cf.prototype,"levelValue",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],cf.prototype,"origin",void 0),u([d({type:Number,json:{write:!0}})],cf.prototype,"resolution",void 0),u([d({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],cf.prototype,"rows",void 0),u([d({type:Number,json:{write:!0}})],cf.prototype,"scale",void 0),cf=dH=u([P("esri.layers.support.LOD")],cf);const j1e=cf;var O0;const ise=new wi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let io=O0=class extends ve{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=et.WebMercator,numLODs:n=24}=e;if(!Pl(s)){const p=[];if(i)for(let f=0;f<i.length;f++){const m=i[f];p.push({level:f,scale:m,resolution:m})}else{let f=5e-4;for(let m=n-1;m>=0;m--)p.unshift({level:m,scale:f,resolution:f}),f*=2}return new O0({dpi:96,lods:p,origin:new ot(0,0,s),size:[r,r],spatialReference:s})}const o=$v(s),a=e.origin?new ot({x:e.origin.x,y:e.origin.y,spatialReference:s}):new ot(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/($c(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],m=f*c;h.push({level:p,scale:f,resolution:m})}else{let p=Rde(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(n/t);h.push({level:0,scale:p,resolution:p*c});for(let m=1;m<f;m++){const y=p/2**t,v=y*c;h.push({level:m,scale:y,resolution:v}),p=y}}return new O0({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=$v(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return ot.fromJSON(F({spatialReference:t.spatialReference},e))}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(s=>{r.push(s.scale),t=s.scale>t?s.scale:t,i=s.scale<i?s.scale:i,this._levelToLOD[s.level]=s})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=i;else if(Mc(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const c=Qw(t,this.spatialReference);if(R(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:kt()}),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=O0.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===O0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(i=o)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=kt()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return O0.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*t;i.push(new j1e({level:n.level,scale:n.scale,resolution:o}))}return new O0({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};u([d({type:Number,json:{write:!0}})],io.prototype,"compressionQuality",void 0),u([d({type:Number,json:{write:!0}})],io.prototype,"dpi",void 0),u([d({type:String,json:{read:ise.read,write:ise.write,origins:{"web-scene":{read:!1,write:!1}}}})],io.prototype,"format",void 0),u([d({readOnly:!0})],io.prototype,"isWrappable",null),u([d({type:ot,json:{write:!0}})],io.prototype,"origin",void 0),u([Ie("origin")],io.prototype,"readOrigin",null),u([d({type:[j1e],value:null,json:{write:!0}})],io.prototype,"lods",null),u([d({readOnly:!0})],io.prototype,"minScale",void 0),u([d({readOnly:!0})],io.prototype,"maxScale",void 0),u([d({readOnly:!0})],io.prototype,"scales",void 0),u([d({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],io.prototype,"size",void 0),u([Ie("size",["rows","cols"])],io.prototype,"readSize",null),u([qe("size",{cols:{type:Br},rows:{type:Br}})],io.prototype,"writeSize",null),u([d({type:et,json:{write:!0}})],io.prototype,"spatialReference",void 0),io=O0=u([P("esri.layers.support.TileInfo")],io),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(io||(io={}));const WD=io,AHe=12;class Lr{constructor(t){const i=Lr.checkUnsupported(t);if(_(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=ww(this.spatialReference)||lm(this.spatialReference)||cm(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new Lr(this.toTileInfo())}toTileInfo(){return new WD({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=XK(t[0]),i[1]=aF(t[1]),i[2]=XK(t[2]),i[3]=aF(t[3])):this._isGCS&&(i[0]=Dt(t[0]),i[1]=Dt(t[1]),i[2]=Dt(t[2]),i[3]=Dt(t[3]))}getExtentGeometry(t,i,r,s=new ai){return this.getExtent(t,i,r,$p),s.spatialReference=this.spatialReference,s.xmin=$p[0],s.ymin=$p[1],s.xmax=$p[2],s.ymax=$p[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof Lr)){if(Lr.checkUnsupported(t))return!1;t=new Lr(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!JS(t.origin[0],this.origin[0],s)||!JS(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*AHe,JS(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(R(t)||n[0]===0||n[1]===0)return s;Lr.computeRowColExtent(t,n,this.origin,$p);let o=$p[1],a=$p[3],l=$p[0],c=$p[2];const h=c-l,p=a-o;if(h*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),h>f&&(l=l+Math.floor(.5*h)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)s.push([0,f,m]);return _(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!cPe(s.resolution,r/2**s.level))}static hasGapInLevels(t){const i=t.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new j("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return R(t)?LY():t.lods.length<1?new j("tilingscheme:generic","Tiling scheme must have at least one level"):Lr.isPowerOfTwo(t)?Lr.hasGapInLevels(t)?new j("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Lr.tileSizeSupported(t)?Lr.hasOriginPerLODs(t)?new j("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new j("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new j("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=$c(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new Lr(new WD({size:[a,a],origin:{x:t[0]-.5*(o-r),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const i=new Lr(Lr.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new Lr(new WD({size:[i,i],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function LY(){return new j("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Lr.WebMercatorAuxiliarySphereTileInfo=new WD({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:et.WebMercator},spatialReference:et.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),Lr.WebMercatorAuxiliarySphere=Lr.makeWebMercatorAuxiliarySphere(19);const $p=kt(),IS=64,pH=512,RHe=2.5,wO=uPe(b9/10),H1e=4,MHe=4,XD=e=>e<4?3:MHe,q1e=kt();Lr.WebMercatorAuxiliarySphere.getExtent(0,0,0,q1e);const OHe=kt([-180,-90,180,90]),PHe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",IHe="Surface extent is too large for tile resolution at level 0.",bh=8,$He=fe.getLogger("esri.views.support.GroundViewElevationSampler");let P0=class extends as.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=wO}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(R(e.extent)||!e.spatialReference)return null;const t=z5(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(R(this.extent)||!La(this.extent,e,t)){const i=_(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return $He.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return vt(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return B1e(e.clone(),this)}};u([d({readOnly:!0})],P0.prototype,"demResolution",void 0),u([d({readOnly:!0})],P0.prototype,"extent",null),u([d({readOnly:!0})],P0.prototype,"noDataValue",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],P0.prototype,"spatialReference",void 0),u([d({constructOnly:!0})],P0.prototype,"view",void 0),P0=u([P("esri.views.support.GroundViewElevationSampler")],P0);const LHe=P0;let I0=class extends Se{constructor(e){super(e),this.handles=new Nt,this.view=null,this.layerViews=new ut}initialize(){this.handles.add(jo(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new LHe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>ie(()=>e.updating,()=>this._updateUpdating(),qi)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([d({readOnly:!0})],I0.prototype,"elevationSampler",null),u([d({type:Boolean,readOnly:!0})],I0.prototype,"updating",null),u([d({constructOnly:!0})],I0.prototype,"view",void 0),u([d({type:ut,readOnly:!0})],I0.prototype,"layerViews",void 0),u([d({readOnly:!0})],I0.prototype,"suspended",null),I0=u([P("esri.views.GroundView")],I0);const DHe=I0,NHe=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:MMe([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:_(s)?s.event:null,signal:_(s)?s.signal:null,defaultPopupTemplateEnabled:!!_(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(_(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const{results:s,mapPoint:n}=await this.popupHitTest(i),o=s.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,r)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),_(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return _(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([P("esri.views.PopupView")],t),t};async function W1e(e,t){return await e.load(),FHe(e,t)}async function FHe(e,t){const i=[],r=(...n)=>{for(const o of n)R(o)||(Array.isArray(o)?r(...o):ut.isCollection(o)?o.forEach(a=>r(a)):ey.isLoadable(o)&&i.push(o))};t(r);let s=null;if(await EUe(i,async n=>{(await ku(kHe(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function kHe(e){return"loadAll"in e&&typeof e.loadAll=="function"}async function UHe(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await Nme("esri/t9n/basemaps");return i[e]||i[t]}const fH={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return xi("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return xi("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return xi("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return xi("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return xi("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return xi("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return xi("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return xi("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return xi("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return xi("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return xi("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return xi("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return xi("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return xi("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return xi("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return xi("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},zHe=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),VHe=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function BHe(e){return e.layerContainerType==="basemap"?zHe:e.layerContainerType==="operational-layers"?VHe:null}function GHe(e,t){if(t.restrictedWebMapWriting){const i=BHe(t);return!_(i)||i.has(e.type)&&!mZ(e)}return!0}function jHe(e,t){if(mZ(e)){const i=kE("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&dV(e,r)}else e.type==="stream"?dV(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&dV(e,t)}function dV(e,t){"maxScale"in e&&(t.maxScale=eF(e.maxScale)),"minScale"in e&&(t.minScale=eF(e.minScale))}function HHe(e,t){if(jHe(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=eF(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(mZ(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function rse(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new j("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(GHe(e,i)){const r={};return e.write(r,i)?r:null}return _(t)&&HHe(e,t=re(t)),t}var ZD;let qHe=0;const pV=fe.getLogger("esri.Basemap");let hh=ZD=class extends Yw(ey){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+qHe++,this.baseLayers=new ut,this.referenceLayers=new ut;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&pV.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{pV.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const e=this.baseLayers.removeAll();for(const r of e)r.destroy();const t=this.referenceLayers.removeAll();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",vw(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i=ye(F({},i),{layerContainerType:"basemap"}),this.baseLayers.forEach(s=>{const n=rse(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=rse(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);_(n)&&(n.isReference=!0,r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",vw(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return W1e(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new ZD({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t=F({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=re(i);return r.url&&Yf(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Yf(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;fi(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push(UHe(n).then(o=>{o&&this.read({title:o},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await import("./layersCreator.c4741fbc.js"),a=[];if(fi(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const h=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(h)}await gs(a)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=js(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||Gn.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Gn.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=fH[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),cde(pV,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return ZD.fromJSON(t)}return null}};u([d({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:ut}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],hh.prototype,"baseLayers",null),u([d({type:String,json:{origins:{"web-scene":{write:!0}}}})],hh.prototype,"id",void 0),u([d({type:nE})],hh.prototype,"portalItem",void 0),u([d()],hh.prototype,"referenceLayers",null),u([d({readOnly:!0})],hh.prototype,"resourceInfo",void 0),u([d({type:et})],hh.prototype,"spatialReference",void 0),u([d()],hh.prototype,"thumbnailUrl",void 0),u([d({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],hh.prototype,"title",void 0),u([qe("title")],hh.prototype,"writeTitle",null),hh=ZD=u([P("esri.Basemap")],hh);const h4=hh;var WHe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:h4}),mH;let YD=mH=class extends ve{constructor(e){super(e),this.type="none"}clone(){return new mH({type:this.type})}};u([at({none:"none",stayAbove:"stay-above"})],YD.prototype,"type",void 0),YD=mH=u([P("esri.ground.NavigationConstraint")],YD);var gH;const sse=fe.getLogger("esri.Ground");let Km=gH=class extends Yw(ey){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new ut;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&sse.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{sse.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=F({},e)).resourceInfo),e}set layers(e){this._set("layers",vw(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r=ye(F({},r),{layerContainerType:"ground"}),e.forEach(n=>{if("write"in n){const o={};K$e(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new j("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return W1e(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.ca58463e.js");fi(t);const r=new i,s=this.layers.filter(nse).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.ca58463e.js");fi(t);const r=new i,s=this.layers.filter(nse).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:re(this.surfaceColor),navigationConstraint:re(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new gH({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return import("./layersCreator.c4741fbc.js").then(({populateOperationalLayers:o})=>{fi(i);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return gs(a)}).then(()=>{})}};function XHe(e){return e&&"createElevationSampler"in e}function nse(e){return e.type==="elevation"||XHe(e)}u([d({json:{read:!1}})],Km.prototype,"layers",null),u([qe("layers")],Km.prototype,"writeLayers",null),u([d({readOnly:!0})],Km.prototype,"resourceInfo",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Br,read:{reader:k2,source:"transparency"},write:{writer:(e,t)=>{t.transparency=U5(e)},target:"transparency"}}})],Km.prototype,"opacity",void 0),u([d({type:Pe,json:{type:[Br],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Km.prototype,"surfaceColor",void 0),u([d({type:YD,json:{write:!0}})],Km.prototype,"navigationConstraint",void 0),Km=gH=u([P("esri.Ground")],Km);const d4=Km;let YT=class extends g_(ut){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(yde(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=_(this.getCollections)?this.getCollections():null;if(R(e))return void this.removeAll();let t=0;for(const i of e)_(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new ut(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([d()],YT.prototype,"getCollections",void 0),u([d()],YT.prototype,"getChildrenFunction",void 0),u([d()],YT.prototype,"itemFilterFunction",void 0),YT=u([P("esri.core.CollectionFlattener")],YT);const oE=YT;function ZHe(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const ose=fe.getLogger("esri.support.basemapUtils");function YHe(){return{}}function QHe(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function JHe(e,t){let i;if(typeof e=="string"){if(!(e in fH)){const r=Object.entries(fH).filter(([s,n])=>Fi.apiKey&&!n.classic||!Fi.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return ose.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${r}`),null}t&&(i=t[e]),i||(i=h4.fromId(e),t&&(t[e]=i))}else i=Bs(h4,e);return(i==null?void 0:i.destroyed)&&(ose.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function KHe(e){return new oE({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return i&&"tables"in i&&i.tables.includes(t)}})}const eqe=fe.getLogger("esri.support.groundUtils"),ase={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function tqe(e){let t=null;if(typeof e=="string")if(e in ase){const i=ase[e];t=new d4({resourceInfo:{data:{layers:[i]}}})}else eqe.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=Bs(d4,e);return t}function yH(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=yH(r.layers,t,i),s))return s}}const lse=fe.getLogger("esri.support.LayersMixin"),iqe=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new ut;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||lse.error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",vw(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof sE){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else Vu(i)?i.then(n=>{this.destroyed||this.add(n,r)}):lse.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;r=s.getNextIndex(r),i.slice().forEach(n=>{n.parent!==this?(s.add(n,r),r+=1):this.reorder(n,r)})}findLayerById(i){return yH(this.layers,"id",i)}findLayerByUid(i){return yH(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([d()],t.prototype,"layers",null),t=u([P("esri.support.LayersMixin")],t),t},X1e="esri.support.TablesMixin",rqe=fe.getLogger(X1e);function vH(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if((n==null?void 0:n.type)==="group"){const o=vH(n.tables,t,i);if(o)return o}}}const sqe=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new ut,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&rqe.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",vw(i,this._get("tables")))}findTableById(i){return vH(this.tables,"id",i)}findTableByUid(i){return vH(this.tables,"uid",i)}};return u([d()],t.prototype,"tables",null),t=u([P(X1e)],t),t};let uf=class extends sqe(iqe(as.EventedMixin(Se))){constructor(e){super(e),this.allLayers=new oE({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=KHe(this),this.basemap=null,this.editableLayers=new oE({getCollections:()=>[this.allLayers],itemFilterFunction:ZHe}),this.ground=new d4,this._basemapCache=YHe()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),QHe(this._basemapCache),this._basemapCache=null}castBasemap(e){return JHe(e,this._basemapCache)}castGround(e){const t=tqe(e);return R(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([d({readOnly:!0,dependsOn:[]})],uf.prototype,"allLayers",void 0),u([d({readOnly:!0})],uf.prototype,"allTables",void 0),u([d({type:h4})],uf.prototype,"basemap",void 0),u([qt("basemap")],uf.prototype,"castBasemap",null),u([d({readOnly:!0})],uf.prototype,"editableLayers",void 0),u([d({type:d4,nonNullable:!0})],uf.prototype,"ground",void 0),u([qt("ground")],uf.prototype,"castGround",null),uf=u([P("esri.Map")],uf);const nqe=uf;let bM=class extends oM{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([yX({Type:Ha,ensureType:Bs(Ha)})],bM.prototype,"itemType",void 0),bM=u([P("esri.support.GraphicsCollection")],bM);let $0=class extends Se{constructor(e){super(e),this.view=null,this.baseLayerViews=new ut,this.referenceLayerViews=new ut,this._loadingHandle=ie(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap},t=>{t&&t.load().catch(()=>{})},Rt)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,i;if(this.view&&this.view.suspended)return!1;const e=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([d({constructOnly:!0})],$0.prototype,"view",void 0),u([d({readOnly:!0})],$0.prototype,"baseLayerViews",void 0),u([d({readOnly:!0})],$0.prototype,"referenceLayerViews",void 0),u([d({readOnly:!0})],$0.prototype,"suspended",null),u([d({type:Boolean,readOnly:!0})],$0.prototype,"updating",null),$0=u([P("esri.views.BasemapView")],$0);const oqe=fe.getLogger("esri.views.LayerViewManager");class aqe{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=qv(),this._started=!1,this.done=!1,ha(this._controller.signal,()=>{const s=new j("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:t}),"prefetchResources"in i&&await i.prefetchResources({signal:t}),i.createLayerView)o=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new j("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(i);fi(t),o="default"in h?new h.default({layer:i,view:r}):new h({layer:i,view:r})}const l=()=>{a=cn(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=ha(t,l),fi(t);try{await o.when()}catch(h){throw l(),h}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new j("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new j("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}}let dh=class extends q2{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new zf,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const t=(i=this.view.map)==null?void 0:i.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(R(this._workPromise)&&(this._workPromise=qv()),this.handles.remove("reschedule"),this.handles.add(zE(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var n,o,a;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),R(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const i=new oE({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!i)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of i)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)i.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const r=i.filter(l=>l.type==="group").map(l=>l.layers),s=[(n=t==null?void 0:t.ground)==null?void 0:n.layers,(o=t==null?void 0:t.basemap)==null?void 0:o.baseLayers,(a=t==null?void 0:t.basemap)==null?void 0:a.referenceLayers,t==null?void 0:t.layers,...r].filter(l=>!!l);this.handles.add(s.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([ns(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),ie(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Us)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return _(this._workPromise)||this._watchUpdatingTracking.updating||sn(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new j("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new aqe(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(Jr(i)||i.name==="cancelled:layerview-create")||oqe.error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([d()],dh.prototype,"_workPromise",void 0),u([d({readOnly:!0})],dh.prototype,"_watchUpdatingTracking",void 0),u([d({readOnly:!0})],dh.prototype,"_layersToLayerViews",null),u([d({readOnly:!0})],dh.prototype,"_rootCollectionNames",null),u([d()],dh.prototype,"layerViewImporter",void 0),u([d()],dh.prototype,"supportsGround",void 0),u([d({readOnly:!0})],dh.prototype,"updating",null),u([d({readOnly:!0})],dh.prototype,"updatingRemaining",null),u([d({constructOnly:!0})],dh.prototype,"view",void 0),dh=u([P("esri.views.LayerViewManager")],dh);const lqe=dh;let Qc=class extends Se{constructor(e){super(e),this.factor=1.5,this.offset=Sp(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([d({type:Number})],Qc.prototype,"factor",void 0),u([d({nonNullable:!0})],Qc.prototype,"offset",void 0),u([d()],Qc.prototype,"position",void 0),u([d({type:Number,range:{min:0}})],Qc.prototype,"size",void 0),u([d()],Qc.prototype,"maskUrl",void 0),u([d()],Qc.prototype,"maskEnabled",void 0),u([d()],Qc.prototype,"overlayUrl",void 0),u([d()],Qc.prototype,"overlayEnabled",void 0),u([d({readOnly:!0})],Qc.prototype,"version",null),u([d({type:Boolean})],Qc.prototype,"visible",void 0),Qc=u([P("esri.views.Magnifier")],Qc);const Z1e=Qc;let QD=class extends Se{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.push(new cse(r,s,e,t,i)))}unshift(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.unshift(new cse(r,s,e,t,i)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const i=nn(t.signal);if(i&&!t.abortCallback)t.reject(mi());else{const r=i?t.abortCallback(mi()):t.callback(e);Vu(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=mi();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};u([d()],QD.prototype,"running",void 0),QD=u([P("esri.layers.support.PromiseQueue")],QD);class cse{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let xR=class extends Se{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([d()],xR.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([d()],xR.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),xR=u([P("esri.views.support.DebugFlags")],xR);const cqe=new xR,uqe=fe.getLogger("esri.views.support.Scheduler");function hqe(){return new p4.Scheduler}var yt;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(yt||(yt={}));const Cf=0,use=new Map([[yt.RESOURCE_CONTROLLER,Cf],[yt.SLIDE,Cf],[yt.STREAM_DATA_LOADER,Cf],[yt.ELEVATION_QUERY,Cf],[yt.TERRAIN_SURFACE,1],[yt.SURFACE_GEOMETRY_UPDATES,1],[yt.GRAPHICS_CORE,2],[yt.I3S_CONTROLLER,2],[yt.POINT_CLOUD_LAYER,2],[yt.FEATURE_TILE_FETCHER,2],[yt.OVERLAY,4],[yt.STAGE,4],[yt.GRAPHICS_DECONFLICTOR,4],[yt.FILTER_VISIBILITY,4],[yt.SCALE_VISIBILITY,4],[yt.FRUSTUM_VISIBILITY,4],[yt.POINT_OF_INTEREST_FREQUENT,6],[yt.POINT_OF_INTEREST_INFREQUENT,30],[yt.LABELER,8],[yt.FEATURE_QUERY_ENGINE,8],[yt.FEATURE_TILE_TREE,16],[yt.FEATURE_TILE_TREE_ACTIVE,Cf],[yt.ELEVATION_ALIGNMENT,12],[yt.TEXT_TEXTURE_ATLAS,12],[yt.CLOUDS_GENERATOR,12],[yt.TEXTURE_UNLOAD,12],[yt.LINE_OF_SIGHT_TOOL,16],[yt.LINE_OF_SIGHT_TOOL_INTERACTIVE,Cf],[yt.SNAPPING,Cf],[yt.SHADOW_ACCUMULATOR,30]]);function hse(e){return use.has(e)?use.get(e):typeof e=="number"?e:1}var Nn;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(Nn||(Nn={}));const dse=6.5,pse=1,dqe=30,fse=1e3/30,mse=100,gse=.9;var p4,$_;(function(e){let t=class extends Se{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new Iv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Nn.INTERACTING,this._tasks=new Wt,this._runQueue=new Wt,this._load=0,this._idleStateCallbacks=new Wt,this._idleUpdatesStartFired=!1,this._maxReschedule=FI,this._forceTask=!1,this._debug=!1,this._debugHandle=ie(()=>cqe.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,Rt);for(const o of Object.keys(yt))this.performanceInfo.tasks.set(yt[o],new Iv(yt[o]));let s;const n=this;this._test={get state(){return vt(s,n._state)},set state(o){s=o},FRAME_SAFETY_BUDGET:dse,INTERACTING_BUDGET:fse,IDLE_BUDGET:mse,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),cn(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=FI,this._schedule(),this.frame()))}))}registerTask(s,n){const o=hse(s),a=new i(this,s,n,o);return this._tasks.push(a),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new Iv(s)),a}registerIdleStateCallbacks(s,n){const o={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(o),this.state===Nn.IDLE&&this._idleUpdatesStartFired&&o.idleBegin();const a=this;return{remove:()=>this._removeIdleStateCallbacks(o),set idleBegin(l){a._idleUpdatesStartFired&&(o.idleEnd(),a._state===Nn.IDLE&&l()),o.idleBegin=l},set idleEnd(l){o.idleEnd=l}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Nn.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return R(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=dse,o=s.frameDuration,a=pse;switch(this.state){case Nn.IDLE:n=0,o=Math.max(mse,s.frameDuration),a=dqe;break;case Nn.INTERACTING:o=Math.max(fse,s.frameDuration);case Nn.ANIMATING:}return o=o-s.elapsedFrameTime-n,this.state!==Nn.IDLE&&o<pse&&!this._forceTask?(this._forceTask=!0,!1):(o=Math.max(o,a),this._budget.reset(o,this.state),this._maxReschedule=FI,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Nn.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Nn.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(o=>o.name===s))return $_.SCHEDULED;let n=$_.IDLE;return this._tasks.forAll(o=>{o.name===s&&o.needsUpdate&&(o.schedulePriority<=1?n=$_.READY:n!==$_.READY&&(n=$_.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(o=>{o.name===s&&(n+=o.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(o=>{o.needsUpdate&&s.set(o.name,(s.get(o.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((o,a)=>{n+=o>1?` ${o}x ${a}`:` ${a}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,o)=>o.needsUpdate?++n:n,0);this._load=this._load*gse+s*(1-gse)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===Cf&&s.needsUpdate&&!this._runQueue.includes(s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(o=>{o.needsUpdate&&o.schedulePriority!==0&&o.basePriority!==Cf&&(s=!0,n=Math.max(n,o.basePriority),o.schedulePriority===1?(o.schedulePriority=0,this._runQueue.push(o)):--o.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===FI&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)}catch(l){uqe.error(`Exception in task "${o.name}"`,l)}o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",o.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(yt))this._frameTaskTimes.set(yt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,o)=>this.performanceInfo.tasks.get(o).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};u([d()],t.prototype,"updating",void 0),t=u([P("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends Se{constructor(s,n,o,a){super({}),this._scheduler=s,this.name=n,this._basePriority=a,this.runtime=0,this._queue=new QD,this._handles=new Nt,this.schedulePriority=this._basePriority,this.task=_(o)?o:this._queue,this._handles.add(jo(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(nC),this._scheduler.removeTask(this),this.schedule=aE.schedule,this.reschedule=aE.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=hse(s);this._basePriority!==Cf&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,o){return this._queue.push(s,n,o)}reschedule(s,n,o){return this._queue.unshift(s,n,o)}processQueue(s){this._queue.runTask(s)}};u([d({constructOnly:!0})],i.prototype,"task",void 0),u([d({readOnly:!0})],i.prototype,"updating",null),i=u([P("esri.views.support.SchedulerTask")],i);class r{constructor(){this._begin=typeof performance!="undefined"?performance.now():0,this._budget=0,this._state=Nn.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r})(p4||(p4={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}($_||($_={}));const nC=(()=>{const e=new p4.Budget;return e.enabled=!1,e})();class pqe{remove(){}processQueue(){}schedule(t,i,r){try{if(nn(i)){const s=mi();return r?Promise.resolve(r(s)):Promise.reject(s)}return a9(t(nC))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const aE=new pqe,FI=Number.MAX_SAFE_INTEGER;let $S=class extends Se{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(yt.TEXTURE_UNLOAD))!=null?i:aE}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return _(t)?`${e}.${t}px`:e}};u([d()],$S.prototype,"_frameTask",void 0),u([d()],$S.prototype,"updating",null),$S=u([P("esri.views.3d.support.TextureCollection")],$S);var yse;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(yse||(yse={}));const Y1e=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Q1e={};function J1e(e){return!!Q1e[e]}function fqe(e){for(const t of e)if(!J1e(t))return!1;return!0}Y1e.forEach(e=>{Q1e[e]=!0});class mqe{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:i,priority:r},s)=>this.inputManager.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this.handlers.forEach((t,i)=>this.inputManager.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!fqe(n))return n.some(J1e)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s!=null?s:kv.DEFAULT;const l=this._createUniqueGroupName(),c=new gqe(this.view,n,a,o);this.handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,i){if(this.handlers.has(t)){this.handlers.delete(t);for(const r of i){const s=this.handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this.handlerCounts.delete(r):this.handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class gqe extends Ho{constructor(t,i,r,s){super(!0),this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:Sp(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:f=>t.async(f),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(Sp(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this.latestDragStart=i),!this.latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=t,f={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Ac(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:f}=t;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:f,timestamp:m}=t;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>t.stopPropagation(),async:y=>t.async(y),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var xO,vse,_se;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(xO||(xO={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(vse||(vse={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(_se||(_se={}));const yqe=fe.getLogger("esri.views.interactive.interactiveToolUtils");function vqe(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return yqe.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.visible=!1,i.active&&(i.view.activeTool=null),i.destroy()})]}function f4(e){return e.visible&&e.getEditableFlag(xO.USER)&&e.getEditableFlag(xO.MANAGER)}function hf(e){return Sp(e.x,e.y)}function pEt(e){return Yr(e.x,e.y)}function K1e(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return Sp(t.clientX-i.left,t.clientY-i.top)}function bse(e,t){return t instanceof Event?K1e(e,t):hf(t)}function wse(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class _qe{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":xse(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Tse(t))break;const s=hf(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(R(n))break;const o=this._findToolAndManipulatorByKey(n,i.forEachTool,kI),a=rn(o,c=>c.manipulator),l=rn(o,c=>c.tool);!(_(a)&&_(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(t)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,t),_(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(t)&&!a.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool!==n.tool&&(this._currentlyActiveTool=i.activeTool,this._revertToActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!Tse(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),o=rn(s||n,({key:h})=>h),a=this._findManipulatorByKey(o,i.forEachTool);if(R(a))break;const l=hf(t);l.x=De(l.x,0,i.view.width),l.y=De(l.y,0,i.view.height);const c=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:o,start:c}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=hf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findToolAndManipulatorByKey(n,i.forEachTool,kI);if(bqe(t)||i.forEachTool(h=>{if((!_(o)||o.tool!==h||h.automaticManipulatorSelection)&&h.manipulators){let p=!1;h.manipulators.forEach(({manipulator:f})=>{f.selected&&(f.selected=!1,p=!0)}),p&&h.manipulatorSelectionChanged&&h.manipulatorSelectionChanged()}}),R(o))break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:r});break}case"click":{const s=hf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(R(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{const s=hf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(R(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=hf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(R(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:hf(r)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===i&&i.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,i){const r=rn(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(r,i.forEachTool);_(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(i.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:hf(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,i){let r=null;return sn(t,({key:s})=>{const n=this._findManipulatorByKey(s,i);return!!(_(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(r=n.cursor,!0)}),r}_onFocusChange(t){this._updateCursor(t),this._updateFocusedManipulatorTools(t)}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const i=new Set;this._grabbedManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),this._hoveredManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),t(r=>{r.hasFocusedManipulators=i.has(r)})}clearPointers(t,i,r=!0,s){const n=o=>o.tool===t&&(R(s)||o.manipulatorId===s);this._grabbedManipulators.forEach(({key:o,pointerType:a},l)=>{if(n(o)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(o,i);_(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}}),this._draggedManipulators.forEach(({key:o},a)=>{if(n(o)){this._draggedManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),r&&this._hoveredManipulators.forEach(({key:o},a)=>{if(n(o)){this._hoveredManipulators.delete(a);const l=this._findManipulatorByKey(o,i);_(l)&&(l.hovering=!1)}}),this._onFocusChange(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!f4(n))return!1;const o=n.manipulators.intersect(t,i);return!R(o)&&(s={manipulatorId:o.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Sp(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!xse(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(hf(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){const n=this._intersect(t,r,s);let o=this._findManipulatorByKey(n,s);const a=rn(this._hoveredManipulators.get(i),({key:c})=>c),l=this._findManipulatorByKey(a,s);_(o)&&!o.interactive&&(o=null),l!==o&&(_(l)&&(l.hovering=!1),_(o)?(o.hovering=!0,this._hoveredManipulators.set(i,{key:n})):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_findManipulatorByKey(t,i){return this._findToolAndManipulatorByKey(t,i,kI)?kI.manipulator:null}_findToolAndManipulatorByKey(t,i,r){return R(t)?null:(r.tool=null,r.manipulator=null,i(s=>{if(s!==t.tool||s.manipulators==null||!f4(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!_(n)&&(r.manipulator=n,r.tool=s,!0)}),r.manipulator?r:null)}}function xse(e){return e==="mouse"}function Tse(e){return e.pointerType!=="mouse"||e.button===0}function bqe(e){return!!e.native.shiftKey}const kI={manipulator:null,tool:null},wqe=fe.getLogger("esri.views.ToolViewManager"),Sse="attached",fV="tools";let eg=class extends q2{constructor(e){super(e),this._manipulatorState=new _qe,this.tools=new ut,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(Y1e,e=>{this._handleInputEvent(e)},kv.TOOL),...vqe(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(_(e)&&!this.view.ready)return void wqe.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),_(t)&&t.deactivate(),_(e)&&e.activate(),this._removeIncompleteTools(e);const i=R(this.activeTool);for(const r of this.tools){r.setEditableFlag(xO.MANAGER,i||r===this.activeTool);const s=f4(r);!i&&s||this._manipulatorState.clearPointers(r,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new $S(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([ie(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),qh(()=>this._set("textures",lt(this.textures)))],Sse)):this.handles.add(ie(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){_(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Sse)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i=ye(F({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});_(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:r=>{this.activeTool=r},view:this.view}),!t&&_(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(fV),this._forEachTool(e=>{if(e instanceof Se){const t=ie(()=>[e.cursor,e.visible,e.editable],()=>{f4(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,fV)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:i})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,i)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),fV)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool(i=>!(!_(i.cursor)||!i.visible||!R(e)&&i.preferManipulatorCursor)&&(t=i.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter(t=>(R(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([d({constructOnly:!0,nonNullable:!0})],eg.prototype,"view",void 0),u([d({readOnly:!0,nonNullable:!0})],eg.prototype,"textures",void 0),u([d({value:null})],eg.prototype,"activeTool",null),u([d({readOnly:!0,type:ut})],eg.prototype,"tools",void 0),u([d({readOnly:!0})],eg.prototype,"cursor",void 0),u([d({readOnly:!0})],eg.prototype,"updating",null),eg=u([P("esri.views.ToolViewManager")],eg);const xqe=eg;let QT=class extends Se{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":Tqe.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return Sqe[this.deviceType]}};u([d({nonNullable:!0,readOnly:!0})],QT.prototype,"nativeIndex",void 0),u([d({type:String,readOnly:!0})],QT.prototype,"deviceType",null),u([d({type:Number,readOnly:!0})],QT.prototype,"axisThreshold",null),QT=u([P("esri.views.input.gamepad.GamepadInputDevice")],QT);const Tqe=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Sqe={standard:.15,spacemouse:.025,unknown:0},DY=QT;let TR=class extends Se{constructor(...e){super(...e),this.devices=new ut,this.enabledFocusMode="document"}};u([d({type:ut.ofType(DY),readOnly:!0})],TR.prototype,"devices",void 0),u([d({type:["document","view","none"]})],TR.prototype,"enabledFocusMode",void 0),TR=u([P("esri.views.input.gamepad.GamepadSettings")],TR);const Eqe=TR;let JD=class extends Se{constructor(){super(...arguments),this.gamepad=new Eqe}};u([d({readOnly:!0})],JD.prototype,"gamepad",void 0),JD=u([P("esri.views.input.Input")],JD);const Cqe=JD;let L0=class extends Se{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([d({type:Boolean,nonNullable:!0})],L0.prototype,"enabled",void 0),u([d({type:DY})],L0.prototype,"device",void 0),u([d({type:["pan","zoom"],nonNullable:!0})],L0.prototype,"mode",void 0),u([d({type:["forward-down","forward-up"],nonNullable:!0})],L0.prototype,"tiltDirection",void 0),u([d({type:Number,nonNullable:!0})],L0.prototype,"velocityFactor",void 0),L0=u([P("esri.views.navigation.gamepad.GamepadSettings")],L0);const ebe=L0;let G1=class extends Se{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new ebe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([d({type:Boolean})],G1.prototype,"browserTouchPanEnabled",void 0),u([d({type:ebe,nonNullable:!0})],G1.prototype,"gamepad",void 0),u([d({type:Boolean})],G1.prototype,"momentumEnabled",void 0),u([d({type:Boolean})],G1.prototype,"mouseWheelZoomEnabled",void 0),G1=u([P("esri.views.navigation.Navigation")],G1);const tbe=G1;function fEt(e,t,i){const r=ibe(e),s=t,n=Aqe(r,s,i);if(r){const o=ox.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new j("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new j("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!Rqe(e)||n===sc.Unsupported)return new j("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case sc.Units:{const o=r.heightUnit||"unknown",a=s.heightUnit||"unknown",l=new j("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case sc.HeightModel:{const o=r.heightModel||"unknown",a=s.heightModel||"unknown",l=new j("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case sc.CRS:{const o=r.vertCRS||"unknown",a=s.vertCRS||"unknown",l=new j("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new j("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function Aqe(e,t,i){if(!Ese(e)||!Ese(t))return sc.Unsupported;if(e==null||t==null)return sc.Ok;if(!i&&e.heightUnit!==t.heightUnit)return sc.Units;if(e.heightModel!==t.heightModel)return sc.HeightModel;switch(e.heightModel){case"gravity-related-height":return sc.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?sc.Ok:sc.CRS;default:return sc.Unsupported}}var sc;function Ese(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function Rqe(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!nbe(e)}function ibe(e){const t=e.url&&Cw(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&_(t)&&t.serverType==="ImageServer")&&rbe(e)&&e.heightModelInfo?e.heightModelInfo:nbe(e)?ox.deriveUnitFromSR(Oqe,e.spatialReference):null}function rbe(e){return"heightModelInfo"in e}function sbe(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function nbe(e){return sbe(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):obe(e)}function Mqe(e){return e.layers!=null||obe(e)||sbe(e)||rbe(e)}function obe(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(sc||(sc={}));const Oqe=new ox({heightModel:"gravity-related-height"});var Ge;function Cse(e){return e==="global"?Ge.Global:Ge.Local}function mV(e){return e===Ge.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(Ge||(Ge={}));let _H,gV=null;async function Pqe(e){gV||(gV=Promise.resolve().then(function(){return Idt}).then(t=>_H=t)),await gV,fi(e)}async function abe(e,t,i,r){if(!e)return null;const s=e.spatialReference;return WX()||im(s,t)?N3(e,t):_H?_H.projectGeometry(e,t,i,r):(await Promise.race([Pqe(r),OF(r)]),abe(e,t,i,r))}let $r=class extends Se{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=Hh(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return _(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return R(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,r,s,n;const e=(i=this.map)==null?void 0:i.call(this),t=[];return _(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(r=e==null?void 0:e.basemap)==null?void 0:r.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);_(a)&&(i=a)}if(_(i)&&i.length===1)break}if(t&&(R(i)||i.length!==1))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:_(r)?r.spatialReference:null,viewingMode:_(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,r,s,n,o,a,l,c;if(!this.required.tileInfo)return(i=this._get("_tileInfoTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var i,r,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))==null?void 0:i.heightModelInfo))return(r=this._get("_heightModelInfoTask"))!=null?r:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(Mqe(o)){const a=ibe(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var r,s;if(this.suspended||!this.required.extent)return(r=this._get("_extentCandidatesTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(_(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)i.push({extent:c,layer:n})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(R(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:_(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(_(this._projectExtentTask.task)&&(this._projectExtentTask.task=Hh(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:A3(async s=>{try{const n=await abe(i.extent,r,i.layer.portalItem,s);this._projectExtentTask=ye(F({},this._projectExtentTask),{task:null,output:n})}catch{if(nn(s))return;this._projectExtentTask=ye(F({},this._projectExtentTask),{task:null})}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(R(e))return t;const i=[],r=(s,n)=>_(s)?_(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=r(s.viewingMode,n.viewingMode);if(o!==!1){i.push({spatialReference:s.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return R(e)||e.length<1?_(t)?{spatialReference:t,viewingMode:null}:null:(_(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==Ge.Local)&&(e=e.filter(({viewingMode:i})=>i!==Ge.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(_(s)){const n=_(s.constraints)?s.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||R(this.userSpatialReference)||o.equals(this.userSpatialReference))&&i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};u([d()],$r.prototype,"required",void 0),u([d({constructOnly:!0})],$r.prototype,"map",void 0),u([d({constructOnly:!0})],$r.prototype,"getSpatialReferenceSupport",void 0),u([d()],$r.prototype,"defaultSpatialReference",void 0),u([d()],$r.prototype,"userSpatialReference",void 0),u([d()],$r.prototype,"sourcePreloadCount",void 0),u([d()],$r.prototype,"priorityCollection",void 0),u([d()],$r.prototype,"requiresExtentInSpatialReference",void 0),u([d()],$r.prototype,"suspended",void 0),u([d({readOnly:!0})],$r.prototype,"ready",null),u([d({readOnly:!0})],$r.prototype,"heightModelInfoReady",null),u([d({readOnly:!0})],$r.prototype,"spatialReference",null),u([d({readOnly:!0})],$r.prototype,"extent",null),u([d({readOnly:!0})],$r.prototype,"heightModelInfo",null),u([d({readOnly:!0})],$r.prototype,"vcsWkid",null),u([d({readOnly:!0})],$r.prototype,"latestVcsWkid",null),u([d({readOnly:!0})],$r.prototype,"viewingMode",null),u([d({readOnly:!0})],$r.prototype,"tileInfo",null),u([d({readOnly:!0})],$r.prototype,"mapCollections",null),u([d({readOnly:!0})],$r.prototype,"_allLayers",null),u([d({readOnly:!0})],$r.prototype,"_spatialReferenceTask",null),u([d({readOnly:!0})],$r.prototype,"_tileInfoTask",null),u([d({readOnly:!0})],$r.prototype,"_heightModelInfoTask",null),u([d({readOnly:!0})],$r.prototype,"_extentCandidatesTask",null),u([d()],$r.prototype,"_extentTask",null),u([d()],$r.prototype,"_projectExtentTask",void 0),$r=u([P("esri.views.support.DefaultsFromMap")],$r);var KD;const UI=fe.getLogger("esri.views.View");let Pt=KD=class extends g_(as.EventedMixin(X5(Se))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new oE({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new bM,this.analyses=new K2,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new ut,this.magnifier=new Z1e,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Cqe,this.navigation=new tbe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new mqe(this),this.persistableViewModels=new ut,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(ie(()=>this.preconditionsReady,t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,KD.views.add(this)):(this._currentSpatialReference=null,KD.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.layerViewManager)==null||i.clear(),(r=this.toolViewManager)==null||r.detach(),_(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),_(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},qi))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,_w(()=>this.ready)))),this.basemapView=new $0({view:this}),this.layerViewManager=new lqe({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new xqe({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([ie(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required=ye(F({},this.defaultsFromMap.required),{extent:e}),{sync:!0,initial:!0}),ie(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),ie(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([ie(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(t&&!this.spatialReference&&i){if(_(e))return;const s=qh(()=>e=Hh(e));e=A3(async n=>{try{await P2(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}UI.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=lt(this.graphics),this.analyses=lt(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),lt(this.analysisViewManager),this.toolViewManager=lt(this.toolViewManager),this.layerViewManager=lt(this.layerViewManager),this.basemapView=lt(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return UI.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new $r(F({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e)},this._defaultsFromMapSettings))}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||ey.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)==null?void 0:e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&((e==null?void 0:e.destroyed)&&(UI.warn("#map","The provided map is already destroyed",{map:e}),e=null),ey.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,i;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((i=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:i.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!Mc(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return _(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(i=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?i:null}importLayerView(e){throw new j("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return _(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&UI.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(jo(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Pt.views=new ut,u([d()],Pt.prototype,"_userSpatialReference",void 0),u([Xe("toolViewManager.activeTool")],Pt.prototype,"activeTool",void 0),u([d({readOnly:!0})],Pt.prototype,"allLayerViews",void 0),u([d()],Pt.prototype,"groundView",void 0),u([d()],Pt.prototype,"animation",void 0),u([d()],Pt.prototype,"basemapView",void 0),u([d({readOnly:!0})],Pt.prototype,"_defaultsFromMapSettings",null),u([d()],Pt.prototype,"defaultsFromMap",null),u([d()],Pt.prototype,"fatalError",void 0),u([d({type:ai})],Pt.prototype,"extent",void 0),u([d(c7(bM,"graphics"))],Pt.prototype,"graphics",void 0),u([d(c7(K2,"analyses"))],Pt.prototype,"analyses",void 0),u([d({readOnly:!0,type:ox})],Pt.prototype,"heightModelInfo",null),u([d({readOnly:!0})],Pt.prototype,"interacting",null),u([d({readOnly:!0})],Pt.prototype,"navigating",void 0),u([d({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Pt.prototype,"preconditionsReady",null),u([d({readOnly:!0})],Pt.prototype,"typeSpecificPreconditionsReady",void 0),u([d({type:ut,readOnly:!0})],Pt.prototype,"layerViews",void 0),u([d({type:Z1e})],Pt.prototype,"magnifier",void 0),u([d({value:null,type:nqe})],Pt.prototype,"map",null),u([d()],Pt.prototype,"padding",void 0),u([d({readOnly:!0})],Pt.prototype,"ready",void 0),u([d({type:et})],Pt.prototype,"spatialReference",null),u([d()],Pt.prototype,"spatialReferenceWarningDelay",void 0),u([d()],Pt.prototype,"stationary",null),u([d({readOnly:!0})],Pt.prototype,"supportsGround",void 0),u([d({type:mm})],Pt.prototype,"timeExtent",void 0),u([Xe("toolViewManager.tools")],Pt.prototype,"tools",void 0),u([d()],Pt.prototype,"toolViewManager",void 0),u([d({readOnly:!0})],Pt.prototype,"type",void 0),u([d({type:Number})],Pt.prototype,"scale",void 0),u([d({readOnly:!0})],Pt.prototype,"updating",void 0),u([d({readOnly:!0})],Pt.prototype,"initialExtentRequired",void 0),u([d({readOnly:!0})],Pt.prototype,"initialExtent",null),u([d()],Pt.prototype,"cursor",null),u([d({readOnly:!0})],Pt.prototype,"input",void 0),u([d({type:tbe,nonNullable:!0})],Pt.prototype,"navigation",void 0),u([d()],Pt.prototype,"layerViewManager",void 0),u([d()],Pt.prototype,"analysisViewManager",void 0),u([d()],Pt.prototype,"width",void 0),u([d()],Pt.prototype,"height",void 0),u([d({readOnly:!0})],Pt.prototype,"resizing",void 0),u([d({value:null,readOnly:!0})],Pt.prototype,"size",null),u([d({readOnly:!0})],Pt.prototype,"suspended",void 0),u([d({readOnly:!0})],Pt.prototype,"viewEvents",void 0),u([d({readOnly:!0})],Pt.prototype,"persistableViewModels",void 0),u([d()],Pt.prototype,"_isValid",void 0),u([d()],Pt.prototype,"_readyCycleForced",void 0),u([d()],Pt.prototype,"_currentSpatialReference",void 0),Pt=KD=u([P("esri.views.View")],Pt);const Iqe=Pt;let D0=class extends vF{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new j("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=Vu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([d({readOnly:!0})],D0.prototype,"done",null),u([d({readOnly:!0,type:String})],D0.prototype,"state",void 0),u([d()],D0.prototype,"target",void 0),D0=u([P("esri.views.ViewAnimation")],D0),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(D0||(D0={}));const lE=D0,UC=()=>import("./TileLayerView3D.de622297.js"),Ase=()=>import("./ElevationLayerView3D.1805a61c.js"),Rse={"base-dynamic":()=>import("./BaseDynamicLayerView3D.3e8ea9d1.js"),"base-elevation":Ase,"base-tile":UC,"bing-maps":UC,"building-scene":()=>import("./BuildingSceneLayerView3D.62042a92.js"),csv:()=>import("./CSVLayerView3D.7fed094c.js"),elevation:Ase,feature:()=>import("./FeatureLayerView3D.e6394ee0.js"),geojson:()=>import("./GeoJSONLayerView3D.4ab7cea3.js"),graphics:()=>import("./GraphicsLayerView3D.b929f034.js"),group:()=>import("./GroupLayerView.d380c7bb.js"),imagery:()=>import("./ImageryLayerView3D.aceaceb8.js"),"integrated-mesh":()=>import("./IntegratedMeshLayerView3D.2e625a2a.js"),"line-of-sight":()=>import("./LineOfSightLayerView3D.25834e4e.js"),"map-image":()=>import("./MapImageLayerView3D.6d694dcc.js"),media:()=>import("./MediaLayerView3D.34b089a5.js"),"ogc-feature":()=>import("./OGCFeatureLayerView3D.4985ea23.js"),"open-street-map":UC,"point-cloud":()=>import("./PointCloudLayerView3D.e377bfc0.js").then(function(e){return e.P}),voxel:()=>import("./VoxelLayerView3D.a9e37876.js"),route:()=>import("./RouteLayerView3D.519a0d08.js"),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?import("./SceneLayerView3D.5e20f527.js"):import("./SceneLayerGraphicsView3D.d3501cec.js"),stream:()=>import("./StreamLayerView3D.d2bbb140.js"),tile:UC,"imagery-tile":()=>import("./ImageryTileLayerView3D.3a033384.js"),"vector-tile":()=>import("./VectorTileLayerView3D.b32f0bb5.js"),wcs:()=>import("./ImageryTileLayerView3D.3a033384.js"),"web-tile":UC,wfs:()=>import("./WFSLayerView3D.a5983142.js"),wms:()=>import("./WMSLayerView3D.d44b67af.js"),wmts:()=>import("./WMTSLayerView3D.a7469c91.js"),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function $qe(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new j(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const Mse={hasLayerViewModule:e=>_(Rse[e.type]),importLayerView:e=>{const t=Rse[e.type];if(R(t))throw $qe(e);return t(e)}},Lqe=fe.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),Ose="analyses-owner-handles";var LS,_b;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(LS||(LS={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(_b||(_b={}));let j1=class extends q2{constructor(e){super(e),this._allAnalysisViews=new ut,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=xp(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(mi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(mi()),this._attachedToViewResolver=xp(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(R(t)||t.state.list===_b.REMOVED)throw new j("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Ose)}_disconnectOwners(){this.handles.remove(Ose),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:LS.PENDING,list:_b.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=A3(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=_b.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=_b.REMOVED,this._scheduleUpdate()):Lqe.error("Trying to remove analysis which was not added")}_scheduleUpdate(){_(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=zE(()=>this._update()))}_update(){this._scheduledUpdateHandle=cn(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===_b.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case LS.PENDING:e.createAnalysisViewTask=Hh(e.createAnalysisViewTask);break;case LS.CREATED:_(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=lt(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,R(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(nn(t))throw this._creatingViewCount-=1,mi("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(nn(t))throw this._creatingViewCount-=1,n.destroy(),mi("AnalysisView creation aborted");return e.view=n,e.state.view=LS.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return import("./AreaMeasurementAnalysisView3D.488b4e66.js").then(function(t){return t.A});case"dimensioning":return import("./DimensioningAnalysisView3D.1eb9ebf5.js").then(function(t){return t.D});case"direct-line-measurement":return import("./DirectLineMeasurementAnalysisView3D.8fd59364.js").then(function(t){return t.D});case"line-of-sight":return import("./LineOfSightAnalysisView3D.4c5695db.js");case"slice":return import("./SliceAnalysisView3D.3bee5381.js").then(function(t){return t.S})}}};u([d()],j1.prototype,"updating",null),u([d({constructOnly:!0})],j1.prototype,"view",void 0),u([d()],j1.prototype,"_allAnalysisViews",void 0),u([d()],j1.prototype,"_creatingViewCount",void 0),j1=u([P("esri.views.3d.analysis.AnalysisViewManager3D")],j1);const Dqe=j1,Nqe=fe.getLogger("esri.views.3d.state.Constraints");let tg=class extends Se{constructor(e){super(e),this.collision=new SR,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===Ge.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ge.Local?this._set("altitude",e):Nqe.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?De(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return De(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ge.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=yV)=>(i.min=Do.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?xD([[4e3,Do.max],[1e4,Dt(88)],[6e6,Dt(88)]]):()=>Do.max;return(t,i=yV)=>(i.min=Do.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?xD([[4e3,Do.max],[5e4,Dt(88)],[6e6,Dt(88)],[2e7,Do.min]]):xD([[3e5,Do.max],[3e6,Dt(88)],[6e6,Dt(88)],[2e7,Do.min]]);return(t,i=yV)=>(i.min=Do.min,i.max=e(t),i)}};function Fqe(e){return{min:-2e5,max:4*e.radius}}u([d()],tg.prototype,"altitude",null),u([d({readOnly:!0})],tg.prototype,"collision",void 0),u([d()],tg.prototype,"distance",void 0),u([d({readOnly:!0})],tg.prototype,"minimumPoiDistance",void 0),u([d()],tg.prototype,"tilt",void 0),u([d({constructOnly:!0})],tg.prototype,"mode",void 0),tg=u([P("esri.views.3d.state.Constraints")],tg);const Pse=Fqe(Pi),Do={min:Dt(.5),max:Dt(179.5)},yV={min:0,max:0};let SR=class extends Se{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([d({type:Boolean})],SR.prototype,"enabled",void 0),u([d({type:Number})],SR.prototype,"elevationMargin",void 0),SR=u([P("esri.views.3d.state.Constraints.CollisionConstraint")],SR);let DS=class extends Se{constructor(){super(...arguments),this.min=Pse.min,this.max=Pse.max}};u([d({type:Number})],DS.prototype,"min",void 0),u([d({type:Number})],DS.prototype,"max",void 0),DS=u([P("esri.views.3d.constraints.AltitudeConstraint")],DS);let mg=class extends Se{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([d({type:Number,value:1e-8})],mg.prototype,"near",null),u([qt("near")],mg.prototype,"castNear",null),u([d({type:Number,value:1e-8})],mg.prototype,"far",null),u([qt("far")],mg.prototype,"castFar",null),u([d({type:["auto","manual"]})],mg.prototype,"mode",void 0),mg=u([P("esri.views.3d.constraints.ClipDistanceConstraint")],mg);const bH={min:Ac(Do.min),max:Ac(Do.max)};let bb=class extends Se{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return De(e,bH.min,bH.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([d({type:["auto","manual"]})],bb.prototype,"mode",void 0),u([d({type:Number,value:bH.max})],bb.prototype,"max",null),u([qt("max")],bb.prototype,"castMax",null),bb=u([P("esri.views.3d.constraints.TiltConstraint")],bb);let wb=class extends Se{constructor(){super(...arguments),this.tilt=new bb,this.altitude=new DS,this.clipDistance=new mg}};u([d({type:bb})],wb.prototype,"tilt",void 0),u([d({type:DS})],wb.prototype,"altitude",void 0),u([d({type:mg})],wb.prototype,"clipDistance",void 0),wb=u([P("esri.views.3d.constraints.Constraints")],wb);var wH;let ph=wH=class extends ve{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new wH(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([d({readOnly:!0,type:["sun"],json:{write:!0}})],ph.prototype,"type",void 0),u([d({type:Date,json:{type:Number,write:{target:"datetime"}}})],ph.prototype,"date",void 0),u([Ie("date",["datetime"])],ph.prototype,"readDate",null),u([qe("date")],ph.prototype,"writeDate",null),u([d({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],ph.prototype,"directShadowsEnabled",void 0),u([Ie("directShadowsEnabled",["directShadows"])],ph.prototype,"readDirectShadowsEnabled",null),u([qe("directShadowsEnabled")],ph.prototype,"writedirectShadowsEnabled",null),u([d({type:Number,json:{write:!0}})],ph.prototype,"displayUTCOffset",void 0),u([qe("displayUTCOffset")],ph.prototype,"writeDisplayUTCOffset",null),ph=wH=u([P("esri.webscene.SunLighting")],ph);const TO=ph;var JT;let df=JT=class extends as.EventedMixin(TO){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new JT(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=JT.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=JT.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(vV.target=this,vV.timezoneOffset=s,this.emit("timezone-will-change",vV)),e!=null)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new JT(ye(F({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};u([d({type:Boolean})],df.prototype,"cameraTrackingEnabled",void 0),u([d({type:Boolean})],df.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],df.prototype,"waterReflectionEnabled",void 0),u([d({type:Date})],df.prototype,"defaultDate",null),u([d({type:Date})],df.prototype,"date",null),df=JT=u([P("esri.views.3d.environment.SunLighting")],df),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(df||(df={}));const vV={target:null,timezoneOffset:0},N0=df;var xH;let ER=xH=class extends ve{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new xH(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([d({readOnly:!0,type:["virtual"],json:{write:!0}})],ER.prototype,"type",void 0),u([d({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],ER.prototype,"directShadowsEnabled",void 0),ER=xH=u([P("esri.webscene.VirtualLighting")],ER);const Kk=ER;var eN;let CR=eN=class extends as.EventedMixin(Kk){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new eN(ye(F({},this.cloneConstructProperties()),{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}))}static fromWebsceneLighting(e){return new eN(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};u([d({type:Boolean})],CR.prototype,"ambientOcclusionEnabled",void 0),u([d({type:Boolean})],CR.prototype,"waterReflectionEnabled",void 0),CR=eN=u([P("esri.views.3d.environment.VirtualLighting")],CR);const AR=CR,kqe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:N0,virtual:AR}};var TH;let wM=TH=class extends Se{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new TH({quality:this.quality})}};u([d({type:["low","high"],value:"low"})],wM.prototype,"quality",null),wM=TH=u([P("esri.views.3d.environment.SceneViewAtmosphere")],wM);var SH;let RR=SH=class extends ve{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new SH({cloudCover:this.cloudCover})}};u([at({sunny:"sunny"})],RR.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],RR.prototype,"cloudCover",void 0),RR=SH=u([P("esri.views.3d.environment.SunnyWeather")],RR);const EH=RR;var CH;let MR=CH=class extends ve{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new CH({cloudCover:this.cloudCover})}};u([at({cloudy:"cloudy"})],MR.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],MR.prototype,"cloudCover",void 0),MR=CH=u([P("esri.views.3d.environment.CloudyWeather")],MR);const Uqe=MR;var AH;let OR=AH=class extends ve{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new AH({fogStrength:this.fogStrength})}};u([at({foggy:"foggy"})],OR.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],OR.prototype,"fogStrength",void 0),OR=AH=u([P("esri.views.3d.environment.FoggyWeather")],OR);const zqe=OR;var RH;let KT=RH=class extends ve{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new RH({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([at({rainy:"rainy"})],KT.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],KT.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],KT.prototype,"precipitation",void 0),KT=RH=u([P("esri.views.3d.environment.RainyWeather")],KT);const Vqe=KT;var MH;let H1=MH=class extends ve{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new MH({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([at({snowy:"snowy"})],H1.prototype,"type",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],H1.prototype,"cloudCover",void 0),u([d({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],H1.prototype,"precipitation",void 0),u([d({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],H1.prototype,"snowCover",void 0),H1=MH=u([P("esri.views.3d.environment.SnowyWeather")],H1);const Bqe=H1,lbe={key:"type",base:EH,typeMap:{sunny:EH,cloudy:Uqe,rainy:Vqe,snowy:Bqe,foggy:zqe}},Gqe=Object.keys(lbe.typeMap);function jqe(e,t){return!!Gqe.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const Ch=1e4,Hqe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:TO,virtual:Kk}};let tN=class extends ve{constructor(e){super(e)}clone(){}};u([d({readOnly:!0,json:{read:!1}})],tN.prototype,"type",void 0),tN=u([P("esri.webscene.background.Background")],tN);const cbe=tN;var OH;const qqe=ye(F({},hy),{nonNullable:!0});let PR=OH=class extends cbe{constructor(e){super(e),this.type="color",this.color=new Pe([0,0,0,1])}clone(){return new OH(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([at({color:"color"},{readOnly:!0})],PR.prototype,"type",void 0),u([d(qqe)],PR.prototype,"color",void 0),PR=OH=u([P("esri.webscene.background.ColorBackground")],PR);const ube=PR,Ise={base:cbe,key:"type",typeMap:{color:ube}};function Wqe(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const Xqe={types:Ise,json:{read:Wqe(Ise),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var PH;const Zqe=fe.getLogger("esri.webscene.Environment"),$se=(e,t,i)=>({enabled:!i||!i.isPresentation});let F0=PH=class extends ve{constructor(e){super(e),this.lighting=new TO,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){jqe(e==null?void 0:e.type,Zqe)&&this._set("weather",e)}clone(){return new PH(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?Kk.prototype.clone.call(this.lighting):TO.prototype.clone.call(this.lighting),background:re(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([d({types:Hqe,nonNullable:!0,json:{write:!0}})],F0.prototype,"lighting",void 0),u([d(Xqe)],F0.prototype,"background",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:$se}}})],F0.prototype,"atmosphereEnabled",void 0),u([d({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:$se}}})],F0.prototype,"starsEnabled",void 0),u([d({types:lbe,nonNullable:!0,json:{write:!0},value:new EH})],F0.prototype,"weather",null),F0=PH=u([P("esri.webscene.Environment")],F0);const hbe=F0;var IR;let eS=IR=class extends hbe{constructor(e){super(e),this.atmosphere=new wM,this.lighting=new N0}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new IR(ye(F({},t),{lighting:t.lighting.type==="virtual"?AR.fromWebsceneLighting(t.lighting):N0.fromWebsceneLighting(t.lighting)}))}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof N0||e instanceof AR?e:e instanceof TO?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e):new N0(e.cloneConstructProperties()):e instanceof Kk?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new AR(e.cloneConstructProperties()):wp(kqe,e):new N0}clone(){return new IR({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background)})}cloneWithWebsceneEnvironment(e){return new IR(ye(F({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:re(this.background)},e.cloneConstructProperties()),{lighting:this._getLighting(e)}))}_getLighting(e){return e.lighting.type==="sun"?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):N0.fromWebsceneLighting(e.lighting):e.lighting.type==="virtual"?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):AR.fromWebsceneLighting(e.lighting):N0.fromWebsceneLighting(e.lighting)}};u([d({type:wM,json:{read:!1},nonNullable:!0})],eS.prototype,"atmosphere",void 0),u([d({nonNullable:!0})],eS.prototype,"lighting",void 0),u([qt("lighting")],eS.prototype,"castLighting",null),eS=IR=u([P("esri.views.3d.environment.SceneViewEnvironment")],eS);const tS=eS;function _o(e,t){return e[0]=t[0],e[1]=t[1],e}function yi(e,t,i){return e[0]=t,e[1]=i,e}function Wd(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function $f(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function dbe(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function pbe(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function Yqe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Qqe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Jqe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function Kqe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function eWe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function pc(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function tWe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function NY(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function m4(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function FY(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function fbe(e){const t=e[0],i=e[1];return t*t+i*i}function kY(e,t){return e[0]=-t[0],e[1]=-t[1],e}function iWe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function SO(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function Js(e,t){return e[0]*t[0]+e[1]*t[1]}function rWe(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function iS(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function sWe(e,t){t=t||1;const i=2*rp()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function IH(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function q1(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function nWe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function oWe(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function aWe(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function lWe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function cWe(e){return"vec2("+e[0]+", "+e[1]+")"}function mbe(e,t){return e[0]===t[0]&&e[1]===t[1]}function uWe(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=Ct*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=Ct*Math.max(1,Math.abs(r),Math.abs(n))}function hWe(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const dWe=FY,pWe=$f,fWe=dbe,mWe=pbe,gbe=NY,gWe=m4,yWe=fbe;Object.freeze(Object.defineProperty({__proto__:null,copy:_o,set:yi,add:Wd,subtract:$f,multiply:dbe,divide:pbe,ceil:Yqe,floor:Qqe,min:Jqe,max:Kqe,round:eWe,scale:pc,scaleAndAdd:tWe,distance:NY,squaredDistance:m4,length:FY,squaredLength:fbe,negate:kY,inverse:iWe,normalize:SO,dot:Js,cross:rWe,lerp:iS,random:sWe,transformMat2:IH,transformMat2d:q1,transformMat3:nWe,transformMat4:oWe,rotate:aWe,angle:lWe,str:cWe,exactEquals:mbe,equals:uWe,projectAndScale:hWe,len:dWe,sub:pWe,mul:fWe,div:mWe,dist:gbe,sqrDist:gWe,sqrLen:yWe},Symbol.toStringTag,{value:"Module"}));function ybe(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const $H=1e4,Ex=Ue(5802e-9,13558e-9,331e-7),_V=3,bV=Ue(65e-8*_V,1881e-9*_V,85e-9*_V),vWe=3996e-9,_We=.085,iN=1e5;class Ws{}function x(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(x||(x={}));var M;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(M||(M={}));var an;function Ug(e,t){switch(t.textureCoordinateType){case an.Default:return e.attributes.add(M.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case an.Atlas:return e.attributes.add(M.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(M.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(x`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case an.None:return void e.vertex.code.add(x`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case an.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(an||(an={}));function Lc(e){e.code.add(x`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Uu(e){e.include(Lc),e.code.add(x`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function eU(e){e.fragment.code.add(x`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var ki;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(ki||(ki={}));class Kr{constructor(t,i,r,s,n=null){this.name=t,this.type=i,this.arraySize=n,this.bind={[ki.Pass]:null,[ki.Draw]:null},_(r)&&_(s)&&(this.bind[r]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class vi extends Kr{constructor(t,i){super(t,"vec2",ki.Pass,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class zg extends Kr{constructor(t){super(t,"vec2")}}class Tt extends Kr{constructor(t,i){super(t,"vec3",ki.Pass,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class El extends Kr{constructor(t){super(t,"vec3")}}class Va extends Kr{constructor(t){super(t,"vec4")}}class Ni extends Kr{constructor(t){super(t,"float")}}class Tr extends Kr{constructor(t,i){super(t,"mat4",ki.Pass,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}const bWe=fe.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class vbe{constructor(){this.includedModules=new Map}include(t,i){if(this.includedModules.has(t)){const r=this.includedModules.get(t);if(r!==i){bWe.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))r[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${t[n]}`))}}else this.includedModules.set(t,i),t(this.builder,i)}}class Zi extends vbe{constructor(){super(...arguments),this.vertex=new Lse,this.fragment=new Lse,this.attributes=new TWe,this.varyings=new SWe,this.extensions=new cE,this.constants=new xs}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?CWe:EWe,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];_(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a)=>{for(let l=0;l<n;++l)s[l](i,o,a)}}}class wWe{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const i of t)this._add(i)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new j(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>_(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class xWe{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class Lse extends vbe{constructor(){super(...arguments),this.uniforms=new wWe,this.code=new xWe,this.constants=new xs}get builder(){return this}}class TWe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class SWe{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class cE{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?cE.ALLOWLIST_VERTEX:cE.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}cE.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],cE.ALLOWLIST_VERTEX=[];class xs{constructor(){this._entries=new Set}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=xs._numberToFloatStr(r);break;case"int":s=xs._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${xs._numberToFloatStr(r[0])},                            ${xs._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${xs._numberToFloatStr(r[0])},                            ${xs._numberToFloatStr(r[1])},                            ${xs._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${xs._numberToFloatStr(r[0])},                            ${xs._numberToFloatStr(r[1])},                            ${xs._numberToFloatStr(r[2])},                            ${xs._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${xs._numberToIntStr(r[0])},                             ${xs._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${xs._numberToIntStr(r[0])},                             ${xs._numberToIntStr(r[1])},                             ${xs._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${xs._numberToIntStr(r[0])},                             ${xs._numberToIntStr(r[1])},                             ${xs._numberToIntStr(r[2])},                             ${xs._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>xs._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const EWe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,CWe=`precision highp float;
precision highp sampler2D;`;class zr extends Kr{constructor(t){super(t,"sampler2D")}}function AWe(e){const t=new Zi;t.attributes.add(M.POSITION,"vec2"),t.include(Ug,{textureCoordinateType:an.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Tr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Tr("inverseViewMatrix",(s,n)=>_s(RWe,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new Tt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new zg("radii"),new Ni("scaleHeight"),new El("cameraPosition"),new Va("heightParameters"),new Ni("innerFadeDistance"),new Ni("altitudeFade"),new zr("depthTex"),new El("betaRayleigh"),new El("betaCombined"),new Ni("betaMie"),new Ni("hazeStrength")]),t.include(eU),e.haze&&(r.include(Uu),r.uniforms.add(new vi("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(x`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(x`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?x`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?x``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":x`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?x`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:x`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?x`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:x`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?x`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:x`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":x`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const RWe=Ae(),MWe=Object.freeze(Object.defineProperty({__proto__:null,build:AWe},Symbol.toStringTag,{value:"Module"}));class rr{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var er,$t,Re,sy,xt,hp,uE,dt,gr,os,Ke,wt,ft,Ve,mt,Et,Fa,Ei,vu,Fn,ss,Mi;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(er||(er={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}($t||($t={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(Re||(Re={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(sy||(sy={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(xt||(xt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(hp||(hp={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(uE||(uE={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(dt||(dt={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(gr||(gr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(os||(os={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Ke||(Ke={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(wt||(wt={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(ft||(ft={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Ve||(Ve={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(mt||(mt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Et||(Et={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Fa||(Fa={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(Ei||(Ei={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}(vu||(vu={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Fn||(Fn={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(ss||(ss={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Mi||(Mi={}));const wV=33984;var Tn,au;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(Tn||(Tn={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(au||(au={}));const Dse=33306;var rs,Nse,Fse,kse,g4,LH,Use;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(rs||(rs={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(Nse||(Nse={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Fse||(Fse={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(kse||(kse={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(g4||(g4={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(LH||(LH={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Use||(Use={}));class pr{constructor(t,i,r){this.release=r,i&&(this.initializeConfiguration(t,i),this._configuration=i.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=Ze(this._program),this._pipeline=this._configuration=null}reload(t){Ze(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,i){this.program.bindPass(t,i)}bindDraw(t,i){this.program.bindDraw(t,i),this.program.rebindTextures()}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return $t.TRIANGLES}getPipelineState(t,i){return this._pipeline}initializeConfiguration(t,i){}}const Ui=new Map([[M.POSITION,0],[M.NORMAL,1],[M.UV0,2],[M.COLOR,3],[M.SIZE,4],[M.TANGENT,4],[M.AUXPOS1,5],[M.SYMBOLCOLOR,5],[M.AUXPOS2,6],[M.FEATUREATTRIBUTE,6],[M.INSTANCEFEATUREATTRIBUTE,6],[M.INSTANCECOLOR,7],[M.MODEL,8],[M.MODELNORMAL,12],[M.MODELORIGINHI,11],[M.MODELORIGINLO,15]]),OWe=fe.getLogger("esri/views/webgl");function PWe(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const _be=!!he("enable-feature:webgl-debug");function wh(){return _be}function EO(){return _be}function Ev(e){if(wh()){const t=e.getError();if(t){const i=PWe(e,t),r=new Error().stack;OWe.error(new j("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class sr{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new Wt({deallocator:null}),this._glProgram=t.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(ki.Pass,this),this.bindDraw=i.generateBind(ki.Draw,this),this._fragmentUniforms=wh()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform2f(t,i,r){this._glProgram.setUniform2f(t,i,r)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform3f(t,i,r,s){this._glProgram.setUniform3f(t,i,r,s)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform4f(t,i,r,s,n){this._glProgram.setUniform4f(t,i,r,s,n)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(R(i)||i.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let r=this._textures.get(t);return r==null?(r=this._allocTextureUnit(i),this._textures.set(t,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),_(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var hr,Aw,xb,gt,ks,lc,Ml,hE,ny,Ol,Uv,dE,cr,Rw;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(hr||(hr={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(Aw||(Aw={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(xb||(xb={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(gt||(gt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(ks||(ks={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(lc||(lc={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Ml||(Ml={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(hE||(hE={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(ny||(ny={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(Ol||(Ol={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(Uv||(Uv={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(dE||(dE={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(cr||(cr={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(Rw||(Rw={}));function ym(e,t,i=sy.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function bo(e,t,i,r,s=sy.ADD,n=sy.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const UY={face:hp.BACK,mode:uE.CCW},bbe={face:hp.FRONT,mode:uE.CCW},tU=e=>e===hr.Back?UY:e===hr.Front?bbe:null,Nl={zNear:0,zFar:1},ri={r:!0,g:!0,b:!0,a:!0};function IWe(e){return zWe.intern(e)}function $We(e){return VWe.intern(e)}function LWe(e){return BWe.intern(e)}function DWe(e){return GWe.intern(e)}function NWe(e){return jWe.intern(e)}function FWe(e){return HWe.intern(e)}function kWe(e){return qWe.intern(e)}function UWe(e){return WWe.intern(e)}function Bt(e){return XWe.intern(e)}class my{constructor(t,i){this.makeKey=t,this.makeRef=i,this.interns=new Map}intern(t){if(!t)return null;const i=this.makeKey(t),r=this.interns;return r.has(i)||r.set(i,this.makeRef(t)),r.get(i)}}function gy(e){return"["+e.join(",")+"]"}const zWe=new my(wbe,e=>F({__tag:"Blending"},e));function wbe(e){return e?gy([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const VWe=new my(xbe,e=>F({__tag:"Culling"},e));function xbe(e){return e?gy([e.face,e.mode]):null}const BWe=new my(Tbe,e=>F({__tag:"PolygonOffset"},e));function Tbe(e){return e?gy([e.factor,e.units]):null}const GWe=new my(Sbe,e=>F({__tag:"DepthTest"},e));function Sbe(e){return e?gy([e.func]):null}const jWe=new my(Ebe,e=>F({__tag:"StencilTest"},e));function Ebe(e){return e?gy([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const HWe=new my(Cbe,e=>F({__tag:"DepthWrite"},e));function Cbe(e){return e?gy([e.zNear,e.zFar]):null}const qWe=new my(Abe,e=>F({__tag:"ColorWrite"},e));function Abe(e){return e?gy([e.r,e.g,e.b,e.a]):null}const WWe=new my(Rbe,e=>F({__tag:"StencilWrite"},e));function Rbe(e){return e?gy([e.mask]):null}const XWe=new my(ZWe,e=>({blending:IWe(e.blending),culling:$We(e.culling),polygonOffset:LWe(e.polygonOffset),depthTest:DWe(e.depthTest),stencilTest:NWe(e.stencilTest),depthWrite:FWe(e.depthWrite),colorWrite:kWe(e.colorWrite),stencilWrite:UWe(e.stencilWrite)}));function ZWe(e){return e?gy([wbe(e.blending),xbe(e.culling),Tbe(e.polygonOffset),Sbe(e.depthTest),Ebe(e.stencilTest),Cbe(e.depthWrite),Abe(e.colorWrite),Rbe(e.stencilWrite)]):null}class YWe{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class CO extends pr{initializeProgram(t){const i=CO.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return this.configuration.haze?Bt({blending:bo(Re.ONE,Re.ZERO,Re.ONE_MINUS_SRC_COLOR,Re.ONE),colorWrite:ri}):Bt({blending:bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:gr.LEQUAL},colorWrite:ri})}}CO.shader=new rr(MWe,()=>import("./ChapmanAtmosphere.glsl.c28f1f16.js"));class Wa{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function H(e={}){return(t,i)=>{var r,s;if(t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i),e.constValue!=null)Object.defineProperty(t,i,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(f){if(this[n]!==f&&(this[n]=f,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+f<<h&p,typeof f!="number"&&typeof f!="boolean"))throw"Configuration value for "+i+" must be boolean or number, got "+typeof f}})}}}class Mbe extends Wa{constructor(){super(...arguments),this.haze=!1}}u([H()],Mbe.prototype,"haze",void 0);class yo{constructor(t,i,r,s,n,o=!1,a=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new yo(M.POSITION,3,dt.FLOAT,0,12);new yo(M.POSITION,3,dt.FLOAT,0,20),new yo(M.UV0,2,dt.FLOAT,12,20);new yo(M.POSITION,3,dt.FLOAT,0,32),new yo(M.NORMAL,3,dt.FLOAT,12,32),new yo(M.UV0,2,dt.FLOAT,24,32);new yo(M.POSITION,3,dt.FLOAT,0,16),new yo(M.COLOR,4,dt.UNSIGNED_BYTE,12,16);const zY=[new yo(M.POSITION,2,dt.FLOAT,0,8)],Y3=[new yo(M.POSITION,2,dt.FLOAT,0,16),new yo(M.UV0,2,dt.FLOAT,8,16)];var pi;function QWe(e,t,i={}){const r=Obe(e);for(;r.length>1;){const s=y4(t,r.shift(),i);if(_(s))return s}return JWe(t,r.shift(),i)}function Obe(e){const t=he("esri-force-webgl");if(t===pi.WEBGL1||t===pi.WEBGL2)return[t];switch(e){case"2d":return he("mac")&&he("chrome")?[pi.WEBGL1,pi.WEBGL2]:[pi.WEBGL2,pi.WEBGL1];case"3d":return[pi.WEBGL2,pi.WEBGL1]}}function JWe(e,t,i={}){if(!window.WebGLRenderingContext)return zse(e,KWe),null;const r=y4(e,t,i);return R(r)&&zse(e,eXe),r}function y4(e,t,i={}){const r=t===pi.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function zse(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(pi||(pi={}));const KWe='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',eXe=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,Fc=fe.getLogger("esri.views.webgl.BufferObject");function tXe(e){return cRe(e)}class oi{constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(Tn.BufferObject,this),this._glName=this._context.gl.createBuffer(),Ev(this._context.gl),s&&this.setData(s)}static createIndex(t,i,r){return new oi(t,xt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new oi(t,xt.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==pi.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new oi(t,xt.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=Ei.STREAM_READ,r){if(t.type!==pi.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new oi(t,xt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=Ei.STREAM_DRAW,r){if(t.type!==pi.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new oi(t,xt.PIXEL_UNPACK_BUFFER,i,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===xt.ELEMENT_ARRAY_BUFFER?this._indexType===dt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===xt.ELEMENT_ARRAY_BUFFER||this.bufferType===xt.ARRAY_BUFFER}dispose(){var t;((t=this._context)==null?void 0:t.gl)?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Tn.BufferObject,this),this._context=null):this._glName&&Fc.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&Fc.error("Buffer size needs to be positive!"),this.bufferType===xt.ELEMENT_ARRAY_BUFFER&&_(i))switch(this._indexType=i,i){case dt.UNSIGNED_SHORT:t*=2;break;case dt.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===xt.ELEMENT_ARRAY_BUFFER&&(HN(t)&&(i/=2,this._indexType=dt.UNSIGNED_SHORT),qN(t)&&(i/=4,this._indexType=dt.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;_(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),Ev(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i=0,r=0,s=t.byteLength){if(!t)return;(i<0||i>=this._size)&&Fc.error("offset is out of range!");let n=i,o=r,a=s,l=t.byteLength;this.bufferType===xt.ELEMENT_ARRAY_BUFFER&&(HN(t)?(l/=2,n*=2,o*=2,a*=2):qN(t)&&(l/=4,n*=4,o*=4,a*=4)),s===void 0&&(s=l-1),r>=s&&Fc.error("end must be bigger than start!"),i+r-s>this._size&&Fc.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(t)?t.buffer:t,f=o===0&&a===t.byteLength?p:p.slice(o,a);h.bufferSubData(this.bufferType,n,f),Ev(h),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,i,r,s){if(!t)return;(i<0||i>=this._size)&&Fc.error("offset is out of range!"),r>=s&&Fc.error("end must be bigger than start!"),i+r-s>this._size&&Fc.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===pi.WEBGL2)o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const a=r===0&&s===t.length?t:t.subarray(r,s);o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,a)}Ev(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==pi.WEBGL2)return void Fc.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void Fc.error("Problem getting subdata: offset and length were less than zero!");const n=tXe(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void Fc.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&Fc.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,xt.COPY_READ_BUFFER),o.getBufferSubData(xt.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer(xt.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===pi.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):Fc.error("Get buffer subdata is supported in WebGL2 only!")}}function zn(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const Vse=4;class nt{constructor(t,i,r=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(Tn.Texture,this),this._descriptor=F({target:ft.TEXTURE_2D,samplingMode:Ke.LINEAR,wrapMode:wt.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},i),t.type!==pi.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),L_(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===ft.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Tn.Texture,this))}release(){this.dispose()}resize(t,i){const r=this._descriptor;if(r.width!==t||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=t,r.height=i,this._descriptor.target===ft.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let i=ft.TEXTURE_CUBE_MAP_POSITIVE_X;i<=ft.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(t,i)}setData(t){this._setData(t)}_setData(t,i){var c;if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),t===void 0&&(t=null);const s=this._descriptor;i!=null||(i=s.target);const n=L_(i);t===null&&(s.width=s.width||Vse,s.height=s.height||Vse,n&&(s.depth=(c=s.depth)!=null?c:1));const o=this._context.bindTexture(this,nt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(nt.TEXTURE_UNIT_FOR_UPDATES),nt._validateTexture(this._context,s),this._configurePixelStorage();const a=s.pixelFormat;let l=s.internalFormat?s.internalFormat:this._deriveInternalFormat(a,s.dataType);if(xV(t)){let h=t.width,p=t.height;const f=1;t instanceof HTMLVideoElement&&(h=t.videoWidth,p=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),this._texImage(i,0,l,h,p,f,t),Ev(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),n&&s.depth===void 0&&(s.depth=f)}else{const{width:h,height:p,depth:f}=s;if(h!=null&&p!=null||console.error("Width and height must be specified!"),n&&f==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,f),r.DEPTH24_STENCIL8&&l===r.DEPTH_STENCIL&&(l=r.DEPTH24_STENCIL8),rN(t)){const m=t.levels,y=Bse(i,h,p,f),v=Math.min(y-1,m.length-1);zn(r)?r.texParameteri(s.target,r.TEXTURE_MAX_LEVEL,v):s.hasMipmap=s.hasMipmap&&y===m.length;const w=l;if(!rXe(w))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((b,S,T,E)=>{const C=m[Math.min(b,m.length-1)];this._compressedTexImage(i,b,w,S,T,E,C)},v)}else _(t)?(this._texImage(i,0,l,h,p,f,t),Ev(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((m,y,v,w)=>{this._texImage(i,m,l,y,v,w,null),Ev(r)})}nt._applySamplingMode(r,this._descriptor),nt._applyWrapMode(r,this._descriptor),nt._applyAnisotropicFilteringParameters(this._context,this._descriptor),Ev(r),this._context.bindTexture(o,nt.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,i,r,s,n,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:h,dataType:p,isImmutable:f,target:m}=l;if(f&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const y=this._context.bindTexture(this,nt.TEXTURE_UNIT_FOR_UPDATES);(i<0||r<0||s>l.width||n>l.height||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),xV(o)?a.texSubImage2D(m,t,i,r,c,p,o):rN(o)?a.compressedTexSubImage2D(m,t,i,r,s,n,h,o.levels[t]):a.texSubImage2D(m,t,i,r,s,n,c,p,o),this._context.bindTexture(y,nt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!zn(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:f,isImmutable:m,target:y,internalFormat:v}=h;if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");L_(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const w=this._context.bindTexture(this,nt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(nt.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),rN(l))l=l.levels[t],c.compressedTexSubImage3D(y,t,i,r,s,n,o,a,v,l);else{const b=l;c.texSubImage3D(y,t,i,r,s,n,o,a,p,f,b)}this._context.bindTexture(w,nt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,nt._validateTexture(this._context,t)}t.samplingMode===Ke.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=Ke.LINEAR_MIPMAP_NEAREST):t.samplingMode===Ke.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=Ke.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,nt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(nt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(i,nt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,nt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(nt._applySamplingMode(t,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(nt._applyWrapMode(t,i),this._wrapModeDirty=!1)}_deriveInternalFormat(t,i){if(this._context.type===pi.WEBGL1)return t;switch(i){case Et.FLOAT:switch(t){case Ve.RGBA:return mt.RGBA32F;case Ve.RGB:return mt.RGB32F;default:throw new Error("Unable to derive format")}case Et.UNSIGNED_BYTE:switch(t){case Ve.RGBA:return mt.RGBA8;case Ve.RGB:return mt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,i,r,s,n,o){const a=this._context.gl;if(!zn(a))throw new Error("Immutable textures are not supported in WebGL1");if(!iXe(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?Bse(t,s,n,o):1;L_(t)?a.texStorage3D(t,l,i,s,n,o):a.texStorage2D(t,l,i,s,n),this._wasImmutablyAllocated=!0}_texImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===pi.WEBGL2,p=L_(t),{isImmutable:f,pixelFormat:m,dataType:y}=this._descriptor;if(h&&(c=l),h||!xV(a))if(f){if(_(a)){const v=a;p?c.texSubImage3D(t,i,0,0,0,s,n,o,m,y,v):l.texSubImage2D(t,i,0,0,s,n,m,y,v)}}else{const v=a;p?c.texImage3D(t,i,r,s,n,o,0,m,y,v):l.texImage2D(t,i,r,s,n,0,m,y,v)}else l.texImage2D(t,0,r,m,y,a)}_compressedTexImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=L_(t),p=this._descriptor.isImmutable;if(h){if(this._context.type!==pi.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}p?_(a)&&(h?c.compressedTexSubImage3D(t,i,0,0,0,s,n,o,r,a):l.compressedTexSubImage2D(t,i,0,0,s,n,r,a)):h?c.compressedTexImage3D(t,i,r,s,n,o,0,a):l.compressedTexImage2D(t,i,r,s,n,0,a)}_forEachMipmapLevel(t,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===ft.TEXTURE_3D;for(let c=0;t(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,i){(i.width<0||i.height<0||i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=zn(t.gl),s=N2(i.width)&&N2(i.height);r||!i.isImmutable&&!L_(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==wt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===wt.CLAMP_TO_EDGE&&i.wrapMode.t===wt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,i){let r=i.samplingMode,s=i.samplingMode;r===Ke.LINEAR_MIPMAP_NEAREST||r===Ke.LINEAR_MIPMAP_LINEAR?(r=Ke.LINEAR,i.hasMipmap||(s=Ke.LINEAR)):r!==Ke.NEAREST_MIPMAP_NEAREST&&r!==Ke.NEAREST_MIPMAP_LINEAR||(r=Ke.NEAREST,i.hasMipmap||(s=Ke.NEAREST)),t.texParameteri(i.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(i.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,i){typeof i.wrapMode=="number"?(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode)):(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode.s),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,i){var s;const r=t.capabilities.textureFilterAnisotropic;!r||t.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,(s=i.maxAnisotropy)!=null?s:1)}}function iXe(e){return e in mt}function rXe(e){return e in rs}function rN(e){return _(e)&&"type"in e&&e.type==="compressed"}function sXe(e){return _(e)&&"byteLength"in e}function xV(e){return _(e)&&!rN(e)&&!sXe(e)}function L_(e){return e===ft.TEXTURE_3D||e===ft.TEXTURE_2D_ARRAY}function Bse(e,t,i,r=1){let s=Math.max(t,i);return e===ft.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}nt.TEXTURE_UNIT_FOR_UPDATES=0;function Gse(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function ko(e,t){return e.vertexBuffers[t].size/nXe(e.layout[t])}function nXe(e){return e[0].stride}function VY(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function BY(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(xt.ARRAY_BUFFER)}function Pbe(e){switch(e){case Ve.ALPHA:case Ve.LUMINANCE:case Ve.RED:case Ve.RED_INTEGER:case mt.R8:case mt.R8I:case mt.R8UI:case mt.R8_SNORM:case Fa.STENCIL_INDEX8:return 1;case Ve.LUMINANCE_ALPHA:case Ve.RG:case Ve.RG_INTEGER:case mt.RGBA4:case mt.R16F:case mt.R16I:case mt.R16UI:case mt.RG8:case mt.RG8I:case mt.RG8UI:case mt.RG8_SNORM:case mt.RGB565:case mt.RGB5_A1:case Fa.DEPTH_COMPONENT16:return 2;case Ve.DEPTH_COMPONENT:case Ve.RGB:case Ve.RGB_INTEGER:case mt.RGB8:case mt.RGB8I:case mt.RGB8UI:case mt.RGB8_SNORM:case mt.SRGB8:case Fa.DEPTH_COMPONENT24:return 3;case Ve.DEPTH_STENCIL:case Ve.RGBA:case Ve.RGBA_INTEGER:case mt.RGBA8:case mt.R32F:case mt.R11F_G11F_B10F:case mt.RG16F:case mt.R32I:case mt.R32UI:case mt.RG16I:case mt.RG16UI:case mt.RGBA8I:case mt.RGBA8UI:case mt.RGBA8_SNORM:case mt.SRGB8_ALPHA8:case mt.RGB9_E5:case mt.RGB10_A2UI:case mt.RGB10_A2:case Fa.DEPTH_STENCIL:case Fa.DEPTH_COMPONENT32F:case Fa.DEPTH24_STENCIL8:return 4;case Fa.DEPTH32F_STENCIL8:return 5;case mt.RGB16F:case mt.RGB16I:case mt.RGB16UI:return 6;case mt.RG32F:case mt.RG32I:case mt.RG32UI:case mt.RGBA16F:case mt.RGBA16I:case mt.RGBA16UI:return 8;case mt.RGB32F:case mt.RGB32I:case mt.RGB32UI:return 12;case mt.RGBA32F:case mt.RGBA32I:case mt.RGBA32UI:return 16;case rs.COMPRESSED_RGB_S3TC_DXT1_EXT:case rs.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case rs.COMPRESSED_RGBA_S3TC_DXT3_EXT:case rs.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case rs.COMPRESSED_R11_EAC:case rs.COMPRESSED_SIGNED_R11_EAC:case rs.COMPRESSED_RGB8_ETC2:case rs.COMPRESSED_SRGB8_ETC2:case rs.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case rs.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case rs.COMPRESSED_RG11_EAC:case rs.COMPRESSED_SIGNED_RG11_EAC:case rs.COMPRESSED_RGBA8_ETC2_EAC:case rs.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Mw(e){if(R(e))return 0;if("descriptor"in e)return e.glName?Mw(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return Pbe(t)*r*i}const D_=fe.getLogger("esri.views.webgl.VertexArrayObject");class Hs{constructor(t,i,r,s,n=null){this._context=t,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(Tn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,i)=>t+this._buffers[i].size,_(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var i,r;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&D_.warn("Leaked WebGL VAO"));if(this._glName){const s=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):D_.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=Ze(this._indexBuffer)}this._context.instanceCounter.decrement(Tn.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const i=t.createVertexArray();t.bindVertexArray(i),this._bindLayout(),t.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:r}=this;t||D_.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||D_.error("Vertex buffer is uninitialized!");const a=i[n];a||D_.error("Vertex element descriptor is empty!"),VY(this._context,this._locations,o,a)}_(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||D_.error("Vertex buffer dictionary is empty!");for(const r in t){const s=t[r];s||D_.error("Vertex buffer is uninitialized!");const n=i[r];BY(this._context,this._locations,s,n)}_(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function Xa(e,t=zY,i=Ui,r=-1,s=1){let n=null;return t===Y3?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new Hs(e,i,{geometry:t},{geometry:oi.createVertex(e,Ei.STATIC_DRAW,n)})}function oXe(e,t=zY,i=Ui){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new Hs(e,i,{geometry:t},{geometry:oi.createVertex(e,Ei.STATIC_DRAW,r)})}const Ibe=4;function $be(e,t=Ibe){return new nt(e,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,width:t,height:t})}function aXe(e,t,i=Ibe){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new nt(e,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,width:i,height:i},r)}function Lbe(e){return new nt(e,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class jse{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=O(),this._heightParameters=Xt(),this._betasRayleigh=O(),this._betasCombined=O(),this._scaleHeight=0,this._radii=it(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=Pi.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(Pi.radius)}destroy(){this._atmosphereTechnique=Ki(this._atmosphereTechnique),this._atmosphereHazeTechnique=Ki(this._atmosphereHazeTechnique),this._vao=Ze(this._vao),this._handles=lt(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx,r=this._handles=new Nt,s=this._view.basemapTerrain;_(s.rootTiles)&&this._updateElevation({spatialReference:s.spatialReference,tile:s.rootTiles[0],extent:s.rootTiles[0].extent,context:"ground"}),r.add(ns(()=>this._view.basemapTerrain,"elevation-change",o=>this._updateElevation(o),{onListenerAdd:()=>this._updateElevation()})),r.add(ns(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const n=new Mbe;n.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(CO,n),n.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(CO,n),this._vao=Xa(i,Y3),this._scaleHeight=_We*iN,se(this._betasRayleigh,Ex[0],Ex[1],Ex[2]),se(this._betasCombined,Ex[0]+bV[0],Ex[1]+bV[1],Ex[2]+bV[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._darkenHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){this._update(t.bindParameters.camera);const s=t.rctx.bindTechnique(i,lXe,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture("depthTex",r),this._renderCommon(i.program,t)})}_renderCommon(t,i){if(R(this._vao))return;const r=i.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",vWe),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays($t.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const i=t?t.tile:vt(this._view.basemapTerrain.rootTiles,[null])[0];if(R(i)||i.level!==0)return;const r=this._adjustRadiusForTesselation(Pi.radius+i.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(Pi.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,yi(this._radii,t,t+iN),this._innerFadeDistance=2*Math.sqrt((2*t-$H)*$H)}_update(t){if(R(t))return;this._cameraHeight=Me(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const i=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/iN));this._heightParameters=bi(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,i),ae(this._cameraPosition,t.eye),this._altitudeFade=ybe(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?Yt(.6,1,F2(9500,10500,this._cameraHeight-Pi.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const lXe=new Ws;function cXe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Dbe(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function Nbe(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Ct?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function GY(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-r*c,e[2]=n*h+o*c+r*l-s*a,e[3]=o*h-r*a-s*l-n*c,e}function uXe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e}function hXe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e}function dXe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function pXe(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function sN(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,f,m=i[0],y=i[1],v=i[2],w=i[3];return c=s*m+n*y+o*v+a*w,c<0&&(c=-c,m=-m,y=-y,v=-v,w=-w),1-c>Ct?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,f=Math.sin(r*l)/h):(p=1-r,f=r),e[0]=p*s+f*m,e[1]=p*n+f*y,e[2]=p*o+f*v,e[3]=p*a+f*w,e}function fXe(e){const t=rp(),i=rp(),r=rp(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function mXe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function oy(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Fbe(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+o]-t[3*o+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[o]=(t[3*o+s]+t[3*s+o])*r}return e}function gXe(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function yXe(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const Q3=sp,vXe=Ji,_Xe=YW,bXe=GY,wXe=M3,xXe=wpe,TXe=k5,kbe=QW,SXe=kbe,Ube=JW,EXe=Ube,jY=bpe,CXe=JM,AXe=xpe;function RXe(e,t,i){const r=xe(t,i);return r<-.999999?(ct(Lp,MXe,t),ZW(Lp)<1e-6&&ct(Lp,OXe,t),we(Lp,Lp),Dbe(e,Lp,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(ct(Lp,t,i),e[0]=Lp[0],e[1]=Lp[1],e[2]=Lp[2],e[3]=1+r,jY(e,e))}const Lp=O(),MXe=Ue(1,0,0),OXe=Ue(0,1,0);function PXe(e,t,i,r,s,n){return sN(Hse,t,s,n),sN(qse,i,r,n),sN(e,Hse,qse,2*n*(1-n)),e}const Hse=fy(),qse=fy();function IXe(e,t,i,r){const s=$Xe;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],jY(e,Fbe(e,s))}const $Xe=Or();Object.freeze(Object.defineProperty({__proto__:null,identity:cXe,setAxisAngle:Dbe,getAxisAngle:Nbe,multiply:GY,rotateX:uXe,rotateY:hXe,rotateZ:dXe,calculateW:pXe,slerp:sN,random:fXe,invert:mXe,conjugate:oy,fromMat3:Fbe,fromEuler:gXe,str:yXe,copy:Q3,set:vXe,add:_Xe,mul:bXe,scale:wXe,dot:xXe,lerp:TXe,length:kbe,len:SXe,squaredLength:Ube,sqrLen:EXe,normalize:jY,exactEquals:CXe,equals:AXe,rotationTo:RXe,sqlerp:PXe,setAxes:IXe},Symbol.toStringTag,{value:"Module"}));function oC(e=DXe){return[e[0],e[1],e[2],e[3]]}function AO(e,t){return LXe(e[0],e[1],e[2],t,rZ.get())}function LXe(e,t,i,r,s=oC()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function RO(e,t,i=oC()){return ct(i,e,t),we(i,i),i[3]=oZ(e,t),i}const DXe=[0,0,1,0];class NXe{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=O(),this.parallax={anchorPointClouds:O(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.parallaxNew={anchorPointClouds:O(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Ae()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:oo.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:xh.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:zv.FINISHED,factor:-1}}}var xh,oo,zv;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(xh||(xh={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(oo||(oo={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(zv||(zv={}));function Ri(){return new Float32Array(3)}function v4(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function $i(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function zbe(e,t){return new Float32Array(e,t,3)}function HY(){return Ri()}function Vbe(){return $i(1,1,1)}function Bbe(){return $i(1,0,0)}function Gbe(){return $i(0,1,0)}function jbe(){return $i(0,0,1)}const FXe=HY(),kXe=Vbe(),UXe=Bbe(),zXe=Gbe(),VXe=jbe();Object.freeze(Object.defineProperty({__proto__:null,create:Ri,clone:v4,fromValues:$i,createView:zbe,zeros:HY,ones:Vbe,unitX:Bbe,unitY:Gbe,unitZ:jbe,ZEROS:FXe,ONES:kXe,UNIT_X:UXe,UNIT_Y:zXe,UNIT_Z:VXe},Symbol.toStringTag,{value:"Module"}));function Hbe(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function qY(e,t){switch(e.include(Ug,t),e.fragment.code.add(x`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case an.Default:return void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case an.Atlas:return e.include(Hbe),void e.fragment.code.add(x`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case an.None:case an.COUNT:return}}class Ga extends Kr{constructor(t,i){super(t,"vec3",ki.Draw,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class WY extends Kr{constructor(t,i){super(t,"vec2",ki.Draw,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class XY extends Kr{constructor(t,i){super(t,"sampler2D",ki.Draw,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function xM(e,t,i){const r=[new XY(e,t)];if(i){const s=e+"Size";r.push(new WY(s,(n,o)=>{const a=t(n,o);return _(a)?yi(BXe,a.descriptor.width,a.descriptor.height):Zh}))}return r}const BXe=it();class jt extends Kr{constructor(t,i){super(t,"sampler2D",ki.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function nN(e,t,i){const r=[new jt(e,t)];if(i){const s=e+"Size";r.push(new vi(s,(n,o)=>{const a=t(n,o);return _(a)?yi(GXe,a.descriptor.width,a.descriptor.height):Zh}))}return r}const GXe=it();class __{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,i,r=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(r,i),this._technique),this._technique}ensureResources(t){return lc.LOADED}}class ZY extends __{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=Ki(this._texture),this._textureNormal=Ki(this._textureNormal),this._textureEmissive=Ki(this._textureEmissive),this._textureOcclusion=Ki(this._textureOcclusion),this._textureMetallicRoughness=Ki(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?lc.LOADED:lc.LOADING}get textureBindParameters(){return new qbe(_(this._texture)?this._texture.glTexture:null,_(this._textureNormal)?this._textureNormal.glTexture:null,_(this._textureEmissive)?this._textureEmissive.glTexture:null,_(this._textureOcclusion)?this._textureOcclusion.glTexture:null,_(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(R(this._texture)||t!==this._texture.id)&&(this._texture=Ki(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}_acquire(t,i){if(R(t))return void i(null);const r=this._textureRepository.acquire(t);if(Vu(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return Ki(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class qbe extends Ws{constructor(t=null,i=null,r=null,s=null,n=null){super(),this.texture=t,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const mEt=$i(0,.6,.2);var Ot;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(Ot||(Ot={}));function YY(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Ot.Normal&&r&&e.include(qY,t),t.pbrMode!==Ot.Schematic)if(t.pbrMode!==Ot.Disabled){if(t.pbrMode===Ot.Normal){i.code.add(x`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(n===ki.Pass?nN("texMetallicRoughness",o=>o.textureMetallicRoughness,s):xM("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(x`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(n===ki.Pass?nN("texEmission",o=>o.textureEmissive,s):xM("texEmission",o=>o.textureEmissive,s)),i.code.add(x`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(n===ki.Pass?nN("texOcclusion",o=>o.textureOcclusion,s):xM("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(x`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(x`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===ki.Pass?[new Tt("emissionFactor",o=>o.emissiveFactor),new Tt("mrrFactors",o=>o.mrrFactors)]:[new Ga("emissionFactor",o=>o.emissiveFactor),new Ga("mrrFactors",o=>o.mrrFactors)]),i.code.add(x`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(x`float getBakedOcclusion() { return 1.0; }`);else i.code.add(x`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}class ni extends Kr{constructor(t,i){super(t,"vec4",ki.Pass,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}function QY(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Tt("lightingAmbientSH0",(s,n)=>se(Wse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new ni("lightingAmbientSH_R",(s,n)=>Ji(Am,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new ni("lightingAmbientSH_G",(s,n)=>Ji(Am,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new ni("lightingAmbientSH_B",(s,n)=>Ji(Am,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new Tt("lightingAmbientSH0",(s,n)=>se(Wse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new ni("lightingAmbientSH_R1",(s,n)=>Ji(Am,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new ni("lightingAmbientSH_G1",(s,n)=>Ji(Am,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new ni("lightingAmbientSH_B1",(s,n)=>Ji(Am,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new ni("lightingAmbientSH_R2",(s,n)=>Ji(Am,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new ni("lightingAmbientSH_G2",(s,n)=>Ji(Am,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new ni("lightingAmbientSH_B2",(s,n)=>Ji(Am,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(x`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||i.code.add(x`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Wse=O(),Am=Xt();class We extends Kr{constructor(t,i){super(t,"float",ki.Pass,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function JY(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new We("lightingFixedFactor",(r,s)=>(1-s.lighting.groundLightingFactor)*(1-s.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new Tt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(x`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function iU(e){e.vertex.code.add(x`const float PI = 3.141592653589793;`),e.fragment.code.add(x`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}class Ow extends Kr{constructor(t,i){super(t,"bool",ki.Pass,(r,s,n)=>r.setUniform1b(t,i(s,n)))}}class jXe extends Kr{constructor(t,i){super(t,"samplerCube",ki.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function Wbe(e){const t=e.fragment;t.uniforms.add([new Tr("rotationMatrixClouds",(i,r)=>r.clouds.parallax.transform),new Tr("rotationMatrixCloudsCrossFade",(i,r)=>r.clouds.parallaxNew.transform),new Tt("anchorPosition",(i,r)=>r.clouds.parallax.anchorPointClouds),new Tt("anchorPositionCrossFade",(i,r)=>r.clouds.parallaxNew.anchorPointClouds),new vi("cloudVariables",(i,r)=>_(r.clouds.data)?yi(HXe,r.clouds.data.coverage,r.clouds.data.absorption):Zh),new We("cloudsHeight",(i,r)=>r.clouds.parallax.cloudsHeight),new We("radiusCurvatureCorrectionFactor",(i,r)=>r.clouds.parallax.radiusCurvatureCorrectionFactor),new We("totalFadeInOut",(i,r)=>r.clouds.fadeInOut.stage===oo.FINISHED?r.clouds.fadeInOutHeight.factor+Math.max(De(r.clouds.fadeIn.factor,0,1)):r.clouds.fadeInOutHeight.factor+Math.max(De(r.clouds.fadeInOut.factor,0,1))),new We("crossFadeAnchorFactor",(i,r)=>De(r.clouds.crossFade.factor,0,1)),new jXe("cubeMap",(i,r)=>_(r.clouds.data)?r.clouds.data.cubeMap.colorTexture:null),new Ow("crossFade",(i,r)=>r.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",Pi.radius),t.code.add(x`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(x`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(x`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new Tt("lightingMainDirection",(i,r)=>r.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(i,r)=>r.lighting.mainLight.intensity)]),t.code.add(x`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(x`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(x`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(x`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(x`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const HXe=it();function vm(e){e.code.add(x`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function qXe(){const e=new Zi;e.attributes.add(M.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new Tr("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Tr("inverseViewMatrix",(r,s)=>_s(WXe,s.camera.viewMatrix))]),t.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(vm),i.include(Lc),e.include(QY,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(iU),e.include(eU),e.include(JY,{isGround:!1}),e.include(Wbe,{instancedDoublePrecision:!1,isGround:!1}),i.uniforms.add([new Tt("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(x`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const WXe=Ae(),XXe=Object.freeze(Object.defineProperty({__proto__:null,build:qXe},Symbol.toStringTag,{value:"Module"}));class rU extends pr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=rU.shader.get().build();return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:ym(Re.ONE,Re.SRC_ALPHA),depthTest:{func:gr.LEQUAL},colorWrite:ri})}}rU.shader=new rr(XXe,()=>import("./CloudsComposition.glsl.01f53219.js"));function ZXe(e){return _(e)&&_(e.cubeMap)&&e.coverage>0}function Xse(e){return _(e)&&!e.running}let W1=class extends Se{constructor(e){super(e),this._technique=new rU(e),this._vao=Xa(e.rctx)}destroy(){this._technique=Ki(this._technique),this._vao=Ze(this._vao)}render(e,t){const i=e.bindParameters.clouds;if(R(this._vao)||R(i.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(i,e.bindParameters.camera.eye,t);const r=e.rctx.bindTechnique(this._technique,tZe,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays($t.TRIANGLE_STRIP,0,4),eZe(i)&&this.requestRender()}_setFadeInStage(e,t){const i=performance.now(),r=e.parallax.anchorPointClouds;e.fadeIn.stage===xh.FINISHED&&(e.fadeIn.factor=1,ae(r,Dp),e.fadeIn.stage=xh.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=oo.FINISHED);const s=Qse(e,t);e.fadeIn.stage===xh.CHANGE_ANCHOR&&s&&Xse(e.data)&&(ae(r,Dp),e.fadeIn.stage=xh.FADE_IN,e.startTime=i),e.fadeIn.factor>0&&e.fadeIn.stage===xh.FADE_IN&&(e.fadeIn.factor=1-(i-e.startTime)/Yse),e.fadeIn.factor<=0&&e.fadeIn.stage===xh.FADE_IN&&(e.fadeIn.stage=xh.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:i}=e,r=e.parallax.anchorPointClouds;e.crossFade.enabled||(ae(e.parallaxNew.anchorPointClouds,Dp),e.startTime=t,i.factor=0,e.crossFade.enabled=!0),i.factor<1&&e.crossFade.enabled&&(i.factor=(t-e.startTime)/JXe),i.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,i.factor=1,ae(r,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const i=performance.now(),{fadeInOut:r,crossFade:s}=e;r.stage===oo.FINISHED&&(e.startTime=i,r.factor=0,r.stage=oo.FADE_OUT),r.factor<1&&r.stage===oo.FADE_OUT&&(r.factor=(i-e.startTime)/QXe),r.factor>=1&&r.stage===oo.FADE_OUT&&(r.factor=1,ae(e.parallax.anchorPointClouds,Dp)),r.factor>=1&&r.stage===oo.FADE_OUT&&Qse(e,t)&&(r.factor=1,r.stage=oo.SWITCH,e.crossFade.enabled=!1,s.factor=1),Xse(e.data)&&r.stage===oo.SWITCH&&(e.startTime=i,r.factor=1,r.stage=oo.FADE_IN,ae(e.parallax.anchorPointClouds,Dp),e.crossFade.enabled=!1,s.factor=1),r.factor>0&&r.stage===oo.FADE_IN&&(r.factor=1-(i-e.startTime)/Yse),r.factor<=0&&r.stage===oo.FADE_IN&&(r.stage=oo.FINISHED,r.factor=0)}_setFadeInOutHeight(e,t){const i=performance.now(),r=e.fadeInOutHeight,s=(i-(r.stage===zv.FINISHED?i:e.startTimeHeightFade))/KXe;r.factor+=t?-s:s,e.startTimeHeightFade=i,r.factor=De(r.factor,0,1),r.stage=zv.HEIGHT_FADE}_setParallaxParameters(e,t,i){const{parallax:r}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=Me(t)-this.planetRadius>Ch?1:0),we(Dp,t),le(Dp,Dp,this.planetRadius),r.anchorPointClouds[0]===0&&r.anchorPointClouds[1]===0&&r.anchorPointClouds[2]===0&&ae(r.anchorPointClouds,Dp);const s=Me(pe(YXe,r.anchorPointClouds,Dp));let n=!0;s>e.fadeIn.distanceThresholdFactor*r.cloudsHeight||e.fadeIn.stage!==xh.FINISHED?this._setFadeInStage(e,t):s>e.fadeInOut.distanceThresholdFactor*r.cloudsHeight||e.fadeInOut.stage!==oo.FINISHED?this._setFadeInOutStage(e,t):s>e.crossFade.distanceThresholdFactor*r.cloudsHeight&&!i||e.crossFade.enabled?this._setCrossFadingStage(e):n=!1;const o=Me(t),a=o-this.planetRadius;if((a>1.7*Ch||a<-Ch)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(a>Ch||a<-.35*Ch)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):a<Ch&&a>-.35*Ch&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=zv.FINISHED,r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-this.planetRadius*this.planetRadius,0))/o,RO(Zse,r.anchorPointClouds,Cx),r.transform=Ae(),gc(r.transform,r.transform,Cx[3],Cx),n){const{parallaxNew:l}=e;RO(Zse,l.anchorPointClouds,Cx),l.transform=Ae(),gc(l.transform,l.transform,Cx[3],Cx)}ae(e.cameraPositionLastFrame,t)}};u([d({constructOnly:!0})],W1.prototype,"rctx",void 0),u([d({constructOnly:!0})],W1.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],W1.prototype,"planetRadius",void 0),u([d({constructOnly:!0})],W1.prototype,"requestRender",void 0),W1=u([P("esri.views.3d.environment.CloudsComposition")],W1);const Zse=Ue(0,0,1),Cx=oC(),Dp=O(),YXe=O(),Yse=500,QXe=250,JXe=500,KXe=500;function eZe(e){return e.crossFade.enabled||e.fadeInOut.stage!==oo.FINISHED||e.fadeIn.stage!==xh.FINISHED||e.fadeInOutHeight.stage!==zv.FINISHED}function Qse(e,t){return gw(e.cameraPositionLastFrame,t)}const tZe=new Ws;function Qh(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function iZe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function KY(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function eQ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Jh(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function dx(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l;let y=i*p+r*f+s*m;return y?(y=1/y,e[0]=p*y,e[1]=(-h*r+s*c)*y,e[2]=(a*r-s*o)*y,e[3]=f*y,e[4]=(h*i-s*l)*y,e[5]=(-a*i+s*n)*y,e[6]=m*y,e[7]=(-c*i+r*l)*y,e[8]=(o*i-r*n)*y,e):null}function rZe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-r*h,e[2]=r*a-s*o,e[3]=a*l-n*h,e[4]=i*h-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e}function sZe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function sU(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1],y=i[2],v=i[3],w=i[4],b=i[5],S=i[6],T=i[7],E=i[8];return e[0]=f*r+m*o+y*c,e[1]=f*s+m*a+y*h,e[2]=f*n+m*l+y*p,e[3]=v*r+w*o+b*c,e[4]=v*s+w*a+b*h,e[5]=v*n+w*l+b*p,e[6]=S*r+T*o+E*c,e[7]=S*s+T*a+E*h,e[8]=S*n+T*l+E*p,e}function _4(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=i[0],m=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=f*r+m*o+c,e[7]=f*s+m*a+h,e[8]=f*n+m*l+p,e}function tQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],f=Math.sin(i),m=Math.cos(i);return e[0]=m*r+f*o,e[1]=m*s+f*a,e[2]=m*n+f*l,e[3]=m*o-f*r,e[4]=m*a-f*s,e[5]=m*l-f*n,e[6]=c,e[7]=h,e[8]=p,e}function iQ(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function nZe(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function oZe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function aZe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function lZe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function cZe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function nU(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,f=s*o,m=s*a,y=s*l,v=n*o,w=n*a,b=n*l;return e[0]=1-p-y,e[3]=h-b,e[6]=f+w,e[1]=h+b,e[4]=1-c-y,e[7]=m-v,e[2]=f-w,e[5]=m+v,e[8]=1-c-p,e}function Xbe(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,f=-h*n+a*l,m=c*n-o*l,y=i*p+r*f+s*m;if(!y)return null;const v=1/y;return e[0]=p*v,e[1]=(-h*r+s*c)*v,e[2]=(a*r-s*o)*v,e[3]=f*v,e[4]=(h*i-s*l)*v,e[5]=(-a*i+s*n)*v,e[6]=m*v,e[7]=(-c*i+r*l)*v,e[8]=(o*i-r*n)*v,e}function pE(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],m=t[11],y=t[12],v=t[13],w=t[14],b=t[15],S=i*a-r*o,T=i*l-s*o,E=i*c-n*o,C=r*l-s*a,A=r*c-n*a,I=s*c-n*l,D=h*v-p*y,L=h*w-f*y,z=h*b-m*y,B=p*w-f*v,V=p*b-m*v,Q=f*b-m*w;let Z=S*Q-T*V+E*B+C*z-A*L+I*D;return Z?(Z=1/Z,e[0]=(a*Q-l*V+c*B)*Z,e[1]=(l*z-o*Q-c*L)*Z,e[2]=(o*V-a*z+c*D)*Z,e[3]=(s*V-r*Q-n*B)*Z,e[4]=(i*Q-s*z+n*L)*Z,e[5]=(r*z-i*V-n*D)*Z,e[6]=(v*I-w*A+b*C)*Z,e[7]=(w*E-y*I-b*T)*Z,e[8]=(y*A-v*E+b*S)*Z,e):null}function uZe(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function hZe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function dZe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function pZe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function Zbe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function fZe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function mZe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function gZe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function yZe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],f=t[1],m=t[2],y=t[3],v=t[4],w=t[5],b=t[6],S=t[7],T=t[8];return Math.abs(i-p)<=Ct*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=Ct*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-m)<=Ct*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(n-y)<=Ct*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-v)<=Ct*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-w)<=Ct*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-b)<=Ct*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-S)<=Ct*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=Ct*Math.max(1,Math.abs(h),Math.abs(T))}function rQ(e){const t=Ct,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const vZe=sU,_Ze=Zbe;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:Qh,copy:iZe,set:KY,identity:eQ,transpose:Jh,invert:dx,adjoint:rZe,determinant:sZe,multiply:sU,translate:_4,rotate:tQ,scale:iQ,scaleByVec2:nZe,fromTranslation:oZe,fromRotation:aZe,fromScaling:lZe,fromMat2d:cZe,fromQuat:nU,normalFromMat4Legacy:Xbe,normalFromMat4:pE,projection:uZe,str:hZe,frob:dZe,add:pZe,subtract:Zbe,multiplyScalar:fZe,multiplyScalarAndAdd:mZe,exactEquals:gZe,equals:yZe,isOrthoNormal:rQ,mul:vZe,sub:_Ze},Symbol.toStringTag,{value:"Module"}));function sQ(){return new Float32Array(2)}function bZe(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function ka(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function wZe(e,t){return new Float32Array(e,t,2)}function Ybe(){return sQ()}function Qbe(){return ka(1,1)}function Jbe(){return ka(1,0)}function Kbe(){return ka(0,1)}const xZe=Ybe(),TZe=Qbe(),SZe=Jbe(),EZe=Kbe();Object.freeze(Object.defineProperty({__proto__:null,create:sQ,clone:bZe,fromValues:ka,createView:wZe,zeros:Ybe,ones:Qbe,unitX:Jbe,unitY:Kbe,ZEROS:xZe,ONES:TZe,UNIT_X:SZe,UNIT_Y:EZe},Symbol.toStringTag,{value:"Module"}));var ep;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(ep||(ep={}));class ewe extends Wa{constructor(){super(...arguments),this.steps=ep.SIXTEEN}}u([H({count:ep.COUNT})],ewe.prototype,"steps",void 0);const Ah=he("esri-mobile")?64:128,CZe=Ah/128,zd=Math.ceil(Math.sqrt(Ah)),Yd=(Ah+2)*zd,AZe=1e5,TV=128,RZe=Yd/1560;function b_(e,t=!0){e.attributes.add(M.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(x`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?x`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class MO extends Kr{constructor(t,i){super(t,"mat3",ki.Draw,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class twe extends Ws{constructor(){super(...arguments),this.viewMatrix=Or()}}function MZe(e){const t=new Zi;return t.include(b_,!1),t.fragment.uniforms.add(new Ni("cloudRadius")),t.fragment.uniforms.add(new Ni("halfCubeMapSize")),t.fragment.uniforms.add(new Ni("power")),t.fragment.uniforms.add(new Ni("sigmaE")),t.fragment.uniforms.add(new Ni("density")),t.fragment.uniforms.add(new Ni("cloudSize")),t.fragment.uniforms.add(new Ni("detailSize")),t.fragment.uniforms.add(new Ni("smoothness")),t.fragment.uniforms.add(new Ni("cloudHeight")),t.fragment.uniforms.add(new Ni("coverage")),t.fragment.uniforms.add(new MO("view",i=>i.viewMatrix)),t.fragment.uniforms.add(new zr("cloudShapeTexture")),t.fragment.code.add(x`
    const int STEPS = ${e.steps===ep.SIXTEEN?x`16`:e.steps===ep.HUNDRED?x`100`:x`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(x`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${x.float(Yd)};
      const float dataWidth = ${x.float(Yd)};
      const float tileRows = ${x.float(zd)};
      const vec3 atlasDimensions = vec3(${x.float(Ah)}, ${x.float(Ah)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${x.float(CZe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${x.float(RZe)} * p) / ${x.float(Yd)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(x`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(x`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(x`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(x`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(x`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const OZe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:twe,build:MZe},Symbol.toStringTag,{value:"Module"}));class zC{constructor(t,i,r,s,n,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingStepType=l,this.median=c}}const iwe={sunny:new zC([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],ep.SIXTEEN),cloudy:new zC([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],ep.TWOHUNDRED,.6),rainy:new zC([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],ep.TWOHUNDRED,.4),snowy:new zC([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],ep.HUNDRED,.65),foggy:new zC([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],ep.SIXTEEN)};class oU extends pr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=oU.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:bo(Re.ONE,Re.ONE,Re.ZERO,Re.ZERO),depthTest:{func:gr.LEQUAL},colorWrite:ri})}}oU.shader=new rr(OZe,()=>import("./Clouds.glsl.956ea326.js"));var wu;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(wu||(wu={}));class DH extends Wa{constructor(){super(...arguments),this.mode=wu.Full}}u([H({count:wu.COUNT})],DH.prototype,"mode",void 0);function PZe(e){const t=new Zi;return t.include(b_,!1),t.fragment.code.add(x`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new zg("weatherTile")),e.mode===wu.Full&&t.fragment.code.add(x`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${x.float(zd)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${x.float(8)});

      float worley0 = worley(p, ${x.float(2)} * 2.0);
      float worley1 = worley(p, ${x.float(2)} * 8.0);
      float worley2 = worley(p, ${x.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${x.float(2)});
      float worley1 = worley(p, ${x.float(2)} * 2.0);
      float worley2 = worley(p, ${x.float(2)} * 4.0);
      float worley3 = worley(p, ${x.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.code.add(x`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${x.float(TV)});

      // Get global coordinates of p
      p += weatherTile * ${x.float(TV)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${x.float(AZe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(x`void main() {`),e.mode===wu.Full&&t.fragment.code.add(x`
        float padWidth = 1.0;
        float paddedSize = ${x.float(Ah)} + 2.0 * padWidth;
        float tileCount = ${x.float(zd)} * ${x.float(zd)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${x.float(Ah)};
          }

          if (startPadY) {
            pixel.y += ${x.float(Ah)};
          }

          if (endPadX) {
            pixel.x -= ${x.float(Ah)};
          }

          if (endPadY) {
            pixel.y -= ${x.float(Ah)};
          }

          uv = vec2(pixel.xy / ${x.float(Ah)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${x.float(Ah)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${x.float(zd)} * ${x.float(zd)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${x.float(zd)} * ${x.float(zd)});
        p = p_;
        p.z /= (${x.float(zd)} * ${x.float(zd)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(x`
      vec2 mapUV = ${x.float(TV)} * (gl_FragCoord.xy / ${x.float(Yd)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===wu.Full?x`gl_FragColor.ba = vec2(0.0, map);`:x`gl_FragColor = vec4(map);`};
    }
  `),t}const IZe=Object.freeze(Object.defineProperty({__proto__:null,build:PZe},Symbol.toStringTag,{value:"Module"}));class OO extends pr{initializeProgram(t){const i=OO.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:this.configuration.mode===wu.Full?ym(Re.ONE,Re.ZERO):bo(Re.ZERO,Re.ONE,Re.ONE,Re.ZERO),depthTest:{func:gr.ALWAYS},colorWrite:ri})}}OO.shader=new rr(IZe,()=>import("./NoiseTextureAtlas.glsl.80b96ccb.js"));class rS{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(Tn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==pi.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Tn.Renderbuffer,this),this._context=null)}}const $Ze=fe.getLogger("esri.views.webgl.FrameBufferObject");class Rr{constructor(t,i,r=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=F({},i),t.instanceCounter.increment(Tn.FramebufferObject,this),_(r)){Array.isArray(r)||(r=[r]);for(let o=0;o<r.length;++o){const a=r[o],l=au.COLOR_ATTACHMENT0+o;let c;Kse(a)?(ig(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new nt(this._context,c))),zI(c,this._desc)):(Jse(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new rS(this._context,c))),SV(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(_(s)){let o,a;if(Kse(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),ig(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new nt(this._context,a)),zI(a,this._desc);else{Jse(s)?(a=s.descriptor,o=s):(a=s,o=new rS(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Mi.DEPTH_STENCIL_RENDER_BUFFER;l===Mi.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Mi.DEPTH_RENDER_BUFFER||l===Mi.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),SV(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(Tn.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(au.COLOR_ATTACHMENT0);return t&&ig(t)?t:null}get colorAttachment(){return this._colorAttachments.get(au.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+Mw(r),0)+Mw(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&ig(i)?i:null}attachColorTexture(t,i=au.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),zI(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=au.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(ig(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=au.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);ig(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(R(t))return;const i=t.descriptor;i.pixelFormat!==Ve.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Et.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),zI(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Mi.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Mi.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,Dse)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Dse)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(R(t))return;const i=t.descriptor;if(i.internalFormat!==Fa.DEPTH_STENCIL&&i.internalFormat!==Fa.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),SV(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===Fa.DEPTH_STENCIL?Mi.DEPTH_STENCIL_RENDER_BUFFER:Mi.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Mi.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(Fn.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Mi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Fn.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,o,a){(t<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==ft.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,nt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(nt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(ft.TEXTURE_2D,0,n,o,t,i,r,s),h.bindTexture(p,nt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,o,a)}async readPixelsAsync(t,i,r,s,n,o,a){if(this._context.type!==pi.WEBGL2)return wh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,o,a);const l=this._context.gl,c=oi.createPixelPack(this._context,Ei.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,i,r,s,n,o,0),this._context.unbindBuffer(xt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(!this._initialized)return r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=Fn.FRAMEBUFFER){var h,p,f,m;const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(t,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:ss.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(f=n.height)!=null?f:1;if(i.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===ss.TEXTURE||o===ss.CUBEMAP)this._colorAttachments.set(au.COLOR_ATTACHMENT0,LZe(r,n,this.descriptor.colorTarget===ss.CUBEMAP?ft.TEXTURE_CUBE_MAP:ft.TEXTURE_2D));else{const y=new rS(r,{internalFormat:mt.RGBA4,width:a,height:l});this._colorAttachments.set(au.COLOR_ATTACHMENT0,y)}this._colorAttachments.forEach((y,v)=>{y&&(ig(y)?this._framebufferTexture2D(y.glName,v,ene(y),t):i.framebufferRenderbuffer(t,v,i.RENDERBUFFER,y.glName))});const c=(m=n.depthStencilTarget)!=null?m:Mi.NONE;switch(c){case Mi.DEPTH_RENDER_BUFFER:case Mi.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new rS(r,{internalFormat:n.depthStencilTarget===Mi.DEPTH_RENDER_BUFFER?Fa.DEPTH_COMPONENT16:Fa.DEPTH_STENCIL,width:a,height:l}));const y=c===Mi.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(t,y,i.RENDERBUFFER,this._depthAttachment.glName);break}case Mi.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new rS(r,{internalFormat:Fa.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(t,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Mi.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const y={target:ft.TEXTURE_2D,pixelFormat:Ve.DEPTH_STENCIL,dataType:Et.UNSIGNED_INT_24_8,samplingMode:Ke.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new nt(r,y)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,ene(this._depthStencilTexture),t)}EO()&&i.checkFramebufferStatus(t)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,i=au.COLOR_ATTACHMENT0,r=ft.TEXTURE_2D,s=Fn.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){wh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return ig(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(Fn.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Mi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(Fn.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(Fn.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Rr._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;Rr._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else Rr._MAX_COLOR_ATTACHMENTS=1}const i=t-au.COLOR_ATTACHMENT0;i+1>Rr._MAX_COLOR_ATTACHMENTS&&$Ze.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Rr._MAX_COLOR_ATTACHMENTS} color attachments`)}}function ig(e){return"type"in e&&e.type==="texture"}function Jse(e){return"type"in e&&e.type==="renderbuffer"}function Kse(e){return ig(e)||"pixelFormat"in e}function LZe(e,t,i){return new nt(e,{target:i,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,width:t.width,height:t.height})}function zI(e,t){e.target!==ft.TEXTURE_2D&&e.target!==ft.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function SV(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function ene(e){return e.descriptor.target===ft.TEXTURE_CUBE_MAP?ft.TEXTURE_CUBE_MAP_POSITIVE_X:ft.TEXTURE_2D}Rr._MAX_COLOR_ATTACHMENTS=-1;class rwe extends Se{constructor(t){let i;super(t),this._weatherTile=ka(0,0),this._needsRender=!0,this._frameBuffer=new Rr(t.context.renderContext.rctx,{colorTarget:ss.TEXTURE,width:Yd,height:Yd},{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR,hasMipmap:!1,width:Yd,height:Yd}),this._vao=Xa(t.context.renderContext.rctx),this._shaderTechniqueRepository=t.context.shaderTechniqueRepository,this._ensureRendered=()=>(_(i)?_(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(i=this._render(t.context.renderContext.rctx,wu.WeatherMap)):_(this.fullTechnique)&&this.fullTechnique.compiled&&(i=this._render(t.context.renderContext.rctx,wu.Full)),i)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(t){this._weatherTile[0]===t[0]&&this._weatherTile[1]===t[1]||(this._weatherTile=t,this._setDirty())}destroy(){this._fullTechnique=Ki(this._fullTechnique),this._weatherMapTechnique=Ki(this._weatherMapTechnique),this._frameBuffer=Ze(this._frameBuffer),this._vao=Ze(this._vao)}get fullTechnique(){if(R(this._fullTechnique)){const t=new DH;t.mode=wu.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(OO,t)}return this._fullTechnique}get weatherMapTechnique(){if(R(this._weatherMapTechnique)){const t=new DH;t.mode=wu.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(OO,t)}return this._weatherMapTechnique}_render(t,i){if(R(this._vao)||R(this._frameBuffer))return null;const r=i===wu.Full?this.fullTechnique:this.weatherMapTechnique;if(R(r))return null;const s=t.getViewport();t.setViewport(0,0,Yd,Yd),t.bindFramebuffer(this._frameBuffer);const n=t.bindTechnique(r);return n.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),t.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}}u([d({constructOnly:!0})],rwe.prototype,"context",void 0);function swe(e){e.include(Uu),e.uniforms.add([new jt("geometryDepthTexture",(t,i)=>i.multipassGeometry.linearDepthTexture),new vi("nearFar",(t,i)=>i.camera.nearFar)]),e.code.add(x`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class DZe{constructor(){this.enabled=!1}}function zu(e,t){t.hasMultipassTerrain&&(e.fragment.include(Uu),e.fragment.uniforms.add(new jt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new vi("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.uniforms.add(new vi("inverseViewport",(i,r)=>r.inverseViewport)),e.fragment.code.add(x`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class NZe{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function FZe(e,t){const i=e.fragment.uniforms;i.add(new vi("nearFar",(r,s)=>s.camera.nearFar)),i.add(new jt("depthMap",(r,s)=>s.linearDepthTexture)),i.add(new Tr("view",(r,s)=>s.ssr.camera.viewMatrix)),i.add(new Tr("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.add(new We("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.add(new jt("lastFrameColorMap",(r,s)=>s.ssr.lastFrameColorTexture)),i.add(new Tr("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),e.fragment.include(Uu),e.fragment.code.add(x`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class kZe{constructor(){this.reprojectionMatrix=Ae()}}var Ee;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Ee||(Ee={}));class nQ{constructor(t=O()){this.intensity=t}}class nwe{constructor(t=O(),i=Ue(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class NH{constructor(t=O(),i=Ue(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class owe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function UZe(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function EV(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function c2(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function awe(e){return(e+1)*(e+1)}function zZe(e){return De(Math.floor(Math.sqrt(e)-1),0,2)}function lwe(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=awe(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function VZe(e,t){const i=awe(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function BZe(e,t){const i=zZe(t.r.length);for(const r of e)ca(FH,r.direction),lwe(FH,i,Eg),UZe(Eg,oN),EV(Eg,r.intensity[0],Ax),c2(t.r,Ax),EV(Eg,r.intensity[1],Ax),c2(t.g,Ax),EV(Eg,r.intensity[2],Ax),c2(t.b,Ax);return t}function GZe(e,t){lwe(FH,0,Eg);for(const i of e)t.r[0]+=Eg[0]*oN[0]*i.intensity[0]*4*Math.PI,t.g[0]+=Eg[0]*oN[0]*i.intensity[1]*4*Math.PI,t.b[0]+=Eg[0]*oN[0]*i.intensity[2]*4*Math.PI;return t}function jZe(e,t,i,r){VZe(t,r),se(i.intensity,0,0,0);let s=!1;const n=HZe,o=qZe,a=WZe;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof NH&&!s?(ae(i.direction,l.direction),ae(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof NH||l instanceof nwe?n.push(l):l instanceof nQ?o.push(l):l instanceof owe&&a.push(l);BZe(n,r),GZe(o,r);for(const l of a)c2(r.r,l.r),c2(r.g,l.g),c2(r.b,l.b)}const HZe=[],qZe=[],WZe=[],Eg=[0],Ax=[0],FH=O(),oN=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],aC=.4;class XZe{constructor(){this._shOrder=2,this._oldSunlight={direction:O(),ambient:{color:O(),intensity:1},diffuse:{color:O(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new owe,this._mainLight={intensity:O(),direction:Ue(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){jZe(t,this._shOrder,this._mainLight,this._sphericalHarmonics),ae(this._oldSunlight.direction,this._mainLight.direction);const i=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,le(this._oldSunlight.diffuse.color,this._mainLight.intensity,i),ae(VI,this._oldSunlight.diffuse.color),le(VI,VI,aC*this.globalFactor),de(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,VI)}get old(){return this._oldSunlight}}const VI=O();class aU{constructor(t,i,r){this.shadowMap=t,this.ssaoHelper=i,this.slicePlane=r,this.slot=Ee.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=it(),this.lighting=new XZe,this.ssr=new kZe,this.multipassTerrain=new NZe,this.multipassGeometry=new DZe,this.clouds=new NXe,this.overlays=[]}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let Ea=class extends Se{constructor(e){super(e),this._frameTask=null,this._handles=new Nt,this._cubeMapSize=he("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new ewe,this._bindParameters=new aU(null,null,null),this._drawParameters=new twe,this._weatherTile=ka(0,0),this._weatherTileCount=128,this.coverage=Yt(Qa.coverage[0],Qa.coverage[1],.5),this.density=Yt(Qa.density[0],Qa.density[1],.5),this.absorption=Yt(Qa.absorption[0],Qa.absorption[1],.5),this.cloudSize=Yt(Qa.cloudSize[0],Qa.cloudSize[1],.5),this.detailSize=Yt(Qa.detailSize[0],Qa.detailSize[1],.5),this.smoothness=Yt(Qa.smoothness[0],Qa.smoothness[1],.5),this.cloudHeight=Yt(Qa.cloudHeight[0],Qa.cloudHeight[1],.5),this.raymarchingStepType=Qa.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Ae(),this._cameraPositionLastFrame=O(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new oU({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let i=ka((e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*i[0]-1));i=ka(Math.floor(2*this._weatherTileCount*i[0]),Math.floor(4*(this._weatherTileCount-r)*i[1]));let s=0,n=0;if(_(this.view.environment)&&this.view.environment.lighting.type==="sun"&&_(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}return i[0]=(i[0]+s)%(2*this._weatherTileCount),i[1]=(i[1]+n%100)%(4*this._weatherTileCount),i}initialize(){this._vao=Xa(this.context.renderContext.rctx);const e=Ci(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(ie(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),Rt))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>Ki(e)),this._techniques=null,this._frameBufferCube=Ze(this._frameBufferCube),this._vao=Ze(this._vao),this._noiseTexture=lt(this._noiseTexture)}_ensureNoiseTexture(){if(R(this._noiseTexture)){const e=this.context;this._noiseTexture=new rwe({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();_(this._noiseTexture)&&_(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if(R(this._frameBufferCube)){const e={target:ft.TEXTURE_CUBE_MAP,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new Rr(this.context.renderContext.rctx,{colorTarget:ss.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===oo.FADE_OUT||e.fadeInOutHeight.stage!==zv.FINISHED}applyPreset(e,t){const i=e.median,r=s=>{const n=Yt(s[0],s[1],i);return t<.5?Yt(s[0],n,2*t):Yt(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||R(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!gw(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void ae(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const i=this._ensureNoiseTexture();if(R(i))return;const r=this.context.renderContext.rctx,s=r.bindTechnique(t),n=1+this.absorption,o=Yt(35,120,this.absorption);s.bindTexture("cloudShapeTexture",i),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",Yt(0,.3,this.density)),s.setUniform1f("cloudSize",Yt(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",Yt(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",Yt(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",Yt(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=r.getViewport();r.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),r.bindFramebuffer(this.frameBufferCube);for(let l=0;l<5;l++){const c=ZZe[l],h=YZe[l];qme(this._viewMatrix,QZe,c,h),Qh(this._drawParameters.viewMatrix,this._viewMatrix);const p=ft.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush()}this.running=!1,r.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),e.madeProgress()}};u([d({constructOnly:!0})],Ea.prototype,"context",void 0),u([d({constructOnly:!0})],Ea.prototype,"view",void 0),u([d({constructOnly:!0})],Ea.prototype,"requestRender",void 0),u([d()],Ea.prototype,"_frameTask",void 0),u([d()],Ea.prototype,"coverage",void 0),u([d()],Ea.prototype,"density",void 0),u([d()],Ea.prototype,"absorption",void 0),u([d()],Ea.prototype,"cloudSize",void 0),u([d()],Ea.prototype,"detailSize",void 0),u([d()],Ea.prototype,"smoothness",void 0),u([d()],Ea.prototype,"cloudHeight",void 0),u([d()],Ea.prototype,"raymarchingStepType",void 0),u([d()],Ea.prototype,"running",void 0),Ea=u([P("esri.views.3d.environment.CloudsGenerator")],Ea);const ZZe=[$i(1,0,0),$i(-1,0,0),$i(0,1,0),$i(0,-1,0),$i(0,0,1)],YZe=[$i(0,1,0),$i(0,1,0),$i(0,0,-1),$i(0,0,1),$i(0,1,0)],QZe=HY(),Qa=iwe.sunny;function JZe(e){const t=new Zi;t.attributes.add(M.POSITION,"vec2"),t.include(Ug,{textureCoordinateType:an.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Tr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Tr("inverseViewMatrix",(s,n)=>_s(KZe,n.camera.viewMatrix))]),i.code.add(x`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ni("atmosphereC")),r.uniforms.add(new El("cameraPosition")),r.uniforms.add(new vi("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new zr("depthTex")),r.uniforms.add(new Ni("fogStrength")),r.uniforms.add(new Ni("fogAmount")),r.uniforms.add(new El("fogColor")),t.include(eU),r.include(Uu),r.code.add(x`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(x`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(x`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?x`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const KZe=Ae(),eYe=Object.freeze(Object.defineProperty({__proto__:null,build:JZe},Symbol.toStringTag,{value:"Module"}));class PO extends pr{initializeProgram(t){const i=PO.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return this.configuration.haze?Bt({blending:bo(Re.ONE,Re.ZERO,Re.ONE_MINUS_SRC_COLOR,Re.ONE),colorWrite:ri}):Bt({blending:bo(Re.SRC_ALPHA,Re.ZERO,Re.ONE_MINUS_SRC_ALPHA,Re.ONE),colorWrite:ri})}}PO.shader=new rr(eYe,()=>import("./Fog.glsl.605989fc.js"));class kH extends Wa{constructor(){super(...arguments),this.haze=!1}}u([H()],kH.prototype,"haze",void 0);let $R=class extends Se{constructor(e){super(e),this._fogColor=Ri(),this._fogColorAtNight=Ri(),this._cameraDirection=Ri(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=Xa(t,Y3);const i=Ci(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+iN}destroy(){this._hazeFogTechnique=Ki(this._hazeFogTechnique),this._thickFogTechnique=Ki(this._thickFogTechnique),this._vao=Ze(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(R(this._thickFogTechnique)){const e=new kH;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(PO,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(R(this._hazeFogTechnique)){const e=new kH;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(PO,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,i),this._fogAmount<=0))return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(r,tYe,e.bindParameters);s.renderDepthDetached(()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e)})}_renderFog(e,t){if(R(this._vao))return!1;const i=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays($t.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){const r=e.bindParameters.camera,s=t?.1:0;i?se(this._fogColor,.5,.5,.5):t?se(this._fogColor,1.5,1.5,1.5):se(this._fogColor,.24,.44,.8),le(this._fogColorAtNight,this._fogColor,s),we(this._cameraDirection,r.eye);const n=Math.max(0,xe(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));pn(this._fogColor,this._fogColorAtNight,this._fogColor,n);const o=Me(r.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-F2(this._foggyFadeStart*Ch,this._foggyFadeEnd*Ch,Math.abs(o-this._planetRadius)):1-F2(this._hazeFadeStart*Ch,this._hazeFadeEnd*Ch,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};u([d({constructOnly:!0})],$R.prototype,"context",void 0),u([d({constructOnly:!0})],$R.prototype,"view",void 0),$R=u([P("esri.views.3d.environment.Fog")],$R);const tYe=new Ws;async function Ap(e,t){const{data:i}=await Zt(e,F({responseType:"image"},t));return i}var sm;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})(sm||(sm={}));class b4 extends Wa{constructor(){super(...arguments),this.geometry=sm.Cone}}u([H({count:sm.COUNT})],b4.prototype,"geometry",void 0);function Uo(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(x`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(x`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class e_ extends Kr{constructor(t){super(t,"mat4")}}class oQ extends Ws{}function iYe(e){const t=new Zi,{vertex:i,fragment:r}=t;if(e.geometry===sm.Underground)t.attributes.add(M.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new Tt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new El("cameraPosition"),new Ni("undergroundFadeAlpha")]),i.code.add(x`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(x`void main() {
gl_FragColor = color;
}`);else{t.include(Uo),t.attributes.add(M.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===sm.Cylinder;i.uniforms.add([new Tr("proj",(a,l)=>l.camera.projectionMatrix),new e_("view"),new Tt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)]),s||(t.varyings.add("innerFactor","float"),i.uniforms.add(new El("silCircleCenter")),i.uniforms.add(new El("silCircleV1")),i.uniforms.add(new El("silCircleV2")),i.uniforms.add(new zg("texV")),i.uniforms.add(new Ni("innerScale")));const n=6.2831853,o=1/128;i.code.add(x`
		void main(void) {
      ${s?x`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:x`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${x.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${x.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new jt("tex",a=>a.texture)),s||r.uniforms.add(new Ni("altitudeFade")),r.code.add(x`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?x`gl_FragColor = atmosphereColor;`:x`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const rYe=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:oQ,build:iYe},Symbol.toStringTag,{value:"Module"}));class fE extends pr{initializeProgram(t){const i=fE.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return this.configuration.geometry===sm.Cylinder?Bt({blending:bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),culling:UY,depthTest:{func:gr.LEQUAL},colorWrite:ri}):Bt({blending:bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:gr.LEQUAL},colorWrite:ri})}}fE.shader=new rr(rYe,()=>import("./SimpleAtmosphere.glsl.97e2dbe9.js"));const cwe="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function Dc(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=sYe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new yo(r,n,o,a,i,l,t)})}function sYe(e){const t=nYe[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const nYe={u8:dt.UNSIGNED_BYTE,u16:dt.UNSIGNED_SHORT,u32:dt.UNSIGNED_INT,i8:dt.BYTE,i16:dt.SHORT,i32:dt.INT,f32:dt.FLOAT};class aQ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}aQ.ElementCount=9;class lQ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}lQ.ElementCount=16;class yy{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}yy.ElementCount=1;class vy{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,yi(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}vy.ElementCount=2;class _y{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,se(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}_y.ElementCount=3;class by{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,Ji(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}by.ElementCount=4;class J3 extends yy{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new J3(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}J3.ElementType="f32";class Kh extends vy{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Kh,t,i)}static fromTypedArray(t,i){return new Kh(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Kh.ElementType="f32";class Xi extends _y{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Xi,t,i)}static fromTypedArray(t,i){return new Xi(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Xi.ElementType="f32";class qn extends by{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(qn,t,i)}static fromTypedArray(t,i){return new qn(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}qn.ElementType="f32";class Rp extends aQ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Rp,t,i)}static fromTypedArray(t,i){return new Rp(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Rp.ElementType="f32";class t_ extends aQ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(t_,t,i)}static fromTypedArray(t,i){return new t_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}t_.ElementType="f64";class mE extends lQ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(mE,t,i)}static fromTypedArray(t,i){return new mE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}mE.ElementType="f32";class i_ extends lQ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(i_,t,i)}static fromTypedArray(t,i){return new i_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}i_.ElementType="f64";class gE extends yy{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(gE,t,i)}static fromTypedArray(t,i){return new gE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}gE.ElementType="f64";class yE extends vy{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(yE,t,i)}static fromTypedArray(t,i){return new yE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}yE.ElementType="f64";class As extends _y{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(As,t,i)}static fromTypedArray(t,i){return new As(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}As.ElementType="f64";class Pw extends by{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Pw,t,i)}static fromTypedArray(t,i){return new Pw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Pw.ElementType="f64";class ay extends yy{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(ay,t,i)}static fromTypedArray(t,i){return new ay(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ay.ElementType="u8";class Iw extends vy{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Iw,t,i)}static fromTypedArray(t,i){return new Iw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Iw.ElementType="u8";class r_ extends _y{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(r_,t,i)}static fromTypedArray(t,i){return new r_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}r_.ElementType="u8";class Fl extends by{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Fl,t,i)}static fromTypedArray(t,i){return new Fl(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Fl.ElementType="u8";class $w extends yy{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer($w,t,i)}static fromTypedArray(t,i){return new $w(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}$w.ElementType="u16";class vE extends vy{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(vE,t,i)}static fromTypedArray(t,i){return new vE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}vE.ElementType="u16";class Lw extends _y{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Lw,t,i)}static fromTypedArray(t,i){return new Lw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Lw.ElementType="u16";class s_ extends by{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(s_,t,i)}static fromTypedArray(t,i){return new s_(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}s_.ElementType="u16";class Dw extends yy{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(Dw,t,i)}static fromTypedArray(t,i){return new Dw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Dw.ElementType="u32";class _E extends vy{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(_E,t,i)}static fromTypedArray(t,i){return new _E(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}_E.ElementType="u32";class IO extends _y{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(IO,t,i)}static fromTypedArray(t,i){return new IO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}IO.ElementType="u32";class $O extends by{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer($O,t,i)}static fromTypedArray(t,i){return new $O(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}$O.ElementType="u32";class bE extends yy{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(bE,t,i)}static fromTypedArray(t,i){return new bE(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}bE.ElementType="i8";class Nw extends vy{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(Nw,t,i)}static fromTypedArray(t,i){return new Nw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Nw.ElementType="i8";class LO extends _y{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(LO,t,i)}static fromTypedArray(t,i){return new LO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}LO.ElementType="i8";class DO extends by{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(DO,t,i)}static fromTypedArray(t,i){return new DO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}DO.ElementType="i8";class NO extends yy{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(NO,t,i)}static fromTypedArray(t,i){return new NO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}NO.ElementType="i16";class Fw extends vy{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(Fw,t,i)}static fromTypedArray(t,i){return new Fw(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Fw.ElementType="i16";class FO extends _y{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(FO,t,i)}static fromTypedArray(t,i){return new FO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}FO.ElementType="i16";class kO extends by{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(kO,t,i)}static fromTypedArray(t,i){return new kO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}kO.ElementType="i16";class UO extends yy{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(UO,t,i)}static fromTypedArray(t,i){return new UO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}UO.ElementType="i32";class zO extends vy{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(zO,t,i)}static fromTypedArray(t,i){return new zO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}zO.ElementType="i32";class VO extends _y{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(VO,t,i)}static fromTypedArray(t,i){return new VO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}VO.ElementType="i32";class BO extends by{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(BO,t,i)}static fromTypedArray(t,i){return new BO(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}BO.ElementType="i32";function uwe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function oYe(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function aYe(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function lYe(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class w4{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new w4(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}}class cQ{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,Kh,i),this}vec2f64(t,i){return this._appendField(t,yE,i),this}vec3f(t,i){return this._appendField(t,Xi,i),this}vec3f64(t,i){return this._appendField(t,As,i),this}vec4f(t,i){return this._appendField(t,qn,i),this}vec4f64(t,i){return this._appendField(t,Pw,i),this}mat3f(t,i){return this._appendField(t,Rp,i),this}mat3f64(t,i){return this._appendField(t,t_,i),this}mat4f(t,i){return this._appendField(t,mE,i),this}mat4f64(t,i){return this._appendField(t,i_,i),this}vec4u8(t,i){return this._appendField(t,Fl,i),this}f32(t,i){return this._appendField(t,J3,i),this}f64(t,i){return this._appendField(t,gE,i),this}u8(t,i){return this._appendField(t,ay,i),this}u16(t,i){return this._appendField(t,$w,i),this}i8(t,i){return this._appendField(t,bE,i),this}vec2i8(t,i){return this._appendField(t,Nw,i),this}vec2i16(t,i){return this._appendField(t,Fw,i),this}vec2u8(t,i){return this._appendField(t,Iw,i),this}vec4u16(t,i){return this._appendField(t,s_,i),this}u32(t,i){return this._appendField(t,Dw,i),this}_appendField(t,i,r){const s=i.ElementCount*uwe(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new w4(this,t)}createView(t){return new w4(this,t)}clone(){const t=new cQ;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function ls(){return new cQ}var UH;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(UH||(UH={}));const ya=Xt();class cYe{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function pt(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new cYe(t)}function Rx(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function tne(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function BI(e,t,i,r,s,n=it()){const o=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),a=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function ine(e,t,i,r,s){s||(s=e),ya[0]=e[0],ya[1]=e[1],ya[2]=e[2],ya[3]=1,Eu(ya,ya,t),s.length>2&&(s[2]=-ya[2]),Eu(ya,ya,i),pt(ya[3]!==0),s[0]=ya[0]/ya[3],s[1]=ya[1]/ya[3],s[2]=ya[2]/ya[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function uYe(e,t){return Math.log(e)/Math.log(t)}function hwe(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function dwe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function hYe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function dYe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function pYe(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function fYe(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}class lU{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this.center=O(),pt(t.length>=1),pt(r.length%this._numIndexPerPrimitive==0),pt(r.length>=t.length*this._numIndexPerPrimitive),pt(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*r[this._numIndexPerPrimitive*t[0]];N_.clear(),N_.push(l),this.bbMin=Ue(n[l],n[l+1],n[l+2]),this.bbMax=Vs(this.bbMin);for(let h=0;h<a;++h){const p=this._numIndexPerPrimitive*t[h];for(let f=0;f<this._numIndexPerPrimitive;++f){l=o*r[p+f],N_.push(l);let m=n[l];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=n[l+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=n[l+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}}pn(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let h=0;h<N_.length;++h){l=N_.getItemAt(h);const p=n[l]-this.center[0],f=n[l+1]-this.center[1],m=n[l+2]-this.center[2],y=p*p+f*f+m*m;if(y<=c)continue;const v=Math.sqrt(y),w=.5*(v-this.radius);this.radius=this.radius+w,c=this.radius*this.radius;const b=w/v;this.center[0]+=p*b,this.center[1]+=f*b,this.center[2]+=m*b}N_.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Sn(this.bbMin,this.bbMax)>1){const t=pn(O(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],m=n[f],y=n[f+1],v=n[f+2];for(let w=1;w<this._numIndexPerPrimitive;++w){f=o*this.indices[p+w];const b=n[f],S=n[f+1],T=n[f+2];b<m&&(m=b),S<y&&(y=S),T<v&&(v=T)}m<t[0]&&(h|=1),y<t[1]&&(h|=2),v<t[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new lU(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){N_.prune()}}const N_=new Wt({deallocator:null});class K3{constructor(){this.id=Cl()}unload(){}}var Mp;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(Mp||(Mp={}));function rne(e,t,i){const r=t[0]-e[0],s=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return .5*Math.abs(r*o-s*n)}function mYe(e,t,i){return pe(CV,t,e),pe(sne,i,e),Me(ct(CV,CV,sne))/2}new py(fm);new py(()=>({p0:null,p1:null,p2:null}));const CV=O(),sne=O();let J0=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const pwe=new Uint16Array([0]),x4=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function wE(e){if(e===1)return pwe;if(e<x4.length)return new Uint16Array(x4.buffer,0,e);if(e>J0.length){const t=Math.max(2*J0.length,e);J0=new Uint32Array(t);for(let i=0;i<J0.length;i++)J0[i]=i}return new Uint32Array(J0.buffer,0,e)}function gEt(e){if(e===1)return new Uint16Array(pwe);if(e<x4.length)return new Uint16Array(x4.slice(0,e));if(e>J0.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(J0.slice(0,e))}function fwe(e,t,i){if(!e)return!1;const{size:r,data:s}=e;se(i,0,0,0),se(Th,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*r,c=t[a+1]*r,h=t[a+2]*r;se(kn,s[l+0],s[l+1],s[l+2]),se(Cg,s[c+0],s[c+1],s[c+2]),se(GI,s[h+0],s[h+1],s[h+2]);const p=mYe(kn,Cg,GI);p?(de(kn,kn,Cg),de(kn,kn,GI),le(kn,kn,1/3*p),de(i,i,kn),n+=p):(de(Th,Th,kn),de(Th,Th,Cg),de(Th,Th,GI),o+=3)}return(o!==0||n!==0)&&(n!==0?(le(i,i,1/n),!0):o!==0&&(le(i,Th,1/o),!0))}function mwe(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;se(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&le(i,i,1/o),o>0}function uQ(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;se(r,0,0,0),se(Th,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,f=h<l?h+1:0,m=(t?t[p]:p)*s,y=(t?t[f]:f)*s;kn[0]=n[m+0],kn[1]=n[m+1],kn[2]=n[m+2],Cg[0]=n[y+0],Cg[1]=n[y+1],Cg[2]=n[y+2],le(kn,de(kn,kn,Cg),.5);const v=WW(kn,Cg);v>0?(de(r,r,le(kn,kn,v)),o+=v):(de(Th,Th,kn),a++)}return o!==0?(le(r,r,1/o),!0):a!==0&&(le(r,Th,1/a),!0)}const kn=O(),Cg=O(),GI=O(),Th=O();class Fr extends K3{constructor(t,i=[],r=Ol.Triangle,s=-1){super(),this._primitiveType=r,this.edgeIndicesLength=s,this.type=Mp.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,F({},o));if(i==null||i.length===0){const n=gYe(this._vertexAttributes),o=wE(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const a of this._vertexAttributes.keys())this._indices.set(a,o)}else for(const[n,o]of i)o&&(this._indices.set(n,yYe(o)),n===M.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new Fr([],void 0,this._primitiveType,void 0),{_vertexAttributes:i,_indices:r}=t;return this._vertexAttributes.forEach((s,n)=>{i.set(n,s)}),this._indices.forEach((s,n)=>{r.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i.data=Array.from(i.data),i.exclusive=!0),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return R(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===Ol.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(M.POSITION),r=this.vertexAttributes.get(M.POSITION);return fwe(r,i,t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(M.POSITION),r=this.vertexAttributes.get(M.POSITION);return mwe(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(M.POSITION);if(t.length===0)return null;const i=this.primitiveType===Ol.Triangle?3:1;pt(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const r=wE(t.length/i),s=this.vertexAttributes.get(M.POSITION);return new lU(r,i,t,s)}}function gYe(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function yYe(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const Mx=UH;var AV,RV,MV,zH;(function(e){const i=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let c=0;c<6;c++)for(let h=0;h<6;h++)o[6*c+h]=c;const a=new Uint16Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const h=new Array(24);for(let p=0;p<8;p++)h[3*p]=i[p][0]*c[0],h[3*p+1]=i[p][1]*c[1],h[3*p+2]=i[p][2]*c[2];return new Fr([[M.POSITION,{size:3,data:h,exclusive:!0}],[M.NORMAL,{size:3,data:r}],[M.UV0,{size:2,data:s}]],[[M.POSITION,n],[M.NORMAL,o],[M.UV0,a]])}e.createGeometry=l})(AV||(AV={})),function(e){const i=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=i[c][0]*a[0],l[3*c+1]=i[c][1]*a[1],l[3*c+2]=i[c][2]*a[2];return new Fr([[M.POSITION,{size:3,data:l,exclusive:!0}],[M.NORMAL,{size:3,data:r}]],[[M.POSITION,s],[M.NORMAL,n]])}e.createGeometry=o}(RV||(RV={})),function(e){const r=$i(-.5,0,-.5),s=$i(.5,0,-.5),n=$i(0,0,.5),o=$i(0,0+.5,0),a=Ri(),l=Ri(),c=Ri(),h=Ri(),p=Ri();pe(a,r,o),pe(l,r,s),ct(c,a,l),we(c,c),pe(a,s,o),pe(l,s,n),ct(h,a,l),we(h,h),pe(a,n,o),pe(l,n,r),ct(p,a,l),we(p,p);const f=[r,s,n,o],m=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];function w(b){Array.isArray(b)||(b=[b,b,b]);const S=new Array(12);for(let T=0;T<4;T++)S[3*T]=f[T][0]*b[0],S[3*T+1]=f[T][1]*b[1],S[3*T+2]=f[T][2]*b[2];return new Fr([[M.POSITION,{size:3,data:S,exclusive:!0}],[M.NORMAL,{size:3,data:m}]],[[M.POSITION,new Uint16Array(y)],[M.NORMAL,new Uint16Array(v)]])}e.createGeometry=w}(MV||(MV={})),function(e){function t(T,E,C,A={uv:!0}){const I=-Math.PI,D=2*Math.PI,L=-Math.PI/2,z=Math.PI,B=Math.max(3,Math.floor(E)),V=Math.max(2,Math.floor(C)),Q=(B+1)*(V+1),Z=new Float32Array(3*Q),ce=new Float32Array(3*Q),oe=new Float32Array(2*Q),$=[];let U=0;for(let ee=0;ee<=V;ee++){const q=[],te=ee/V,ge=L+te*z,Te=Math.cos(ge);for(let ke=0;ke<=B;ke++){const _e=ke/B,me=I+_e*D,Ce=Math.cos(me)*Te,Fe=Math.sin(ge),Li=-Math.sin(me)*Te;Z[3*U]=Ce*T,Z[3*U+1]=Fe*T,Z[3*U+2]=Li*T,ce[3*U]=Ce,ce[3*U+1]=Fe,ce[3*U+2]=Li,oe[2*U]=_e,oe[2*U+1]=te,q.push(U),++U}$.push(q)}const G=new Uint32Array(2*B*(V-1)*3);U=0;for(let ee=0;ee<V;ee++)for(let q=0;q<B;q++){const te=$[ee][q],ge=$[ee][q+1],Te=$[ee+1][q+1],ke=$[ee+1][q];ee===0?(G[U++]=te,G[U++]=Te,G[U++]=ke):ee===V-1?(G[U++]=te,G[U++]=ge,G[U++]=Te):(G[U++]=te,G[U++]=ge,G[U++]=Te,G[U++]=Te,G[U++]=ke,G[U++]=te)}const W=[[M.POSITION,G],[M.NORMAL,G]],X=[[M.POSITION,{size:3,data:Z,exclusive:!0}],[M.NORMAL,{size:3,data:ce,exclusive:!0}]];return A.uv&&(X.push([M.UV0,{size:2,data:oe,exclusive:!0}]),W.push([M.UV0,G])),A.offset&&(W[0][0]=M.OFFSET,X[0][0]=M.OFFSET,W.push([M.POSITION,new Uint32Array(G.length)]),X.push([M.POSITION,{size:3,data:Float64Array.from(A.offset),exclusive:!0}])),new Fr(X,W)}function i(T,E,C){const A=T;let I,D;if(C)I=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],D=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const Z=A*(1+Math.sqrt(5))/2;I=[-A,Z,0,A,Z,0,-A,-Z,0,A,-Z,0,0,-A,Z,0,A,Z,0,-A,-Z,0,A,-Z,Z,0,-A,Z,0,A,-Z,0,-A,-Z,0,A],D=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let Z=0;Z<I.length;Z+=3)Mx.scale(I,Z,T/Mx.length(I,Z));let L={};function z(Z,ce){Z>ce&&([Z,ce]=[ce,Z]);const oe=Z.toString()+"."+ce.toString();if(L[oe])return L[oe];let $=I.length;return I.length+=3,Mx.add(I,3*Z,I,3*ce,I,$),Mx.scale(I,$,T/Mx.length(I,$)),$/=3,L[oe]=$,$}for(let Z=0;Z<E;Z++){const ce=D.length,oe=new Uint32Array(4*ce);for(let $=0;$<ce;$+=3){const U=D[$],G=D[$+1],W=D[$+2],X=z(U,G),ee=z(G,W),q=z(W,U),te=4*$;oe[te]=U,oe[te+1]=X,oe[te+2]=q,oe[te+3]=G,oe[te+4]=ee,oe[te+5]=X,oe[te+6]=W,oe[te+7]=q,oe[te+8]=ee,oe[te+9]=X,oe[te+10]=ee,oe[te+11]=q}D=oe,L={}}const B=new Float32Array(I);for(let Z=0;Z<B.length;Z+=3)Mx.normalize(B,Z);const V=[[M.POSITION,D],[M.NORMAL,D]],Q=[[M.POSITION,{size:3,data:new Float32Array(I),exclusive:!0}],[M.NORMAL,{size:3,data:B,exclusive:!0}]];return new Fr(Q,V)}function r(T,E,C,A,I,D,L){const z=E?[E[0],E[1],E[2]]:[0,0,0],B=T?[T[0],T[1],T[2]]:[0,0,1];D=D||[0,0];const V=C?[255*C[0],255*C[1],255*C[2],C.length>3?255*C[3]:255]:[255,255,255,255],Q=A!=null&&A.length===2?A:[1,1],Z=[[M.POSITION,{size:3,data:z,exclusive:!0}],[M.NORMAL,{size:3,data:B,exclusive:!0}],[M.UV0,{size:D.length,data:D}],[M.COLOR,{size:4,data:V,exclusive:!0}],[M.SIZE,{size:2,data:Q}]];if(I!=null){const ce=new Float32Array([I[0],I[1],I[2],I[3]]);Z.push([M.AUXPOS1,{size:4,data:ce}])}if(L!=null){const ce=new Float32Array([L[0],L[1],L[2],L[3]]);Z.push([M.AUXPOS2,{size:4,data:ce}])}return new Fr(Z,null,Ol.Point)}function s(T,E,C,A,I,D,L,z){if(T!=null){const{data:B}=z.getMutableAttribute(M.NORMAL);B[0]=T[0],B[1]=T[1],B[2]=T[2]}if(E!=null){const{data:B}=z.getMutableAttribute(M.POSITION);B[0]=E[0],B[1]=E[1],B[2]=E[2]}if(C!=null){const{data:B}=z.getMutableAttribute(M.COLOR);B[0]=C[0],B[1]=C[1],B[2]=C[2],B[3]=C[3]}if(A!=null){const{data:B}=z.getMutableAttribute(M.SIZE);B[0]=A[0],B[1]=A[1]}if(I!=null){const{data:B}=z.getMutableAttribute(M.AUXPOS1);B[0]=I[0],B[1]=I[1],B[2]=I[2],B[3]=I[3]}if(D!=null){const{data:B}=z.getMutableAttribute(M.UV0);B[0]=D[0],B[1]=D[1]}if(L!=null){const{data:B}=z.getMutableAttribute(M.AUXPOS2);B[0]=L[0],B[1]=L[1],B[2]=L[2],B[3]=L[3]}}function n(T,E){const C=new Float32Array(3*T.length),A=new Float32Array(E?3*T.length:3),I=new Uint32Array(T.length),D=new Uint32Array(T.length);for(let V=0;V<T.length;V++)C[3*V]=T[V][0],C[3*V+1]=T[V][1],C[3*V+2]=T[V][2],E&&(A[3*V]=E[V][0],A[3*V+1]=E[V][1],A[3*V+2]=E[V][2]),I[V]=V,D[V]=0;E||(A[0]=0,A[1]=1,A[2]=0);const L=[0,0],z=[[M.POSITION,I],[M.NORMAL,E?I:D],[M.UV0,D]],B=[[M.POSITION,{size:3,data:C,exclusive:!0}],[M.NORMAL,{size:3,data:A,exclusive:!0}],[M.UV0,{size:2,data:L,exclusive:!0}]];return new Fr(B,z,Ol.Point)}function o(){const T=[0,0,0,0,0,100,100,0,0],E=new Uint16Array([0,1,2]),C=[0,1,0],A=new Uint16Array([0,0,0]),I=[0,0],D=new Uint16Array([0,0,0]),L=[[M.POSITION,E],[M.NORMAL,A],[M.UV0,D]],z=[[M.POSITION,{size:3,data:T,exclusive:!0}],[M.NORMAL,{size:3,data:C,exclusive:!0}],[M.UV0,{size:2,data:I,exclusive:!0}]];return new Fr(z,L)}e.createBoxGeometry=AV.createGeometry,e.createDiamondGeometry=RV.createGeometry,e.createTetrahedronGeometry=MV.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=o;const a=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(T=a){const E=new Array(12);for(let V=0;V<4;V++)for(let Q=0;Q<3;Q++)E[3*V+Q]=T[V][Q];const C=new Uint32Array([0,1,2,2,3,0]),A=[0,0,1],I=new Uint32Array([0,0,0,0,0,0]),D=[0,0,1,0,1,1,0,1],L=[255,255,255,255],z=[[M.POSITION,C],[M.NORMAL,I],[M.UV0,C],[M.COLOR,I]],B=[[M.POSITION,{size:3,data:E,exclusive:!0}],[M.NORMAL,{size:3,data:A,exclusive:!0}],[M.UV0,{size:2,data:D,exclusive:!0}],[M.COLOR,{size:4,data:L,exclusive:!0}]];return new Fr(B,z)}function c(T,E,C,A,I=!0,D=!0){let L=0;const z=E,B=T;let V=$i(0,L,0),Q=$i(0,L+B,0),Z=$i(0,-1,0),ce=$i(0,1,0);A&&(L=B,Q=$i(0,0,0),V=$i(0,L,0),Z=$i(0,1,0),ce=$i(0,-1,0));const oe=[Q,V],$=[Z,ce],U=C+2,G=Math.sqrt(B*B+z*z);if(A)for(let _e=C-1;_e>=0;_e--){const me=_e*(2*Math.PI/C),Ce=$i(Math.cos(me)*z,L,Math.sin(me)*z);oe.push(Ce);const Fe=$i(B*Math.cos(me)/G,-z/G,B*Math.sin(me)/G);$.push(Fe)}else for(let _e=0;_e<C;_e++){const me=_e*(2*Math.PI/C),Ce=$i(Math.cos(me)*z,L,Math.sin(me)*z);oe.push(Ce);const Fe=$i(B*Math.cos(me)/G,z/G,B*Math.sin(me)/G);$.push(Fe)}const W=new Uint32Array(2*(C+2)*3),X=new Uint32Array(2*(C+2)*3);let ee=0,q=0;if(I){for(let _e=3;_e<oe.length;_e++)W[ee++]=1,W[ee++]=_e-1,W[ee++]=_e,X[q++]=0,X[q++]=0,X[q++]=0;W[ee++]=oe.length-1,W[ee++]=2,W[ee++]=1,X[q++]=0,X[q++]=0,X[q++]=0}if(D){for(let _e=3;_e<oe.length;_e++)W[ee++]=_e,W[ee++]=_e-1,W[ee++]=0,X[q++]=_e,X[q++]=_e-1,X[q++]=1;W[ee++]=0,W[ee++]=2,W[ee++]=oe.length-1,X[q++]=1,X[q++]=2,X[q++]=$.length-1}const te=new Float32Array(3*U);for(let _e=0;_e<U;_e++)te[3*_e]=oe[_e][0],te[3*_e+1]=oe[_e][1],te[3*_e+2]=oe[_e][2];const ge=new Float32Array(3*U);for(let _e=0;_e<U;_e++)ge[3*_e]=$[_e][0],ge[3*_e+1]=$[_e][1],ge[3*_e+2]=$[_e][2];const Te=[[M.POSITION,W],[M.NORMAL,X]],ke=[[M.POSITION,{size:3,data:te,exclusive:!0}],[M.NORMAL,{size:3,data:ge,exclusive:!0}]];return new Fr(ke,Te)}function h(T,E,C,A,I,D){const L=A?v4(A):$i(1,0,0),z=I?v4(I):$i(0,0,0);D=D==null||D;const B=Ri();we(B,L);const V=Ri();le(V,B,Math.abs(T));const Q=Ri();le(Q,V,-.5),de(Q,Q,z);const Z=$i(0,1,0);Math.abs(1-xe(B,Z))<.2&&se(Z,0,0,1);const ce=Ri();ct(ce,B,Z),we(ce,ce),ct(Z,ce,B);const oe=2*C+(D?2:0),$=C+(D?2:0),U=new Float32Array(3*oe),G=new Float32Array(3*$),W=new Float32Array(2*oe),X=new Uint32Array(3*C*(D?4:2)),ee=new Uint32Array(3*C*(D?4:2));D&&(U[3*(oe-2)+0]=Q[0],U[3*(oe-2)+1]=Q[1],U[3*(oe-2)+2]=Q[2],W[2*(oe-2)]=0,W[2*(oe-2)+1]=0,U[3*(oe-1)+0]=U[3*(oe-2)+0]+V[0],U[3*(oe-1)+1]=U[3*(oe-2)+1]+V[1],U[3*(oe-1)+2]=U[3*(oe-2)+2]+V[2],W[2*(oe-1)]=1,W[2*(oe-1)+1]=1,G[3*($-2)+0]=-B[0],G[3*($-2)+1]=-B[1],G[3*($-2)+2]=-B[2],G[3*($-1)+0]=B[0],G[3*($-1)+1]=B[1],G[3*($-1)+2]=B[2]);const q=(me,Ce,Fe)=>{X[me]=Ce,ee[me]=Fe};let te=0;const ge=Ri(),Te=Ri();for(let me=0;me<C;me++){const Ce=me*(2*Math.PI/C);le(ge,Z,Math.sin(Ce)),le(Te,ce,Math.cos(Ce)),de(ge,ge,Te),G[3*me+0]=ge[0],G[3*me+1]=ge[1],G[3*me+2]=ge[2],le(ge,ge,E),de(ge,ge,Q),U[3*me+0]=ge[0],U[3*me+1]=ge[1],U[3*me+2]=ge[2],W[2*me+0]=me/C,W[2*me+1]=0,U[3*(me+C)+0]=U[3*me+0]+V[0],U[3*(me+C)+1]=U[3*me+1]+V[1],U[3*(me+C)+2]=U[3*me+2]+V[2],W[2*(me+C)+0]=me/C,W[2*me+1]=1;const Fe=(me+1)%C;q(te++,me,me),q(te++,me+C,me),q(te++,Fe,Fe),q(te++,Fe,Fe),q(te++,me+C,me),q(te++,Fe+C,Fe)}if(D){for(let me=0;me<C;me++){const Ce=(me+1)%C;q(te++,oe-2,$-2),q(te++,me,$-2),q(te++,Ce,$-2)}for(let me=0;me<C;me++){const Ce=(me+1)%C;q(te++,me+C,$-1),q(te++,oe-1,$-1),q(te++,Ce+C,$-1)}}const ke=[[M.POSITION,X],[M.NORMAL,ee],[M.UV0,X]],_e=[[M.POSITION,{size:3,data:U,exclusive:!0}],[M.NORMAL,{size:3,data:G,exclusive:!0}],[M.UV0,{size:2,data:W,exclusive:!0}]];return new Fr(_e,ke)}function p(T,E,C,A,I){C=C||10,A=A==null||A,pt(T.length>1);const D=[[0,0,0]],L=[],z=[];for(let B=0;B<C;B++){L.push([0,-B-1,-(B+1)%C-1]);const V=B/C*2*Math.PI;z.push([Math.cos(V)*E,Math.sin(V)*E])}return e.createPathExtrusionGeometry(z,T,D,L,A,I)}function f(T,E,C,A,I,D=$i(0,0,0)){const L=T.length,z=new Float32Array(E.length*L*3+(6*C.length||0)),B=new Float32Array(E.length*L*3+(C?6:0)),V=(E.length-1)*L*6+3*A.length*2,Q=new Uint32Array(V),Z=new Uint32Array(V);let ce=0,oe=0,$=0,U=0;const G=Ri(),W=Ri(),X=Ri(),ee=Ri(),q=Ri(),te=Ri(),ge=Ri(),Te=O(),ke=Ri(),_e=Ri(),me=Ri(),Ce=Ri(),Fe=Ri(),Li=Si();se(ke,0,1,0),pe(W,E[1],E[0]),we(W,W),I?(de(Te,E[0],D),we(X,Te)):se(X,0,0,1),S(W,X,ke,ke,q,X,nne),ae(ee,X),ae(Ce,q);for(let st=0;st<C.length;st++)le(te,q,C[st][0]),le(Te,X,C[st][2]),de(te,te,Te),de(te,te,E[0]),z[ce++]=te[0],z[ce++]=te[1],z[ce++]=te[2];B[oe++]=-W[0],B[oe++]=-W[1],B[oe++]=-W[2];for(let st=0;st<A.length;st++)Q[$++]=A[st][0]>0?A[st][0]:-A[st][0]-1+C.length,Q[$++]=A[st][1]>0?A[st][1]:-A[st][1]-1+C.length,Q[$++]=A[st][2]>0?A[st][2]:-A[st][2]-1+C.length,Z[U++]=0,Z[U++]=0,Z[U++]=0;let zi=C.length;const li=C.length-1;for(let st=0;st<E.length;st++){let Pr=!1;st>0&&(ae(G,W),st<E.length-1?(pe(W,E[st+1],E[st]),we(W,W)):Pr=!0,de(_e,G,W),we(_e,_e),de(me,E[st-1],ee),J2(E[st],_e,Li),ax(Li,Fu(me,G),Te)?(pe(Te,Te,E[st]),we(X,Te),ct(q,_e,X),we(q,q)):S(_e,ee,Ce,ke,q,X,nne),ae(ee,X),ae(Ce,q)),I&&(de(Te,E[st],D),we(Fe,Te));for(let Xn=0;Xn<L;Xn++)if(le(te,q,T[Xn][0]),le(Te,X,T[Xn][1]),de(te,te,Te),we(ge,te),B[oe++]=ge[0],B[oe++]=ge[1],B[oe++]=ge[2],de(te,te,E[st]),z[ce++]=te[0],z[ce++]=te[1],z[ce++]=te[2],!Pr){const Za=(Xn+1)%L;Q[$++]=zi+Xn,Q[$++]=zi+L+Xn,Q[$++]=zi+Za,Q[$++]=zi+Za,Q[$++]=zi+L+Xn,Q[$++]=zi+L+Za;for(let ma=0;ma<6;ma++)Z[U++]=Q[$-6+ma]-li}zi+=L}const Vi=E[E.length-1];for(let st=0;st<C.length;st++)le(te,q,C[st][0]),le(Te,X,C[st][1]),de(te,te,Te),de(te,te,Vi),z[ce++]=te[0],z[ce++]=te[1],z[ce++]=te[2];const hi=oe/3;B[oe++]=W[0],B[oe++]=W[1],B[oe++]=W[2];const Bi=zi-L;for(let st=0;st<A.length;st++)Q[$++]=A[st][0]>=0?zi+A[st][0]:-A[st][0]-1+Bi,Q[$++]=A[st][2]>=0?zi+A[st][2]:-A[st][2]-1+Bi,Q[$++]=A[st][1]>=0?zi+A[st][1]:-A[st][1]-1+Bi,Z[U++]=hi,Z[U++]=hi,Z[U++]=hi;const qr=[[M.POSITION,Q],[M.NORMAL,Z]],cs=[[M.POSITION,{size:3,data:z,exclusive:!0}],[M.NORMAL,{size:3,data:B,exclusive:!0}]];return new Fr(cs,qr)}function m(T,E,C){pt(T.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),pt(T[0].length===3,"createPolylineGeometry(): malformed vertex"),pt(E==null||E.length===T.length,"createPolylineGeometry: need same number of points and normals"),pt(E==null||E[0].length===3,"createPolylineGeometry(): malformed normal");const A=new Float64Array(3*T.length),I=new Uint32Array(2*(T.length-1));let D=0,L=0;for(let V=0;V<T.length;V++){for(let Q=0;Q<3;Q++)A[D++]=T[V][Q];V>0&&(I[L++]=V-1,I[L++]=V)}const z=[],B=[];if(z.push([M.POSITION,I]),B.push([M.POSITION,{size:3,data:A,exclusive:!0}]),E){const V=new Float32Array(3*E.length);let Q=0;for(let Z=0;Z<T.length;Z++)for(let ce=0;ce<3;ce++)V[Q++]=E[Z][ce];z.push([M.NORMAL,I]),B.push([M.NORMAL,{size:3,data:V,exclusive:!0}])}return C&&(B.push([M.COLOR,{size:4,data:C}]),z.push([M.COLOR,wE(C.length/4)])),new Fr(B,z,Ol.Line)}function y(T,E,C,A,I=0){const D=new Array(18),L=[[-E,I,A/2],[C,I,A/2],[0,T+I,A/2],[-E,I,-A/2],[C,I,-A/2],[0,T+I,-A/2]],z=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let B=0;B<6;B++)D[3*B]=L[B][0],D[3*B+1]=L[B][1],D[3*B+2]=L[B][2];return new Fr([[M.POSITION,{size:3,data:D,exclusive:!0}]],[[M.POSITION,z]])}function v(T,E){const C=T.getMutableAttribute(M.POSITION).data;for(let A=0;A<C.length;A+=3){const I=C[A],D=C[A+1],L=C[A+2];se(Ox,I,D,L),ze(Ox,Ox,E),C[A]=Ox[0],C[A+1]=Ox[1],C[A+2]=Ox[2]}}function w(T,E=T){const C=T.vertexAttributes,A=C.get(M.POSITION).data,I=C.get(M.NORMAL).data;if(I){const D=E.getMutableAttribute(M.NORMAL).data;for(let L=0;L<I.length;L+=3){const z=I[L+1];D[L+1]=-I[L+2],D[L+2]=z}}if(A){const D=E.getMutableAttribute(M.POSITION).data;for(let L=0;L<A.length;L+=3){const z=A[L+1];D[L+1]=-A[L+2],D[L+2]=z}}return E}function b(T,E,C,A,I){return!(Math.abs(xe(E,T))>I)&&(ct(C,T,E),we(C,C),ct(A,C,T),we(A,A),!0)}function S(T,E,C,A,I,D,L){return b(T,E,I,D,L)||b(T,C,I,D,L)||b(T,A,I,D,L)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=h,e.createTubeGeometry=p,e.createPathExtrusionGeometry=f,e.createPolylineGeometry=m,e.createExtrudedTriangle=y,e.transformInPlace=v,e.cgToGIS=w,e.makeOrthoBasisDirUp=b,e.makeOrthoBasisDirUpFallback=S}(zH||(zH={}));const nne=.99619469809,Ox=Ri(),nc=zH,vYe=fe.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class _Ye{constructor(){this.type="panoramic",this._techniqueConfig=new b4,this._passParameters=new oQ,this._readyResolver=xp(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=Ze(this._passParameters.texture),this._vao=Ze(this._vao),this._readyController=Hh(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=sm.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(fE,this._techniqueConfig);const i=t.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=ko(this._vao,"geometry"),Ap(cwe,{signal:this._readyController.signal}).then(r=>{this._passParameters.texture=new nt(i,{pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR,flipped:!0},r),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(r=>{Jr(r)||vYe.error("Unable to initialize atmosphere: image request failed",r),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const i=t.rctx,r=i.bindTechnique(this._technique,this._passParameters,t.bindParameters);bYe(one,t.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",one),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays($t.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=nc.createPolySphereGeometry(1,2,!1),r=i.indices.get(M.POSITION);for(let a=0;a<r.length;a+=3){const l=r[a];r[a]=r[a+2],r[a+2]=l}const s=i.vertexAttributes.get(M.POSITION).data,n=ane.createBuffer(r.length),o=n.position;for(let a=0;a<r.length;++a){const l=3*r[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new Hs(t,Ui,{geometry:Dc(ane)},{geometry:oi.createVertex(t,Ei.STATIC_DRAW,n.buffer)})}}function bYe(e,t){Ss(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const one=Ae(),ane=ls().vec3f(M.POSITION);var n_;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(n_||(n_={}));class VH extends Wa{constructor(){super(...arguments),this.type=n_.Rain}}u([H({count:n_.COUNT})],VH.prototype,"type",void 0);function wYe(e){const t=new Zi;return t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new El("cameraPosition")),t.vertex.uniforms.add(new El("offset")),t.vertex.uniforms.add(new Ni("width")),t.vertex.uniforms.add(new Tr("proj",(i,r)=>r.camera.projectionMatrix)),t.vertex.uniforms.add(new e_("view")),t.vertex.uniforms.add(new Ni("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(x`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===n_.Rain?x`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:x`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new Ni("opacity")),t.fragment.uniforms.add(new El("particleColor")),t.fragment.code.add(x`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===n_.Rain?x`d = 0.35 * smoothstep(0.5, 0.0, d);`:x`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const xYe=Object.freeze(Object.defineProperty({__proto__:null,build:wYe},Symbol.toStringTag,{value:"Module"}));class TYe extends Ws{constructor(){super(...arguments),this.time=0,this.radius=1}}class Og extends pr{initializeProgram(t){const i=Og.shader.get().build(this.configuration);return new sr(t.rctx,i,Og.attributeLocation)}initializePipeline(){return Bt({blending:bo(Re.ONE,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:gr.LEQUAL},colorWrite:ri})}}Og.shader=new rr(xYe,()=>import("./Precipitation.glsl.53af913c.js")),Og.attributeLocation=new Map([[M.POSITION,0],[M.INSTANCEFEATUREATTRIBUTE,1]]);class gwe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return _(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let X1=class extends Se{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=O(),this._tile=O(),this._particleColor=Ri(),this._particleColorAtNight=Ri(),this._nightMultiplier=.7,this._cameraDirection=Ri(),this._renderParameters=new TYe,this._animation=new gwe,this._updatingTracking=new zf,this._renderParameters.time=0,this._renderParameters.radius=Ci(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=Ki(this._snowTechnique),this._rainTechnique=Ki(this._rainTechnique),this._vao=Ze(this._vao),this._instanceIdBuffer=Ze(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(R(this._rainTechnique)){const e=new VH;e.type=n_.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(Og,e)}return this._rainTechnique}get snowTechnique(){if(R(this._snowTechnique)){const e=new VH;e.type=n_.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(Og,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const r=i==="rainy",s=r?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),R(s)||R(this._vao)||R(this._instanceIdBuffer)||(_(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;const o=.35;t=t<.5?Yt(0,o,2*t):Yt(o,1,2*(t-.5));const a=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(r?this._rainSpeed:this._snowSpeed)*MW(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(a,i,e),n.bindVAO(this._vao);const l=Og.attributeLocation;a.assertCompatibleVertexAttributeLocations(this._vao),VY(n,l,this._instanceIdBuffer,lne,0),n.capabilities.instancing.drawArraysInstanced($t.TRIANGLES,0,3,this._numParticles*t),BY(n,l,this._instanceIdBuffer,lne)}_update(e,t,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",r.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,i.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?se(this._particleColor,.85,.85,.85):se(this._particleColor,1,1,1),le(this._particleColorAtNight,this._particleColor,this._nightMultiplier),we(this._cameraDirection,s);const n=Math.max(0,xe(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));pn(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){R(this._vao)&&(this._vao=this._createVertexArrayObject(e)),R(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return oi.createVertex(e,Ei.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new Hs(e,Og.attributeLocation,{geometry:Dc(SYe)},{geometry:oi.createVertex(e,Ei.STATIC_DRAW,t)})}};u([d({constructOnly:!0})],X1.prototype,"context",void 0),u([d({constructOnly:!0})],X1.prototype,"view",void 0),u([d({readOnly:!0})],X1.prototype,"updating",null),u([d()],X1.prototype,"_updatingTracking",void 0),X1=u([P("esri.views.3d.environment.Precipitation")],X1);const SYe=ls().vec3f(M.POSITION),lne=Dc(ls().f32(M.INSTANCEFEATUREATTRIBUTE),1),EYe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",CYe=fe.getLogger("esri.views.3d.environment.SimpleAtmosphere"),jI=128,cne=-$H,une=0,OV=50,AYe=()=>1-511/512,RYe=xD([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class MYe{constructor(t){this.view=t,this.type="simple",this._renderData={texV:it(),silCircleCenter:O(),silCircleV1:O(),silCircleV2:O(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new oQ,this._fadeVaoCount=0,this._readyResolver=xp(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=lm(t.spatialReference);const i=Ci(t.spatialReference);this.planetRadius=i.radius,this.outerRimWidth=i.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+cne)/this.planetRadius,this.middleRimFactor=(this.planetRadius+une)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=une/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=cn(this._cameraChangeHandle),this._passParameters.texture=Ze(this._passParameters.texture),this._fadeVao=Ze(this._fadeVao),this._vao=Ze(this._vao),this._readyController=Hh(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const i=t.renderContext.rctx;this._cameraChangeHandle=ie(()=>{var n;return(n=this.view.state)==null?void 0:n.camera},()=>t.requestRender(),Us),this._vao=this._createRibbon(i),this._vaoCount=ko(this._vao,"geometry"),this._fadeVao=Xa(i),this._fadeVaoCount=ko(this._fadeVao,"geometry");const r=this.isOnMars?EYe:cwe,s=this._readyController.signal;try{const n=await Ap(r,{signal:s});fi(s),this._passParameters.texture=new nt(i,{pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){Jr(n)||CYe.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(R(this._coneTechnique)){const t=new b4;t.geometry=sm.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(fE,t)}return this._coneTechnique}get undergroundTechnique(){if(R(this._undergroundTechnique)){const t=new b4;t.geometry=sm.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(fE,t)}return this._undergroundTechnique}render(t){const i=t.bindParameters.camera;this._update(i);const r=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const s=r.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);s.setUniformMatrix4fv("proj",i.projectionMatrix),s.setUniformMatrix4fv("view",i.viewMatrix),s.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),s.setUniform3fv("silCircleV1",this._renderData.silCircleV1),s.setUniform3fv("silCircleV2",this._renderData.silCircleV2),s.setUniform2fv("texV",this._renderData.texV),s.setUniform1f("altitudeFade",this._renderData.altitudeFade),s.setUniform1f("innerScale",this._renderData.innerScale),r.bindVAO(this._vao),r.drawArrays($t.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const s=r.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);s.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),s.setUniform3fv("cameraPosition",i.eye),r.bindVAO(this._fadeVao),r.drawArrays($t.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const i=O(),r=this.planetRadius,s=Me(t.eye),n=s-r;if(n<0){const m=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=m}else this._renderData.undergroundFadeAlpha=0;const o=Math.max(OV,n),a=r+cne;this._renderData.innerScale=OYe(r+o,r,a)-1,this._renderData.altitudeFade=ybe(n),le(i,t.eye,(r+OV)/s),hne(i,t.center,t.up,r,this._renderData);const l=this._computeScreenRimWidth(t,i,t.up,this._renderData),c=AYe(),h=RYe(n);let p=this.texV0+c*this.texVScale,f=this.texV0+l*h*this.texVScale;if(n>OV){hne(t.eye,t.center,t.up,r,this._renderData);const m=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),y=De((m-1.5)/(l-1.5),0,1);p=this.texV0+y*c*this.texVScale,f=this.texV0+Yt(this.texV1,l*h,y)*this.texVScale}yi(this._renderData.texV,p,f)}_createRibbon(t){const i=new Float32Array(3+3*jI*3),r=new Uint32Array(3*jI*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<jI;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this.innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this.middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this.outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===jI-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=dne.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new Hs(t,Ui,{geometry:Dc(dne)},{geometry:oi.createVertex(t,Ei.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return de(VC,s.silCircleCenter,s.silCircleV2),le(IV,VC,this.outerRimFactor),lk(PV,i,VC,r),ine(VC,PV,t.projectionMatrix,t.viewport),ine(IV,PV,t.projectionMatrix,t.viewport),ur(VC,IV)/t.height}}function hne(e,t,i,r,s){const n=Me(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.silCircleV1,c=s.silCircleV2;return le(s.silCircleCenter,e,a/n),ct(l,e,t),Ua(l)<1&&ct(l,e,i),le(l,l,o/Me(l)),ct(c,l,e),le(c,c,o/Me(c)),o}const PV=Ae(),VC=O(),IV=O();function OYe(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const dne=ls().vec3f(M.POSITION);function hQ(e){const t=x`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=x`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function PYe(){const e=new Zi;return e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.COLOR,"vec4"),e.attributes.add(M.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new Tr("transform",(t,i)=>IYe(t,i)),new ni("viewport",(t,i)=>i.camera.fullViewport),new We("pixelRatio",(t,i)=>i.camera.pixelRatio)]),e.include(hQ),e.vertex.code.add(x`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(x`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function IYe(e,t){return Ss(Ly,t.camera.projectionMatrix),Ly[10]=24e-8-1,Ly[11]=-1,Ly[14]=(24e-8-2)*t.camera.near,Hr(Ly,Ly,t.camera.viewMatrix),Hr(Ly,Ly,e.modelMatrix)}const Ly=Ae(),$Ye=Object.freeze(Object.defineProperty({__proto__:null,build:PYe},Symbol.toStringTag,{value:"Module"}));class LYe extends Ws{constructor(){super(...arguments),this.modelMatrix=Ae()}}class cU extends pr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=cU.shader.get().build();return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:gr.LEQUAL},colorWrite:ri})}}cU.shader=new rr($Ye,()=>import("./Stars.glsl.39c19e5c.js"));const DYe=fe.getLogger("esri.views.3d.environment.Stars");let k0=class extends Se{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new LYe,this._updatingTracking=new zf}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return _(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=Hh(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=Ki(this._technique),this._vao=Ze(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),R(this._technique)||R(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays($t.POINTS,0,this._numPoints)}_ensureResources(e){if(_(this._technique)||R(Px))return;this._technique=new cU({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Px.byteLength/pne;const t=new Float32Array(Px,0,2*this._numPoints),i=new Uint8Array(Px,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type==="sun"?this.view.environment.lighting.date:null,r=>this._update(r),Rt)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=Ss(this._renderParameter.modelMatrix,kYe);X2(r,r,-i*Math.PI),Hr(r,FYe,r),X2(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=fne.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[l]),f=this._hexToRGB(NYe[p[1]]);o.set(l,0,255*f[0]),o.set(l,1,255*f[1]),o.set(l,2,255*f[2]),o.set(l,3,255),a.set(l,p[0])}return new Hs(e,Ui,{geometry:Dc(fne)},{geometry:oi.createVertex(e,Ei.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(_(Px))return null;const e=A3(async t=>{const{data:i}=await rDe("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),Px=i});return e.promise.catch(t=>{Jr(t)||DYe.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new j("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/pne;if(t%1!=0||t>5e4||t<5e3)throw new j("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([d({constructOnly:!0})],k0.prototype,"view",void 0),u([d({constructOnly:!0})],k0.prototype,"requestRender",void 0),u([d({readOnly:!0})],k0.prototype,"updating",null),u([d()],k0.prototype,"_loadDataTask",void 0),u([d()],k0.prototype,"_updatingTracking",void 0),k0=u([P("esri.views.3d.environment.Stars")],k0);const NYe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],FYe=tZ(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),kYe=tZ(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),pne=9,fne=ls().vec3f(M.POSITION).vec4u8(M.COLOR).f32(M.SIZE);let Px=null;var je;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(je||(je={}));var LR;const UYe=[Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let mne,Ca=LR=class extends Se{constructor(e){super(e),this._handles=new Nt,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(UYe,this)}destroy(){var e;this._pendingAtmosphere=lt(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=lt(this._handles),this._set("view",null)}get atmosphereType(){return _(this._pendingAtmosphere)?this._pendingAtmosphere.type:_(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!!((e=this.view.basemapTerrain)==null?void 0:e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!_(this._precipitation)&&this._precipitation.update(e)}get updating(){return _(this._pendingAtmosphere)||_(this._stars)&&this._stars.updating||_(this._clouds)&&this._clouds.running}get weatherVisible(){return Me(this.view.state.camera.eye)-Ci(this.view.spatialReference).radius<=Ch}get _stars(){var r,s;const e=this.view,t=(s=(r=e.environment)==null?void 0:r.starsEnabled)!=null?s:!1,i=this._get("_stars");return!t||R(this._context)?(lt(i),null):_(i)?i:new k0({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||R(this._context))return lt(e),null;const t=this.view,i=this._context;return _(e)&&e.context===i?e:(lt(e),new X1({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||R(this._context))return lt(e),null;if(_(e))return e;const t=this.view,i=this._context;return lt(e),new Ea({context:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||R(this._context))return lt(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=Ci(this.view.spatialReference).radius;return _(e)&&e.viewingMode===t&&e.planetRadius===r?e:(lt(e),new W1({rctx:i,viewingMode:t,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||R(this._context))return lt(e),null;if(_(e))return e;const t=this.view,i=this._context;return lt(e),new $R({context:i,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)==null?void 0:t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([jo(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),Us),ie(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),Us),ie(()=>this._stars,()=>this._setNeedsRender()),ie(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),Rt),ie(()=>this._precipitation,()=>this._setNeedsRender()),ie(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),Rt),ie(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},Us)])}uninitializeRenderContext(){this._context=null,this._atmosphere=lt(this._atmosphere),this._set("_stars",lt(this._stars)),this._set("_precipitation",lt(this._precipitation)),this._set("_clouds",lt(this._clouds)),this._set("_cloudsComposition",lt(this._cloudsComposition)),this._set("_fog",lt(this._fog))}prepareRender(e){e.bindParameters.clouds.data=ZXe(this._clouds)?this._clouds:null}render(e){if(e.pass===je.MATERIAL)switch(e.bindParameters.slot){case Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE:_(this._stars)&&this._stars.render(e),_(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),_(this._cloudsComposition)&&_(e.bindParameters.clouds.data)&&(this.weatherVisible&&_(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,_(this.view.animation))));break;case Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(_(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),_(this._fog)){const i=t==="foggy"||t==="rainy"||t==="snowy";(i||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,i,t==="rainy")}if(_(this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return R(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){R(e)||R(this._clouds)||(this._clouds.applyPreset(iwe[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){_(this._context)&&this._context.requestRender()}_updateFog(e){if(!R(this._fog)&&!R(e))switch(e.type){case"foggy":this._fog.strength=Yt(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=Yt(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;_(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return _(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);_(this._context)&&i.initializeRenderContext(this._context),R(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{_(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return jse;case"panoramic":return _Ye;case"simple":return MYe;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||t==null||cm(this.view.spatialReference)?"none":i==="local"?"panoramic":t==="high"&&_(this._context)&&jse.isSupported(this._context)&&XM(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=_(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{mne=LR.prototype._getAtmosphereClass,LR.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{LR.prototype._getAtmosphereClass=mne}}}};u([d({constructOnly:!0})],Ca.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],Ca.prototype,"updating",null),u([d({readOnly:!0})],Ca.prototype,"weatherVisible",null),u([d()],Ca.prototype,"_context",void 0),u([d()],Ca.prototype,"_pendingAtmosphere",void 0),u([d({readOnly:!0})],Ca.prototype,"_stars",null),u([d({readOnly:!0})],Ca.prototype,"_precipitation",null),u([d({readOnly:!0})],Ca.prototype,"_clouds",null),u([d({readOnly:!0})],Ca.prototype,"_cloudsComposition",null),u([d({readOnly:!0})],Ca.prototype,"_fog",null),u([d({readOnly:!0})],Ca.prototype,"weatherEnabled",null),u([d({readOnly:!0})],Ca.prototype,"_precipitationEnabled",null),u([d({readOnly:!0})],Ca.prototype,"_weatherUpdateParameters",null),Ca=LR=u([P("esri.views.3d.environment.EnvironmentRenderer")],Ca);function gne(e,t,i){return zYe(e,t.longitude,t.latitude,i.longitude,i.latitude)}function zYe(e,t,i,r,s){const n=Dt(i),o=Dt(s),a=n-o,l=Dt(t)-Dt(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*Tp(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function VYe(e,t,i){const r=t.spatialReference,s=Ci(r),n=new ot(t.x,e.y,r),o=new ot(i.x,e.y,r),a=new ot(e.x,t.y,r),l=new ot(e.x,i.y,r);return{lon:gne(s.radius,n,o),lat:gne(s.radius,a,l)}}function BYe(e,t,i){const r=t/i,s=Dt(e),n=Math.sin(r/2),o=Math.cos(s),a=2*Tp(Math.sqrt(n*n/(o*o)));return Ac(a)}function GYe(e,t){let i=e/15;return t||(i=Math.round(i)),i}function yne(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=GYe(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var vne,_ne,bne,ywe={exports:{}};vne=ywe,_ne=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function f($){return $.valueOf()/l-.5+c}function m($){return new Date(($+.5-c)*l)}function y($){return f($)-h}var v=23.4397*a;function w($,U){return n(t($)*i(v)-r(U)*t(v),i($))}function b($,U){return s(t(U)*i(v)+i(U)*t(v)*t($))}function S($,U,G){return n(t($),i($)*t(U)-r(G)*i(U))}function T($,U,G){return s(t(U)*t(G)+i(U)*i(G)*i($))}function E($,U){return a*(280.16+360.9856235*$)-U}function C($){return a*(357.5291+.98560028*$)}function A($){return a*(1.9148*t($)+.02*t(2*$)+3e-4*t(3*$))}function I($,U){return $+U+102.9372*a+e}function D($,U){var G=C($),W=I(G,A(G));return U||(U={dec:0,ra:0}),U.dec=b(W,0),U.ra=w(W,0),U}var L={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function($,U,G,W){var X=a*-G,ee=a*U,q=y($),te=D(q,p),ge=E(q,X)-te.ra;return W||(W={azimuth:0,altitude:0}),W.azimuth=S(ge,ee,te.dec),W.altitude=T(ge,ee,te.dec),W}},z=[[-.83,"sunrise","sunset"]];L.addTime=function($,U,G){z.push([$,U,G])};var B=9e-4;function V($,U){return Math.round($-B-U/(2*e))}function Q($,U,G){return B+($+U)/(2*e)+G}function Z($,U,G){return h+$+.0053*t(U)-.0069*t(2*G)}function ce($,U,G){return o((t($)-t(U)*t(G))/(i(U)*i(G)))}function oe($){var U=a*(134.963+13.064993*$),G=a*(93.272+13.22935*$),W=a*(218.316+13.176396*$)+6.289*a*t(U),X=5.128*a*t(G),ee=385001-20905*i(U);return{ra:w(W,X),dec:b(W,X),dist:ee}}return L.getTimes=function($,U,G){var W=a*-G,X=a*U,ee=V(y($),W),q=Q(0,W,ee),te=C(q),ge=A(te),Te=I(te,ge),ke=b(Te,0),_e=Z(q,te,Te);function me(Bi){return Z(Q(ce(Bi,X,ke),W,ee),te,Te)}function Ce(Bi){var qr=(t(Bi)-t(X)*t(ke))/(i(X)*i(ke));return qr<-1?L.PolarException.MIDNIGHT_SUN:qr>1?L.PolarException.POLAR_NIGHT:L.PolarException.NORMAL}var Fe,Li,zi,li,Vi,hi={solarNoon:m(_e),nadir:m(_e-.5),polarException:L.PolarException.NORMAL};for(Fe=0,Li=z.length;Fe<Li;Fe+=1)Vi=_e-((li=me((zi=z[Fe])[0]*a))-_e),hi[zi[1]]=m(Vi),hi[zi[2]]=m(li);return hi.polarException=Ce(z[0][0]*a),hi},L.getMoonPosition=function($,U,G){var W=a*-G,X=a*U,ee=y($),q=oe(ee),te=E(ee,W)-q.ra,ge=T(te,X,q.dec);return ge+=.017*a/r(ge+10.26*a/(ge+5.1*a)),{azimuth:S(te,X,q.dec),altitude:ge,distance:q.dist}},L.getMoonFraction=function($){var U=y($),G=D(U),W=oe(U),X=149598e3,ee=o(t(G.dec)*t(W.dec)+i(G.dec)*i(W.dec)*i(G.ra-W.ra)),q=n(X*t(ee),W.dist-X*i(ee));return(1+i(q))/2},L},(bne=_ne())!==void 0&&(vne.exports=bne);const kw=ywe.exports,Af={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function jYe(e,t,i,r,s,n,o){se(o.ambient.color,1,1,1),o.ambient.intensity=Af.global.ambient,se(o.direct.color,1,1,1),o.direct.intensity=Af.global.direct;const a=t[2],l=De((Math.abs(a)-Af.local.altitude)/(Af.global.altitude-Af.local.altitude),0,1);let c;if(o.globalFactor=l,n==="sun"&&(c=kw.getTimes(e,t[1],t[0])),l<1){let h;if(n==="sun")h=JYe(e,c,r);else{const p=_we(r);h={direct:{intensity:Af.local.directAtNoon*p.direct,color:Ue(1,1,1)},ambient:{intensity:Af.local.ambientAtNoon*p.ambient,color:Ue(1,1,1)},timeOfDay:"early afternoon"}}pn(o.ambient.color,h.ambient.color,o.ambient.color,l),o.ambient.intensity=Yt(h.ambient.intensity,o.ambient.intensity,l),pn(o.direct.color,h.direct.color,o.direct.color,l),o.direct.intensity=Yt(h.direct.intensity,o.direct.intensity,l),o.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,o.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}o.noonFactor=n==="sun"?QYe(e,c):1,n==="sun"?qYe(e,t,i,o.direct.directionToLightSource):HYe(s,i,o.direct.directionToLightSource)}function HYe(e,t,i){t===Ge.Global?we($V,e.eye):se($V,0,0,1),le(LV,e.viewForward,-1);const r=wD(LV,$V),s=Math.max(r-2*DV,0),n=.85*s/(s+1),o=Math.max(DV,r-DV-n);Du(xne,-o,e.viewRight),ze(i,LV,xne),de(i,i,le(KYe,e.viewRight,eQe)),we(i,i)}function qYe(e,t,i,r){const s=YYe,n=tm(ZYe);if(i===Ge.Global)kw.getPosition(e,0,0,s),se(r,0,0,-1),W2(n,n,-s.azimuth),ok(n,n,-s.altitude),ze(r,r,n);else{const o=Af.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=De(c,0,1),c<1?(kw.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),se(r,0,-1,0),X2(n,n,-s.azimuth),W2(n,n,-s.altitude),ze(r,r,n)}}function WYe(e,t){if(t===Ge.Global)return!0;const i=Af.planarDirection;return Math.abs(e)<i.localAltitude}const XYe=Ue(.5773502691896258,-.5773502691896258,.5773502691896258);class vwe{constructor(){this.ambient={color:Ue(1,1,1),intensity:.55},this.direct={color:Ue(1,1,1),intensity:.55,directionToLightSource:Vs(XYe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const ZYe=Ae(),YYe={azimuth:0,altitude:0};function QYe(e,t){const i=e.valueOf();let r,s;t.polarException===kw.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===kw.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-De(Math.abs(i-n)/432e5,0,1)}function _we(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function wne(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function JYe(e,t,i){const r=e.valueOf();let s,n;t.polarException===kw.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===kw.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,f=s-p/2,m=s+p/2,y=n-p/2,v=n+p/2,w=Af.local,b=[.01,w.ambientAtNight],S=[.8,.8,1],T=[.01,.01,.01],E=[w.directAtTwilight,w.ambientAtTwilight],C=[1,.6,.5],A=[.8,.8,1],I=[.9*w.directAtNoon,w.ambientAtNoon],D=[1,.98,.98],L=[.98,.98,1],z=[w.directAtNoon,w.ambientAtNoon],B=[1,1,1],V=[1,1,1],Q=I,Z=D,ce=L,oe=E,$=C,U=A;let G,W,X=[0,0],ee=[0,0,0],q=[0,0,0];r<f||r>v?(X=b,ee=T,q=S,W="night"):r<m?(G=m-f,X=So(r-f,G,b,E),ee=So(r-f,G,T,C),q=So(r-f,G,S,A),W="sun rising"):r<c?(G=c-m,X=So(r-m,G,E,I),ee=So(r-m,G,C,D),q=So(r-m,G,A,L),W="early morning"):r<a?(G=a-c,X=So(r-c,G,I,z),ee=So(r-c,G,D,B),q=So(r-c,G,L,V),W="late morning"):r<h?(G=h-a,X=So(r-a,G,z,Q),ee=So(r-a,G,B,Z),q=So(r-a,G,V,ce),W="early afternoon"):r<y?(G=y-h,X=So(r-h,G,Q,oe),ee=So(r-h,G,Z,$),q=So(r-h,G,ce,U),W="late afternoon"):r<v&&(G=v-y,X=So(r-y,G,oe,b),ee=So(r-y,G,$,T),q=So(r-y,G,U,S),W="sun setting");let te=0;switch(i){case"rainy":case"foggy":te=.9;case"snowy":te=.5}te>0&&(ee=wne(ee,te),q=wne(q,te));const ge=Ue(ee[0],ee[1],ee[2]),Te=Ue(q[0],q[1],q[2]),ke=_we(i);return{direct:{intensity:X[0]*ke.direct,color:ge},ambient:{intensity:X[1]*ke.ambient,color:Te},timeOfDay:W}}function So(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const xne=Ae(),$V=O(),LV=O(),KYe=O(),DV=.25,eQe=.2;let Dd=class extends as.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Nt,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new NH,this._ambientLight=new nQ,this._moonLight=new nwe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)==null?void 0:e.updating))}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(t=this._view)==null?void 0:t.state)==null?void 0:i.viewingMode)===Ge.Global&&XM(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Ca({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([ie(()=>e.environment.lighting,s=>this._updateLightingHandler(s),qi),ie(()=>e.environment.lighting.type==="sun"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),qi),ie(()=>e.stationary,()=>this._interactingStationaryHandler()),ie(()=>e.environment.lighting.directShadowsEnabled,t,qi),ie(()=>e.environment.lighting.ambientOcclusionEnabled,t,qi),ie(()=>e.environment.lighting.waterReflectionEnabled,t,qi),ie(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,qi),ie(()=>e.spatialReference,()=>this._resetReferencePosition(!0),qi),ie(()=>e.environment.weather.type,r,qi),ie(()=>this.weatherEnabled,r,qi),ie(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Us),ie(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),Us),ie(()=>e.state.camera,i,Us),ie(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=lt(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type==="sun"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!ww(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),_(this._referencePosWGS84Comparable)){const r=yne(this._referencePosWGS84Comparable,Tne);_(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=XM(this._view.spatialReference);if(i&&!ww(this._view.spatialReference))return!1;const r=e.position;return R(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=O()),i?uNe(r,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||(t.environment.lighting.type==="sun"?t.environment.lighting.date:null),r=this._referencePosWGS84Comparable,s=_(r)?tQe:iQe;if(_(r)){const h=this.weatherVisible?t.environment.weather.type:"disabled";jYe(i,r,t.state.viewingMode,h,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;le(n.intensity,o.color,o.intensity*Math.PI),ae(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;le(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;pn(l.intensity,sQe,nQe,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));le(l.intensity,l.intensity,c),ae(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||R(e))return!1;const i=rQe;i.setTime((t||this._view.environment.lighting.date).getTime());const r=yne(e,Tne);if(R(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=gu(this._referencePosWGS84Comparable,!0,s=>WYe(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof ube?{type:"color",color:iZ(Pe.toUnitRGBA(i.color))}:{type:"color",color:bi(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=P2(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=P2(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([d({type:Boolean,readOnly:!0})],Dd.prototype,"updating",null),u([d()],Dd.prototype,"disableQueries",void 0),u([d()],Dd.prototype,"_disableWeather",void 0),u([d()],Dd.prototype,"weatherEnabled",null),u([d()],Dd.prototype,"weatherVisible",null),u([d()],Dd.prototype,"referencePositionWGS84Comparable",null),u([d()],Dd.prototype,"_renderer",void 0),u([d()],Dd.prototype,"_referencePosWGS84Comparable",void 0),Dd=u([P("esri.views.3d.environment.SceneViewEnvironmentManager")],Dd);const tQe=new vwe,iQe=new vwe,rQe=new Date,Tne={hours:0,minutes:0,seconds:0},sQe=Ue(.22,.22,.33),nQe=Ue(.22,.22,.22);function GO(e,t){return(e&t)!=0}function T4(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var Gt,br,Bn;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(Gt||(Gt={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(br||(br={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(Bn||(Bn={}));const o_={selection:br.NONE,interactionType:Gt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE};function bwe(e,t,i,r){return t=t||e.viewForward,ae(r,t),le(r,r,Math.sign(xe(t,i))),r}function oQe(e,t,i,r){return hQe(e,t,i,cQe(r,t,i,!0))}function aQe(e,t,i,r){const s=xe(i,pe(e,r,t));return de(e,t,le(e,i,s))}const lQe={dir:O(),len:0,clip:it()};function cQe(e,t,i,r){const s=lQe;return e?(i&&r&&(s.len=ur(t,i)),ae(s.dir,e)):r?(s.len=ur(t,i),pe(s.dir,i,t),le(s.dir,s.dir,1/s.len)):(pe(s.dir,i,t),we(s.dir,s.dir)),s}function uQe(e,t,i){const r=xe(e,i.dir),s=-lr(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function hQe(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!uQe(e[s],t,r))return!1;return!0}function dQe(e,t,i=o_){const r=dQ(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=bwe(t,i.interactionDirection,mQe(e,t,Math.sign(r),_Qe),vQe),a=ae(bQe,t.viewForward),l=s.intersectInfiniteManifold(Fu(t.eye,o),n,NV);return t.eye=_(l)?l:s.setAltitude(NV,n,t.eye),t.center=aQe(NV,t.eye,a,t.center),!0}function dQ(e,t,i=o_){if(!pQe(e,i))return 0;const r=gQe(e.state.constraints.altitude,yQe);fQe(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=De(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function pQe(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==Gt.TUMBLE||!GO(t.selection,br.TILT))}function fQe(e,t,i){const r=t.interactionType;if(r===Gt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===Gt.TUMBLE||r===Gt.ZOOM,c=dQ(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,T4(c,h,l,a,.05*h,i)}function mQe(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),le(r,r,i),r}function gQe(e,t){return t.min=e.min,t.max=e.max,t}const yQe={min:0,max:0},vQe=O(),_Qe=O(),bQe=O(),NV=O();function pQ(e,t,i=o_){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;HI.min=0,HI.max=r,xQe(e,i,HI);const s=fQ(e,t),n=HI.max-s;return n>=-1e-6?0:n}function wQe(e,t,i=o_){const r=pQ(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=fQ(e,t)+r,o=ae(SQe,t.eye),a=bwe(t,i.interactionDirection,TQe(e,t,AQe),CQe);if(!y_(kge(s.renderLocation,n),Fu(t.eye,a),qI))return!1;t.eye=qI;const l=pe(EQe,t.eye,o);t.center=de(qI,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,qI);return _(h)&&(t.center=h),!0}function xQe(e,t,i){const r=t.interactionType;if(r===Gt.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===Gt.ZOOM||r===Gt.PAN,c=pQ(e,o),h=c===0?0:fQ(e,o);i.min=s,i.max=n,T4(c,h,l,a,.05*h,i)}function fQ(e,t){const i=e.pointsOfInterest.surfaceOrigin;return ur(t.eye,i.renderLocation)}function TQe(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return uy(i,t.eye,r.renderLocation)}const HI={min:0,max:0},SQe=O(),EQe=O(),CQe=O(),AQe=O(),qI=O();var Vr,vo;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(Vr||(Vr={}));class RQe{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=vo.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(vo||(vo={}));function _m(e){return _(e)&&_(e.dist)}function Sne(e){return(t,i,r)=>(pn(Ene,t,i,r),!hZ(e,Ene))}function uU(e){return _m(e)&&e.intersector===Vr.OBJECT&&!!e.target}function hU(e){return _m(e)&&e.intersector===Vr.HUD&&!!e.target&&_(e.target.center)}const Ene=O();class MQe{constructor(){this._transform=Ae(),this._transformInverse=new WI({value:this._transform},_s,Ae),this._transformInverseTranspose=new WI(this._transformInverse,Dl,Ae),this._transformTranspose=new WI({value:this._transform},Dl,Ae),this._transformInverseRotation=new WI({value:this._transform},Xbe,Or)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){Ss(this._transform,t)}multiplyTransform(t){Hr(this._transform,this._transform,t)}set(t){Ss(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class WI{constructor(t,i,r){this.original=t,this.update=i,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class OQe{constructor(t=0){this.offset=t,this.tmpVertex=O()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)Dy[n]=t[0+n]+this.localOrigin[n],XI[n]=t[3+n]+this.localOrigin[n],Ix[n]=Dy[n];const i=this.applyToVertex(Dy[0],Dy[1],Dy[2]);for(let n=0;n<3;++n)t[n]=i[n],t[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)Ix[o]=(n&1<<o)==0?Dy[o]:XI[o];r(Ix)}let s=0;for(let n=0;n<3;++n)Dy[n]*XI[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?Ix[o]=0:Ix[o]=(n&1<<o)!=0?Dy[o]:XI[o];r(Ix)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const Dy=O(),XI=O(),Ix=O();class PQe{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=O(),this._mbs=En(),this._obb={center:O(),halfSize:Ri(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=i<0?this._totalOffset:0,t[1]-=r<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const f=Math.max(Math.abs(i),Math.abs(n)),m=Math.max(Math.abs(r),Math.abs(o)),y=Math.max(Math.abs(s),Math.abs(a)),v=Math.sqrt(f*f+m*m+y*y),w=this._totalOffset/v,b=this._totalOffset/p;return t[0]+=i*(i>0?w:b),t[1]+=r*(r>0?w:b),t[2]+=s*(s>0?w:b),t[3]+=n*(n<0?w:b),t[4]+=o*(o<0?w:b),t[5]+=a*(a<0?w:b),t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this._totalOffset/i;return this._mbs[0]=t[0]+t[0]*r,this._mbs[1]=t[1]+t[1]*r,this._mbs[2]=t[2]+t[2]*r,this._mbs[3]=t[3]+t[3]*this._totalOffset/i,this._mbs}applyToObb(t){const i=t.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,Au(this._obb.halfSize,t.halfSize,t.quaternion),de(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,pe(this._obb.halfSize,this._obb.halfSize,t.center),oy(Mne,t.quaternion),Au(this._obb.halfSize,this._obb.halfSize,Mne),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class IQe{constructor(t=0){this.offset=t,this.sphere=En(),this.tmpVertex=O()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],o=s[1]*t+s[5]*i+s[9]*r+s[13],a=s[2]*t+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const Cne=new IQe;function BH(e){return _(e)?(Cne.offset=e,Cne):null}const Ane=new PQe;function $Qe(e){return _(e)?(Ane.offset=e,Ane):null}const Rne=new OQe;function LQe(e){return _(e)?(Rne.offset=e,Rne):null}const tp="terrain",Mne=fy();function GH(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function DQe(e,t){const i=e.length;for(let r=0;r<i;++r)NS[0]=e[r],t[r]=NS[0];return t}function NQe(e,t){const i=e.length;for(let r=0;r<i;++r)NS[0]=e[r],NS[1]=e[r]-NS[0],t[r]=NS[1];return t}const NS=new Float32Array(2);function jH(e,t){return R(e)&&(e=[]),e.push(t),e}function HH(e,t){if(R(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function eP(e){return!!_(e)&&!e.visible}function FQe(e,t,i){const r=e.origin.vec3;hwe(FV,-r[0],-r[1],-r[2]),_(e.transformation)?Hr(t,FV,e.transformation):Ss(t,FV),i&&(_s(i,t),Dl(i,i))}function kQe(e,t,i,r,s){ZI[0]=e.get(t,0),ZI[1]=e.get(t,1),ZI[2]=e.get(t,2),GH(ZI,F_,3),i.set(s,0,F_[0]),r.set(s,0,F_[1]),i.set(s,1,F_[2]),r.set(s,1,F_[3]),i.set(s,2,F_[4]),r.set(s,2,F_[5])}const ZI=new Float64Array(3),F_=new Float32Array(6),FV=Ae(),xE=1e-5;class UQe{constructor(t){this.options=new RQe,this._results=new zQe,this.transform=new MQe,this.tolerance=xE,this.verticalOffset=null,this._ray=fo(),this._rayEnd=O(),this._rayBeginTransformed=O(),this._rayEndTransformed=O(),this.viewingMode=t==null?Ge.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(kNe(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&IF(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ge.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,de(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r==null?xE:r;const o=BH(this.verticalOffset);if(_(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();_(c)?(_(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const i=t.geometryRecords;if(!i)return;const r=t.transformation,s=BH(this.verticalOffset);for(const n of i){const{geometry:o,material:a,instanceParameters:l}=n;if(eP(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(r,n.getShaderTransformation()),ze(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),ze(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;_(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,f,m,y,v,w)=>{if(p>=0){if(_(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const b=y?this._results.hud:this._results,S=y?T=>{const E={object:t,geometryId:c,triangleNr:m,center:_(w)?[w[0],w[1],w[2]]:null};T.set(Vr.HUD,E,p,f,hn,v)}:T=>T.set(Vr.OBJECT,{object:t,geometryId:c,triangleNr:m},p,f,h,v);if((b.min.drapedLayerOrder==null||v>=b.min.drapedLayerOrder)&&(b.min.dist==null||p<b.min.dist)&&S(b.min),this.options.store!==vo.MIN&&(b.max.drapedLayerOrder==null||v<b.max.drapedLayerOrder)&&(b.max.dist==null||p>b.max.dist)&&S(b.max),this.options.store===vo.ALL)if(y){const T=new qH(this._ray);S(T),this._results.hud.all.push(T)}else{const T=new u2(this._ray);S(T),this._results.all.push(T)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((i,r)=>i.dist!==r.dist?vt(i.dist,0)-vt(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?vt(i.drapedLayerOrder,Number.MAX_VALUE)-vt(r.drapedLayerOrder,Number.MAX_VALUE):vt(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-vt(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function ed(e){return new UQe(e)}class zQe{constructor(){this.min=new u2(fo()),this.max=new u2(fo()),this.hud={min:new qH(fo()),max:new qH(fo()),all:new Array},this.ground=new u2(fo()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class u2{constructor(t){this.intersector=Vr.OBJECT,this.normal=O(),this.transformation=Ae(),this._ray=fo(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return _(this.dist)?(le(YI,this.ray.direction,this.dist),Me(YI)):null}getIntersectionPoint(t){return!!_m(this)&&(le(YI,this.ray.direction,this.dist),de(t,this.ray.origin,YI),!0)}getTransformedNormal(t){return ae(BC,this.normal),BC[3]=0,Eu(BC,BC,this.transformation),ae(t,BC),we(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Vr.OBJECT,IF(t,this._ray)}set(t,i,r,s,n,o,a){this.intersector=t,this.dist=r,ae(this.normal,vt(s,ppe)),Ss(this.transformation,vt(n,hn)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){IF(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,ae(this.normal,t.normal),Ss(this.transformation,t.transformation)}}class qH extends u2{constructor(){super(...arguments),this.intersector=Vr.HUD}}function mQ(e){return new u2(e)}const YI=O(),BC=Xt();function wwe(e,t,i,r){return _(e.renderCoordsHelper.fromRenderCoords(t.eye,S4,r))&&Npe(i,S4)}function dU(e,t){return e.elevationProvider?vt(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function px(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),VQe(e,s.ray,Ny)||ae(Ny,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(Sn(s.eye,Ny)<o){const a=n.collision.enabled;ae(k_,s.viewForward),le(k_,k_,o),a?s.eye=pe(S4,Ny,k_):de(Ny,s.eye,k_);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(pe(k_,Ny,s.eye),s.eye=l.setAltitude(S4,h,s.eye),de(Ny,s.eye,k_))}return s.center=Ny,s}function One(e,t,i){if(!e.state.isGlobal)return!1;const r=dU(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,GQe),o=n*n;return Sn(t,i)>o}function VQe(e,t,i){let r=Pne[e.viewingMode];r||(r=ed(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Pne[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||One(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||One(e,t.origin,i))||!!s&&BQe(t,i,Ci(e.spatialReference).radius)}function BQe(e,t,i){const r=xe(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return le(t,e.direction,s/Me(e.direction)),de(t,t,e.origin),!0}const Pne={},S4=O(),Ny=O(),k_=O(),GQe={near:0,far:0};function lC(e,t,i=Bh.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=dU(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=Me(t.eye);if(pe(QI,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(jQe,o,t.eye),i===Bh.EYE_AND_CENTER)t.center=de(QI,t.eye,QI);else if(i===Bh.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=le(QI,t.center,l)}return!0}var Bh;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Bh||(Bh={}));const QI=O(),jQe=O();function a_(e,t,i){e.worldUpAtPosition(t,Ine),pe(kV,i,t);const r=Me(kV);return r===0?0:fn(xe(kV,Ine)/r)}const Ine=O(),kV=O();function xwe(e,t,i=o_,r=!0){GC.eyeCenterDistance=0,GC.requiresTwoSteps=!1;const s=gQ(e,t,i,void 0,GC);if(s===0)return!1;switch(Du(JI,-s,t.viewRight),i.tiltMode){case Bn.LOOK_AROUND:ze(Fy,t.viewForward,JI),le(Fy,Fy,GC.eyeCenterDistance),t.center=de(ov,t.eye,Fy);break;case Bn.TUMBLE:pe(Fy,t.center,t.eye),ze(Fy,Fy,JI),t.eye=pe(ov,t.center,Fy);break;default:i.tiltMode}return t.up=ze(ov,t.up,JI),!GC.requiresTwoSteps||!r||xwe(e,t,i,!1)}function gQ(e,t,i=o_,r=o_,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,eJe);return KQe(e,i,o),r.interactionType===Gt.TUMBLE&&GO(r.selection,br.ALTITUDE)&&Twe(e,r.interactionStartCamera,o),i.tiltMode===Bn.LOOK_AROUND||r.tiltMode===Bn.LOOK_AROUND?qQe(e,t,o,s):HQe(e,t,o)}function HQe(e,t,i){const r=a_(e.renderCoordsHelper,t.center,t.eye),s=r-De(r,i.min,i.max);return jO(s)?s:0}function qQe(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return XQe(e,t,i,r);case"local":return WQe(e,t,i,r);default:return void(e.viewingMode,void 0)}}function WQe(e,t,i,r){const s=a_(e.renderCoordsHelper,t.center,t.eye),n=De(s,i.min,i.max),o=s-n;if(!jO(o))return 0;if(r){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function XQe(e,t,i,r){const s=ZQe(e,t,tJe),n=De(s.tiltAtCenter,i.min,i.max);if(!jO(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=YQe(s),a=QQe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=JQe(s,o)),r&&(r.eyeCenterDistance=WH(s,o)),a}function ZQe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+Ci(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,ov);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,_(n)?(i.eyeCenterDistance=ur(t.eye,n),i.tiltAtCenter=a_(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=a_(e.renderCoordsHelper,t.center,t.eye):(ZE(dk(pk,s),t.ray,ov),i.eyeCenterDistance=ur(t.eye,ov),i.tiltAtCenter=fn(-xe(t.viewForward,we(ov,ov)))),i.radius=s,i.eyeRadius=Me(t.eye),i.constraints=e.state.constraints,i}function jO(e){return Math.abs(e)>1e-9}function YQe(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=WH(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&jO(n-s);){const l=(s+n)/2,c=WH(e,l);jO(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function WH(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-De(t,0,Math.PI),r=Tp(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function QQe(e,t){const i=Tp(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=Tp(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function JQe(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function KQe(e,t,i){if(t.interactionType===Gt.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:o}=i,a=gQ(e,r,o_,t),l=a===0?0:a_(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===Gt.TUMBLE?(GO(t.selection,br.ALTITUDE)&&Twe(e,r,i),T4(a,l,!0,s,$ne,i)):T4(a,l,!1,s,$ne,i)}function Twe(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=Ua(t.center),n=Math.sqrt(s),o=t.distance,a=Ci(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-fn(p),i.max)),i.max=Math.min(i.max,Math.PI-fn(h))}const Fy=O(),JI=Ae(),ov=O(),$ne=Dt(5),eJe={min:0,max:0},tJe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},GC={eyeCenterDistance:0,requiresTwoSteps:!1};function iJe(e){return e}const pU=e=>e*e,yQ=e=>1-pU(1-e),rJe=e=>e<.5?pU(2*e)/2:(yQ(2*(e-.5))+1)/2,vQ=e=>e*e*e,Swe=e=>1-vQ(1-e),Ewe=e=>e<.5?vQ(2*e)/2:(Swe(2*(e-.5))+1)/2,_Q=e=>e*e*e*e,Cwe=e=>1-_Q(1-e),sJe=e=>e<.5?_Q(2*e)/2:(Cwe(2*(e-.5))+1)/2,bQ=e=>e*e*e*e*e,Awe=e=>1-bQ(1-e),nJe=e=>e<.5?bQ(2*e)/2:(Awe(2*(e-.5))+1)/2,wQ=e=>1-Math.cos(e*Math.PI/2),Rwe=e=>1-wQ(1-e),oJe=e=>e<.5?wQ(2*e)/2:(Rwe(2*(e-.5))+1)/2,xQ=e=>2**(10*(e-1)),tP=e=>1-xQ(1-e),aJe=e=>e<.5?xQ(2*e)/2:(tP(2*(e-.5))+1)/2,TQ=e=>-(Math.sqrt(1-e*e)-1),Mwe=e=>1-TQ(1-e),lJe=e=>e<.5?TQ(2*e)/2:(Mwe(2*(e-.5))+1)/2;function rd(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function sd(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const cJe=sd(rd(1),1),uJe=sd(rd(1),0),Owe=sd(rd(1),.5),hJe=sd(rd(2),1),dJe=sd(rd(2),0),pJe=sd(rd(2),.5),fJe=sd(rd(3),1),mJe=sd(rd(3),0),gJe=sd(rd(3),.5),yJe=sd(rd(4),1),vJe=sd(rd(4),0),_Je=sd(rd(4),.5),bJe={linear:iJe,"in-quad":pU,"out-quad":yQ,"in-out-quad":rJe,"in-coast-quad":cJe,"out-coast-quad":uJe,"in-out-coast-quad":Owe,"in-cubic":vQ,"out-cubic":Swe,"in-out-cubic":Ewe,"in-coast-cubic":hJe,"out-coast-cubic":dJe,"in-out-coast-cubic":pJe,"in-quart":_Q,"out-quart":Cwe,"in-out-quart":sJe,"in-coast-quart":fJe,"out-coast-quart":mJe,"in-out-coast-quart":gJe,"in-quint":bQ,"out-quint":Awe,"in-out-quint":nJe,"in-coast-quint":yJe,"out-coast-quint":vJe,"in-out-coast-quint":_Je,"in-sine":wQ,"out-sine":Rwe,"in-out-sine":oJe,"in-expo":xQ,"out-expo":tP,"in-out-expo":aJe,"in-circ":TQ,"out-circ":Mwe,"in-out-circ":lJe};function ys(e,t,i=SJe,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let a=0;a<EJe;a++){let l=0;for(const c of TJe)if(GO(i.selection,c.type)){const h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=GO(i.selection,br.COLLISION),o=wJe(i.interactionType,e);return n&&lC(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function wJe(e,t){switch(e){case Gt.PAN:return Bh.EYE_AND_CENTER;case Gt.ASCEND:return t.state.isGlobal?Bh.EYE_AND_CENTER_SCALE:Bh.EYE_AND_CENTER;default:return Bh.EYE}}function Qd(e,t){const i=typeof e=="number"?e:NY(e,t),r=Math.min(1,i/150);return Ewe(r)}function xJe(e,t,i){return gQ(e,t,i)*t.distance}const TJe=[{type:br.TILT,error:xJe,apply:xwe},{type:br.ALTITUDE,error:dQ,apply:dQe},{type:br.DISTANCE,error:pQ,apply:wQe}],SJe={selection:br.ALL,interactionType:Gt.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE},EJe=5,kc=O(),zl=O(),ky=O(),Zo=O(),U_=O(),CJe=O(),Uc={upward:Ue(0,0,1),forward:Ue(0,1,0),sideway:Ue(1,0,0)},Lne=Or();class Dne{constructor(t=Ge.Global){this.viewingMode=t,this.center=O(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Vs(Uc.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ge.Global){const n=(Me(this.center)+Me(t.center))/2;i.pan=wD(this.center,t.center)*n}else i.pan=ur(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===Ge.Global?iFe(t.center,i.center,r.pan,this.center):pn(this.center,t.center,i.center,r.pan),this.distance=Yt(t.distance,i.distance,r.zoom),this.pitch=Yt(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=Yt(s,n,r.rotate)}copyFrom(t){ae(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,ae(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,Lne);ae(this.center,t.center),pe(Zo,t.center,t.eye),mc(Zo,Zo,i),mc(U_,t.up,i),this.distance=Me(Zo),Zo[0]/=this.distance,Zo[1]/=this.distance,Zo[2]/=this.distance,this.pitch=this._eyeUpToPitch(Zo),this.yaw=this._eyeUpToYaw(Zo,U_),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,Lne);Jh(i,i),this._axisAngleVec3(Uc.sideway,this.pitch-Math.PI/2,Uc.forward,Zo),this._axisAngleVec3(Uc.upward,this.yaw,Zo),this._axisAngleVec3(Uc.sideway,this.pitch-Math.PI/2,Uc.upward,U_),this._axisAngleVec3(Uc.upward,this.yaw,U_),le(Zo,Zo,this.distance),mc(Zo,Zo,i),mc(U_,U_,i),t.center=this.center,t.eye=pe(Zo,this.center,Zo),t.up=U_}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return le(kc,r,n),ct(zl,t,r),le(zl,zl,o),le(ky,t,(1-n)*xe(t,r)),de(s,de(s,kc,zl),ky)}_lookAtOrientation(t,i=Or()){return this._upAtLookAt(t,ky),ct(kc,this.lookAtDirection,ky),we(kc,kc),kc[0]===0&&kc[1]===0&&kc[2]===0&&ae(kc,Uc.sideway),ct(zl,ky,kc),we(zl,zl),i[0]=kc[0],i[1]=zl[0],i[2]=ky[0],i[3]=kc[1],i[4]=zl[1],i[5]=ky[1],i[6]=kc[2],i[7]=zl[2],i[8]=ky[2],i}_upAtLookAt(t,i){return this.viewingMode===Ge.Local?ae(i,Uc.upward):we(i,t)}_eyeUpToPitch(t){return Math.PI-wD(Uc.upward,t)}_eyeUpToYaw(t,i){const r=CJe;return Math.abs(i[2])<.5?(ae(r,i),t[2]>0&&le(r,r,-1)):ae(r,t),ct(zl,r,Uc.upward),we(zl,zl),wD(Uc.sideway,zl,Uc.upward)}}function SQ(e){return e?{ray:fo(e.ray),c0:e.c0,c1:e.c1}:{ray:fo(),c0:0,c1:Number.MAX_VALUE}}function AJe(e,t=SQ()){return IF(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function RJe(e,t,i=SQ()){const r=Me(e.vector);return Fge(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function yEt(e,t){return Pwe(e,e.c0,t)}function vEt(e,t){return Pwe(e,e.c1,t)}function Pwe(e,t,i){return de(i,e.ray.origin,le(i,e.ray.direction,t))}new py(()=>({c0:0,c1:0,ray:null}));function HO(e){return e?[Si(e[0]),Si(e[1]),Si(e[2]),Si(e[3]),Si(e[4]),Si(e[5])]:[Si(),Si(),Si(),Si(),Si(),Si()]}function Iwe(){return[O(),O(),O(),O(),O(),O(),O(),O()]}function E4(e,t){for(let i=0;i<ly.NUM;i++)fk(e[i],t[i])}function $we(e,t,i,r=LJe){const s=Hr(sZ.get(),t,e);_s(s,s);for(let n=0;n<XH.NUM;++n){const o=Eu(rZ.get(),$Je[n],s);se(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Lwe(i,r)}function Lwe(e,t){na(t[Je.FAR_BOTTOM_LEFT],t[Je.NEAR_BOTTOM_LEFT],t[Je.NEAR_TOP_LEFT],e[ar.LEFT]),na(t[Je.NEAR_BOTTOM_RIGHT],t[Je.FAR_BOTTOM_RIGHT],t[Je.FAR_TOP_RIGHT],e[ar.RIGHT]),na(t[Je.FAR_BOTTOM_LEFT],t[Je.FAR_BOTTOM_RIGHT],t[Je.NEAR_BOTTOM_RIGHT],e[ar.BOTTOM]),na(t[Je.NEAR_TOP_LEFT],t[Je.NEAR_TOP_RIGHT],t[Je.FAR_TOP_RIGHT],e[ar.TOP]),na(t[Je.NEAR_BOTTOM_LEFT],t[Je.NEAR_BOTTOM_RIGHT],t[Je.NEAR_TOP_RIGHT],e[ar.NEAR]),na(t[Je.FAR_BOTTOM_RIGHT],t[Je.FAR_BOTTOM_LEFT],t[Je.FAR_TOP_LEFT],e[ar.FAR])}function Cv(e,t){for(let i=0;i<ly.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function MJe(e,t){return Nwe(e,AJe(t,Fwe.get()))}function _Et(e,t){for(let i=0;i<ly.NUM;i++){const r=e[i];if(!uFe(r,t))return!1}return!0}function OJe(e,t,i){return Nwe(e,RJe(t,i,Fwe.get()))}function Dwe(e,t){for(let i=0;i<ly.NUM;i++)if(lr(e[i],t)>0)return!1;return!0}function PJe(e,t){for(let i=0;i<ly.NUM;i++)if(lFe(e[i],t))return!1;return!0}function Nwe(e,t){for(let i=0;i<ly.NUM;i++)if(!cFe(e[i],t))return!1;return!0}var ar,Je;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(ar||(ar={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Je||(Je={}));const IJe={bottom:[Je.FAR_BOTTOM_RIGHT,Je.NEAR_BOTTOM_RIGHT,Je.NEAR_BOTTOM_LEFT,Je.FAR_BOTTOM_LEFT],near:[Je.NEAR_BOTTOM_LEFT,Je.NEAR_BOTTOM_RIGHT,Je.NEAR_TOP_RIGHT,Je.NEAR_TOP_LEFT],far:[Je.FAR_BOTTOM_RIGHT,Je.FAR_BOTTOM_LEFT,Je.FAR_TOP_LEFT,Je.FAR_TOP_RIGHT],right:[Je.NEAR_BOTTOM_RIGHT,Je.FAR_BOTTOM_RIGHT,Je.FAR_TOP_RIGHT,Je.NEAR_TOP_RIGHT],left:[Je.FAR_BOTTOM_LEFT,Je.NEAR_BOTTOM_LEFT,Je.NEAR_TOP_LEFT,Je.FAR_TOP_LEFT],top:[Je.FAR_TOP_LEFT,Je.NEAR_TOP_LEFT,Je.NEAR_TOP_RIGHT,Je.FAR_TOP_RIGHT]};var ly,XH;(function(e){e[e.NUM=6]="NUM"})(ly||(ly={})),function(e){e[e.NUM=8]="NUM"}(XH||(XH={}));const $Je=[bi(-1,-1,-1,1),bi(1,-1,-1,1),bi(1,1,-1,1),bi(-1,1,-1,1),bi(-1,-1,1,1),bi(1,-1,1,1),bi(1,1,1,1),bi(-1,1,1,1)],Fwe=new py(SQ),LJe=Iwe(),DJe=fe.getLogger("esri.views.3d.webgl-engine.lib.Camera");class tr{constructor(t=null,i=null,r=null){this._viewUp=O(),this._viewForward=O(),this._viewRight=O(),this._ray=fo(),this._viewport=bi(0,0,1,1),this._padding=bi(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Di(1,1e3),this._viewDirty=!0,this._viewMatrix=Ae(),this._projectionDirty=!0,this._projectionMatrix=Ae(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ae(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ae(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=HO(),this._fullViewport=Xt(),this._pixelRatio=1,this.relativeElevation=0,_(t)&&ae(this._ray.origin,t),this._center=_(i)?Vs(i):O(),this._up=_(r)?Vs(r):Ue(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return pe(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Ss(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[At.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[At.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[At.RIGHT]+this._padding[At.LEFT]}set fullWidth(t){this.width=t-(this._padding[At.RIGHT]+this._padding[At.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[At.TOP]+this._padding[At.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[At.TOP]+this._padding[At.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[At.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[At.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[At.TOP]===t[At.TOP]&&this._padding[At.RIGHT]===t[At.RIGHT]&&this._padding[At.BOTTOM]===t[At.BOTTOM]&&this._padding[At.LEFT]===t[At.LEFT]||(this._viewport[0]+=t[At.LEFT]-this._padding[At.LEFT],this._viewport[1]+=t[At.BOTTOM]-this._padding[At.BOTTOM],this._viewport[2]-=t[At.RIGHT]+t[At.LEFT]-(this._padding[At.RIGHT]+this._padding[At.LEFT]),this._viewport[3]-=t[At.TOP]+t[At.BOTTOM]-(this._padding[At.TOP]+this._padding[At.BOTTOM]),sp(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Hr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,r=this.near*Math.tan(this.fovY/2),s=r*this.aspect;Hme(this._projectionMatrix,-s*(1+2*this._padding[At.LEFT]/t),s*(1+2*this._padding[At.RIGHT]/t),-r*(1+2*this._padding[At.BOTTOM]/i),r*(1+2*this._padding[At.TOP]/i),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return R(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Ae()),this._inverseProjectionDirty&&_s(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){Ss(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return pYe(this._fov,this.width,this.height)}set fovX(t){this._fov=hYe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return fYe(this._fov,this.width,this.height)}set fovY(t){this._fov=dYe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return ur(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(_s(this._viewInverseTransposeMatrix,this.viewMatrix),Dl(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){ae(this._ray.origin,t.eye),ae(this._center,t.center),ae(this._up,t.up),sp(this._viewport,t.viewport),sp(this._padding,t.padding),_o(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(Ss(this._viewMatrix,t.viewMatrix),ae(this._viewRight,t.viewRight),ae(this._viewUp,t.viewUp),ae(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(Ss(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(E4(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Ss(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),sp(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new tr().copyFrom(this)}equals(t){return Tl(this.eye,t.eye)&&Tl(this._center,t.center)&&Tl(this._up,t.up)&&JM(this._viewport,t.viewport)&&JM(this._padding,t.padding)&&mbe(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const i=5e-4,r=1-1e-10;Cc(Yo,t.eye,t.center),Cc(UV,this.eye,this._center);const s=xe(Yo,UV),n=v9(Yo),o=v9(UV);return s*s>=r*n*o&&XW(t.eye,this.eye)<Math.max(n,o)*i*i&&fF(t.padding,this._padding)<.5&&fF(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(cM(this.viewForward,pe(Yo,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=Yr()){return t[0]=(this.padding[At.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[At.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,i=.5,r=.5){return t[0]=this.padding[At.LEFT]+this.width*i,t[1]=this.padding[At.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const i=this.viewport,r=this.padding;t.setViewport(i[0]-r[3],i[1]-r[2],i[2]+r[1]+r[3],i[3]+r[0]+r[2])}applyProjection(t,i){t!==Ht&&ae(Ht,t),Ht[3]=1,Eu(Ht,Ht,this.projectionMatrix);const r=Math.abs(Ht[3]);le(Ht,Ht,1/r);const s=this.fullViewport;i[0]=Yt(0,s[0]+s[2],.5+.5*Ht[0]),i[1]=Yt(0,s[1]+s[3],.5+.5*Ht[1]),i[2]=.5*(Ht[2]+1),i[3]=r}unapplyProjection(t,i){const r=this.fullViewport;Ht[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Ht[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Ht[2]=(2*t[2]-1)*t[3],Ht[3]=t[3],Eu(Ht,Ht,this.inverseProjectionMatrix),i[0]=Ht[0],i[1]=Ht[1],i[2]=Ht[2]}projectToScreen(t,i){this.projectToRenderScreen(t,zV),this.renderToScreen(zV,i)}projectToRenderScreen(t,i){if(Ht[0]=t[0],Ht[1]=t[1],Ht[2]=t[2],Ht[3]=1,Eu(Ht,Ht,this.viewProjectionMatrix),Ht[3]===0)return null;le(Ht,Ht,1/Math.abs(Ht[3]));const r=this.fullViewport;return"x"in i?(i.x=Yt(0,r[0]+r[2],.5+.5*Ht[0]),i.y=Yt(0,r[1]+r[3],.5+.5*Ht[1])):(i[0]=Yt(0,r[0]+r[2],.5+.5*Ht[0]),i[1]=Yt(0,r[1]+r[3],.5+.5*Ht[1]),i.length>2&&(i[2]=.5*(Ht[2]+1))),i}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,zV),i)}unprojectFromRenderScreen(t,i){if(Hr(KI,this.projectionMatrix,this.viewMatrix),!_s(KI,KI))return null;const r=this.fullViewport;return Ht[0]=2*(t[0]-r[0])/r[2]-1,Ht[1]=2*(t[1]-r[1])/r[3]-1,Ht[2]=2*t[2]-1,Ht[3]=1,Eu(Ht,Ht,KI),Ht[3]===0?null:(i[0]=Ht[0]/Ht[3],i[1]=Ht[1]/Ht[3],i[2]=Ht[2]/Ht[3],i)}constrainWindowSize(t,i,r,s=r){const n=t*this._pixelRatio,o=i*this._pixelRatio,a=Math.max(n-r/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-r/2,0),h=-Math.min(this.fullHeight-o-s/2,0);return[a,l,r-c- -Math.min(this.fullWidth-n-r/2,0),s-h- -Math.min(o-s/2,0)]}computeUp(t){t===Ge.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,i){const r=t[0]*this._pixelRatio,s=this.fullHeight-t[1]*this._pixelRatio;return i[0]=r,i[1]=s,i}renderToScreen(t,i){const r=t[0]/this._pixelRatio,s=(this.fullHeight-t[1])/this._pixelRatio;i[0]=r,i[1]=s}_computeUpGlobal(){pe(Yo,this.center,this.eye);const t=Me(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty()):Math.abs(xe(Yo,this.center))>.9999*Me(Yo)*t||(ct(this._up,Yo,this.center),ct(this._up,this._up,Yo),we(this._up,this._up),this._markViewDirty())}_computeUpLocal(){uy(Yo,this.eye,this.center),Math.abs(Yo[2])<=.9999&&(le(Yo,Yo,Yo[2]),se(this._up,-Yo[0],-Yo[1],1-Yo[2]),we(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,i){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?Tl(t,i)||(ae(i,t),this._markViewDirty()):DJe.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&($we(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(lk(this._viewMatrix,this.eye,this._center,this._up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const Ht=Xt(),KI=Ae(),Yo=O(),UV=O(),zV=Fo();var At;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(At||(At={}));const C4={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class EQ{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:C4.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new EQ(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:C4.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class NJe{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,i)=>t+i.time,0)}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),t*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){i=this.segmentInterpolateComponentsAt(a,t/a.time,i),n.hasPan?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1;const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?i.zoom=(c-h)/(p-h):i.zoom=1,i}t-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,i,r){return t.interpolateComponentsAt(i,r)}}class VV{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function FJe(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function kJe(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function UJe(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function zJe(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function VJe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function BJe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function GJe(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function jJe(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function HJe(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function qJe(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function WJe(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function XJe(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function ZJe(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function YJe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function QJe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function JJe(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function KJe(e,t){let i=eKe(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?zJe:FJe,a=s?VJe:kJe,l=s?BJe:UJe,c=n?ZJe:qJe,h=n?YJe:WJe,p=n?QJe:XJe,f=E=>o(e,E,r)+GJe(e,E,r)+c(e,E,r),m=E=>a(e,E,r)+jJe(e,E,r)+h(e,E,r),y=E=>l(e,E,r)+HJe(e,E,r)+p(e,E,r);let v=f(i);const w=JJe(e);let b;const S=t.maximumIterations||20,T=t.maximumDistance!=null?t.maximumDistance:1/0;for(b=0;b<S;b++){const C=(m(i)+1e-6)/y(i);if(isNaN(C)||i>=T&&C<0){if(!isFinite(T))return null;i=T,v=f(i);break}if(i-=C,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const A=f(i);if(Math.abs(A-v)/v<=.005)break;v=A}return v>w*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function eKe(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class tKe extends NJe{constructor(t,i){super(),this._preallocSegments=[new VV,new VV,new VV],this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=KJe(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=yQ(r.zoom):t===this._descensionSegment&&(r.zoom=pU(r.zoom)),r}_updateWithApex(t,i){const[r,s,n]=this._preallocSegments,o=i.ascensionFactor!=null?i.ascensionFactor:.5,a=Math.min(1-o,i.ascensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const iKe={zoom:0,pan:0,rotate:0};class rKe{constructor(t){this.createCamera=t,this._time=0,this.definition=new EQ(t),this.path=new tKe}get time(){return this._time}update(t,i,r){this.definition.update(t,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(hde(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?Owe:tP}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const r=this.path.interpolateComponentsAt(t,iKe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(t){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(t,this._time)-i)/(r-i)}_applyTimeSettings(t,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?t=i.duration:i.speedFactor!=null&&(t=t/r);const s=i.minDuration!=null?i.minDuration:C4.minDuration/r,n=i.maxDuration!=null?i.maxDuration:C4.maxDuration/r;return Math.min(Math.max(s,t),n)}}const sKe=O();class nKe{constructor(t){this.currentTime=0,this._animation=new rKe(()=>new Dne(t)),this._current=new Dne(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=pe(sKe,i.center,t.center),a=Me(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ae(s.lookAtDirection,o),ae(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new tr,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+hde(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var Ur;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(Ur||(Ur={}));let kb=class extends Se{constructor(){super(...arguments),this.state=Ur.Ready}get active(){return this.state===Ur.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=Ur.Stopped,!0)}finishController(){this.state=Ur.Finished}get steppingFinished(){return!1}};u([d({readOnly:!0})],kb.prototype,"active",null),u([d()],kb.prototype,"state",void 0),kb=u([P("esri.views.3d.state.controllers.CameraController")],kb);let qO=class extends kb{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(mi()),this._asyncResult=null),this.state===Ur.Finished||this.state===Ur.Stopped?this.state===Ur.Finished?e.resolve():e.reject(mi()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=Ur.Running,_(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!_(this.viewAnimation)||this.state!==Ur.Ready&&this.state!==Ur.Running||(this.viewAnimation.state===lE.State.FINISHED?this.finish():this.viewAnimation.state===lE.State.STOPPED&&(this.state=Ur.Stopped))}onControllerEnd(){_(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===Ur.Finished?this.viewAnimation.finish():this.state===Ur.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===Ur.Finished?this._asyncResult.resolve():this._asyncResult.reject(mi()))}finish(){this.finishController()}};qO=u([P("esri.views.3d.state.controllers.AnimationController")],qO);let Pg=class extends qO{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new nKe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new lE}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);e$.copyFrom(this.view.state.camera);const r=ed(this.view.state.viewingMode);this.intersectionHelper.intersectRay(e$.ray,r,Nne)&&(e$.center=Nne),this.animation.update(e$,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return ye(F({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},e),{easing:typeof e.easing=="string"?bJe[e.easing]:e.easing})}};u([d({constructOnly:!0})],Pg.prototype,"view",void 0),u([d({constructOnly:!0})],Pg.prototype,"mode",void 0),Pg=u([P("esri.views.3d.state.controllers.PointToPointAnimationController")],Pg);const e$=new tr,Nne=O();function kwe(e,t,i){return oKe(e,e.screenToRender(t,He.get()),i)}function oKe(e,t,i){const r=_o(He.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=_o(He.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,He.get());return R(n)?null:(pe(i.direction,n,i.origin),i)}function cC(e,t,i){return CQ(e,e.screenToRender(t,He.get()),i)}function CQ(e,t,i){ae(i.origin,e.eye);const r=se(He.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,He.get());return R(s)?null:(pe(i.direction,s,i.origin),i)}function AQ(e,t,i,r){const s=cC(t,i,aKe);return y_(e,s,r)}const aKe=fo();var TE;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(TE||(TE={}));const Uwe=30,A4=[1,3e8],zwe=70;function nw(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function ZH(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function l_(e,t,i){const r=Du(sZ.get(),i[3],i);R(r)||(pe(Hi,e.eye,t),ze(Hi,Hi,r),e.eye=de(Hi,Hi,t),pe(Hi,e.center,t),ze(Hi,Hi,r),e.center=de(Hi,Hi,t),e.up=ze(Hi,e.up,r))}function lKe(e,t,i,r){return ax(e,kwe(t,i,OQ),r)}function YH(e,t,i,r){return ax(e,cC(t,i,OQ),r)}function RQ(e,t,i,r){const s=He.get();let n=1-i;pe(s,t,e.eye);const o=Me(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(le(s,s,n),e.eye=de(Hi,e.eye,s),e.center=pn(Hi,e.center,t,n))}function Vwe(e,t,i){t.getScreenCenter(Fne),AQ(e,t,Fne,Hi)&&(t.center=Hi);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=le(He.get(),t.viewForward,s);t.eye=pe(Hi,t.center,n)}const Fne=Yr();function BV(e,t){se(t,0,0,0);for(const i of e)de(t,t,i);le(t,t,1/e.length)}function aN(e,t,i,r){return Math.sin(e/Me(t))*(i+r.radius)}function kne(e,t,i,r){return aN(Math.PI/2,t,i,r)+(e-Math.PI/2)}var mo;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})(mo||(mo={}));const Une={Elevation:3e4,Angle:Dt(6)},TM={Pole:.95,Angle:Dt(18),Tilt:45},Bwe=Dt(80);function Gwe(e,t,i,r,s,n){const o=O(),a=En();let l=!0,c=!0;return e.intersectScreen(i,o,n)?a[3]=Me(o):(c=!1,t.aboveGround&&s!==TE.Ellipsoid?a[3]=Math.max(Me(t.center),.9*r.radius):a[3]=Me(t.eye)-t.relativeElevation,s===TE.Silhouette?WO(a,t,i,o):l=AQ(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function fU(e,t,i,r){return Me(e.eye)-r.radius>Une.Elevation?mo.Horizontal:i?(cC(e,t,Wne),-Math.sign(e.relativeElevation)*(.5*Math.PI+oZ(e.eye,Wne.direction))<Une.Angle?mo.Vertical:mo.Horizontal):mo.Vertical}function jwe(e,t,i){pe(GV,i,t),e.eye=pe(Hi,e.eye,GV),e.center=pe(Hi,e.center,GV)}const GV=O();function WO(e,t,i,r){const s=cC(t,i,OQ);return!R(s)&&(ZE(e,s,t$),y_(e,s,r)?!(Sn(t$,s.origin)<Sn(r,s.origin))||(ae(r,t$),!1):(pe($x,t.eye,t.center),we($x,$x),qge($x,-xe(we($x,$x),t$),zne),ax(zne,s,r),!1))}const t$=O(),$x=O(),zne=Si();function Hwe(e,t,i,r,s,n){let o;if(ct(O4,e,t),pe(n$,e,t),Me(e)<=s||!r.aboveGround){ct(i,n$,r.eye);const a=xe(e,t)/(Me(e)*Me(t)),l=Math.cos(De(Qv.normalize(Dt(n)),0,Bwe));o=-fn(a)-Math.max(0,Me(t)-s)/(l*s)}else pe(Vne,r.eye,r.center),ct(i,n$,Vne),o=-Me(n$)/s;return we(i,i),le(i,i,Me(O4)),o}const Vne=O();function Bne(e,t,i,r){let s,n;const o=Math.cos(De(Qv.normalize(Dt(r)),0,Bwe));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):fn(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):fn(e/i),(n-s)*i}function cKe(e,t,i,r,s,n,o,a,l,c){const h=Bne(e[2],t[2],o[3],l),p=c?Bne(e[0],t[0],o[3],180):t[0]-e[0],f=Math.sin(a)*p-Math.cos(a)*h,m=Math.cos(a)*p+Math.sin(a)*h;we(Hi,s);const y=c?f/Math.sqrt(Math.abs(o[3]**2-xe(i,Hi)**2)):f/o[3],v=m/Math.sqrt(Math.abs(o[3]**2-xe(i,r)**2));yi(n,y,v)}function qwe(e,t,i,r,s,n,o,a,l,c){ct(O4,e,t),A7(n.up,n.eye,i$,r$,s$),A7([0,0,1],n.eye,Vg,Vv,Ywe),ae(i,Vv),ae(r,Vg),we(i,i),le(i,i,Me(O4)),fte(e,we(r$,r$),we(s$,s$),we(i$,i$),Gne),fte(t,r$,s$,i$,jne),cKe(Gne,jne,e,Vg,Vv,s,o,a,l,c)}function uKe(e,t,i,r,s,n,o){Du(R4,s,r),Du(M4,o,n),Hr(FS,R4,M4),pe(t,e,i),ze(t,t,FS),de(t,t,i)}function Wwe(e,t,i,r,s,n){Du(R4,r,i),Du(M4,n,s),Hr(FS,R4,M4),pe(Hi,e.eye,t),ze(Hi,Hi,FS),e.eye=de(Hi,Hi,t),pe(Hi,e.center,t),ze(Hi,Hi,FS),e.center=de(Hi,Hi,t),pe(Hi,e.up,t),ze(Hi,Hi,FS),e.up=de(Hi,Hi,t)}function MQ(e,t,i,r,s,n,o=TM.Pole,a=TM.Angle){const l=Math.abs(r)>Math.PI-a||Math.abs(r)<a,c=Math.abs(e[2])<i*o||Math.abs(t)>i;return!!(l&&c&&n.aboveGround&&s<TM.Tilt)}function Xwe(e,t,i,r,s,n){if(n)RO(i,r,Hne),l_(t,e,Hne);else{const o=Hwe(i,r,qne,t,e[3],s);l_(t,e,AO(qne,o))}}function Zwe(e,t,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;ae(z_,r),o$.copyFrom(t);for(let p=0;p<a&&Sn(i,z_)>l&&(c=Sn(i,z_),qwe(i,z_,Vv,Vg,jC,o$,e,s,n,o),Wwe(o$,e,Vg,jC[1],Vv,jC[0]),uKe(z_,z_,e,Vg,jC[1],Vv,jC[0]),h=Sn(i,z_),h<c||p===0);p++)t.copyFrom(o$)}function hKe(e,t,i,r,s,n,o){MQ(i,xe(t.up,i),e[3],-Qv.normalize(Dt(s)),n,t,TM.Pole,TM.Angle)?Zwe(e,t,i,r,-Qv.normalize(Dt(s)),n,o):Xwe(e,t,i,r,n,o)}function dKe(e,t,i,r,s,n){const{eye:o}=e;A7([0,0,1],o,Vg,Vv,Ywe);const a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-xe(e.center,Vg)**2/Me(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(gc(r.pan.matrix,r.pan.matrix,h,Vg),r.pan.enabled=!0,s.mode){case"pan":gc(r.pan.matrix,r.pan.matrix,p,Vv),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function pKe(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=ct(He.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(gc(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*i.pan;c!==0&&(gc(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function fKe(e,t,i,r,s,n,o,a,l){MQ(e.center,xe(e.up,e.center),Me(e.center),-Qv.normalize(Dt(n)),o,t)?dKe(t,i,r,a,l,-Qv.normalize(Dt(s))):pKe(t,i,r,a,l)}const Vg=O(),Vv=O(),Ywe=O(),i$=O(),r$=O(),s$=O(),Gne=O(),jne=O(),jC=it(),Hne=oC(),R4=Ae(),M4=Ae(),FS=Ae(),z_=O(),Hi=O(),n$=O(),o$=new tr,O4=O(),qne=O(),OQ={origin:O(),direction:O()},Wne={origin:O(),direction:O()},Xne=.6,jV=4,mKe=12,gKe=60,yKe=200;let P4=class extends Pg{constructor(){super(...arguments),this.zoomLocation=O(),this.tmpCamera=new tr,this.tmpViewDir=O(),this.tmpRayDir={origin:O(),direction:O()},this.targetOnSphere=O(),this.tmpCenter=O(),this.constraintOptions={selection:br.ALL_EXCEPT_COLLISION,interactionType:Gt.ZOOM,interactionFactor:null,interactionStartCamera:new tr,interactionDirection:null,tiltMode:Bn.TUMBLE},this.sphere=En()}initialize(){this.intersector=ed(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,this.view.map.ground.opacity===0?vKe:{})&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ae(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:tP}}_updateCamera(e,t,i,r,s){const n=Ci(this.view.spatialReference),o=fU(e,r,s,n);let a;this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z)),we(l$,e.eye),le(l$,l$,-1),cC(e,r,this.tmpRayDir),we(this.tmpRayDir.direction,this.tmpRayDir.direction);const l=Math.max(Math.min(mKe,1/Math.abs(xe(l$,this.tmpRayDir.direction)))*a,yKe);if(o===mo.Horizontal){let c=Xne**t;this.sphere[3]=Me(i),pe(this.tmpViewDir,e.center,e.eye);const h=Math.min(Me(this.tmpViewDir),l);let p=h*c;if(c<=1&&p<jV&&(p=jV,c=p/h),Math.abs(h-p)<1e-6)return;const f=Me(e.center);if(this.sphere[3]!==f){const m=this.sphere[3]+c*(f-this.sphere[3]);e.center=le(a$,e.center,m/f)}le(this.tmpViewDir,this.tmpViewDir,-c),e.eye=de(a$,e.center,this.tmpViewDir),ys(this.view,e,this.constraintOptions),Sn(i,e.center)>1e-12&&AQ(this.sphere,e,r,this.targetOnSphere)&&hKe(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=Xne**Math.abs(t);const h=t>0?1:-1;pe(this.tmpViewDir,i,e.eye);const p=Me(this.tmpViewDir),f=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,gKe);let m=f?Math.min(l,f):l;m=s?Math.min(m,p):m,le(this.tmpRayDir.direction,this.tmpRayDir.direction,m),de(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let y=m*c;const v=Math.max(jV,1.01*e.nearFar[0]);if(t>0&&y<v&&(y=v,c=y/m),Math.abs(m-y)<1e-6)return;le(this.tmpRayDir.direction,this.tmpRayDir.direction,h*(1-c)),e.eye=de(a$,e.eye,this.tmpRayDir.direction),e.center=de(a$,e.center,this.tmpRayDir.direction)}lC(this.view,e)}};P4=u([P("esri.views.3d.state.controllers.global.ZoomStepController")],P4);const a$=O(),l$=O(),vKe={exclude:new Set([tp])},_Ke=.6,bKe=4,wKe=60,xKe=14,TKe=200;let I4=class extends Pg{constructor(){super(...arguments),this.zoomLocation=O(),this.tmpCamera=new tr,this.tmpRayDir=O(),this.tmpCenter=O(),this.constraintOptions={selection:br.ALL,interactionType:Gt.ZOOM,interactionFactor:null,interactionStartCamera:new tr,interactionDirection:null,tiltMode:Bn.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=ed(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,EKe):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ae(this.zoomLocation,this.tmpCamera.center);const n=_Ke**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,wKe);pe(c$,this.tmpCamera.eye,this.zoomLocation),we(c$,c$);const a=Math.max(Math.min(xKe,1/Math.abs(xe(SKe,c$)))*Math.abs(this.view.camera.position.z),TKe);if(o=o?Math.min(o,a):a,o){const l=O();pe(l,this.zoomLocation,this.tmpCamera.eye),o<Me(l)&&(we(l,l),de(this.zoomLocation,this.tmpCamera.eye,le(l,l,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:tP}}_updateCamera(e,t,i){pe(this.tmpRayDir,i,e.eye);const r=Me(this.tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(bKe,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(le(this.tmpRayDir,this.tmpRayDir,t),e.eye=pe(Zne,i,this.tmpRayDir),e.center=pn(Zne,e.center,i,1-t),ys(this.view,e,this.constraintOptions))}};I4=u([P("esri.views.3d.state.controllers.local.ZoomStepController")],I4);const Zne=O(),SKe=Ue(0,0,1),c$=O(),EKe={exclude:new Set([tp])};function CKe(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function PQ(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class AKe extends Ho{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(CKe(i,"primary")){const r=this.view.state.isGlobal?new P4({view:this.view,mode:"animation"}):new I4({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),Yr(i.x,i.y)),t.stopPropagation()}}}let c_=class extends kb{constructor(){super(...arguments),this.startCamera=new tr,this.currentCamera=new tr}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=Ur.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};c_=u([P("esri.views.3d.state.controllers.InteractiveController")],c_);var oc;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(oc||(oc={}));const RKe=7,HV=90;let kS=class extends c_{constructor(e){super(e),this.view=null,this.pivot=oc.CENTER,this.lastPoint=it(),this.tmpWorldUp=O(),this.tmpViewDir=O(),this.tmpRotCurPoint=it(),this.tmpTransf=Ae(),this.tmpAxis=O(),this.tmpPivotPoint=O(),this.pivotPos=O(),this.constraintOptions={selection:br.ALL,interactionType:Gt.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===oc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case oc.EYE:ae(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=Gt.LOOK_AROUND,this.constraintOptions.tiltMode=Bn.LOOK_AROUND,this.constraintOptions.selection=br.NONE;break;case oc.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||ae(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=Gt.TUMBLE,this.constraintOptions.tiltMode=Bn.TUMBLE,this.constraintOptions.selection=br.ALL&~br.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,nw(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=O();pe(r,this.pivotPos,i.eye);const s=Me(r);let n=Math.min(s,RKe*Math.abs(this.view.camera.position.z));const o=Ci(this.view.spatialReference),a=Yr(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=fU(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*HV,HV),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,HV);c===void 0&&h===void 0||(c=c===void 0?h:c,h=h===void 0||l===mo.Horizontal?c:h,n=c>h?h:c,n=t?Math.min(n,s):n),we(r,r),ae(this.pivotPos,de(this.tmpPivotPoint,i.eye,le(this.tmpPivotPoint,r,n)))}update(e){if(this.active){switch(this.pivot){case oc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case oc.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}ys(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),nw(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;pe(this.tmpViewDir,i,r);const o=Me(this.tmpViewDir),a=fn(xe(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===oc.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=De(s+a,Do.min,Do.max)-a,ct(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===oc.CENTER&&(n=-n),Du(this.tmpTransf,n,this.tmpWorldUp),gc(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),ze(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=ze(qV,e.up,this.tmpTransf),de(qV,r,this.tmpViewDir),_o(this.lastPoint,this.tmpRotCurPoint),qV}};u([d({constructOnly:!0})],kS.prototype,"view",void 0),u([d()],kS.prototype,"pivot",void 0),kS=u([P("esri.views.3d.state.controllers.RotateController")],kS);const qV=O();class WV extends Ho{constructor(t,i,r,s){super(!0),this.view=t,this.pointerAction=i,this.pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!PQ(t.data,this.pointerAction))return;const r=Yr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new kS({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let lN=class extends c_{constructor(e){super(e),this.view=null,this.pickPoint=O(),this.tmpP0=it(),this.panAxisAngle=oC(),this.tmpRayDir=O(),this.tmpRayDirPick=O(),this.targetOnSphere=O(),this.tmpRay={origin:O(),direction:O()},this.dragBeginPoint=Yr(),this.normalizedAnchorPoint=it(),this.constraintOptions={selection:br.ALL_EXCEPT_COLLISION,interactionType:Gt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE},this.sphere=En(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;_o(this.dragBeginPoint,e),nw(this.startCamera,e,this.normalizedAnchorPoint);const t=Ci(this.view.spatialReference),i=Gwe(this.intersectionHelper,this.startCamera,e,t,TE.Ellipsoid,this.view.map.ground.opacity===0?MKe:{});if(this.navMode=fU(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===mo.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let r,s;cC(this.startCamera,e,this.tmpRay),we(this.tmpRay.direction,this.tmpRay.direction),i.scenePickPoint&&(pe(this.tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=Me(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let n=De(Uwe*r,A4[0],A4[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,zwe);n=o?Math.min(n,o):n,n=i.scenePickPoint?Math.min(n,s):n,this.hasPickPoint=!0,le(this.tmpRay.direction,this.tmpRay.direction,n),de(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===mo.Horizontal){pe(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=Me(this.tmpRayDir);nw(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this.sphere[3]/Me(this.currentCamera.center));this.currentCamera.center=le(u$,this.currentCamera.center,n)}le(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=de(u$,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=Qd(this.dragBeginPoint,e),ys(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(WO(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),RO(this.pickPoint,this.targetOnSphere,this.panAxisAngle),l_(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=Me(this.tmpRay.direction);nw(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;le(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=de(u$,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=de(u$,this.currentCamera.center,this.tmpRayDir)}lC(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],lN.prototype,"view",void 0),lN=u([P("esri.views.3d.state.controllers.global.ZoomController")],lN);const u$=O(),MKe={exclude:new Set([tp])};let cN=class extends c_{constructor(e){super(e),this.view=null,this.tmpP=O(),this.tmpDir=O(),this.tmpN=O(),this.tmpP0=it(),this.tmpPoi=O(),this.tmpRayDir=O(),this.dragBeginPoint=Yr(),this.normalizedAnchorPoint=it(),this.constraintOptions={selection:br.ALL,interactionType:Gt.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:O(),tiltMode:Bn.TUMBLE},this.plane=Si()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;_o(this.dragBeginPoint,e),nw(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,this.view.map.ground.opacity===0?OKe:{});pe(this.tmpDir,this.tmpP,this.startCamera.eye);const i=Me(this.tmpDir);let r;we(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=De(Uwe*r,A4[0],A4[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,zwe);s=n?Math.min(s,n):s,s=t?Math.min(s,i):s,le(this.tmpDir,this.tmpDir,s),de(this.tmpP,this.startCamera.eye,this.tmpDir),pe(this.tmpN,this.startCamera.eye,this.startCamera.center),we(this.tmpN,this.tmpN),this.tmpN[1]<0&&ca(this.tmpN,this.tmpN),J2(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;lKe(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||ae(this.tmpPoi,this.currentCamera.center),nw(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);_o(this.normalizedAnchorPoint,this.tmpP0),pe(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=Me(this.tmpRayDir);let r=i*(1-t);ae(this.constraintOptions.interactionDirection,this.tmpRayDir),le(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(le(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=de(V_,this.currentCamera.eye,this.tmpRayDir),pn(V_,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?V_[2]=Math.max(this.startCamera.center[2],V_[2]):V_[2]=Math.min(this.startCamera.center[2],V_[2]),this.currentCamera.center=V_,this.constraintOptions.interactionFactor=Qd(this.dragBeginPoint,e),ys(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};u([d({constructOnly:!0})],cN.prototype,"view",void 0),cN=u([P("esri.views.3d.state.controllers.local.ZoomController")],cN);const V_=O(),OKe={exclude:new Set([tp])};class PKe extends Ho{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!PQ(t.data,this.pointerAction))return;const r=Yr(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new lN({view:this.view}):this.cameraController=new cN({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const IKe=O(),h$=O();function IQ(){return{direction:O(),up:O()}}function Qwe(e,t,i,r,s){let n=we(IKe,e),o=xe(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(xe(t,r)),o<.99?(ae(n,t),a&&le(n,n,-1)):n=null);let l=0;if(n){le(h$,r,xe(r,n)),pe(n,n,h$);const h=xe(n,s)/(Me(n)*Me(s));ct(h$,n,s),l=(xe(h$,r)>0?1:-1)*Ac(fn(h))}const c=Ac(fn(-xe(r,e)/Me(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const Jwe=Ue(0,1,0),Kwe=Ue(0,0,1),HC=Ae(),Rm=O(),Mm=O();function exe(e,t,i,r=IQ()){const{direction:s,up:n}=r;return Bme(HC,-Dt(t)),W2(HC,HC,Dt(i)),ze(s,Kwe,HC),le(s,s,-1),ze(n,Jwe,HC),r}function $Ke(e,t,i,r){return Qwe(t,i,r,Kwe,Jwe)}function LKe(e,t,i,r){const s=exe(e,i,r),n=O();return le(n,s.direction,-t),de(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function DKe(e){return Ac(e)}function NKe(e){return Dt(e)}function txe(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return jn(t,Rm,n),jn(t,Mm,n),Rm[0]-=i/2,Mm[0]+=i/2,Rm[1]-=r/2,Mm[1]+=r/2,un(Rm,n,Rm,o),un(Mm,n,Mm,o),s?(s.xmin=Rm[0],s.ymin=Rm[1],s.xmax=Mm[0],s.ymax=Mm[1],s.spatialReference=o):s=new ai(Rm[0],Rm[1],Mm[0],Mm[1],o),s}const FKe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:exe,directionToHeadingTilt:$Ke,eyeForCenterWithHeadingTilt:LKe,lookAtTiltToEyeTilt:DKe,eyeTiltToLookAtTilt:NKe,toExtent:txe},Symbol.toStringTag,{value:"Module"})),ixe=Ue(0,0,1),rxe=we(O(),Ue(1,1,1)),kKe=new Yv(-180,180),qC=Ae(),K0=O(),Lx=O();function sxe(e,t,i,r=IQ()){ct(K0,e,ixe),xe(K0,K0)===0&&ct(K0,e,rxe),Du(qC,-Dt(t),e),gc(qC,qC,-Dt(i),K0);const{up:s,direction:n}=r;return ct(s,K0,e),we(s,s),ze(s,s,qC),we(n,e),ca(n,n),ze(n,n,qC),r}function UKe(e,t,i,r){const s=K0,n=Lx;return we(s,e),ct(Lx,s,ixe),xe(Lx,Lx)===0&&ct(Lx,s,rxe),ct(n,Lx,s),Qwe(t,i,r,s,n)}function zKe(e,t,i,r){const s={eye:O(),up:null,tilt:r,heading:i},n=K0;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Dt(i),l=Dt(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),f=Math.cos(l),m=Me(n);let y;if(Math.abs(l)<1e-8)y=o+m;else{const oe=m/p,$=Tp(o/oe),U=Math.PI-l-$;y=oe*Math.sin(U)}const v=f*o,w=o*o*(p*p),b=h*h*w,S=y-v,T=S*S,E=b*(b+T-n[1]*n[1]);if(E<0)return le(s.eye,n,y/m),s.tilt=0,s;const C=Math.sqrt(E),A=n[1]*S,I=b+T;let D;if(D=h>0?-C+A:C+A,Math.abs(I)<1e-8)return m<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):le(s.eye,n,y/m),s.tilt=0,XV(s.eye),ZV(s,e);s.eye[1]=D/I;const L=c*c*w,z=p*o,B=h*z*s.eye[1],V=s.eye[1]*s.eye[1],Q=1-V,Z=Math.sqrt(Q),ce=b*V+L-2*B*Z*S+Q*T;return Math.abs(ce)<1e-8?(le(s.eye,n,y/m),s.tilt=0,XV(s.eye),ZV(s,e)):(s.eye[0]=(Q*(y*n[0]-v*n[0])-z*Z*(n[0]*s.eye[1]*h+n[2]*c))/ce,s.eye[2]=(Q*(y*n[2]-v*n[2])-z*Z*(n[2]*s.eye[1]*h-n[0]*c))/ce,le(s.eye,s.eye,y),XV(s.eye),ZV(s,e))}function XV(e){const t=e[1];e[1]=-e[2],e[2]=t}function ZV(e,t){const i=sxe(t,e.heading,e.tilt);return e.up=i.up,e}function VKe(e,t,i){const r=Me(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=Tp(i/(s/Math.sin(e)));return Ac(e-n)}function BKe(e,t,i){const r=Dt(e),s=Me(t);return Tp(i/(s/Math.sin(r)))+r}function nxe(e,t,i,r,s){let n,o,a,l;const c=t.latitude,h=Ci(e.spatialReference).radius,p=t.longitude,f=BYe(c,i,h)/2;n=p-f,o=p+f;const m=Dt(c),y=(1+Math.sin(m))/(1-Math.sin(m)),v=(y+1)*Math.tan(r/h/2),w=v*v;function b(T){const E=Math.PI/2;return(T=jLe.normalize(T,-E))>E&&(T=Math.PI-T),T}if(a=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*y+w))),l=a+r/h,a=b(a),l=b(l),l<a){const T=l;l=a,a=T}if(a=Math.max(Ac(a),-90),l=Math.min(Ac(l),90),o=kKe.monotonic(n,o),o-n>180){const T=(o-n-180)/2;n+=T,o-=T}const S=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:et.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=S):s=new ai(n,a,o,l,S),e.spatialReference&&e.spatialReference.isWebMercator&&Dg(s,!1,s),s}const GKe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:sxe,directionToHeadingTilt:UKe,eyeForCenterWithHeadingTilt:zKe,lookAtTiltToEyeTilt:VKe,eyeTiltToLookAtTilt:BKe,toExtent:nxe},Symbol.toStringTag,{value:"Module"}));function $4(e){return e.type==="point"}class oxe{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function axe(e){return"array"in e}function kf(e,t,i="ground"){if($4(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(axe(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,vt(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function L4(e,t){return e!=null&&(t==null||(t===Ge.Local?!e.isGeographic||e.isWGS84||e.wkid===Dh.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===Dh.CGCS2000||e.wkid===Dh.GCSMARS2000||e.wkid===Dh.GCSMARS2000_SPHERE||e.wkid===Dh.GCSMOON2000))}const lxe=fe.getLogger("esri.views.3d.support.cameraUtils"),cxe=39.37,uxe=96,QH=1,jKe=8,HKe=5,hxe=1,Yne=O(),d$=O(),qKe={heading:0,tilt:0},xg=new ot,WKe=new Yv(-20037508342788905e-9,20037508342788905e-9),XKe=new Yv(-180,180);var zo;function iP(e){return e.spatialReference||et.WGS84}function uC(e){return e.viewingMode==="global"?GKe:FKe}function ZKe(e,t,i,r,s){return uC(e).headingTiltToDirectionUp(t,i,r,s)}function gg(e,t){if(R(t))return null;const i=e.renderSpatialReference,r=uC(e).headingTiltToDirectionUp,s=O();if(!jn(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);le(n.direction,n.direction,e.state.camera.distance),de(n.direction,n.direction,s);const o=px(e,s,n.direction,n.up);return o.fov=Dt(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(zo||(zo={}));const Dx=O();function SE(e,t,i){const r=e.renderSpatialReference,s=mU(e,t.eye,t.viewForward,t.up,qKe);let n=iP(e);return un(t.eye,r,Dx,n)||(n=et.WGS84,un(t.eye,r,Dx,n)),R(i)?new Rc(new ot(Dx,n),s.heading,s.tilt,Ac(t.fov)):(i.position.x=Dx[0],i.position.y=Dx[1],i.position.z=Dx[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Ac(t.fov),i)}function $Q(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===Ge.Global&&i!=null&&(t*=Math.cos(Dt(i))),t/=e.renderCoordsHelper.unitInMeters,s/(uxe*cxe/t)/Math.tan(r.fovX/2)}function Uw(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=uxe*cxe/(n/s);return e.renderCoordsHelper.viewingMode===Ge.Global&&(o/=Math.cos(Dt(i))),o*=e.renderCoordsHelper.unitInMeters,o}function dxe(e,t,i,r,s,n){return pxe(e,t,$Q(e,i,t.latitude),r,s,n)}function pxe(e,t,i,r,s,n){if(ow(n)){const a=new hC(n.signal);return XO(e,r.heading,r.tilt,t,i,s,a),void a.resolver.promise.then(l=>{const c=N4(e,l,r.fov);if(!R(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=XO(e,r.heading,r.tilt,t,i,s);return N4(e,o,r.fov,n)}function mU(e,t,i,r,s){return uC(e).directionToHeadingTilt(t,i,r,s)}function YKe(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,xg,e.spatialReference)&&vt(kf(e.elevationProvider,xg),0)>xg.z-hxe)}async function QKe(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,xg,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(xg.x,xg.y,xg.z,xg.spatialReference,"ground",i);return vt(r,0)>xg.z-hxe}async function JKe(e,t,i){const r=O();if(t)if(t instanceof ot){if(jn(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return _(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else ae(r,t);else ae(r,e.state.camera.center);return r}function KKe(e,t){const i=O();if(t&&t instanceof ot){if(jn(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const r=kf(e.elevationProvider,t);_(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else ae(i,t||e.state.camera.center);return i}function XO(e,t,i,r,s,n,o){const a=r&&r instanceof ot?r:null;if(ow(o))return JKe(e,r,o.signal).then(c=>{JH(e,t,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=KKe(e,r);return JH(e,t,i,a,l,s,n,o)}function JH(e,t,i,r,s,n,o,a){if(R(r)){const p=e.renderSpatialReference;if(r=Jv(s,p,iP(e)),R(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=iet(e,t,i,s,n,o),c=(0,uC(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===zo.ADJUST&&e.viewingMode==="global"&&i>0){const p=()=>{const m=fxe(e,s,n,set(e,n,i,s));return o=i-m<1?zo.LOCKED:zo.ADJUST,JH(e,t,m,r,s,n,o,a)},f=e.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(YKe(e,c.eye))return p();if(ow(a))return QKe(e,c.eye,a.signal).then(m=>m?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:Vs(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||ow(a)?{center:O(),eye:O(),up:O(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=Vs(s),h.heading=c.heading,h.tilt=c.tilt,ow(a)&&a.resolver.resolve(h),h}function SM(e,t,i,r,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!L4(t.spatialReference,Ge.Global))return ow(n)&&n.resolver.reject(),null;const b=new ot(t.xmin,t.ymin,t.spatialReference),S=new ot(t.xmax,t.ymax,t.spatialReference),T=t.spatialReference.isGeographic?XKe:WKe;a=new ot({x:T.center(b.x,S.x),y:(S.y+b.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const E=Ci(t.spatialReference),C=VYe(a,b,S);l=C.lon,c=C.lat,T.diff(b.x,S.x)>T.range/2&&(l+=E.halfCircumference),l=Math.min(l,E.halfCircumference),c=Math.min(c,E.halfCircumference)}else{const b=vt(e.renderSpatialReference,t.spatialReference);b.equals(t.spatialReference)||(t=N3(t,b)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const S=o?(t.zmax+t.zmin)/2:null;a=new ot({x:t.xmin+.5*l,y:t.ymin+.5*c,z:S,spatialReference:b})}const h=o?t.zmax-t.zmin:0,p=e.state.camera,f=1/Math.tan(p.fovX/2),m=1/Math.tan(p.fovY/2),y=1/Math.tan(p.fov/2),v=Math.max(.5*l*f,.5*c*m,.5*h*y)/QH;if(ow(n)){const b=new hC(n.signal);return XO(e,i,r,a,v,s,b),void b.resolver.promise.then(S=>{const T=N4(e,S,e.camera.fov);if(!R(T))return n.resolver.resolve(T);n.resolver.reject()},S=>n.resolver.reject(S))}const w=XO(e,i,r,a,v,s);return N4(e,w,e.camera.fov,n)}function eet(e,t,i){const r=e.renderSpatialReference,s=Jv(i,r,iP(e));if(R(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=WW(t.eye,i),l=2*a*n*QH,c=2*a*o*QH;return e.viewingMode==="global"?nxe(e,s,l,c):txe(e,s,l,c)}function tet(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>jKe)return!0;const s=e.renderSpatialReference,n=iP(e),o=Jv(t,s,n),a=Jv(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(R(o)||R(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>HKe}function iet(e,t,i,r,s,n){let o=0;return n===zo.ADJUST&&tet(e,r,s)?(t=0,o=ret(e,s,i,r)):o=LQ(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=fxe(e,r,s,o)}}const D4=.7;function ret(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-D4)+s.max*D4,o=LQ(e,r,t,i);return Math.min(o,n)}function set(e,t,i,r){const s=e.state.constraints.tilt(t);let n=LQ(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-D4)+n*D4}function fxe(e,t,i,r){return uC(e).lookAtTiltToEyeTilt(r,t,i)}function LQ(e,t,i,r){return uC(e).eyeTiltToLookAtTilt(r,t,i)}function N4(e,t,i,r){if(R(t))return null;const s=e.renderSpatialReference,n=Jv(t.eye,s,iP(e));return R(n)?null:_(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new Rc(n,t.heading,t.tilt,i)}function mxe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(t);lxe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function gxe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(t);lxe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function net(e,t){return e.spatialReference?hye(t,e.spatialReference):void 0}function yxe(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=et.WGS84;return t instanceof Rc?(s=t.position.latitude,jn(t.position,Yne,r),jn(i,d$,r),n=ur(Yne,d$)):(un(t.center,r,d$,o),s=d$[1],n=t.distance),Uw(e,n,s)}class hC{constructor(t){this.signal=t,this.resolver=xp()}}function ow(e){return e&&"resolver"in e}function pd(e){let t=e*e;return e<0&&(t*=-1),t}function Qne(e,t,i){const r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=pd(s.axes[0]),r.translation[1]=pd(s.axes[1]),r.translation[2]=pd(s.buttons[7])-pd(s.buttons[6]),r.heading=pd(s.axes[2]),r.tilt=pd(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*pd(s.axes[0]),r.translation[1]=1.2*pd(s.axes[1]),r.translation[2]=2*-pd(s.axes[2]),r.heading=1.2*pd(s.axes[5]),r.tilt=1.2*pd(s.axes[3])),r.tilt*=o,le(r.translation,r.translation,a),r}function Jne(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function YV(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let av=class extends c_{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new tr,this.constraintOptions={selection:br.ALL,interactionType:Gt.NONE,interactionStartCamera:new tr,interactionFactor:0,interactionDirection:null,tiltMode:Bn.LOOK_AROUND}}handleEventGamepad(e){const t=Qne(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||YV(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,Jne(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=Jne(this.keysButtonState,this.transformation);YV(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,B_),this._applyDisabledMovementTypes(B_),this._applyPan(B_.pan),this._applyRotate(B_.rotate),this._applyZoom(B_.zoom),this._applyAscend(B_.ascend),this.constraintOptions.interactionType=Gt.NONE,this.constraintOptions.selection=br.COLLISION,ys(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;pe(Ja,t.center,t.eye),ze(Ja,Ja,e.matrix),t.center=de(Ja,Ja,t.eye),t.up=ze(Ja,t.up,e.matrix),this.constraintOptions.interactionType=Gt.LOOK_AROUND,this.constraintOptions.selection=br.ALL_EXCEPT_COLLISION,ys(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=ze(Ja,t.eye,e.matrix),t.center=ze(Ja,t.center,e.matrix),this.view.state.isGlobal&&(t.up=ze(Ja,t.up,e.matrix)),this.constraintOptions.interactionType=Gt.PAN,this.constraintOptions.selection=br.ALL,ys(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=de(Ja,this.currentCamera.eye,le(He.get(),t,e)),ae(WC,t),ca(WC,WC),this.constraintOptions.interactionDirection=WC,this.constraintOptions.interactionType=Gt.ZOOM,this.constraintOptions.selection=br.ALL_EXCEPT_COLLISION,ys(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,He.get());if(this.constraintOptions.interactionDirection=ae(WC,t),this.view.state.isGlobal){const i=Me(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=le(Ja,this.currentCamera.eye,r),this.currentCamera.center=le(Ja,this.currentCamera.center,r)}else{const i=le(He.get(),t,e);this.currentCamera.eye=de(Ja,this.currentCamera.eye,i),this.currentCamera.center=de(Ja,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=Gt.ASCEND,this.constraintOptions.selection=br.COLLISION,ys(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=br.ALL_EXCEPT_COLLISION,ys(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){pet(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,Ja)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=se(He.get(),s[0],s[1],0);we(a,a);const l=n.translation[0]*e.pan;if(l!==0){const y=le(He.get(),r,l);qa(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}switch(o.mode){case"pan":{const y=-n.translation[1]*e.pan;if(y!==0){const v=le(He.get(),a,y);qa(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(gc(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,He.get())),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=a_(this.view.renderCoordsHelper,t.center,t.eye),m=De(f+p,Do.min,Do.max)-f;m&&(gc(i.rotate.matrix,i.rotate.matrix,m,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=ct(He.get(),s,r);we(a,a),ca(a,a),fKe(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(B_.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(gc(i.rotate.matrix,i.rotate.matrix,h,this.tmpCamera.eye),i.rotate.enabled=!0);const p=n.tilt*e.rotate,f=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);f!==0&&(gc(i.rotate.matrix,i.rotate.matrix,f,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=Ci(this.view.spatialReference),s=aN(Do.min,t.origin,i,r);let n=0,o=0;const a=He.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){const l=a_(this.view.renderCoordsHelper,a,t.origin);n=aN(l,t.origin,i,r),o=aN(Do.max,t.origin,i,r)}else{ZE(dk(pk,i+r.radius),t,a);const l=fn(-xe(t.direction,we(a,a)));n=kne(l,t.origin,i,r),o=kne(Do.max,t.origin,i,r)}return De(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=ZKe(this.view,t,0,vxe,det),n=i.intersectManifoldClosestSilhouette(Fu(t,s),e,He.get()),o=ur(t,n),a=i.intersectManifoldClosestSilhouette(Fu(t,uy(He.get(),t,r.center)),e,He.get()),l=ur(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,He.get());if(s){const o=pe(He.get(),e,n),a=Me(o);le(o,o,1/a);const l=we(He.get(),e),c=fn(xe(l,o));return a*Math.sin(Math.min(aet,c))}{const o=ae(He.get(),e);return t.setAltitude(o,this.filteredSurfaceElevation),ur(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:cet}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+Ci(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=He.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=Kne*r.width,h=Kne*r.width,p=a*Math.tan(.5*r.fovX)/l,f=p/i,m=p/this._computeHeadingRotateRadius(n),y=o-t;return{pan:(s?f:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*y-y),zoom:2**(c*e/l)*a-a,rotate:De(m*h,uet,het)*e}}_applyDisabledMovementTypes(e){!_(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&tm(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&tm(e.rotate.matrix))}static activatesFor(e,t){const i=Qne(t,e.navigation.gamepad,oet);return!(t.action==="end"||YV(i))}};u([d({constructOnly:!0})],av.prototype,"view",void 0),u([d({constructOnly:!0})],av.prototype,"gamepadDevice",void 0),u([d({constructOnly:!0})],av.prototype,"disableMovements",void 0),av=u([P("esri.views.3d.state.controllers.GamepadKeyboardController")],av);const oet={translation:[0,0,0],heading:0,tilt:0,zoom:0},vxe=80,aet=Dt(vxe),Kne=.75,cet=5,uet=Dt(30),het=Dt(80),B_={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ae()},rotate:{enabled:!1,matrix:Ae()}},Ja=O(),WC=O(),det=IQ();function pet(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,tm(e.pan.matrix),e.rotate.enabled=!1,tm(e.rotate.matrix)}class fet extends Ho{constructor(t){super(!0),this.view=t,this.watchHandles=new Nt,this.handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([ie(()=>this.view.navigation.gamepad.enabled,i=>{i?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},Rt),ie(()=>this.view.navigation.gamepad.device,i=>{this.cameraControllerGamepad&&i&&this.cameraControllerGamepad.gamepadDevice!==i&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this.view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||av.activatesFor(this.view,t.data)){if(!r){const s=new av({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var ec;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(ec||(ec={}));class met extends Ho{constructor(t,i){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ge.Local},this.keyToNumber={[i.left]:ec.LEFT,[i.right]:ec.RIGHT,[i.forward]:ec.FORWARD,[i.backward]:ec.BACKWARD,[i.up]:ec.UP,[i.down]:ec.DOWN,[i.headingLeft]:ec.HEADINGLEFT,[i.headingRight]:ec.HEADINGRIGHT,[i.tiltUp]:ec.TILTUP,[i.tiltDown]:ec.TILTDOWN,[i.zoomIn]:ec.ZOOMIN,[i.zoomOut]:ec.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new av({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class get extends Ho{constructor(t,i){super(!0),this.view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new P4({view:this.view,mode:"interaction"}):new I4({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,Yr(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class F4{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let Bv=class extends qO{constructor(e){super(e),this.view=null,this.beginCamera=new tr,this.elapsedTimeSec=0,this.constraintOptions={selection:br.ALL,interactionType:Gt.PAN,interactionFactor:0,interactionStartCamera:new tr,interactionDirection:null,tiltMode:Bn.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new lE}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),ys(this.view,t,this.constraintOptions)}};u([d({constructOnly:!0})],Bv.prototype,"view",void 0),Bv=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Bv);let EM=class extends Bv{constructor(e){super(e),this.interactionType=Gt.PAN,this.tmpPan=O()}momentumStep(e,t){const i=this.momentum.value(e);le(this.tmpPan,this.momentum.direction,i),t.eye=pe(eoe,t.eye,this.tmpPan),t.center=pe(eoe,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};u([d({constructOnly:!0})],EM.prototype,"momentum",void 0),EM=u([P("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],EM);const eoe=O(),yet=O(),p$=O();let uN=class extends Bv{constructor(e){super(e),this.interactionType=Gt.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);ae(p$,t.eye),we(p$,p$),ct(this.momentum.axis2,p$,this.momentum.axis1),Wwe(t,yet,this.momentum.axis1,i,this.momentum.axis2,r)}};u([d({constructOnly:!0})],uN.prototype,"momentum",void 0),uN=u([P("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],uN);let Tb=class extends Bv{constructor(e){super(e),this.interactionType=Gt.TUMBLE}set center(e){this._set("center",Vs(e))}set axis(e){this._set("axis",Vs(e))}momentumStep(e,t){const i=this.momentum.value(e);l_(t,this.center,AO(this.axis,i))}};u([d({constructOnly:!0})],Tb.prototype,"momentum",void 0),u([d({constructOnly:!0})],Tb.prototype,"center",null),u([d({constructOnly:!0})],Tb.prototype,"axis",null),Tb=u([P("esri.views.3d.state.controllers.momentum.MomentumController")],Tb);let US=class extends Bv{constructor(e){super(e),this.interactionType=Gt.ZOOM,this.constraintOptions.interactionDirection=O()}set zoomCenter(e){this._set("zoomCenter",Vs(e))}momentumStep(e,t){ae(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);RQ(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=uy(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([d({constructOnly:!0})],US.prototype,"momentum",void 0),u([d({constructOnly:!0})],US.prototype,"zoomCenter",null),US=u([P("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],US);let Z1=class extends Bv{constructor(e){super(e),this.interactionType=Gt.ZOOM,this.radius=0,this.tmpSceneCenter=O(),this.tmpZoomAxisAngle=oC(),this.sphere=En()}set screenCenter(e){this._set("screenCenter",Yr(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Vs(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);Vwe(this.sphere,t,i),this.constraintOptions.interactionType=Gt.ZOOM,ys(this.view,t,this.constraintOptions),WO(this.sphere,t,this.screenCenter,this.tmpSceneCenter),RO(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),l_(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=Gt.PAN}};u([d({constructOnly:!0})],Z1.prototype,"momentum",void 0),u([d({constructOnly:!0})],Z1.prototype,"screenCenter",null),u([d({constructOnly:!0})],Z1.prototype,"sceneCenter",null),u([d({constructOnly:!0})],Z1.prototype,"radius",void 0),Z1=u([P("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Z1);class Jd{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class gU{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class vet extends gU{constructor(t,i,r,s,n){super(t,i,r),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class _xe{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new Jd(.6),this.screen=[new Jd(.4),new Jd(.4)],this.scene=[new Jd(.6),new Jd(.6),new Jd(.6)],this.tmpDirection=O()}add(t,i,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(i[0]),this.scene[1].update(i[1]),this.scene[2].update(i[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){se(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=Me(this.tmpDirection);s>0&&le(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new vet(t,i,r,n,this.tmpDirection)}}class toe{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const ioe=1e-5;class _et extends gU{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class bet{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.tmpAxis1=O(),this.tmpAxis2=O(),this.tmpAngles=it(),this.time=new Jd(.3),this.screen=[new Jd(.4),new Jd(.4)],this.angle1=new toe(.6),this.angle2=new toe(.6),this.axis1=O(),this.axis2=O(),this.lastScene=O()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let a=Hwe(this.lastScene,i,this.tmpAxis2,s,n,o);this.angle2.update(0),Ua(this.tmpAxis2)<ioe?a=0:we(this.axis1,this.tmpAxis2),this.angle1.update(a),ae(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;qwe(this.lastScene,i,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,o,a,!1),Ua(this.tmpAxis2)<ioe?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),we(this.axis1,this.tmpAxis1),we(this.axis2,this.tmpAxis2)),ae(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new _et(t,i,r,s,this.axis1,n,this.axis2)}}class bxe{constructor(t=2.5,i=.01,r=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=s,this.enabled=!0,this.value=new Jd(.8),this.time=new Jd(.3)}add(t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=De(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,i,r){return new gU(t,i,r)}}class wxe extends bxe{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){if(this.value.hasLastValue){const r=this.value.lastValue;let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class wet extends gU{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class xxe extends bxe{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new wet(t,i,r)}}let hN=class extends c_{constructor(e){super(e),this.view=null,this.smoothRotation=new F4(.05),this.rotationAxis=O(),this.panningPlane=Si(),this.smoothScaling=new F4(.05),this.zoomCenterScreen=Yr(),this.zoomMomentumEstimator=new xxe,this.rotationMomentumEstimator=new wxe,this.panSphericalMomentumEstimator=new bet,this.panPlanarMomentumEstimator=new _xe,this.adjustedSphere=En(),this.tmp3d=O(),this.tmpScreenPointArray=Yr(),this.beginScreenPoint=Yr(),this.beginScenePoint=O(),this.screenPickPoint=Yr(),this.navMode=mo.Horizontal,this.tmpInteractionDirection=O(),this.constraintOptions={selection:br.ALL,interactionType:Gt.NONE,interactionFactor:0,interactionStartCamera:new tr,interactionDirection:null,tiltMode:Bn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-Qv.normalize(Dt(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),Tg(e.center,this.screenPickPoint),_o(this.beginScreenPoint,this.screenPickPoint);const i=Ci(this.view.spatialReference),r=Gwe(this.intersectionHelper,this.startCamera,this.screenPickPoint,i,TE.Silhouette);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,ae(this.beginScenePoint,this.scenePickPoint),this.navMode=fU(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===mo.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=ca(this.tmp3d,this.startCamera.viewForward);J2(this.scenePickPoint,t,this.panningPlane);const i=Yr(this.screenPickPoint[0],0),r=O(),s=Me(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],WO(this.adjustedSphere,this.startCamera,i,r);const n=Fo();this.startCamera.projectToRenderScreen(r,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&J2(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=O(),c=O(),h=O(),p=80,f=5,m=50;pe(l,this.scenePickPoint,this.currentCamera.eye);const y=Me(l);we(l,l);const v=f*Math.max(Math.abs(this.view.camera.position.z),m),w=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,p);let b=w?Math.min(w,v):v;b=a?Math.min(b,y):b,ae(h,de(c,this.currentCamera.eye,le(c,l,b))),this.panningPlane[3]=-xe(this.panningPlane,h),this.startCamera.center=de(c,this.startCamera.eye,le(c,this.startCamera.viewForward,b));const S=Tg(e.center,this.tmpScreenPointArray);YH(this.panningPlane,this.startCamera,S,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===mo.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===mo.Horizontal?new Z1({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new US({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Tb({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===mo.Horizontal){const r=this.panSphericalMomentumEstimator.evaluateMomentum();if(r)return new uN({view:this.view,momentum:r})}else{const r=this.panPlanarMomentumEstimator.evaluateMomentum();if(r)return new EM({view:this.view,momentum:r})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),Vwe(this.sphere,this.currentCamera,this.smoothScaling.value),Tg(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=Gt.ZOOM,this.constraintOptions.interactionFactor=Qd(e.radius-this.beginRadius),ys(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=Tg(e.center,this.tmpScreenPointArray);WO(this.sphere,this.currentCamera,t,this.tmp3d),MQ(this.beginScenePoint,xe(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(Zwe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(Xwe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=Gt.PAN,this.constraintOptions.interactionFactor=Qd(this.screenPickPoint,t),ys(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){we(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||ca(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+ZH(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),l_(this.currentCamera,this.sphere,AO(this.rotationAxis,s)),this.constraintOptions.interactionType=Gt.TUMBLE,this.constraintOptions.interactionFactor=Qd(e.radius*i),ys(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=Tg(e.center,this.tmpScreenPointArray);YH(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(jwe(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=Gt.PAN,this.constraintOptions.interactionFactor=Qd(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),ys(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),RQ(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=Gt.ZOOM,this.constraintOptions.interactionFactor=Qd(e.radius-this.beginRadius),ys(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){ae(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||ca(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=ZH(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),l_(this.currentCamera,this.sphere,AO(this.rotationAxis,n)),this.constraintOptions.interactionType=Gt.TUMBLE,this.constraintOptions.interactionFactor=Qd(e.radius*n),ys(this.view,this.currentCamera,this.constraintOptions)}};u([d({constructOnly:!0})],hN.prototype,"view",void 0),hN=u([P("esri.views.3d.state.controllers.global.PinchAndPanController")],hN);const roe=Ue(0,0,1),xet={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},Tet=80;let dN=class extends c_{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new F4(.05),this.scalingValueSmooth=new F4(.05),this.planeHorizontal=Si(),this.planeVertical=Si(),this.rotationMomentumEstimator=new wxe,this.panMomentumEstimator=new _xe(300,12,.9),this.zoomMomentumEstimator=new xxe,this.beginCenter=O(),this.tmpPoints=[],this.beginCenterScreen=Yr(),this.tmpCentroid3d=O(),this.tmpCentroid2d=Yr(),this.tmp2d=Yr(),this.constraintOptions={selection:br.ALL,interactionType:Gt.NONE,interactionFactor:0,interactionStartCamera:new tr,interactionDirection:null,tiltMode:Bn.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),Tg(e.center,this.beginCenterScreen),qge(roe,0,this.planeHorizontal);const i=O(),r=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i),s=O();ca(s,this.startCamera.viewForward);const n=O();ae(n,roe);const o=xe(s,n),a=Tp(o<0?-o:o);if(this.panMode=a>=xet.ANGLE_THRESHOLD?mo.Horizontal:mo.Vertical,S7(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||E7(this.planeHorizontal,this.planeHorizontal),this.panMode===mo.Vertical){le(n,n,o),pe(this.planeVertical,s,n),we(this.planeVertical,this.planeVertical),S7(this.planeVertical,this.planeVertical,i);const l=O(),c=O(),h=O();pe(l,i,this.currentCamera.eye);const p=Me(l);we(l,l);const f=5*Math.max(Math.abs(this.view.camera.position.z),50),m=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,Tet);let y=m?Math.min(m,f):f;y=r?Math.min(y,p):y,ae(h,de(c,this.currentCamera.eye,le(c,l,y))),this.planeVertical[3]=-xe(this.planeVertical,h),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),BV(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),BV(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===mo.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),RQ(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=Gt.ZOOM,this.constraintOptions.interactionFactor=Qd(Math.abs(e.radius-this.beginRadius)),ys(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),BV(this.tmpPoints,this.tmpCentroid3d),Tg(e.center,this.tmpCentroid2d),jwe(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=Gt.PAN,this.constraintOptions.interactionFactor=Qd(this.beginCenterScreen,this.tmpCentroid2d),ys(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=r,o=this.rotationValueSmooth.value,a=o+ZH(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(a);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),l_(this.currentCamera,n,AO(s,c)),this.constraintOptions.interactionType=Gt.TUMBLE,this.constraintOptions.interactionFactor=Qd(Math.abs(e.radius*c)),ys(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new US({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Tb({view:this.view,momentum:i,center:this.beginCenter,axis:this.planeHorizontal});const r=this.panMomentumEstimator.evaluateMomentum();return r?new EM({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=O()),YH(t,i,s,r[n]),n+=1}),r}};u([d({constructOnly:!0})],dN.prototype,"view",void 0),dN=u([P("esri.views.3d.state.controllers.local.PinchAndPanController")],dN);class soe extends Ho{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!PQ(t.data,this.pointerAction))return;const i=t.timestamp-this.lastEndTimestamp,r=40,s=this.momentum&&this.momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const r=this.controller.end(t.data);i&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new hN({view:this.view}):new dN({view:this.view})}}class Eet extends Ho{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class Txe extends Ho{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class Cet extends Txe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class Aet extends Txe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class Ret extends Ho{constructor(t,i=!1){super(!0),this.view=t,this.invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var s,n,o;const i=this.invert?-1:1,r=Yr(0,t.data.delta*i);switch(t.data.action){case"begin":(s=this.cameraController)==null||s.end(),this.cameraController=new kS({view:this.view,pivot:oc.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":(n=this.cameraController)==null||n.update(r);break;case"end":(o=this.cameraController)==null||o.end(),this.cameraController=null}}}function noe(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>Pet(i,e.axisThreshold))}:{buttons:[],axes:[]}}function Met(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function Oet(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function Pet(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class Iet{constructor(t,i){this.element=t,this.input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this.inputDevices[a];l&&(this._emitGamepadEvent(o,noe(l),!1),this.inputDevices.splice(a,1),this.latestUpdate.splice(a,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const i=new DY(t);i.deviceType!=="unknown"&&(this.inputDevices[t.index]=i,this.input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=uw({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this.element.contains(document.activeElement),r=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const o=this.latestUpdate[s.index],a=noe(n),l=r||Oet(a);o&&(o.timestamp===s.timestamp||!o.active&&l||Met(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this.callback&&this.callback({device:this.inputDevices[t.index],state:i,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const ooe=he("trident"),aoe=he("edge"),$et=he("chrome"),Let=he("ff"),Det=he("safari"),Nx={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class yU{constructor(t,i){this.input=i,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new Iet(t,this.input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener(QV[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&QV[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(QV[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Nx.touchNone:Nx.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Nx.touchPan:Nx.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Nx.touchNone),this._element.classList.remove(Nx.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=K1e(this._element,t);return yU.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=Qje(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:(ooe||aoe)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}ooe||aoe?r*=.7:$et||Det?r*=.6:Let&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,o)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}yU.test={disableSubpixelCoordinates:!1};const QV={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class Net extends Ho{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function Sxe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function Fet(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function ket(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:Sp()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[T,E]=e,[C,A]=[E.x-T.x,E.y-T.y];return t.radius=Math.sqrt(C*C+A*A)/2,t.center.x=(T.x+E.x)/2,t.center.y=(T.y+E.y)/2,t}let i=0,r=0;for(let T=0;T<e.length;T++)i+=e[T].x,r+=e[T].y;i/=e.length,r/=e.length;const s=e.map(T=>T.x-i),n=e.map(T=>T.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,f=0;for(let T=0;T<s.length;T++){const E=s[T],C=n[T],A=E*E,I=C*C;o+=A,a+=I,l+=E*C,c+=A*E,h+=I*C,p+=E*I,f+=C*A}const m=.5*(c+p),y=.5*(h+f),v=o*a-l*l,w=(m*a-y*l)/v,b=(o*y-l*m)/v,S=Sp(w+i,b+r);return{radius:Math.sqrt(w*w+b*b+(o+a)/e.length),center:S}}class Uet extends Ho{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:i.buttons,timestamp:s,pointers:zet(this.activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=f$(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(i,s);const n=pN(s,Exe(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this.activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=f$(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=f$(this.activePointerMap);this.activePointerMap.forEach(r=>{r.initialAngle=pN(r,i)-t,r.lastAngle=pN(r,i)-t})}_emitEvent(t,i,r){const s=f$(this.activePointerMap);this.drag.emit(this._createPayload(t,i,s,r),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this.activePointerMap.get(i)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this.isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(r),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function Exe(e){const t=[];return e.forEach(i=>{t.push(Sp(i.event.x,i.event.y))}),ket(t)}function f$(e){const t=Exe(e);let i=0;return e.forEach(r=>{let s=pN(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function zet(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function pN(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var loe;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(loe||(loe={}));const Av={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class Vet extends Ho{constructor(t=Av.maximumDoubleClickDelay,i=Av.maximumDoubleClickDistance,r=Av.maximumDoubleTouchDelay,s=Av.maximumDoubleTouchDistance,n=O5){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=cn(t.doubleClickTimeout))}get hasPendingInputs(){return sn(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_handleImmediateClick(t){const i=t.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s){const n=i.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Sxe(s.event.data,i)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(t)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const i=this._pointerId(t.data),r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(i,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(i),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const i=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(i,!0)}_handleDrag(t){const i=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(i,!0)}_clearDoubleClickTimeout(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,i&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class Bet extends Ho{constructor(t=Av.maximumDoubleClickDelay,i=Av.maximumDoubleClickDistance,r=Av.maximumDoubleTouchDelay,s=Av.maximumDoubleTouchDistance,n=O5){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=this._pointerId(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerLoss(t,i){const r=t.data,s=this._pointerId(r),n=this._pointerState.get(s);if(n&&i==="pointer-up"&&n.downButton===r.native.button){const o=n.immediateDoubleClick;if(o){o.timeoutHandle.remove();const a=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Sxe(o,t.data)>a?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,o.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_removeState(t){const i=this._pointerId(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const XC={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class Get extends Ho{constructor(t=XC.maximumClickDelay,i=XC.movementUntilMouseDrag,r=XC.movementUntilPenDrag,s=XC.movementUntilTouchDrag,n=XC.holdDelay,o=O5){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):Fet(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class jet{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this.currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class Het extends Ho{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new jet({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this.dragEventSeparator.handle(r))}get failed(){return this.state==="failed"}_observeStart(t,i){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;i.pointers.forEach(v=>{r=Math.max(r,v.x),s=Math.min(s,v.x),n=Math.max(n,v.y),o=Math.min(o,v.y)});let a=-1/0,l=1/0,c=-1/0,h=1/0;t.pointers.forEach(v=>{a=Math.max(a,v.x),l=Math.min(l,v.x),c=Math.max(c,v.y),h=Math.min(h,v.y)});const p=r-s,f=n-o,m=a-l,y=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(m-p)<=this._maxDelta&&Math.abs(y-f)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}}let pf=class extends Se{constructor(){super(...arguments),this._handles=new Nt}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new yU(this.view.surface,e.input);const t=[new Bet,new Get,new Vet,new Uet(this.view.navigation),new Het],i=new M0({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new Net],kv.INTERNAL),this._modeDragPan=new soe(e,"primary"),this._modeDragRotate=new WV(e,"secondary",oc.CENTER),this._modeDragZoom=new PKe(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new Eet(e),new AKe(e),new fet(e),new met(e,r.pan),new get(e),new Aet(e,r.resetTilt),new Cet(e,r.resetHeading),new WV(e,"primary",oc.EYE,[r.lookAround]),new WV(e,"secondary",oc.CENTER,[r.lookAround]),new soe(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new Ret(e)],kv.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(ie(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},Rt))}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=KH.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([d()],pf.prototype,"view",void 0),u([d({value:"pan"})],pf.prototype,"primaryDragAction",null),u([d({value:"default"})],pf.prototype,"mode",null),u([d({readOnly:!0})],pf.prototype,"hasPendingInputs",null),u([d()],pf.prototype,"latestPointerType",null),u([d()],pf.prototype,"latestPointerLocation",null),u([d()],pf.prototype,"_inputManager",void 0),pf=u([P("esri.views.3d.input.SceneInputManager")],pf);const KH=new Map,JV=new Map,KV=new Map;JV.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),JV.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),KV.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),KV.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),KH.set("default",JV),KH.set("pro",KV);const qet=pf;let hs=class extends Se{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([d()],hs.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([d()],hs.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([d()],hs.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([d()],hs.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([d()],hs.prototype,"LABELS_SHOW_BORDER",void 0),u([d()],hs.prototype,"TEXT_SHOW_BASELINE",void 0),u([d()],hs.prototype,"TEXT_SHOW_BORDER",void 0),u([d()],hs.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([d()],hs.prototype,"OVERLAY_SHOW_CENTER",void 0),u([d()],hs.prototype,"SHOW_POI",void 0),u([d()],hs.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([d()],hs.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([d()],hs.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([d()],hs.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([d()],hs.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([d()],hs.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([d()],hs.prototype,"I3S_TREE_SHOW_TILES",void 0),u([d()],hs.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([d()],hs.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([d()],hs.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([d()],hs.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([d()],hs.prototype,"LINE_WIREFRAMES",void 0),hs=u([P("esri.views.3d.support.DebugFlags")],hs);const Wi=new hs;let cu,h2,eq=!1,tq=!1,iq=!1,rq=!1,CM=null;function Wet(e,t){if(!tq||!h2)return;Cxe();const i=h2;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),Axe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function Xet(e){iq=Wi.DECONFLICTOR_SHOW_VISIBLE,rq=Wi.DECONFLICTOR_SHOW_INVISIBLE,eq=iq||rq,tq=Wi.DECONFLICTOR_SHOW_GRID,CM=null,eq||tq?CM=()=>Zet(e):cu&&(cu.parentElement.removeChild(cu),cu=null)}function Cxe(){CM&&(CM(),CM=null)}function Zet(e){cu==null&&(cu=document.createElement("canvas"),cu.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(cu));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;cu.setAttribute("width",`${o}px`),cu.setAttribute("height",`${a}px`),cu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),h2=cu.getContext("2d"),h2.clearRect(0,0,s,n),h2.font="12px Arial"}function Axe(e,t,i,r,s){Cxe();const n=cu.height,o=h2;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function Yet(e,t){eq&&(t&&iq||!t&&rq)&&Axe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var ho,xu;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(ho||(ho={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(xu||(xu={}));function Rxe(e,t){return new vU(e,Ixe,t)}function Qet(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=Ixe;return new vU(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:eB.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:eB.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:eB.minPixelSize},t)}function Jet(e){return Math.abs(e*e*e)}function Mxe(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return ZC.scale=Math.min(r.divisor/(t-r.offset),1),ZC.factor=Jet(e),ZC.minPixelSize=r.minPixelSize,ZC.paddingPixels=s,ZC}function Oxe(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function DQ(e,t){return Math.max(Yt(e*t.scale,e,t.factor),Oxe(e,t))}function Ket(e,t,i){const r=Mxe(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,DQ(1,r)}function coe(e,t,i,r){r.scale=Ket(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function Pxe(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,Oxe(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function ett(e,t,i,r){return DQ(e,Mxe(t,i,r))}class vU{constructor(t,i,r,s=ttt(),n){this.viewingMode=t,this.description=i,this.ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===Ge.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new vU(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this.description,{fovY:a,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,i),h=this.coverageCompensation(t,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,m=Math.sin(p)*l,y=.5*Math.PI-p-a*(.5-s*h),v=m/Math.cos(y),w=y+a*n*h,b=(v-f*(m/Math.cos(w)))/(1-f);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=b,r.divisor=v-b,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(t,i,r=uoe){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=uoe){const s=this.description.curvatureDependent,n=1+t.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=De((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=Yt(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=Yt(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}}const Ixe={curvatureDependent:{min:{curvature:Dt(10),tiltAngle:Dt(12),scaleFallOffFactor:.5},max:{curvature:Dt(70),tiltAngle:Dt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},eB={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function ttt(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const ZC={scale:0,factor:0,minPixelSize:0,paddingPixels:0},uoe={tiltAngle:0,scaleFallOffFactor:0};function itt(e){return e instanceof Float32Array&&e.length>=16}function rtt(e){return Array.isArray(e)&&e.length>=16}function stt(e){return itt(e)||rtt(e)}var K;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(K||(K={}));function NQ(e){e.vertex.code.add(x`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(x`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(x`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(x`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(x`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(x`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(x`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function ntt(e){e.uniforms.add(new ni("screenSizePerspective",t=>$xe(t.screenSizePerspective)))}function _U(e){e.uniforms.add(new ni("screenSizePerspectiveAlignment",t=>$xe(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function $xe(e){return Ji(ott,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const ott=Xt();class sq extends Kr{constructor(t,i){super(t,"mat4",ki.Draw,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}function nm(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",Ba):e.uniforms.add(new Ga("cameraPosition",(i,r)=>se(Lxe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Iu(e,t){if(e.vertex.uniforms.add(new Tr("proj",(r,s)=>s.camera.projectionMatrix)),t.instancedDoublePrecision){const r=(n,o)=>se(Lxe,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new Tr("view",(n,o)=>qa(hoe,o.camera.viewMatrix,r(n,o))));const s=new Tt("localOrigin",r);return e.vertex.uniforms.add(s),s}e.vertex.uniforms.add(new sq("view",(r,s)=>qa(hoe,s.camera.viewMatrix,r.origin)));const i=new Ga("localOrigin",r=>r.origin);return e.vertex.uniforms.add(i),i}const hoe=U3(),Lxe=O();function Dxe(e,t){const i=e.vertex;t.hasVerticalOffset?(Nxe(i),t.hasScreenSizePerspective&&(e.include(NQ),_U(i),nm(e.vertex,t)),i.code.add(x`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?x`vec3 worldNormal = normalize(worldPos + localOrigin);`:x`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?x`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:x`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(x`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const att=Xt();function Nxe(e){e.uniforms.add(new ni("verticalOffset",(t,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Ji(att,n*a,o,r,s)}))}var Sh;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(Sh||(Sh={}));var xl;function Fxe(e,t){e.include(NQ),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.NORMAL,"vec3"),e.attributes.add(M.AUXPOS1,"vec4");const i=e.vertex;Iu(e,t),nm(i,t),i.uniforms.add([new ni("viewport",(r,s)=>s.camera.fullViewport),new We("polygonOffset",r=>r.shaderPolygonOffset),new We("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new We("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===Sh.Occluded?1:s.renderTransparentlyOccludedHUD===Sh.NotOccluded?0:.75),new jt("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&Nxe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(x`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(x`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new Tr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),t.isDraped||(i.uniforms.add(new We("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(x`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===xl.Screen&&i.uniforms.add(new We("pixelRatio",(r,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&_U(i),i.code.add(x`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===xl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?x`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==xl.Screen?x`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===xl.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===xl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(x`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(xl||(xl={}));const m$=Gs();function bU(e,t,i,r,s,n,o){if(!eP(t))if(e.boundingInfo){pt(e.primitiveType===Ol.Triangle);const a=i.tolerance;kxe(e.boundingInfo,r,s,a,n,o)}else{const a=e.indices.get(M.POSITION),l=e.vertexAttributes.get(M.POSITION);rP(r,s,0,a.length/3,a,l,void 0,n,o)}}const ltt=O();function kxe(e,t,i,r,s,n){if(R(e))return;const o=zxe(t,i,ltt);if(Upe(m$,e.getBBMin()),zpe(m$,e.getBBMax()),_(s)&&s.applyToAabb(m$),kQ(m$,t,o,r)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>ptt){const p=e.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&kxe(p[f],t,i,r,s,n);return}}rP(t,i,0,h,l,c,a,s,n)}}const Uxe=O();function rP(e,t,i,r,s,n,o,a,l){if(o)return ctt(e,t,i,r,s,n,o,a,l);const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],y=t[0]-p,v=t[1]-f,w=t[2]-m;for(let b=i,S=3*i;b<r;++b){let T=h*s[S++],E=c[T++],C=c[T++],A=c[T];T=h*s[S++];let I=c[T++],D=c[T++],L=c[T];T=h*s[S++];let z=c[T++],B=c[T++],V=c[T];_(a)&&([E,C,A]=a.applyToVertex(E,C,A,b),[I,D,L]=a.applyToVertex(I,D,L,b),[z,B,V]=a.applyToVertex(z,B,V,b));const Q=I-E,Z=D-C,ce=L-A,oe=z-E,$=B-C,U=V-A,G=v*U-$*w,W=w*oe-U*y,X=y*$-oe*v,ee=Q*G+Z*W+ce*X;if(Math.abs(ee)<=Number.EPSILON)continue;const q=p-E,te=f-C,ge=m-A,Te=q*G+te*W+ge*X;if(ee>0){if(Te<0||Te>ee)continue}else if(Te>0||Te<ee)continue;const ke=te*ce-Z*ge,_e=ge*Q-ce*q,me=q*Z-Q*te,Ce=y*ke+v*_e+w*me;if(ee>0){if(Ce<0||Te+Ce>ee)continue}else if(Ce>0||Te+Ce<ee)continue;const Fe=(oe*ke+$*_e+U*me)/ee;Fe>=0&&l(Fe,FQ(Q,Z,ce,oe,$,U,Uxe),b,!1)}}function ctt(e,t,i,r,s,n,o,a,l){const c=n.data,h=n.stride||n.size,p=e[0],f=e[1],m=e[2],y=t[0]-p,v=t[1]-f,w=t[2]-m;for(let b=i;b<r;++b){const S=o[b];let T=3*S,E=h*s[T++],C=c[E++],A=c[E++],I=c[E];E=h*s[T++];let D=c[E++],L=c[E++],z=c[E];E=h*s[T];let B=c[E++],V=c[E++],Q=c[E];_(a)&&([C,A,I]=a.applyToVertex(C,A,I,b),[D,L,z]=a.applyToVertex(D,L,z,b),[B,V,Q]=a.applyToVertex(B,V,Q,b));const Z=D-C,ce=L-A,oe=z-I,$=B-C,U=V-A,G=Q-I,W=v*G-U*w,X=w*$-G*y,ee=y*U-$*v,q=Z*W+ce*X+oe*ee;if(Math.abs(q)<=Number.EPSILON)continue;const te=p-C,ge=f-A,Te=m-I,ke=te*W+ge*X+Te*ee;if(q>0){if(ke<0||ke>q)continue}else if(ke>0||ke<q)continue;const _e=ge*oe-ce*Te,me=Te*Z-oe*te,Ce=te*ce-Z*ge,Fe=y*_e+v*me+w*Ce;if(q>0){if(Fe<0||ke+Fe>q)continue}else if(Fe>0||ke+Fe<q)continue;const Li=($*_e+U*me+G*Ce)/q;Li>=0&&l(Li,FQ(Z,ce,oe,$,U,G,Uxe),S,!1)}}const doe=O(),poe=O();function FQ(e,t,i,r,s,n,o){return se(doe,e,t,i),se(poe,r,s,n),ct(o,doe,poe),we(o,o),o}function zxe(e,t,i){return se(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function kQ(e,t,i,r){return UQ(e,t,i,r,1/0)}function UQ(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-r-t[2])*i[2],f=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<s)}function Vxe(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;_(s)&&(n=ett(n,r,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return De(o*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function Bxe(e,t){const i=t?Bxe(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=dtt(s)),s==null&&r in i||(i[r]=s)}return i}function utt(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?e[r]===null?(e[r]=s.slice(),i=!0):fW(e[r],s)&&(i=!0):e[r]!==s&&(i=!0,e[r]=s))}return i}function htt(e,t,i,r,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(M.POSITION).data,a=e.vertexAttributes.get(M.SIZE),l=a&&a.data[0],c=r[0],h=r[1],p=((l+s)/2+4)*e.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],w=o[y+1],b=c-v,S=h-w,T=o[y+3]-v,E=o[y+4]-w,C=De((T*b+E*S)/(T*T+E*E),0,1),A=T*C-b,I=E*C-S,D=A*A+I*I;D<f&&(f=D,m=y/3)}f<p*p&&n(i.dist,i.normal,m,!1)}function dtt(e){const t=[];return e.forEach(i=>t.push(i)),t}const Gxe={multiply:1,ignore:2,replace:3,tint:4},ptt=1e3;class bm extends K3{constructor(t,i){super(),this.type=Mp.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Ui,this._parameters=Bxe(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,i=!0){utt(this._parameters,t)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){_(this.repository)&&this.repository.materialChanged(this)}}var Dr;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(Dr||(Dr={}));class dC extends Ws{constructor(){super(...arguments),this.renderOccluded=Dr.Occlude}}function bEt(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=t[e[l]],r+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function ftt(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const l=2*e[a];s[r]=t[l],s[r+1]=t[l+1],r+=n}}function jxe(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}}function EE(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}}function wU(e,t,i,r,s,n=1){if(!i)return void jxe(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,c=i[0],h=i[1],p=i[2],f=i[4],m=i[5],y=i[6],v=i[8],w=i[9],b=i[10],S=i[12],T=i[13],E=i[14];if(s*=a,n===1)for(let C=0;C<l;++C){const A=3*e[C],I=t[A],D=t[A+1],L=t[A+2];o[s]=c*I+f*D+v*L+S,o[s+1]=h*I+m*D+w*L+T,o[s+2]=p*I+y*D+b*L+E,s+=a}else for(let C=0;C<l;++C){const A=3*e[C],I=t[A],D=t[A+1],L=t[A+2],z=c*I+f*D+v*L+S,B=h*I+m*D+w*L+T,V=p*I+y*D+b*L+E;for(let Q=0;Q<n;++Q)o[s]=z,o[s+1]=B,o[s+2]=V,s+=a}}function zQ(e,t,i,r,s,n=1){if(!i)return void jxe(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],v=o[6],w=o[8],b=o[9],S=o[10],T=!qX(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const I=3*e[A],D=t[I],L=t[I+1],z=t[I+2];let B=h*D+m*L+w*z,V=p*D+y*L+b*z,Q=f*D+v*L+S*z;if(T){const Z=B*B+V*V+Q*Q;if(Z<C&&Z>E){const ce=1/Math.sqrt(Z);B*=ce,V*=ce,Q*=ce}}a[s+0]=B,a[s+1]=V,a[s+2]=Q,s+=l}else for(let A=0;A<c;++A){const I=3*e[A],D=t[I],L=t[I+1],z=t[I+2];let B=h*D+m*L+w*z,V=p*D+y*L+b*z,Q=f*D+v*L+S*z;if(T){const Z=B*B+V*V+Q*Q;if(Z<C&&Z>E){const ce=1/Math.sqrt(Z);B*=ce,V*=ce,Q*=ce}}for(let Z=0;Z<n;++Z)a[s+0]=B,a[s+1]=V,a[s+2]=Q,s+=l}}function mtt(e,t,i,r,s,n=1){if(!i)return void EE(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],f=o[2],m=o[4],y=o[5],v=o[6],w=o[8],b=o[9],S=o[10],T=!qX(o),E=1e-6,C=1-E;if(s*=l,n===1)for(let A=0;A<c;++A){const I=4*e[A],D=t[I],L=t[I+1],z=t[I+2],B=t[I+3];let V=h*D+m*L+w*z,Q=p*D+y*L+b*z,Z=f*D+v*L+S*z;if(T){const ce=V*V+Q*Q+Z*Z;if(ce<C&&ce>E){const oe=1/Math.sqrt(ce);V*=oe,Q*=oe,Z*=oe}}a[s+0]=V,a[s+1]=Q,a[s+2]=Z,a[s+3]=B,s+=l}else for(let A=0;A<c;++A){const I=4*e[A],D=t[I],L=t[I+1],z=t[I+2],B=t[I+3];let V=h*D+m*L+w*z,Q=p*D+y*L+b*z,Z=f*D+v*L+S*z;if(T){const ce=V*V+Q*Q+Z*Z;if(ce<C&&ce>E){const oe=1/Math.sqrt(ce);V*=oe,Q*=oe,Z*=oe}}for(let ce=0;ce<n;++ce)a[s+0]=V,a[s+1]=Q,a[s+2]=Z,a[s+3]=B,s+=l}}function k4(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,n===1){if(i===4)for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else if(i===4)for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}function xU(e,t,i,r,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case M.POSITION:{pt(a.size===3);const c=s.getField(o,Xi);c&&wU(l,a.data,i,c,n);break}case M.NORMAL:{pt(a.size===3);const c=s.getField(o,Xi);c&&zQ(l,a.data,r,c,n);break}case M.UV0:{pt(a.size===2);const c=s.getField(o,Kh);c&&ftt(l,a.data,c,n);break}case M.COLOR:{pt(a.size===3||a.size===4);const c=s.getField(o,Fl);c&&k4(l,a.data,a.size,c,n);break}case M.SYMBOLCOLOR:{pt(a.size===3||a.size===4);const c=s.getField(o,Fl);c&&k4(l,a.data,a.size,c,n);break}case M.TANGENT:{pt(a.size===4);const c=s.getField(o,qn);c&&mtt(l,a.data,r,c,n);break}}}}function ZO(e,t,i=0){const r=De(e,0,vtt);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*_tt(r*gtt[s]))}function VQ(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*ytt[r];return i}const gtt=[1,256,65536,16777216],ytt=[1/256,1/65536,1/16777216,1/4294967296],vtt=VQ(new Uint8ClampedArray([255,255,255,255]));function _tt(e){return e-Math.floor(e)}function btt(){if(R(tB)){const e=t=>xi(`esri/libs/basisu/${t}`);tB=import("./basis_transcoder.c4107541.js").then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return tB}let tB;var Sb;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})(Sb||(Sb={}));let yp=null,g$=null;async function Hxe(){return R(g$)&&(g$=btt(),yp=await g$),g$}function wtt(e,t){if(R(yp))return e.byteLength;const i=new yp.BasisFile(new Uint8Array(e)),r=Wxe(i)?qxe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function xtt(e,t){if(R(yp))return e.byteLength;const i=new yp.KTX2File(new Uint8Array(e)),r=Xxe(i)?qxe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function qxe(e,t,i,r,s){const n=Pbe(t?rs.COMPRESSED_RGBA8_ETC2_EAC:rs.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function Wxe(e){return e.getNumImages()>=1&&!e.isUASTC()}function Xxe(e){return e.getFaces()>=1&&e.isETC1S()}async function Ttt(e,t,i){R(yp)&&(yp=await Hxe());const r=new yp.BasisFile(new Uint8Array(i));if(!Wxe(r))return null;r.startTranscoding();const s=Zxe(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function Stt(e,t,i){R(yp)&&(yp=await Hxe());const r=new yp.KTX2File(new Uint8Array(i));if(!Xxe(r))return null;r.startTranscoding();const s=Zxe(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function Zxe(e,t,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?r?[Sb.ETC2_RGBA,rs.COMPRESSED_RGBA8_ETC2_EAC]:[Sb.ETC1_RGB,rs.COMPRESSED_RGB8_ETC2]:c?r?[Sb.BC3_RGBA,rs.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[Sb.BC1_RGB,rs.COMPRESSED_RGB_S3TC_DXT1_EXT]:[Sb.RGBA32,Ve.RGBA],f=t.hasMipmap?i:Math.min(1,i),m=[];for(let b=0;b<f;b++)m.push(new Uint8Array(o(b,h))),a(b,h,m[b]);const y=m.length>1,v=y?Ke.LINEAR_MIPMAP_LINEAR:Ke.LINEAR,w=ye(F({},t),{samplingMode:v,hasMipmap:y,internalFormat:p,width:s,height:n});return new nt(e,w,{type:"compressed",levels:m})}const YC=fe.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),Ett=542327876,Ctt=131072,Att=4;function BQ(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function Rtt(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const Mtt=BQ("DXT1"),Ott=BQ("DXT3"),Ptt=BQ("DXT5"),Itt=31,$tt=0,Ltt=1,Dtt=2,Ntt=3,Ftt=4,ktt=7,Utt=20,ztt=21;function Vtt(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=Btt(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?Ke.LINEAR_MIPMAP_LINEAR:Ke.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new nt(e,t,r)}function Btt(e,t){const i=new Int32Array(e,0,Itt);if(i[$tt]!==Ett)return YC.error("Invalid magic number in DDS header"),null;if(!(i[Utt]&Att))return YC.error("Unsupported format, must contain a FourCC code"),null;const r=i[ztt];let s,n;switch(r){case Mtt:s=8,n=rs.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case Ott:s=16,n=rs.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case Ptt:s=16,n=rs.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return YC.error("Unsupported FourCC code:",Rtt(r)),null}let o=1,a=i[Ftt],l=i[Ntt];(3&a)==0&&(3&l)==0||(YC.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,f;i[Dtt]&Ctt&&t!==!1&&(o=Math.max(1,i[ktt])),o===1||N2(a)&&N2(l)||(YC.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let m=i[Ltt]+4;const y=[];for(let v=0;v<o;++v)f=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,m,f),y.push(p),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:y},internalFormat:n,width:c,height:h}}class Ns extends K3{constructor(t,i){super(),this.data=t,this.type=Mp.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new as,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:wt.REPEAT,t:wt.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||Uv.STRETCH,this.estimatedTexMemRequired=Ns._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;R(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(Wv(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const i=!t.paused;if(t.src=t.src,i&&t.autoplay){const r=()=>{t.removeEventListener("canplay",r),t.play()};t.addEventListener("canplay",r)}}}_startPreloadImageElement(t){hm(t.src)||Wv(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(R(t))return 0;if(gC(t)||lb(t))return i.encoding===Ns.KTX2_ENCODING?xtt(t,i.mipmap):i.encoding===Ns.BASIS_ENCODING?wtt(t,i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?Ns._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?Ke.LINEAR_MIPMAP_LINEAR:Ke.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(_(this._glTexture))return this._glTexture;if(_(this._loadingPromise))return this._loadingPromise;const r=this.data;return R(r)?(this._glTexture=new nt(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):(gC(r)||lb(r))&&this.params.encoding===Ns.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):(gC(r)||lb(r))&&this.params.encoding===Ns.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):(gC(r)||lb(r))&&this.params.encoding===Ns.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):lb(r)?this._loadFromPixelData(t,r):gC(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this.data instanceof HTMLVideoElement)||R(this._glTexture)||this.data.readyState<AM.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(_(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this.data),this._drawStretchedTexture(t,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this.data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(t,i){return this._glTexture=Vtt(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>Stt(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>Ttt(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){pt(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?Ve.LUMINANCE:this.params.components===3?Ve.RGB:Ve.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new nt(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await Ap(r,{signal:s});return fi(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await pfe(r,r.src,!1,s);return fi(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=AM.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),cn(h)},l=()=>{r.readyState>=AM.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,r,i)))},c=p=>{a(),o(p||new j("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=ha(s,()=>c(mi()))}))}_loadFromImage(t,i,r){const s=Ns._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?Ve.RGB:Ve.RGBA,!this._requiresPowerOfTwo(t,n)||N2(s.width)&&N2(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new nt(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=wt.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return!zn(t.gl)&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:o,height:a}=r,l=D2(o),c=D2(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case Uv.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new nt(t,s),h.updateData(0,0,0,o,a,i);break;case Uv.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,i,r,s){const n=new nt(t,r),o=new Rr(t,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},n),a=new nt(t,{target:ft.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=Xa(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,i,r,s,n,o){t.bindFramebuffer(r);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height);const l=t.bindTechnique(i);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",n),t.bindVAO(s),t.drawArrays($t.TRIANGLE_STRIP,0,ko(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height)}unload(){if(_(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(_(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),_(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var AM;Ns.DDS_ENCODING="image/vnd-ms.dds",Ns.KTX2_ENCODING="image/ktx2",Ns.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(AM||(AM={}));const YO=128,GQ=.5;function Yxe(e,t=YO,i=t*GQ,r=0){const s=Gtt(e,t,i,r);return new Ns(s,{mipmap:!1,wrap:{s:wt.CLAMP_TO_EDGE,t:wt.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function Gtt(e,t=YO,i=t*GQ,r=0){switch(e){case"circle":default:return jtt(t,i);case"square":return Htt(t,i);case"cross":return Wtt(t,i,r);case"x":return Xtt(t,i,r);case"kite":return qtt(t,i);case"triangle":return Ztt(t,i);case"arrow":return Ytt(t,i)}}function jtt(e,t){const i=e/2-.5;return sP(e,Kxe(i,i,t/2))}function Htt(e,t){return Qxe(e,t,!1)}function qtt(e,t){return Qxe(e,t,!0)}function Wtt(e,t,i=0){return Jxe(e,t,!1,i)}function Xtt(e,t,i=0){return Jxe(e,t,!0,i)}function Ztt(e,t){return sP(e,eTe(e/2,t,t/2))}function Ytt(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=Kxe(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=eTe(s,i,r);return sP(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function Qxe(e,t,i){return i&&(t/=Math.SQRT2),sP(e,(r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function Jxe(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return sP(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function Kxe(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function eTe(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function sP(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let o=t(s,r);o=o/e+.5,ZO(o,i,4*n)}return i}class wEt extends Ws{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function Qtt(e,t){tTe(e,t,[new Tt("slicePlaneOrigin",(i,r)=>nTe(t,i,r)),new Tt("slicePlaneBasis1",(i,r)=>{var s;return U4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Tt("slicePlaneBasis2",(i,r)=>{var s;return U4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function vs(e,t){tTe(e,t,[new Ga("slicePlaneOrigin",(i,r)=>nTe(t,i,r)),new Ga("slicePlaneBasis1",(i,r)=>{var s;return U4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Ga("slicePlaneBasis2",(i,r)=>{var s;return U4(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function tTe(e,t,i){if(!t.hasSlicePlane){const o=x`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=x`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=x`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?x`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:x`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function iTe(e,t,i){return e.instancedDoublePrecision?se(Jtt,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function rTe(e,t){return _(e)?pe(z4,t.origin,e):t.origin}function sTe(e,t,i){return e.hasSliceTranslatedView?_(t)?qa(Ktt,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function nTe(e,t,i){if(R(i.slicePlane))return Ba;const r=iTe(e,t,i),s=rTe(r,i.slicePlane),n=sTe(e,r,i);return _(n)?ze(z4,s,n):s}function U4(e,t,i,r){if(R(r)||R(i.slicePlane))return Ba;const s=iTe(e,t,i),n=rTe(s,i.slicePlane),o=sTe(e,s,i);return _(o)?(de(QC,r,n),ze(z4,n,o),ze(QC,QC,o),pe(QC,QC,z4)):r}const Jtt=O(),z4=O(),QC=O(),Ktt=Ae();function eit(e,t){const{vertex:i,fragment:r}=e;t.hasMultipassGeometry&&i.include(swe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(x`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?x`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&r.include(Uu),t.hasMultipassTerrain&&r.uniforms.add([new jt("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new vi("nearFar",(s,n)=>n.camera.nearFar),new vi("inverseViewport",(s,n)=>n.inverseViewport)]),r.include(Lc),r.code.add(x`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?x`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const tit=bi(1,1,0,1),oTe=bi(1,0,1,1);function wy(e){e.fragment.uniforms.add(new jt("depthTex",(t,i)=>i.highlightDepthTexture)),e.fragment.uniforms.add(new vi("highlightViewportPixelSz",(t,i)=>i.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",tit).add("unoccludedHighlightFlag","vec4",oTe),e.fragment.code.add(x`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class TU extends Kr{constructor(t,i,r){super(t,"vec4",ki.Pass,(s,n,o)=>s.setUniform4fv(t,i(n,o)),r)}}class aa extends Kr{constructor(t,i,r){super(t,"float",ki.Pass,(s,n,o)=>s.setUniform1fv(t,i(n,o)),r)}}class nP extends Kr{constructor(t,i){super(t,"mat3",ki.Pass,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class jQ extends dC{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ue(1,1,1),this.vvSizeMaxSize=Ue(100,100,100),this.vvSizeOffset=Ue(0,0,0),this.vvSizeFactor=Ue(1,1,1),this.vvSizeValue=Ue(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Or()}}const vp=8;function d2(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(M.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new Tt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Tt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Tt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Tt("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new nP("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new Tt("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(x`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(x`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?x`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(x`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",vp),t.hasVvInstancing&&i.uniforms.add([new aa("vvColorValues",r=>r.vvColorValues,vp),new TU("vvColorColors",r=>r.vvColorColors,vp)]),i.code.add(x`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?x`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(x`vec4 vvColor() { return vec4(1.0); }`)}const V4=.1,Vo=.001;function iit(e){const t=new Zi,i=e.signedDistanceFieldEnabled;if(t.include(hQ),t.include(Fxe,e),t.include(vs,e),e.output===K.Occlusion)return t.include(eit,e),t;const{vertex:r,fragment:s}=t;t.include(NQ),s.include(Lc),s.include(vm),t.include(d2,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),r.uniforms.add([new ni("viewport",(c,h)=>h.camera.fullViewport),new vi("screenOffset",(c,h)=>yi(aTe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new vi("anchorPosition",c=>B4(c)),new ni("materialColor",c=>c.color),new We("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new ni("outlineColor",c=>c.outlineColor)),s.uniforms.add([new ni("outlineColor",c=>foe(c)?c.outlineColor:Vf),new We("outlineSize",c=>foe(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(ntt(r),_U(r)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.COLOR,"vec4"),t.attributes.add(M.SIZE,"vec2"),t.attributes.add(M.AUXPOS2,"vec4"),r.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?x`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=x`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?i?x`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x`posProj += quadOffset;`;e.vvColor&&r.uniforms.add([new TU("vvColorColors",c=>c.vvColorColors,vp),new aa("vvColorValues",c=>c.vvColorValues,vp)]),r.uniforms.add(new vi("textureCoordinateScaleFactor",c=>_(c.texture)&&_(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:Age)),r.code.add(x`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${x.float(Vo)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.float(Vo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?x`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new jt("tex",c=>c.texture));const a=e.debugDrawLabelBorder?x`(isBorder > 0.0 ? 0.0 : ${x.float(V4)})`:x.float(V4),l=x`
    ${e.debugDrawLabelBorder?x`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?x`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${x.float(YO)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.float(Vo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?x`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===K.Alpha&&s.code.add(x`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===K.Color&&s.code.add(x`
    void main() {
      ${l}
      ${e.transparencyPassType===gt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===K.Highlight&&(t.include(wy),s.code.add(x`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?x`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function foe(e){return e.outlineColor[3]>0&&e.outlineSize>0}function B4(e,t=aTe){return e.textureIsSignedDistanceField?rit(e.anchorPosition,e.distanceFieldBoundingBox,t):_o(t,e.anchorPosition),t}function rit(e,t,i){_(t)?yi(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):yi(i,0,0)}const aTe=it(),sit=Object.freeze(Object.defineProperty({__proto__:null,build:iit,calculateAnchorPosForRendering:B4},Symbol.toStringTag,{value:"Module"})),$u=bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),nit=ym(Re.ONE,Re.ONE),lTe=ym(Re.ZERO,Re.ONE_MINUS_SRC_ALPHA);function xy(e){return e===gt.FrontFace?null:e===gt.Alpha?lTe:nit}function SU(e){return e===gt.FrontFace?Nl:null}const EU=5e5,CU={factor:-1,units:-2};function AU(e){return e?CU:null}function w_(e,t=gr.LESS){return e===gt.NONE||e===gt.FrontFace?t:gr.LEQUAL}class oP extends pr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global}initializeProgram(t){const i=oP.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace,n=this.configuration.hasPolygonOffset&&oit,o=(r||s)&&i.output!==K.Highlight?(i.depthEnabled||i.output===K.Occlusion)&&Nl:null;return Bt({blending:i.output===K.Color||i.output===K.Alpha||i.output===K.Highlight?r?ait:xy(t):null,depthTest:{func:gr.LEQUAL},depthWrite:o,colorWrite:ri,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===K.Occlusion?$t.POINTS:$t.TRIANGLES}}oP.shader=new rr(sit,()=>import("./HUDMaterial.glsl.c4ee055e.js"));const oit={factor:0,units:-4},ait=ym(Re.ONE,Re.ONE_MINUS_SRC_ALPHA);class la extends Wa{}u([H({constValue:!0})],la.prototype,"hasSliceHighlight",void 0),u([H({constValue:!1})],la.prototype,"hasSliceInVertexProgram",void 0),u([H({constValue:!1})],la.prototype,"instancedDoublePrecision",void 0),u([H({constValue:!1})],la.prototype,"isGround",void 0),u([H({constValue:ki.Pass})],la.prototype,"pbrTextureBindType",void 0);class Ps extends la{constructor(){super(...arguments),this.output=K.Color,this.screenCenterOffsetUnitsEnabled=xl.World,this.transparencyPassType=gt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([H({count:K.COUNT})],Ps.prototype,"output",void 0),u([H({count:xl.COUNT})],Ps.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([H({count:gt.COUNT})],Ps.prototype,"transparencyPassType",void 0),u([H()],Ps.prototype,"spherical",void 0),u([H()],Ps.prototype,"occlusionTestEnabled",void 0),u([H()],Ps.prototype,"signedDistanceFieldEnabled",void 0),u([H()],Ps.prototype,"vvSize",void 0),u([H()],Ps.prototype,"vvColor",void 0),u([H()],Ps.prototype,"hasVerticalOffset",void 0),u([H()],Ps.prototype,"hasScreenSizePerspective",void 0),u([H()],Ps.prototype,"debugDrawLabelBorder",void 0),u([H()],Ps.prototype,"binaryHighlightOcclusionEnabled",void 0),u([H()],Ps.prototype,"hasSlicePlane",void 0),u([H()],Ps.prototype,"hasPolygonOffset",void 0),u([H()],Ps.prototype,"depthEnabled",void 0),u([H()],Ps.prototype,"pixelSnappingEnabled",void 0),u([H()],Ps.prototype,"isDraped",void 0),u([H()],Ps.prototype,"hasMultipassGeometry",void 0),u([H()],Ps.prototype,"hasMultipassTerrain",void 0),u([H()],Ps.prototype,"cullAboveGround",void 0),u([H({constValue:!0})],Ps.prototype,"hasSliceInVertexProgram",void 0),u([H({constValue:!1})],Ps.prototype,"hasVvInstancing",void 0);class CE extends bm{constructor(t){super(t,new yit),this.techniqueConfig=new Ps}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?xl.Screen:xl.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===K.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===K.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=i.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,i,r,s,a,l)}_intersectDrapedHudGeometry(t,i,r,s,n){const o=t.vertexAttributes.get(M.POSITION),a=t.vertexAttributes.get(M.SIZE),l=this.parameters,c=B4(l);let h=1,p=1;if(_(s)){const m=s(yoe);h=m[0],p=m[5]}h*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const f=mit*t.screenToWorldRatio;for(let m=0;m<o.data.length/o.size;m++){const y=m*o.size,v=o.data[y],w=o.data[y+1],b=m*a.size;let S;Uy[0]=a.data[b]*h,Uy[1]=a.data[b+1]*p,l.textureIsSignedDistanceField&&(S=l.outlineSize*t.screenToWorldRatio/2),moe(i,v,w,Uy,f,S,l,c)&&r(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,i,r,s,n,o){if(!s.options.selectionMode||!s.options.hud||eP(i))return;const a=this.parameters;let l=1,c=1;if(Qh(rB,r),_(o)){const S=o(yoe);l=S[0],c=S[5],uit(rB)}const h=t.vertexAttributes.get(M.POSITION),p=t.vertexAttributes.get(M.SIZE),f=t.vertexAttributes.get(M.NORMAL),m=t.vertexAttributes.get(M.AUXPOS1);pt(h.size>=3);const y=s.point,v=s.camera,w=B4(a);l*=v.pixelRatio,c*=v.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let S=0;S<h.data.length/h.size;S++){const T=S*h.size;se(Qo,h.data[T],h.data[T+1],h.data[T+2]),ze(Qo,Qo,r);const E=S*p.size;Uy[0]=p.data[E]*l,Uy[1]=p.data[E+1]*c,ze(Qo,Qo,v.viewMatrix);const C=S*m.size;if(se(zc,m.data[C+0],m.data[C+1],m.data[C+2]),!b&&(Qo[0]+=zc[0],Qo[1]+=zc[1],zc[2]!==0)){const I=zc[2];we(zc,Qo),pe(Qo,Qo,le(zc,zc,I))}const A=S*f.size;if(se(JC,f.data[A],f.data[A+1],f.data[A+2]),this._normalAndViewAngle(JC,rB,v,sB),this._applyVerticalOffsetTransformationView(Qo,sB,v,iB),v.applyProjection(Qo,va),va[0]>-1){va[0]=Math.floor(va[0]),va[1]=Math.floor(va[1]),b&&(zc[0]||zc[1])&&(va[0]+=zc[0],zc[1]!==0&&(va[1]+=DQ(zc[1],iB.factorAlignment)),v.unapplyProjection(va,Qo)),va[0]+=this.parameters.screenOffset[0],va[1]+=this.parameters.screenOffset[1],Pxe(Uy,iB.factor,Uy);const I=fit*v.pixelRatio;let D;if(a.textureIsSignedDistanceField&&(D=a.outlineSize*v.pixelRatio/2),moe(y,va[0],va[1],Uy,I,D,a,w)){const L=s.ray;if(ze(goe,Qo,_s(pit,v.viewMatrix)),va[0]=y[0],va[1]=y[1],v.unprojectFromRenderScreen(va,Qo)){const z=O();ae(z,L.direction);const B=1/Me(z);le(z,z,B),n(ur(L.origin,Qo)*B,z,-1,!0,1,goe)}}}}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(M.POSITION),n=t.indices.get(M.POSITION);return mwe(s,n,i)}createBufferWriter(){return new _it(this)}_normalAndViewAngle(t,i,r,s){return stt(i)&&(i=Qh(dit,i)),mc(s.normal,t,i),ze(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=xe(uTe,git),s}_updateScaleInfo(t,i,r){const s=this.parameters;_(s.screenSizePerspective)?coe(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),_(s.screenSizePerspectiveAlignment)?coe(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,sB);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),_(n)&&ae(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ae(n,t);const c=De(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return le(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=Me(t),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=le(Qo,i.normal,o*a);return de(s,t,l),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=Me(t);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=Me(t),a=vt(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=Vxe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),le(i.normal,i.normal,l),de(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&ae(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(we(JC,r),de(r,r,le(JC,JC,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&ae(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&ae(s,t),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(t){if(t===Ee.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:r}=this.parameters;return t===(i?Ee.LABEL_MATERIAL:Ee.HUD_MATERIAL)||r&&t===Ee.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha?new lit(t):t.output===K.Highlight?new cTe(t):null}calculateRelativeScreenBounds(t,i,r=kt()){return cit(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class cTe extends ZY{constructor(t){super(F(F({},t),t.material.parameters))}selectProgram(t){return this.ensureTechnique(oP,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}class lit extends cTe{_isOcclusionSlot(t){return t.slot===Ee.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===K.Color||this._output===K.Alpha)}selectProgram(t){return this.ensureTechnique(oP,t,this._isOcclusionSlot(t)?K.Occlusion:this._output)}}function cit(e,t,i,r=hit){return _o(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function uit(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*f,e[7]=l*f,e[8]=c*f,e}function moe(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&_(f)&&(l+=r[0]*f[0],h+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const iB={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},hit=it(),Qo=O(),JC=O(),va=Xt(),uTe=O(),goe=O(),rB=Or(),dit=Or(),pit=Ae(),zc=O(),sB={normal:uTe,cosAngle:0},yoe=Ae(),fit=1,mit=2,Uy=[0,0],git=Ue(0,0,1);class yit extends qbe{constructor(){super(...arguments),this.renderOccluded=Dr.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Di(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const vit=ls().vec3f(M.POSITION).vec3f(M.NORMAL).vec2f(M.UV0).vec4u8(M.COLOR).vec2f(M.SIZE).vec4f(M.AUXPOS1).vec4f(M.AUXPOS2);class _it{constructor(t){this.material=t,this.vertexBufferLayout=vit}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(M.POSITION).length}write(t,i,r,s){wU(i.indices.get(M.POSITION),i.vertexAttributes.get(M.POSITION).data,t.transformation,r.position,s,6),zQ(i.indices.get(M.NORMAL),i.vertexAttributes.get(M.NORMAL).data,t.invTranspTransformation,r.normal,s,6);{const n=i.vertexAttributes.get(M.UV0).data;let o,a,l,c;if(n==null||n.length<4){const m=this.material.parameters;o=0,a=0,l=m.texCoordScale[0],c=m.texCoordScale[1]}else o=n[0],a=n[1],l=n[2],c=n[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const h=i.indices.get(M.POSITION).length,p=r.uv0;let f=s;for(let m=0;m<h;++m)p.set(f,0,o),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,a),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,l),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,c),f+=1,p.set(f,0,o),p.set(f,1,a),f+=1}k4(i.indices.get(M.COLOR),i.vertexAttributes.get(M.COLOR).data,4,r.color,s,6);{const n=i.indices.get(M.SIZE),o=i.vertexAttributes.get(M.SIZE).data,a=n.length,l=r.size;let c=s;for(let h=0;h<a;++h){const p=o[2*n[h]],f=o[2*n[h]+1];for(let m=0;m<6;++m)l.set(c,0,p),l.set(c,1,f),c+=1}}i.indices.get(M.AUXPOS1)&&i.vertexAttributes.get(M.AUXPOS1)&&EE(i.indices.get(M.AUXPOS1),i.vertexAttributes.get(M.AUXPOS1).data,r.auxpos1,s,6),i.indices.get(M.AUXPOS2)&&i.vertexAttributes.get(M.AUXPOS2)&&EE(i.indices.get(M.AUXPOS2),i.vertexAttributes.get(M.AUXPOS2).data,r.auxpos2,s,6)}}const Np=O(),Fx=Xt(),KC=Xt(),nB=O(),bit=Ae(),wit=En(),oB=fo(),xit=O(),Tit=kt();class Sit{constructor(){this.aabr=kt(),this.distance=0,this.culled=!1,this.visible=!1}}class Eit{constructor(t,i,r={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info=r}}class Cit{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class Ait{}class Rit{constructor(){this.sortArray=new Wt({allocator:t=>t||new Ait})}}var ic;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(ic||(ic={}));class hTe{constructor(){this.camera=new tr,this.slicePlane=v_(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),lx(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let zS=class extends Se{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new hTe,this._state=ic.Idle,this.graphics=new Cit,this.iterators=new Rit,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==ic.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/ic.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case ic.Idle:this._startUpdate(),e.madeProgress();case ic.Process:if(this._state=ic.Process,!this._processActiveGraphics(e))return;case ic.Sort:if(this._state=ic.Sort,!this._sortVisibleGraphics(e))return;case ic.Deconflict:if(this._state=ic.Deconflict,!this._deconflictVisibleGraphics(e))return;default:Wet(this,this.graphics.visible),this._state=ic.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(R(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof CE}_startUpdate(){Xet(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new Sit,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),Mit(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=_s(bit,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?wit:null;let s=0;for(_(r)&&(ze(r,Ba,this._runningViewState.camera.viewMatrix),r[3]=Ci(this.view.spatialReference).radius,s=Bge(r,Ba));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===ho.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),Yet(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=voe(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=voe(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=Oit(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(ho.GRAPHIC,xu.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);Lu(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(R(a)){if(a=this._getProjectionInfo(l,t,$it),a.isOutsideScreen||this._isCulledBySlice(e,Np)||_(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!Wi.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}R(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;ze(Np,a,r.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(M.NORMAL).data,h=l.get(M.AUXPOS1).data;return o.applyShaderOffsetsView(Np,c,s.transformation,h,r,i.scaleInfo,Np),Ji(Fx,Np[0],Np[1],Np[2],1),Eu(KC,Fx,r.projectionMatrix),le(i.positionNDC,KC,1/KC[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,nB),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(nB[2]),i.distance=nB[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Ji(KC,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),Eu(Fx,KC,t),M3(Fx,Fx,1/Fx[3]),se(i.positionView,Np[0],Np[1],Np[2]),i}_isCulledByHorizon(e,t,i){return ae(oB.direction,e.positionView),se(oB.origin,0,0,0),!!y_(t,oB,xit)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&hZ(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(Pit);Pxe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=mF(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,Tit),Yt(0,n.fullWidth,.5+.5*r[0]),Yt(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(bu(a),Ep(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Wb(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let s=Math.floor(i.aabr[1]/this.accBinsSizeY);s<=Math.floor(i.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,O3(l.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const r=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)r.push(new Wt)}}else for(let i=0;i<this.accBinsNumX;i++)for(let r=0;r<this.accBinsNumY;r++)this.accBins[i][r].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this.accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this.accBinsNumY||this.accBins[o][a].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(xu.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===ho.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function Mit(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(xu.DECONFLICTION,t)}function*voe(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*Oit(e,t,i){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([d({constructOnly:!0})],zS.prototype,"view",void 0),u([d({type:Boolean,readOnly:!0})],zS.prototype,"updating",null),zS=u([P("esri.views.3d.layers.graphics.Deconflictor")],zS);const Pit=it();class Iit{constructor(){this.positionView=O(),this.positionNDC=O(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const $it=new Iit,Lit=2e3;let fN=class extends zS{constructor(){super(...arguments),this.visibilityGroup=ho.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===Nn.IDLE||t-this._lastDeconfliction>Lit)&&(super.runTask(e),this.state===ic.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([d({constructOnly:!0})],fN.prototype,"parent",void 0),fN=u([P("esri.views.3d.layers.graphics.LabelDeconflictor")],fN);let nq=class extends zS{constructor(){super(...arguments),this._handles=new Nt,this._contexts=new Map,this._viewState=new hTe,this.visibilityGroup=ho.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([ie(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),ie(()=>{var e,t,i;return(i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:i.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),ie(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},Rt)]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.GRAPHICS_DECONFLICTOR,this),this._labels=new fN({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&aB(e));t.setVisibilityFlag(xu.DECONFLICTION,i,ho.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;_(e)&&rye(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=_(e)}_slicePlaneChanged(){sn(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new Eit(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),aB(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=aB(e);i||Dit(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function aB(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function Dit(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag(xu.DECONFLICTION))}nq=u([P("esri.views.3d.layers.graphics.GraphicsDeconflictor")],nq);const HQ=(e,t,i)=>[t,i],AE=(e,t,i)=>[t,i,e[2]],qQ=(e,t,i)=>[t,i,e[2],e[3]];function xEt(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:_(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function Nit({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function Fit({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function dTe({scale:e,translate:t},i){return i*e[0]+t[0]}function pTe({scale:e,translate:t},i){return t[1]-i*e[1]}function fTe(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=dTe(e,i[0][0]),a=pTe(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=t(c,o,a)}return r}function mTe(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=fTe(e,t,i[s]);return r}function kit(e,t,i,r){return fTe(e,i?r?qQ:AE:r?AE:HQ,t)}function Uit(e,t,i,r){return mTe(e,i?r?qQ:AE:r?AE:HQ,t)}function zit(e,t,i,r){return mTe(e,i?r?qQ:AE:r?AE:HQ,t)}function TEt(e,t,i,r,s){return t.x=Nit(e,i.x),t.y=Fit(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function gTe(e,t,i,r,s){return _(i)&&(t.points=kit(e,i.points,r,s)),t}function yTe(e,t,i,r,s){return R(i)||(t.x=dTe(e,i.x),t.y=pTe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function vTe(e,t,i,r,s){return _(i)&&(t.rings=zit(e,i.rings,r,s)),t}function _Te(e,t,i,r,s){return _(i)&&(t.paths=Uit(e,i.paths,r,s)),t}function bTe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],s=t[i];if(r.length!==s.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==s[n])return!1}return!0}function wTe(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!bTe(e[i],t[i]))return!1;return!0}function Vit(e,t){return!!aP(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function Bit(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!aP(e.spatialReference,t.spatialReference)&&wTe(e.paths,t.paths)}function Git(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!aP(e.spatialReference,t.spatialReference)&&wTe(e.rings,t.rings)}function jit(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!aP(e.spatialReference,t.spatialReference)&&bTe(e.points,t.points)}function Hit(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!aP(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}function aP(e,t){return e===t||e&&t&&e.equals(t)}function qit(e,t){if(e===t)return!0;if(R(e)||R(t)||e.type!==t.type)return!1;switch(e.type){case"point":return Vit(e,t);case"extent":return Hit(e,t);case"polyline":return Bit(e,t);case"polygon":return Git(e,t);case"multipoint":return jit(e,t);case"mesh":return!1;default:return}}function Wit(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i)if(e[s]!==t[s])return!1;return!0}function SEt(e,t){return e===t||e!=null&&t!=null&&e.objectId===t.objectId&&!!qit(e.geometry,t.geometry)&&!!Wit(e.attributes,t.attributes)}class EEt{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function CEt(e){return _(e.geometry)}class AEt{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function REt(e){const t=Yde.fromJSON(e.geometryType),i=et.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(n=>{const o=Xit(n,t,i,e.objectIdFieldName),a=o.geometry;if(_(a)&&r)switch(a.type){case"point":o.geometry=yTe(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=gTe(r,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=vTe(r,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=_Te(r,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(n=>V3.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function Xit(e,t,i,r){return{uid:Cl(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:Zit(e.geometry,t,i),visible:!0}}function Zit(e,t,i){if(R(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function Ty(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function Yit(e){if(R(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=FP(e.vertexAttributes.position),t+=FP(e.vertexAttributes.normal),t+=FP(e.vertexAttributes.uv),t+=FP(e.vertexAttributes.tangent)}return t}function MEt(e){let t=32;return t+=vge(e.attributes),t+=3,t+=8+Yit(e.geometry),t}function Qit(e){if(R(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function OEt(e){if(R(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function PEt(e,t){switch(mr(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Kz(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Kz(t,e.rings[i],e.hasZ);break;case"multipoint":Kz(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function Jit(e,t){switch(Lu(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)Jz(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)Jz(t,e.rings[i]);break;case"multipoint":Jz(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function IEt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}Gs();kt();function xTe(e){return"declaredClass"in e}function _oe(e){return"declaredClass"in e}function Kit(e){return"declaredClass"in e}function ert(e,t){if(!e)return null;if(Kit(e))return e;const i=new Ha({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=re(e.symbol),i.attributes=re(e.attributes),i.geometry=TTe(e.geometry),i}function TTe(e){return R(e)?null:xTe(e)?e:Qg(trt(e))}function trt(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:boe(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:boe(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:ETe(i)?STe(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}function boe(e){return irt(e)?e.map(t=>STe(t)):e}function STe(e){return e.map(t=>vRe(t))}function irt(e){for(const t of e)if(t.length!==0)return ETe(t);return!1}function ETe(e){return e.length&&(Rhe(e[0])||Mhe(e[0]))}function rrt(e,t){if(!e)return null;let i;if(_oe(e)){if(t==null)return e.clone();if(_oe(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Ty(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}const lB=fe.getLogger("esri.layers.support.labelFormatUtils"),woe={type:"simple",evaluate:()=>null},srt={getAttribute:(e,t)=>e.field(t)};async function CTe(e,t,i){if(!e||!e.symbol)return woe;const r=e.where,s=Wk(e),n=r?await import("./WhereClause.7b12305d.js"):null;let o;if(s.type==="arcade"){const a=await QOe(s.expression,i,t);o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{lB.error(new j("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>wY(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":ATe(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,t)}catch(c){return lB.error(new j("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),woe}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:srt;try{if(a.testFeature(c,h))return l(c)}catch(p){lB.error(new j("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function ATe(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=Kf(r,K5("short-date")):D5(t)&&(r=Wh(+r)),r||""}var $Et=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",createLabelFunction:CTe,formatField:ATe});function WQ(e,t){if(e.type==="point")return zy(e,t,!1);if(xTe(e))switch(e.type){case"extent":return zy(e.center,t,!1);case"polygon":return zy(e.centroid,t,!1);case"polyline":return zy(xoe(e),t,!0);case"mesh":return zy(e.origin,t,!1)}else switch(e.type){case"extent":return zy(nrt(e),t,!0);case"polygon":return zy(ort(e),t,!0);case"polyline":return zy(xoe(e),t,!0)}}function xoe(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=Dde(t,Lde(t)/2);return Ty(i[0],i[1],i[2],e.spatialReference)}function nrt(e){const t=isFinite(e.zmin);return Ty(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function ort(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=Nde(e.rings,e.hasZ);return Ty(i[0],i[1],i[2],e.spatialReference)}function zy(e,t,i){const r=i?e:rrt(e);return t&&e?oNe(e,r,t)?r:null:r}function LEt(e,t,i,r=0){if(e){t||(t=kt());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Ji(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function RTe(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(M.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function RM(e,t){const i=hk(Nh);return _(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),_(t)?i[3]=t:_(e)&&e.length>3&&(i[3]=e[3]),i}function DEt(e,t,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)_(e)&&e[o]!=null?n[o]=e[o]:_(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return _(t)?n[3]=t:_(r)?n[3]=r:n[3]=s[3],n}function Toe(e=Nf,t,i,r=1){const s=new Array(3);if(R(t)||R(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,f=i[a];l==="symbol-value"||p?c=f!==0?t[a]/f:1:h&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return yl(s)}function art(e){return e.isPrimitive!=null}function RU(e){return art(e)&&(e=[e.width,e.depth,e.height]),G4(e)?null:"Symbol sizes may not be negative values"}function G4(e){if(Array.isArray(e)){for(const t of e)if(!G4(t))return!1;return!0}return e==null||e>=0}function lrt(e,t,i,r=Ae()){const s=e||0,n=t||0,o=i||0;return s!==0&&X2(r,r,-s/180*Math.PI),n!==0&&W2(r,r,n/180*Math.PI),o!==0&&ok(r,r,o/180*Math.PI),r}function XQ(e,t){return t.minDemResolution!=null?t.minDemResolution:B5(e)?t.minDemResolutionForPoints:.01*LPe(e)}function MTe(e,t,i,r,s,n,o,a,l,c,h){const p=grt[h.mode];let f,m,y=0;if(dr(e,t,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(y=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),f=n,m=o):(f=r,m=s),dr(f,l.spatialReference,m,n,c.spatialReference,o,a)?y:void 0}function cy(e,t,i,r,s){const n=($4(e)?e.z:axe(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const o=vt(kf(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=vt(kf(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=vt(kf(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=vt(kf(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return i.mode,void(s.z=0)}}function crt(e,t,i,r){return cy(e,t,i,r,VS),VS.z}function lP(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?Qr.UPDATE:e.onTheGroundChanged}function td(e){return e==="relative-to-ground"||e==="relative-to-scene"}function u_(e){return e!=="absolute-height"}function urt(e,t,i,r,s){cy(t,i,s,r,VS),RTe(e,VS.verticalDistanceToGround);const n=VS.sampledElevation,o=Ss(yrt,e.transformation);return y$[0]=t.x,y$[1]=t.y,y$[2]=VS.z,Nu(t.spatialReference,y$,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function hrt(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],f=vt(n.getElevation(c,h,p,a,"ground"),0);o+=f,i[r+0]=c,i[r+1]=h,i[r+2]=f,t+=3,r+=3}return o/s}function drt(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],v=e[t+2],w=vt(n.getElevation(m,y,v,p,"ground"),0);l+=w,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?v+w+c:w+c,t+=3,r+=3}return l/s}function prt(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let f=0;f<s;++f){const m=e[t+0],y=e[t+1],v=e[t+2],w=vt(n.getElevation(m,y,v,p,"scene"),0);l+=w,i[r+0]=m,i[r+1]=y,i[r+2]=h==null?v+w+c:w+c,t+=3,r+=3}return l/s}function frt(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function mrt(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<s;++h){const p=e[t+0],f=e[t+1],m=e[t+2];i[r+0]=p,i[r+1]=f,i[r+2]=c==null?m+l:l,t+=3,r+=3}return 0}class cP{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var Qr;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(Qr||(Qr={}));const grt={"absolute-height":{applyElevationAlignmentBuffer:mrt,requiresAlignment:frt},"on-the-ground":{applyElevationAlignmentBuffer:hrt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:drt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:prt,requiresAlignment:()=>!0}},yrt=Ae(),VS=new cP,y$=O();function OTe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=ITe(a,t,i,r);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function QO(e,t,i,r){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(cy(n,i,t,r,wl),RTe(s,wl.verticalDistanceToGround),o=wl.sampledElevation):(cy(n,i,t,r,wl),t.mode!=="absolute-height"&&(o=wl.sampledElevation));const a=Ss(vrt,s.transformation),l=se(PTe,a[12],a[13],a[14]);Wi.TESTS_DISABLE_OPTIMIZATIONS?(bl[0]=n.x,bl[1]=n.y,bl[2]=wl.z,Nu(n.spatialReference,bl,a,r.spatialReference)&&(s.transformation=a)):r.setAltitudeOfTransformation(wl.z,a);const c=ZQ/r.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const vrt=Ae();function _rt(e,t,i,r){const s=e.graphics3DSymbolLayer.lodRenderer;if(R(s))return 0;const n=t.centerPointInElevationSR;cy(n,i,t,r,wl);const o=t.mode!=="absolute-height"?wl.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=wrt;a.getGlobalTransform(l,c);const h=se(PTe,c[12],c[13],c[14]);Wi.TESTS_DISABLE_OPTIMIZATIONS?(bl[0]=n.x,bl[1]=n.y,bl[2]=wl.z,Nu(n.spatialReference,bl,c,r.spatialReference)&&a.setGlobalTransform(l,c)):r.setAltitudeOfTransformation(wl.z,c);const p=ZQ/r.unitInMeters;return(Wi.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&a.setGlobalTransform(l,c),o}function brt(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const h of n){const p=h.geometry.vertexAttributes.get(M.POSITION);if(p!==a){const{update:f,averageGeometrySampledElevation:m}=ITe(h,t,i,r);l=m,a=p,c=f}c&&s.geometryVertexAttrsUpdated(h),o+=l}return o/n.length}const ZQ=.01,bl=O(),Xu=O(),kx=O(),wrt=Ae(),PTe=O(),wl=new cP;function ITe(e,t,i,r){let s=!1;const n=i.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;Xu[0]=a[12],Xu[1]=a[13],Xu[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(M.POSITION),h=c.data,p=o.vertexAttributes.get(M.MAPPOS).data,f=c.size,m=h.length/f,y=new oxe(p,n);let v=0,w=0;for(let b=0;b<m;b++){if(kx[0]=h[v],kx[1]=h[v+1],kx[2]=h[v+2],cy(y,i,t,r,wl),l&&(w+=wl.sampledElevation),Wi.TESTS_DISABLE_OPTIMIZATIONS)h[v]=y.array[y.offset],h[v+1]=y.array[y.offset+1],h[v+2]=wl.z,dr(h,n,v,h,r.spatialReference,v,1),h[v]-=Xu[0],h[v+1]-=Xu[1],h[v+2]-=Xu[2],s=!0;else{bl[0]=h[v]+Xu[0],bl[1]=h[v+1]+Xu[1],bl[2]=h[v+2]+Xu[2],r.setAltitude(bl,wl.z),h[v]=bl[0]-Xu[0],h[v+1]=bl[1]-Xu[1],h[v+2]=bl[2]-Xu[2];const S=ZQ/r.unitInMeters;(Math.abs(kx[0]-h[v])>=S||Math.abs(kx[1]-h[v+1])>=S||Math.abs(kx[2]-h[v+2])>=S)&&(s=!0)}v+=f,y.offset+=3}return w/=m,{update:s,averageGeometrySampledElevation:w}}const xrt=fe.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Trt(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function NEt(e){const t=e&&e.expression;if(typeof t=="string"){const i=DTe(t);if(i!=null)return{cachedResult:i}}return null}async function FEt(e,t,i){const r=e&&e.expression;if(typeof r!="string")return null;const s=DTe(r);if(s!=null)return{cachedResult:s};const n=await Wf(),o=n.arcadeUtils,a=o.createSyntaxTree(r);return o.dependsOnView(a)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function $Te(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function YQ(e,t){if(e!=null&&!LTe(e)){if(!t||!e.arcade)return void xrt.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=TTe(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function Srt(e){if(e!=null){if(LTe(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function kEt(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i}const Ert={cachedResult:0};function LTe(e){return e.cachedResult!=null}function DTe(e){return e==="0"?0:null}class Bu{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=hGe(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Srt(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=uGe(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=vt(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(R(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&_(i)&&_(r)?(this._featureExpressionInfoContext=Trt(t),YQ(this._featureExpressionInfoContext,$Te(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new Bu;return _(t)&&i.setFromElevationInfo(t),i}}var Lt;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Lt||(Lt={}));class wm{constructor(t,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=i}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),_(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(R(this._edgeState))return;const r=Soe(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){R(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!i),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),_(this._edgeState))){const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){this.elevationAligner!=null&&(_(r)&&YQ(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,i),this._resetEdgeObject(s))}getCenterObjectSpace(t=O()){return ae(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=Gs()){const i=this.stageObject.boundingVolumeObjectSpace;return Upe(t,i.min),zpe(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometryRecords)i.computeAttachmentOrigin(Om)&&(ze(Om,Om,this.stageObject.transformation),de(t.render.origin,t.render.origin,Om),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=Crt,l=B5(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];Vy[0]=o[p[0]],Vy[1]=o[p[1]],Vy[2]=o[p[2]],ze(Vy,Vy,this.stageObject.transformation),G_[3*h+0]=Vy[0],G_[3*h+1]=Vy[1],G_[3*h+2]=Vy[2]}if(!t(G_,0,l))return null;mr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],G_[h+p]),o[p+3]=Math.max(o[p+3],G_[h+p]);c&&r.push({location:G_.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){np(o,Om);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=vt(i.service.getElevation(Om[0],Om[1],h),0);else try{const f=XQ(o,i);p=vt(await i.service.queryElevation(Om[0],Om[1],s,f,h),0)}catch{}kpe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,i){t===ny.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===ny.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(R(this._edgeState))return;const i=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(R(r))return;const s=Soe(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function Soe(e){return e.isVisible?e.parameters.transparent?Lt.TRANSPARENT:Lt.OPAQUE:Lt.INVISIBLE}const G_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Vy=O(),Om=O(),Crt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var ln;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(ln||(ln={}));class QQ{constructor(t){this.schedule=t,this._loadStatus=mu.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===mu.LOADED?(t&&t(),this._loader):this._loadStatus===mu.FAILED?(i&&i(this._loadError),this._loader):(R(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=mu.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=mu.FAILED,!Jr(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){_(this._abortController)?this._abortController=Hh(this._abortController):this._loadStatus===mu.LOADING&&(this._loadStatus=mu.FAILED),this._loader=null}}var mu;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(mu||(mu={}));function Art(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function NTe(e,t){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&nc.cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>nc.createPolySphereGeometry(.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>nc.createBoxGeometry(1));case"cone":return i(cB,r=>nc.createConeGeometry(1,.5,r,!1),!0);case"inverted-cone":return i(cB,r=>nc.createConeGeometry(1,.5,r,!0),!0);case"cylinder":return i(cB,r=>nc.createCylinderGeometry(1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>nc.createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>nc.createDiamondGeometry(1),!0);default:return}}const cB=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function Rrt(e){return e.type==="fill"}function Mrt(e){return e.type==="extrude"}function Ort(e){return e&&e.enabled&&(Mrt(e)||Rrt(e))&&_(e.edges)}function Prt(e){return e&&e.enabled&&e.edges||null}function FTe(e,t){return kTe(Prt(e),t)}function kTe(e,t){if(R(e))return null;const i=_(e.color)?iZ(Pe.toUnitRGBA(e.color)):bi(0,0,0,0),r=gi(e.size),s=gi(e.extensionLength);switch(e.type){case"solid":return UTe(F({color:i,size:r,extensionLength:s},t));case"sketch":return Irt(F({color:i,size:r,extensionLength:s},t));default:return}}function UTe(e){return ye(F(F({},$rt),e),{type:"solid"})}function Irt(e){return ye(F(F({},Lrt),e),{type:"sketch"})}const $rt={color:bi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Lt.OPAQUE,hasSlicePlane:!1},Lrt={color:bi(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Lt.OPAQUE,hasSlicePlane:!1};function v$(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.material)})}),w3(t)}function Drt(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{r.textures&&t.push(...r.textures)})}),w3(t)}function JQ(e){const t=[];return e.components.forEach(i=>{t.push(i.geometry)}),w3(t)}function Nrt(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),w3(t)}function Frt(e){return JQ(e).reduce((t,i)=>t+i.indexCount/3,0)}const KQ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function UEt(e){return e.type==="web-style"?KQ:eJ(e.symbolLayers.toArray().map(t=>zTe(e,t)))}function eJ(e){let t=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)R(a)||(t+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function zEt(e){const t=eJ(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Eoe={};function zTe(e,t){const i=VTe(e,t),r=Ort(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:_(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:ye(F({},krt(t.resource&&t.resource.primitive||wX)),{memory:i});case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,h=a*l*2;let p=-2*h-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:h+c,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function VTe(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?Ka.EXTRUDE_EDGES:Ka.EXTRUDE;case"fill":return _(t.outline)&&t.outline.size>0?Ka.FILL_OUTLINE:Ka.FILL;case"water":return Ka.FILL;case"line":return t.join==="round"?Ka.LINE_ROUND:Ka.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return Ka.PATH_ROUND_CIRCLE;case"quad":return Ka.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return Ka.PATH_MITER_CIRCLE;case"quad":return Ka.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return i?Ka.OBJECT_POINT:Ka.OBJECT_POLYGON;case"icon":case"text":return i?Ka.ICON_POINT:Ka.ICON_POLYGON;default:return}}function krt(e){let t=Eoe[e];if(t)return t;const i=NTe(e,null);return t={primitivesPerFeature:JQ(i.levels[0]).reduce((r,s)=>r+s.indices.get(M.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Eoe[e]=t,t}const Ka={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},_$=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class xm extends QQ{constructor(t,i,r,s){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=_$,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=i,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new Bu,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Coe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Coe(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!i.length||i.length===1&&!i[0].length?l=`${a} (no ${r} were defined)`:Array.isArray(i)&&Array.isArray(i[0])?o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (${r} should be defined as a 2D array)`:l=`${a} (failed to project geometry to view spatial reference)`,l&&_$.warnOncePerTick(l)}_validateGeometry(t,i=null,r=null){if(_(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return _$.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Urt}_defaultElevationInfoZ(){return zrt}_updateElevationContext(){_(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=vt(this._elevationContext.meterUnitOffset,vt(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?Ert:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,i=Aoe){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(_(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=Aoe){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return RM(null,r);const s=_(t)?Pe.toUnitRGB(t):Nf;return RM(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=RM(r,s);return _(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return zTe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==Qr.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=Qr.UPDATE;return t.forEach(n=>{const o=i(n);if(_(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=Qr.RECREATE}),s}applyRendererDiff(t,i){return ln.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?Bg(i.size.field,t):0,s=i.color?Bg(i.color.field,t):0,n=i.opacity?Bg(i.opacity.field,t):0;return bi(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&_$.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var i,r,s,n,o,a,l,c,h,p,f,m,y,v,w,b;return{size:(n=(s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(m=(f=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:f.field)!=null?m:null,rotation:(b=(w=(v=(y=this._fastUpdates)==null?void 0:y.visualVariables)==null?void 0:v.rotation)==null?void 0:w.field)!=null?b:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function Bg(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function Coe(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const Urt={mode:"on-the-ground",offset:0,unit:"meters"},zrt={mode:"absolute-height",offset:0,unit:"meters"},Aoe={hasIntrinsicColor:!1};class zw{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,i,r,s,n,o){this.id=Cl(),this.geometry=t,this.material=i,this.transformation=r,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return _(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(ze(t,t,this.getStaticTransformation()),!0)}}zw.pool=new Cs(zw);class j4{constructor(t){this.channel=t,this.id=Cl()}}class Sy extends K3{constructor(t={}){super(),this.type=Mp.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Ae(),this._bvObjectSpace=new Roe,this._bvWorldSpace=new Roe,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new BTe),this.transformation=Ae();const{geometries:i,materials:r,transformations:s,origins:n}=t;if(Array.isArray(i)){pt(r.length===i.length,"Object3D: materials don't match geometries"),pt(s.length===i.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=i.length,this._geometries.length=i.length;for(let o=0;o<i.length;o++)this._geometries[o]=i[o],this._geometryRecords[o]=zw.pool.acquire(i[o],r[o],Kb(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){Ss(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){pt(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,i,r,s,n){r=r||hn,this._geometries.push(t);const o=zw.pool.acquire(t,i,r,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||_(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const i=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=_(i.shaderTransformation)?this._geometryRecords.some(r=>_(r.shaderTransformation)):this._hasVolatileTransformation,i.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:i}),this._invalidateBoundingVolume(),i}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometryRecords)i.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new j4(ny.MaskOccludee);for(const i of this._geometryRecords)i.instanceParameters.occludees=jH(i.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometryRecords)i.instanceParameters.occludees=HH(i.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new j4(ny.Highlight);for(const i of this._geometryRecords)i.instanceParameters.highlights=jH(i.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometryRecords)i.instanceParameters.highlights=HH(i.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return Hr(vt(i,Ae()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,i){return i=i||Ae(),Hr(i,this.transformation,t.getShaderTransformation()),i}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;_(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}pn(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),pn(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=O(),i=O(),r=xw(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(R(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=xw(o);ze(t,n.getCenter(),o);const l=ur(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),ze(i,t,this.transformation);const h=ur(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,i,r){const s=t.getBBMin(),n=t.getBBMax(),o=Vs(s),a=Vs(n);ze(o,o,r),ze(a,a,r);for(let l=0;l<3;++l)i.min[l]=Math.min(i.min[l],o[l],a[l]),i.max[l]=Math.max(i.max[l],o[l],a[l]);for(let l=0;l<3;++l){ae(o,s),ae(a,n),o[l]=n[l],a[l]=s[l],ze(o,o,r),ze(a,a,r);for(let c=0;c<3;++c)i.min[c]=Math.min(i.min[c],o[c],a[c]),i.max[c]=Math.max(i.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,_(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){_(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.includes(i),getGeometryIndex:i=>t._geometries.indexOf(i)}}}class BTe{constructor(){this.min=Ue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Roe extends BTe{constructor(){super(...arguments),this.bounds=En()}init(){se(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),se(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Uge(this.bounds)}}const Rv=O();function tJ(e,t,i,r,s,n,o,a){const l=i?i.length:0,c=e.clippingExtent;if(jn(t,Rv,e.elevationProvider.spatialReference),_(c)&&!sX(c,Rv))return null;jn(t,Rv,e.renderCoordsHelper.spatialReference);const h=e.localOriginFactory.getOrigin(Rv),p=new Sy({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let f=0;f<l;f++){const m=hn;p.addGeometry(i[f],r[f],m,h,a)}return{object:p,sampledElevation:urt(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function JO(e,t,i){const r=e.elevationContext,s=i.spatialReference;jn(t,Rv,s),r.centerPointInElevationSR=Ty(Rv[0],Rv[1],t.hasZ?Rv[2]:0,s)}function KO(e){switch(e.type){case"point":return e;case"polygon":case"extent":return WQ(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=Dde(t,Lde(t)/2);return Ty(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function Vrt(e){const t=new Zi;t.include(hQ),t.include(Fxe,e),t.include(vs,e),t.attributes.add(M.UV0,"vec2");const{vertex:i,fragment:r}=t;return i.uniforms.add([new ni("viewport",(s,n)=>n.camera.fullViewport),new We("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new vi("pixelToNDC",(s,n)=>yi(Ooe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new We("borderSize",(s,n)=>_(s.borderColor)?n.camera.pixelRatio:0),new vi("screenOffset",(s,n)=>yi(Ooe,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&_U(i),i.code.add(x`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?x`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?x`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:x`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?x`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:x`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?x`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:x`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new ni("uColor",s=>Moe(s.color)),new ni("borderColor",s=>Moe(s.borderColor))]),e.hasMultipassGeometry&&(r.include(swe,e),r.uniforms.add(new vi("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(x`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?x`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:x`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function Moe(e){return _(e)?e:Vf}const Ooe=it(),Brt=Object.freeze(Object.defineProperty({__proto__:null,build:Vrt},Symbol.toStringTag,{value:"Module"}));class MU extends pr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global}initializeProgram(t){const i=MU.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}setPipelineState(t){const i=t?gr.ALWAYS:gr.LESS;return this.configuration.depthHudEnabled?Bt({depthTest:{func:i},depthWrite:Nl}):Bt({blending:bo(Re.ONE,Re.SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:ri})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}MU.shader=new rr(Brt,()=>import("./LineCallout.glsl.ea186b18.js"));class fh extends la{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=xl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([H({count:xl.COUNT})],fh.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([H()],fh.prototype,"spherical",void 0),u([H()],fh.prototype,"occlusionTestEnabled",void 0),u([H()],fh.prototype,"hasVerticalOffset",void 0),u([H()],fh.prototype,"hasScreenSizePerspective",void 0),u([H()],fh.prototype,"depthHudEnabled",void 0),u([H()],fh.prototype,"depthHudAlignStartEnabled",void 0),u([H()],fh.prototype,"hasSlicePlane",void 0),u([H()],fh.prototype,"hasMultipassGeometry",void 0),u([H({constValue:!0})],fh.prototype,"hasSliceInVertexProgram",void 0),u([H({constValue:!1})],fh.prototype,"isDraped",void 0);class Ub extends bm{constructor(t){super(t,new jrt),this.techniqueConfig=new fh,this._uniqueMaterialIdentifier=Ub.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,i){const r=(i==null?void 0:i.slot)!==Ee.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?xl.Screen:xl.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!i&&i.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case Ee.LINE_CALLOUTS:case Ee.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===K.Color?new Grt(t):null}createBufferWriter(){return new qrt}validateParameters(t){const i=Ub.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class Grt extends __{beginSlot(t){return this.ensureTechnique(MU,t)}}class jrt extends dC{constructor(){super(...arguments),this.screenOffset=Zh,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Hrt=ls().vec3f(M.POSITION).vec3f(M.NORMAL).vec2f(M.UV0).vec4f(M.AUXPOS1),Poe=[ka(0,0),ka(1,0),ka(0,1),ka(1,0),ka(1,1),ka(0,1)];class qrt{constructor(){this.vertexBufferLayout=Hrt}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(M.POSITION).length}write(t,i,r,s){wU(i.indices.get(M.POSITION),i.vertexAttributes.get(M.POSITION).data,t.transformation,r.position,s,6),zQ(i.indices.get(M.NORMAL),i.vertexAttributes.get(M.NORMAL).data,t.invTranspTransformation,r.normal,s,6),EE(i.indices.get(M.AUXPOS1),i.vertexAttributes.get(M.AUXPOS1).data,r.auxpos1,s,6);for(let n=0;n<Poe.length;++n)r.uv0.setVec(s+n,Poe[n])}}class OU extends xm{constructor(t,i){super(t,null,i,Zrt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new Ub(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this.materialParameters;return i.screenOffset=t.screenOffset||Zh,i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get materialParameters(){const t=this.symbol,i=t.callout,r=_(i.color)?Pe.toUnitRGBA(i.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const s=gi(i.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:f,maxWorldLength:m}=t.verticalOffset;n={screenLength:gi(p),minWorldLength:f||0,maxWorldLength:m!=null?m:1/0}}const o=_(i.border)&&_(i.border.color)?Pe.toUnitRGBA(i.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,h=t.type==="label-3d";return{color:r,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:Dr.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return Xrt}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new Bu,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!Efe(l)))return null;const a=WQ(r.geometry);return R(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){return R(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=lP(OU.elevationModeChangeTypes,r,s);return n!==Qr.UPDATE||t.forEach(o=>{const a=i(o);_(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return R(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=td(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:KQ.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=i?{size:3,data:[i[0],i[1],i[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[M.POSITION,s],[M.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[M.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=Ub.uniqueMaterialIdentifier(i);if(_(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(r);return R(s)&&(s=new Ub(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new Ub(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=[new Fr(this._createVertexData(r),Wrt,Ol.Point)],o=this._getOrCreateMaterial(r),a=tJ(this._context,t,n,[o.material],i,this._context.layer.uid,s);if(a===null)return null;const l=new wm(this,a.object,n,o.isUnique?[o.material]:null,null,QO,i);return l.metadata={elevationOffset:r.elevationOffset||0},l.alignedSampledElevation=a.sampledElevation,l.needsElevationUpdates=td(i.mode),JO(l,t,this._context.elevationProvider),l}}OU.elevationModeChangeTypes={definedChanged:Qr.UPDATE,staysOnTheGround:Qr.UPDATE,onTheGroundChanged:Qr.RECREATE};const uB=new Uint16Array([0]),Wrt=[[M.POSITION,uB],[M.NORMAL,uB],[M.AUXPOS1,uB]],Xrt={mode:"relative-to-ground",offset:0},Zrt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Ioe=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function Yrt(e,t){if(!EX(e))return Ioe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=Qrt[e.callout.type];return i?new i(e,t):(Ioe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const Qrt={line:OU};class Jrt{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}const $oe=new Cs(Array,e=>V5(e,Vpe),null,10,5),Krt=kt();class est{constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=tst(ho._COUNT,xu._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?$Te(n,t,s):null;for(const o of r)_(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,i){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,i,r){this._labelGraphics.push(t),t.initialize(i,r),t.setVisibility(this.isVisible(ho.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=ho.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===ho.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(ho.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,i=ho.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(R(i))return!1;this._extent=kt(),Jit(i,this._extent);const r=i.spatialReference;if(!r.equals(t)&&!ck(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return _(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Go.fromExtent(s.type==="mesh"?s.extent:s)),eVe(s,i,r)}get usedMemory(){let t=vge(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(R(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=Qit(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:O(),num:0},draped:{origin:it(),num:0}};for(const i of this.graphics)R(i)||i.computeAttachmentOrigin(t);return t.render.num&&le(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&pc(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?mr(n.boundingBox):n.boundingBox=mr(),n.requiresDrapedElevation=!1,await Sk(this.graphics,async o=>{if(R(o))return;const a=o.type==="draped"?i:t,l=$oe.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&U2(n.boundingBox,l),$oe.release(l)}),$Pe(n.boundingBox)||P9(nX(n.boundingBox,Krt))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(_(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function tst(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var Loe,Doe,Noe,GTe={exports:{}};Loe=GTe,Doe=function(){function e($,U,G){G=G||2;var W,X,ee,q,te,ge,Te,ke=U&&U.length,_e=ke?U[0]*G:$.length,me=t($,0,_e,G,!0),Ce=[];if(!me||me.next===me.prev)return Ce;if(ke&&(me=l($,U,me,G)),$.length>80*G){W=ee=$[0],X=q=$[1];for(var Fe=G;Fe<_e;Fe+=G)(te=$[Fe])<W&&(W=te),(ge=$[Fe+1])<X&&(X=ge),te>ee&&(ee=te),ge>q&&(q=ge);Te=(Te=Math.max(ee-W,q-X))!==0?1/Te:0}return r(me,Ce,G,W,X,Te),Ce}function t($,U,G,W,X){var ee,q;if(X===oe($,U,G,W)>0)for(ee=U;ee<G;ee+=W)q=Q(ee,$[ee],$[ee+1],q);else for(ee=G-W;ee>=U;ee-=W)q=Q(ee,$[ee],$[ee+1],q);if(q&&C(q,q.next)){var te=q.next;Z(q),q=te}return q}function i($,U){if(!$)return $;U||(U=$);var G,W=$;do if(G=!1,W.steiner||!C(W,W.next)&&E(W.prev,W,W.next)!==0)W=W.next;else{var X=W.prev;if(Z(W),(W=U=X)===W.next)break;G=!0}while(G||W!==U);return U}function r($,U,G,W,X,ee,q){if($){!q&&ee&&y($,W,X,ee);for(var te,ge,Te=$;$.prev!==$.next;)if(te=$.prev,ge=$.next,ee?n($,W,X,ee):s($))U.push(te.i/G),U.push($.i/G),U.push(ge.i/G),Z($),$=ge.next,Te=ge.next;else if(($=ge)===Te){q?q===1?r($=o(i($),U,G),U,G,W,X,ee,2):q===2&&a($,U,G,W,X,ee):r(i($),U,G,W,X,ee,1);break}}}function s($){var U=$.prev,G=$,W=$.next;if(E(U,G,W)>=0)return!1;for(var X=$.next.next;X!==$.prev;){if(S(U.x,U.y,G.x,G.y,W.x,W.y,X.x,X.y)&&E(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function n($,U,G,W){var X=$.prev,ee=$,q=$.next;if(E(X,ee,q)>=0)return!1;for(var te=X.x<ee.x?X.x<q.x?X.x:q.x:ee.x<q.x?ee.x:q.x,ge=X.y<ee.y?X.y<q.y?X.y:q.y:ee.y<q.y?ee.y:q.y,Te=X.x>ee.x?X.x>q.x?X.x:q.x:ee.x>q.x?ee.x:q.x,ke=X.y>ee.y?X.y>q.y?X.y:q.y:ee.y>q.y?ee.y:q.y,_e=w(te,ge,U,G,W),me=w(Te,ke,U,G,W),Ce=$.prevZ,Fe=$.nextZ;Ce&&Ce.z>=_e&&Fe&&Fe.z<=me;){if(Ce!==$.prev&&Ce!==$.next&&S(X.x,X.y,ee.x,ee.y,q.x,q.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,Fe!==$.prev&&Fe!==$.next&&S(X.x,X.y,ee.x,ee.y,q.x,q.y,Fe.x,Fe.y)&&E(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;Ce&&Ce.z>=_e;){if(Ce!==$.prev&&Ce!==$.next&&S(X.x,X.y,ee.x,ee.y,q.x,q.y,Ce.x,Ce.y)&&E(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;Fe&&Fe.z<=me;){if(Fe!==$.prev&&Fe!==$.next&&S(X.x,X.y,ee.x,ee.y,q.x,q.y,Fe.x,Fe.y)&&E(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function o($,U,G){var W=$;do{var X=W.prev,ee=W.next.next;!C(X,ee)&&A(X,W,W.next,ee)&&z(X,ee)&&z(ee,X)&&(U.push(X.i/G),U.push(W.i/G),U.push(ee.i/G),Z(W),Z(W.next),W=$=ee),W=W.next}while(W!==$);return i(W)}function a($,U,G,W,X,ee){var q=$;do{for(var te=q.next.next;te!==q.prev;){if(q.i!==te.i&&T(q,te)){var ge=V(q,te);return q=i(q,q.next),ge=i(ge,ge.next),r(q,U,G,W,X,ee),void r(ge,U,G,W,X,ee)}te=te.next}q=q.next}while(q!==$)}function l($,U,G,W){var X,ee,q,te=[];for(X=0,ee=U.length;X<ee;X++)(q=t($,U[X]*W,X<ee-1?U[X+1]*W:$.length,W,!1))===q.next&&(q.steiner=!0),te.push(b(q));for(te.sort(c),X=0;X<te.length;X++)G=i(G=p(te[X],G),G.next);return G}function c($,U){return $.x-U.x}function h($){if($.next.prev===$)return $;let U=$;for(;;){const G=U.next;if(G.prev===U||G===U||G===$)break;U=G}return U}function p($,U){var G=f($,U);if(!G)return U;var W=V(G,$),X=i(G,G.next);let ee=h(W);return i(ee,ee.next),X=h(X),h(U===G?X:U)}function f($,U){var G,W=U,X=$.x,ee=$.y,q=-1/0;do{if(ee<=W.y&&ee>=W.next.y&&W.next.y!==W.y){var te=W.x+(ee-W.y)*(W.next.x-W.x)/(W.next.y-W.y);if(te<=X&&te>q){if(q=te,te===X){if(ee===W.y)return W;if(ee===W.next.y)return W.next}G=W.x<W.next.x?W:W.next}}W=W.next}while(W!==U);if(!G)return null;if(X===q)return G;var ge,Te=G,ke=G.x,_e=G.y,me=1/0;W=G;do X>=W.x&&W.x>=ke&&X!==W.x&&S(ee<_e?X:q,ee,ke,_e,ee<_e?q:X,ee,W.x,W.y)&&(ge=Math.abs(ee-W.y)/(X-W.x),z(W,$)&&(ge<me||ge===me&&(W.x>G.x||W.x===G.x&&m(G,W)))&&(G=W,me=ge)),W=W.next;while(W!==Te);return G}function m($,U){return E($.prev,$,U.prev)<0&&E(U.next,$,$.next)<0}function y($,U,G,W){var X=$;do X.z===null&&(X.z=w(X.x,X.y,U,G,W)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next;while(X!==$);X.prevZ.nextZ=null,X.prevZ=null,v(X)}function v($){var U,G,W,X,ee,q,te,ge,Te=1;do{for(G=$,$=null,ee=null,q=0;G;){for(q++,W=G,te=0,U=0;U<Te&&(te++,W=W.nextZ);U++);for(ge=Te;te>0||ge>0&&W;)te!==0&&(ge===0||!W||G.z<=W.z)?(X=G,G=G.nextZ,te--):(X=W,W=W.nextZ,ge--),ee?ee.nextZ=X:$=X,X.prevZ=ee,ee=X;G=W}ee.nextZ=null,Te*=2}while(q>1);return $}function w($,U,G,W,X){return($=1431655765&(($=858993459&(($=252645135&(($=16711935&(($=32767*($-G)*X)|$<<8))|$<<4))|$<<2))|$<<1))|(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U=32767*(U-W)*X)|U<<8))|U<<4))|U<<2))|U<<1))<<1}function b($){var U=$,G=$;do(U.x<G.x||U.x===G.x&&U.y<G.y)&&(G=U),U=U.next;while(U!==$);return G}function S($,U,G,W,X,ee,q,te){return(X-q)*(U-te)-($-q)*(ee-te)>=0&&($-q)*(W-te)-(G-q)*(U-te)>=0&&(G-q)*(ee-te)-(X-q)*(W-te)>=0}function T($,U){return $.next.i!==U.i&&$.prev.i!==U.i&&!L($,U)&&(z($,U)&&z(U,$)&&B($,U)&&(E($.prev,$,U.prev)||E($,U.prev,U))||C($,U)&&E($.prev,$,$.next)>0&&E(U.prev,U,U.next)>0)}function E($,U,G){return(U.y-$.y)*(G.x-U.x)-(U.x-$.x)*(G.y-U.y)}function C($,U){return $.x===U.x&&$.y===U.y}function A($,U,G,W){var X=D(E($,U,G)),ee=D(E($,U,W)),q=D(E(G,W,$)),te=D(E(G,W,U));return X!==ee&&q!==te||!(X!==0||!I($,G,U))||!(ee!==0||!I($,W,U))||!(q!==0||!I(G,$,W))||!(te!==0||!I(G,U,W))}function I($,U,G){return U.x<=Math.max($.x,G.x)&&U.x>=Math.min($.x,G.x)&&U.y<=Math.max($.y,G.y)&&U.y>=Math.min($.y,G.y)}function D($){return $>0?1:$<0?-1:0}function L($,U){var G=$;do{if(G.i!==$.i&&G.next.i!==$.i&&G.i!==U.i&&G.next.i!==U.i&&A(G,G.next,$,U))return!0;G=G.next}while(G!==$);return!1}function z($,U){return E($.prev,$,$.next)<0?E($,U,$.next)>=0&&E($,$.prev,U)>=0:E($,U,$.prev)<0||E($,$.next,U)<0}function B($,U){var G=$,W=!1,X=($.x+U.x)/2,ee=($.y+U.y)/2;do G.y>ee!=G.next.y>ee&&G.next.y!==G.y&&X<(G.next.x-G.x)*(ee-G.y)/(G.next.y-G.y)+G.x&&(W=!W),G=G.next;while(G!==$);return W}function V($,U){var G=new ce($.i,$.x,$.y),W=new ce(U.i,U.x,U.y),X=$.next,ee=U.prev;return $.next=U,U.prev=$,G.next=X,X.prev=G,W.next=G,G.prev=W,ee.next=W,W.prev=ee,W}function Q($,U,G,W){var X=new ce($,U,G);return W?(X.next=W.next,X.prev=W,W.next.prev=X,W.next=X):(X.prev=X,X.next=X),X}function Z($){$.next.prev=$.prev,$.prev.next=$.next,$.prevZ&&($.prevZ.nextZ=$.nextZ),$.nextZ&&($.nextZ.prevZ=$.prevZ)}function ce($,U,G){this.i=$,this.x=U,this.y=G,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function oe($,U,G,W){for(var X=0,ee=U,q=G-W;ee<G;ee+=W)X+=($[q]-$[ee])*($[ee+1]+$[q+1]),q=ee;return X}return e.deviation=function($,U,G,W){var X=U&&U.length,ee=X?U[0]*G:$.length,q=Math.abs(oe($,0,ee,G));if(X)for(var te=0,ge=U.length;te<ge;te++){var Te=U[te]*G,ke=te<ge-1?U[te+1]*G:$.length;q-=Math.abs(oe($,Te,ke,G))}var _e=0;for(te=0;te<W.length;te+=3){var me=W[te]*G,Ce=W[te+1]*G,Fe=W[te+2]*G;_e+=Math.abs(($[me]-$[Fe])*($[Ce+1]-$[me+1])-($[me]-$[Ce])*($[Fe+1]-$[me+1]))}return q===0&&_e===0?0:Math.abs((_e-q)/q)},e.flatten=function($){for(var U=$[0][0].length,G={vertices:[],holes:[],dimensions:U},W=0,X=0;X<$.length;X++){for(var ee=0;ee<$[X].length;ee++)for(var q=0;q<U;q++)G.vertices.push($[X][ee][q]);X>0&&(W+=$[X-1].length,G.holes.push(W))}return G},e},(Noe=Doe())!==void 0&&(Loe.exports=Noe);const RE=GTe.exports,PU=fe.getLogger("esri.views.3d.support.buffer.math");function uP(e,t,i){if(e.count!==t.count)return void PU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],f=i[10],m=i[12],y=i[13],v=i[14],w=e.typedBuffer,b=e.typedBufferStride,S=t.typedBuffer,T=t.typedBufferStride;for(let E=0;E<r;E++){const C=E*b,A=E*T,I=S[A],D=S[A+1],L=S[A+2];w[C]=s*I+a*D+h*L+m,w[C+1]=n*I+l*D+p*L+y,w[C+2]=o*I+c*D+f*L+v}}function h_(e,t,i){if(e.count!==t.count)return void PU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,w=t.typedBufferStride;for(let b=0;b<r;b++){const S=b*y,T=b*w,E=v[T],C=v[T+1],A=v[T+2];m[S]=s*E+a*C+h*A,m[S+1]=n*E+l*C+p*A,m[S+2]=o*E+c*C+f*A}}function oq(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function iJ(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function ist(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:uP,transformMat3:h_,scale:oq,normalize:iJ,shiftRight:ist},Symbol.toStringTag,{value:"Module"}));function IU(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&_(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function rst(e,t){if(_(e.symbol))return e.symbol;const i=IU(e,t);return _(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function VEt(e,t){const i=IU(e,t),r=rst(e,t);if(R(r))return null;const s={renderer:i,symbol:r};if(R(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=DX(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function sst(e,t){if(_(e.symbol))return e.symbol;const i=IU(e,t);return _(i)&&i.getSymbolAsync(e,t)}async function BEt(e,t){const i=IU(e,t),r=await sst(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=DX(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=Pe.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function nst(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function ost(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function jTe(e,t,i){var C;const r=e.byteLength/(4*t),s=new Uint32Array(e,0,r*t);let n=new Uint32Array(r);const o=(C=i==null?void 0:i.minReduction)!=null?C:0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let A=0;A<c.length-1;A++){const I=c[A+1]-c[A];I>h&&(h=I)}else h=r;const p=Math.floor(1.1*h)+1;(Fp==null||Fp.length<2*p)&&(Fp=new Uint32Array(D2(2*p)));for(let A=0;A<2*p;A++)Fp[A]=0;let f=0;const m=!!c&&!!a,y=m?l:r,v=m?new Uint32Array(l):null,w=1.96;let b=o!==0?Math.ceil(4*w*w/(o*o)*o*(1-o)):y,S=1,T=c?c[1]:y;for(let A=0;A<y;A++){if(A===b){const V=1-f/A;if(V+w*Math.sqrt(V*(1-V)/A)<o)return null;b*=2}if(A===T){for(let V=0;V<2*p;V++)Fp[V]=0;if(a)for(let V=c[S-1];V<c[S];V++)v[V]=n[a[V]];T=c[++S]}const I=m?a[A]:A,D=I*t,L=cst(s,D,t);let z=L%p,B=f;for(;Fp[2*z+1]!==0;){if(Fp[2*z]===L){const V=Fp[2*z+1]-1;if(ast(s,D,V*t,t)){B=n[V];break}}z++,z>=p&&(z-=p)}B===f&&(Fp[2*z]=L,Fp[2*z+1]=I+1,f++),n[I]=B}if(o!==0&&1-f/r<o)return null;if(m){for(let A=c[S-1];A<v.length;A++)v[A]=n[a[A]];n=v}const E=new Uint32Array(t*f);f=0;for(let A=0;A<y;A++)n[A]===f&&(lst(s,(m?a[A]:A)*t,E,f*t,t),f++);if(a&&!m){const A=new Uint32Array(l);for(let I=0;I<A.length;I++)A[I]=n[a[I]];n=A}return{buffer:E.buffer,indices:n,uniqueCount:f}}function ast(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function lst(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function cst(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Fp=null;function GEt(e){const t=hP(e.rings,e.hasZ,om.CCW_IS_HOLE),i=[];let r=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(m=>m-c),f=new Uint32Array(RE(h,p,3));i.push({position:h,faces:f}),r+=h.length,s+=f.length}const n=ust(i,r,s),o=jTe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function ust(e,t,i){if(e.length===1)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function hP(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let m=0;m<r;++m)h+=e[m].length;const p=new Float64Array(3*h);let f=0;for(let m=r-1;m>=0;m--){const y=e[m],v=i===om.CCW_IS_HOLE&&hst(y);if(v&&r!==1)s[a++]=y;else{let w=y.length;for(let S=0;S<a;++S)w+=s[S].length;const b={index:f,pathLengths:new Array(a+1),count:w,holeIndices:new Array(a)};b.pathLengths[0]=y.length,y.length>0&&(o[c++]={index:f,count:y.length}),f=v?b$(y,y.length-1,-1,p,f,y.length,t):b$(y,0,1,p,f,y.length,t);for(let S=0;S<a;++S){const T=s[S];b.holeIndices[S]=f,b.pathLengths[S+1]=T.length,T.length>0&&(o[c++]={index:f,count:T.length}),f=b$(T,0,1,p,f,T.length,t)}a=0,b.count>0&&(n[l++]=b)}}for(let m=0;m<a;++m){const y=s[m];y.length>0&&(o[c++]={index:f,count:y.length}),f=b$(y,0,1,p,f,y.length,t)}return l<r&&(n.length=l),c<r&&(o.length=c),{position:p,polygons:n,outlines:o}}function b$(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,t+=i}return s/3}function hst(e){return!NW(e,!1,!1)}var om;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(om||(om={}));var MM,aq;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(MM||(MM={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(aq||(aq={}));var kr,Ph,zt,ME,Ts,Vn;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(kr||(kr={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Ph||(Ph={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(zt||(zt={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(ME||(ME={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(Ts||(Ts={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(Vn||(Vn={}));class dst{constructor(t,i){this.vec3=t,this.id=i}}function OM(e,t,i,r){return new dst(Ue(e,t,i),r)}var Da;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(Da||(Da={}));class Foe{constructor(t,i){this.index=t,this.renderTargets=i,this._extent=kt(),this.resolution=0,this.renderLocalOrigin=OM(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new fst,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===Da.ColorAndWater?this.renderTargets.getTarget(Ts.Color):t===Da.Highlight?this.renderTargets.getTarget(Ts.Highlight):this.renderTargets.getTarget(Ts.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Ts.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Ts.Color):null}getNormalTexture(t){const i=t===Da.ColorAndWater?this.renderTargets.getTarget(Ts.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==Ts.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?dE.CHANGED:dE.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[Ts.Color]|+t[Ts.ColorNoRasterImage]<<1|+t[Ts.Highlight]<<2|+t[Ts.Water]<<3|+t[Ts.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this._extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];mF(this._extent,t.range,0,r)}if(this._extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];mF(this._extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Jg(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===kr.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function pst(e,t,i){return Math.min(D2(Math.max(e,t)+256),i)}class fst{constructor(){this.extents=[kt(),kt(),kt()],this.numViews=0}}class HTe{constructor(t,i){this.size=sQ(),this._fbo=null,this._fbo=new Rr(t,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=Ze(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this.size[0]=t,this.size[1]=i,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0}}class mst{constructor(t){const i=(r,s,n=!0)=>({type:s,fbo:new HTe(t,n),renderPass:r,valid:!1,lastUsed:1/0});this.renderTargets=[i(je.MATERIAL,Ts.Color),i(je.MATERIAL,Ts.ColorNoRasterImage),i(je.MATERIAL_HIGHLIGHT,Ts.Highlight,!1),i(je.MATERIAL_NORMAL,Ts.Water),i(je.MATERIAL,Ts.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>gst)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const gst=1e3;class rJ{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}class qTe{constructor(t){this._context=t,this._perConstructorInstances=new rJ,this._frameCounter=0,this._keepAliveFrameCount=koe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(R(s)){const n=new t(this._context,i,()=>this.release(n));s=new yst(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(_(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(R(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);R(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==koe&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>{l.technique.reload(this._context)}))};t.push(s(i,r))}),await Promise.all(t)}}class yst{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const koe=-1,$U=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var r;for(const s of(r=this._managedDisposables)!=null?r:[]){const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class LU extends $U(class{}){}function Io(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(r=(i=e._managedDisposables)==null?void 0:i.slice())!=null?r:[]),e._managedDisposables.unshift(t)}}const vst=fe.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class WTe{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new rJ}dispose(){this._textureRepository.dispose()}acquire(t,i){this._ownMaterial(t);let r=this._id2glMaterialRef.get(i,t.id);if(R(r)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});r=new _st(s),this._id2glMaterialRef.set(i,t.id,r)}return r.ref(),r.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);_(r)&&(r.unref(),r.referenced||(Ze(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){_(t.repository)&&t.repository!==this&&vst.error("Material is already owned by a different material repository"),t.repository=this}}class _st{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,pt(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const bst={orderedRepackingEnabled:!1},wst={rootOrigin:null},xst=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class OE{constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new is,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),is.clearPool(),lq[0]=null,j_.prune(),Y1.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=is.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}is.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=is.acquire();for(const s of t){const n=_(i)?i:Q2(this._objectToBoundingSphere(s),Ast);DR(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}is.release(r),this._shrink()}update(t,i){if(!DR(i[3])&&this._isDegenerate(t))return;const r=Cst(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=Fu(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=Fu(t,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=hB(t,i),h=p=>{if(--n,!s(p))return;const f=this._objectToBoundingSphere(p);if(!Cv(r,f))return;const m=ev(t,i,f),y=m-f[3],v=m+f[3];y<o&&(o=y,a=v,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!Cv(r,p.bounds)||(le(Zu,c,p.halfSize),de(Zu,Zu,p.bounds),ev(t,i,Zu)>a))return!1;const f=p.node;return f.terminals.forAll(m=>h(m)),f.residents!==null&&f.residents.forAll(m=>h(m)),!0},t,i),l}forEachInDepthRange(t,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:v=>{r===OE.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,v.near),c=Math.min(c,v.far)):(l=Math.max(l,-v.far),c=Math.min(c,-v.near))}};h.setRange(s);const p=ev(i,r,t),f=hB(i,r),m=hB(i,-r),y=v=>{if(!a(v))return;const w=this._objectToBoundingSphere(v),b=w,S=ev(i,r,b)-p,T=S-w[3],E=S+w[3];T>c||E<l||!Cv(o,w)||n(v,h)};this._forEachNodeDepthOrdered(this._root,v=>{if(!Cv(o,v.bounds)||(le(Zu,f,v.halfSize),de(Zu,Zu,v.bounds),ev(i,r,Zu)-p>c)||(le(Zu,m,v.halfSize),de(Zu,Zu,v.bounds),ev(i,r,Zu)-p<l))return!1;const w=v.node;return w.terminals.forAll(b=>y(b)),w.residents!==null&&w.residents.forAll(b=>y(b)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}forEachNeighbor(t,i){const r=Fg(i),s=i,n=o=>{const a=this._objectToBoundingSphere(o),l=Fg(a),c=r+l;Sn(a,s)-c*c<=0&&t(o)};this._forEachNode(this._root,o=>{const a=Fg(o.bounds),l=r+a;if(Sn(o.bounds,s)-l*l>0)return!1;const c=o.node;return c.terminals.forAll(h=>n(h)),c.residents!==null&&c.residents.forAll(h=>n(h)),!0}),this.forEachDegenerateObject(n)}_intersectsNode(t,i){return w$(i.bounds,2*-i.halfSize,uu),w$(i.bounds,2*i.halfSize,hu),tne(t.origin,t.direction,uu,hu)}_intersectsNodeWithOffset(t,i,r){return w$(i.bounds,2*-i.halfSize,uu),w$(i.bounds,2*i.halfSize,hu),r.applyToMinMax(uu,hu),tne(t.origin,t.direction,uu,hu)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||x7(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||x7(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=is.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(is.acquire().init(r).advance(n));is.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=OE.DepthOrder.FRONT_TO_BACK){let n=is.acquire().init(t);const o=[n];for(Est(r,s,Voe);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Voe[a];n.node.children[l]&&o.push(is.acquire().init(n).advance(l))}is.release(n)}}_remove(t,i,r){j_.clear();const s=r.advanceTo(i,(n,o)=>{j_.push(n.node),j_.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=j_.length-2;n>=0;n-=2){const o=j_.data[n],a=j_.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new Wt({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=is.acquire().init(t);this._add(i.getItemAt(r),s),is.release(s)}}_grow(t,i){if(i!==0&&(Uoe(t,i,r=>this._objectToBoundingSphere(r),kp),DR(kp[3])&&!this._fitsInsideTree(kp)))if(this._nodeIsEmpty(this._root.node))Q2(kp,this._root.bounds),this._root.halfSize=1.25*kp[3];else{const r=this._rootBoundsForRootAsSubNode(kp);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(kp,r):this._growRootAsSubNode(r),is.release(r)}}_rebuildTree(t,i){ae(pB,i.bounds),pB[3]=i.halfSize,Uoe([t,pB],2,s=>s,fB);const r=is.acquire().init(this._root);this._root.initFrom(null,fB,1.25*fB[3]),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),is.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(r[a]-i),c=r[a]+i-(n[a]+o),h=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,f=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,f),x$[a].min=h,x$[a].max=p}for(let a=0;a<3;a++){let l=x$[a].min,c=x$[a].max;const h=(s-(l+c))/2;l+=Math.ceil(h),c+=Math.floor(h);const p=n[a]-o-l*o*2;dB[a]=p+(c+l)*o}return dB[3]=s*o*ZTe,is.acquire().initFrom(null,dB,s*o,0)}_growRootAsSubNode(t){const i=this._root.node;ae(kp,this._root.bounds),kp[3]=this._root.halfSize,this._root.init(t),t.advanceTo(kp,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!DR(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class is{constructor(){this.bounds=En(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=_(t)?t:is.createEmptyNode(),_(i)&&Q2(i,this.bounds),this.halfSize=r,this.depth=s,this}advance(t){let i=this.node.children[t];i||(i=is.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=XTe[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*ZTe,this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Wt({shrink:!0}),residents:new Wt({shrink:!0})}}static acquire(){return is._pool.acquire()}static release(t){is._pool.release(t)}static clearPool(){is._pool.prune()}}function Tst(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function Sst(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function w$(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function Uoe(e,t,i,r){if(t===1){const s=i(e[0]);Q2(s,r)}else{uu[0]=1/0,uu[1]=1/0,uu[2]=1/0,hu[0]=-1/0,hu[1]=-1/0,hu[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);DR(n[3])&&(Tst(uu,n),Sst(hu,n))}pn(r,uu,hu,.5),r[3]=Math.max(hu[0]-uu[0],hu[1]-uu[1],hu[2]-uu[2])/2}}function Est(e,t,i){if(!Y1.length)for(let r=0;r<8;++r)Y1.push({index:0,distance:0});for(let r=0;r<8;++r){const s=XTe[r];Y1.data[r].index=r,Y1.data[r].distance=ev(e,t,s)}Y1.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=Y1.data[r].index}function hB(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=ev(e,t,zoe[s]);n<i&&(i=n,r=zoe[s])}return r}function ev(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function DR(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}is._pool=new Cs(is),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(OE||(OE={}));const XTe=[Ue(-1,-1,-1),Ue(1,-1,-1),Ue(-1,1,-1),Ue(1,1,-1),Ue(-1,-1,1),Ue(1,-1,1),Ue(-1,1,1),Ue(1,1,1)],zoe=[Ue(-1,-1,-1),Ue(-1,-1,1),Ue(-1,1,-1),Ue(-1,1,1),Ue(1,-1,-1),Ue(1,-1,1),Ue(1,1,-1),Ue(1,1,1)],ZTe=Math.sqrt(3),lq=[null];function Cst(e){return lq[0]=e,lq}const dB=En(),Zu=O(),uu=O(),hu=O(),j_=new Wt,Ast=En(),kp=En(),pB=En(),fB=En(),x$=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Y1=new Wt,Voe=[0,0,0,0,0,0,0,0],dp=OE;class YTe extends K3{constructor(t,i=""){var r,s,n;super(),this.apiLayerUid=i,this.type=Mp.Layer,this.events=new as,this.isSliceable=!1,this._objects=new Wt,this._stageHandles=new Nt,this.apiLayerUid=i,this.isVisible=(r=t==null?void 0:t.isVisible)!=null?r:!0,this.isPickable=(s=t==null?void 0:t.isPickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:hE.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of xst)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),_(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),_(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),_(this._octree)&&this._octree.add(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),_(this._octree)&&this._octree.remove(i)}}sync(){_(this._stage)&&this.updatePolicy!==hE.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){_(this._octree)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return R(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=lt(this._octree)}_createOctree(){this._octree=new dp(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function H4(e){return _(e)&&e.type===Mp.Layer}class QTe{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{_(t)&&this._repository.release(this._material,Vw(i))})}load(t,i){this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,Vw(i)));const r=this._map.get(i);if(_(r)){if(r.ensureResources(t)===lc.LOADED)return r;this._repository.requestRender()}return null}}function Vw(e){switch(e){case je.MATERIAL:return K.Color;case je.MATERIAL_ALPHA:return K.Alpha;case je.MATERIAL_DEPTH:return K.Depth;case je.MATERIAL_NORMAL:return K.Normal;case je.MATERIAL_DEPTH_SHADOWMAP_ALL:return K.Shadow;case je.MATERIAL_HIGHLIGHT:return K.Highlight;case je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return K.Shadow}}const Boe=8;function JTe(e,t){const i=e.vertex;i.uniforms.add(new We("intrinsicWidth",r=>r.width)),t.vvSize?(e.attributes.add(M.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Tt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Tt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Tt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Tt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(M.SIZE,"float"),i.code.add(x`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(M.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new aa("vvOpacityValues",r=>r.vvOpacityValues,Boe),new aa("vvOpacityOpacities",r=>r.vvOpacityOpacities,Boe)]),i.code.add(x`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(x`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(M.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",vp),i.uniforms.add(new aa("vvColorValues",r=>r.vvColorValues,vp)),i.uniforms.add(new TU("vvColorColors",r=>r.vvColorColors,vp)),i.code.add(x`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(M.COLOR,"vec4"),i.code.add(x`vec4 getColor(){
return applyOpacity(color);
}`))}function x_(e,t){e.fragment.include(Lc),t.output===K.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===K.Depth&&e.fragment.code.add(x`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function Rst(e){return R(e)?Vf:e.length===4?e:Ji(Mst,e[0],e[1],e[2],1)}const Mst=Xt();function KTe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?Ost(e,t):Pst(e)}function Ost(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:r,fragment:s}=e;s.include(Lc),r.uniforms.add(new Ni("stipplePatternPixelSize")),t.draped||(nm(r,t),r.uniforms.add(new We("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(x`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),r.code.add(x`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Ist};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(x`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(x`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new We("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(x`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?x`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new zr("stipplePatternTexture")),s.uniforms.add(new Ni("stipplePatternSDFNormalizer")),s.uniforms.add(new Ni("stipplePatternTextureSize")),s.uniforms.add(new Ni("stipplePatternPixelSizeInv")),s.code.add(x`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),s.code.add(x`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?x`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:x`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?x`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?x`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:x`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?x`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:x`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new ni("stippleOffColor",n=>Rst(n.stippleOffColor))),s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(x`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Pst(e){e.fragment.code.add(x`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const Ist=x.float(.4);var jh;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(jh||(jh={}));class Wr extends la{constructor(){super(...arguments),this.output=K.Color,this.capType=jh.BUTT,this.transparencyPassType=gt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}u([H({count:K.COUNT})],Wr.prototype,"output",void 0),u([H({count:jh.COUNT})],Wr.prototype,"capType",void 0),u([H({count:gt.COUNT})],Wr.prototype,"transparencyPassType",void 0),u([H()],Wr.prototype,"occluder",void 0),u([H()],Wr.prototype,"hasSlicePlane",void 0),u([H()],Wr.prototype,"hasPolygonOffset",void 0),u([H()],Wr.prototype,"writeDepth",void 0),u([H()],Wr.prototype,"draped",void 0),u([H()],Wr.prototype,"stippleEnabled",void 0),u([H()],Wr.prototype,"stippleOffColorEnabled",void 0),u([H()],Wr.prototype,"stippleScaleWithLineWidth",void 0),u([H()],Wr.prototype,"stipplePreferContinuous",void 0),u([H()],Wr.prototype,"roundJoins",void 0),u([H()],Wr.prototype,"vvSize",void 0),u([H()],Wr.prototype,"vvColor",void 0),u([H()],Wr.prototype,"vvOpacity",void 0),u([H()],Wr.prototype,"falloffEnabled",void 0),u([H()],Wr.prototype,"innerColorEnabled",void 0),u([H()],Wr.prototype,"hasOccludees",void 0),u([H()],Wr.prototype,"hasMultipassTerrain",void 0),u([H()],Wr.prototype,"cullAboveGround",void 0),u([H()],Wr.prototype,"wireframe",void 0),u([H({constValue:!0})],Wr.prototype,"stippleRequiresClamp",void 0),u([H({constValue:!0})],Wr.prototype,"stippleRequiresStretchMeasure",void 0),u([H({constValue:!0})],Wr.prototype,"hasVvInstancing",void 0),u([H({constValue:!0})],Wr.prototype,"hasSliceTranslatedView",void 0);const q4=1;function $st(e){const t=new Zi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(iU),t.include(JTe,e),t.include(KTe,e),e.output===K.Depth&&t.include(x_,e),Iu(t,e);const{vertex:r,fragment:s}=t;r.uniforms.add([new Tr("inverseProjectionMatrix",(f,m)=>m.camera.inverseProjectionMatrix),new vi("nearFar",(f,m)=>m.camera.nearFar),new We("miterLimit",f=>f.join!=="miter"?0:f.miterLimit),new ni("viewport",(f,m)=>m.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.SUBDIVISIONFACTOR,"float"),t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.AUXPOS1,"vec3"),t.attributes.add(M.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const n=e.capType===jh.ROUND,o=e.stippleEnabled&&e.stippleScaleWithLineWidth||n;o&&t.varyings.add("vLineWidth","float");const a=e.stippleEnabled&&e.stippleScaleWithLineWidth;a&&t.varyings.add("vLineSizeInv","float");const l=e.innerColorEnabled||n;l&&t.varyings.add("vLineDistance","float");const c=e.stippleEnabled&&n,h=e.falloffEnabled||c;h&&t.varyings.add("vLineDistanceNorm","float"),n&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(x`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new We("pixelRatio",(f,m)=>m.camera.pixelRatio)),r.code.add(x`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${o?x`vLineWidth = lineWidth;`:""}
      ${a?x`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||n)&&r.code.add(x`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${n?x`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(x`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(x`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?x`min(1.0, subdivisionFactor * ${x.float((q4+2)/(q4+1))})`:x`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(x`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=e.capType!==jh.BUTT;return r.code.add(x`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?x`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(x`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${h||l?x`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${l?x`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${h?x`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),n&&r.code.add(x`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new We("worldToScreenRatio",(f,m)=>1/m.screenToPCSRatio)):r.code.add(x`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(x`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(x`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(x`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.code.add(x`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(x`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(zu,e),t.include(vs,e),s.include(vm),s.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?s.code.add(x`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(n&&s.code.add(x`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${x.float(Vo)}) {
        discard;
      }
    `),c?s.code.add(x`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${x.float(Vo)}, stippleCoverage);
      `):s.code.add(x`float stippleAlpha = getStippleAlpha();`),s.uniforms.add(new ni("intrinsicColor",f=>f.color)),s.code.add(x`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(s.uniforms.add(new ni("innerColor",f=>vt(f.innerColor,f.color))),s.uniforms.add(new We("innerWidth",(f,m)=>f.innerWidth*m.camera.pixelRatio)),s.code.add(x`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),s.code.add(x`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(s.uniforms.add(new We("falloff",f=>f.falloff)),s.code.add(x`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),s.code.add(x`
    if (finalColor.a < ${x.float(Vo)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const Lst=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:q4,build:$st},Symbol.toStringTag,{value:"Module"})),sJ={func:gr.LESS},W4={func:gr.ALWAYS},am={mask:255},eSe={mask:0},Dst=e=>({function:{func:gr.NOTEQUAL,ref:e,mask:e},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.KEEP}}),Nst=e=>({function:{func:gr.ALWAYS,ref:e,mask:e},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.REPLACE}}),T_={function:{func:gr.ALWAYS,ref:Ml.OutlineVisualElementMask,mask:Ml.OutlineVisualElementMask},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.ZERO}},d_={function:{func:gr.ALWAYS,ref:Ml.OutlineVisualElementMask,mask:Ml.OutlineVisualElementMask},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.REPLACE}},tSe={function:{func:gr.EQUAL,ref:Ml.OutlineVisualElementMask,mask:Ml.OutlineVisualElementMask},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.KEEP}},iSe={function:{func:gr.NOTEQUAL,ref:Ml.OutlineVisualElementMask,mask:Ml.OutlineVisualElementMask},operation:{fail:os.KEEP,zFail:os.KEEP,zPass:os.KEEP}},rSe=new Map([[M.POSITION,0],[M.SUBDIVISIONFACTOR,1],[M.UV0,2],[M.AUXPOS1,3],[M.AUXPOS2,4],[M.COLOR,5],[M.COLORFEATUREATTRIBUTE,5],[M.SIZE,6],[M.SIZEFEATUREATTRIBUTE,6],[M.OPACITYFEATUREATTRIBUTE,7]]);class DU extends pr{constructor(t,i,r){super(t,i,r),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const i=DU.shader.get().build(this.configuration);return new sr(t.rctx,i,rSe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}_makePipelineState(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Bt({blending:r.output===K.Color||r.output===K.Alpha?s?$u:xy(t):null,depthTest:{func:w_(t)},depthWrite:s?r.writeDepth&&Nl:SU(t),colorWrite:ri,stencilWrite:r.hasOccludees?am:null,stencilTest:r.hasOccludees?i?d_:T_:null,polygonOffset:s||n?r.hasPolygonOffset&&Goe:CU})}initializePipeline(){const t=this.configuration;if(t.occluder){const i=t.hasPolygonOffset&&Goe;this._occluderPipelineTransparent=Bt({blending:$u,polygonOffset:i,depthTest:W4,depthWrite:null,colorWrite:ri,stencilWrite:null,stencilTest:iSe}),this._occluderPipelineOpaque=Bt({blending:$u,polygonOffset:i,depthTest:W4,depthWrite:null,colorWrite:ri,stencilWrite:eSe,stencilTest:tSe}),this._occluderPipelineMaskWrite=Bt({blending:null,polygonOffset:i,depthTest:sJ,depthWrite:null,colorWrite:null,stencilWrite:am,stencilTest:d_})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?$t.LINES:$t.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}DU.shader=new rr(Lst,()=>import("./RibbonLine.glsl.04592666.js"));const Goe={factor:0,units:-4},Fst=fe.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var tc;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(tc||(tc={}));class BS extends bm{constructor(t){super(t,new Ust),this._vertexAttributeLocations=rSe,this.techniqueConfig=new Wr,this.layout=this.createLayout()}isClosed(t,i){return sSe(this.parameters,t,i)}getConfiguration(t,i){this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Ee.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern)&&t!==K.Highlight;return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&_(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===Dr.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectDrapedLineGeometry(t,i,r,s,n){if(!i.options.selectionMode)return;const o=t.vertexAttributes.get(M.POSITION).data,a=t.vertexAttributes.get(M.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const y=t.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0];l*=De(this.parameters.vvSizeOffset[0]+y*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],h=s[1],p=(l/2+4)*t.screenToWorldRatio;let f=Number.MAX_VALUE,m=0;for(let y=0;y<o.length-5;y+=3){const v=o[y],w=o[y+1],b=c-v,S=h-w,T=o[y+3]-v,E=o[y+4]-w,C=De((T*b+E*S)/(T*T+E*E),0,1),A=T*C-b,I=E*C-S,D=A*A+I*I;D<f&&(f=D,m=y/3)}f<p*p&&n(r.dist,r.normal,m,!1)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||eP(i))return;if(!dwe(r))return void Fst.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(M.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const b=o.get(M.SIZEFEATUREATTRIBUTE).data[0];l*=De(this.parameters.vvSizeOffset[0]+b*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(M.SIZE)&&(l*=o.get(M.SIZE).data[0]);const c=s.camera,h=Vst;_o(h,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;se(eA[0],h[0]-p,h[1]+p,0),se(eA[1],h[0]+p,h[1]+p,0),se(eA[2],h[0]+p,h[1]-p,0),se(eA[3],h[0]-p,h[1]-p,0);for(let b=0;b<4;b++)if(!c.unprojectFromRenderScreen(eA[b],Pm[b]))return;na(c.eye,Pm[0],Pm[1],gB),na(c.eye,Pm[1],Pm[2],yB),na(c.eye,Pm[2],Pm[3],vB),na(c.eye,Pm[3],Pm[0],_B);let f=Number.MAX_VALUE,m=0;const y=cq(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let b=0;b<y;b+=3){el[0]=a[b]+r[12],el[1]=a[b+1]+r[13],el[2]=a[b+2]+r[14];const S=(b+3)%a.length;if(tl[0]=a[S]+r[12],tl[1]=a[S+1]+r[13],tl[2]=a[S+2]+r[14],lr(gB,el)<0&&lr(gB,tl)<0||lr(yB,el)<0&&lr(yB,tl)<0||lr(vB,el)<0&&lr(vB,tl)<0||lr(_B,el)<0&&lr(_B,tl)<0)continue;if(c.projectToRenderScreen(el,q_),c.projectToRenderScreen(tl,W_),q_[2]<0&&W_[2]>0){pe(Up,el,tl);const E=c.frustum,C=-lr(E[ar.NEAR],el)/xe(Up,E[ar.NEAR]);le(Up,Up,C),de(el,el,Up),c.projectToRenderScreen(el,q_)}else if(q_[2]>0&&W_[2]<0){pe(Up,tl,el);const E=c.frustum,C=-lr(E[ar.NEAR],tl)/xe(Up,E[ar.NEAR]);le(Up,Up,C),de(tl,tl,Up),c.projectToRenderScreen(tl,W_)}else if(q_[2]<0&&W_[2]<0)continue;q_[2]=0,W_[2]=0;const T=nZ(ew(q_,W_,qoe),h);T<f&&(f=T,ae(joe,el),ae(Hoe,tl),m=b/3)}const v=s.rayBegin,w=s.rayEnd;if(f<p*p){let b=Number.MAX_VALUE;if(Dge(ew(joe,Hoe,qoe),ew(v,w,Bst),H_)){pe(H_,H_,v);const S=Me(H_);le(H_,H_,1/S),b=S/ur(v,w)}n(b,H_,m,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=t.indices,n=r.get(M.POSITION);return uQ(n,s?s.get(M.POSITION):null,s&&cq(this.parameters,r,s),i)}createLayout(){const t=ls().vec3f(M.POSITION).f32(M.SUBDIVISIONFACTOR).vec2f(M.UV0).vec3f(M.AUXPOS1).vec3f(M.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(M.SIZEFEATUREATTRIBUTE):t.f32(M.SIZE),this.parameters.vvColorEnabled?t.f32(M.COLORFEATUREATTRIBUTE):t.vec4f(M.COLOR),this.parameters.vvOpacityEnabled&&t.f32(M.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new zst(this.layout,this.parameters)}requiresSlot(t,i){if(t===Ee.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Dr.OccludeAndTransparentStencil)return t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL;const r=Vw(i);return r===K.Color||r===K.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new kst(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class kst extends __{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(DU,t)}}class Ust extends jQ{constructor(){super(...arguments),this.width=0,this.color=Nh,this.join="miter",this.cap=jh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class zst{constructor(t,i){this.parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=q4+r}}_isClosed(t){return cq(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(M.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s){var V;const n=Gst,o=jst,a=Hst,l=i.vertexAttributes.get(M.POSITION).data,c=i.indices&&i.indices.get(M.POSITION),h=(V=i.vertexAttributes.get(M.DISTANCETOSTART))==null?void 0:V.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,f=0;this.parameters.vvSizeEnabled?f=i.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(M.SIZE)&&(p=i.vertexAttributes.get(M.SIZE).data[0]);let m=[1,1,1,1],y=0;this.parameters.vvColorEnabled?y=i.vertexAttributes.get(M.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(M.COLOR)&&(m=i.vertexAttributes.get(M.COLOR).data);let v=0;this.parameters.vvOpacityEnabled&&(v=i.vertexAttributes.get(M.OPACITYFEATUREATTRIBUTE).data[0]);const w=l.length/3,b=t.transformation,S=new Float32Array(r.buffer),T=this.vertexBufferLayout.stride/4;let E=s*T;const C=E;let A=0;const I=h?(Q,Z,ce)=>A=h[ce]:(Q,Z,ce)=>A+=ur(Q,Z),D=(Q,Z,ce,oe,$,U,G)=>{if(S[E++]=Z[0],S[E++]=Z[1],S[E++]=Z[2],S[E++]=oe,S[E++]=G,S[E++]=$,S[E++]=Q[0],S[E++]=Q[1],S[E++]=Q[2],S[E++]=ce[0],S[E++]=ce[1],S[E++]=ce[2],this.parameters.vvSizeEnabled?S[E++]=f:S[E++]=p,this.parameters.vvColorEnabled)S[E++]=y;else{const W=Math.min(4*U,m.length-4);S[E++]=m[W+0],S[E++]=m[W+1],S[E++]=m[W+2],S[E++]=m[W+3]}this.parameters.vvOpacityEnabled&&(S[E++]=v)};E+=T,se(o,l[0],l[1],l[2]),b&&ze(o,o,b);const L=this._isClosed(i);if(L){const Q=l.length-3;se(n,l[Q],l[Q+1],l[Q+2]),b&&ze(n,n,b)}else se(a,l[3],l[4],l[5]),b&&ze(a,a,b),D(o,o,a,1,tc.LEFT_CAP_START,0,0),D(o,o,a,1,tc.RIGHT_CAP_START,0,0),ae(n,o),ae(o,a);const z=L?0:1,B=L?w:w-1;for(let Q=z;Q<B;Q++){const Z=(Q+1)%w*3;se(a,l[Z+0],l[Z+1],l[Z+2]),b&&ze(a,a,b),I(n,o,Q),D(n,o,a,0,tc.LEFT_JOIN_END,Q,A),D(n,o,a,0,tc.RIGHT_JOIN_END,Q,A);const ce=this.numJoinSubdivisions;for(let oe=0;oe<ce;++oe){const $=(oe+1)/(ce+1);D(n,o,a,$,tc.LEFT_JOIN_END,Q,A),D(n,o,a,$,tc.RIGHT_JOIN_END,Q,A)}D(n,o,a,1,tc.LEFT_JOIN_START,Q,A),D(n,o,a,1,tc.RIGHT_JOIN_START,Q,A),ae(n,o),ae(o,a)}L?(se(a,l[3],l[4],l[5]),b&&ze(a,a,b),A=I(n,o,B),D(n,o,a,0,tc.LEFT_JOIN_END,z,A),D(n,o,a,0,tc.RIGHT_JOIN_END,z,A)):(A=I(n,o,B),D(n,o,o,0,tc.LEFT_CAP_END,B,A),D(n,o,o,0,tc.RIGHT_CAP_END,B,A)),mB(S,C+T,S,C,T),E=mB(S,E-T,S,E,T),this.parameters.wireframe&&this._addWireframeVertices(r,C,E,T)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=mB(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function mB(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function cq(e,t,i){return sSe(e,t.get(M.POSITION).data,i?i.get(M.POSITION):null)}function sSe(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const el=O(),tl=O(),Up=O(),H_=O(),Vst=O(),q_=Fo(),W_=Fo(),joe=O(),Hoe=O(),qoe=fm(),Bst=fm(),Gst=O(),jst=O(),Hst=O(),eA=[Fo(),Fo(),Fo(),Fo()],Pm=[O(),O(),O(),O()],gB=Si(),yB=Si(),vB=Si(),_B=Si();class nJ{constructor(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Cl()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){const h=wst.rootOrigin;if(_(h))return this._origins.set(this._rootOriginId,OM(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=OM(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),o=Math.round(t[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(pe(Zn,t,i.vec3),Zn[0]=Math.abs(Zn[0]),Zn[1]=Math.abs(Zn[1]),Zn[2]=Math.abs(Zn[2]),Zn[0]<c&&Zn[1]<c&&Zn[2]<c){if(l){const h=Math.max(...Zn);if(pe(Zn,t,l.vec3),Zn[0]=Math.abs(Zn[0]),Zn[1]=Math.abs(Zn[1]),Zn[2]=Math.abs(Zn[2]),Math.max(...Zn)<h)return l}return i}return l||(l=OM(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(t,i=bi(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new BS({width:2,color:i}),s.add(this._material);const m=new YTe({isPickable:!1}),y=new Sy({castShadow:!1});s.add(y),m.add(y),s.add(m),this._objects.set(n,y)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Uint16Array(2*(l-1)),p=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m+0]=t[0]+(1&a[m]?p:-p),c[3*m+1]=t[1]+(2&a[m]?p:-p),c[3*m+2]=t[2]+(4&a[m]?p:-p),m>0&&(h[2*m+0]=m-1,h[2*m+1]=m);dr(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new Fr([[M.POSITION,{size:3,data:c,exclusive:!0}]],[[M.POSITION,h]],Ol.Line);s.add(f),o.addGeometry(f,this._material,hn)}}const Zn=O();class nSe{constructor(t,i,r,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new tr,this.pass=je.MATERIAL,this.renderOccludedMask=Woe,this.bindParameters=new aU(i,r,_(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=Woe}get isHighlightPass(){return this.pass===je.MATERIAL_HIGHLIGHT}}class qst extends nSe{constructor(t,i,r,s,n){super(t,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n}}const Woe=Dr.Occlude|Dr.OccludeAndTransparent|Dr.OccludeAndTransparentStencil;var PE;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(PE||(PE={}));class T${constructor(){this.camera=new tr,this.lightMat=Ae()}}class oJ{constructor(t,i,r=0){this.rctx=t,this.viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=Xt(),this._cascades=[new T$,new T$,new T$,new T$],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=r}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return Ji(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=De(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&_(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const i=this._snapshots.length;if(t>i){const r=t-i;this._snapshots.length=t;for(let s=0;s<r;++s)this._snapshots[i+s]=null}else if(t<this.snapshotCount){const r=i-t;for(let s=0;s<r;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)wB[t]=this._cascades[t];return wB.length=this.numCascades,wB}start(t,i,r){pt(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,a,o,i);this.lastOrigin=null,this.clear()}finish(t){pt(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!Tl(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||O(),ae(this.lastOrigin,t);for(let i=0;i<this.numCascades;++i){qa(rae,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)sae[16*i+r]=rae[r]}}return sae}takeCascadeSnapshotTo(t,i){pt(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this.rctx,n=s.bindTexture(r,nt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(ft.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,nt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(er.COLOR_BUFFER_BIT|er.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(_(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new nt(this.rctx,t),this._fbo=new Rr(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let i=this._snapshots[t];if(_(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(t);const r={target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new nt(this.rctx,r),this._snapshots[t]=i,i}_discardDepthTexture(){this._fbo=Ze(this._fbo),this._depthTexture=Ze(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=Ze(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,i,r,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);pt(l<c);for(let p=0;p<8;++p){Ji(Qoe,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),Eu(Jl[p],Qoe,Yoe);for(let f=0;f<3;++f)Jl[p][f]/=Jl[p][3]}ca(bB,Jl[0]),qa(Xoe,iae,bB),n.camera.viewMatrix=Xoe;for(let p=0;p<8;++p)ze(Jl[p],Jl[p],n.camera.viewMatrix);ae(zp,Jl[0]),ae(Vp,Jl[0]);for(let p=1;p<8;++p)for(let f=0;f<3;++f)zp[f]=Math.min(zp[f],Jl[p][f]),Vp[f]=Math.max(Vp[f],Jl[p][f]);zp[2]-=200,Vp[2]+=200,n.camera.near=-Vp[2],n.camera.far=-zp[2],this.warp?this._constructTrapezoidalProjection(r,s,n):this._constructOrthogonalProjection(n),Hr(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:h,n.camera.viewport[1]=Math.floor(t/2)===0?0:h,n.camera.viewport[2]=h,n.camera.viewport[3]=h}_constructOrthogonalProjection(t){HX(t.camera.projectionMatrix,zp[0],Vp[0],zp[1],Vp[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,i,r){const s=1/Jl[0][3],n=1/Jl[4][3];pt(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(fn(t[2]*i[0]+t[6]*i[1]+t[10]*i[2]));o/=a,Xst(Jl,o,a,Joe,Koe,Wst,eae,tae),Zst(Joe,Koe,eae,tae,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(zp[2]-Vp[2]),r.camera.projectionMatrix[14]=-(zp[2]+Vp[2])/(zp[2]-Vp[2])}_setupMatrices(t,i){Hr(Zoe,t.projectionMatrix,t.viewMatrix),_s(Yoe,Zoe);const r=this.viewingMode===Ge.Global?t.eye:se(bB,0,0,1);lk(iae,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this.numCascades=Math.min(1+Math.floor(uYe(t/i,4)),this.maxNumCascades);const r=(t-i)/this.numCascades,s=(t/i)**(1/this.numCascades);let n=i,o=i;for(let a=0;a<this.numCascades+1;++a)this._cascadeDistances[a]=Yt(n,o,this.splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+Mw(s),(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){t.splitSchemeLambda=i},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(i){t.warp=i},get warp(){return t.warp}}}}const Xoe=Ae(),Zoe=Ae(),Yoe=Ae(),Qoe=Xt(),Jl=[];for(let e=0;e<8;++e)Jl.push(Xt());const zp=O(),Vp=O(),Joe=it(),Koe=it(),Wst=it(),eae=it(),tae=it(),iae=Ae(),bB=O(),wB=[],rae=Ae(),sae=new Float32Array(64),Vc=it(),Ux=it(),X_=[it(),it(),it(),it()],mn=it(),xB=it(),By=it(),tA=it(),zx=it(),Vx=it(),S$=it();function Xst(e,t,i,r,s,n,o,a){yi(Vc,0,0);for(let C=0;C<4;++C)Wd(Vc,Vc,e[C]);pc(Vc,Vc,.25),yi(Ux,0,0);for(let C=4;C<8;++C)Wd(Ux,Ux,e[C]);pc(Ux,Ux,.25),iS(X_[0],e[4],e[5],.5),iS(X_[1],e[5],e[6],.5),iS(X_[2],e[6],e[7],.5),iS(X_[3],e[7],e[4],.5);let l=0,c=m4(X_[0],Vc);for(let C=1;C<4;++C){const A=m4(X_[C],Vc);A<c&&(c=A,l=C)}$f(mn,X_[l],e[l+4]);const h=mn[0];let p,f;mn[0]=-mn[1],mn[1]=h,$f(xB,Ux,Vc),Js(xB,mn)<0&&kY(mn,mn),iS(mn,mn,xB,i),SO(mn,mn),p=f=Js($f(By,e[0],Vc),mn);for(let C=1;C<8;++C){const A=Js($f(By,e[C],Vc),mn);A<p?p=A:A>f&&(f=A)}_o(r,Vc),pc(By,mn,p-t),Wd(r,r,By);let m=-1,y=1,v=0,w=0;for(let C=0;C<8;++C){$f(tA,e[C],r),SO(tA,tA);const A=mn[0]*tA[1]-mn[1]*tA[0];A>0?A>m&&(m=A,v=C):A<y&&(y=A,w=C)}Rx(m>0,"leftArea"),Rx(y<0,"rightArea"),pc(zx,mn,p),Wd(zx,zx,Vc),pc(Vx,mn,f),Wd(Vx,Vx,Vc),S$[0]=-mn[1],S$[1]=mn[0];const b=BI(r,e[w],Vx,Wd(By,Vx,S$),1,s),S=BI(r,e[v],Vx,By,1,n),T=BI(r,e[v],zx,Wd(By,zx,S$),1,o),E=BI(r,e[w],zx,By,1,a);Rx(b,"rayRay"),Rx(S,"rayRay"),Rx(T,"rayRay"),Rx(E,"rayRay")}function di(e,t){return 3*t+e}const nae=it();function Vl(e,t){return yi(nae,e[t],e[t+3]),nae}const il=it(),Qe=Or();function Zst(e,t,i,r,s){$f(il,i,r),pc(il,il,.5),Qe[0]=il[0],Qe[1]=il[1],Qe[2]=0,Qe[3]=il[1],Qe[4]=-il[0],Qe[5]=0,Qe[6]=il[0]*il[0]+il[1]*il[1],Qe[7]=il[0]*il[1]-il[1]*il[0],Qe[8]=1,Qe[di(0,2)]=-Js(Vl(Qe,0),e),Qe[di(1,2)]=-Js(Vl(Qe,1),e);let n=Js(Vl(Qe,0),i)+Qe[di(0,2)],o=Js(Vl(Qe,1),i)+Qe[di(1,2)],a=Js(Vl(Qe,0),r)+Qe[di(0,2)],l=Js(Vl(Qe,1),r)+Qe[di(1,2)];n=-(n+a)/(o+l),Qe[di(0,0)]+=Qe[di(1,0)]*n,Qe[di(0,1)]+=Qe[di(1,1)]*n,Qe[di(0,2)]+=Qe[di(1,2)]*n,n=1/(Js(Vl(Qe,0),i)+Qe[di(0,2)]),o=1/(Js(Vl(Qe,1),i)+Qe[di(1,2)]),Qe[di(0,0)]*=n,Qe[di(0,1)]*=n,Qe[di(0,2)]*=n,Qe[di(1,0)]*=o,Qe[di(1,1)]*=o,Qe[di(1,2)]*=o,Qe[di(2,0)]=Qe[di(1,0)],Qe[di(2,1)]=Qe[di(1,1)],Qe[di(2,2)]=Qe[di(1,2)],Qe[di(1,2)]+=1,n=Js(Vl(Qe,1),t)+Qe[di(1,2)],o=Js(Vl(Qe,2),t)+Qe[di(2,2)],a=Js(Vl(Qe,1),i)+Qe[di(1,2)],l=Js(Vl(Qe,2),i)+Qe[di(2,2)],n=-.5*(n/o+a/l),Qe[di(1,0)]+=Qe[di(2,0)]*n,Qe[di(1,1)]+=Qe[di(2,1)]*n,Qe[di(1,2)]+=Qe[di(2,2)]*n,n=Js(Vl(Qe,1),t)+Qe[di(1,2)],o=Js(Vl(Qe,2),t)+Qe[di(2,2)],a=-o/n,Qe[di(1,0)]*=a,Qe[di(1,1)]*=a,Qe[di(1,2)]*=a,s[0]=Qe[0],s[1]=Qe[1],s[2]=0,s[3]=Qe[2],s[4]=Qe[3],s[5]=Qe[4],s[6]=0,s[7]=Qe[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=Qe[6],s[13]=Qe[7],s[14]=0,s[15]=Qe[8]}class oSe{constructor(){this.adds=new Wt,this.removes=new Wt,this.updates=new Wt({allocator:t=>t||new Yst,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class Yst{}class Qst{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var ti;(function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"})(ti||(ti={}));function aSe(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new Qst,t.set(r,s)),s};return e.removes.forAll(r=>{TB(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{TB(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{TB(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function TB(e){return e.data.indexCount>=1}function Jst(e){const t=x`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function NU(e,t){t.normalType===Mr.Attribute&&(e.attributes.add(M.NORMAL,"vec3"),e.vertex.code.add(x`vec3 normalModel() {
return normal;
}`)),t.normalType===Mr.CompressedAttribute&&(e.include(Jst),e.attributes.add(M.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(x`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===Mr.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(x`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var Mr;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(Mr||(Mr={}));function FU(e){e.attributes.add(M.POSITION,"vec3"),e.vertex.code.add(x`vec3 positionModel() { return position; }`)}function X4({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(x`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(x`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function dP(e){return!!he("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function p2(e,t){e.include(FU);const i=e.vertex;i.include(X4,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new Tt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Tt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new nP("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Tr("transformProjFromView",r=>r.transformProjFromView),new MO("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Ga("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Ga("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(x`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(x`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?x`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:x`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new Tt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(x`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class lSe extends Ws{constructor(){super(...arguments),this.transformWorldFromViewTH=O(),this.transformWorldFromViewTL=O(),this.transformViewFromCameraRelativeRS=Or(),this.transformProjFromView=Ae()}}class cSe extends Ws{constructor(){super(...arguments),this.transformWorldFromModelRS=Or(),this.transformWorldFromModelTH=Ri(),this.transformWorldFromModelTL=Ri()}}function kU(e,t){t.normalType===Mr.Attribute||t.normalType===Mr.CompressedAttribute?(e.include(NU,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new MO("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new nP("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),e.vertex.code.add(x`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===Mr.Ground?(e.include(p2,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(x`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?x`normalize(vPositionWorldCameraRelative);`:x`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(x`void forwardNormal() {}`)}class uSe extends lSe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Or()}}class hSe extends cSe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Or(),this.toMapSpace=Xt()}}class uq extends hSe{constructor(t=O()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function pP(e,t){t.output===K.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(x`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===K.Depth||t.output===K.Shadow?(e.include(p2,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new vi("nearFar",(i,r)=>r.camera.nearFar)),e.vertex.code.add(x`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(x`void forwardLinearDepth() {}`)}function Mv(e,t){t.spherical?e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(x`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(x`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class fP extends Kr{constructor(t,i){super(t,"int",ki.Pass,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}class dSe extends Kr{constructor(t,i,r,s){switch(i){case ki.Pass:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s);case ki.Draw:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s)}}}class pSe extends Ws{constructor(){super(...arguments),this.origin=O()}}function UU(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new dSe("shadowMapMatrix",ki.Pass,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),fSe(e))}function Bw(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new dSe("shadowMapMatrix",ki.Draw,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),fSe(e))}function fSe(e){const t=e.fragment;t.include(Lc),t.uniforms.add([new jt("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new fP("numCascades",(i,r)=>r.shadowMap.numCascades),new ni("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances),new We("depthHalfPixelSz",(i,r)=>.5/r.shadowMap.textureSize)]),t.code.add(x`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function Kst(e){e.fragment.code.add(x`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function ent(e){e.fragment.code.add(x`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function tnt(e){const t=e.fragment.code;t.add(x`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(x`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(x`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function zU(e,t){const i=e.fragment.code;e.include(iU),t.pbrMode===Ot.Water||t.pbrMode===Ot.WaterOnIntegratedMesh?(i.add(x`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(x`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(x`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(x`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(x`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||(e.include(tnt),i.add(x`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(x`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(x`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(x`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(x`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(x`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function mSe(e,t){e.include(zU,t),e.include(eU),e.include(ent),t.hasCloudsReflections&&e.include(Wbe,t),t.hasScreenSpaceReflections&&e.include(FZe,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(x`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new We("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new We("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(x`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(x`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(x`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(x`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(x`return waterRenderedColor;
}`)}function oae(e){e.fragment.uniforms.add(new zr("texWaveNormal")),e.fragment.uniforms.add(new zr("texWavePerturbation")),e.fragment.uniforms.add([new ni("waveParams",t=>Ji(int,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new vi("waveDirection",t=>yi(rnt,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(Kst),e.fragment.code.add(x`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const int=Xt(),rnt=it();function snt(e){const t=new Zi,{vertex:i,fragment:r}=t,s=Iu(t,e);return t.include(Uo),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.UV0,"vec2"),i.uniforms.add(new ni("waterColor",n=>n.color)),e.output!==K.Color&&e.output!==K.Alpha||(t.include(Mv,e),t.include(pP,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),r.uniforms.add(s),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Vo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===K.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(zu,e),e.output===K.Alpha&&(t.include(vs,e),r.uniforms.add(new Va("waterColor")),r.code.add(x`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===K.Color&&(t.include(JY,{isGround:!1}),t.include(QY,{pbrMode:Ot.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(oae),t.include(vs,e),t.include(Bw,e),t.include(mSe,e),r.uniforms.add([new Va("waterColor"),new Tt("lightingMainDirection",(n,o)=>o.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity),new We("timeElapsed",n=>n.timeElapsed),new e_("view")]),nm(r,e),r.include(vm),r.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?x`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===K.Normal&&(t.include(Mv,e),t.include(oae,e),t.include(vs,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Vo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new We("timeElapsed",n=>n.timeElapsed)),r.code.add(x`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===K.Draped&&(t.varyings.add("vpos","vec3"),i.code.add(x`
        void main(void) {
          if (waterColor.a < ${x.float(Vo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new Va("waterColor")),r.code.add(x`void main() {
gl_FragColor = waterColor;
}`)),e.output===K.Highlight&&(t.include(wy),t.varyings.add("vpos","vec3"),i.code.add(x`
      void main(void) {
        if (waterColor.a < ${x.float(Vo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(vs,e),r.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const nnt=Object.freeze(Object.defineProperty({__proto__:null,build:snt},Symbol.toStringTag,{value:"Module"}));class VU extends pr{constructor(t,i,r){super(t,i,r),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=dP(t.rctx)}initializeProgram(t){const i=VU.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}bindPass(t,i){this.program.bindPass(t,i),this.configuration.output!==K.Color&&this.configuration.output!==K.Normal||this._textureRepository.bind(this.program)}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace;return Bt({blending:i.output!==K.Normal&&i.output!==K.Highlight&&i.transparent?r?$u:xy(t):null,depthTest:{func:w_(t)},depthWrite:r?i.writeDepth&&Nl:SU(t),colorWrite:ri,polygonOffset:r||s?null:AU(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}VU.shader=new rr(nnt,()=>import("./WaterSurface.glsl.7f09ef29.js"));class ro extends la{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=gt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([H({count:K.COUNT})],ro.prototype,"output",void 0),u([H({count:gt.COUNT})],ro.prototype,"transparencyPassType",void 0),u([H()],ro.prototype,"spherical",void 0),u([H()],ro.prototype,"receiveShadows",void 0),u([H()],ro.prototype,"hasSlicePlane",void 0),u([H()],ro.prototype,"transparent",void 0),u([H()],ro.prototype,"enableOffset",void 0),u([H()],ro.prototype,"writeDepth",void 0),u([H()],ro.prototype,"hasScreenSpaceReflections",void 0),u([H()],ro.prototype,"doublePrecisionRequiresObfuscation",void 0),u([H()],ro.prototype,"hasCloudsReflections",void 0),u([H()],ro.prototype,"isDraped",void 0),u([H()],ro.prototype,"hasMultipassTerrain",void 0),u([H()],ro.prototype,"cullAboveGround",void 0),u([H({constValue:Ot.Water})],ro.prototype,"pbrMode",void 0),u([H({constValue:!0})],ro.prototype,"useCustomDTRExponentForWater",void 0),u([H({constValue:!0})],ro.prototype,"highStepCount",void 0),u([H({constValue:!1})],ro.prototype,"useFillLights",void 0);class aae extends __{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const i=_(t.clouds.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(t){const i=this._techniqueRepository.constructionContext.waterTextureRepository;return i.resourceState===lc.NOT_LOADED&&i.loadTextures(t),i.resourceState}beginSlot(t){return this._output===K.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this.ensureTechnique(VU,t)}}const ont=ls().vec3f(M.POSITION),ant=ls().vec3f(M.POSITION).vec2f(M.UV0),gSe=ls().vec3f(M.POSITION).vec4u8(M.COLOR);class BU{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(M.POSITION).length}write(t,i,r,s){xU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}class ySe extends bm{constructor(t){super(t,new vSe),this._techniqueConfig=new ro,this.animation=new gwe}getConfiguration(t,i){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=i.transparencyPassType,this._techniqueConfig.enableOffset=i.camera.relativeElevation<EU,this._techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<lnt;const r=this.animation.advance(t);return this.setParameters({timeElapsed:MW(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}intersect(t,i,r,s,n,o,a){bU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){switch(Vw(i)){case K.Normal:return t===Ee.DRAPED_WATER;case K.Color:if(this.parameters.isDraped)return t===Ee.DRAPED_MATERIAL;break;case K.Highlight:return t===Ee.OPAQUE_MATERIAL||t===Ee.DRAPED_MATERIAL}let r=Ee.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){if(t.output===K.Color&&this.parameters.isDraped)return t.output=K.Draped,new aae(t);switch(t.output){case K.Color:case K.Normal:case K.Highlight:case K.Alpha:return new aae(t)}return null}createBufferWriter(){return new BU(ant)}}class vSe extends dC{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Di(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=bi(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const lnt=35e3;class lae{constructor(t){this.first=t.from,this.count=t.to-t.from}}class sS{constructor(t=0,i=0){this.from=t,this.to=i}}class cnt extends sS{constructor(t,i,r,s,n,o){super(i,r),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function cae(e){return Array.from(e.values()).sort(unt)}function unt(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function E$(e,t){if(e.length===0)return void e.push(new lae(t));const i=e[e.length-1];if(hnt(i,t)){const r=t.from-i.first+t.to-t.from;i.count=r}else e.push(new lae(t))}function hnt(e,t){return e.first+e.count>=t.from}class dnt{constructor(t,i){this._pool=t,this._size=0,this._buffer=t.newBuffer(hq(i))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,i){let r;const s=pnt(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);i&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.byteLength)),r=this._buffer,this._buffer=o}const n=this._size;return this._size=t,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(o,a,l)=>this._buffer.array.set(r.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,i){this._buffer.array.fill(0,t,i)}}const uae=65536;function hq(e){return Math.ceil(e/uae)*uae}function pnt(e,t,i){return t<=i?e>=i?e:hq(Math.max(2*e,i)):e<=2*i?e:hq(i)}class fnt{constructor(t,i,r,s){this.vao=new Hs(t,i,{geometry:r},{geometry:oi.createVertex(t,Ei.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const mnt=AD+1;class gnt{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${Cl()}`,ynt)}dispose(){this._cache.destroy()}newBuffer(t){const i=t.toString(),r=this._cache.pop(i);if(_(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,s.array.byteLength*r.length,mnt),s}return new fnt(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const i=t.array.byteLength,r=t.array.length.toString(),s=this._cache.pop(r);return _(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function ynt(e,t){if(t===wg.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}class _Se{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new Wt,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new QTe(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new gnt(t,r.vertexAttributeLocations,Dc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof ySe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==Dr.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,i){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=_nt(t,i);o.forEach((a,l)=>{o.delete(l);const c=a.toAdd.reduce((b,S)=>b+r.elementCount(S.data),0);let h=n.get(l);if(h==null)pt(a.toRemove.length===0),h=new wnt(a.origin,new dnt(this._bufferPool,c*s)),n.set(l,h);else if(a.toAdd.length===0&&h.instances.size===a.toRemove.length)return h.buffer.dispose(),void n.delete(l);let p=0;h.instances.forEach(b=>p+=b.to-b.from);const f=a.toRemove.reduce((b,S)=>b+r.elementCount(S.data),0),m=h.buffer.size,y=(p+c-f)*s,v=Tnt;if(y<m/2?this._removeAndRebuild(h,a.toRemove,s,y,v):a.toRemove.length>0&&this._remove(h,a.toRemove,s,v),a.toAdd.length>0){const b=Snt;hwe(b,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(h,a.toAdd,s,b,v)}const w=h.buffer.vao.vertexBuffers.geometry;pae(v),v.forAll(({from:b,to:S})=>{if(b<S){const T=h.buffer.array,E=4,C=b*E,A=S*E;w.setSubData(T,C,C,A)}}),v.clear(),h.drawCommandsDirty=!0})}_updateGeometries(t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&ti.State.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(ti.State.HIGHLIGHTS|ti.State.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&ti.State.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(ti.State.VERTEXATTRS|ti.State.TRANSFORMATION)){const{array:c,vao:h}=o.buffer;FQe(n,SB,iA),i.write({transformation:SB,invTranspTransformation:iA},n.data,i.vertexBufferLayout.createView(c.buffer),a.from),pt(a.from+i.elementCount(n.data)===a.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(c,a.from*r*4,a.from*r*4,a.to*r*4)}o.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(i=>{i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,sn(i.instances,r=>(r.isVisible?(r.hasHighlights&&(this._hasHighlights=!0,i.hasHighlights=!0),r.hasOccludees&&(this._hasOccludees=!0,i.hasOccludees=!0)):i.hasHiddenInstances=!0,i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees))});const t=i=>{if(i.drawCommandsDefault=null,i.drawCommandsHighlight=null,i.drawCommandsOccludees=null,i.drawCommandsShadowHighlightRest=null,i.instances.size===0)return;if(!dae(i)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*i.buffer.size/s;return void(i.drawCommandsDefault=[{first:0,count:n}])}const r=cae(i.instances);i.drawCommandsDefault=[],i.drawCommandsHighlight=[],i.drawCommandsOccludees=[],i.drawCommandsShadowHighlightRest=[];for(const s of r)s.isVisible&&(s.hasOccludees?E$(i.drawCommandsOccludees,s):E$(i.drawCommandsDefault,s),s.hasHighlights?E$(i.drawCommandsHighlight,s):E$(i.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(i=>{i.drawCommandsDirty&&(t(i),i.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,i){return t==null||this._material.requiresSlot(t,i)}render(t,i){if(!this.requiresSlot(i.slot,t))return!1;const r=t===je.MATERIAL_HIGHLIGHT||t===je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(r&&!this._hasHighlights)return!1;const s=t===je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(r||s);if(this._dataByOrigin.forEach(c=>{if(r&&!c.hasHighlights)return;const h=(r?c.drawCommandsHighlight:s&&dae(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,p=n&&c.drawCommandsOccludees||null;(_(h)||_(p))&&this._renderCommandData.push(new xnt(c.origin,c.buffer,h,p))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(R(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(i);return o.bindTechnique(l,this._material.parameters,i,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,i);const{buffer:h,renderCommands:p,occludeeCommands:f}=c;l.ensureAttributeLocations(h.vao),o.bindVAO(h.vao);const m=l.primitiveType;_(p)&&this._renderCommands(o,m,p),_(f)&&(l.bindPipelineState(o,i.slot,!0),this._renderCommands(o,m,f),l.bindPipelineState(o,i.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,i,r){for(let s=0;s<r.length;s++)t.drawArrays(i,r[s].first,r[s].count)}_removeAndRebuild(t,i,r,s,n){for(const h of i)t.instances.delete(h.id);const o=cae(t.instances);t.instances.clear();const a=t.buffer.size,l=t.buffer.alloc(s);let c=0;for(const h of o){const p=h.from*r,f=h.to*r;l.copy(c,p,f),h.from=c/r,c+=f-p,h.to=c/r,t.instances.set(h.id,h)}n.push(new sS(0,l.hasNewBuffer?t.buffer.array.length:a)),l.dispose(),t.buffer.erase(c,n.back().to),t.holes.clear()}_remove(t,i,r,s){for(const n of i){const o=n.id,a=t.instances.get(o),l=a.from*r,c=a.to*r;t.buffer.erase(l,c),t.holes.push(new sS(a.from,a.to)),t.instances.delete(o),s.push(new sS(l,c))}pae(t.holes)}_add(t,i,r,s,n){if(i.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const p of i){const f=_(p.transformation)?Hr(SB,s,p.transformation):s;_s(iA,f);const m=Dl(iA,iA),y=o.elementCount(p.data),v=y*r;let w=bnt(t.holes,y);R(w)&&(w=t.buffer.size/r,t.buffer.grow(v),a=o.vertexBufferLayout.createView(t.buffer.array.buffer)),o.write({transformation:f,invTranspTransformation:m},p.data,a,w);const b=p.instanceParameters.visible,S=!!p.instanceParameters.highlights&&b,T=!!p.instanceParameters.occludees,E=new cnt(p.id,w,w+y,b,S,T);pt(t.instances.get(p.id)==null),t.instances.set(p.id,E),l?n.push(new sS(E.from*r,E.to*r)):(c=Math.min(E.from,c),h=Math.max(E.to,h))}l||n.push(new sS(c*r,h*r))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class vnt{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function _nt(e,t){const i=new Map;for(const r of e)hae(i,r,!0);for(const r of t)hae(i,r,!1);return i}function hae(e,t,i){const r=t.origin;if(R(r))return;let s=e.get(r.id);s==null&&(s=new vnt(r.vec3),e.set(r.id,s)),i?s.toAdd.push(t):s.toRemove.push(t)}function dae(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function bnt(e,t){let i;if(!e.some(s=>!(s.to-s.from<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function pae(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class wnt{constructor(t,i){this.origin=t,this.buffer=i,this.instances=new Map,this.holes=new Wt({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class xnt extends uq{constructor(t,i,r,s){super(t),this.buffer=i,this.renderCommands=r,this.occludeeCommands=s}}const Tnt=new Wt({deallocator:null}),Snt=Ae(),SB=Ae(),iA=Ae();let Tf=class extends Se{constructor(e){super(e),this._pending=new Ent,this._changes=new oSe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new Wt,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return sn(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=aSe(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new _Se(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,i=!0,r=!0),!o)return;const a=i||o.hasHighlights,l=r||o.hasWater;o.modify(s),i=i||a!==o.hasHighlights,r=r||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=sn(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=sn(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const r=this._pending.empty;for(const s of i)this._pending.adds.add(s);r&&this.notifyChange("updating"),t===ti.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const s of e)r.has(s)?(this._pending.removed.add(s),r.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===ti.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(r),s.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case ti.State.TRANSFORMATION:case ti.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case ti.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,s){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let o=0;_(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),C$[0]=i[0]-r,C$[1]=i[1]-o,C$[2]=1,A$[0]=i[0]-r,A$[1]=i[1]-o,A$[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,C$,A$,(a,l,c)=>{Cnt(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(R(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}}_notifyGraphicVisibilityChanged(e){if(R(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const r=i.graphicUid;_(r)&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return R(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([d()],Tf.prototype,"drapeSource",void 0),u([d()],Tf.prototype,"updating",null),u([d()],Tf.prototype,"rctx",null),u([d()],Tf.prototype,"rendererContext",void 0),u([d()],Tf.prototype,"_materialRepository",null),u([d()],Tf.prototype,"_localOriginFactory",null),Tf=u([P("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Tf);class Ent{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function Cnt(e,t,i,r,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(Vr.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==vo.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===vo.ALL){const c=mQ(s.ray);l(c),s.results.all.push(c)}}const C$=O(),A$=O();function GU(e){e.fragment.uniforms.add(new ni("projInfo",(t,i)=>Ant(i))),e.fragment.uniforms.add(new vi("zScale",(t,i)=>bSe(i))),e.fragment.code.add(x`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Ant(e){const t=e.camera.projectionMatrix;return t[11]===0?Ji(fae,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):Ji(fae,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const fae=Xt();function bSe(e){return e.camera.projectionMatrix[11]===0?yi(mae,0,1):yi(mae,1,0)}const mae=it();var p_;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(p_||(p_={}));class wSe extends Wa{constructor(){super(...arguments),this.output=p_.SSAO}}u([H({count:p_.COUNT})],wSe.prototype,"output",void 0);const rA={samples:16,filterRadius:4};function Rnt(e){const t=new Zi,i=t.fragment;if(t.include(b_),e.output===p_.Blur){const r=(rA.filterRadius+1)/2,s=1/(2*r*r);i.include(Uu),i.uniforms.add([new zr("normalMap"),new zr("depthMap"),new zr("tex"),new zg("blurSize"),new Ni("projScale"),new vi("nearFar",(n,o)=>o.camera.nearFar)]),i.code.add(x`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${x.float(s)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(x`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${x.int(rA.filterRadius)}; r <= ${x.int(rA.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===p_.SSAO&&(i.include(Uu),t.include(GU),i.uniforms.add(new zr("normalMap")),i.uniforms.add(new zr("depthMap")),i.uniforms.add(new zr("rnm")),i.uniforms.add(new Ni("intensity")),i.uniforms.add(new Ni("projScale")),i.uniforms.add(new Ni("radius")),i.uniforms.add(new vi("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new zg("screenSize")),i.uniforms.add(new zg("rnmScale")),i.code.add(x`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(x`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new vi("zScale",(r,s)=>bSe(s))),i.code.add(x`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${x.int(rA.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${x.int(rA.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const Mnt=Object.freeze(Object.defineProperty({__proto__:null,build:Rnt},Symbol.toStringTag,{value:"Module"}));class e3 extends pr{initializeProgram(t){const i=e3.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({colorWrite:ri})}}e3.shader=new rr(Mnt,()=>import("./SSAO.glsl.3181c104.js"));class xSe{constructor(t,i,r){this._techniqueRep=t,this._rctx=i,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new wSe,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=Ze(this.quadVAO)}disposeOffscreenBuffers(){rn(this._ssaoFBO,t=>t.resize(0,0)),rn(this._blur0FBO,t=>t.resize(0,0)),rn(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&_(this._noiseTexture)&&_(this._ssaoFBO)&&_(this._blur0FBO)&&_(this._blur1FBO)}get colorTexture(){return _(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return _(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return _(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,i,r){if(!this.enabled||R(i)||R(r)||R(this._noiseTexture)||R(this._ssaoFBO)||R(this._blur0FBO)||R(this._blur1FBO))return;const s=this._rctx,n=t.camera,o=n.fullViewport,a=o[2],l=o[3],c=a/this._blurSizePx,h=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const p=1,f=1,m=a*p,y=l*f;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const v=s.bindTechnique(this._ssaoTechnique,gae,t);v.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let w=1/n.computeRenderPixelSizeAtDist(1);v.setUniform1f("projScale",w*p),v.setUniform2f("screenSize",m,y);const b=ur(n.eye,n.center);let S=20*n.computeRenderPixelSizeAtDist(b);S=Math.max(.1,S),v.setUniform1f("radius",S),v.setUniform1f("intensity",4*this._attenuation/S**6),v.bindTexture("rnm",this._noiseTexture),v.bindTexture("normalMap",r),v.bindTexture("depthMap",i),R(this.quadVAO)&&(this.quadVAO=Xa(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays($t.TRIANGLE_STRIP,0,ko(this.quadVAO,"geometry"));const T=s.bindTechnique(this._blurTechnique,gae,t);T.bindTexture("tex",this._ssaoFBO.colorTexture),T.bindTexture("normalMap",r),T.bindTexture("depthMap",i),s.setViewport(0,0,m/this._blurSizePx,y/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),T.setUniform2f("screenSize",m,y),T.setUniform2f("blurSize",0,this._blurSizePx*p/y),b>5e4&&(w=Math.max(0,w-(b-5e4))),T.setUniform1f("projScale",w),s.drawArrays($t.TRIANGLE_STRIP,0,ko(this.quadVAO,"geometry")),T.setUniform2f("blurSize",this._blurSizePx*f/m,0),s.bindFramebuffer(this._blur1FBO),T.bindTexture("tex",this._blur0FBO.colorTexture),s.drawArrays($t.TRIANGLE_STRIP,0,ko(this.quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=p_.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(e3,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=p_.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(e3,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():import("./SSAOHelperData.08f44d75.js").then(i=>{this._data=i,t()})}_initialize(){const t={target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE};Ap(this._data.noiseTexture).then(r=>{this._enabled&&(this._ssaoFBO=new Rr(this._rctx,i,t),this._blur0FBO=new Rr(this._rctx,i,t),this._blur1FBO=new Rr(this._rctx,i,t),this._noiseTexture=new nt(this._rctx,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=Ze(this._noiseTexture),this._blur1FBO=Ze(this._blur1FBO),this._blur0FBO=Ze(this._blur0FBO),this._ssaoFBO=Ze(this._ssaoFBO)}get gpuMemoryUsage(){return(_(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(_(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(_(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const gae=new Ws;function Ont(){const e=new Zi;return e.include(b_),e.fragment.uniforms.add([new zr("tex"),new Va("uColor")]),e.fragment.code.add(x`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const Pnt=Object.freeze(Object.defineProperty({__proto__:null,build:Ont},Symbol.toStringTag,{value:"Module"}));class mP extends pr{initializeProgram(t){const i=mP.shader.get().build();return new sr(t.rctx,i,Ui)}initializePipeline(){return this.configuration.hasAlpha?Bt({blending:bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:ri}):Bt({colorWrite:ri})}}mP.shader=new rr(Pnt,()=>import("./TextureOnly.glsl.ab7cca8e.js"));class aJ extends Wa{constructor(){super(...arguments),this.hasAlpha=!1}}u([H()],aJ.prototype,"hasAlpha",void 0);class TSe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=Ze(t.texture)),this.cache.clear()}_acquire(t){if(R(t))return null;const i=this._patternId(t),r=this.cache.get(i);if(r)return r.refCount++,r.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:o,pixels:a,paddedPixels:l}=Int(t.pattern,s),c=a/s,h={refCount:1,texture:null,bind:p=>(R(h.texture)&&(h.texture=new nt(this._rctx,{width:l,height:1,internalFormat:Ve.RGBA,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE},n)),p.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:o,pixels:a})};return this.cache.set(i,h),h.bind}release(t){if(R(t))return;const i=this._patternId(t),r=this.cache.get(i);r&&(r.refCount--,r.refCount===0&&(_(r.texture)&&r.texture.dispose(),this.cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function Int(e,t){const i=e.map(y=>Math.round(y*t)),r=1/t,s=Math.floor(i.reduce((y,v)=>y+v)),n=i.reduce((y,v)=>Math.max(y,v)),o=(Math.floor(.5*(n-1))+.5)*r,a=[];let l=1;for(const y of i){for(let v=0;v<y;v++){const w=l*(Math.min(v,y-1-v)+.5)*r/o*.5+.5;a.push(w)}l=-l}const c=Math.round(i[0]/2),h=[...a.slice(c),...a.slice(0,c)],p=s+2,f=new Uint8Array(4*p);let m=4;for(const y of h)ZO(y,f,m),m+=4;return f.copyWithin(0,m-4,m),f.copyWithin(m,4,8),{encodedData:f,sdfNormalizer:o,paddedPixels:p,pixels:s}}var fc,No;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(fc||(fc={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(No||(No={}));class mN extends Wa{constructor(){super(...arguments),this.function=fc.Standard,this.alphaMode=No.None,this.hasOpacityFactor=!1}}u([H({count:fc.COUNT})],mN.prototype,"function",void 0),u([H({count:No.COUNT})],mN.prototype,"alphaMode",void 0),u([H()],mN.prototype,"hasOpacityFactor",void 0);let Nd=class extends $U(Se){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Nt,this._frameTask=aE,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new Wt,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new as,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new TSe(e.renderingContext),this._shaderTechniqueRepository=new qTe({rctx:this._rctx,viewingMode:Ge.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new nSe(this._rctx,new oJ(this._rctx,this.view.state.viewingMode),new xSe(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([ie(()=>t.updating,()=>this.events.emit("content-changed"),Us),ie(()=>this.spatialReference,i=>this._localOriginFactory=new nJ(i),Us),ns(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new WTe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&Z4)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ee.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=Lbe(this._rctx),this._bindParameters.camera=zb,this._bindParameters.transparencyPassType=gt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new nQ(Ue(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(yt.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=Ki(this._debugTextureTechnique),this._debugPatternTexture=Ze(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=Ze(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Ze(this._shaderTechniqueRepository),this._temporaryFBO=Ze(this._temporaryFBO),this._quadVAO=Ze(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||sn(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return _(this._overlays)&&_(this._overlayRenderTarget)}get gpuMemoryUsage(){return _(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Tf)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);_(r)&&r.destroy();const s=new t(ye(F({},i),{rendererContext:this,drapeSource:e}));return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(ie(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(R(e))return;const t=this._drapeSourceRenderers.get(e);R(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(_(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return vt(this._overlays,[])}ensureDrapeTargets(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=GL(e,i=>i.drapeTargetType===aq.WithoutRasterImage)})}ensureDrapeSources(e){_(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=GL(e,i=>i.drapeSourceType===MM.Features),t.hasDrapedRasterSource=GL(e,i=>i.drapeSourceType===MM.RasterImage)})}ensureOverlays(e,t){R(this._overlays)&&(this._overlayRenderTarget=new mst(this._rctx),this._overlays=[new Foe(kr.INNER,this._overlayRenderTarget),new Foe(kr.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=Ze(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(_(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(nC,e=>e.updatePolicy===hE.SYNC)}isEmpty(){if(Wi.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===je.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===je.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;zb.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===je.MATERIAL_NORMAL?Ee.DRAPED_WATER:Ee.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===kr.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(er.COLOR_BUFFER_BIT));const c=t.type===Ts.ColorNoRasterImage?tv.ExcludeRasterImage:t.type===Ts.Occluded?tv.OccludedOnly:tv.Normal;if(c===tv.OccludedOnly&&(this._renderContext.renderOccludedMask=Z4),Wi.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==tv.OccludedOnly)for(let h=0;h<r.numViews;h++)this._setViewParameters(r.extents[h],e,zb),this._drawDebugTexture(e.resolution,Lnt[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:h,renderer:p})=>{if(c===tv.ExcludeRasterImage&&h.drapeSourceType===MM.RasterImage)return;const{fullOpacity:f}=h,m=_(f)&&f<1&&s===je.MATERIAL;m&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(er.COLOR_BUFFER_BIT));for(let y=0;y<r.numViews;y++)this._setViewParameters(r.extents[y],e,zb),p.render(this._renderContext,this._bindParameters);m&&_(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),No.PremultipliedAlpha,f,fc.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){R(this._temporaryFBO)&&(this._temporaryFBO=new HTe(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){var n,o;let s=0;for(const a of this._drapeSourceRenderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,i,r,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new $nt(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,HX(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),ak(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=sn(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=sn(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=sn(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays($t.TRIANGLE_STRIP,0,ko(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let o=0;o<e;o++){const a=Math.floor(o/10),l=Math.floor(n/10);a<2||l<2||10*a>e-20||10*l>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&a&&1&l?1&o^1&n?0:255:1&a^1&l?0:128)}this._debugPatternTexture=new nt(this._rctx,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,width:e,height:t},i);const s=new aJ;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(mP,s),this._quadVAO=Xa(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var tv;u([d()],Nd.prototype,"_frameTask",void 0),u([d()],Nd.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([Io()],Nd.prototype,"_shaderTechniqueRepository",void 0),u([Io()],Nd.prototype,"_stippleTextureRepository",void 0),u([d({constructOnly:!0})],Nd.prototype,"view",void 0),u([d()],Nd.prototype,"worldToPCSRatio",void 0),u([d()],Nd.prototype,"spatialReference",void 0),u([d({type:Boolean,readOnly:!0})],Nd.prototype,"updating",null),Nd=u([P("esri.views.3d.terrain.OverlayRenderer")],Nd),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(tv||(tv={}));class $nt{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const Lnt=[[1,.5,.5],[.5,.5,1]],zb=new tr;zb.near=1,zb.far=1e4,zb.relativeElevation=null;const lJ=-2,Z4=Dr.OccludeAndTransparent;function yae(e){const t=[[M.POSITION,e.indices]],i=[[M.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return _(e.attributeData.color)&&(i.push([M.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([M.COLOR,new Uint32Array(e.indices.length)])),_(e.attributeData.uvMapSpace)&&(i.push([M.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([M.UVMAPSPACE,e.indices])),_(e.attributeData.boundingRect)&&(i.push([M.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([M.BOUNDINGRECT,e.indices])),_(e.attributeData.mapPosition)&&(i.push([M.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([M.MAPPOS,e.indices])),new Fr(i,t)}function vae(e){const t=[[M.POSITION,e.indices],[M.UV0,e.indices]],i=[[M.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[M.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return _(e.attributeData.mapPosition)&&(i.push([M.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([M.MAPPOS,e.indices])),new Fr(i,t)}function t3(e){switch(e.type){case"extent":if(e instanceof ai)return Go.fromExtent(e);break;case"polygon":return e}return null}function cJ(e,t,i,r){const s=hP(e.rings,e.hasZ,om.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=MTe(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=o!=null;return{position:s.position,mapPosition:n,polygons:CSe(s.polygons,s.position,n),outlines:ESe(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function SSe(e,t){const i=hP(e.rings,!1,om.CCW_IS_HOLE),r=dr(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=lJ;return{position:i.position,polygons:CSe(i.polygons,i.position),outlines:ESe(i.outlines,i.position),projectionSuccess:r}}function ESe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({index:s,count:n,position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function CSe(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,h=o.map(p=>p-s);r.push({index:s,count:n,holeIndices:h,pathLengths:a,position:t.subarray(l,c),mapPosition:i?i.subarray(l,c):void 0})}return r}function ASe(e,t){const i=e.fragment;switch(i.code.add(x`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case jr.None:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case jr.View:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case jr.WindingOrder:i.code.add(x`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case jr.COUNT:}}var jr;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(jr||(jr={}));function RSe(e){e.vertex.code.add(x`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function MSe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(M.MODELORIGINHI,"vec3"),e.attributes.add(M.MODELORIGINLO,"vec3"),e.attributes.add(M.MODEL,"mat3"),e.attributes.add(M.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(X4,t),i.uniforms.add(new Ga("viewOriginHi",(r,s)=>DQe(se(R$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),R$))),i.uniforms.add(new Ga("viewOriginLo",(r,s)=>NQe(se(R$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),R$)))),i.code.add(x`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(x`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?x`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(x`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===K.Normal&&(i.uniforms.add(new Tr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),i.code.add(x`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(x`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const R$=O();var Es;function OSe(e){switch(e){case"multiply":default:return Es.Multiply;case"ignore":return Es.Ignore;case"replace":return Es.Replace;case"tint":return Es.Tint}}function PSe(e,t,i){if(R(e)||t===Es.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=De(Math.round(e[3]*Y4),0,Y4),s=r===0||t===Es.Tint?0:t===Es.Replace?Dnt:Nnt;i[0]=De(Math.round(e[0]*Bx),0,Bx),i[1]=De(Math.round(e[1]*Bx),0,Bx),i[2]=De(Math.round(e[2]*Bx),0,Bx),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(Es||(Es={}));const Bx=255,Y4=85,Dnt=Y4,Nnt=2*Y4;function ISe(e){e.vertex.code.add(x`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${x.int(Es.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${x.int(Es.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${x.int(Es.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${x.int(Es.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function $Se(e,t){t.hasSymbolColors?(e.include(ISe),e.attributes.add(M.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(x`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new fP("colorMixMode",i=>Gxe[i.colorMixMode])),e.vertex.code.add(x`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function fx(e,t){t.hasVertexColors?(e.attributes.add(M.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(x`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(x`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(x`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Fnt(e){e.fragment.code.add(x`
    #define discardOrAdjustAlpha(color) { if (color.a < ${x.float(Vo)}) { discard; } }
  `)}class LSe extends Kr{constructor(t,i){super(t,"float",ki.Draw,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function aw(e,t){DSe(e,t,new We("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function knt(e,t){DSe(e,t,new LSe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function DSe(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==cr.Mask&&t.alphaDiscardMode!==cr.MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case cr.Blend:return e.include(Fnt);case cr.Opaque:r.code.add(x`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case cr.Mask:r.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case cr.MaskBlend:e.fragment.code.add(x`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function NSe(e,t){const i=e.vertex.code,r=e.fragment.code,s=t.hasModelTransformation;t.output!==K.Depth&&t.output!==K.Shadow||(Iu(e,t),e.include(Uo,{linearDepth:!0,hasModelTransformation:s}),e.include(Ug,t),e.include(d2,t),e.include(x_,t),e.include(vs,t),e.vertex.uniforms.add(new vi("nearFar",(n,o)=>o.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new jt("tex",n=>n.texture)),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(aw,t),r.add(x`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===K.Normal&&(Iu(e,t),e.include(Uo,{linearDepth:!1,hasModelTransformation:s}),e.include(NU,t),e.include(kU,t),e.include(Ug,t),e.include(d2,t),t.hasColorTexture&&e.fragment.uniforms.add(new jt("tex",n=>n.texture)),e.varyings.add("vPositionView","vec3"),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===Mr.Attribute?x`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(vs,t),e.include(aw,t),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===Mr.ScreenDerivative?x`
            vec3 normal = screenDerivativeNormal(vPositionView);`:x`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===K.Highlight&&(Iu(e,t),e.include(Uo,{linearDepth:!1,hasModelTransformation:s}),e.include(Ug,t),e.include(d2,t),t.hasColorTexture&&e.fragment.uniforms.add(new jt("tex",n=>n.texture)),i.add(x`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(vs,t),e.include(aw,t),e.include(wy),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?x`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function FSe(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(M.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===jr.WindingOrder?i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(x`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==an.None){e.include(qY,t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===ki.Pass?nN("normalTexture",s=>s.textureNormal,r):xM("normalTexture",s=>s.textureNormal,r)),i.code.add(x`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function gP(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new jt("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture),new ni("viewportPixelSz",(r,s)=>Ji(Unt,s.camera.fullViewport[0],s.camera.fullViewport[1],1/s.ssaoHelper.width,1/s.ssaoHelper.height))]),i.code.add(x`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(x`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const Unt=Xt();function Gw(e,t){const i=e.fragment;e.include(gP,t),t.pbrMode!==Ot.Disabled&&e.include(zU,t),e.include(QY,t),i.constants.add("ambientBoostFactor","float",aC),e.include(iU),i.code.add(x`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Ot.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new Tt("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection)),i.code.add(x`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?x`normalize(vPosWorld)`:x`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new We("lightingGlobalFactor",(r,s)=>s.lighting.globalFactor),new Tt("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(x`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===Ot.Disabled||t.pbrMode===Ot.WaterOnIntegratedMesh?(e.include(JY,t),i.code.add(x`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==Ot.Normal&&t.pbrMode!==Ot.Schematic||(i.code.add(x`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(x`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new Ow("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(x`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new We("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new We("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(x`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(x`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Ot.Schematic?x`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:x`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function kSe(e,t){const i=x`
  /*
  *  ${t.name}
  *  ${t.output===K.Color?"RenderOutput: Color":t.output===K.Depth?"RenderOutput: Depth":t.output===K.Shadow?"RenderOutput: Shadow":t.output===K.Normal?"RenderOutput: Normal":t.output===K.Highlight?"RenderOutput: Highlight":""}
  */
  `;EO()&&(e.fragment.code.add(i),e.vertex.code.add(i))}function i3(e){e.include(vm),e.code.add(x`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${x.int(Es.Multiply)}) {
        return allMixed;
      }
      if (mode == ${x.int(Es.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Es.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${x.int(Es.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${x.int(Es.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function znt(e){const t=new Zi,i=t.vertex.code,r=t.fragment.code;t.include(kSe,{name:"Default Material Shader",output:e.output});const s=Iu(t,e);return t.include(FU),t.varyings.add("vpos","vec3"),t.include(d2,e),t.include(MSe,e),t.include(Dxe,e),e.output!==K.Color&&e.output!==K.Alpha||(nm(t.vertex,e),t.include(NU,e),t.include(Uo,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===Mr.Attribute&&e.offsetBackfaces&&t.include(RSe),t.include(FSe,e),t.include(kU,e),e.instancedColor&&t.attributes.add(M.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(Ug,e),t.include(pP,e),t.include($Se,e),t.include(fx,e),t.vertex.uniforms.add(new ni("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new Tr("model",n=>_(n.modelTransformation)?n.modelTransformation:hn)),i.add(x`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${x.float(Vo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===Mr.Attribute?x`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===Mr.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===K.Alpha&&(t.include(vs,e),t.include(aw,e),t.include(zu,e),t.fragment.uniforms.add([new We("opacity",n=>n.opacity),new We("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new jt("tex",n=>n.texture)),t.fragment.include(i3),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(vs,e),t.include(Gw,e),t.include(gP,e),t.include(aw,e),t.include(e.instancedDoublePrecision?UU:Bw,e),t.include(zu,e),nm(t.fragment,e),t.fragment.uniforms.add([s,new Tt("ambient",n=>n.ambient),new Tt("diffuse",n=>n.diffuse),new We("opacity",n=>n.opacity),new We("layerOpacity",n=>n.layerOpacity),new We("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Tt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",aC),e.hasColorTexture&&t.fragment.uniforms.add(new jt("tex",n=>n.texture)),t.include(YY,e),t.include(zU,e),t.fragment.include(i3),t.include(ASe,e),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===Mr.ScreenDerivative?x`
                vec3 normal = screenDerivativeNormal(localvpos);`:x`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?x`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:x`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?x`normalize(vpos + localOrigin);`:x`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?x`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?x`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===gt.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(NSe,e),t}const Vnt=Object.freeze(Object.defineProperty({__proto__:null,build:znt},Symbol.toStringTag,{value:"Module"}));class Bnt extends uSe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ue(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=hr.Back,this.emissiveFactor=Ue(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.externalColor=bi(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=O(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Or(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Aw.Less,this.textureAlphaMode=cr.Blend,this.textureAlphaCutoff=V4,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Dr.Occlude}}class Gnt extends hSe{constructor(){super(...arguments),this.origin=O(),this.slicePlaneLocalOrigin=this.origin}}class yP extends pr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=dP(t.rctx),i.textureCoordinateType=i.hasColorTexture||i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?an.Default:an.None}initializeProgram(t){return this._initializeProgram(t,yP.shader)}_initializeProgram(t,i){const r=i.get().build(this.configuration);return new sr(t.rctx,r,Ui)}_convertDepthTestFunction(t){return t===Aw.Lequal?gr.LEQUAL:gr.LESS}_setPipeline(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Bt({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.transparent?null:s?$u:xy(t),culling:jnt(r)&&tU(r.cullFace),depthTest:{func:w_(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:s||n?r.writeDepth&&Nl:null,colorWrite:ri,stencilWrite:r.hasOccludees?am:null,stencilTest:r.hasOccludees?i?d_:T_:null,polygonOffset:s||n?null:AU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function jnt(e){return e.cullFace!==hr.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}yP.shader=new rr(Vnt,()=>import("./DefaultMaterial.glsl.752444f6.js"));class Kt extends la{constructor(){super(...arguments),this.output=K.Color,this.alphaDiscardMode=cr.Opaque,this.doubleSidedMode=jr.None,this.pbrMode=Ot.Disabled,this.cullFace=hr.None,this.transparencyPassType=gt.NONE,this.normalType=Mr.Attribute,this.textureCoordinateType=an.None,this.customDepthTest=Aw.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}u([H({count:K.COUNT})],Kt.prototype,"output",void 0),u([H({count:cr.COUNT})],Kt.prototype,"alphaDiscardMode",void 0),u([H({count:jr.COUNT})],Kt.prototype,"doubleSidedMode",void 0),u([H({count:Ot.COUNT})],Kt.prototype,"pbrMode",void 0),u([H({count:hr.COUNT})],Kt.prototype,"cullFace",void 0),u([H({count:gt.COUNT})],Kt.prototype,"transparencyPassType",void 0),u([H({count:Mr.COUNT})],Kt.prototype,"normalType",void 0),u([H({count:an.COUNT})],Kt.prototype,"textureCoordinateType",void 0),u([H({count:Aw.COUNT})],Kt.prototype,"customDepthTest",void 0),u([H()],Kt.prototype,"spherical",void 0),u([H()],Kt.prototype,"hasVertexColors",void 0),u([H()],Kt.prototype,"hasSymbolColors",void 0),u([H()],Kt.prototype,"hasVerticalOffset",void 0),u([H()],Kt.prototype,"hasSlicePlane",void 0),u([H()],Kt.prototype,"hasSliceHighlight",void 0),u([H()],Kt.prototype,"hasColorTexture",void 0),u([H()],Kt.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([H()],Kt.prototype,"hasEmissionTexture",void 0),u([H()],Kt.prototype,"hasOcclusionTexture",void 0),u([H()],Kt.prototype,"hasNormalTexture",void 0),u([H()],Kt.prototype,"hasScreenSizePerspective",void 0),u([H()],Kt.prototype,"hasVertexTangents",void 0),u([H()],Kt.prototype,"hasOccludees",void 0),u([H()],Kt.prototype,"hasMultipassTerrain",void 0),u([H()],Kt.prototype,"hasModelTransformation",void 0),u([H()],Kt.prototype,"offsetBackfaces",void 0),u([H()],Kt.prototype,"vvSize",void 0),u([H()],Kt.prototype,"vvColor",void 0),u([H()],Kt.prototype,"receiveShadows",void 0),u([H()],Kt.prototype,"receiveAmbientOcclusion",void 0),u([H()],Kt.prototype,"textureAlphaPremultiplied",void 0),u([H()],Kt.prototype,"instanced",void 0),u([H()],Kt.prototype,"instancedColor",void 0),u([H()],Kt.prototype,"instancedDoublePrecision",void 0),u([H()],Kt.prototype,"doublePrecisionRequiresObfuscation",void 0),u([H()],Kt.prototype,"writeDepth",void 0),u([H()],Kt.prototype,"transparent",void 0),u([H()],Kt.prototype,"enableOffset",void 0),u([H()],Kt.prototype,"cullAboveGround",void 0),u([H()],Kt.prototype,"snowCover",void 0),u([H({constValue:!0})],Kt.prototype,"hasVvInstancing",void 0),u([H({constValue:!1})],Kt.prototype,"useCustomDTRExponentForWater",void 0),u([H({constValue:!1})],Kt.prototype,"supportsTextureAtlas",void 0),u([H({constValue:!0})],Kt.prototype,"useFillLights",void 0);function Hnt(e){const t=new Zi,i=t.vertex.code,r=t.fragment.code,s=Iu(t,e);return t.include(FU),t.varyings.add("vpos","vec3"),t.include(d2,e),t.include(MSe,e),t.include(Dxe,e),e.output!==K.Color&&e.output!==K.Alpha||(nm(t.vertex,e),t.include(NU,e),t.include(Uo),e.offsetBackfaces&&t.include(RSe),e.instancedColor&&t.attributes.add(M.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(Ug,e),t.include(pP,e),t.include($Se,e),t.include(fx,e),t.vertex.uniforms.add(new ni("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),i.add(x`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${x.float(Vo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?x`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===K.Alpha&&(t.include(vs,e),t.include(aw,e),t.include(zu,e),t.fragment.uniforms.add([new We("opacity",n=>n.opacity),new We("layerOpacity",n=>n.layerOpacity),new e_("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new jt("tex",n=>n.texture)),t.fragment.include(i3),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?x`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===K.Color&&(t.include(vs,e),t.include(Gw,e),t.include(gP,e),t.include(aw,e),t.include(e.instancedDoublePrecision?UU:Bw,e),t.include(zu,e),nm(t.fragment,e),t.fragment.uniforms.add([s,new Tt("ambient",n=>n.ambient),new Tt("diffuse",n=>n.diffuse),new We("opacity",n=>n.opacity),new We("layerOpacity",n=>n.layerOpacity),new e_("view"),new We("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Tt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",aC),e.hasColorTexture&&t.fragment.uniforms.add(new jt("tex",n=>n.texture)),t.include(YY,e),t.include(zU,e),t.fragment.include(i3),t.extensions.add("GL_OES_standard_derivatives"),r.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?x`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:x`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Ot.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?x`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:x`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?x`albedo = mix(albedo, vec3(1), 0.9);`:x``}
        ${x`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?e.spherical?x`vec3 normalGround = normalize(vpos + localOrigin);`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:x``}
        ${e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?x`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?x`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:x`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===gt.Color?x`gl_FragColor = premultiplyAlpha(gl_FragColor);`:x``}
      }
    `)),t.include(NSe,e),t}const qnt=Object.freeze(Object.defineProperty({__proto__:null,build:Hnt},Symbol.toStringTag,{value:"Module"}));class jU extends yP{initializeConfiguration(t,i){super.initializeConfiguration(t,i),i.hasMetalnessAndRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Mr.Attribute,i.doubleSidedMode=jr.WindingOrder,i.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,jU.shader)}}jU.shader=new rr(qnt,()=>import("./RealisticTree.glsl.9237f92a.js"));class jw extends bm{constructor(t){super(t,Znt),this.supportsEdges=!0,this.techniqueConfig=new Kt,this.vertexBufferLayout=Qnt(this.parameters),this.instanceBufferLayout=t.instanced?USe(this.parameters):null}isVisibleInPass(t){return t!==je.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=t,o=_(i)&&i.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=_(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=_(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?Mr.ScreenDerivative:Mr.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,_(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?hr.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=_(this.parameters.modelTransformation),t!==K.Color&&t!==K.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=jr.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?jr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?jr.WindingOrder:jr.None,this.techniqueConfig.instancedColor=_(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Ot.Schematic:Ot.Normal:Ot.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<EU,this.techniqueConfig.snowCover=this.hasSnowCover(i)),this.techniqueConfig}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,i,r,s,n,o,a){if(_(this.parameters.verticalOffset)){const l=s.camera;se(CB,r[12],r[13],r[14]);let c=null;switch(s.viewingMode){case Ge.Global:c=we(_ae,CB);break;case Ge.Local:c=ae(_ae,eot)}let h=0;const p=pe(tot,CB,l.eye),f=Me(p),m=le(p,p,1/f);let y=null;this.parameters.screenSizePerspective&&(y=xe(c,m)),h+=Vxe(l,f,this.parameters.verticalOffset,y,this.parameters.screenSizePerspective),le(c,c,h),mc(EB,c,s.transform.inverseRotation),n=pe(Jnt,n,EB),o=pe(Knt,o,EB)}bU(t,i,s,n,o,BH(s.verticalOffset),a)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Shadow||t.output===K.Highlight?new Wnt(t):null}createBufferWriter(){return new Ynt(this.vertexBufferLayout,this.instanceBufferLayout)}}class Wnt extends ZY{constructor(t){super(F(F({},t),t.material.parameters))}_updateParameters(t){const i=this._material.parameters;this.updateTexture(i.textureId);const r=t.camera.viewInverseTransposeMatrix;return se(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?jU:yP,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class Xnt extends Bnt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const Znt=new Xnt;class Ynt{constructor(t,i){this.vertexBufferLayout=t,this.instanceBufferLayout=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(M.POSITION).length}write(t,i,r,s){xU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}function Qnt(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=ls().vec3f(M.POSITION).vec3f(M.NORMAL);return e.hasVertexTangents&&i.vec4f(M.TANGENT),t&&i.vec2f(M.UV0),e.hasVertexColors&&i.vec4u8(M.COLOR),e.hasSymbolColors&&i.vec4u8(M.SYMBOLCOLOR),i}function USe(e){let t=ls();return t=e.instancedDoublePrecision?t.vec3f(M.MODELORIGINHI).vec3f(M.MODELORIGINLO).mat3f(M.MODEL).mat3f(M.MODELNORMAL):t.mat4f(M.MODEL).mat4f(M.MODELNORMAL),_(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(M.INSTANCECOLOR)),_(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(M.INSTANCEFEATUREATTRIBUTE)),t}const Jnt=O(),Knt=O(),eot=Ue(0,0,1),_ae=O(),EB=O(),CB=O(),tot=O(),iot=["polygon","extent"];class rot extends xm{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=RU(this._getSymbolSize());if(a)throw new j("graphics3dextrudesymbollayer:invalid-size",a)}const t=xr(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=yl(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?hr.None:hr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new jw(o),this._bottomMaterial=new jw(ye(F({},o),{cullFace:hr.Back})),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,iot,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Bu);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=xr(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();return t.forEach(a=>{const l=i(a);_(l)&&l.layerOpacityChanged(o,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,u_)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var r;let i;return i=t.size&&this._drivenProperties.size?(r=nst(t.size,2))!=null?r:0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?ln.Recreate_Symbol:ln.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const o=t3(t.geometry);if(R(o))return null;const a=cJ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),o.rings.length===0||!o.rings.some(ce=>ce.length>0))return null;const l=WQ(o);if(R(l))return null;const c=new Array,h=new Array,p=new Array,f=Gs(),m=Ae(),y=O(),v=this._context.renderCoordsHelper.viewingMode===Ge.Global;v||this._context.renderCoordsHelper.worldUpAtPosition(null,y),Nu(o.spatialReference,[l.x,l.y,0],m,this._context.renderCoordsHelper.spatialReference);const w=Ae();_s(w,m);const b=Or();pE(b,w);const{polygons:S,mapPosition:T,position:E}=a,C=E.length/3,A=new Float64Array(3*C*6),I=new Float64Array(3*C*6),D=new Float64Array(3*C*6),L=new Float64Array(1*C*6);let z=0;for(let ce=0;ce<S.length;++ce){const oe=S[ce],$=oe.count;if(this._context.clippingExtent&&(mr(f),Cu(f,oe.mapPosition),!op(f,this._context.clippingExtent)))continue;const U=RE(oe.mapPosition,oe.holeIndices,3);if(U.length===0)continue;const G=3*$*2+U.length,W=new Uint32Array(G),X=new Uint32Array(U.length),ee=6*$,q=3*A.BYTES_PER_ELEMENT,te=new As(A.buffer,z*q,q,(z+ee)*q),ge=3*I.BYTES_PER_ELEMENT,Te=new As(I.buffer,z*ge,ge,(z+ee)*ge),ke=new Float64Array(D.buffer,3*z*D.BYTES_PER_ELEMENT,3*ee),_e=new Float64Array(L.buffer,1*z*L.BYTES_PER_ELEMENT,1*ee),me=this._getExtrusionSize(i);sot(E,T,U,oe,te.typedBuffer,ke,Te.typedBuffer,_e,0,W,X,me,y,v),uP(te,te,w),h_(Te,Te,b),z+=6*$;const Ce=bae(W,W.length-X.length,{positions:te.typedBuffer,elevation:ke,normals:Te.typedBuffer,heights:_e},r);c.push(Ce),h.push(this._material),p.push(hn);const Fe=bae(X,0,{positions:te.typedBuffer,elevation:ke,normals:Te.typedBuffer,heights:_e},r);c.push(Fe),h.push(this._bottomMaterial),p.push(hn)}if(c.length===0)return null;const B=new Sy({geometries:c,materials:h,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});B.transformation=m;const V=FTe(this.symbolLayer,{opacity:this._getLayerOpacity()}),Q=_(V)?{baseMaterial:this._material,edgeMaterials:[V],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,Z=new wm(this,B,c,null,null,aot,s,Q);return Z.alignedSampledElevation=a.sampledElevation,Z.needsElevationUpdates=u_(s.mode),Z}}function bae(e,t,i,r){const s=new Uint32Array(e.length),n=[[M.POSITION,{size:3,data:i.positions,exclusive:!0}],[M.NORMAL,{size:3,data:i.normals,exclusive:!0}],[M.COLOR,{size:4,data:r,exclusive:!0}],[M.SIZE,{size:1,data:i.heights,exclusive:!0}]],o=[[M.POSITION,e],[M.NORMAL,e],[M.COLOR,s]];return i.elevation&&(n.push([M.MAPPOS,{size:3,data:i.elevation}]),o.push([M.MAPPOS,e])),new Fr(n,o,Ol.Triangle,t)}function sot(e,t,i,r,s,n,o,a,l,c,h,p,f,m){const y=i.length/3;let v=0,w=2*r.count;not(e,t,r.index,r.count,i,0,y,s,n,o,a,l,c,h,w,p,f,m),l+=2*r.count,w=0,wae(s,n,a,o,v,r.pathLengths[0],r.count,l,c,w,p),l+=4*r.pathLengths[0],w+=2*r.pathLengths[0],v+=r.pathLengths[0];for(let b=1;b<r.pathLengths.length;++b)wae(s,n,a,o,v,r.pathLengths[b],r.count,l,c,w,p),l+=4*r.pathLengths[b],w+=2*r.pathLengths[b],v+=r.pathLengths[b]}function not(e,t,i,r,s,n,o,a,l,c,h,p,f,m,y,v,w,b){ae(rl,w);const S=v>0?1:-1;let T=3*i,E=p,C=3*E,A=p+r,I=3*A;for(let z=0;z<r;++z)b&&(rl[0]=e[T+0],rl[1]=e[T+1],rl[2]=e[T+2],we(rl,rl)),a[C+0]=e[T+0],a[C+1]=e[T+1],a[C+2]=e[T+2],l[C+0]=t[T+0],l[C+1]=t[T+1],l[C+2]=t[T+2],c[C+0]=-S*rl[0],c[C+1]=-S*rl[1],c[C+2]=-S*rl[2],h[E]=0,a[I+0]=e[T+0]+v*rl[0],a[I+1]=e[T+1]+v*rl[1],a[I+2]=e[T+2]+v*rl[2],l[I+0]=t[T+0],l[I+1]=t[T+1],l[I+2]=t[T+2],c[I+0]=S*rl[0],c[I+1]=S*rl[1],c[I+2]=S*rl[2],h[A]=v,C+=3,I+=3,T+=3,E+=1,A+=1;T=3*n,C=0,I=3*y;const D=v<0?Aae:Cae,L=v<0?Cae:Aae;for(let z=0;z<o;++z)m[C+0]=s[T+D[0]],m[C+1]=s[T+D[1]],m[C+2]=s[T+D[2]],f[I+0]=s[T+L[0]]+r,f[I+1]=s[T+L[1]]+r,f[I+2]=s[T+L[2]]+r,C+=3,I+=3,T+=3}function M$(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const sA=O();function wae(e,t,i,r,s,n,o,a,l,c,h){let p=s,f=s+1,m=s+o,y=s+o+1,v=a,w=a+1,b=a+2*n,S=a+2*n+1;h<0&&(p=s+o+1,y=s),c*=3;for(let T=0;T<n;++T)T===n-1&&(h>0?(f=s,y=s+o):(f=s,p=s+o)),oot(e,p,f,m,sA),M$(e,t,r,i,sA,v,p),M$(e,t,r,i,sA,w,f),M$(e,t,r,i,sA,b,m),M$(e,t,r,i,sA,S,y),l[c++]=v,l[c++]=b,l[c++]=S,l[c++]=v,l[c++]=S,l[c++]=w,p++,f++,m++,y++,v+=2,w+=2,b+=2,S+=2}const AB=O(),xae=O(),Tae=O(),Sae=O(),Eae=O();function oot(e,t,i,r,s){t*=3,i*=3,r*=3,se(AB,e[t++],e[t++],e[t++]),se(xae,e[i++],e[i++],e[i++]),se(Tae,e[r++],e[r++],e[r++]),pe(Sae,xae,AB),pe(Eae,Tae,AB),ct(s,Eae,Sae),we(s,s)}const Gx=O();function aot(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,h=_s(Ae(),c);for(let p=0;p<o;p+=2){const f=n[p].geometry,m=f.getMutableAttribute(M.POSITION).data,y=f.vertexAttributes.get(M.SIZE).data,v=f.vertexAttributes.get(M.MAPPOS).data,w=new oxe(v),b=m.length/3;let S=0,T=!1,E=0;const C=i.spatialReference;for(let A=0;A<b;A++){Gx[0]=m[S],Gx[1]=m[S+1],Gx[2]=m[S+2],cy(w,i,t,r,O$),a&&(E+=O$.sampledElevation),Wi.TESTS_DISABLE_OPTIMIZATIONS?(se(Bl,w.array[w.offset+0],w.array[w.offset+1],O$.z+y[S/3]),r.toRenderCoords(Bl,C,Bl),ze(Bl,Bl,h)):(se(Bl,m[S+0],m[S+1],m[S+2]),ze(Bl,Bl,c),r.setAltitude(Bl,O$.z+y[S/3]),ze(Bl,Bl,h)),m[S]=Bl[0],m[S+1]=Bl[1],m[S+2]=Bl[2];const I=lot/r.unitInMeters;(Math.abs(Gx[0]-m[S])>=I||Math.abs(Gx[1]-m[S+1])>=I||Math.abs(Gx[2]-m[S+2])>=I)&&(T=!0),w.offset+=3,S+=3}T&&(f.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=E/b}return l/o}const Bl=O(),rl=O(),O$=new cP,Cae=[0,2,1],Aae=[0,1,2],lot=.01;function cot(e,t,i,r,s){const n=e.referencesGeometry()&&s?uot(t,r,s):t,o=e.repurposeFeature(n);try{return e.evaluate(ye(F({},i),{$feature:o}))}catch(a){return fe.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const RB=new Map;function uot(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;RB.has(t)||RB.set(t,hot(t));const o=RB.get(t)(e.geometry,r,s,n);return ye(F({},e),{geometry:o})}function hot(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>yTe(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>vTe(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>_Te(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>gTe(r,t,i,s,n);default:return fe.getLogger("esri.views.2d.support.arcadeOnDemand").error(new j("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const jEt=1.2,dot=Vf,pot=Nh;class HU{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,ti.Geometry.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ti.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,ti.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=O()){return se(t,0,0,0)}getBoundingBoxObjectSpace(t=Gs()){return mr(t)}addObjectState(t,i){t===ny.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ti.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,ti.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.computeAttachmentOrigin(jx)&&(t.draped.origin[0]+=jx[0],t.draped.origin[1]+=jx[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){mr(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Rae,r),IPe(n,Rae)}if(i){let o;np(n,jx);const a=XQ(n,i);try{o=await i.service.queryElevation(jx[0],jx[1],s,a,"ground")}catch{}_(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)V5(Bp,this.boundingBox);else{const n=t.boundingSphere,o=n[3];Bp[0]=n[0]-o,Bp[1]=n[1]-o,Bp[2]=n[2]-o,Bp[3]=n[0]+o,Bp[4]=n[1]+o,Bp[5]=n[2]+o}return i(Bp,0,2),this.calculateRelativeScreenBounds&&s.push({location:np(Bp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),nX(Bp,r)}}const Rae=kt(),Bp=Gs(),jx=O();class zSe{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),i=this.lineHeight;return Math.ceil(t+i+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*fot}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(R(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case Gv.Left:return this.backgroundHorizontalPadding;case Gv.Center:return(this.displayWidth-this._lineWidths[t])/2;case Gv.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;i+=o,r+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,i+p,r),this._renderLineDecoration(t,i+p,r,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(t,i+p,r,this._textWidths[c]),r+=this.lineSpacing}if(Wi.TEXT_SHOW_BASELINE){t.strokeStyle=Mae,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this.baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this.lineSpacing}}if(Wi.TEXT_SHOW_BORDER&&(t.strokeStyle=Mae,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this.baselinePosition}const l=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=De(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+o-s),t.arcTo(i+n,r+o,i+n-s,r+o,s),t.lineTo(i+s,r+o),t.arcTo(i,r+o,i,r+o-s,s),t.closePath()):t.rect(i,r,n,o)}_renderHalo(t,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=gN(MB,Math.max(o,Hx),Math.max(a,Hx)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this.baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,s+m,p,this._textWidths[f],!0),p+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of VSe)this._fillText(t,n,i+o+this.haloSize*a,r+this.haloSize*l);r+=this.lineSpacing}}_renderHaloNative(t,i,r){const s=2*this.haloSize;r+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,i+a,r)}r+=this.lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(_(this._displayWidth))return this._displayWidth;const t=gN(MB,Hx,Hx).getContext("2d");this._setFontProperties(t,this.fontSize);let i=2*this.haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+i;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(R(this._heightMetrics)){const t=gN(MB,Hx,Hx).getContext("2d");this._setFontProperties(t,this.fontSize);const i=t.measureText(this.text+mot),r=this.hasBackground?t.measureText(this._lines[0]):i,s=this._lines.length===1?r:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):i,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this._heightMetrics={paddingTop:i.actualBoundingBoxAscent-r.actualBoundingBoxAscent,paddingBottom:i.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:i.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const VSe=[];for(let t=0;t<360;t+=360/16)VSe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var Gv;function gN(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(Gv||(Gv={}));const MB={canvas:null},fot=.2,Hx=512,Mae="rgb(255, 0, 255, 0.5)",mot=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),got={left:0,center:.5,right:1},yN={"bottom-left":Di(0,0),bottom:Di(.5,0),"bottom-right":Di(1,0),left:Di(0,.5),center:Di(.5,.5),right:Di(1,.5),"top-left":Di(0,1),top:Di(.5,1),"top-right":Di(1,1)};function BSe(e){switch(e){case"left":return Gv.Left;case"right":return Gv.Right;default:return Gv.Center}}function Oae(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function yot(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function vot(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function _ot(e){return e==="middle"?"center":e}var oa,Pae,Q4;function nA(e){return e!=null}function qx(e){return typeof e=="number"}function qU(e){return typeof e=="string"}function bot(e){return e==null||qU(e)}function on(e,t){e&&e.push(t)}function wot(e,t,i,r=Ae()){const s=e||0,n=t||0,o=i||0;return s!==0&&X2(r,r,-s/180*Math.PI),n!==0&&W2(r,r,n/180*Math.PI),o!==0&&ok(r,r,o/180*Math.PI),r}function Gy(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return on(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=r.symbolSize[i];return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=oa.DefinedSize,!0}if(nA(e.field))return nA(e.stops)?e.stops.length===2&&qx(e.stops[0].size)&&qx(e.stops[1].size)?(Iae(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=oa.DefinedSize,!0):(on(s,"Could not convert size info: stops only supported with 2 elements"),!1):qx(n)&&qx(o)&&nA(e.minDataValue)&&nA(e.maxDataValue)?(Iae(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=oa.DefinedSize,!0):j2[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/j2[e.valueUnit],t.type[i]=oa.DefinedSize,!0):e.valueUnit==="unknown"?(on(s,"Could not convert size info: proportional size not supported"),!1):(on(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!nA(e.field)){if(e.stops&&e.stops[0]&&qx(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=oa.DefinedSize,!0;if(qx(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=oa.DefinedSize,!0}return on(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Iae(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function xot(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return on(r,"Could not convert size info: unsupported property"),null;if(!bot(e.field))return on(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return on(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[oa.Undefined,oa.Undefined,oa.Undefined]};let s;switch(e.axis){case"width":return s=Gy(e,t.size,0,i,r),s?t:null;case"height":return s=Gy(e,t.size,2,i,r),s?t:null;case"depth":return s=Gy(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=Gy(e,t.size,0,i,r),s&&Gy(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=Gy(e,t.size,0,i,r),s=s&&Gy(e,t.size,1,i,r),s=s&&Gy(e,t.size,2,i,r),s?t:null;default:return on(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function Tot(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===oa.DefinedSize&&(n*=t.modelSize[s],e.type[s]=oa.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==oa.Undefined)r=0;else if(e.type[1]!==oa.Undefined)r=1;else{if(e.type[2]===oa.Undefined)return on(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===oa.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function $ae(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function Sot(e,t,i){if(e.normalizationField)return on(i,"Could not convert color info: unsupported property"),null;if(qU(e.field)){if(!e.stops)return on(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return on(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,$ae(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return on(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,$ae(t.color.colors,s,r)}}return t}function Eot(e,t,i){if(e.normalizationField)return on(i,"Could not convert opacity info: unsupported property"),null;if(qU(e.field)){if(!e.stops)return on(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return on(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return on(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function OB(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function Cot(e,t,i){if(!qU(e.field))return on(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return on(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return OB(e,t.rotation,0),t;case"roll":return OB(e,t.rotation,1),t;case null:case void 0:case"heading":return OB(e,t.rotation,2),t;default:return on(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function GSe(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return on(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?xot(c,l,t,i):l;case"color":return s?Sot(c,l,i):l;case"opacity":return o?Eot(c,l,i):null;case"rotation":return n?Cot(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!Tot(a.size,t,i)?null:a:null}function uJ(e){return e&&e.size!=null}function r3(e,t){if(!e)return{enabled:!1};if(Wi.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=GSe(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:jSe(i,t),requiresShaderTransformation:uJ(i)}:{enabled:!1}}function s3(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=GSe(t.visualVariables,i);return!!s&&!!(P$(r.size,s.size,"size")&&P$(r.color,s.color,"color")&&P$(r.rotation,s.rotation,"rotation")&&P$(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=jSe(s,i),e.requiresShaderTransformation=uJ(s),!0)}function P$(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function jSe(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=uJ(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=Or(),tm(PM),wot(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],PM),Qh(i.vvSymbolRotationMatrix,PM)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(oa||(oa={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Pae||(Pae={})),function(e){const t=Ae(),i=O();function r(n,o,a){if(!n.vvSizeEnabled)return a;Ss(t,a);const l=n.vvSymbolRotationMatrix;pm(PM,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),Hr(t,t,PM);for(let c=0;c<3;++c){const h=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];i[c]=De(h,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return nk(t,t,i),qa(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return se(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=De(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=r,e.evaluateModelTransformScale=s}(Q4||(Q4={}));const PM=Ae(),dq=Q4.evaluateModelTransform,Aot=Q4.evaluateModelTransformScale;class Rot{constructor(){this.visible=!0}}class IE{constructor(t,i,r={}){this.data=t,this.material=i,this.boundingSphere=Xt(),this.instanceParameters=new Rot,this._transformation=Ae(),this._shaderTransformationDirty=!0,this.layerUid=vt(r.layerUid,null),this.graphicUid=vt(r.graphicUid,null),this.id=r.id?r.id:Cl(),this.boundingInfo=vt(r.boundingInfo,null),this.calculateShaderTransformation=vt(r.calculateShaderTransformation,null),this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=xw(t)){R(this.boundingInfo)||(ze(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return _(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return R(this.calculateShaderTransformation)?vt(this.transformation,hn):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Ae()),Ss(this._shaderTransformation,this.calculateShaderTransformation(vt(this.transformation,hn))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(_(this._transformation)&&ze(t,t,this._transformation),!0);const i=this.indices.get(M.POSITION),r=this.vertexAttributes.get(M.POSITION);return!!fwe(r,i,t)&&(_(this._transformation)&&ze(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new j4(ny.Highlight),i=this.instanceParameters;return i.highlights=jH(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=HH(i.highlights,t)}}const Mot=Ae(),Lae=Ue(0,0,1),Oot=16,Pot=1.5,Vb=GQ,Iot=[Vb/2,Vb/2,1-Vb/2,1-Vb/2],$ot=[YO*Vb,YO*Vb];class n3 extends xm{constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(_(r))this._prepareResourcesPrimitive(i,r);else{const s=$0e(this.symbol,this.symbolLayer),n=q5(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=RU(this._getIconSize());if(t)throw new j("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?gi(t.size):Oot);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:Uv.PAD};r=new Ns(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(Lot(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:gi(r),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(PB(i)&&r===0)throw new Error("Nothing to render");this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(i,()=>Yxe(i));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=Iot,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/Vb,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){if(!he("esri-canvas-svg-support")&&mX(i))throw new j("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio,o=await ku(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw bc(o.error),new j("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new BE({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await import("./CIMSymbolRasterizer.b952477c.js")).CIMSymbolRasterizer;fi(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,f=await JOe(p,this._context.layer.spatialReference,n);a=(m,y,v)=>{const w=cot(f,m,{$view:v},"esriGeometryPoint",y);return w!==null?w:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];fi(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||nfe}_getOutlineSize(){let t=0;const i=this.symbolLayer;return _(i.outline)&&i.outline.size!=null?Math.max(gi(i.outline.size),0):(t=PB(this._getPrimitive())?Pot:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=xr(i,"outline","color");if(_(r)){const s=Pe.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(PB(this._getPrimitive()))return dot;const t=R(this._getPrimitive()),i=xr(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?Di((i.x||0)+.5,.5-(i.y||0)):t in yN?yN[t]:yN.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=r3(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=_(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new CE(t),this._cimSymbolMaterials.set(vt(t.textureId,0),r),i.add(r)),r}return this._material=new CE(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=Ki(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=gi(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),f=F({textureId:p.id},this._cimMaterialParametersInfo);s=this._createMaterialAndAddToStage(f,this._context.stage),r=[p.params.width,p.params.height]}else r=this._size,s=this._material;const n=KO(i.geometry);if(R(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[r[0]*l,r[1]*l],h=this.setGraphicElevationContext(i,new Bu);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,s,a,c,t.layer.uid):this._createAs3DShape(i,n,s,a,c,h,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=lP(n3.elevationModeChangeTypes,r,s);if(n!==Qr.UPDATE)return n;const o=td(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!s3(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return ln.Recreate_Symbol;_(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return ln.Fast_Update}_defaultElevationInfoNoZ(){return Dot}_createAs3DShape(t,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?m=>dq(this._fastUpdates.materialParameters,l,m):null,h=[nc.createPointGeometry(Lae,null,s,n,Not,null,l)],p=tJ(this._context,i,h,[r],o,this._context.layer.uid,a,c);if(p===null)return null;const f=new wm(this,p.object,h,null,null,QO,o);return f.alignedSampledElevation=p.sampledElevation,f.needsElevationUpdates=td(o.mode)||o.mode==="absolute-height",f.getScreenSize=this._createScreenSizeGetter(n,c),f.calculateRelativeScreenBounds=m=>r.calculateRelativeScreenBounds(f.getScreenSize(),1,m),JO(f,i,this._context.elevationProvider),f}_createAsOverlay(t,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=Xt();jn(i,a,this._context.overlaySR),a[2]=lJ;const l=this._context.clippingExtent;if(_(l)&&!sX(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?y=>dq(this._fastUpdates.materialParameters,c,y):null,p=nc.createPointGeometry(Lae,a,s,n,null,null,c),f=new IE(p,r,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:h});a[3]=0,sp(f.boundingSphere,a);const m=new HU(this,[f],null,this._context.drapeSourceRenderer);return m.getScreenSize=this._createScreenSizeGetter(n,h),m.calculateRelativeScreenBounds=y=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,y),m}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=it())=>{const a=i(Mot);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(o=it())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Ue(t,t,t),r=$l(1),s=t*r;return{modelSize:i,symbolSize:Ue(s,s,s),unitInMeters:r,transformation:{anchor:Ba,scale:Nf,rotation:Ba}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){_(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return ye(F({},super.test()),{material:this._material})}}function Lot(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function PB(e){return!R(e)&&(e==="cross"||e==="x")}n3.PRIMITIVE_SIZE=$ot,n3.elevationModeChangeTypes={definedChanged:Qr.UPDATE,staysOnTheGround:Qr.NONE,onTheGroundChanged:Qr.RECREATE};const Dot={mode:"relative-to-ground",offset:0},Not=bi(0,0,0,1);function pq(e){const t=[],i=[];Uot(e,i,t);const r=i[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return zot(e,i,t),Vot(e,i,t,n),Got(e,i,t,n),Bot(e,i,t,n),jot(e,i,t,n),Hot(e,i,t,n),qot(e,i,t,r),new Fr(i,t,Ol.Line)}function Fot(e,t,i,r){const s=e.type==="polygon"?om.CCW_IS_HOLE:om.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=hP(n,e.hasZ,s),l=new Float64Array(o.length),c=MTe(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),h=c!=null;return{lines:h?HSe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function HSe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function kot(e,t){const i=e.type==="polygon"?om.CCW_IS_HOLE:om.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=hP(r,!1,i),o=dr(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=lJ;return{lines:o?HSe(n,s):[],projectionSuccess:o}}function Uot(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=Wot(r)&&s===Hw.REMOVE,o=r.length/3-(n?1:0),a=new Uint32Array(2*(o-1)),l=n?gW(r,0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([M.POSITION,{size:3,data:l,exclusive:n}]),i.push([M.POSITION,a])}function zot(e,t,i){const r=e.attributeData.mapPosition;R(r)||(i.push([M.MAPPOS,i[0][1]]),t.push([M.MAPPOS,{size:3,data:r}]))}function Vot(e,t,i,r){if(_(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([M.COLOR,{size:4,data:vt(s,pot)}]),i.push([M.COLOR,r])}function Bot(e,t,i,r){const s=e.attributeData.colorFeature;R(s)||(t.push([M.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([M.COLOR,r]))}function Got(e,t,i,r){if(_(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([M.SIZE,{size:1,data:[vt(s,1)]}]),i.push([M.SIZE,r])}function jot(e,t,i,r){const s=e.attributeData.sizeFeature;R(s)||(t.push([M.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([M.SIZEFEATUREATTRIBUTE,r]))}function Hot(e,t,i,r){const s=e.attributeData.opacityFeature;R(s)||(t.push([M.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([M.OPACITYFEATUREATTRIBUTE,r]))}function qot(e,t,i,r){if(R(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==Ge.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),n=Ci(e.overlayInfo.spatialReference);for(let f=0;f<s.length;f+=3)ZX(r,f,s,f,n);const o=r.length/3,a=new Float32Array(o+1);let l=Xot,c=Zot,h=0,p=0;se(l,s[p++],s[p++],s[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),se(c,s[p++],s[p++],s[p++]),h+=gbe(l,c),a[f]=h,[l,c]=[c,l];t.push([M.DISTANCETOSTART,{size:1,data:a}]),i.push([M.DISTANCETOSTART,i[0][1]])}function Wot(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var Hw;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(Hw||(Hw={}));const Xot=O(),Zot=O();function fq(e){switch(e){case"butt":return jh.BUTT;case"square":return jh.SQUARE;case"round":return jh.ROUND;default:return null}}const J4=64,qSe=J4/2,WSe=qSe/5;function Yot(e,t){return _(t)?Qot(e,Jot(t.style)):null}function Qot(e,t){return e.fromData(t,()=>Yxe(t,J4,qSe,WSe))}function Jot(e){return e==="diamond"?"kite":e}function Kot(e){const t=new Zi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);t.include(JTe,e),e.output===K.Depth&&t.include(x_,e);const{vertex:r,fragment:s}=t;return s.include(Lc),Iu(t,e),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float"),r.code.add(x`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),r.uniforms.add([new vi("nearFar",(n,o)=>o.camera.nearFar),new ni("viewport",(n,o)=>o.camera.fullViewport)]),r.code.add(x`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(x`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(r.uniforms.add(new Tr("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix)),r.code.add(x`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),r.code.add(x`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),r.uniforms.add(new We("perScreenPixelRatio",(n,o)=>o.camera.perScreenPixelRatio)),r.code.add(x`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),r.uniforms.add(new We("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(x`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${x.float(J4/WSe)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||r.code.add(x`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),r.code.add(x`
        ${i?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(zu,e),t.include(vs,e),s.uniforms.add([new ni("intrinsicColor",n=>n.color),new jt("tex",n=>n.texture)]),s.include(vm),s.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${x.float(1/J4)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${x.float(Vo)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Color&&e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===K.Highlight?x`gl_FragColor = vec4(1.0);`:""}
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""}
  }
  `),t}const eat=Object.freeze(Object.defineProperty({__proto__:null,build:Kot},Symbol.toStringTag,{value:"Module"})),XSe=new Map([[M.POSITION,0],[M.UV0,2],[M.AUXPOS1,3],[M.SIZE,6],[M.SIZEFEATUREATTRIBUTE,6],[M.COLOR,5],[M.COLORFEATUREATTRIBUTE,5],[M.OPACITYFEATUREATTRIBUTE,7]]);class WU extends pr{initializeProgram(t){const i=WU.shader.get().build(this.configuration);return new sr(t.rctx,i,XSe)}_makePipelineState(t,i){const r=this.configuration,s=t===gt.NONE;return Bt({blending:r.output===K.Color||r.output===K.Alpha?s?$u:xy(t):null,depthTest:{func:w_(t)},depthWrite:s?r.writeDepth&&Nl:SU(t),colorWrite:ri,stencilWrite:r.hasOccludees?am:null,stencilTest:r.hasOccludees?i?d_:T_:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Bt({blending:$u,depthTest:W4,depthWrite:null,colorWrite:ri,stencilWrite:null,stencilTest:iSe}),this._occluderPipelineOpaque=Bt({blending:$u,depthTest:W4,depthWrite:null,colorWrite:ri,stencilWrite:eSe,stencilTest:tSe}),this._occluderPipelineMaskWrite=Bt({blending:null,depthTest:sJ,depthWrite:null,colorWrite:null,stencilWrite:am,stencilTest:d_})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Ee.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ee.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}WU.shader=new rr(eat,()=>import("./LineMarker.glsl.ce7073f8.js"));class Aa extends la{constructor(){super(...arguments),this.output=K.Color,this.transparencyPassType=gt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([H({count:K.COUNT})],Aa.prototype,"output",void 0),u([H({count:gt.COUNT})],Aa.prototype,"transparencyPassType",void 0),u([H()],Aa.prototype,"occluder",void 0),u([H()],Aa.prototype,"hasSlicePlane",void 0),u([H()],Aa.prototype,"writeDepth",void 0),u([H()],Aa.prototype,"draped",void 0),u([H()],Aa.prototype,"hasCap",void 0),u([H()],Aa.prototype,"vvSize",void 0),u([H()],Aa.prototype,"vvColor",void 0),u([H()],Aa.prototype,"vvOpacity",void 0),u([H()],Aa.prototype,"hasOccludees",void 0),u([H()],Aa.prototype,"hasMultipassTerrain",void 0),u([H()],Aa.prototype,"cullAboveGround",void 0),u([H({constValue:!0})],Aa.prototype,"hasVvInstancing",void 0),u([H({constValue:!0})],Aa.prototype,"hasSliceTranslatedView",void 0);class tat extends bm{constructor(t){super(t,new rat),this._vertexAttributeLocations=XSe,this.techniqueConfig=new Aa,this.layout=this.createLayout()}dispose(){}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Ee.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==jh.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===Dr.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=ls().vec3f(M.POSITION).vec2f(M.UV0).vec3f(M.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(M.SIZEFEATUREATTRIBUTE):t.f32(M.SIZE),this.parameters.vvColorEnabled?t.f32(M.COLORFEATUREATTRIBUTE):t.vec4f(M.COLOR),this.parameters.vvOpacityEnabled&&t.f32(M.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new sat(this.layout,this.parameters)}requiresSlot(t,i){if(t===Ee.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===Dr.OccludeAndTransparentStencil)return t===Ee.OPAQUE_MATERIAL||t===Ee.OCCLUDER_MATERIAL||t===Ee.TRANSPARENT_OCCLUDER_MATERIAL;const r=Vw(i);return r===K.Color||r===K.Alpha?t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ee.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth?new iat(t):null}}class iat extends ZY{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(WU,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class rat extends jQ{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=jh.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class sat{constructor(t,i){this.vertexBufferLayout=t,this.parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,i,r,s){const n=i.vertexAttributes.get(M.POSITION).data,o=n.length/3;let a=1,l=0;this.parameters.vvSizeEnabled?l=i.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(M.SIZE)&&(a=i.vertexAttributes.get(M.SIZE).data[0]);let c=[1,1,1,1],h=0;this.parameters.vvColorEnabled?h=i.vertexAttributes.get(M.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(M.COLOR)&&(c=i.vertexAttributes.get(M.COLOR).data);let p=0;this.parameters.vvOpacityEnabled&&(p=i.vertexAttributes.get(M.OPACITYFEATUREATTRIBUTE).data[0]);const f=t.transformation,m=new Float32Array(r.buffer);let y=s*(this.vertexBufferLayout.stride/4);const v=(T,E,C,A)=>{if(m[y++]=T[0],m[y++]=T[1],m[y++]=T[2],m[y++]=C[0],m[y++]=C[1],m[y++]=E[0],m[y++]=E[1],m[y++]=E[2],this.parameters.vvSizeEnabled?m[y++]=l:m[y++]=a,this.parameters.vvColorEnabled)m[y++]=h;else{const I=Math.min(4*A,c.length-4);m[y++]=c[I+0],m[y++]=c[I+1],m[y++]=c[I+2],m[y++]=c[I+3]}this.parameters.vvOpacityEnabled&&(m[y++]=p)};let w;(function(T){T[T.ASCENDING=1]="ASCENDING",T[T.DESCENDING=-1]="DESCENDING"})(w||(w={}));const b=(T,E)=>{const C=se(nat,n[3*T],n[3*T+1],n[3*T+2]),A=oat;let I=T+E;do se(A,n[3*I],n[3*I+1],n[3*I+2]),I+=E;while(gw(C,A)&&I>=0&&I<o);f&&(ze(C,C,f),ze(A,A,f)),v(C,A,[-1,-1],T),v(C,A,[1,-1],T),v(C,A,[1,1],T),v(C,A,[-1,-1],T),v(C,A,[1,1],T),v(C,A,[-1,1],T)},S=this.parameters.placement;S!=="begin"&&S!=="begin-end"||b(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||b(o-1,w.DESCENDING)}}const nat=O(),oat=O(),Jo={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},aat={dash:Jo.dash,"dash-dot":[...Jo.dash,...Jo.dot],dot:Jo.dot,"long-dash":Jo["long-dash"],"long-dash-dot":[...Jo["long-dash"],...Jo.dot],"long-dash-dot-dot":[...Jo["long-dash"],...Jo.dot,...Jo.dot],none:null,"short-dash":Jo["short-dash"],"short-dash-dot":[...Jo["short-dash"],...Jo["short-dot"]],"short-dash-dot-dot":[...Jo["short-dash"],...Jo["short-dot"],...Jo["short-dot"]],"short-dot":Jo["short-dot"],solid:null},lat=8;function cat(e,t=2){return R(e)?e:{pattern:e.slice(),pixelRatio:t}}function HEt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function ZSe(e){return _(e)&&e.type==="style"?uat(e.style):null}function uat(e){return _(e)?cat(aat[e],lat):null}const hat=["polyline","polygon","extent"];class XU extends xm{constructor(t,i,r,s){super(t,i,r,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=r3(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:$l(1);if(t<0)throw new j("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=Yot(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:fq(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:ZSe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?F(F({},s),this._fastUpdates.materialParameters):s}get _materialColor(){return rn(this.symbolLayer.material,t=>t.color)}get _markerColor(){return rn(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return R(this._lineMaterial)&&(this._lineMaterial=new BS(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return R(this._ringMaterial)&&(this._ringMaterial=new BS(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return R(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new BS(ye(F({},this._getMaterialParameters(!1)),{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return R(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new BS(ye(F({},this._getMaterialParameters(!0)),{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return R(this._markerMaterial)&&_(this.symbolLayer.marker)&&_(this._markerTexture)&&(this._markerMaterial=new tat(ye(F({},this._getMaterialParameters(!1,!0)),{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=Ki(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?gi(ost(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Bg(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=bi(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Bg(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Bg(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,hat,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Bu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!s3(this._fastUpdates,i,this._vvConvertOptions))return ln.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return ln.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const i=t.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=fq(vt(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(t,i);this._prepareMaterialPatch(t,i,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){return this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i)),!0}_forEachMaterial(t){_(this._lineMaterial)&&t(this._lineMaterial),_(this._ringMaterial)&&t(this._ringMaterial),_(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),_(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),_(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=xr(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=bi(r[0],r[1],r[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=lP(XU.elevationModeChangeTypes,r,s);if(n!==Qr.UPDATE)return n;const o=td(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof ai)return Go.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,h=Gs(),p=Fot(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),f=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,f,"LineSymbol3DLayer");for(let v=0;v<p.lines.length;v++){const{position:w,mapPosition:b}=p.lines[v];if(_(this._context.clippingExtent)&&(mr(h),Cu(h,b),!op(h,this._context.clippingExtent)))continue;const S=this._createGeometry(t,w,b,n.type,IM.ELEVATED);a.push(S),l.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(hn),Wi.LINE_WIREFRAMES&&(a.push(S.cloneShallow()),l.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(hn));const T=this.markerMaterial;_(T)&&(a.push(S.cloneShallow()),l.push(T),c.push(hn))}if(a.length===0)return null;const m=new Sy({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),y=new wm(this,m,a,null,null,brt,i);return y.alignedSampledElevation=p.sampledElevation,y.needsElevationUpdates=td(i.mode),y}_createGeometry(t,i,r,s,n){const o=s==="polygon"?Hw.REMOVE:Hw.KEEP,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return pq({overlayInfo:n===IM.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:o,uniformSize:this._uniformSize,attributeData:{position:i,mapPosition:r,size:l?null:this._getDrivenSize(t.renderingInfo),color:a?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=Wi.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;_(a)&&(a.renderPriority=this._renderPriority-.001),_(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=Gs(),p=mr(),f=kot(s,this._context.overlaySR),m=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,n,m,"LineSymbol3DLayer");for(const y of f.lines){if(mr(h),Cu(h,y.position),!op(h,this._context.clippingExtent))continue;U2(p,h);const v=this._createGeometry(t,y.position,null,s.type,IM.DRAPED),w=S=>{const T=new IE(v,S,{layerUid:i,graphicUid:r.uid});return c.push(T),T};if(_(l)){const S=w(l),T=this.symbolLayer.marker.placement;T!=="begin"&&T!=="begin-end"||Cu(h,y.position,0,1),T!=="end"&&T!=="begin-end"||Cu(h,y.position,y.position.length-3,1),this._updateBoundingSphere(S,h)}const b=w(o);if(this._updateBoundingSphere(b,h),Wi.LINE_WIREFRAMES){const S=w(a);this._updateBoundingSphere(S,h)}}return new HU(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,i){Ji(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return _(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=vt(t,$l(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?gi(1):1:gi(t)}_prepareMaterialPatch(t,i,r){const s=i.material;if(R(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(s.type==="collection")return;const n=s.type==="complete"?rn(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(hk(o),this._markerMaterial,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(R(r)||r.type!=="partial"||_(r.diff.style)||_(r.diff.placement)||_(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:R(this._markerColor)};const s=r.diff.color;if(R(s))return delete i.marker,{changed:!1,useMaterialColor:R(this._markerColor)};const n=s.newValue;return R(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,i,r){R(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:t}))}}var IM;XU.elevationModeChangeTypes={definedChanged:Qr.RECREATE,staysOnTheGround:Qr.NONE,onTheGroundChanged:Qr.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(IM||(IM={}));const Dae=2048,dat=1.5,pat=8;function fat(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=hJ(e,t.padding),a=Eat(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=Sat(e,a),h=Rat(i),p=$at[h];return{format:h,quality:De(r!=null?r:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function mat(e,t){const i=fat(e,t),r=i.area,s=i.width/r.width,n=hJ(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),f=e&&e.layers?e.layers:[],m=i.ignoreBackground,y=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:m,ignorePadding:y}}function gat(e,t,i){const{ctx:r,canvas:s}=YSe(e,i),n=r.getImageData(0,0,e.width,e.height),o=_at(s,t);return QSe(s),{dataUrl:o,data:n}}function yat(e,t){const{ctx:i,canvas:r}=YSe(e,t),s=i.getImageData(0,0,e.width,e.height);return QSe(r),s}function YSe(e,t){const i=vat();t.premultipliedAlpha&&Oat(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.putImageData(e,0,0),t.flipY&&Mat(r),{ctx:r,canvas:i}}function QSe(e){e.width=0,e.height=0}function vat(){return R(IB)&&(IB=document.createElement("canvas")),IB}let IB=null;function _at(e,t){const i=Pat[t.format],r=t.quality/100;return e.toDataURL(i,r)}function $B(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(K4)try{return new ImageData(e,t)}catch{K4=!1}return JSe(e,t,i)}function bat(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(K4)try{return new ImageData(e,t,i)}catch{K4=!1}const s=JSe(t,i,r);return s.data.set(e,0),s}function wat(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,f=n/c,m=o/h,y=Math.ceil(f/2),v=Math.ceil(m/2),w=e.width;for(let b=0;b<h;b++)for(let S=0;S<c;S++){const T=4*(S+(a?h-b-1:b)*c);let E=0,C=0,A=0,I=0,D=0,L=0;const z=(b+.5)*m;for(let B=Math.floor(b*m);B<(b+1)*m;B++){const V=Math.abs(z-(B+.5))/v,Q=(S+.5)*f,Z=V*V;for(let ce=Math.floor(S*f);ce<(S+1)*f;ce++){const oe=Math.abs(Q-(ce+.5))/y,$=Math.sqrt(Z+oe*oe);if($>=1)continue;let U=2*$*$*$-3*$*$+1;const G=4*(r+ce+(s+B)*w);L+=U*l[G+3],C+=U,!i&&l[G+3]<255&&(U=U*l[G+3]/255),A+=U*l[G],I+=U*l[G+1],D+=U*l[G+2],E+=U}}p[T]=A/E,p[T+1]=I/E,p[T+2]=D/E,p[T+3]=L/C}return t}function xat(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=hJ(e,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,f=Math.min(pat,Math.min((Dae-l)/h,(Dae-c)/p));return f<dat?e:ye(F({},e),{framebufferWidth:Math.round(h*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}})}function JSe(e,t,i){return i||(i=Tat()),i.getContext("2d").createImageData(e,t)}let oA=null,K4=!0;function Tat(){return oA||(oA=document.createElement("canvas"),oA.width=1,oA.height=1),oA}function Sat(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function Eat(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return Cat(Aat(i,e),t)}function Cat(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function Aat(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function hJ(e,t){return!t||e&&e.ignorePadding?Lat:t}function Rat(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return Iat}}function Mat(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function Oat(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const n=255/s;t[r+0]=t[r+0]*n,t[r+1]=t[r+1]*n,t[r+2]=t[r+2]*n}}}const Pat={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Nae=98,Iat="png",$at={png:100,jpg:Nae,jpeg:Nae},Lat={top:0,right:0,bottom:0,left:0};var nS;const LB=new WeakMap;let Dat=0,ff=nS=class extends ve{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:Kg(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:Kg(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(LB.has(this.data)||LB.set(this.data,++Dat),t(LB.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new nS(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return bat(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new nS({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new nS({data:e}):A2(nS,e)}};u([d({type:String,json:{write:Xv}})],ff.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],ff.prototype,"data",null),u([qe("data")],ff.prototype,"writeData",null),u([Ie("data")],ff.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],ff.prototype,"transparent",null),u([d({json:{write:!0}})],ff.prototype,"wrap",void 0),u([d({readOnly:!0})],ff.prototype,"contentHash",null),ff=nS=u([P("esri.geometry.support.MeshTexture")],ff);const $M=ff;var mq;let rg=mq=class extends ve{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new mq(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:_(this.color)?this.color.clone():null,colorTexture:_(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:_(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([d({type:Pe,json:{write:!0}})],rg.prototype,"color",void 0),u([d({type:$M,json:{write:!0}})],rg.prototype,"colorTexture",void 0),u([d({type:$M,json:{write:!0}})],rg.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],rg.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],rg.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],rg.prototype,"doubleSided",void 0),rg=mq=u([P("esri.geometry.support.MeshMaterial")],rg);const dJ=rg;var gq;let sg=gq=class extends dJ{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=_(e)?e.get(this):null;if(i)return i;const r=new gq(this.clonePropertiesWithDeduplication(t));return _(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return ye(F({},super.clonePropertiesWithDeduplication(e)),{emissiveColor:_(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:_(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:_(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:_(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null})}};u([d({type:Pe,json:{write:!0}})],sg.prototype,"emissiveColor",void 0),u([d({type:$M,json:{write:!0}})],sg.prototype,"emissiveTexture",void 0),u([d({type:$M,json:{write:!0}})],sg.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],sg.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],sg.prototype,"roughness",void 0),u([d({type:$M,json:{write:!0}})],sg.prototype,"metallicRoughnessTexture",void 0),sg=gq=u([P("esri.geometry.support.MeshMaterialMetallicRoughness")],sg);const KSe=sg;var vN;const Wx=fe.getLogger("esri.geometry.support.MeshVertexAttributes");let Yu=vN=class extends ve{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return oS(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},Wx)}castPosition(e){return e&&e instanceof Float32Array&&Wx.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),oS(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},Wx)}castUv(e){return oS(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},Wx)}castNormal(e){return oS(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},Wx)}castTangent(e){return oS(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},Wx)}clone(){const e={position:re(this.position),uv:re(this.uv),normal:re(this.normal),tangent:re(this.tangent),color:re(this.color)};return new vN(e)}clonePositional(){const e={position:re(this.position),normal:re(this.normal),tangent:re(this.tangent),uv:this.uv,color:this.color};return new vN(e)}};function DB(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function oS(e,t,i,r,s){if(!e)return e;if(e instanceof t)return DB(e,r,t,s);for(const n of i)if(e instanceof n)return DB(new t(e),r,t,s);if(Array.isArray(e))return DB(new t(e),r,t,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function aA(e,t,i){t[i]=Nat(e)}function Nat(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}u([d({json:{write:aA}})],Yu.prototype,"color",void 0),u([qt("color")],Yu.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:aA}})],Yu.prototype,"position",void 0),u([qt("position")],Yu.prototype,"castPosition",null),u([d({json:{write:aA}})],Yu.prototype,"uv",void 0),u([qt("uv")],Yu.prototype,"castUv",null),u([d({json:{write:aA}})],Yu.prototype,"normal",void 0),u([qt("normal")],Yu.prototype,"castNormal",null),u([d({json:{write:aA}})],Yu.prototype,"tangent",void 0),u([qt("tangent")],Yu.prototype,"castTangent",null),Yu=vN=u([P("esri.geometry.support.MeshVertexAttributes")],Yu);var NR;const Fat=fe.getLogger("esri.geometry.support.MeshComponent");let ng=NR=class extends ve{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return A2(NR,e)}castFaces(e){return oS(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Fat)}castMaterial(e){return A2(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?KSe:dJ,e)}clone(){return new NR({faces:re(this.faces),shading:this.shading,material:re(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:re(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new NR(i)}};u([d({json:{write:!0}})],ng.prototype,"faces",void 0),u([qt("faces")],ng.prototype,"castFaces",null),u([d({type:dJ,json:{write:!0}})],ng.prototype,"material",void 0),u([qt("material")],ng.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],ng.prototype,"shading",void 0),u([d({type:Boolean})],ng.prototype,"trustSourceNormals",void 0),ng=NR=u([P("esri.geometry.support.MeshComponent")],ng);const kat=ng,ZU=fe.getLogger("esri.geometry.support.meshUtils.normalProjection");function Uat(e,t,i,r,s){return QU(r)?(YU(Gg.TO_PCPF,Xi.fromTypedArray(e),As.fromTypedArray(t),As.fromTypedArray(i),r,Xi.fromTypedArray(s)),s):(ZU.error("Cannot convert spatial reference to PCPF"),s)}function qEt(e,t,i,r,s){return QU(r)?(YU(Gg.FROM_PCPF,Xi.fromTypedArray(e),As.fromTypedArray(t),As.fromTypedArray(i),r,Xi.fromTypedArray(s)),s):(ZU.error("Cannot convert to spatial reference from PCPF"),s)}function WEt(e,t,i){return dr(e,t,0,i,em(t),0,e.length/3),i}function XEt(e,t,i){return dr(e,em(i),0,t,i,0,e.length/3),t}function zat(e,t,i){if(R(e))return t;const r=As.fromTypedArray(e),s=As.fromTypedArray(t);return uP(s,r,i),t}function Vat(e,t,i){if(R(e))return t;pE(Ln,i);const r=Xi.fromTypedArray(e),s=Xi.fromTypedArray(t);return h_(s,r,Ln),rQ(Ln)||iJ(s,s),t}function Bat(e,t,i){if(R(e))return t;pE(Ln,i);const r=Xi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=Xi.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(h_(s,r,Ln),rQ(Ln)||iJ(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function Gat(e,t,i,r,s){if(!QU(r))return ZU.error("Cannot convert spatial reference to PCPF"),s;YU(Gg.TO_PCPF,Xi.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),As.fromTypedArray(t),As.fromTypedArray(i),r,Xi.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function ZEt(e,t,i,r,s){if(!QU(r))return ZU.error("Cannot convert to spatial reference from PCPF"),s;YU(Gg.FROM_PCPF,Xi.fromTypedArray(e,16),As.fromTypedArray(t),As.fromTypedArray(i),r,Xi.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function YU(e,t,i,r,s,n){if(!t)return;const o=i.count,a=em(s);if(e2e(s))for(let l=0;l<o;l++)r.getVec(l,I$),t.getVec(l,Gp),Nu(a,I$,$$,a),Qh(Ln,$$),e===Gg.FROM_PCPF&&Jh(Ln,Ln),mc(Gp,Gp,Ln),n.setVec(l,Gp);else for(let l=0;l<o;l++){r.getVec(l,I$),t.getVec(l,Gp),Nu(a,I$,$$,a),Qh(Ln,$$);const c=aF(i.get(l,1));let h=Math.cos(c);e===Gg.TO_PCPF&&(h=1/h),Ln[0]*=h,Ln[1]*=h,Ln[2]*=h,Ln[3]*=h,Ln[4]*=h,Ln[5]*=h,e===Gg.FROM_PCPF&&Jh(Ln,Ln),mc(Gp,Gp,Ln),we(Gp,Gp),n.setVec(l,Gp)}return n}function QU(e){return e2e(e)||jat(e)}function e2e(e){return e.isWGS84||Mde(e)||lm(e)||cm(e)}function jat(e){return e.isWebMercator}var Gg;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})(Gg||(Gg={}));const I$=O(),Gp=O(),$$=Ae(),Ln=Or();function Hat(e){const t=new Zi;t.include(Uo),t.include(fx,e),t.include(KTe,e),Iu(t,e);const{vertex:i,fragment:r}=t;return e.stippleEnabled&&(t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.AUXPOS1,"vec3"),i.uniforms.add(new ni("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(M.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(x`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(x`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new We("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(x`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(x`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(x`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(x`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(x`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(x`}`),e.output===K.Highlight&&t.include(wy),t.include(vs,e),r.uniforms.add(new We("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||r.uniforms.add(new ni("constantColor",s=>s.color)),r.code.add(x`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${x.float(Vo)}) {
      discard;
    }

    ${e.output===K.Color?x`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===K.Highlight?x`outputHighlight();`:""}
  }
  `),t}const qat=Object.freeze(Object.defineProperty({__proto__:null,build:Hat},Symbol.toStringTag,{value:"Module"}));class JU extends pr{constructor(t,i,r){super(t,i,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==K.Highlight}initializeProgram(t){const i=JU.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=_(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}initializePipeline(){const t=this.configuration,i=bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>Bt({blending:n,depthTest:sJ,depthWrite:o,colorWrite:ri,stencilWrite:t.hasOccludees?am:null,stencilTest:t.hasOccludees?s?d_:T_:null});return t.output===K.Color?(this._occludeePipelineState=r(!0,t.transparent||this.stippleEnabled?i:null,Nl),r(!1,t.transparent||this.stippleEnabled?i:null,Nl)):r(!1)}get primitiveType(){return $t.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}JU.shader=new rr(qat,()=>import("./NativeLine.glsl.886e2247.js"));class Jc extends la{constructor(){super(...arguments),this.output=K.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([H({count:K.COUNT})],Jc.prototype,"output",void 0),u([H()],Jc.prototype,"hasSlicePlane",void 0),u([H()],Jc.prototype,"hasVertexColors",void 0),u([H()],Jc.prototype,"transparent",void 0),u([H()],Jc.prototype,"draped",void 0),u([H()],Jc.prototype,"stippleEnabled",void 0),u([H()],Jc.prototype,"stippleOffColorEnabled",void 0),u([H()],Jc.prototype,"stipplePreferContinuous",void 0),u([H()],Jc.prototype,"hasOccludees",void 0),u([H({constValue:!1})],Jc.prototype,"stippleRequiresClamp",void 0),u([H({constValue:!1})],Jc.prototype,"stippleScaleWithLineWidth",void 0),u([H({constValue:!1})],Jc.prototype,"stippleRequiresStretchMeasure",void 0);const Wat=fe.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var e5;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(e5||(e5={}));class Fae extends bm{constructor(t){super(t,new Yat),this._techniqueConfig=new Jc}getConfiguration(t,i){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=i.slot===Ee.DRAPED_MATERIAL;const r=_(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&_(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){_(c)?htt(t,s,c,o,1,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||eP(i))return;if(!dwe(r))return void Wat.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(M.POSITION).data,a=s.camera,l=Jat;_o(l,s.point);const c=2;se(lA[0],l[0]-c,l[1]+c,0),se(lA[1],l[0]+c,l[1]+c,0),se(lA[2],l[0]+c,l[1]-c,0),se(lA[3],l[0]-c,l[1]-c,0);for(let y=0;y<4;y++)if(!a.unprojectFromRenderScreen(lA[y],Im[y]))return;na(a.eye,Im[0],Im[1],NB),na(a.eye,Im[1],Im[2],FB),na(a.eye,Im[2],Im[3],kB),na(a.eye,Im[3],Im[0],UB);let h=Number.MAX_VALUE,p=0;for(let y=0;y<o.length-5;y+=3){if(Ra[0]=o[y]+r[12],Ra[1]=o[y+1]+r[13],Ra[2]=o[y+2]+r[14],Ma[0]=o[y+3]+r[12],Ma[1]=o[y+4]+r[13],Ma[2]=o[y+5]+r[14],lr(NB,Ra)<0&&lr(NB,Ma)<0||lr(FB,Ra)<0&&lr(FB,Ma)<0||lr(kB,Ra)<0&&lr(kB,Ma)<0||lr(UB,Ra)<0&&lr(UB,Ma)<0)continue;if(a.projectToRenderScreen(Ra,Y_),a.projectToRenderScreen(Ma,Q_),Y_[2]<0&&Q_[2]>0){pe(jp,Ra,Ma);const w=a.frustum,b=-lr(w[ar.NEAR],Ra)/xe(jp,w[ar.NEAR]);le(jp,jp,b),de(Ra,Ra,jp),a.projectToRenderScreen(Ra,Y_)}else if(Y_[2]>0&&Q_[2]<0){pe(jp,Ma,Ra);const w=a.frustum,b=-lr(w[ar.NEAR],Ma)/xe(jp,w[ar.NEAR]);le(jp,jp,b),de(Ma,Ma,jp),a.projectToRenderScreen(Ma,Q_)}else if(Y_[2]<0&&Q_[2]<0)continue;Y_[2]=0,Q_[2]=0;const v=nZ(ew(Y_,Q_,zae),l);v<h&&(h=v,ae(kae,Ra),ae(Uae,Ma),p=y/3)}const f=s.rayBegin,m=s.rayEnd;if(h<c*c){let y=Number.MAX_VALUE;if(Dge(ew(kae,Uae,zae),ew(f,m,Qat),Z_)){pe(Z_,Z_,f);const v=Me(Z_);le(Z_,Z_,1/v),y=v/ur(f,m)}n(y,Z_,p,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(M.POSITION);return uQ(s,null,!1,i)}requiresSlot(t){return t===Ee.OPAQUE_MATERIAL||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Highlight?new Xat(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?gSe:ont;return R(this.parameters.stipplePattern)?new BU(t):new Zat(t.clone().vec3f(M.AUXPOS1).vec2f(M.UV0))}}class Xat extends __{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===K.Color&&this._updateOccludeeState(t),this.ensureTechnique(JU,t)}}class Zat{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(M.POSITION).length}write(t,i,r,s){xU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s),this._writeAuxpos1(t,i,r,s),this._writeUV0(t,i,r,s)}_writeAuxpos1(t,i,r,s){const n=r.getField(M.AUXPOS1,Xi),o=i.indices.get(M.POSITION),a=i.vertexAttributes.get(M.POSITION).data,l=t.transformation,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const m=3*o[p+f],y=a[m],v=a[m+1],w=a[m+2],b=l[0]*y+l[4]*v+l[8]*w+l[12],S=l[1]*y+l[5]*v+l[9]*w+l[13],T=l[2]*y+l[6]*v+l[10]*w+l[14];h[s]=b,h[s+1]=S,h[s+2]=T,s+=c}}_writeUV0(t,i,r,s){var E;const n=r.getField(M.UV0,Kh),o=i.indices.get(M.POSITION),a=i.vertexAttributes.get(M.POSITION).data,l=(E=i.vertexAttributes.get(M.DISTANCETOSTART))==null?void 0:E.data,c=t.transformation,h=n.typedBufferStride,p=n.typedBuffer;let f=0;p[s*=h]=e5.START,p[s+1]=f,s+=h;const m=3*o[0],y=se(Ra,a[m],a[m+1],a[m+2]);c&&ze(y,y,c);const v=Ma,w=o.length-1;let b=1;const S=l?(C,A,I)=>f=l[I]:(C,A,I)=>f+=ur(C,A);for(let C=1;C<w;C+=2){const A=3*o[C];se(v,a[A],a[A+1],a[A+2]),c&&ze(v,v,c),S(y,v,b++);for(let I=0;I<2;++I)p[s]=1-I,p[s+1]=f,s+=h;ae(y,v)}const T=3*o[w];se(v,a[T],a[T+1],a[T+2]),c&&ze(v,v,c),S(y,v,b),p[s]=e5.END,p[s+1]=f}}class Yat extends dC{constructor(){super(...arguments),this.color=Nh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const Ra=O(),Ma=O(),jp=O(),Z_=O(),Y_=Fo(),Q_=Fo(),kae=O(),Uae=O(),zae=fm(),Qat=fm(),Jat=O(),lA=[Fo(),Fo(),Fo(),Fo()],Im=[O(),O(),O(),O()],NB=Si(),FB=Si(),kB=Si(),UB=Si(),Kat=["mesh"];class elt extends xm{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Wi.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Fae({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Fae({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Kat,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new Bu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);_(n)&&n.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,u_)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);_(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return R(t)?"-":t instanceof Pe?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),f=this._colorOrTextureUid(o),m=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${f},ntmuid:${m},ds:${l},ac:${c},am:${h}`,i.material instanceof KSe){const{metallic:y,roughness:v,metallicRoughnessTexture:w,emissiveColor:b,emissiveTexture:S,occlusionTexture:T}=i.material,E=this._colorOrTextureUid(w),C=this._colorOrTextureUid(b),A=this._colorOrTextureUid(S),I=this._colorOrTextureUid(T);s.metallic=y,s.roughness=v,s.metallicRoughnessTexture=w,s.emissiveColor=b,s.emissiveTexture=S,s.occlusionTexture=T,s.uid=`${s.uid},mrm:${y},mrr:${v},mrt:${E},emuid:${C},etmuid:${A},otmuid:${I}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=Pe.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,cr.Opaque);return _(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new Ns(r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:i!==cr.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return wt.CLAMP_TO_EDGE;case"mirror":return wt.MIRRORED_REPEAT;default:return wt.REPEAT}}_setInternalMaterialParameters(t,i){if(_(t.color)&&this._setInternalColorValueParameters(t.color,i),_(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);_(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}_(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),_(t.emissiveColor)&&(i.emissiveFactor=Pe.toUnitRGB(t.emissiveColor)),_(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),_(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),_(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=_(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=Nh;else{const s=_(this.symbolLayer.material)?this.symbolLayer.material.color:null;_(s)?t.externalColor=Pe.toUnitRGBA(s):(r=null,t.externalColor=Nh)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(R(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var y,v,w;const r=(y=i.material)==null?void 0:y.color,s=(v=i.material)==null?void 0:v.colorTexture,n=(w=i.material)==null?void 0:w.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||_(r)&&r.a<1||_(s)&&s.transparent||o),l=this._materialProperties(t,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Ba,diffuse:Nf,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:hr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(f.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?hr.None:hr.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,h),this._setInternalMaterialParameters(l,f);const m=new jw(f);return h.material=m,this._materials.set(l.uid,h),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?cr.MaskBlend:cr.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?cr.Opaque:i.alphaMode==="mask"?cr.Mask:cr.Blend}_addDebugNormals(t,i,r,s){const n=i.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],h=[],p=[];for(let y=0;y<n;y++){const v=i[y],w=v.vertexAttributes.get(M.POSITION),b=v.vertexAttributes.get(M.NORMAL),S=v.indices.get(M.POSITION),T=v.indices.get(M.NORMAL),E=w.data,C=b.data;for(let A=0;A<S.length;A++){const I=3*S[A],D=3*T[A];for(let L=0;L<3;L++)l.push(E[I+L]);for(let L=0;L<3;L++)l.push(E[I+L]+C[D+L]*a);if(c.push(c.length),c.push(c.length),A%3==0){this._calculateFaceNormal(E,S,A,Yx),this._getFaceVertices(E,S,A,Eo,Xx,Zx),de(Eo,Eo,Xx),de(Eo,Eo,Zx),le(Eo,Eo,1/3);for(let L=0;L<3;L++)h.push(Eo[L]);for(let L=0;L<3;L++)h.push(Eo[L]+Yx[L]*a);p.push(p.length),p.push(p.length)}}}const f=new Fr([[M.POSITION,{data:l,size:3,exclusive:!0}]],[[M.POSITION,new Uint32Array(c)]],Ol.Line);i.push(f),r.push(this._debugVertexNormalMaterial),s.push(Kb(s[0]));const m=new Fr([[M.POSITION,{data:h,size:3,exclusive:!0}]],[[M.POSITION,new Uint32Array(p)]],Ol.Line);i.push(m),r.push(this._debugFaceNormalMaterial),s.push(Kb(s[0]))}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:h}=o;Wi.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new Sy({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=h;const f=this._createEdgeMaterial(),m=_(f)?{baseMaterial:l[0],edgeMaterials:[f],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,y=new wm(this,p,a,null,null,QO,r,m);return y.needsElevationUpdates=u_(r.mode),y.useObjectOriginAsAttachmentOrigin=!0,y.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),y.alignedSampledElevation=QO(y,y.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),y}_getCenterPointInElevationSR(t){const i=Ty(0,0,0,this._context.elevationProvider.spatialReference);return nge([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,i,r,s){if(R(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,Yx);for(let a=0;a<3;a++){const l=3*s[o+a];Eo[0]=i[l+0],Eo[1]=i[l+1],Eo[2]=i[l+2],xe(Yx,Eo)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return{normals:i,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,i){const r=new Float32Array(i.length),s=new Uint32Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(t,i,n,Yx);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return{normals:r,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(t,i,o,Yx);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:O(),count:0},r[c]=h),de(h.normal,h.normal,a),h.count++}}const s=new Float32Array(3*i.length),n=new Uint32Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(we(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,Eo,Xx,Zx),pe(Xx,Xx,Eo),pe(Zx,Zx,Eo),ct(Eo,Xx,Zx),we(s,Eo),s}_getOrCreateComponents(t){return vt(t.components,tlt)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===ru.ECEF?i.transformBeforeProject:null;if(_(s)&&(r=zat(r,new Float64Array(r.length),s)),i.reprojection===ru.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=_(s)?r:new Float64Array(r.length);return dr(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(R(s))return null;const n=r.reprojection===ru.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=Vat(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===ru.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return Uat(s,o,i,t.spatialReference,a)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(R(s))return null;const n=r.reprojection===ru.ECEF?r.transformBeforeProject:null;if(_(n)&&(s=Bat(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===ru.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=_(n)?s:new Float32Array(s.length);return Gat(s,o,i,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=OSe(xr(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return PSe(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(_(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(_(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(_(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(t,l,a),f=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===ru.NONE&&_(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,f),geometryTransformation:a.reprojection===ru.NONE&&_(a.geometryTransformation)?a.geometryTransformation:Ae()}}_computeReprojectionInfo(t){const i=_(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===Ge.Local?ru.NONE:ru.ECEF;if(i){if(r===ru.NONE){const n=Ae();return Nu(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:Kb(t.transform.localMatrix),needsBufferCopy:!1}}const s=ak(Ae(),t.transform.origin);return Hr(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;L$[0]=o.x,L$[1]=o.y,L$[2]=o.z;const a=Ae();Nu(t.spatialReference,L$,a,n);const l=As.fromTypedArray(i);if(_s(Vae,a),uP(l,l,Vae),_(r)||_(s)){if(Qh(cA,a),Jh(cA,cA),_(r)){const c=Xi.fromTypedArray(r);h_(c,c,cA)}if(_(s)){const c=Xi.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);h_(c,c,cA)}}return a}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:wE(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return t.spatialReference.equals(r)?s=i:(s=new Float64Array(i.length),dr(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)),mr(zB),Cu(zB,s,0,n),!op(zB,this._context.clippingExtent)}_createGeometryInfo(t,i){if(!im(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,i);if(R(r))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:h,geometryTransformation:p}=r,f=this._getOrCreateComponents(t),m=[],y=[],v=[];let w=!1;for(const b of f){if(!this._validateFaces(t,b))return null;const S=this._getOrCreateFaces(t,b);if(S.length===0)continue;const T=this._createComponentNormals(s,l,b,S);T.didFlipNormals&&(w=!0);const E=[[M.POSITION,{size:3,data:s,exclusive:!0}],[M.NORMAL,{size:3,data:T.normals,exclusive:!0}]],C=[[M.POSITION,S],[M.NORMAL,T.indices]];_(o)&&(E.push([M.COLOR,{size:4,data:o,exclusive:!0}]),C.push([M.COLOR,S])),_(a)&&(E.push([M.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),C.push([M.SYMBOLCOLOR,new Uint16Array(S.length)])),_(n)&&(E.push([M.UV0,{size:2,data:n,exclusive:!0}]),C.push([M.UV0,S])),_(c)&&(E.push([M.TANGENT,{size:4,data:c,exclusive:!0}]),C.push([M.TANGENT,S]));const A=new Fr(E,C);m.push(A),y.push(p),v.push(this._getOrCreateMaterial(t,b))}return w&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:m,transformations:y,materials:v,objectTransformation:h}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return FTe(this.symbolLayer,t)}}const L$=O(),Eo=O(),Xx=O(),Zx=O(),Yx=O(),Vae=Ae(),cA=Or(),zB=Gs(),tlt=[new kat];var ru;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(ru||(ru={}));class ilt{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this.lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){YQ(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,t,i);_(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=O()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Hp),ze(t,this.lodRenderer.baseBoundingSphere.center,Hp)}getBoundingBoxObjectSpace(t=Gs()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Hp);const i=this.lodRenderer.baseBoundingBox;mr(t);for(let r=0;r<8;++r)se(Qu,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),ze(Qu,Qu,Hp),Zf(t,Qu);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Hp),t.render.origin[0]+=Hp[12],t.render.origin[1]+=Hp[13],t.render.origin[2]+=Hp[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=rlt,l=B5(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Hp);for(let h=0;h<l;h++){const p=a[h];Qu[0]=o[p[0]],Qu[1]=o[p[1]],Qu[2]=o[p[2]],ze(Qu,Qu,Hp),J_[3*h+0]=Qu[0],J_[3*h+1]=Qu[1],J_[3*h+2]=Qu[2]}if(!t(J_,0,l))return null;mr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],J_[h+p]),o[p+3]=Math.max(o[p+3],J_[h+p]);c&&r.push({location:J_.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(np(o,VB),this.elevationContext.mode!=="absolute-height")){let h;const p=XQ(o,i);try{h=await i.service.queryElevation(VB[0],VB[1],s,p,"ground")}catch{}_(h)&&kpe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,i){if(t===ny.Highlight){const r=new j4(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const J_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Qu=O(),VB=O(),rlt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Hp=Ae();function slt(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function nlt(e){return{levels:e.map(t=>slt(t))}}function olt(e,t=llt){const i=Frt(e);return Math.sqrt(i/(t*Math.PI))}function alt(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=olt(t))})}const llt=.05;function clt(e){return e=e||globalThis.location.hostname,ult.some(t=>(e==null?void 0:e.match(t))!=null)}function yq(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(t2e)!=null||t.match(r2e)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(i2e)!=null||t.match(s2e)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const t2e=/^devext.arcgis.com$/,i2e=/^qaext.arcgis.com$/,r2e=/^[\w-]*\.mapsdevext.arcgis.com$/,s2e=/^[\w-]*\.mapsqa.arcgis.com$/,ult=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,t2e,i2e,/^jsapps.esri.com$/,r2e,s2e];function hlt(e,t,i){if(e.count!==t.count)return void PU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=i[9],y=i[10],v=i[11],w=i[12],b=i[13],S=i[14],T=i[15],E=e.typedBuffer,C=e.typedBufferStride,A=t.typedBuffer,I=t.typedBufferStride;for(let D=0;D<r;D++){const L=D*C,z=D*I,B=A[z],V=A[z+1],Q=A[z+2],Z=A[z+3];E[L]=s*B+l*V+f*Q+w*Z,E[L+1]=n*B+c*V+m*Q+b*Z,E[L+2]=o*B+h*V+y*Q+S*Z,E[L+3]=a*B+p*V+v*Q+T*Z}}function n2e(e,t,i){if(e.count!==t.count)return void PU.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],f=i[8],m=e.typedBuffer,y=e.typedBufferStride,v=t.typedBuffer,w=t.typedBufferStride;for(let b=0;b<r;b++){const S=b*y,T=b*w,E=v[T],C=v[T+1],A=v[T+2],I=v[T+3];m[S]=s*E+a*C+h*A,m[S+1]=n*E+l*C+p*A,m[S+2]=o*E+c*C+f*A,m[S+3]=I}}function dlt(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],f=n[c+2],m=h*h+p*p+f*f;if(m>0){const y=1/Math.sqrt(m);r[l]=y*h,r[l+1]=y*p,r[l+2]=y*f}}}function vq(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function plt(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:hlt,transformMat3:n2e,normalize:dlt,scale:vq,shiftRight:plt},Symbol.toStringTag,{value:"Module"}));function flt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:flt},Symbol.toStringTag,{value:"Module"}));function mlt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:mlt},Symbol.toStringTag,{value:"Module"}));function glt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function _N(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:glt,makeDense:_N},Symbol.toStringTag,{value:"Module"}));function o2e(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function a2e(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(aYe(t.elementType)){const h=lYe(t.elementType);if(oYe(t.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else o2e(e,t,i);return e}function ylt(e,t,i,r){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=r==null?void 0:r.count)!=null?l:e.count;let a=((c=r==null?void 0:r.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:o2e,normalizeIntegerBuffer:a2e,fill:ylt},Symbol.toStringTag,{value:"Module"}));function KU(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function vlt(e,t,i,r,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:KU,fill:vlt},Symbol.toStringTag,{value:"Module"}));function l2e(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function c2e(e,t,i,r,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let f=0;f<l;++f)o[c]=t,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:l2e,fill:c2e},Symbol.toStringTag,{value:"Module"}));function Eb(e,t){return new e(new ArrayBuffer(t*e.ElementCount*uwe(e.ElementType)))}class u2e{constructor(t){this.streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return hm(t)?(fi(i),Jpe(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(R(this.streamDataRequester))return(await Zt(i,{responseType:_lt[t]})).data;const s=await ku(this.streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw bc(s.error),new j("",`Request for resource failed: ${s.error}`)}}const _lt={image:"image",binary:"array-buffer",json:"json"},blt=fe.getLogger("esri.views.3d.glTF");class wlt{error(t){throw new j("gltf-loader-error",t)}errorUnsupported(t){throw new j("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,i){t&&this.errorUnsupported(i)}assert(t,i){t||this.error(i)}warn(t){blt.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,i){t&&this.warnUnsupported(i)}}function xlt(e={}){return F({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},e)}function Tlt(e,t={}){return{data:e,parameters:F({wrap:F({s:wt.REPEAT,t:wt.REPEAT},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}class qw{constructor(t,i,r=""){this.major=t,this.minor=i,this._context=r}lessThan(t,i){return this.major<t||t===this.major&&this.minor<i}since(t,i){return!this.lessThan(t,i)}validate(t){if(this.major!==t.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new j(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new qw(this.major,this.minor,this._context)}static parse(t,i=""){const[r,s]=t.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new j((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new j((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(r,10),a=parseInt(s,10);return new qw(o,a,i)}}class Bae{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const i=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,i,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var LM,Gae;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(LM||(LM={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Gae||(Gae={}));const h2e={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Slt={pbrMetallicRoughness:h2e,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Elt={ESRI_externalColorMixMode:"tint"},jae=(e={})=>{const t=F(F({},h2e),e.pbrMetallicRoughness),i=Clt(F(F({},Elt),e.extras));return ye(F(F({},Slt),e),{pbrMetallicRoughness:t,extras:i})};function Clt(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const Alt={magFilter:Ke.LINEAR,minFilter:Ke.LINEAR_MIPMAP_LINEAR,wrapS:wt.REPEAT,wrapT:wt.REPEAT},Rlt=e=>F(F({},Alt),e);function Mlt(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const D$={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class yg{constructor(t,i,r,s,n){this.context=t,this.errorContext=i,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=Mlt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),i.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),i.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,i,r,s){if(hm(r)){const a=q5(r);if(a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new yg(t,i,r,c)}catch{}const l=Jpe(r);if(yg._isGLBData(l))return this._fromGLBData(t,i,r,l)}if(r.endsWith(".gltf")){const a=await t.loadJSON(r,s);return new yg(t,i,r,a)}const n=await t.loadBinary(r,s);if(yg._isGLBData(n))return this._fromGLBData(t,i,r,n);const o=await t.loadJSON(r,s);return new yg(t,i,r,o)}static _isGLBData(t){const i=new Bae(t);return i.remainingBytes()>=4&&i.readUint32()===D$.MAGIC}static async _fromGLBData(t,i,r,s){const n=await yg._parseGLBData(i,s);return new yg(t,i,r,n.json,n.binaryData)}static async _parseGLBData(t,i){const r=new Bae(i);t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=r.readUint32(),n=r.readUint32(),o=r.readUint32();t.assert(s===D$.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(i.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;r.remainingBytes()>=8;){const h=r.readUint32(),p=r.readUint32();c===0?(t.assert(p===D$.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(h>=0,"No JSON data found."),a=await Dlt(r.readUint8Array(h))):c===1?(t.errorUnsupportedIf(p!==D$.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=r.readUint8Array(h)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,i){const r=this.json.buffers[t],s=this.errorContext;if(r.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,i);return s.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,i){const r=this.bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),i).then(o=>new Uint8Array(o));return this.bufferLoaders.set(t,n),n}async getAccessor(t,i){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];r.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(s.type in[LM.MAT2,LM.MAT3,LM.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i),a=Ilt[s.type],l=$lt[s.componentType],c=a*l,h=n.byteStride||c;return{raw:o.buffer,byteStride:h,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:h===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,i){if(t.indices==null)return null;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case dt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case dt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case dt.UNSIGNED_BYTE:return _N(this._wrapAccessor(ay,r));case dt.UNSIGNED_SHORT:return _N(this._wrapAccessor($w,r));case dt.UNSIGNED_INT:return _N(this._wrapAccessor(Dw,r))}}async getPositionData(t,i){const r=this.errorContext;r.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+F$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Xi,s)}async getNormalData(t,i){const r=this.errorContext;r.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+F$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(Xi,s)}async getTangentData(t,i){const r=this.errorContext;r.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,i);return r.errorUnsupportedIf(s.componentType!==dt.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+F$[s.componentType]),r.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new qn(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,i){const r=this.errorContext;r.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,i);return r.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===dt.FLOAT?this._wrapAccessor(Kh,s):(r.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),Llt(s))}async getVertexColors(t,i){const r=this.errorContext;r.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,i);if(r.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===dt.FLOAT)return this._wrapAccessor(qn,s);if(s.componentType===dt.UNSIGNED_BYTE)return this._wrapAccessor(Fl,s);if(s.componentType===dt.UNSIGNED_SHORT)return this._wrapAccessor(s_,s)}else if(s.componentCount===3){if(s.componentType===dt.FLOAT)return this._wrapAccessor(Xi,s);if(s.componentType===dt.UNSIGNED_BYTE)return this._wrapAccessor(r_,s);if(s.componentType===dt.UNSIGNED_SHORT)return this._wrapAccessor(Lw,s)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+F$[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?jae(this.json.materials[t.material]):jae(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),h=r?this.getTexture(n.occlusionTexture,i):null,p=r?this.getTexture(n.emissiveTexture,i):null,f=r?this.getTexture(o.metallicRoughnessTexture,i):null,m=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:m,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,i){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.errorContext,n=this.json.textures[r],o=Rlt(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(r,n,i);return _W(this.textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:h(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:h(o.wrapT),minFilter:o.minFilter,name:a.name,id:r}})}getNodeTransform(t){if(t===void 0)return Plt;let i=this.nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=Hr(Ae(),r,s.matrix):s.translation||s.rotation||s.scale?(i=Kb(r),s.translation&&qa(i,i,s.translation),s.rotation&&(N$[3]=Nbe(N$,s.rotation),gc(i,i,N$[3],N$)),s.scale&&nk(i,i,s.scale)):i=r,this.nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return zh(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=qw.parse(this.json.asset.version,"glTF");Olt.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,i=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&i.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this.nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,i){const r=this.json.images[t.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),i);const s=this.errorContext;s.errorUnsupportedIf(r.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(r.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],o=await this.getBuffer(n.buffer,i);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),Nlt(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const Olt=new qw(2,0,"glTF"),Plt=Vme(Ae(),Math.PI/2),N$=fy(),Ilt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},$lt={[dt.BYTE]:1,[dt.UNSIGNED_BYTE]:1,[dt.SHORT]:2,[dt.UNSIGNED_SHORT]:2,[dt.FLOAT]:4,[dt.UNSIGNED_INT]:4};function Llt(e){switch(e.componentType){case dt.BYTE:return new Nw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_BYTE:return new Iw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.SHORT:return new Fw(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_SHORT:return new vE(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.UNSIGNED_INT:return new _E(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case dt.FLOAT:return new Kh(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function Dlt(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function Nlt(e,t){return new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)):i(o)}),o.addEventListener("error",a=>{URL.revokeObjectURL(n),r(a)}),o.src=n})}const F$={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let Flt=0;async function d2e(e,t,i={},r=!0){const s=await yg.load(e,bN,t,i),n="gltf_"+Flt++,o={lods:[],materials:new Map,textures:new Map,meta:klt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await Ult(s,async(c,h,p,f)=>{var L;const m=(L=l.get(p))!=null?L:0;l.set(p,m+1);const y=c.mode!==void 0?c.mode:$t.TRIANGLES,v=y===$t.TRIANGLES||y===$t.TRIANGLE_STRIP||y===$t.TRIANGLE_FAN?y:null;if(R(v))return void bN.warnUnsupported("Unsupported primitive mode ("+Glt[y]+"). Skipping primitive.");if(!s.hasPositions(c))return void bN.warn("Skipping primitive without POSITION vertex attribute.");const w=s.getPositionData(c,i),b=s.getMaterial(c,i,r),S=s.hasNormals(c)?s.getNormalData(c,i):null,T=s.hasTangents(c)?s.getTangentData(c,i):null,E=s.hasTextureCoordinates(c)?s.getTextureCoordinates(c,i):null,C=s.hasVertexColors(c)?s.getVertexColors(c,i):null,A=s.getIndexData(c,i),I={transform:Kb(h),attributes:{position:await w,normal:S?await S:null,texCoord0:E?await E:null,color:C?await C:null,tangent:T?await T:null},indices:await A,primitiveType:v,material:Vlt(o,await b,n)};let D=null;_(o.meta)&&_(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(D=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:f,lodThreshold:D},o.lods[p].parts[m]=I});for(const c of o.lods)c.parts=c.parts.filter(h=>!!h);return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{}}}function klt(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;_(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function Ult(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),zlt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=e.getNodeTransform(a);if(bN.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)n.push(t(f,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function zlt(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Vlt(e,t,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=Tlt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:Blt.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=xlt({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const bN=new wlt,Blt=[Ke.LINEAR_MIPMAP_LINEAR,Ke.LINEAR_MIPMAP_NEAREST],Glt=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function jlt(e,t=wE){return typeof e=="number"?t(e):HN(e)||lb(e)?new Uint32Array(e):e}function Hlt(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function qlt(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],o=0;for(let a=0;a<i;++a){const l=e[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}const og=fe.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function p2e(e,t){const i=await Wlt(e,t);return{resource:i,textures:await Jlt(i.textureDefinitions,t)}}async function Wlt(e,t){const i=_(t)&&t.streamDataRequester;if(i)return Xlt(e,i,t);const r=await ku(Zt(e,t));if(r.ok===!0)return r.value.data;bc(r.error),f2e(r.error)}async function Xlt(e,t,i){const r=await ku(t.request(e,"json",i));if(r.ok===!0)return r.value;bc(r.error),f2e(r.error.details.url)}function f2e(e){throw new j("",`Request for object resource failed: ${e}`)}function Zlt(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(og.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(og.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(og.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(og.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else og.warn("Indexed geometries must specify faces"),r=!1;break}default:og.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(og.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(og.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function Ylt(e,t){const i=[],r=[],s=[],n=[],o=e.resource,a=qw.parse(o.version||"1.0","wosr");ect.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions,p=e.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const v=c[y];if(!Zlt(v))continue;const w=Klt(v),b=v.params.vertexAttributes,S=[];for(const L in b){const z=b[L],B=z.values;S.push([L,{data:B,size:z.valuesPerElement,exclusive:!0}])}const T=[];if(v.params.topology!=="PerAttributeArray"){const L=v.params.faces;for(const z in L)T.push([z,new Uint32Array(L[z].values)])}const E=p&&p[w.texture];if(E&&!m.has(w.texture)){const{image:L,params:z}=E,B=new Ns(L,z);n.push(B),m.set(w.texture,B)}const C=m.get(w.texture),A=C?C.id:void 0;let I=s[w.material]?s[w.material][w.texture]:null;if(!I){const L=h[w.material.substring(w.material.lastIndexOf("/")+1)].params;L.transparency===1&&(L.transparency=0);const z=E&&E.alphaChannelUsage,B=L.transparency>0||z==="transparency"||z==="maskAndTransparency",V=E?m2e(E.alphaChannelUsage):void 0,Q={ambient:yl(L.diffuse),diffuse:yl(L.diffuse),opacity:1-(L.transparency||0),transparent:B,textureAlphaMode:V,textureAlphaCutoff:.33,textureId:A,initTextureTransparent:!0,doubleSided:!0,cullFace:hr.None,colorMixMode:L.externalColorMixMode||"tint",textureAlphaPremultiplied:!!E&&!!E.params.preMultiplyAlpha};_(t)&&t.materialParamsMixin&&Object.assign(Q,t.materialParamsMixin),I=new jw(Q),s[w.material]||(s[w.material]={}),s[w.material][w.texture]=I}r.push(I);const D=new Fr(S,T);f+=T.position?T.position.length:0,i.push(D)}return{name:l,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:Qlt(i),numberOfVertices:f,lodThreshold:null}}function Qlt(e){const t=mr();return e.forEach(i=>{const r=i.boundingInfo;_(r)&&(Zf(t,r.getBBMin()),Zf(t,r.getBBMax()))}),t}async function Jlt(e,t){const i=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){og.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:wt.REPEAT,t:wt.REPEAT},preMultiplyAlpha:m2e(h)!==cr.Opaque},f=_(t)&&t.disableTextures?Promise.resolve(null):Ap(l,t);i.push(f.then(m=>({refId:c,image:m,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function m2e(e){switch(e){case"mask":return cr.Mask;case"maskAndTransparency":return cr.MaskBlend;case"none":return cr.Opaque;default:return cr.Blend}}function Klt(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const ect=new qw(1,2,"wosr"),Qx=2.1;async function g2e(e,t){const i=y2e(yq(e));if(i.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(i.url,t):p2e(i.url,t)),c=Ylt(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):d2e(new u2e(t.streamDataRequester),i.url,t,t.usePBR)),s=xr(r.model.meta,"ESRI_proxyEllipsoid");r.meta.isEsriSymbolResource&&_(s)&&r.meta.uri.includes("/RealisticTrees/")&&rct(r,s);const n=r.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!r.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},o=ye(F({},t.materialParamsMixin),{treeRendering:!!r.customMeta.esriTreeRendering});if(i.specifiedLodIndex!=null){const l=wN(r,n,o,i.specifiedLodIndex);let c=l[0].boundingBox;return i.specifiedLodIndex!==0&&(c=wN(r,n,o,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}const a=wN(r,n,o);return{lods:a,referenceBoundingBox:a[0].boundingBox,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}function y2e(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function wN(e,t,i,r){const s=e.model,n=Or(),o=new Array,a=new Map,l=new Map;return s.lods.forEach((c,h)=>{if(r!==void 0&&h!==r)return;const p={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:_(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:mr()};o.push(p),c.parts.forEach(f=>{const m=f.material+(f.attributes.normal?"_normal":"")+(f.attributes.color?"_color":"")+(f.attributes.texCoord0?"_texCoord0":"")+(f.attributes.tangent?"_tangent":""),y=s.materials.get(f.material),v=_(f.attributes.texCoord0),w=_(f.attributes.normal),b=tct(y.alphaMode);if(!a.has(m)){if(v){if(_(y.textureColor)&&!l.has(y.textureColor)){const oe=s.textures.get(y.textureColor),$=ye(F({},oe.parameters),{preMultiplyAlpha:b!==cr.Opaque});l.set(y.textureColor,new Ns(oe.data,$))}if(_(y.textureNormal)&&!l.has(y.textureNormal)){const oe=s.textures.get(y.textureNormal);l.set(y.textureNormal,new Ns(oe.data,oe.parameters))}if(_(y.textureOcclusion)&&!l.has(y.textureOcclusion)){const oe=s.textures.get(y.textureOcclusion);l.set(y.textureOcclusion,new Ns(oe.data,oe.parameters))}if(_(y.textureEmissive)&&!l.has(y.textureEmissive)){const oe=s.textures.get(y.textureEmissive);l.set(y.textureEmissive,new Ns(oe.data,oe.parameters))}if(_(y.textureMetallicRoughness)&&!l.has(y.textureMetallicRoughness)){const oe=s.textures.get(y.textureMetallicRoughness);l.set(y.textureMetallicRoughness,new Ns(oe.data,oe.parameters))}}const L=y.color[0]**(1/Qx),z=y.color[1]**(1/Qx),B=y.color[2]**(1/Qx),V=y.emissiveFactor[0]**(1/Qx),Q=y.emissiveFactor[1]**(1/Qx),Z=y.emissiveFactor[2]**(1/Qx),ce=_(y.textureColor)&&v?l.get(y.textureColor):null;a.set(m,new jw(F(ye(F({},t),{transparent:b===cr.Blend,customDepthTest:Aw.Lequal,textureAlphaMode:b,textureAlphaCutoff:y.alphaCutoff,diffuse:[L,z,B],ambient:[L,z,B],opacity:y.opacity,doubleSided:y.doubleSided,doubleSidedType:"winding-order",cullFace:y.doubleSided?hr.None:hr.Back,hasVertexColors:!!f.attributes.color,hasVertexTangents:!!f.attributes.tangent,normals:w?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:_(ce)?ce.id:void 0,colorMixMode:y.colorMixMode,normalTextureId:_(y.textureNormal)&&v?l.get(y.textureNormal).id:void 0,textureAlphaPremultiplied:_(ce)&&!!ce.params.preMultiplyAlpha,occlusionTextureId:_(y.textureOcclusion)&&v?l.get(y.textureOcclusion).id:void 0,emissiveTextureId:_(y.textureEmissive)&&v?l.get(y.textureEmissive).id:void 0,metallicRoughnessTextureId:_(y.textureMetallicRoughness)&&v?l.get(y.textureMetallicRoughness).id:void 0,emissiveFactor:[V,Q,Z],mrrFactors:[y.metallicFactor,y.roughnessFactor,t.mrrFactors[2]],isSchematic:!1}),i)))}const S=ict(f.indices||f.attributes.position.count,f.primitiveType),T=f.attributes.position.count,E=Eb(Xi,T);uP(E,f.attributes.position,f.transform);const C=[[M.POSITION,{data:E.typedBuffer,size:E.elementCount,exclusive:!0}]],A=[[M.POSITION,S]];if(_(f.attributes.normal)){const L=Eb(Xi,T);pE(n,f.transform),h_(L,f.attributes.normal,n),C.push([M.NORMAL,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([M.NORMAL,S])}if(_(f.attributes.tangent)){const L=Eb(qn,T);pE(n,f.transform),n2e(L,f.attributes.tangent,n),C.push([M.TANGENT,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([M.TANGENT,S])}if(_(f.attributes.texCoord0)){const L=Eb(Kh,T);a2e(L,f.attributes.texCoord0),C.push([M.UV0,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([M.UV0,S])}if(_(f.attributes.color)){const L=Eb(Fl,T);if(f.attributes.color.elementCount===4)f.attributes.color instanceof qn?vq(L,f.attributes.color,255):f.attributes.color instanceof Fl?l2e(L,f.attributes.color):f.attributes.color instanceof s_&&vq(L,f.attributes.color,1/256);else{c2e(L,255,255,255,255);const z=new r_(L.buffer,0,4);f.attributes.color instanceof Xi?oq(z,f.attributes.color,255):f.attributes.color instanceof r_?KU(z,f.attributes.color):f.attributes.color instanceof Lw&&oq(z,f.attributes.color,1/256)}C.push([M.COLOR,{data:L.typedBuffer,size:L.elementCount,exclusive:!0}]),A.push([M.COLOR,S])}const I=new Fr(C,A);p.stageResources.geometries.push(I),p.stageResources.materials.push(a.get(m)),v&&(_(y.textureColor)&&p.stageResources.textures.push(l.get(y.textureColor)),_(y.textureNormal)&&p.stageResources.textures.push(l.get(y.textureNormal)),_(y.textureOcclusion)&&p.stageResources.textures.push(l.get(y.textureOcclusion)),_(y.textureEmissive)&&p.stageResources.textures.push(l.get(y.textureEmissive)),_(y.textureMetallicRoughness)&&p.stageResources.textures.push(l.get(y.textureMetallicRoughness))),p.numberOfVertices+=T;const D=I.boundingInfo;_(D)&&(Zf(p.boundingBox,D.getBBMin()),Zf(p.boundingBox,D.getBBMax()))})}),o}function tct(e){switch(e){case"BLEND":return cr.Blend;case"MASK":return cr.Mask;case"OPAQUE":case null:case void 0:return cr.Opaque}}function ict(e,t){switch(t){case $t.TRIANGLES:return jlt(e);case $t.TRIANGLE_STRIP:return Hlt(e);case $t.TRIANGLE_FAN:return qlt(e)}}function rct(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const s of r.parts){const n=s.attributes.normal;if(R(n))return;const o=s.attributes.position,a=o.count,l=O(),c=O(),h=O(),p=Eb(Fl,a),f=Eb(Xi,a),m=_s(Ae(),s.transform);for(let y=0;y<a;y++){o.getVec(y,c),n.getVec(y,l),ze(c,c,s.transform),pe(h,c,t.center),pF(h,h,t.radius);const v=h[2],w=Me(h),b=Math.min(.45+.55*w*w,1);pF(h,h,t.radius),ze(h,h,m),we(h,h),i+1!==e.model.lods.length&&e.model.lods.length>1&&pn(h,h,l,v>-1?.2:Math.min(-4*v-3.8,1)),f.setVec(y,h),p.set(y,0,255*b),p.set(y,1,255*b),p.set(y,2,255*b),p.set(y,3,255)}s.attributes.normal=f,s.attributes.color=p}}}var YEt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetch:g2e,gltfToEngineResources:wN,parseUrl:y2e}),Ar;function sct(e){let t=ls().mat4f64(M.LOCALTRANSFORM).mat4f64(M.GLOBALTRANSFORM).vec4f64(M.BOUNDINGSPHERE).vec3f64(M.MODELORIGIN).mat3f(M.MODEL).mat3f(M.MODELNORMAL).vec2f(M.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(M.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(M.FEATUREATTRIBUTE)),t=t.u8(M.STATE).u8(M.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Ar||(Ar={}));class nct{constructor(t){this.localTransform=t.getField(M.LOCALTRANSFORM,i_),this.globalTransform=t.getField(M.GLOBALTRANSFORM,i_),this.modelOrigin=t.getField(M.MODELORIGIN,As),this.model=t.getField(M.MODEL,Rp),this.modelNormal=t.getField(M.MODELNORMAL,Rp),this.modelScaleFactors=t.getField(M.MODELSCALEFACTORS,Kh),this.boundingSphere=t.getField(M.BOUNDINGSPHERE,Pw),this.color=t.getField(M.COLOR,qn),this.featureAttribute=t.getField(M.FEATUREATTRIBUTE,qn),this.state=t.getField(M.STATE,ay),this.lodLevel=t.getField(M.LODLEVEL,ay)}}class oct extends as{constructor(t,i){super(),this._capacity=0,this._size=0,this._next=0,this._layout=sct(t),this._shaderTransformation=i}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,Ar.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const i=this._view.state;pt(t>=0&&t<this._capacity&&i.get(t)&Ar.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,Ar.ACTIVE)?this._setStateFlags(t,Ar.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const i=this._view.state;pt(t>=0&&t<this._capacity&&i.get(t)&Ar.ALLOCATED,"invalid instance handle"),i.set(t,0),this._size--}setLocalTransform(t,i,r=!0){this._view.localTransform.setMat(t,i),r&&this.updateModelTransform(t)}getLocalTransform(t,i){this._view.localTransform.getMat(t,i)}setGlobalTransform(t,i,r=!0){this._view.globalTransform.setMat(t,i),r&&this.updateModelTransform(t)}getGlobalTransform(t,i){this._view.globalTransform.getMat(t,i)}updateModelTransform(t){const i=this._view,r=jy,s=fd;i.localTransform.getMat(t,Hae),i.globalTransform.getMat(t,BB);const n=Hr(BB,BB,Hae);se(r,n[12],n[13],n[14]),i.modelOrigin.setVec(t,r),Qh(s,n),i.model.setMat(t,s);const o=tFe(jy,n);o.sort(),i.modelScaleFactors.set(t,0,o[1]),i.modelScaleFactors.set(t,1,o[2]),dx(s,s),Jh(s,s),i.modelNormal.setMat(t,s),this._setStateFlags(t,Ar.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,i){const r=this._view;r.model.getMat(t,fd),r.modelOrigin.getVec(t,jy),i[0]=fd[0],i[1]=fd[1],i[2]=fd[2],i[3]=0,i[4]=fd[3],i[5]=fd[4],i[6]=fd[5],i[7]=0,i[8]=fd[6],i[9]=fd[7],i[10]=fd[8],i[11]=0,i[12]=jy[0],i[13]=jy[1],i[14]=jy[2],i[15]=1}applyShaderTransformation(t,i){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i)}getCombinedModelTransform(t,i){return this.getModelTransform(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedLocalTransform(t,i){return this._view.localTransform.getMat(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedMaxScaleFactor(t){let i=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(jy,this,t);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(t){let i=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(jy,this,t);r.sort(),i*=r[1]}return i}getModel(t,i){this._view.model.getMat(t,i)}setFeatureAttribute(t,i){this._view.featureAttribute.setVec(t,i)}getFeatureAttribute(t,i){this._view.featureAttribute.getVec(t,i)}setColor(t,i){this._view.color.setVec(t,i)}getColor(t,i){this._view.color.getVec(t,i)}setVisible(t,i){i!==this.getVisible(t)&&(this._setStateFlag(t,Ar.VISIBLE,i),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,Ar.VISIBLE)}setHighlight(t,i){i!==this.getHighlight(t)&&(this._setStateFlag(t,Ar.HIGHLIGHT,i),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,Ar.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&t&&++i;return i}_setStateFlags(t,i){const r=this._view.state;i=r.get(t)|i,r.set(t,i)}_clearStateFlags(t,i){const r=this._view.state;i=r.get(t)&~i,r.set(t,i)}_setStateFlag(t,i,r){r?this._setStateFlags(t,i):this._clearStateFlags(t,i)}_getStateFlag(t,i){return!!(this._view.state.get(t)&i)}_grow(){const t=Math.max(act,Math.floor(this._capacity*lct)),i=this._layout.createBuffer(t);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=t,this._buffer=i,this._view=new nct(this._buffer)}_findSlot(){const t=this._view.state;let i=this._next;for(;t.get(i)&Ar.ALLOCATED;)i=(i+1)%this._capacity;return this._next=(i+1)%this._capacity,i}}const act=1024,lct=2,jy=O(),fd=Or(),Hae=Ae(),BB=Ae();class cct extends dp{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=En(),this._tmpMat4=Ae(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);ze(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*xw(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class uct{constructor(t,i){this.thresholdScale=1,this._camera=new tr,this._worldSpaceRadius=t,this._thresholds=i.map(r=>r)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,i){const r=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*i/r,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class hct{constructor(t,i){const r=t.renderContext.rctx,{geometry:s,material:n}=i;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write({},s,c,0),this.geometry=s,this.material=n,this.glMaterials=new QTe(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=oi.createVertex(r,Ei.STATIC_DRAW,c.buffer),this.vao=new Hs(r,Ui,{geometry:Dc(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,r,s,(h,p,f,m,y)=>{if(h>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,h))return;const v={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:c,triangleNr:f,baseBoundingSphere:a,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||y>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(Vr.LOD,v,h,p,t.transform.transform,y),t.options.store!==vo.MIN&&(t.results.max.drapedLayerOrder==null||y>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(Vr.LOD,v,h,p,t.transform.transform,y),t.options.store===vo.ALL){const w=mQ(t.results.min.ray);w.set(Vr.LOD,v,h,p,t.transform.transform,y),t.results.all.push(w)}}})}}class pJ{constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}static async create(t,i,r){const s=await Promise.allSettled(i.components.map(o=>t.schedule(()=>new hct(t,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(nn(r)||n.length!==s.length){n.forEach(o=>o.destroy()),fi(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new pJ(i.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(t,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(R(this._boundingBox)){const t=mr();this.components.forEach(i=>{_(i.boundingInfo)&&(Zf(t,i.boundingInfo.bbMin),Zf(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(R(this._boundingSphere)){const t=this.boundingBox,i=O();np(t,i),this._boundingSphere={center:i,radius:.5*Fpe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class dct{constructor(t,i,r){this._elementSize=i,this._buffer=oi.createVertex(t,Ei.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(this._array,r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class pct{constructor(t){this.modelOriginHi=t.getField(M.MODELORIGINHI,Xi),this.modelOriginLo=t.getField(M.MODELORIGINLO,Xi),this.model=t.getField(M.MODEL,Rp),this.modelNormal=t.getField(M.MODELNORMAL,Rp),this.color=t.getField(M.INSTANCECOLOR,qn),this.featureAttribute=t.getField(M.INSTANCEFEATUREATTRIBUTE,qn)}}class qae{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){pt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){pt(this._updating,"not updating"),this.size<mct*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){pt(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),pt(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){pt(this._updating,"not updating"),pt(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(Wae,Math.floor(this._capacity*fct));this._resize(t)}_shrink(){const t=Math.max(Wae,Math.floor(this._capacity*gct));this._resize(t)}_resize(t){if(pt(this._updating,"not updating"),t===this._capacity)return;const i=new dct(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);pt(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new pct(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const Wae=1024,fct=2,mct=.3,gct=.5;let yct=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new uct(t,i)};class vct{constructor(t,i,r,s){this.type=Vr.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new tr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=i,this._metadata=r,this._instanceBufferLayout=USe({instancedDoublePrecision:!0,instanced:i}),this._glInstanceBufferLayout=Dc(this._instanceBufferLayout,1),this._instanceData=new oct(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),t}get renderStats(){const t=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(t,i){this._context=t;const r=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new qae(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new qae(r,this._instanceBufferLayout)),pJ.create(t,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(nn(i)||n.length!==s.length){n.forEach(o=>o.destroy()),fi(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=yct(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(i=>i.material.requiresSlot(Ee.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(Wi.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const r=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),r||this._requestUpdateCycle()}const i=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,i),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const i=t.pass!==je.MATERIAL_HIGHLIGHT&&t.pass!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,r=t.pass!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;i&&this._renderComponents(t,this._defaultRenderInstanceData),r&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,i,r,s){if(!this.baseMaterial.isVisible())return;const n=O();pe(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,Yae),t.transform.set(Yae),ze(Qae,r,t.transform.inverse),ze(Jae,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;pt(l&Ar.ACTIVE,"invalid instance state"),pt(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(t,i,Qae,Jae,a,this._metadata,h)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(r,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new cct(this._instanceData,this.baseBoundingSphere),i=this._instanceData,r=i.view?i.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)r.get(s)&Ar.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const i=t.eye,r=t.viewForward,s=this.octree.findClosest(r,dp.DepthOrder.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(r,dp.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,qp),pe(qp,qp,i);const o=xe(qp,r)-qp[3];this._instanceData.view.boundingSphere.getVec(n,qp),pe(qp,qp,i);const a=xe(qp,r)+qp[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,i){const r=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(h=>{h.beginUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.beginUpdate()});const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;i=Math.min(a,i);for(let h=0;h<i;++h){c===0&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Ar.ALLOCATED)){c=(c+1)%l,i++;continue}const m=o.lodLevel.get(c);if(p&Ar.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[m].freeTail(),p&Ar.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail(),p&Ar.REMOVE)n.freeInstance(c);else if(p&Ar.VISIBLE){let y=0;r&&(o.modelOrigin.getVec(c,Zae),y=s.selectLevel(Zae,n.getCombinedMedianScaleFactor(c))),f=p&~(Ar.ACTIVE|Ar.TRANSFORM_CHANGED),y>=0&&(p&Ar.HIGHLIGHT?(Xae(this._highlightRenderInstanceData[y],o,c),f|=Ar.HIGHLIGHT_ACTIVE):(Xae(this._defaultRenderInstanceData[y],o,c),f|=Ar.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,y)}else f=p&~(Ar.ACTIVE|Ar.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octree){const y=!!(p&Ar.ACTIVE),v=!!(f&Ar.ACTIVE);!y&&v?this._octree.addInstance(c):y&&!v?this._octree.removeInstance(c):y&&v&&p&Ar.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>{h.endUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.endUpdate()})}_renderComponents(t,i){this.levels.forEach((r,s)=>{r.components.forEach(n=>{this._renderComponent(t,i[s],n,s)})})}_renderComponent(t,i,r,s){const n=t.bindParameters;if(i.size===0||!r.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=t,l=r.glMaterials.load(o,a);if(R(l))return;const c=l.beginSlot(n),h=o.bindTechnique(c,r.material.parameters,n);o.bindVAO(r.vao),c.ensureAttributeLocations(r.vao),c.bindDraw(bct,n),Wi.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===je.MATERIAL&&(h.setUniform4fv("externalColor",Kae[Math.min(s,Kae.length-1)]),h.setUniform1i("colorMixMode",Gxe.replace));const p=o.capabilities.instancing,f=i.capacity,m=i.headIndex,y=i.tailIndex,v=i.firstIndex,w=this._glInstanceBufferLayout,b=(S,T)=>{VY(o,Ui,i.buffer,w,S),p.drawArraysInstanced(c.primitiveType,0,r.vertexCount,T-S),BY(o,Ui,i.buffer,w)};r.material.parameters.transparent&&v!=null?m>y?(pt(v>=y&&v<=m,"invalid firstIndex"),b(v,m),b(y,v)):m<y&&(v<=m?(pt(v>=0&&v<=m,"invalid firstIndex"),b(v,m),b(y,f),b(0,v)):(pt(v>=y&&v<=f,"invalid firstIndex"),b(v,f),b(0,m),b(y,v))):m>y?b(y,m):m<y&&(b(0,m),b(y,f)),o.bindVAO(null)}}function Xae(e,t,i){const r=e.allocateHead();_ct(t,i,e.view,r)}function _ct(e,t,i,r){kQe(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const Zae=O(),qp=Xt(),Yae=Ae(),Qae=O(),Jae=O(),Kae=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],bct=new Gnt;class wct extends xm{constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[t,i,r]=_(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}async doLoad(t){if(!this._drivenProperties.size&&RU(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this.isPrimitive){const r=i.resource?i.resource.primitive:wX;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return _(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return xr(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,i=xr(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?hr.None:hr.Back,t}async _createResourcesForPrimitive(t,i){if(!Art(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=Gs(VPe(t)),n=yl(XP(s)),o=yl(e6(n,r)),a=Me(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Nf,diffuse:Nf,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this._setMaterialTransparencyParams(h);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:b,minWorldLength:S,maxWorldLength:T}=f.verticalOffset;h.verticalOffset={screenLength:gi(b),minWorldLength:S||0,maxWorldLength:T!=null?T:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=Nh;else{const b=_(r.material)&&r.material.color,S=_(b)?Pe.toUnitRGBA(b):Nh;h.externalColor=S}this._fastUpdates=r3(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,p1)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const m=new jw(h),y=NTe(t,m);if(!y)throw new Error(`Unknown object symbol primitive: ${t}`);const v=v$(y).map(b=>({opacity:1,transparent:b.parameters.transparent})),w=await this._createStageResources(y,p);return{lodResources:y,lodRenderer:await this._createLodRenderer(y,i),stageResources:w,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:v,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:p1}}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=r3(this._context.renderer,this._fastVisualVariableConvertOptions(p1,p1,p1,p1)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:L,minWorldLength:z,maxWorldLength:B}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:gi(L),minWorldLength:z||0,maxWorldLength:B!=null?B:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled;const o=s.usePBR,a=await g2e(t,s),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource(()=>a.remove());const h=nlt(a.lods);alt(h),h.levels.sort((L,z)=>L.minScreenSpaceRadius-z.minScreenSpaceRadius),h.levels[0].minScreenSpaceRadius=Math.min(2,h.levels[0].minScreenSpaceRadius);const p=this._context,f=this.symbolLayer.material,m=this._getExternalColorParameters(f),y=xr(this.symbolLayer,"material","color"),v=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),w=this.needsDrivenTransparentPass,b=v$(h),S=v$(h).map(L=>({opacity:L.parameters.opacity||1,transparent:L.parameters.transparent}));b.forEach(L=>{const z=L.parameters;L.setParameters(m);const B=z.opacity*v,V=B<1||w||z.transparent;L.setParameters({opacity:B,transparent:V}),p.screenSizePerspectiveEnabled&&L.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const T=a.referenceBoundingBox,E=yl(XP(T)),C=yl(h.levels[0].pivotOffset),A=yl(e6(E,this.symbolLayer)),I=Me(A);s3(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(T,A,E,C))&&b.forEach(L=>L.setParameters(this._fastUpdates.materialParameters));const D=await this._createStageResources(h,o);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,i),stageResources:D,symbolSize:A,extentPadding:I,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:S,physicalBasedRenderingEnabled:o,resourceBoundingBox:T,resourceSize:E,pivotOffset:C}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,i){const r=this._context.stage,s=v$(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s),this._addDisposeResource(()=>r.removeMany(s));const n=Drt(t);r.addMany(n),this._addDisposeResource(()=>r.removeMany(n)),await r.load(n);const o=Nrt(t);return r.addMany(o),this._addDisposeResource(()=>r.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,k$),Ss(c,dq(this._fastUpdates.materialParameters,k$,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,k$),Aot(a,this._fastUpdates.materialParameters,k$))}:null,o=new vct(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o)}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=Nh:_(t)&&_(t.color)?i.externalColor=Pe.toUnitRGBA(t.color):(i.externalColor=Nh,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=KO(i.geometry);if(R(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new Bu),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(R(this._resources))return!0;const t=this._drivenProperties.opacity,i=!this.isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=xr(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?hr.None:hr.Back})}return!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,u_)}slicePlaneEnabledChanged(){if(R(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(R(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,i){if(R(this._resources))return ln.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!s3(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return ln.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return ln.Fast_Update}computeComplexity(){return R(this._resources)?super.computeComplexity():{primitivesPerFeature:JQ(this._resources.lodResources.levels[0]).reduce((t,i)=>t+i.indices.get(M.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:VTe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return _(this._resources)}_createAs3DShape(t,i,r,s,n){if(!this._hasLodRenderer()||R(this._resources))return null;const o=this.getFastUpdateAttrValues(t),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?RM(r.color,r.opacity):null,l=this._context.clippingExtent;if(jn(i,Jx,this._context.elevationProvider.spatialReference),_(l)&&!sX(l,Jx))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(i,s,GB,U$),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,ele),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,n),f.setLocalTransform(m,p,!1),f.setGlobalTransform(m,h),o&&f.setFeatureAttribute(m,o),a&&f.setColor(m,a);const y=new ilt(this,m,_rt,s);return c&&(y.alignedSampledElevation=U$.sampledElevation),y.needsElevationUpdates=u_(s.mode),JO(y,i,this._context.elevationProvider),y}_computeGlobalTransform(t,i,r,s){return cy(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),Jx[0]=t.x,Jx[1]=t.y,Jx[2]=s.z,Nu(t.spatialReference,Jx,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return tm(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=Toe(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||nk(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(R(this._resources))return!0;const r=i&&KO(i);if(R(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,GB,U$),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=U$.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,GB,!0),JO(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||R(this._resources))return;const r=(y,v,w)=>vt(y!=null&&y.type==="complete"?y.newValue:v,w),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},m=this._resources;this.loadStatus===mu.LOADED&&t.symbolLayerStatePatches.push(()=>{m.symbolSize=yl(e6(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((y,v)=>{const w=this._computeLocalTransform(m,f,v,ele),b=y.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,w,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=_(s)?Pe.toUnitRGBA(s):Nh;delete r.color;const o=this._resources;R(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return lrt(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=O();switch(r.anchor){case"center":ae(s,np(t)),ca(s,s);break;case"top":{const n=np(t);se(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=np(t);se(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=np(t),o=XP(t),a=r.anchorPosition,l=a?Ue(a.x,a.y,a.z):Ba;F5(s,o,l),de(s,s,n),ca(s,s);break}default:_(i)?ca(s,i):ae(s,Ba)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&qa(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=_(t)?yl(XP(t)):Nf,o=_(t)?this._computeAnchor(t,s,this.symbolLayer):Ba,a=this._context.renderCoordsHelper.unitInMeters,l=Toe(_(i)?i:void 0,i,r,a),c=Ue(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:_(i)?i:Nf,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const Jx=O(),ele=Ae(),GB=Ae(),k$=Xt(),U$=new cP;function xct(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Tct(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function fJ(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function Sct(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function Ect(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null}function Cct(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function Act(e){return e[0]*e[3]-e[2]*e[1]}function v2e(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*h,e[3]=s*c+o*h,e}function Rct(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e}function Mct(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function Oct(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function Pct(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function Ict(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function $ct(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function Lct(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function Dct(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function _2e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function Nct(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Fct(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Ct*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Ct*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Ct*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Ct*Math.max(1,Math.abs(n),Math.abs(c))}function kct(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Uct(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const zct=v2e,Vct=_2e;Object.freeze(Object.defineProperty({__proto__:null,copy:xct,identity:Tct,set:fJ,transpose:Sct,invert:Ect,adjoint:Cct,determinant:Act,multiply:v2e,rotate:Rct,scale:Mct,fromRotation:Oct,fromScaling:Pct,str:Ict,frob:$ct,LDU:Lct,add:Dct,subtract:_2e,exactEquals:Nct,equals:Fct,multiplyScalar:kct,multiplyScalarAndAdd:Uct,mul:zct,sub:Vct},Symbol.toStringTag,{value:"Module"}));class Bct extends Fr{constructor(t,i,r,s,n,o){super(t,i),this.path=r,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function b2e(e){return"upVectorAlignment"in e}function w2e(){return[1,0,0,1]}function Gct(e){return[e[0],e[1],e[2],e[3]]}function jct(e,t,i,r){return[e,t,i,r]}function Hct(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:w2e,clone:Gct,fromValues:jct,createView:Hct},Symbol.toStringTag,{value:"Module"}));function _q(){return{up:O(),right:O()}}function qct(e,t,i){ze(e.up,t.up,i),ze(e.right,t.right,i)}function Wct(e,t,i){yi(e,xe(i,t.right),xe(i,t.up))}class Xct{constructor(){this.pos=O(),this.posES=O(),this.posGS=O(),this.vRight=O(),this.vLeft=O(),this.frame=_q(),this.rotationFrame=_q(),this.rotationRight=it(),this.rotationAngle=0,this.miterStretch=w2e()}setFrameFromUpVector(t){ae(this.frame.up,t),de(mh,this.vLeft,this.vRight),we(mh,mh),le(Fd,this.frame.up,xe(mh,this.frame.up)),pe(V$,mh,Fd),we(V$,V$),ct(this.frame.right,V$,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){ae(this.rotationFrame.up,this.frame.up),ae(this.rotationFrame.right,this.frame.right),yi(this.rotationRight,1,0),le(Fd,this.frame.up,xe(this.frame.up,this.vLeft)),pe(Fd,this.vLeft,Fd),ca(Fd,Fd),we(Fd,Fd),le(mh,this.frame.up,xe(this.frame.up,this.vRight)),pe(mh,this.vRight,mh),we(mh,mh),ct(bq,this.rotationFrame.up,this.vLeft);const t=Math.sign(xe(bq,this.vRight));if(this.rotationAngle=t*(Math.PI-fn(xe(Fd,mh))),Math.abs(this.rotationAngle)>0){const r=_9(Math.cos(.5*this.rotationAngle));fJ(this.miterStretch,r-1+1,0,0,1)}const i=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*i))}}class o3{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,i){return this.vertices.push(lR(t)),this.vertexNormals.push(lR(i)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,i=null){return this.poles.push({position:lR(t),normal:i?lR(i):null}),this.poles.length-1}addSegment(t,i=null,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.uvIndices.push(i.v0),this.uvIndices.push(i.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}static circle(t=20){const r=new o3,s={v0:0,v1:0};r.addPole(Di(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),h=Math.sin(l),p=Di(c*.5,h*.5),f=Di(c,h);r.addVertex(p,f),r.addUV(a/t)}r.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;r.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return r.addSegment(n,o,s),r}static rect(){const r=new o3,s=Di(.5*-1,.5*-1),n=Di(.5*1,.5*-1),o=Di(.5*1,.5*1),a=Di(.5*-1,.5*1),l=Di(0,-1),c=Di(1,0),h=Di(0,1),p=Di(-1,0);r.addUV(0),r.addUV(1),r.addPole(Di(0,.5*1),h),r.addPole(Di(0,.5*1)),r.addPole(Di(0,.5*-1)),r.addPole(Di(0,.5*-1),l);const f={v0:0,v1:1};return r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},f,{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},f,{v0:2,v1:1}),r.addVertex(o,h),r.addVertex(a,h),r.addSegment({v0:4,v1:5},f,{v0:0,v1:0}),r.addVertex(a,p),r.addVertex(s,p),r.addSegment({v0:6,v1:7},f,{v0:1,v1:2}),r}}class Zct{constructor(t){this.vertices=[],this.offset=O(),this.xform=Ae(),this.vertices=t;const i=Math.floor((t.length-1)/2);ae(this.offset,this.vertices[i].pos);for(const r of this.vertices)pe(r.pos,r.pos,this.offset);qa(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let i=this.vertices[0];i.index=0,se(i.vLeft,0,0,0),i.vLeftLength=0,pe(i.vRight,this.vertices[1].pos,i.pos),i.vRightLength=Me(i.vRight),we(i.vRight,i.vRight);let r=i;for(let s=1;s<t;++s)i=this.vertices[s],i.index=s,ae(i.vLeft,r.vRight),i.vLeftLength=r.vRightLength,s<t-1?(pe(i.vRight,this.vertices[s+1].pos,i.pos),i.vRightLength=Me(i.vRight),we(i.vRight,i.vRight)):(ae(i.vRight,i.vLeft),i.vRightLength=i.vLeftLength),r=i}}function Yct(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=O(),o=O(),a=O(),l=O(),c=O(),h=O(),p=Si();let f=e.vertices[0];ae(o,t),se(n,0,1,0),nc.makeOrthoBasisDirUpFallback(f.vRight,o,n,n,a,o,s),ae(f.frame.up,o),ae(f.frame.right,a),i=f;for(let m=1;m<r;++m){f=e.vertices[m],de(c,f.vLeft,f.vRight);let y=Me(c);y>0?(y=1/Math.sqrt(y),c[0]=c[0]*y,c[1]=c[1]*y,c[2]=c[2]*y):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),de(h,i.pos,i.frame.up),J2(f.pos,c,p),ax(p,Fu(h,f.vLeft),l)?(pe(l,l,f.pos),we(o,l),ct(a,c,o),we(a,a)):nc.makeOrthoBasisDirUpFallback(c,i.frame.up,i.frame.right,n,a,o,s),ae(f.frame.up,o),ae(f.frame.right,a),i=f}}class Qct{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class jB{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=sut;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){Du(rle,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),qct(s,t.frame,rle);for(let o=0;o<i.vertices.length;++o)Js(i.vertices[o],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[o],i.vertexNormals[o],!1):(IH(Bb,i.vertices[o],t.miterStretch),r(t.index,t.frame,Bb,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=Js(i.vertices[o],t.rotationRight)*t.rotationAngle>=0;IH(Bb,i.vertices[o],t.miterStretch),r(t.index,t.frame,Bb,i.vertexNormals[o],!a)}}}const Jct={generateUV:!1};class mJ{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class tle extends mJ{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class z$ extends mJ{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=gJ;yi(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}}class ile extends mJ{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=Bb,o=gJ;yi(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(t.index,r,l.position,l.normal,s,0):i(t.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(t.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const f=this.profile.poles[this.profile.poleIndices[p]];$f(n,this.profile.vertices[p],f.position),pc(n,n,c),f.normal?(Wd(n,n,f.position),i(t.index,r,n,f.normal,s*h,0)):(SO(o,n),pc(o,o,c),Wd(n,n,f.position),i(t.index,r,n,o,s*h,this.sign*h))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let f=0;f<this.numSegments-1;++f){const m=s+f*this.profile.vertices.length+o,y=s+f*this.profile.vertices.length+a;this.flip?(i(m,p,h),i(p,m,y)):(i(h,p,m),i(y,m,p)),h=m,p=y}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}}class Kct{constructor(t,i,r,s,n,o=Jct){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,i,r){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=i,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[i],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=i,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}_rebuildGeometry(){const t=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const t=(o,a,l)=>this.emitTriangle(o,a,l);this._triangleCount=0;const i=this.profile.vertices.length,r=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(r*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=i*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let o=0;o<r;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<s;++c){const h=c*i+a,p=(c+1)*i+l,f=c*i+l;t(h,(c+1)*i+a,p),t(h,p,f)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class x2e{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class T2e extends x2e{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=tut;se(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=Fd,l=Bb,c=mh,h=bq,p=rut;let f=0,m=0;if(se(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),se(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),yi(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)ct(c,p,h),f=this.builder.profileRightAxisData[o+3]*t[0],m=this.builder.profileUpAxisData[o+3];else{const v=gJ,w=iut;yi(v,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const b=FY(v);SO(v,v);const S=Js(l,v);if(Math.abs(S)>b){yi(w,-v[1],v[0]);const T=Js(l,w);pc(v,v,b*Math.sign(S)),pc(w,w,T),Wd(l,v,w)}se(c,0,0,0)}se(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*f,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*f,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*f;const y=Bb;yi(y,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*y[0]+p[0]*y[1]+c[0]*m,this.vertexAttributeNormal[3*i+1]=h[1]*y[0]+p[1]*y[1]+c[1]*m,this.vertexAttributeNormal[3*i+2]=h[2]*y[0]+p[2]*y[1]+c[2]*m}}createGeometryData(){const t=[[M.POSITION,this.builder.vertexIndices],[M.NORMAL,this.builder.normalIndices]],i=[[M.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[M.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([M.COLOR,new Uint32Array(r)]),i.push([M.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;rP(t,i,0,o,s,n,void 0,void 0,r)}}class eut extends x2e{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new T2e(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[M.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[M.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[M.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[M.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[M.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[M.POSITION,this.builder.pathVertexIndices],[M.PROFILERIGHT,this.builder.vertexIndices],[M.PROFILEUP,this.builder.vertexIndices],[M.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[M.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const tut=O(),Bb=it(),gJ=it(),iut=it(),Fd=O(),mh=O(),bq=O(),rut=O(),V$=O(),sut=_q(),rle=Ae(),HB=8;function nut(e,t){e.attributes.add(M.FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(x`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new vi("size",r=>r.size)),t.vvSize?(i.uniforms.add(new Tt("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Tt("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Tt("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Tt("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(x`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(x`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",HB),i.uniforms.add([new aa("vvOpacityValues",r=>r.vvOpacityValues,HB),new aa("vvOpacityOpacities",r=>r.vvOpacityOpacities,HB)]),i.code.add(x`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(x`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",vp),i.uniforms.add([new aa("vvColorValues",r=>r.vvColorValues,vp),new TU("vvColorColors",r=>r.vvColorColors,vp)]),i.code.add(x`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(x`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(FU),e.attributes.add(M.PROFILERIGHT,"vec4"),e.attributes.add(M.PROFILEUP,"vec4"),e.attributes.add(M.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(x`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(x`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(x`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(x`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class out extends jQ{constructor(){super(...arguments),this.size=Di(1,1)}}function aut(e){const t=new Zi,i=Iu(t,e),{vertex:r,fragment:s}=t;return t.varyings.add("vpos","vec3"),t.include(nut,e),e.output!==K.Color&&e.output!==K.Alpha||(t.include(Uo),t.include(Bw,e),t.include(pP,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(x`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===K.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(zu,e),e.output===K.Alpha&&(t.include(vs,e),s.uniforms.add(new We("opacity",n=>n.opacity)),s.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===K.Color&&(t.include(vs,e),t.include(Gw,e),t.include(gP,e),t.include(Bw,e),t.include(ASe,e),nm(s,e),s.uniforms.add([i,new Tt("ambient",n=>n.ambient),new Tt("diffuse",n=>n.diffuse),new Tt("specular",n=>n.specular),new We("opacity",n=>n.opacity),new We("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Tt("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),s.constants.add("ambientBoostFactor","float",aC),s.include(vm),s.code.add(x`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(Uo,{hasModelTransformation:!1,linearDepth:!0}),r.uniforms.add(new vi("nearFar",(n,o)=>o.camera.nearFar)),t.varyings.add("depth","float"),r.code.add(x`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(vs,e),t.include(x_,e),s.code.add(x`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===K.Normal&&(t.include(Uo),t.include(Mv,e),r.uniforms.add(new Tr("viewNormal",(n,o)=>o.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(vs,e),s.uniforms.add(new Va("waterColor")),s.code.add(x`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===K.Highlight&&(t.include(Uo),t.include(Mv,e),t.varyings.add("vnormal","vec3"),r.code.add(x`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(vs,e),t.include(wy),s.code.add(x`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const lut=Object.freeze(Object.defineProperty({__proto__:null,build:aut},Symbol.toStringTag,{value:"Module"})),S2e=new Map([[M.POSITION,0],[M.PROFILERIGHT,1],[M.PROFILEUP,2],[M.PROFILEVERTEXANDNORMAL,3],[M.FEATUREVALUE,4]]);class cut extends out{constructor(){super(...arguments),this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.specular=Ue(0,0,0),this.opacity=1}}class ez extends pr{initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=dP(t.rctx)}initializeProgram(t){const i=ez.shader.get().build(this.configuration);return new sr(t.rctx,i,S2e)}_setPipelineState(t){const i=this.configuration,r=t===gt.NONE,s=t===gt.FrontFace,n=o=>!o.hasSlicePlane&&!(o.transparent||o.doubleSidedMode===jr.None);return Bt({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.transparent?null:r?$u:xy(t),culling:n(i)&&bbe,depthTest:{func:w_(t)},depthWrite:r||s?Nl:null,colorWrite:ri,stencilWrite:i.hasOccludees?am:null,stencilTest:i.hasOccludees?T_:null,polygonOffset:r||s?null:CU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}ez.shader=new rr(lut,()=>import("./Path.glsl.269d3390.js"));class Pn extends la{constructor(){super(...arguments),this.output=K.Color,this.doubleSidedMode=jr.None,this.transparencyPassType=gt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([H({count:K.COUNT})],Pn.prototype,"output",void 0),u([H({count:jr.COUNT})],Pn.prototype,"doubleSidedMode",void 0),u([H({count:gt.COUNT})],Pn.prototype,"transparencyPassType",void 0),u([H()],Pn.prototype,"spherical",void 0),u([H()],Pn.prototype,"receiveShadows",void 0),u([H()],Pn.prototype,"receiveAmbientOcclusion",void 0),u([H()],Pn.prototype,"vvSize",void 0),u([H()],Pn.prototype,"vvColor",void 0),u([H()],Pn.prototype,"vvOpacity",void 0),u([H()],Pn.prototype,"hasSlicePlane",void 0),u([H()],Pn.prototype,"transparent",void 0),u([H()],Pn.prototype,"hasOccludees",void 0),u([H()],Pn.prototype,"hasMultipassTerrain",void 0),u([H()],Pn.prototype,"cullAboveGround",void 0),u([H()],Pn.prototype,"doublePrecisionRequiresObfuscation",void 0),u([H({constValue:Ot.Disabled})],Pn.prototype,"pbrMode",void 0),u([H({constValue:!0})],Pn.prototype,"hasVvInstancing",void 0),u([H({constValue:!1})],Pn.prototype,"useCustomDTRExponentForWater",void 0),u([H({constValue:!1})],Pn.prototype,"useFillLights",void 0);class yJ extends bm{constructor(t){super(t,new hut),this.supportsEdges=!0,this._vertexAttributeLocations=S2e,this._configuration=new Pn,this.vertexBufferLayout=yJ.getVertexBufferLayout(this.parameters)}getConfiguration(t,i){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==K.Color&&t!==K.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?jr.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?jr.WindingOrder:jr.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==je.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,i,r,s,n,o,a){const l=t;if(!b2e(l))return;const c=l.path,h=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const b=this.parameters.vvSizeOffset,S=this.parameters.vvSizeFactor,T=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,C=c.sizeAttributeValue;h[0]*=De(b[0]+C*S[0],T[0],E[0]),h[1]*=De(b[2]+C*S[2],T[2],E[2])}const p=Math.max(h[0],h[1]),f=t.boundingInfo;if(R(f))return void this._intersectTriangles(c,h,n,o,a);const m=yw(f.bbMin[0]-p,f.bbMin[1]-p,f.bbMin[2]-p,f.bbMax[0]+p,f.bbMax[1]+p,f.bbMax[2]+p),y=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],v=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),w=[v/y[0],v/y[1],v/y[2]];kQ(m,n,w,s.tolerance)&&this._intersectTriangles(c,h,n,o,a)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=r.get(M.POSITION);return uQ(s,null,!1,i)}createBufferWriter(){return new dut(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?Ee.TRANSPARENT_MATERIAL:Ee.OPAQUE_MATERIAL)||t===Ee.DRAPED_MATERIAL}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Depth||t.output===K.Normal||t.output===K.Highlight||t.output===K.Shadow&&this.parameters.castShadows?new uut(t):null}static getVertexBufferLayout(t){let i=ls().vec3f(M.POSITION).vec4f(M.PROFILERIGHT).vec4f(M.PROFILEUP).vec4f(M.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(i=i.vec4f(M.FEATUREVALUE)),i}}class uut extends __{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(R(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(ez,t)}}class hut extends cut{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class dut{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(M.POSITION).length}write(t,i,r,s){const n=o=>{if(i.vertexAttributes.has(o)){const a=i.vertexAttributes.get(o),l=i.indices.get(o);pt(a.size===4);const c=r.getField(o,qn);if(!c)throw new Error("unable to acquire view for "+o);EE(l,a.data,c,s)}};n(M.PROFILERIGHT),n(M.PROFILEUP),n(M.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(M.FEATUREVALUE)&&n(M.FEATUREVALUE),xU(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const put=["polyline"];class fut extends xm{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=Di(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=_(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=_(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=r3(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=o3.circle(_ut);break;case"quad":this._profile=o3.rect()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new jB(0,vut);break;case"bevel":this._extruder=new jB(0,1);break;case"miter":this._extruder=new jB(.8*Math.PI,1);break;default:this._extruder=new Qct}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new tle,this._endCap=new tle;break;case"butt":default:this._startCap=new z$(this._profile,0),this._endCap=new z$(this._profile,0,!0);break;case"square":this._startCap=new z$(this._profile,-.5),this._endCap=new z$(this._profile,.5,!0);break;case"round":{const m=s==="quad";this._startCap=new ile({profile:this._profile,flip:!1,breakNormals:m,subdivisions:ole}),this._endCap=new ile({profile:this._profile,flip:!0,breakNormals:m,subdivisions:ole});break}}const a=xr(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=yl(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,f={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?hr.None:hr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(yi(this._intrinsicSize,t,i),!G4(this._intrinsicSize[0])||!G4(this._intrinsicSize[1])))throw new j("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||pc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const m=ye(F(F({},f),this._fastUpdates.materialParameters),{size:wge(this._intrinsicSize)});this._material=new yJ(m)}else f.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new jw(f);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,put,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Bu),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=xr(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:i,transparent:r}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,u_)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!s3(this._fastUpdates,i,this._vvConvertOptions))return ln.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return ln.Fast_Update}getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const m of r)i+=m.length;const l=new Float64Array(3*i),c=new Float64Array(3*i),h=new Float64Array(3*i);let p=0;for(const m of r){s.push({index:p,numVertices:m.length});for(const y of m)l[p++]=y[0],l[p++]=y[1],l[p++]=t.hasZ?y[2]:0}let f=!0;return n.equals(o)?this._copyVertices(l,0,c,0,i):f=dr(l,n,0,c,o,0,i),o.equals(a)?this._copyVertices(c,0,h,0,i):dr(c,o,0,h,a,0,i),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:h,projectionSuccess:f,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=Gs(),p=this._context.renderCoordsHelper;C2e.spatialReference=c;const f=this.getVertexData(n);if(!f.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(f.pathVertexDataInfos.length>0){for(let m=0;m<f.pathVertexDataInfos.length;++m){const y=f.pathVertexDataInfos[m],v=y.index,w=y.numVertices;if(w<2||_(this._context.clippingExtent)&&(mr(h),Cu(h,f.vertexDataES,3*v,w),!op(h,this._context.clippingExtent)))continue;const b=[];for(let D=v;D<v+3*w;){const L=D++,z=D++,B=D++,V=new Xct;se(V.posGS,f.vertexDataGS[L],f.vertexDataGS[z],f.vertexDataGS[B]),se(V.posES,f.vertexDataES[L],f.vertexDataES[z],f.vertexDataES[B]);const Q=crt(V.posES,this._context.elevationProvider,r,p);se(kh,f.vertexDataRS[L],f.vertexDataRS[z],f.vertexDataRS[B]),p.setAltitude(kh,Q),se(V.pos,kh[0],kh[1],kh[2]),b.push(V)}const S=new Zct(b);E2e(S,this.upVectorAlignment,this._context.renderCoordsHelper);const T=new Kct(S,this._profile,this._extruder,this._startCap,this._endCap);let E=null;if(this._fastUpdates.enabled){const D=this._fastUpdates.visualVariables,L=D.size?Bg(D.size.field,t):0,z=D.color?Bg(D.color.field,t):0,B=D.opacity?Bg(D.opacity.field,t):0;E=new eut(T,L,z,B)}else{const D=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(D[0]*=sle(i.size[0],i.size[2]==="symbol-value"?this.symbolLayer.height||0:i.size[2],this.symbolLayer.width||0),D[1]*=sle(i.size[2],i.size[0]==="symbol-value"?this.symbolLayer.width||0:i.size[0],this.symbolLayer.height||0));let L=null;this._drivenProperties.color&&(L=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(L=L?[L[0],L[1],L[2],i.opacity]:[1,1,1,i.opacity]);const z=new T2e(T);z.bake(D),L&&z.bakeVertexColors(L),E=z}const{vertexAttributes:C,indices:A}=E.createGeometryData(),I=new Bct(C,A,E,c,this.upVectorAlignment,this.stencilWidth);o.push(I),a.push(this._material),l.push(E.xform)}if(o.length>0){const m={layerUid:this._context.layer.uid,graphicUid:s},y=new Sy({geometries:o,materials:a,transformations:l,metadata:m}),v=new wm(this,y,o,null,null,gut,r);return v.alignedSampledElevation=f.terrainElevation,v.needsElevationUpdates=u_(r.mode),v}}else n.paths.length!==0&&n.paths.some(m=>m.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function E2e(e,t,i){switch(t){case"world":for(const r of e.vertices)de(Wp,r.pos,e.offset),i.worldUpAtPosition(Wp,kh),r.setFrameFromUpVector(kh),r.computeRotationAxisAndAngleFromUpVector();break;case"path":de(Wp,e.vertices[0].pos,e.offset),i.worldUpAtPosition(Wp,kh),Yct(e,kh);for(const r of e.vertices){const s=Math.sign(xe(r.frame.right,r.vRight));ct(r.rotationFrame.up,r.vRight,r.vLeft),le(r.rotationFrame.up,r.rotationFrame.up,s),we(r.rotationFrame.up,r.rotationFrame.up);const n=xe(r.rotationFrame.up,r.frame.up),o=xe(r.rotationFrame.up,r.frame.right);if(le(Wp,r.frame.up,-o),le(nle,r.frame.right,n),de(Wp,Wp,nle),we(r.rotationFrame.right,Wp),Wct(r.rotationRight,r.frame,r.rotationFrame.right),ca(Wp,r.vLeft),r.rotationAngle=-s*(Math.PI-fn(xe(Wp,r.vRight))),Math.abs(r.rotationAngle)>0){const l=_9(Math.cos(.5*r.rotationAngle));fJ(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(Math.min(r.vLeftLength,r.vRightLength)*_9(Math.cos(.5*a)))}}}function sle(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function mut(e,t,i,r){let s=0;for(const n of e.vertices)cy(n.posES,i,t,r,qB),s+=qB.sampledElevation,de(kh,n.pos,e.offset),r.setAltitude(kh,qB.z),pe(n.pos,kh,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function gut(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;yut.spatialReference=r.spatialReference;for(const a of n){const l=a.geometry;if(!b2e(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;C2e.spatialReference=p,o+=mut(h,t,i,r),l.upVectorAlignment!=="world"&&E2e(h,l.upVectorAlignment,r),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const yut=Ty(0,0,0,null),C2e=Ty(0,0,0,null),kh=O(),Wp=Ri(),nle=Ri(),qB=new cP,vut=3,ole=3,_ut=10;function but(e,t,i,r,s=1){if(i.isGeographic&&r===Ge.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=Ci(i);for(let h=0;h<l;h+=3)ZX(t.typedBuffer,h,a,h,c);t=As.fromTypedArray(a)}yi(en,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,hc),en[0]=Math.min(en[0],hc[0]),en[1]=Math.min(en[1],hc[1]);const n=en[0]%s,o=en[1]%s;Ih[0]=en[0]-n,Ih[1]=en[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,hc),e.setValues(a,(hc[0]-Ih[0])/s,(hc[1]-Ih[1])/s,Ih[0]/s,Ih[1]/s)}function A2e(e,t,i,r,s=1){se(K_,1,0,0),se(e1,0,1,0),se(Kx,0,0,1),Tut(WB,t),wut(t,ale)&&xut(ale,K_,e1,Kx,i,WB),yi(en,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),yi(t1,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,hc);const c=xe(K_,hc),h=xe(e1,hc);en[0]=Math.min(en[0],c),en[1]=Math.min(en[1],h),t1[0]=Math.max(t1[0],c),t1[1]=Math.max(t1[1],h)}const n=xe(Kx,WB);ZB(Hy,en[0],en[1],n,K_,e1,Kx),ZB(i1,t1[0],en[1],n,K_,e1,Kx),ZB(r1,en[0],t1[1],n,K_,e1,Kx),pe(i1,i1,Hy),le(i1,i1,.5),pe(r1,r1,Hy),le(r1,r1,.5),de(Hy,Hy,i1),de(Hy,Hy,r1);const o=en[0]%s,a=en[1]%s;Ih[0]=en[0]-o,Ih[1]=en[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,hc),e.setValues(l,(xe(K_,hc)-Ih[0])/s,(xe(e1,hc)-Ih[1])/s,Ih[0]/s,Ih[1]/s);for(let c=0;c<3;c++)r.set(l,c,Hy[c]),r.set(l,c+3,i1[c]),r.set(l,c+6,r1[c])}}const WB=O(),hc=O(),ale=Si(),K_=O(),e1=O(),Kx=O(),en=it(),t1=it(),Ih=it(),Hy=O(),i1=O(),r1=O();function wut(e,t){const i=e.count-1;return Wge(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function xut(e,t,i,r,s,n){_(s)?(s.basisMatrixAtPosition(n,Xp),se(B$,Xp[0],Xp[1],Xp[2]),se(G$,Xp[4],Xp[5],Xp[6]),se(XB,Xp[8],Xp[9],Xp[10])):(se(B$,1,0,0),se(G$,0,1,0),se(XB,0,0,1));const o=e;xe(o,XB)<0&&le(o,o,-1),ae(r,o);const a=xe(o,G$),l=xe(o,B$);Math.abs(a)<Math.abs(l)?(Rb(t,B$,o,-l),we(t,t),ct(i,t,o),we(i,i),le(i,i,-1)):(Rb(i,G$,o,-a),we(i,i),ct(t,i,o),we(t,t))}const Xp=Ae(),B$=O(),G$=O(),XB=O();function Tut(e,t){se(j$,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,hc),de(j$,j$,hc);le(e,j$,1/(t.count-1))}const j$=O();function ZB(e,t,i,r,s,n,o){se(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}function Sut(e){const t=new Zi,i=e.output===K.Depth,r=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);Iu(t,e),t.include(Uo,{hasModelTransformation:!1,linearDepth:i}),t.include(fx,e),t.attributes.add(M.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r&&t.varyings.add("depth","float");const{vertex:s,fragment:n}=t;return i&&(t.include(x_,e),s.uniforms.add(new vi("nearFar",(o,a)=>a.camera.nearFar)),t.varyings.add("linearDepth","float")),s.code.add(x`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(vs,e),r&&t.include(zu,e),n.include(vm),n.uniforms.add(new ni("eColor",o=>o.color)),e.output===K.Highlight&&t.include(wy),n.code.add(x`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${x.float(Vo)}) {
      discard;
    }

    ${e.output===K.Alpha?x`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===K.Color?x`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===K.Highlight?x`outputHighlight();`:""};
    ${e.output===K.Depth?x`outputDepth(linearDepth);`:""};
  }
  `),t}const Eut=Object.freeze(Object.defineProperty({__proto__:null,build:Sut},Symbol.toStringTag,{value:"Module"}));class tz extends pr{initializeProgram(t){const i=tz.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}_createPipeline(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Bt({blending:r.output!==K.Color&&r.output!==K.Alpha||!r.transparent?null:s?$u:xy(t),culling:tU(r.cullFace),depthTest:{func:w_(t)},depthWrite:s||n?r.writeDepth&&Nl:null,colorWrite:ri,stencilWrite:r.hasOccludees?am:null,stencilTest:r.hasOccludees?i?d_:T_:null,polygonOffset:s||n?r.polygonOffset&&Cut:AU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}tz.shader=new rr(Eut,()=>import("./ColorMaterial.glsl.11c842f3.js"));const Cut={factor:1,units:1};class Kc extends la{constructor(){super(...arguments),this.output=K.Color,this.cullFace=hr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=gt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([H({count:K.COUNT})],Kc.prototype,"output",void 0),u([H({count:hr.COUNT})],Kc.prototype,"cullFace",void 0),u([H()],Kc.prototype,"hasSlicePlane",void 0),u([H()],Kc.prototype,"hasVertexColors",void 0),u([H()],Kc.prototype,"transparent",void 0),u([H()],Kc.prototype,"polygonOffset",void 0),u([H()],Kc.prototype,"enableOffset",void 0),u([H()],Kc.prototype,"writeDepth",void 0),u([H()],Kc.prototype,"hasOccludees",void 0),u([H({count:gt.COUNT})],Kc.prototype,"transparencyPassType",void 0),u([H()],Kc.prototype,"hasMultipassTerrain",void 0),u([H()],Kc.prototype,"cullAboveGround",void 0);class lle extends bm{constructor(t){super(t,new Rut),this.supportsEdges=!0,this._configuration=new Kc}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<EU,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(t,i,r,s,n,o,a){bU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Ee.DRAPED_MATERIAL?!0:Vw(i)===K.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ee.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new Aut(t):null}createBufferWriter(){return new BU(gSe)}}class Aut extends __{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this.ensureTechnique(tz,t)}}class Rut extends dC{constructor(){super(...arguments),this.color=Vf,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=hr.None,this.hasOccludees=!1}}var po;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(po||(po={}));const wq=.70710678118,cle=wq,Mut=.08715574274;function Out(e){const t=new Zi,i=e.hasMultipassTerrain&&(e.output===K.Color||e.output===K.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const r=e.output===K.Depth,{vertex:s,fragment:n}=t;Iu(t,e),t.include(Uo,{hasModelTransformation:!1,linearDepth:r}),t.include(fx,e),r&&(t.include(x_,e),s.uniforms.add(new vi("nearFar",(a,l)=>l.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?s.uniforms.add(new We("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(M.BOUNDINGRECT,"mat3"),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const o=e.style===po.ForwardDiagonal||e.style===po.BackwardDiagonal||e.style===po.DiagonalCross;return o&&s.code.add(x`
      const mat2 rotate45 = mat2(${x.float(wq)}, ${x.float(-cle)},
                                 ${x.float(cle)}, ${x.float(wq)});
    `),e.draped||(nm(s,e),s.uniforms.add(new We("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),s.code.add(x`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),s.code.add(x`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),s.code.add(x`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${x.float(Mut)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),s.code.add(x`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${o?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${o?" * rotate45":""};

      ${e.draped?"":x`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${x.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),s.code.add(x`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${r?x`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:x`transformPosition(proj, view, vpos);`}
    }
  `),t.include(vs,e),n.include(vm),e.draped&&n.uniforms.add(new We("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===K.Highlight&&t.include(wy),i&&t.include(zu,e),e.output!==K.Highlight&&(n.code.add(x`
      const float lineWidth = ${x.float(e.lineWidth)};
      const float spacing = ${x.float(e.patternSpacing)};
      const float spacingINV = ${x.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||n.code.add(x`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new ni("uColor",a=>a.color)),n.code.add(x`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==K.Highlight?x`color.a *= ${Put(e)};`:""}

      if (color.a < ${x.float(Vo)}) {
        discard;
      }

      ${e.output===K.Alpha?x`gl_FragColor = vec4(color.a);`:""}

      ${e.output===K.Color?x`gl_FragColor = color; ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===K.Highlight?x`outputHighlight();`:""}
      ${e.output===K.Depth?x`outputDepth(linearDepth);`:""};
    }
  `),t}function Put(e){function t(i){return e.draped?x`coverage(vuv.${i}, texelSize)`:x`sample(vuv.${i})`}switch(e.style){case po.ForwardDiagonal:case po.Horizontal:return t("y");case po.BackwardDiagonal:case po.Vertical:return t("x");case po.DiagonalCross:case po.Cross:return x`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const Iut=Object.freeze(Object.defineProperty({__proto__:null,build:Out},Symbol.toStringTag,{value:"Module"}));class iz extends pr{initializeProgram(t){const i=iz.shader.get().build(this.configuration);return new sr(t.rctx,i,R2e)}_setPipelineState(t,i){const r=this.configuration,s=t===gt.NONE,n=t===gt.FrontFace;return Bt({blending:r.output===K.Color||r.output===K.Alpha?s?$u:xy(t):null,culling:tU(r.cullFace),depthTest:{func:w_(t)},depthWrite:s?r.writeDepth&&Nl:SU(t),colorWrite:ri,stencilWrite:r.hasOccludees?am:null,stencilTest:r.hasOccludees?i?d_:T_:null,polygonOffset:s||n?r.polygonOffset&&$ut:AU(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}iz.shader=new rr(Iut,()=>import("./Pattern.glsl.e48cb60c.js"));const $ut={factor:1,units:1};class Oa extends la{constructor(){super(...arguments),this.output=K.Color,this.cullFace=hr.None,this.transparencyPassType=gt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([H({count:K.COUNT})],Oa.prototype,"output",void 0),u([H({count:hr.COUNT})],Oa.prototype,"cullFace",void 0),u([H({count:po.COUNT})],Oa.prototype,"style",void 0),u([H({count:gt.COUNT})],Oa.prototype,"transparencyPassType",void 0),u([H()],Oa.prototype,"hasSlicePlane",void 0),u([H()],Oa.prototype,"hasVertexColors",void 0),u([H()],Oa.prototype,"polygonOffset",void 0),u([H()],Oa.prototype,"writeDepth",void 0),u([H()],Oa.prototype,"hasOccludees",void 0),u([H()],Oa.prototype,"patternSpacing",void 0),u([H()],Oa.prototype,"lineWidth",void 0),u([H()],Oa.prototype,"enableOffset",void 0),u([H()],Oa.prototype,"draped",void 0),u([H()],Oa.prototype,"hasMultipassTerrain",void 0),u([H()],Oa.prototype,"cullAboveGround",void 0);const R2e=new Map([[M.POSITION,0],[M.COLOR,3],[M.UVMAPSPACE,4],[M.BOUNDINGRECT,5]]);class vJ extends bm{constructor(t){super(t,new Nut),this.supportsEdges=!0,this._vertexAttributeLocations=R2e,this.techniqueConfig=new Oa}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<EU,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a){bU(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Ee.DRAPED_MATERIAL?!0:Vw(i)===K.Highlight?t===Ee.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Ee.TRANSPARENT_MATERIAL:Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===K.Color||t.output===K.Alpha||t.output===K.Highlight||t.output===K.Depth&&this.parameters.writeLinearDepth?new Lut(t):null}createBufferWriter(){const t=ls().vec3f(M.POSITION).vec4u8(M.COLOR).vec4f(M.UVMAPSPACE);return this.parameters.draped||t.mat3f(M.BOUNDINGRECT),new Dut(t)}}class Lut extends __{_updateParameters(t){return this.ensureTechnique(iz,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==K.Color&&this._output!==K.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class Dut extends BU{write(t,i,r,s){for(const n of this.vertexBufferLayout.fieldNames){const o=i.vertexAttributes.get(n),a=i.indices.get(n);if(o&&a)switch(n){case M.POSITION:{pt(o.size===3);const l=r.getField(n,Xi);l&&wU(a,o.data,t.transformation,l,s);break}case M.COLOR:{pt(o.size===3||o.size===4);const l=r.getField(n,Fl);l&&k4(a,o.data,o.size,l,s);break}case M.UVMAPSPACE:{pt(o.size===4);const l=r.getField(n,qn);l&&EE(a,o.data,l,s);break}case M.BOUNDINGRECT:{pt(o.size===9);const l=r.getField(n,Rp);l&&this.writeBoundingRect(a,o.data,t.transformation,l,s);break}}}}writeBoundingRect(t,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],f=i[p],m=i[p+1],y=i[p+2];a[n]=o[0]*f+o[4]*m+o[8]*y+o[12],a[n+1]=o[1]*f+o[5]*m+o[9]*y+o[13],a[n+2]=o[2]*f+o[6]*m+o[10]*y+o[14];for(let v=3;v<9;++v)a[n+v]=i[p+v];n+=l}}}class Nut extends dC{constructor(){super(...arguments),this.color=bi(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=hr.None,this.hasOccludees=!1,this.style=po.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Fut(e,t,i){return Uut(kut(e),t,i)}function kut(e){return e&&e.pattern||null}function Uut(e,t,i){return _(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=bi(0,0,0,0),t.transparent=!0),new lle(t)):(t.style=zut(e.style),t.draped=i.isDraped,new vJ(t)):new lle(t)}function zut(e){switch(e){case"horizontal":return po.Horizontal;case"vertical":return po.Vertical;case"cross":return po.Cross;case"forward-diagonal":return po.ForwardDiagonal;case"backward-diagonal":return po.BackwardDiagonal;case"diagonal-cross":return po.DiagonalCross;default:return}}function Vut(e){return e.material instanceof vJ&&!e.material.parameters.draped}function But(e,t){if(Vut(e)){const i=e.geometry.vertexAttributes,r=i.get(M.POSITION).data,s=i.get(M.UVMAPSPACE).data,n=i.get(M.BOUNDINGRECT).data;A2e(qn.fromTypedArray(s),As.fromTypedArray(r),t,t_.fromTypedArray(n))}}function Gut(e,t,i,r){const s=OTe(e,t,i,r),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)But(n[o],r);return s}const jut=["polyline","polygon","extent"];class rz extends xm{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(_(this._material))return;const t=xr(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=Fut(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof vJ,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(_(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=ZSe(t.pattern);return new BS({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:fq(t.patternCap||"butt")})};this._outlineMaterial=i(gi(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return _(t)&&t.size&&t.size>0&&_(t.color)&&(R(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,jut,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new Bu);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(_(this._material)){const t=this._material.parameters.color,i=xr(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(_(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=lP(rz.elevationModeChangeTypes,r,s);if(n!==Qr.UPDATE)return n;const o=td(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){if(_(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),_(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=t3(t.geometry);if(R(s))return null;gn.renderData=cJ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),gn.color=i;const n=gn.renderData.position.length/3;if(this._needsUV&&(gn.uvMapSpace=new Float32Array(4*n),gn.boundingRect=new Float64Array(9*n)),gn.outNum=0,gn.outGeometries=[],gn.outTransforms=[],gn.outMaterials=[],this._createAs3DShapeFill(gn),this._hasOutline&&this._createAs3DShapeOutline(gn),this._logGeometryCreationWarnings(gn.renderData,s.rings,"rings","FillSymbol3DLayer"),gn.outNum===0)return null;this._needsUV&&A2e(qn.fromTypedArray(gn.uvMapSpace),As.fromTypedArray(gn.renderData.position),this._context.renderCoordsHelper,t_.fromTypedArray(gn.boundingRect));const o=new Sy({geometries:gn.outGeometries,materials:gn.outMaterials,transformations:gn.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),a=new wm(this,o,gn.outGeometries,null,null,Gut,r);return a.alignedSampledElevation=gn.renderData.sampledElevation,a.needsElevationUpdates=td(r.mode),a}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPosition:s,holeIndices:n,index:o,count:a}of i){if(_(this._context.clippingExtent)&&(mr(_a),Cu(_a,s),!op(_a,this._context.clippingExtent)))continue;const l=RE(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=yae({indices:c,attributeData:{position:r,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null}});t.outGeometries.push(h),t.outMaterials.push(this._material),t.outTransforms.push(hn),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:s,position:n}=i[r];if(_(this._context.clippingExtent)&&(mr(_a),Cu(_a,s),!op(_a,this._context.clippingExtent)))continue;const o=pq({overlayInfo:null,removeDuplicateStartEnd:Hw.REMOVE,attributeData:{position:n,mapPosition:s}}),a=o.vertexAttributes.get(M.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(hn),t.outNum++}}_createAsOverlay(t,i){const r=t3(t.geometry);if(R(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,_(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Co.renderData=SSe(r,this._context.overlaySR),Co.color=i;const s=Co.renderData.position.length/3;return this._needsUV&&(Co.uvMapSpace=new Float32Array(4*s)),Co.outNum=0,Co.outGeometries=[],Co.outBoundingBox=mr(),Co.layerUid=this._context.layer.uid,Co.graphicsUid=t.uid,this._createAsOverlayFill(Co),this._hasOutline&&this._createAsOverlayOutline(Co),this._logGeometryCreationWarnings(Co.renderData,r.rings,"rings","FillSymbol3DLayer"),Co.outNum===0?null:(this._needsUV&&but(qn.fromTypedArray(Co.uvMapSpace),As.fromTypedArray(Co.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Co.outNum>0?new HU(this,Co.outGeometries,Co.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){if(mr(_a),Cu(_a,r),!op(_a,this._context.clippingExtent))continue;const a=RE(r,s,3);if(a.length===0)continue;U2(t.outBoundingBox,_a);const l=new Uint32Array(a),c=yae({indices:l,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),h=new IE(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),p=_a;Ji(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),t.outGeometries.push(h),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(mr(_a),Cu(_a,s),!op(_a,this._context.clippingExtent))continue;U2(t.outBoundingBox,_a);const n=pq({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:Hw.REMOVE,attributeData:{position:s}}),o=new IE(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=_a;Ji(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o),t.outNum++}}_getOutlineOpacity(){const t=xr(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(_(t)?t.a:0)}_getOutlineColor(){const t=xr(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return RM(_(t)?Pe.toUnitRGB(t):null,i)}test(){return ye(F({},super.test()),{createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)})}}rz.elevationModeChangeTypes={definedChanged:Qr.RECREATE,staysOnTheGround:Qr.NONE,onTheGroundChanged:Qr.RECREATE};const _a=Gs(),gn={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Co={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Hut=fe.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class sz{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i=1){const r=xr(t,"material","color"),s=gu(r,Vf,Pe.toUnitRGBA),n=gu(t.size,12,gi),o=t.lineHeight,a=_(t.background)?Pe.toUnitRGBA(t.background.color):Vf,l={family:gu(t.font,"sans-serif",m=>m.family),decoration:gu(t.font,"none",m=>m.decoration),weight:gu(t.font,"normal",m=>m.weight),style:gu(t.font,"normal",m=>m.style)},c=t.halo,h=_(c)&&_(c.color)&&c.size>0?{size:gi(c.size),color:Pe.toUnitRGBA(c.color)}:{size:0,color:Vf},p=new sz({color:s,size:n,background:{color:a,padding:_(t.background)?[.65*n,.5*n]:[0,0],borderRadius:_(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),f=p.fontString(n);try{await document.fonts.load(f)}catch{Hut.warnOnce(`Failed to preload font '${f}'. Some text symbology may be rendered using the default browser font.`)}return p}}class qut{constructor(t,i,r){this._renderer=new zSe(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=gN(Wut,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new Ns(t,{wrap:{s:wt.CLAMP_TO_EDGE,t:wt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:Uv.PAD})}}const Wut={canvas:null},Xut=[0,0,1];class Zut extends xm{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=RU(this.symbolLayer.size);if(t)throw new j("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await sz.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=KO(i.geometry);if(R(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(R(s)||s==="")return null;const n=EX(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(_(n)&&!Efe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=ye(F({},Jut),{verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:_ot(this.symbolLayer.verticalAlignment)});return this._createAs3DShape(i,r,s,o)}createLabel(t,i,r,s){const n=t.graphic,o=KO(n.geometry);if(R(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return ule(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),Qr.UPDATE}slicePlaneEnabledChanged(t,i){return ule(t,i,r=>{for(const s of r.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=td(i.elevationContext.mode)||i.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Qut}_createAs3DShape(t,i,r,s,n,o){const a=this.setGraphicElevationContext(t,new Bu,s.elevationOffset),l=xr(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(R(o)){const V=BSe(s.horizontalPlacement);h=new qut(r,V,this._textRenderParameters);let Q=null;p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{_(Q)&&Q.release()});const Z=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(R(Z)||Vu(Z))return p.release(),null;Q=Z}const f=Yut(h,s),m={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(_(p)&&(m.textureId=p.texture.id),_(o)&&(m.textureId=o.id),_(s.verticalOffset)){const{screenLength:V,minWorldLength:Q,maxWorldLength:Z}=s.verticalOffset;m.verticalOffset={screenLength:gi(V),minWorldLength:Q||0,maxWorldLength:Z!=null?Z:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:V,screenSizePerspectiveSettingsLabels:Q}=this._context.sharedResources;m.screenSizePerspective=Q.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=V}let y;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,_(n)){const V=JSON.stringify(m);y=n.get(V),R(y)&&(y=new CE(m),n.add(V,y))}else y=new CE(m);const v=[y],w=s.translation,b=_(h)?[h.displayWidth,h.displayHeight]:[0,0],S=s.centerOffset,T=Xut,E=[0,0],C=[nc.createPointGeometry(T,w,null,b,S,E,null)],A=this._context.layer.uid,I=tJ(this._context,i,C,v,a,A,c);if(I===null)return null;const D=new wm(this,I.object,C,R(n)?v:null,p,QO,a);D.alignedSampledElevation=I.sampledElevation,D.needsElevationUpdates=td(a.mode)||a.mode==="absolute-height";const{displayWidth:L,displayHeight:z}=_(h)?h:s;D.getScreenSize=(V=it())=>(V[0]=L,V[1]=z,V);const B={labelText:r,elevationOffset:s.elevationOffset};return D.metadata=B,JO(D,i,this._context.elevationProvider),D}}function ule(e,t,i){e&&e.forEach(r=>{const s=t(r);_(s)&&i(s,r.graphic)})}function Yut(e,t){if(t.verticalPlacement==="baseline"){const r=got[t.horizontalPlacement],s=_(e)?e.baselineAnchorY:0;return Di(r,s)}const i=vot(t.horizontalPlacement,t.verticalPlacement);return yN[i]}const Qut={mode:"relative-to-ground",offset:0},Jut={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},Kut={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},eht=["polyline","polygon","extent"];class Mf extends xm{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,eht,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new Bu);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(_(this._material))return;const t=new vSe,i=this.symbolLayer.color;_(i)&&(t.color=Pe.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=_(this.symbolLayer.waveDirection)?Mf.headingVectorFromAngle(this.symbolLayer.waveDirection):Di(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=Kut[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new ySe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(R(this._material))return!0;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=lP(Mf.elevationModeChangeTypes,r,s);if(n!==Qr.UPDATE)return n;const o=td(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return _(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=t3(t.geometry);if(R(s))return null;Ko.renderData=cJ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);const n=Ko.renderData.position.length/3;if(Ko.uvCoords=new Float64Array(2*n),Ko.outNum=0,Ko.outGeometries=[],Ko.outTransforms=[],Ko.outMaterials=[],this._create3DShapeGeometries(Ko),this._logGeometryCreationWarnings(Ko.renderData,s.rings,"rings","WaterSymbol3DLayer"),Ko.outNum===0)return null;this._createUVCoordsFromVertices(Ko.uvCoords,Ko.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new Sy({geometries:Ko.outGeometries,materials:Ko.outMaterials,transformations:Ko.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),a=new wm(this,o,Ko.outGeometries,null,null,OTe,i);return a.alignedSampledElevation=Ko.renderData.sampledElevation,a.needsElevationUpdates=td(i.mode),a}_createUVCoordsFromVertices(t,i,r,s){const n=$c(s);Lu(qy);for(let l=0;l<r;l++)yi(hle,i[3*l+0],i[3*l+1]),KS(qy,hle);M3(qy,qy,n);const o=qy[0]%Mf.unitSizeOfTexture,a=qy[1]%Mf.unitSizeOfTexture;H$[0]=qy[0]-o,H$[1]=qy[1]-a;for(let l=0;l<r;l++)t[2*l+0]=(i[3*l+0]*n-H$[0])/Mf.unitSizeOfTexture,t[2*l+1]=(i[3*l+1]*n-H$[1])/Mf.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of i){if(_(this._context.clippingExtent)&&(mr(Wy),Cu(Wy,a),!op(Wy,this._context.clippingExtent)))continue;const c=RE(a,l,3);if(c.length===0)continue;const h=new Uint32Array(c),p=new Float64Array(r.buffer,2*n*r.BYTES_PER_ELEMENT,2*s),f=vae({indices:h,attributeData:{position:o,uv0:p,mapPosition:a}});t.outGeometries.push(f),t.outMaterials.push(this._material),t.outTransforms.push(hn),t.outNum++}}_createAsOverlay(t){const i=t3(t.geometry);if(R(i))return null;this._material.renderPriority=this._renderPriority,ba.renderData=SSe(i,this._context.overlaySR);const r=ba.renderData.position.length/3;return ba.uvCoords=new Float64Array(2*r),ba.outNum=0,ba.outGeometries=[],ba.outBoundingBox=mr(),ba.layerUid=this._context.layer.uid,ba.graphicsUid=t.uid,this._createAsOverlayWater(ba),this._logGeometryCreationWarnings(ba.renderData,i.rings,"rings","WaterSymbol3DLayer"),ba.outNum===0?null:(this._createUVCoordsFromVertices(ba.uvCoords,ba.renderData.position,r,this._context.overlaySR),ba.outNum>0?new HU(this,ba.outGeometries,ba.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(mr(Wy),Cu(Wy,s),!op(Wy,this._context.clippingExtent))continue;U2(t.outBoundingBox,Wy);const l=RE(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=new Float64Array(i.buffer,2*o*i.BYTES_PER_ELEMENT,2*a),p=vae({indices:c,attributeData:{position:s,uv0:h}}),f=new IE(p,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),m=Wy;Ji(f.boundingSphere,.5*(m[0]+m[3]),.5*(m[1]+m[4]),0,.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]))),t.outGeometries.push(f),t.outNum++}}static headingVectorFromAngle(t){const i=it(),r=N5(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return ye(F({},super.test()),{create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()})}}Mf.unitSizeOfTexture=100,Mf.elevationModeChangeTypes={definedChanged:Qr.RECREATE,staysOnTheGround:Qr.NONE,onTheGroundChanged:Qr.RECREATE};const H$=it(),qy=kt(),hle=it(),Wy=Gs(),Ko={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},ba={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},tht=fe.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function iht(e,t,i,r){const s=dle[e.type]&&dle[e.type][t.type]||rht[t.type];return s?new s(e,t,i,r):(tht.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const rht={icon:n3,object:wct,line:XU,path:fut,fill:rz,extrude:rot,text:Zut,water:Mf},dle={"mesh-3d":{fill:elt}};class sht extends QQ{constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let i=0;i<t.symbolLayers.length;i++){const r=this.symbolLayers[i];R(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[i])}}get symbol(){return this._symbol}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;q$.renderPriority=1-(1+n)/r,q$.renderPriorityStep=1/r,q$.ignoreDrivers=o._ignoreDrivers;const a=iht(this.symbol,o,this._context,q$);s.push(RW(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await Sk(this.symbolLayers,async(n,o)=>{if(_(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,fi(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return _(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=_(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new est(r,i||this,s,t.layer,n)}get complexity(){return eJ(this.symbolLayers.map(t=>xr(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof wm?l:null};if(_(n)&&!n.globalPropertyChanged(t,i,o))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==mu.LOADED?ln.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==ln.Recreate_Symbol&&_(s)?Math.min(r,s.applyRendererDiff(t,i)):r,ln.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===mu.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(R(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.graphics[n];_(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(R(s))continue;const n=t.graphics[r];if(R(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(R(r))continue;const s=t.graphics[i];_(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{R(s)||(s.loadStatus===mu.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)_(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const q$={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class nht extends QQ{constructor(t,i,r){super(i),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this.convert(i),_(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return _(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:KQ}globalPropertyChanged(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return _(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):ln.Recreate_Symbol}prepareSymbolPatch(t){_(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!_(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return _(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){_(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function _J(e){return e instanceof nht?e.graphics3DSymbol:e instanceof sht?e:null}const a3=fe.getLogger("esri.views.3d.layers.graphics.labelPlacement");function oht(e){const t=mht(e);if(R(t))return null;const i=aht(e,t);if(R(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return cht({anchor:r,verticalOffset:t.verticalOffset,screenOffset:it(),centerOffset:bi(0,0,0,-1),centerOffsetUnits:"world",translation:O(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function aht(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=pp[i],s=r||t5(e);return i&&!r&&a3.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),lht(s,e)}function bJ(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=_J(t);return _(i)?i.symbol.symbolLayers.getItemAt(0):null}function lht(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(R(i))return null;if(_(t.disablePlacement))return t.labelClass.labelPlacement?(a3.warnOncePerTick(ple(e.placement,t.disablePlacement.logEntityDescription)),t5(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return a3.warnOncePerTick(ple(e.placement,`'${r}' geometries`)),t5(t);break;case"point":case"mesh":return e}return e}function ple(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function t5(e){const t=e.graphics3DGraphic.graphic.geometry;if(R(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=bJ(e);return _(i)&&i.type==="extrude"?pp["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return pp["above-center"];default:return}}function cht(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(R(r))return null;switch(r.type){case"point":hht(e,t,i);break;case"polygon":uht(e,t,i);break;case"mesh":wJ(e,t,i.graphics3DGraphic.graphics[0])}return e}function uht(e,t,i){const r=bJ(i);if(!R(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.graphics[0];_(s)?(s.getBoundingBoxObjectSpace(DM),np(DM,e.translation),e.translation[2]=m_(DM)/2):se(e.translation,0,0,0),wJ(e,t,s);break}}}function hht(e,t,i){const r=bJ(i);if(R(r))return;const s=i.graphics3DGraphic.graphics[0];switch(_(s)?s.getCenterObjectSpace(e.translation):se(e.translation,0,0,0),r.type){case"icon":case"text":dht(e,t,i,s);break;case"object":wJ(e,t,s)}}function dht(e,t,i,r){const{graphics3DGraphic:s}=i,n=_(r)?r.getScreenSize():null;if(!s.isDraped&&_(n)){const o=pht(i);uA[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),uA[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=uA[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=uA[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=uA[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(pp[i.labelClass.labelPlacement]&&a3.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function pht(e,t=ght){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=_(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof CE){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function wJ(e,t,i){const r=_(i)?i.getBoundingBoxObjectSpace(DM):DM,s=Ue(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=Me(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function fht(e){return e==="above-center"}function mht(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=_J(r.graphics3DSymbol),n=rn(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=pp[t]||t5(e);return _(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:fle(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(R(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?fht(o.placement)?{placement:"above-center",verticalOffset:fle(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(a3.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function fle(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const pp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},mle={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in mle){const t=mle[e],i=pp[e];t.forEach(r=>{pp[r]=i})}Object.freeze&&(Object.freeze(pp),Object.keys(pp).forEach(e=>{Object.freeze(pp[e]),Object.freeze(pp[e].normalizedOffset)}));const uA=[0,0],ght=[0,0],DM=Gs();class gle{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const YB=512,QB=4096,yht=.85,vht=.95;let FR=class extends Se{constructor(e){super(e),this.type=Mp.Texture,this.id=Cl(),this.events=new as,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=Ze(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,flipped:!0,samplingMode:Ke.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return _(this._glTexture)||(this._glTexture=new nt(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(yt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=cn(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=Ze(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",YB.toString()),e.setAttribute("height",YB.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=YB){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=D2(i),i=Math.min(i,QB),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,_(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=hA,e.cursor.y=hA+yle,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(M.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+hA,a=n+hA+yle;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const l=this._getExpectedAtlasUsage(),c=l>yht&&i.size.width<QB;return c&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!c&&l>vht&&i.size.width===QB?(this._processRemovals(),GS.OK):(this._repack(),GS.REPACK)}i.cursor.x=hA,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return GS.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(M.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(M.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],i.geometryVertexAttrsUpdated(i.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(sn(this.elementsToAddOrUpdate,(s,n)=>{const o=this.elements.get(n);if(o&&o.rendered){const a=this.stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this.elements.get(n);c.get(M.UV0).data=new Float32Array(h.placement.uvMinMax),c.get(M.SIZE).data=new Float32Array([h.placement.size.displayWidth,h.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===GS.REPACK&&(i=!0,!0)}),i)return void this.runTask(nC,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),sn(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&_(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&bst.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this.elements.clear();for(const{element:i,key:r}of e)this.elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([d({constructOnly:!0})],FR.prototype,"view",void 0),u([d({type:Boolean})],FR.prototype,"updating",void 0),FR=u([P("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],FR);const hA=2,yle=2;var GS;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(GS||(GS={}));const vle=fe.getLogger("esri.views.3d.layers.graphics.Labeler");let Q1=class extends Se{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Nt,this._handles.add([ie(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),ie(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(yt.LABELER,this)]),this._textTextureAtlas=new FR({view:this.view}),this._hudMaterialCollection=new gle(this.view._stage),this._calloutMaterialCollection=new gle(this.view._stage)}dispose(){this._handles=lt(this._handles),this._textTextureAtlas=Ze(this._textTextureAtlas),this._hudMaterialCollection=Ze(this._hudMaterialCollection),this._calloutMaterialCollection=Ze(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,i)=>{this._labels.set(i,t),t.graphics3DGraphic.setVisibilityFlag(xu.USER_SETTING,!0,ho.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,i)=>{t.graphics3DGraphic.setVisibilityFlag(xu.USER_SETTING,!1,ho.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];_(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(_ht(t)){if(!_le(t)){if(bht(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),JB(t)){this._dirty=!0;continue}if(!_le(t))continue}sn(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),fi(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await Sk(s,async(a,l)=>{const c=a.symbol,h=_J(i.getOrCreateGraphics3DSymbol(c));if(R(h))return void vle.error("Failed to create Graphics3DSymbol for label");await h.load(),fi(t);let p=null;EX(c)&&c.hasVisibleCallout()&&(p=Yrt(c,i.symbolCreationContext),await p.load(),fi(t));const f=await ku(CTe(a,e.layer.fieldsIndex,this.view.spatialReference));if(fi(t),f.ok===!0){const m=await this._createTextRenderParameters(h.symbol);fi(t),n[l]={labelClass:a,labelFunction:f.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:m}}else vle.error(`Label expression failed to evaluate: ${f.error}`),o=!0}),fi(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Jr(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?sz.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:Oae(i.anchor),verticalPlacement:yot(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:Wi.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return Xy.graphic=t,Xy.renderingInfo=null,Xy.layer=r,s.createLabel(Xy,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return Xy.graphic=e,Xy.renderingInfo=n,Xy.layer=s,i.createGraphics3DGraphic(Xy)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=r.layer,l=R7(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=i.textRenderers[h],f=i.labelPlacements[h];if(R(p)||R(f))continue;const m=s[h],y=m.graphics3DSymbol,v=y.symbol&&y.symbol.type==="label-3d"?y.symbol:null,w=y.symbolLayers[0];if(!w)continue;w.setElevationInfoOverride(r.elevationInfoOverride);const b=this._createTextSymbolGraphic(p,o,f,a,w);if(!b)return!1;b._labelClass=m.labelClass,b._labelIndex=h,t.addLabelGraphic(b,c,r.stageLayer),t.setVisibilityFlag(xu.USER_SETTING,l,ho.LABEL),t.clearVisibilityFlag(xu.SCALE_RANGE,ho.LABEL),t.setVisibilityFlag(xu.DECONFLICTION,!1,ho.LABEL),n=!0;const S=m.graphics3DCalloutSymbolLayer;if(S&&f.hasLabelVerticalOffset){S.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createLineCalloutGraphic(o,v,S,f,a);_(T)&&(m.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(T,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const b=a.needsHydrationToEvaluate()?ert(s,i.layer):s;l=a.evaluate(b)}catch{l=null}else l=a.evaluate(s);if(R(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,f=o.labelClass,m=i.disablePlacement,y=oht({graphics3DGraphic:p,labelSymbol:h,labelClass:f,disablePlacement:m});if(R(y))continue;const v=Oae(y.anchor),w=BSe(v);t.textRenderers[n]=new zSe(l,w,o.textRenderParameters),t.labelPlacements[n]=y}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.labels.get(i);r&&(this._removeGraphic(e,r.graphics3DGraphic),this._addGraphic(e,r.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;r.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new YTe({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>R7(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>JB(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(JB(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function _ht(e){return e.active&&R7(e.layer)}function JB(e){return e.labelClassPromise&&!!e.labelClassAbortController}function _le(e){return e.labelClassContexts&&e.labelClassContexts.length}function bht(e){return e.labelClassContexts===null}u([d({constructOnly:!0})],Q1.prototype,"view",void 0),u([d({constructOnly:!0})],Q1.prototype,"deconflictor",void 0),u([d()],Q1.prototype,"_textTextureAtlas",void 0),u([d({type:Boolean,readOnly:!0})],Q1.prototype,"updating",null),Q1=u([P("esri.views.3d.layers.graphics.Labeler")],Q1);const Xy=new Jrt(null,null,null);class wht{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new Nt}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>d2e(new u2e(n.streamDataRequester),t,n,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`;return this._fromCache(this.wosrCache,r,s=>p2e(t,s),i)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,i,r,s){return new Promise((n,o)=>{if(nn(s))return void o(mi());const a=ha(s,()=>{this._remove(t,i),o(mi())}),l=t.get(i);if(l)return this.evictHandles.remove(i),l.refCount++,void l.item.then(n,o);const c=new AbortController,h=ye(F({},s),{signal:c.signal}),p={refCount:1,abortController:c,item:r(h).then(f=>(p.abortController=null,f.remove=()=>this._remove(t,i),f))};t.set(i,p),p.item.then(f=>{_(a)&&a.remove(),n(f)},f=>{_(a)&&a.remove(),o(f)})})}_remove(t,i){const r=t.get(i);r&&(r.refCount--,r.refCount===0&&this.evictHandles.add(LRe(()=>{t.delete(i),_(r.abortController)&&r.abortController.abort()},Tht),i))}}const xht=1e4;let Tht=xht;class ip{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=kt(),this.resolution=0,this.loadPriority=0,this.measures={visibility:ra.VISIBLE_ON_SURFACE,screenRect:kt(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=ip.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new ip(i,r,s,this.tilingScheme),new ip(i,r+1,s,this.tilingScheme),new ip(i,r,s+1,this.tilingScheme),new ip(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,Jg(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var ra;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(ra||(ra={}));class lv{constructor(t){this.renderCoordsHelper=t,this.frustum=HO(),this._points=Iwe(),this.lines=new Array(12),this._origin=O(),this._direction=O(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:O(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){$we(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),ae(this._origin,t.eye),ae(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)ae(this._points[i],t[i]);Lwe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return Cv(this.frustum,t)}intersectsRay(t){return MJe(this.frustum,t)}intersectsLineSegment(t,i){return OJe(this.frustum,t,i)}intersectsPoint(t){return Dwe(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;KB(this.lines[i],t[i],t[r]),KB(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),KB(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function KB(e,t,i){e.origin=t,e.endpoint=i,uy(e.direction,t,i)}lv.planePointIndices=IJe,lv.nearFarLineIndices=[[Je.NEAR_BOTTOM_LEFT,Je.FAR_BOTTOM_LEFT],[Je.NEAR_BOTTOM_RIGHT,Je.FAR_BOTTOM_RIGHT],[Je.NEAR_TOP_RIGHT,Je.FAR_TOP_RIGHT],[Je.NEAR_TOP_LEFT,Je.FAR_TOP_LEFT]];const M2e=.5*Math.PI,Sht=M2e/Math.PI*180;class Eht{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:O(),direction:O()};for(let i=0;i<4;i++)this.extent[i]={origin:O(),direction:O(),cap:{next:null,direction:O()}},this.planes[i]=Si();this.planes[ar.NEAR]=Si(),this.planes[ar.FAR]=Si(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,i,r,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,i,r),de(this.center.origin,n[0].origin,n[2].origin),le(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||le(this.center.direction,this.center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this.renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,uy(a.cap.direction,a.origin,l.origin),cO(a.direction,a.cap.direction,a.origin,this.planes[o]),s||le(a.direction,a.direction,-1)}cO(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[ar.NEAR]),s?E7(this.planes[ar.NEAR],this.planes[ar.FAR]):(fk(this.planes[ar.FAR],this.planes[ar.NEAR]),E7(this.planes[ar.NEAR],this.planes[ar.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=i,this.minGlobalAltitude=.9*Ci(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===Ge.Global){const n=this.maxSpanSpatialReference.isGeographic?Sht:M2e*i;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(r||!t.intersectsRay(Fu(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const o=this.extent[n];if(!r&&t.intersectsRay(Fu(o.origin,o.direction))||t.intersectsLineSegment(ew(o.origin,o.cap.next,Aht),o.cap.direction))return!0}const s=r?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(oQe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){iX(t,md),md[2]=r,Nu(i,md,e8,this.renderCoordsHelper.spatialReference),_s(ble,e8),mr(Gl);for(const{x0:n,x1:o,y0:a,y1:l}of Cht)for(let c=0;c<5;c++){const h=c/4;md[0]=Yt(t[n],t[o],h),md[1]=Yt(t[a],t[l],h),md[2]=r,un(md,i,md,this.renderCoordsHelper.spatialReference),ze(md,md,ble),Zf(Gl,md)}se(this.extent[0].origin,Gl[0],Gl[1],Gl[2]),se(this.extent[1].origin,Gl[3],Gl[1],Gl[2]),se(this.extent[2].origin,Gl[3],Gl[4],Gl[2]),se(this.extent[3].origin,Gl[0],Gl[4],Gl[2]);for(let n=0;n<4;++n)ze(this.extent[n].origin,this.extent[n].origin,e8)}_toRenderBoundingExtentLocal(t,i,r){ck(t,i,$m,this.renderCoordsHelper.spatialReference),se(this.extent[0].origin,$m[0],$m[1],r),se(this.extent[1].origin,$m[2],$m[1],r),se(this.extent[2].origin,$m[2],$m[3],r),se(this.extent[3].origin,$m[0],$m[3],r)}_toRenderBoundingExtent(t,i,r){switch(this.renderCoordsHelper.viewingMode){case Ge.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case Ge.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(lr(t.planes[ar.NEAR],this.center.origin)<0&&xe(this.center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this.extent[i];if(lr(t.planes[ar.NEAR],r.origin)<0&&xe(r.direction,t.direction)<0)return!0}return!1}}const Cht=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],md=O(),e8=Ae(),ble=Ae(),Gl=Gs(),$m=kt(),Aht=fm();class Rht{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new lv(t),this.extendedFrustum=new lv(t),this.intersector=new Eht({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,i){this.surfaceElevation=i,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>i,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return ra.INVISIBLE;const i=this.renderCoordsHelper.viewingMode===Ge.Global&&t.lij[0]>=Mht&&t.lij[0]<Oht,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==ra.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=lv.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];pe(Bc,l,a),le(Bc,Bc,Iht),de(r[o],a,Bc)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=ra.INVISIBLE;const r=this.cache.get(t.id);if(r!=null)return r;const s=Sle.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==ra.INVISIBLE&&(i=o,o===ra.VISIBLE_ON_SURFACE))break}return Sle.release(s),this.cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this.cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===Ge.Global&&t.lij[0]<Pht?this._calculateSingleTileVisibilitySided(t,!1)===ra.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,i){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,i);const r=Ci(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?ra.VISIBLE_ON_SURFACE:ra.VISIBLE_WHEN_EXTENDED:ra.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,Bc);this.aboveGround||ca(i,i);const r=fn(-xe(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this.renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,Bc),a){case Je.FAR_BOTTOM_LEFT:case Je.FAR_TOP_LEFT:case Je.NEAR_BOTTOM_LEFT:case Je.NEAR_TOP_LEFT:C7(this.extendedFrustum.planes[ar.LEFT],Bc,Bc);break;case Je.FAR_BOTTOM_RIGHT:case Je.FAR_TOP_RIGHT:case Je.NEAR_BOTTOM_RIGHT:case Je.NEAR_TOP_RIGHT:C7(this.extendedFrustum.planes[ar.RIGHT],Bc,Bc)}le(Bc,Bc,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(Fu(l,Bc),s.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(n),na(n[Je.NEAR_BOTTOM_LEFT],n[Je.NEAR_BOTTOM_RIGHT],n[Je.NEAR_TOP_RIGHT],xle),na(n[Je.NEAR_BOTTOM_RIGHT],n[Je.NEAR_TOP_RIGHT],n[Je.NEAR_TOP_LEFT],Tle),xe(xle,Tle)<0){const o=this.extendedFrustum.mutablePoints;this.aboveGround?[o[Je.NEAR_BOTTOM_LEFT],o[Je.NEAR_BOTTOM_RIGHT]]=[o[Je.NEAR_BOTTOM_RIGHT],o[Je.NEAR_BOTTOM_LEFT]]:[o[Je.NEAR_TOP_LEFT],o[Je.NEAR_TOP_RIGHT]]=[o[Je.NEAR_TOP_RIGHT],o[Je.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-wle;return{zWithMargin:t,pointIndices:lv.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+wle;return{zWithMargin:t,pointIndices:lv.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const Mht=2,Oht=6,Pht=12,Iht=.95,wle=1,Bc=O(),xle=Si(),Tle=Si(),Sle=new Cs(Array,e=>{e.length!==4&&(e[0]=new ip,e[1]=new ip,e[2]=new ip,e[3]=new ip)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class $ht{constructor(t){this.camera=new tr,this.focusOnMap=[0,0],this.screenRect=kt(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new Rht(t.renderCoordsHelper)}begin(t,i,r){this.camera.copyFrom(t),this.surfaceElevation=r,this.focusOnMap[0]=i.x,this.focusOnMap[1]=i.y,tX(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=MPe(t.extent,this.focusOnMap),t.measures.visibility!==ra.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=Lht,r=1<<i,s=t.measures.screenRect;Lu(s);let n=0;const o=t.lij[0]+i,a=t.lij[1]<<i,l=t.lij[2]<<i,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(n+=this._computeScreenArea(t,o,a+p,l+f,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===ra.VISIBLE_WHEN_EXTENDED?this.tileSize*Dht:this.tileSize}_computeScreenArea(t,i,r,s,n){const o=t.measures.visibility===ra.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,Zy),Lu(t8);for(let a=0;a<4;a++)KS(t8,Zy[a]);return Wb(n,t8,n),rne(Zy[0],Zy[1],Zy[2])+rne(Zy[0],Zy[2],Zy[3])}_projectToScreen(t,i,r,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,i,r,dA),this._toRenderCoords(dA,0,3,Yy[0]),this._toRenderCoords(dA,2,3,Yy[1]),this._toRenderCoords(dA,2,1,Yy[2]),this._toRenderCoords(dA,0,1,Yy[3]),s&&(this._projectToPlane(Yy,this.camera.frustum[ar.NEAR]),this._projectToPlane(Yy,this.camera.frustum[ar.TOP]),this._projectToPlane(Yy,this.camera.frustum[ar.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(Yy[o],Ele),this.camera.renderToScreen(Ele,n[o])}_projectToPlane(t,i){for(let s=0;s<4;s++)fA[s]=lr(i,t[s]);const r=Math.max(fA[0],fA[1],fA[2],fA[3]);if(r>0){const s=le(pA,i,-r);for(let n=0;n<4;n++)de(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return pA[0]=t[i],pA[1]=t[r],pA[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(pA,this.tilingScheme.spatialReference,s),s}}const t8=kt(),Lht=2,Dht=5,Zy=[Yr(),Yr(),Yr(),Yr()],dA=kt(),pA=O(),Yy=[O(),O(),O(),O()],fA=[0,0,0,0],Ele=Fo();function QEt(e,t,i){if(R(e)||R(i))return!1;let r=!0;return Ks[0]=e.xmin!=null?e.xmin:0,Ks[1]=e.ymin!=null?e.ymin:0,Ks[2]=e.zmin!=null?e.zmin:0,r=r&&dr(Ks,e.spatialReference,0,t,i,0,1),Ks[0]=e.xmax!=null?e.xmax:0,Ks[1]=e.ymax!=null?e.ymax:0,Ks[2]=e.zmax!=null?e.zmax:0,r=r&&dr(Ks,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function O2e(e,t,i){if(R(e)||R(i))return!1;let r=!0;return Ks[0]=e.xmin!=null?e.xmin:0,Ks[1]=e.ymin!=null?e.ymin:0,Ks[2]=e.zmin!=null?e.zmin:0,r=r&&dr(Ks,e.spatialReference,0,Ks,i,0,1),t[0]=Ks[0],t[1]=Ks[1],Ks[0]=e.xmax!=null?e.xmax:0,Ks[1]=e.ymax!=null?e.ymax:0,Ks[2]=e.zmax!=null?e.zmax:0,r=r&&dr(Ks,e.spatialReference,0,Ks,i,0,1),t[2]=Ks[0],t[3]=Ks[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const Ks=O(),Nht=fe.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let no=class extends Se{constructor(e){super(e),this.tiles=new ut,this.tileSize=512,this._idToTile=new Map,this._handles=new Nt,this._clients=new Set,this._dirty=!1,this._newTiles=new Wt}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(_(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void Nht.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||_(t)&&e&&t.equals(e))return;const i=_(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(R(this.filterExtent)||!this.tilingScheme)return null;const e=kt();return O2e(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([ie(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),qi),ie(()=>{var e,t,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Us)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(yt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=cn(this._frameWorker),this._handles=lt(this._handles)}addClient(){const e=kht();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(nC))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),_(this._frameWorker)&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&_(this._frameWorker)&&(this._frameWorker.priority=yt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new $ht({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new ip(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),Lu(W$);for(let t=0;t<e.length;t++)if(Wb(W$,e.data[t].measures.screenRect,W$),Ep(W$)>Uht)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!O3(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==ra.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===ra.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([d({constructOnly:!0})],no.prototype,"scheduler",void 0),u([d({constructOnly:!0})],no.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],no.prototype,"tilingSchemeOwner",void 0),u([d({constructOnly:!0})],no.prototype,"cameraOnSurface",void 0),u([d({constructOnly:!0})],no.prototype,"focus",void 0),u([d({constructOnly:!0})],no.prototype,"viewState",void 0),u([d({constructOnly:!0})],no.prototype,"terrain",void 0),u([d()],no.prototype,"tiles",void 0),u([d()],no.prototype,"tileSize",void 0),u([d({readOnly:!0})],no.prototype,"tilingScheme",null),u([d()],no.prototype,"filterExtent",null),u([d({readOnly:!0})],no.prototype,"filterExtentRect",null),u([d({readOnly:!0})],no.prototype,"rootTileIds",null),u([d({value:!1})],no.prototype,"suspended",null),u([d({readOnly:!0})],no.prototype,"updating",null),no=u([P("esri.views.3d.layers.support.FeatureTileTree3D")],no);let Fht=0;function kht(){return Fht++}const W$=kt(),Uht=10;let so=class extends Se{constructor(){super(...arguments),this._propertiesPool=new ry({camera:tr},this),this._lastSeenCameraProjectionValues=new tr,this.events=new as,this.viewingMode=Ge.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new tg({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new ry({camera:tr},this)}createInitialCamera(){if(this.viewingMode===Ge.Global){const e=Ci(this.spatialReference).radius;this.camera=new tr(Ue(4*e,0,0),Ue(e,0,0),Ue(0,0,1))}else this.camera=new tr(Ue(0,0,100),Ue(0,0,0),Ue(0,1,0))}get animation(){return this.cameraController instanceof qO&&_(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Ju&&Ju.copyFrom(e),Ju.computeUp(this.viewingMode),Cle.camera=Ju,this.events.emit("before-camera-change",Cle);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Ju)&&(this._lastSeenCameraProjectionValues.copyFrom(Ju),Ale.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",Ale)),(!t||!t.equals(Ju))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Ju)),this._cameraChanged=!t||!t.almostEquals(Ju),this._cameraChanged)){const i=bde(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return _(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=_(e)?e.clone():null}get fixedContentCamera(){return _(this._contentCamera)}get isGlobal(){return this.viewingMode===Ge.Global}get isLocal(){return this.viewingMode===Ge.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(ie(()=>e.state,t=>{t!==Ur.Finished&&t!==Ur.Stopped||(this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i)))},qi)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=Ur.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==Ur.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();Ju.copyFrom(this._get("camera")),e(Ju),this.camera=Ju,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[At.TOP]!==t.padding[At.TOP]||e.padding[At.RIGHT]!==t.padding[At.RIGHT]||e.padding[At.BOTTOM]!==t.padding[At.BOTTOM]||e.padding[At.LEFT]!==t.padding[At.LEFT]}};u([d({readOnly:!0,type:lE})],so.prototype,"animation",null),u([d({type:tr})],so.prototype,"camera",null),u([d()],so.prototype,"pixelRatio",null),u([d({})],so.prototype,"_contentCamera",void 0),u([d({type:tr})],so.prototype,"contentCamera",null),u([d({readOnly:!0})],so.prototype,"fixedContentCamera",null),u([d({readOnly:!0})],so.prototype,"constraints",void 0),u([d({readOnly:!0})],so.prototype,"events",void 0),u([d({readOnly:!0})],so.prototype,"isGlobal",null),u([d({readOnly:!0})],so.prototype,"isLocal",null),u([d({readOnly:!0})],so.prototype,"viewingMode",void 0),u([d({readOnly:!0})],so.prototype,"spatialReference",void 0),u([d({readOnly:!0})],so.prototype,"navigating",null),u([d({readOnly:!0})],so.prototype,"stationary",null),u([d()],so.prototype,"_cameraChanged",void 0),u([d()],so.prototype,"cameraController",null),so=u([P("esri.views.3d.state.ViewState")],so);const zht=so,Ju=new tr,Cle={camera:null},Ale={camera:null};function Vht(e,t,i){return e===Ge.Global?new Ght(i):new Bht(t,i)}class Bht{constructor(t,i){this.elevationProvider=t,this._referenceEllipsoid=Ci(i),this.unitInMeters=$c(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=t[2]*this.unitInMeters;const a=o,l=o-s,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(o=l>=0?a-this.unitInMeters*c.min:this.unitInMeters*c.max-a);const h={x:(r=_(r)?r:new ai({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);pe(s1,i,t),eT[0]=s1[0]>0?r.xmax:r.xmin,eT[1]=s1[1]>0?r.ymax:r.ymin,eT[2]=s1[2]>0?p/2:-p/2,pe(eT,eT,t),we(s1,s1);const f=1.1*xe(eT,s1)*this.unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),y=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),v=y*qht*this.unitInMeters,w=y*Wht*this.unitInMeters;let b=De((o-w)/(v-w),0,1);b*=b*b;let S=Yt(m,f,b);return S*=Math.max(Math.log(Math.abs(l)),1),S=Math.min(S,Math.max(34064e4,p)),S/=this.unitInMeters,P2e(S,jht,this.unitInMeters,n)}}class Ght{constructor(t){this._referenceEllipsoid=Ci(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const o=Me(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return P2e(1.2*Math.sqrt(c*(c+2*a)),De(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function P2e(e,t,i,r){const s=Hht/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const jht=2e4,Hht=2,qht=.001,Wht=1e-4,eT=O(),s1=O();let xN=class extends Se{constructor(e){super(e),this.handles=new Nt}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;wwe(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{lC(this.view,e,Bh.EYE_AND_CENTER)})}};u([d({constructOnly:!0})],xN.prototype,"view",void 0),xN=u([P("esri.views.3d.state.ElevationCollisionConstraint")],xN);let kR=class extends Se{constructor(e){super(e),this._handles=new Nt,this.nearFarHeuristic=Vht(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([ie(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(r=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:r.far]},()=>this._clipDistanceNearFarChanged()),ie(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),ie(()=>this.view.renderDataExtent,()=>this._updateNearFar(),qi),ie(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(r=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:r.max]},()=>this._updateAltitude(),qi),ie(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),qi),ie(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),qi),ie(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),qi),ie(()=>{var e,t,i,r,s,n;return[(i=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:i.type,(n=(s=(r=this.view.state)==null?void 0:r.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),qi)]),this.view.state.isLocal&&this._handles.add(ie(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),Rt)),this._updateNearFar(),this.view.state.viewingMode!==Ge.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new xN({view:this.view}))}destroy(){this._handles=lt(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>(this._updateCameraNearFarManual(i,e),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,dU(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var r,s,n;const e=(n=(s=(r=this.view.map)==null?void 0:r.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(br.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ge.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Dt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Ac(i))}}_updateLocalSurfaceDistance(e){if(R(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=br.ALL){this.view.state.updateCamera(t=>ys(this.view,t,{selection:e,interactionType:Gt.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:Bn.TUMBLE}))}};u([d({constructOnly:!0})],kR.prototype,"view",void 0),u([d({readOnly:!0})],kR.prototype,"surfaceCollisionConstraint",void 0),kR=u([P("esri.views.3d.state.ConstraintsManager")],kR);let jS=class extends kb{constructor(e){super(e),this.handles=new Nt}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=Ur.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){wwe(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),lC(this.view,e,Bh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=Ur.Stopped)})}};u([d({constructOnly:!0})],jS.prototype,"view",void 0),u([d({constructOnly:!0})],jS.prototype,"desiredCamera",null),jS=u([P("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],jS);const Xht=.66;function I2e(e){return 360-VX.normalize(e)}function nz(e){return VX.normalize(360-e)}function X$(e){return _(e)&&e.resolver&&e.resolver.reject(),null}function Zht(e,t){return _(e)&&e.resolver&&e.resolver.resolve(t),t}function $2e(e,t,i,r=null){if(!t)return X$(r);const s=e.spatialReference||et.WGS84;if(_(t.camera)){const c=Qw(t.camera.position,s);if(R(c))return X$(r);const h=t.camera.clone();return h.position=c,Zht(r,h)}if(R(t.targetGeometry))return X$(r);const n=t.get("targetGeometry.spatialReference");if(n&&!Lv(n,s))return X$(r);const o=SE(e,e.state.camera);let a=zo.ADJUST;if(t.rotation!=null&&(o.heading=I2e(t.rotation),a=zo.LOCKED),i!=null&&(o.tilt=i),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?$Q(e,t.scale,c.latitude):e.state.camera.distance,pxe(e,p,h,o,a,r)}const l=t.targetGeometry.extent;return SM(e,l,o.heading,o.tilt,a,r)}function Yht(e,t,i=null){return R(i)&&(i=new Xh),SJ(e,null,t.clone(),i)}async function Qht(e,t,i){const r=adt(e,t);if(!r)throw new j("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new Rc({fov:e.camera.fov}),n=new Xh({camera:s});if(r.target instanceof Xh)return n1(await edt(e,r.target,r,i,n));if(r.target instanceof Rc)return n1(D2e(e,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof ai){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return n1(o||c?await xq(e,r,r.target.center,s,i,n):await sdt(e,r,r.target,s,i,n))}const a={boundingBox:mr(),hasZ:!1,screenSpaceObjects:[]},l=o?Jht(e,r):void 0;if(await L2e(e,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(np(a.boundingBox,ms),du.x=ms[0],du.y=ms[1],du.z=ms[2],du.spatialReference=e.spatialReference,isFinite(du.z)&&a.hasZ?c=B5(a.boundingBox):(du.z=void 0,c=OPe(nX(a.boundingBox,cdt))),o||c)return n1(await xq(e,r,du,s,i,n));const h=ldt(e,a.screenSpaceObjects);return n1(await odt(e,r,du,a.boundingBox,h,s,i,n))}return r.position?n1(idt(e,r,s,n)):n1(await rdt(e,r,s,i,n))}function xJ(e,t){return t.scale==null&&t.zoom!=null?gxe(e,t.zoom):t.scale}function Jht(e,t){return net(e,xJ(e,t))}function TJ(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=I2e(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function SJ(e,t,i,r){const s=e.spatialReference||et.WGS84;return t=_(t)?t:gg(e,i),R(t)||(r.targetGeometry=Jv(t.center,e.renderSpatialReference,s),r.scale=yxe(e,t),r.rotation=nz(i.heading),r.camera=i),r}function i5(e,t,i){if(!t)return;if(!Lv(t.spatialReference,e.spatialReference))throw new j("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let o;switch(t.type){case"point":o=t;break;case"multipoint":case"polyline":o=t.extent.center;break;case"mesh":o=t.origin;break;case"extent":o=t.center;break;case"polygon":o=t.centroid}o&&Lv(o,e.basemapTerrain.spatialReference)?ms[2]=vt(kf(e.elevationProvider,o),0):ms[2]=0}(0,udt[t.type])(t,o=>{r.push(o[0],o[1],o[2])},ms);const s=r.length/3;if(s===0)return;const n=new Array(r.length);if(dr(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let o=0;o<n.length;o+=3)t.hasZ?(ms[0]=n[o+0],ms[1]=n[o+1],ms[2]=n[o+2]):(ms[0]=n[o+0],ms[1]=n[o+1]),Zf(i.boundingBox,ms)}}async function Kht(e,t,i,r){const s=await ku(e.whenViewForGraphic(t));if(s.ok===!1||R(s.value)||!("whenGraphicBounds"in s.value))return void i5(e,t.geometry,r);const n=s.value,o=await ku(n.whenGraphicBounds(t,{minDemResolution:i}));if(o.ok===!1)return void i5(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;U2(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function L2e(e,t,i,r){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return du.x=s,du.y=n,du.z=void 0,du.spatialReference=e.spatialReference.isGeographic?e.spatialReference:et.WGS84,void i5(e,du,r)}t&&typeof t.map=="function"?await gs(t.map(s=>L2e(e,s,i,r))):t instanceof Ec?i5(e,t,r):t instanceof Ha&&await Kht(e,t,i,r)}async function edt(e,t,i,r,s){if(_(t.camera))return D2e(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=_(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=nz(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=xJ(e,i);n!=null&&(s.scale=n);const o=new hC(r);return $2e(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}function D2e(e,t,i){const r=e.spatialReference,s=Qw(t.position,r);return R(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,SJ(e,null,t,i))}function tdt(e,t,i,r,s,n){const o=e.renderSpatialReference;return jn(i.position,Y$,o),jn(t,i8,o),n.targetGeometry=new ot(t),s.position=new ot(i.position),pe(r5,i8,Y$),mU(e,Y$,r5,r.up,s),n.scale=Uw(e,ur(Y$,i8),n.targetGeometry.latitude),n.rotation=nz(s.heading),n.camera=s,n}async function xq(e,t,i,r,s,n){if(R(i))throw new j("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=px(e);if(t.position)return tdt(e,n.targetGeometry,t,o,r,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=le(ms,o.viewForward,-l);o.eye=de(ms,o.center,c),n.scale=Uw(e,l,i.latitude)}SE(e,o,r);const a=TJ(r,t)?zo.LOCKED:zo.ADJUST;if(!t.zoomFactor){n.scale=xJ(e,t),n.scale==null&&(jn(i,ms,e.renderSpatialReference),Dwe(o.frustum,ms)?n.scale=Uw(e,ur(o.eye,ms),i.latitude):n.scale=yxe(e,o));const l=new hC(s);dxe(e,n.targetGeometry,n.scale,r,a,l),n.camera=await l.resolver.promise}return n}function idt(e,t,i,r){const s=px(e);return ae(r5,s.viewForward),mU(e,s.eye,r5,s.up,r8),i.position=new ot(t.position),i.heading=t.heading!=null?t.heading:r8.heading,i.tilt=t.tilt!=null?t.tilt:r8.tilt,SJ(e,null,i,r)}async function rdt(e,t,i,r,s){const n=px(e);return xq(e,t,Jv(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function sdt(e,t,i,r,s,n){n.targetGeometry=i.clone();const o=px(e);SE(e,o,r);const a=TJ(r,t)?zo.LOCKED:zo.ADJUST,l=new hC(s);return SM(e,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function ndt(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=kf(e.elevationProvider,i)),se(ms,i.x,i.y,n),Nu(e.spatialReference,ms,Rle,e.renderSpatialReference),Qh(Z$,Rle),Jh(Z$,Z$),mr(mA);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let y=0;y<o.length;y++){const v=o[y];let w=r[v[2]];isFinite(w)||(w=n),se(ms,r[v[0]],r[v[1]],w),un(ms,e.spatialReference,ms,e.renderSpatialReference),Zf(mA,mc(ms,ms,Z$))}const a=ex(mA),l=m_(mA),c=tx(mA),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,m=.5*l*p+.5*Math.max(a,c);return Math.max(f,m)/s}async function odt(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=px(e),c=ndt(e,l,i,r,s);SE(e,l,n);const h=TJ(n,t)?zo.LOCKED:zo.ADJUST;a.scale=Uw(e,c,a.targetGeometry.latitude);const p=new hC(o);return dxe(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function adt(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function n1(e){return e&&_(e.camera)&&(e.rotation=nz(e.camera.heading)),e}function ldt(e,t){const i=Xht;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const ms=O(),Rle=Ae(),Z$=Or(),mA=Gs(),cdt=kt(),r5=O(),Y$=O(),i8=O(),r8={heading:0,tilt:0},du=new ot,udt={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.hasZ?(t(se(i,e.xmin,e.ymin,e.zmin)),t(se(i,e.xmax,e.ymin,e.zmin)),t(se(i,e.xmin,e.ymax,e.zmin)),t(se(i,e.xmax,e.ymax,e.zmin)),t(se(i,e.xmin,e.ymin,e.zmax)),t(se(i,e.xmax,e.ymin,e.zmax)),t(se(i,e.xmin,e.ymax,e.zmax)),t(se(i,e.xmax,e.ymax,e.zmax))):(t(se(i,e.xmin,e.ymin,i[2])),t(se(i,e.xmax,e.ymin,i[2])),t(se(i,e.xmin,e.ymax,i[2])),t(se(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(se(i,r[s+0],r[s+1],r[s+2]))}};class hdt{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const o=new AbortController;_(this.options.signal)&&ha(this.options.signal,()=>{this.abort()}),this.abortController=o,this.waitForReady()})}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject(mi());break;case"wait-for-animation-finish":!t&&_(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject(mi())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await _w(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,Qht(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const i=this._getCameraFromViewpoint(t);if(!R(i))if(this.options.animate){if(R(this.animationController))return;this.startAnimation(i,this.animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const i=!!(this.target instanceof Xh&&this.target.camera||this.target instanceof Rc),r=t.camera;if(R(r))return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new j("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=gg(this.view,r);return R(s)?(this.reject(new j("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(R(r))return void this.reject(new j("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||R(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new jS({view:this.view,desiredCamera:t.camera}),lC(this.view,t.camera,Bh.EYE_AND_CENTER)):ys(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Pg&&_(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):_(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!R(this.view.state))switch(i.state){case Ur.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case Ur.Ready:case Ur.Rejected:case Ur.Running:case Ur.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,i=null;const r=this.view.state.cameraController;return r instanceof Pg&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new Pg({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(_(i)&&i.stop(),this.reject(new j("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const Ku=fe.getLogger("esri.views.3d.state.ViewStateManager");let vn=class extends Se{constructor(e){super(e),this.propertiesPool=new ry({frustum:lv},this),this.handles=new Nt,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=SE(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(gg(this.view,e),{applyConstraints:!1})||Ku.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=SE(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=gg(this.view,e);R(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=yl(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([ie(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),ie(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),ie(()=>this.view.state.camera,n=>{const o=Sn(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Ku.error("#center=","Invalid center",e):Ku.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Ku.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=eet(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return _(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Ku.error("#extent=","Invalid extent",e):Ku.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Ku.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Uw(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Ku.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[At.TOP]/i),n=Math.round(t[At.RIGHT]/i),o=Math.round(t[At.BOTTOM]/i),a=Math.round(t[At.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,Q$),this.view.state.updateCamera(t=>t.padding=Q$))}_paddingToArray(e,t,i){e?Ji(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Ji(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return Sp((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?Yht(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Ku.error("#viewpoint=","Invalid viewpoint",e);else{const t=_(e.camera)?e.camera.position:e.targetGeometry,i=_(t)&&t.spatialReference;Ku.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else Ku.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?mxe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Ku.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(_(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),i!=null){const r=i/Math.max(this.view.width,this.view.height);e=Math.min(e,r)}return e}get _devicePixelRatio(){return R(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([ns(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),ie(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(uw({prepare:()=>this._prepareFrame()})),this.handles.add(ie(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(J$)})),this.handles.add(ns(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new kR({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===Ge.Local&&this.handles.add(jo(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(J$),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),J$)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(J$),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i=F({animate:!0},t);return _(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new hdt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(px(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(r=>{i.stepController(e,r)}),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){_(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of fdt){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(R(e)||this.cameraSetByUser)return;if(e instanceof Rc)return void this.setStateCamera(gg(this.view,e),{applyConstraints:!1});if(e instanceof Xh){if(e.targetGeometry instanceof ai){const s=SM(this.view,e.targetGeometry,0,.5,zo.LOCKED);return void(_(s)&&this.setStateCamera(gg(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=SM(this.view,e,0,.5,zo.LOCKED);_(t)&&this.setStateCamera(gg(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&pdt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!R(e)&&(e instanceof Xh?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Rc?this.isCompatible(e.position):e.spatialReference&&Lv(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=mdt){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=Qy){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=XO(this.view,r,s,e,t,zo.ADJUST);return R(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=SM(this.view,e,t,i,zo.ADJUST,gdt);return _(r)?gg(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=$Q(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(gxe(this.view,e))}_viewpointToCamera(e){return gg(this.view,$2e(this.view,e))}setStateCamera(e,t){return!(R(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&ys(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new jS({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(Qy.copyFrom(n),Qy.pixelRatio!==i&&(this._paddingToArray(this.padding,i,Q$),Qy.padding=Q$),Qy.fullWidth=r,Qy.fullHeight=s,Qy.pixelRatio=i,this.view.state.camera=Qy)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?dU(this.view,e.eye):0;e.relativeElevation=i-r}};u([d({type:Rc,dependsOn:["view.state.camera","ready"]})],vn.prototype,"camera",null),u([d({type:Rc,dependsOn:["view.state.contentCamera","ready"]})],vn.prototype,"contentCamera",null),u([d({type:ot})],vn.prototype,"center",null),u([d({type:ai})],vn.prototype,"extent",null),u([d({readOnly:!0})],vn.prototype,"frustum",null),u([d({readOnly:!0})],vn.prototype,"hasInitialView",null),u([d({readOnly:!0,type:Boolean})],vn.prototype,"ready",void 0),u([d({type:Number})],vn.prototype,"scale",null),u([d()],vn.prototype,"padding",null),u([d({readOnly:!0})],vn.prototype,"screenCenter",null),u([d({constructOnly:!0})],vn.prototype,"view",void 0),u([d({type:Xh})],vn.prototype,"viewpoint",null),u([d({type:Number})],vn.prototype,"zoom",null),u([d()],vn.prototype,"maximumPixelRatio",null),u([d()],vn.prototype,"_devicePixelRatio",null),u([d()],vn.prototype,"_windowDevicePixelRatio",void 0),u([d()],vn.prototype,"_devicePixelRatioOverride",void 0),u([d()],vn.prototype,"_maximumPixelRatioOverride",void 0),vn=u([P("esri.views.3d.state.ViewStateManager")],vn);const ddt=vn,pdt=["camera","viewpoint","extent","scale","center","zoom"],fdt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],mdt={heading:0,tilt:0},gdt=new Rc,Qy=new tr,Q$=Xt(),J$="pending-initial-view";class ydt{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this.view=r,this.externalIntersectionHandlers=new Wt,this.tolerance=xE,this.tmpRay=fo(),this.tmpRegion=kt(),this.validateHUDIntersector=ed(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this.tmpRay),Mle(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,Mle(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=vo.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(tL,r,s),tL[0]+=.0466,tL[1]-=.0123,CQ(t,tL,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this.tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||_m(s)&&s.intersector!==Vr.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=xE){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===Vr.TERRAIN?1:r.type===Vr.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t)!=null&&this.externalIntersectionHandlers.sort((i,r)=>i.type===Vr.TERRAIN?1:r.type===Vr.TERRAIN?-1:0)}_getPickRay(t,i){const r=this.view.state.camera;return kwe(r,t,i)}_intersectRayFreePointLocal(t,i){if(this.viewingMode!==Ge.Local||R(t))return!1;const r=this.view.renderDataExtent;if(R(r))return de(i,t.origin,we(He.get(),t.direction)),!0;const s={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return de(i,t.origin,we(He.get(),t.direction)),!0;const o=this.view.state.camera,a=Math.max(0,r.xmin-o.eye[0],o.eye[0]-r.xmax),l=Math.max(0,r.ymin-o.eye[1],o.eye[1]-r.ymax),c=Math.sqrt(a*a+l*l),h=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/h))**2;let f=n/Math.max(1,p);f=Math.max(f,Math.min(c,n));const m=le(He.get(),t.direction,f/Me(t.direction));return de(i,t.origin,m),!0}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(R(t))return null;const n=_(i)?i.mode:"absolute-height",o=_(i)?vt(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,a,eL)){const S=this.view.computeMapPointFromVec3d(eL);return S.z-=o,S}return null}const c=this.view.state.camera,h=He.get();c.projectToRenderScreen(t.origin,h);const p=new Ole(null,this._forEachLayer),f=this.view.slicePlane,m=_(f)?Sne(f):null,y=ed(this.viewingMode);y.options.store=vo.MIN,y.options.verticalOffset=l;const v=t.origin,w=de(He.get(),v,t.direction);y.reset(v,w,c),y.point=h;const b=_(s)?"type"in s&&s.type==="graphics"?S=>S.metadata.layerUid!==s.uid:S=>S.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const S=T=>(R(b)||b(T))&&T.metadata&&T.metadata.isElevationSource;y.intersect(p.layers,h,this.tolerance,null,S),this.externalIntersectionHandlers.forAll(T=>{if(T.type===Vr.I3S||T.type===Vr.TERRAIN){const E=T.slicePlaneEnabled?m:null;T.intersect(y,E,y.rayBegin,y.rayEnd,h)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(S=>{if(S.isGround){const T=S.slicePlaneEnabled?m:null;S.intersect(y,T,y.rayBegin,y.rayEnd,h)}})}if(y.results.min.getIntersectionPoint(eL)){const S=this.view.computeMapPointFromVec3d(eL);return S.z=r,S}return null}computeIntersection(t,i,r){if(R(t))return;const s=this.view.state.camera,n=He.get();s.projectToRenderScreen(t.origin,n);const o=new Ole(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=t.origin,l=de(He.get(),t.origin,t.direction);i.reset(a,l,s),i.intersect(o.layers,n,this.tolerance);const c=this.view.slicePlane,h=_(c)?Sne(c):null;i.intersect(o.sliceableLayers,n,this.tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll(m=>{if(i.options.isFiltered=!o.filterLayerUid(m.layerUid),m.isGround&&p||!i.options.isFiltered){const y=m.slicePlaneEnabled?h:null;m.intersect(i,y,a,l,n)}});const f=He.get();if(r&&r.enableDraped&&i.results.ground.getIntersectionPoint(f)){const m=this.view.basemapTerrain,y=m.overlayManager.renderer,v=this.view.renderCoordsHelper.spatialReference,w=He.get();this.view.renderCoordsHelper.fromRenderCoords(f,w,m.spatialReference),w[2]=vt(this.view.elevationProvider.getElevation(f[0],f[1],f[2],v,"ground"),0),y.intersect(i,w,i.results.ground,b=>o.filterRenderGeometry(b))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){const i=t.results.hud;Jg(this.tmpRegion,$9);const r=this.view.state.camera,s=[],n=this.tmpRegion,o=b=>{const S=new _dt(b);r.projectToRenderScreen(b.target.center,S.screenPoint),S.screenPoint[0]=Math.floor(S.screenPoint[0]),S.screenPoint[1]=Math.floor(S.screenPoint[1]),s.push(S),KS(n,S.screenPoint)};t.sortResults(i.all),_(i.min.dist)&&o(i.min);for(const b of i.all)i.min.target.object!==b.target.object&&i.max.target.object!==b.target.object&&o(b);if(_(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-UR),h=Math.max(0,n[1]-UR),p=Math.min(bu(n)+2*UR,a-c),f=Math.min(Ep(n)+2*UR,l-h),m=new Uint8Array(p*f*4);this.view._stage.renderView.readHUDVisibility(c,h,p,f,m);let y=!0;const v=R(t.results.max.dist);let w=0;for(const b of s)for(const S of vdt)if(m[4*(Math.min(b.screenPoint[0]+S[0],a)-n[0]+(Math.min(b.screenPoint[1]+S[1],l)-n[1])*p)]){y&&(t.results.min.copy(b.result),y=!1),v&&t.results.max.copy(b.result),t.options.store===vo.ALL&&t.results.all.splice(w++,0,b.result);break}}}const UR=1,vdt=(()=>{const e=[],t=UR;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class _dt{constructor(t){this.result=t,this.screenPoint=Fo()}}let K$;function Mle(e){return K$&&K$.viewingMode===e||(K$=ed(e)),K$}class Ole{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.isPickable&&this.filterLayerUid(r.apiLayerUid)&&(r.isSliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return R(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function Ple(e){return typeof e=="object"&&"intersect"in e}const eL=O(),tL=Fo();class JEt{constructor(t,i){this.spatialReference=t,this.view=i}getElevation(t,i,r){return this.view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this.view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class bdt{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions=ye(F({},s),{ignoreInvisibleLayers:!0}),this._frameTask=t.registerTask(yt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,o)=>{const a={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),ha(r,()=>{mW(this._queries,a),o(mi())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void t.forEach(c=>c.result.reject());const r=t.map(c=>[c.x,c.y]),s=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new Jw({points:r,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=_(o)?o.signal:t[0].signal;if(_(o)){let c=0;t.forEach(h=>ha(h.signal,()=>{c++,h.result.reject(mi()),c===t.length&&o.abort()}))}const l=ye(F({},this._queryOptions),{minDemResolution:s,signal:a});i.queryElevation(n,l).then(c=>{t.forEach((h,p)=>{_(h.signal)&&h.signal.aborted?h.result.reject(mi()):h.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let zR=class extends as.EventedMixin(Se){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=lt(this._elevationQuery)}get elevationQuery(){return R(this._elevationQuery)&&(this._elevationQuery=new bdt(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&r.equals(o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=iL(n,this.im,e,t,i,r,s),R(n)&&(n=iL(n,this.ground,e,t,i,r,s)),s==="scene"&&(n=iL(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=xp();return this.elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=iL(l,this.scene,e,t,i,r,s)),a.resolve(l)}).catch(l=>{Jr(l)?a.reject(l):a.resolve(this.getElevation(e,t,i,r,s))}),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function iL(e,t,i,r,s,n,o){for(const a of t){const l=a.getElevation(i,r,s,n,o);_(l)&&(e=_(e)?Math.max(l,e):l)}return e}u([d({constructOnly:!0})],zR.prototype,"view",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],zR.prototype,"spatialReference",void 0),zR=u([P("esri.views.3d.support.CombinedElevationProvider")],zR);class Ov{static isValidProfile(t){return t in Ov.profiles}static getDefaultProfile(){return he("trident")||he("esri-iPhone")?"low":"medium"}static apply(t,i){const r=Ov.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable;{const s=i.sceneService["3dObject"],n=r.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumRenderResolution=r.maximumRenderResolution,i.maximumPixelRatio=r.maximumPixelRatio}}function Ile(){const e=!!he("esri-mobile"),t=!!he("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}Ov.debug={reset(){const e=Ile();for(const t in e)Ov.profiles[t]=e[t]}},function(e){e.profiles=Ile()}(Ov||(Ov={}));const TN=Ov;function EJ(){return new Float32Array(4)}function wdt(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function id(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function xdt(e,t){return new Float32Array(e,t,4)}function N2e(){return EJ()}function F2e(){return id(1,1,1,1)}function k2e(){return id(1,0,0,0)}function U2e(){return id(0,1,0,0)}function z2e(){return id(0,0,1,0)}function V2e(){return id(0,0,0,1)}const Tdt=N2e(),Sdt=F2e(),Edt=k2e(),Cdt=U2e(),Adt=z2e(),Rdt=V2e();Object.freeze(Object.defineProperty({__proto__:null,create:EJ,clone:wdt,fromValues:id,createView:xdt,zeros:N2e,ones:F2e,unitX:k2e,unitY:U2e,unitZ:z2e,unitW:V2e,ZEROS:Tdt,ONES:Sdt,UNIT_X:Edt,UNIT_Y:Cdt,UNIT_Z:Adt,UNIT_W:Rdt},Symbol.toStringTag,{value:"Module"}));let mf=class extends Se{constructor(){super(...arguments),this.color=new Pe([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new Pe([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=Pe.toUnitRGBA(e.color),i=_(e.haloColor)?Pe.toUnitRGBA(e.haloColor):t,r=Pe.toUnitRGBA(e.shadowColor);return{color:id(t[0],t[1],t[2],t[3]),haloColor:id(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:bi(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([d({type:Pe})],mf.prototype,"color",void 0),u([d({type:Pe})],mf.prototype,"haloColor",void 0),u([d()],mf.prototype,"haloOpacity",void 0),u([d()],mf.prototype,"fillOpacity",void 0),u([d()],mf.prototype,"shadowOpacity",void 0),u([d({type:Pe})],mf.prototype,"shadowColor",void 0),u([d()],mf.prototype,"shadowDifference",void 0),mf=u([P("esri.views.3d.support.HighlightOptions")],mf);const Tq=mf;function Mdt(e,t,i){const r=Jde(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let J1=class extends ve{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(r=>r.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:VE(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([d()],J1.prototype,"geometries",void 0),u([d({json:{read:{source:"outSR"}}})],J1.prototype,"outSpatialReference",void 0),u([d()],J1.prototype,"transformation",void 0),u([d()],J1.prototype,"transformForward",void 0),J1=u([P("esri.rest.support.ProjectParameters")],J1);const CJ=J1,Odt=Bs(CJ);async function B2e(e,t,i){t=Odt(t);const r=W0e(e),s=F(ye(F({},r.query),{f:"json"}),t.toJSON()),n=t.outSpatialReference,o=VE(t.geometries[0]),a=Jze(s,i);return Zt(r.path+"/project",a).then(({data:{geometries:l}})=>Mdt(l,o,n))}async function AJ(e=null,t){var s,n;if(Fi.geometryServiceUrl)return Fi.geometryServiceUrl;if(!e)throw new j("internal:geometry-service-url-not-configured");let i;i="portal"in e?e.portal||Gn.getDefault():e,await i.load({signal:t});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new j("internal:geometry-service-url-not-configured");return r}async function Pdt(e,t,i=null,r){const s=await AJ(i,r),n=new CJ;n.geometries=[e],n.outSpatialReference=t;const o=await B2e(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new j("internal:geometry-service-projection-failed")}var Idt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getGeometryServiceURL:AJ,projectGeometry:Pdt});class $dt{constructor(t,i){this.spatialReference=i,this.unitInMeters=$c(this.spatialReference,Ci(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=AJ(t&&t.get("portalItem")).catch(()=>{throw new j("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(l=>l instanceof ot?l:new ot(l,this.spatialReference)),o=new CJ({geometries:n,outSpatialReference:et.WGS84}),a=(await B2e(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let Sf=class extends Se{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};u([d()],Sf.prototype,"minTotalNumberOfFeatures",void 0),u([d()],Sf.prototype,"maxTotalNumberOfFeatures",void 0),u([d()],Sf.prototype,"maxTotalNumberOfPrimitives",void 0),u([d()],Sf.prototype,"snapshotAvailable",void 0),u([d()],Sf.prototype,"polygonLodFactor",void 0),u([d()],Sf.prototype,"polylineLodFactor",void 0),Sf=u([P("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Sf);let Gf=class extends Se{constructor(){super(...arguments),this.lodFactor=1}};u([d()],Gf.prototype,"lodFactor",void 0),Gf=u([P("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Gf);let s5=class extends Gf{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};s5=u([P("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],s5);let vg=class extends Se{constructor(){super(...arguments),this["3dObject"]=new s5,this.point=new Gf,this.integratedMesh=new Gf,this.pointCloud=new Gf,this.uncompressedTextureDownsamplingEnabled=!1}};u([d({type:s5})],vg.prototype,"3dObject",void 0),u([d({type:Gf})],vg.prototype,"point",void 0),u([d({type:Gf})],vg.prototype,"integratedMesh",void 0),u([d({type:Gf})],vg.prototype,"pointCloud",void 0),u([d()],vg.prototype,"uncompressedTextureDownsamplingEnabled",void 0),vg=u([P("esri.views.3d.support.QualitySettings.SceneServiceSettings")],vg);let iv=class extends Se{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};u([d()],iv.prototype,"lodBias",void 0),u([d()],iv.prototype,"angledSplitBias",void 0),u([d()],iv.prototype,"reduceTileLevelDifferences",void 0),u([d()],iv.prototype,"textureFadeDuration",void 0),iv=u([P("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],iv);let HS=class extends Se{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([d()],HS.prototype,"pixelRatio",void 0),u([d()],HS.prototype,"maxTotalNumberOfFeatures",void 0),HS=u([P("esri.views.3d.support.QualitySettings.HeatmapSettings")],HS);let ll=class extends Se{constructor(){super(...arguments),this.graphics3D=new Sf,this.sceneService=new vg,this.tiledSurface=new iv,this.heatmap=new HS,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};u([d({type:Sf})],ll.prototype,"graphics3D",void 0),u([d({type:vg})],ll.prototype,"sceneService",void 0),u([d({type:iv})],ll.prototype,"tiledSurface",void 0),u([d({type:HS})],ll.prototype,"heatmap",void 0),u([d()],ll.prototype,"antialiasingEnabled",void 0),u([d()],ll.prototype,"physicallyBasedRenderingEnabled",void 0),u([d()],ll.prototype,"highQualityTransparency",void 0),u([d()],ll.prototype,"memoryLimit",void 0),u([d()],ll.prototype,"additionalCacheMemory",void 0),u([d()],ll.prototype,"frameRate",void 0),u([d()],ll.prototype,"maximumRenderResolution",void 0),u([d()],ll.prototype,"maximumPixelRatio",void 0),ll=u([P("esri.views.3d.support.QualitySettings.QualitySettings")],ll);const $le=ll;class n5{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this.coordinateSystem=s,this._coordinateSystem=RFe(s)}set extent(t){t&&MFe(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return FFe(this.coordinateSystem,t)}setAltitude(t,i,r=t){return lye(this.coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){kFe(this.coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return $Fe(this.coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return LFe(this.coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,Ou.X,He.get()),s=this.worldBasisAtPosition(t,Ou.Y,He.get()),n=this.worldBasisAtPosition(t,Ou.Z,He.get());return pm(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}intersectManifoldClosestSilhouette(t,i,r){return _6(this.coordinateSystem,i,this._coordinateSystem),NFe(this._coordinateSystem,t,r),r}intersectManifold(t,i,r){_6(this.coordinateSystem,i,this._coordinateSystem);const s=He.get();return DFe(this._coordinateSystem,t,s)?ae(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===Ge.Global)return this.intersectManifold(t,i,r);_6(this.coordinateSystem,i,this._coordinateSystem);const s=this._coordinateSystem.value,n=He.get();return ax(s.plane,t,n)?ae(r,n):null}toRenderCoords(t,i,r){return $4(t)?jn(t,i,this.spatialReference):un(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return $4(i)?(_(r)&&(i.spatialReference=r),nge(t,this.spatialReference,i)):i instanceof et?Jv(t,this.spatialReference,i):un(t,this.spatialReference,i,r)?i:null}static create(t,i){switch(t){case Ge.Local:return new n5(Ge.Local,i,$c(i),IFe());case Ge.Global:return new n5(Ge.Global,i,1,PFe(i))}}static renderUnitScaleFactor(t,i){return Lle(t)/Lle(i)}}function Lle(e){if(L4(e,Ge.Global))return 1;const t=cye(!1,e);return $c(t)}var Lf;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(Lf||(Lf={}));const Ldt=(()=>{const e=new Array;return e[Lf.ELEVATION]=10,e[Lf.BASEMAP]=10,e[Lf.I3S_INDEX]=10,e[Lf.I3S_DATA]=10,e[Lf.SYMBOLOGY]=5,e})(),Ddt=30;function G2e(e){return typeof e.getUsedMemory=="function"}const Ndt=fe.getLogger("esri.views.3d.support.MemoryController");function Fdt(e){return new cl({view:e})}const rL=1,s8=1,kdt=.75,Udt=.6,Dle=1.3;let cl=class extends Se{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new kZ,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(rL),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new oze(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Udt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(rL);else if(e)(this._memoryPredicted>1.1*s8||this._memoryUsed>s8)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/Dle),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>s8)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Dle),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<kdt&&this._quality<rL){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),rL))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;_(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(G2e(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);Ndt.warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([d({constructOnly:!0})],cl.prototype,"view",void 0),u([d()],cl.prototype,"maxMemory",null),u([d()],cl.prototype,"additionalCacheMemory",null),u([d()],cl.prototype,"memoryFactor",null),u([d()],cl.prototype,"updating",null),u([d()],cl.prototype,"usedMemory",null),u([d()],cl.prototype,"_quality",void 0),u([d()],cl.prototype,"_memoryUsed",void 0),u([d()],cl.prototype,"_updating",void 0),u([d()],cl.prototype,"_stableQuality",void 0),u([d()],cl.prototype,"_maxMemory",void 0),u([d()],cl.prototype,"_additionalCacheMemory",void 0),cl=u([P("esri.views.3d.support.MemoryController")],cl);class zdt{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class Vdt{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new Bdt}}class Bdt{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Gdt{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new Vdt(n))}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,pt(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let SN=class extends Se{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new Gdt((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(yt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=cn(this._frameTask),this._tasks.forEach(e=>Hh(e.abortController)),this._loadQueue=lt(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=xp();s.__signal=_(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return ha(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const o=new qdt(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){A5(e.resolvers,t),t.reject(mi()),e.resolvers.length===0&&(e.status===vh.DOWNLOADING&&(e.status=vh.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=vh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=Wdt(_(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(pt(e.status===vh.DOWNLOADING),e.status=vh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();fi(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==vh.DOWNLOADED&&(t.err=t.err||mi()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Jr(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)Jr(t)?r.reject(t):r.reject(new j("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:re(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===vh.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=vh.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=Zt(e.url,ye(F({},e.options),{responseType:r,timeout:i,signal:s}));let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===vh.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=Hdt(c);if(r="image",e.size=c.byteLength,h==="unknown")return e.request=Zt(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(m=>o(m.data),a);const p=new Blob([c],{type:h}),f=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(f),e.request=Zt(f,{responseType:r,timeout:i,signal:s}),e.request.then(m=>o(new oz(m.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([d({readOnly:!0})],SN.prototype,"updating",void 0),SN=u([P("esri.views.3d.support.StreamDataLoader")],SN);const jdt={numRetries:0};function Hdt(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class oz{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class qdt extends zdt{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=vh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=jdt.numRetries}}function Wdt(e,t,i){return`${e}:${t}:${i}`}var vh;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(vh||(vh={}));let sL=class extends Se{constructor(){super(...arguments),this.updating=!1}};function Xdt(e){return new Sq.ResourceController({view:e})}var Sq;u([d({readOnly:!0})],sL.prototype,"updating",void 0),sL=u([P("esri.views.3d.support.ResourceController")],sL),function(e){let t=class extends sL{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=aE,this._cameraChangeTime=0,this._handles=new Nt,this._frameTask=null,this._state=Nn.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=hqe(),this._memoryController=Fdt(this.view),this._streamDataLoader=new SN,this._streamDataLoader.setup(Ddt,Ldt,this._scheduler),this._handles.add([ie(()=>{var r;return(r=this.view.state)==null?void 0:r.camera},(r,s)=>this._cameraChangedHandler(r,s),qi),ie(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=uw({update:r=>this._frame(r)}),this._scheduleTask=this._scheduler.registerTask(yt.RESOURCE_CONTROLLER)}destroy(){this._handles=lt(this._handles),this._scheduleTask.remove(),this._frameTask=cn(this._frameTask),this._streamDataLoader=lt(this._streamDataLoader),this._memoryController=lt(this._memoryController),this._scheduler=lt(this._scheduler)}get updating(){var r,s,n;return!!(((r=this._memoryController)==null?void 0:r.updating)||((s=this._streamDataLoader)==null?void 0:s.updating)||((n=this._scheduleTask)==null?void 0:n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(r,s,n){return this._scheduleTask.schedule(r,s,n)}createStreamDataRequester(r){const s=this._streamDataLoader;return{request:(n,o,a)=>s.request(n,o,r,a),get busy(){return!s.hasDownloadSlots(r)}}}_frame(r){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(MW(r.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(r)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(r,s){r&&s&&r.almostEquals(s)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=Nn.ANIMATING:this.view.interacting?this._state=Nn.INTERACTING:(this._state===Nn.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=i?this._state=Nn.INTERACTING:this._state=Nn.IDLE)}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r),state:this._state}}};u([d({constructOnly:!0})],t.prototype,"view",void 0),u([d()],t.prototype,"_scheduler",void 0),u([d()],t.prototype,"_memoryController",void 0),u([d()],t.prototype,"_streamDataLoader",void 0),u([d()],t.prototype,"_scheduleTask",void 0),u([d({readOnly:!0})],t.prototype,"updating",null),t=u([P("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(Sq||(Sq={}));function Zdt(e){return"performanceInfo"in e}const tT=O(),Ydt=O(),Lm=O(),Dm=O();function Qdt(e,t,i=0){const r=e.extent;if(R(r))return!1;if(i===0)return Npe(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return RPe(r,t,i*s)}function nL(e,t,i,r){ae(tT,i),tT[r]=t[r];const s=pe(tT,tT,t),n=pe(Ydt,e,t),o=xe(n,s),a=xe(s,s);let l;l=o<=0?t:a<=o?i:de(tT,t,le(s,s,o/a));const c=pe(tT,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function Jdt(e,t,i){const r=e.extent;if(R(r))return 0;Lm[0]=r[0],Lm[1]=r[1],Lm[2]=i,Dm[0]=r[2],Dm[1]=r[3],Dm[2]=i;let s=1/0,n=1/0;return t[0]<Lm[0]?s=nL(t,Lm,Dm,0):t[0]>Dm[0]&&(s=nL(t,Dm,Lm,0)),t[1]<Lm[1]?n=nL(t,Lm,Dm,1):t[1]>Dm[1]&&(n=nL(t,Dm,Lm,1)),Math.min(s,n)}function Kdt(e,t,i){if(R(e))return LY();if(e.spatialReference.isGeographic&&!ww(e.spatialReference))return new j("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=Lr.checkUnsupported(e);if(_(r))return r;if(R(i))return new j("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=ept(e,i);if(s)return s;const n=e.spatialReference;return _(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new j("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function ept(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=Lpe(t),a=kt();Lr.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>IS){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new j("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:IS})}return null}const tpt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:Qdt,tiltToExtentEdge:Jdt,checkIfTileInfoSupportedForViewSR:Kdt},Symbol.toStringTag,{value:"Module"}));function ipt(){return!0}function rpt(){return 0}function spt(e,t){if(R(e))return LY();const i=e.lods.length-1,r=e.spatialReference,s=ww(r)||lm(r)||cm(r);if(r.isWebMercator){if(!Lr.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new j("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new j("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Lr.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new j("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new j("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return _(t)&&!e.spatialReference.equals(t)?new j("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const npt=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:ipt,tiltToExtentEdge:rpt,checkIfTileInfoSupportedForViewSR:spt},Symbol.toStringTag,{value:"Module"})),opt={[Ge.Global]:npt,[Ge.Local]:tpt};function Rf(e,t){e||console.warn("Terrain: "+t)}function Eq(e){return az(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function o5(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function az(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function RJ(e){return(e==null?void 0:e.type)==="tile-3d"}function l3(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function j2e(e){return(e==null?void 0:e.type)==="wmts-3d"}function Cq(e){return(e==null?void 0:e.type)==="elevation-3d"}function H2e(e){return(e==null?void 0:e.type)==="group"}function a5(e){return e&&(RJ(e)||j2e(e)||az(e)||l3(e))}function Aq(e){return e&&(RJ(e)||az(e)||l3(e)||j2e(e))}function c3(e){return Aq(e)||Cq(e)}function KEt(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return e.type,!1}}function apt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="raster-tile"}function lpt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="vector-tile"}function cpt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return _(t)&&"type"in t&&t.type==="tile-texture"}function upt(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return t instanceof HTMLImageElement||t instanceof oz||t instanceof HTMLCanvasElement||t instanceof ImageData}function f2(e){return _(e)&&"release"in e&&e.release(),null}function Nle(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function MJ(e,t,i,r){return opt[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function lz(e,t,i){let r=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=hpt(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=o5(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===Ge.Local;if(o5(e))r=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!dpt(t)||ppt.force512VTL,a=e.tileInfo.spatialReference.isGeographic;r=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=e.tileInfo}return _(r)&&_(s)&&MJ(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function hpt(e,t,i){const r=UFe(e);if(_(r)){if(!ut.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>MJ(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function dpt(e){return e.isWGS84||e.isWebMercator||Mde(e)||!XM(e)}const ppt={force512VTL:!1};function l5(e){return e===zt.NORTH_EAST?zt.SOUTH_WEST:e===zt.NORTH_WEST?zt.SOUTH_EAST:e===zt.SOUTH_WEST?zt.NORTH_EAST:zt.NORTH_WEST}function EN(e){return e===zt.NORTH?zt.SOUTH:e===zt.EAST?zt.WEST:e===zt.SOUTH?zt.NORTH:zt.EAST}function fpt(e){return e===zt.NORTH_WEST||e===zt.SOUTH_WEST}function mpt(e){return e===zt.NORTH_WEST||e===zt.NORTH_EAST}function Fle(e){return e===zt.NORTH_WEST||e===zt.WEST||e===zt.SOUTH_WEST}function kle(e){return e===zt.NORTH_EAST||e===zt.EAST||e===zt.SOUTH_EAST}function Ule(e){return e===zt.SOUTH_EAST||e===zt.SOUTH||e===zt.SOUTH_WEST}function zle(e){return e===zt.NORTH_EAST||e===zt.NORTH||e===zt.NORTH_WEST}const cv=[zt.NORTH,zt.EAST,zt.SOUTH,zt.WEST],c5=[zt.NORTH_EAST,zt.SOUTH_EAST,zt.SOUTH_WEST,zt.NORTH_WEST];class gpt{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=c3(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),Zdt(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class ypt{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*Y2.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=_(r)?r.usedMemory:0,t.allLayerViews.items.forEach(s=>{(G2e(s)||c3(s))&&this.layerPerformanceInfos.push(new gpt(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class vpt extends $S{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){fi(r);const s=_(r)&&r.signal,n=this.makeUid(t,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const h=this._createTexture(t,c,i);return o.texture=h,o.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:n,texture:h,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{ha(s,()=>{l(mi())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,i,r){const s=ye(F({},this._parameters),{powerOfTwoResizeMode:Uv.PAD});if(mX(t)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new Ns(i,s)}}class _pt{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(Lf.SYMBOLOGY),this.textures=new vpt(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:wt.CLAMP_TO_EDGE,t:wt.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=Ci(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=Rxe(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=Qet(t.viewingMode,i)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return qh();this.graphicsOwners.push(t);const i=ie(()=>{var r;return(r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),qh(()=>{i.remove(),A5(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new Nt;const i=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([ie(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,i,qi),this.viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;oL.distance=t.centerOnSurfaceInfrequent.distance,oL.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(oL),this.screenSizePerspectiveSettingsLabels.update(oL),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const oL={distance:0,fovY:0};class U0{constructor(t,i,r=""){this.graphics=t,this._symbol=new yv({symbolLayers:[new gv({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new ix({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(R(i))return;this.hide();const r=new ot({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new Ha({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){_(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let uv=class extends Se{constructor(e){super(e),this.handles=new Nt}destroy(){this.handles.destroy()}};u([d({constructOnly:!0})],uv.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],uv.prototype,"surface",void 0),u([d({constructOnly:!0})],uv.prototype,"state",void 0),uv=u([P("esri.views.3d.support.PointOfInterest")],uv);const bpt=Array;let su=class extends uv{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new ry({location:ot,renderLocation:bpt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=O(),this.tmpPoint=new ot}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(ns(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=ur(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Uw(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{Jr(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(n8,this._estimatedSurfaceAltitude,this._camera.eye),Tl(this._get("renderLocation"),n8)||this._set("renderLocation",ae(this._propertiesPool.get("renderLocation"),n8))}};u([d({constructOnly:!0})],su.prototype,"scheduler",void 0),u([d({constructOnly:!0})],su.prototype,"cache",void 0),u([d({constructOnly:!0})],su.prototype,"task",void 0),u([d({constructOnly:!0})],su.prototype,"cameraName",void 0),u([d({readOnly:!0})],su.prototype,"location",null),u([d({constructOnly:!0})],su.prototype,"map",void 0),u([d({readOnly:!0})],su.prototype,"renderLocation",void 0),u([d({readOnly:!0})],su.prototype,"scale",null),u([d({readOnly:!0})],su.prototype,"updating",null),su=u([P("esri.views.3d.support.CameraOnSurface")],su);const n8=O(),wpt=Array;let rc=class extends uv{constructor(e){super(e),this._propertiesPool=new ry({location:ot,renderLocation:wpt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=O(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=cn(this._frameWorker),this._propertiesPool=lt(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=Tpt;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=Spt;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(ae(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=ur(this._camera.eye,e):(le(e,this._camera.viewForward,this._get("distance")),de(e,e,this._camera.eye)),Tl(this._get("renderLocation"),e)||this._set("renderLocation",ae(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=Ci(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=Ua(i.eye),o=n<s*s,a=ur(i.eye,t);if(o&&a>r/4){const l=s-Math.sqrt(n);return le(t,i.viewForward,l),de(t,t,i.eye),!0}}else{const r=this.surface.ready?this.surface.extent:null;_(r)&&ck(r,this.surface.spatialReference,gA,this.renderCoordsHelper.spatialReference)&&(t[0]=De(t[0],gA[0],gA[2]),t[1]=De(t[1],gA[1],gA[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(Wi.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=ur(i,e),s=ur(i,t);if(Math.abs(s-r)/r>xpt)return!0}return!1}};u([d({constructOnly:!0})],rc.prototype,"scheduler",void 0),u([d({constructOnly:!0})],rc.prototype,"task",void 0),u([d({constructOnly:!0})],rc.prototype,"cameraName",void 0),u([d()],rc.prototype,"distance",void 0),u([d({constructOnly:!0})],rc.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([d({readOnly:!0})],rc.prototype,"location",null),u([d({readOnly:!0})],rc.prototype,"renderLocation",void 0),u([d()],rc.prototype,"updating",void 0),rc=u([P("esri.views.3d.support.CenterOnSurface")],rc);const xpt=.05,Tpt=O(),Spt=O(),gA=kt();class Ept{constructor(t){this.handles=new Nt,this.events=new as,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this.handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",Cpt)}}const Cpt={},Apt=Array;let gf=class extends uv{constructor(e){super(e),this._propertiesPool=new ry({location:ot,renderLocation:Apt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([ie(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),ie(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(yt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,Vle);const s=Math.max(0,(Math.acos(xe(Vle,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!gw(e,t)){const l=this._propertiesPool.get("renderLocation");ae(l,t),this._set("renderLocation",l)}return}const n=1-De(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(Ble);const a=this._propertiesPool.get("renderLocation");pn(a,t,Ble,o),e&&gw(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(Fo());if(i[1]=t.aboveGround?t.padding[At.BOTTOM]:t.fullHeight-t.padding[At.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,yA)){pe(yA,yA,t.eye);const s=we(yA,yA);if(this.renderCoordsHelper.intersectManifold(Fu(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([d()],gf.prototype,"_dirty",void 0),u([d({constructOnly:!0})],gf.prototype,"scheduler",void 0),u([d({constructOnly:!0})],gf.prototype,"centerOnSurface",void 0),u([d({constructOnly:!0})],gf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([d({readOnly:!0})],gf.prototype,"updating",null),u([d({readOnly:!0})],gf.prototype,"location",null),u([d({readOnly:!0})],gf.prototype,"renderLocation",void 0),gf=u([P("esri.views.3d.support.CenterOnSurface")],gf);const Vle=O(),yA=O(),Ble=O();let ag=class extends Se{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Nt}get renderLocation(){if(!this.location)return null;const e=O();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([ie(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),ns(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||R(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=iX(this.surfaceView.extent),t=new ot({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Jr(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};u([d({constructOnly:!0})],ag.prototype,"view",void 0),u([d({constructOnly:!0})],ag.prototype,"cache",void 0),u([d({readOnly:!0,aliasOf:"view.map.ground"})],ag.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"view.basemapTerrain"})],ag.prototype,"surfaceView",void 0),u([d({readOnly:!0})],ag.prototype,"location",void 0),u([d({readOnly:!0})],ag.prototype,"renderLocation",null),ag=u([P("esri.views.3d.terrain.StableSurfaceCenter")],ag);let lg=class extends Se{constructor(){super(...arguments),this.handles=new Nt,this._tileGeometryUpdateExtent=Lu(),this._tileGeometryUpdateSpatialReference=null,this.events=new as,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(yt.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=lt(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Rpt),Lu(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Wb(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=Mpt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,o1,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,a1,t),o1[0]<a1[0]?(r[0]=o1[0],r[2]=a1[0]):(r[0]=a1[0],r[2]=o1[0]),o1[1]<a1[1]?(r[1]=o1[1],r[3]=a1[1]):(r[1]=a1[1],r[3]=o1[1]),O3(r,e)}};u([d({constructOnly:!0})],lg.prototype,"state",void 0),u([d({constructOnly:!0})],lg.prototype,"centerOnSurfaces",void 0),u([d({constructOnly:!0})],lg.prototype,"renderCoordsHelper",void 0),u([d({constructOnly:!0})],lg.prototype,"scheduler",void 0),u([d({constructOnly:!0})],lg.prototype,"surface",void 0),u([d({readOnly:!0})],lg.prototype,"updating",void 0),lg=u([P("esri.views.3d.support.SurfaceGeometryUpdates")],lg);const Rpt={},o1=O(),a1=O(),Mpt=Lu();let ia=class extends Se{constructor(e){super(e),this._handles=new Nt,this._tmpRay=fo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new ry({renderPointOfView:Opt},this),this.renderPointOfView=O(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=ed(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=vo.MIN,this._contentIntersector=ed(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new rc(ye(F({},a),{task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("centerOnSurfaceFrequent",new rc(ye(F({},a),{task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s}))),this._set("contentCenterOnSurface",new rc(ye(F({},a),{task:yt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"}))),this._set("centerOnContent",new rc(ye(F({},a),{task:yt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new su(ye(F({},a),{cache:o,task:yt.POINT_OF_INTEREST_INFREQUENT,map:r}))),this._set("contentCameraOnSurface",new su(ye(F({},a),{cache:o,task:yt.POINT_OF_INTEREST_INFREQUENT,map:r,cameraName:"contentCamera"}))),this._set("surfaceGeometryUpdates",new lg(ye(F({},a),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new Ept({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new ag({cache:o,view:this.view})),this._set("focus",new gf({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new U0(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new U0(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new U0(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new U0(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new U0(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new U0(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new U0(l,"green","Focus")),this._handles.add([ie(()=>e.camera,h=>this._cameraChanged(h),qi),ie(()=>t.extent,()=>this._updateCenterPointsOfInterest()),jo(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),qi),ns(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),ns(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),jo(()=>Wi.SHOW_POI,h=>this._setDebug(h),Rt)]),this._cameraChanged(this.view.state.camera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)==null?void 0:e.updating)&&!this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return R(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,iT,Ipt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(iT):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(R(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=de(iT,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(iT)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(iT)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=CQ(t,e,Ppt);if(R(r))return null;const s=r.origin,n=de(iT,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;Tl(this.renderPointOfView,t)||this._set("renderPointOfView",ae(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(ie(()=>t.renderLocation,i=>this._debugCenters.get(t).show(i,t.renderCoordsHelper.spatialReference),Rt),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([d({readOnly:!0})],ia.prototype,"centerOnContent",void 0),u([d({readOnly:!0})],ia.prototype,"centerOnSurfaceFrequent",void 0),u([d({readOnly:!0})],ia.prototype,"centerOnSurfaceInfrequent",void 0),u([d({readOnly:!0})],ia.prototype,"contentCenterOnSurface",void 0),u([d({readOnly:!0})],ia.prototype,"cameraOnSurface",void 0),u([d({readOnly:!0})],ia.prototype,"contentCameraOnSurface",void 0),u([d({readOnly:!0})],ia.prototype,"focus",void 0),u([d({readOnly:!0})],ia.prototype,"renderPointOfView",void 0),u([d({readOnly:!0})],ia.prototype,"surfaceOrigin",void 0),u([d({readOnly:!0})],ia.prototype,"contentGeometryUpdates",void 0),u([d({readOnly:!0})],ia.prototype,"surfaceGeometryUpdates",void 0),u([d({constructOnly:!0})],ia.prototype,"view",void 0),u([d({readOnly:!0})],ia.prototype,"updating",null),ia=u([P("esri.views.3d.support.PointsOfInterest")],ia);const Opt=Array,iT=O(),Ppt=fo(),Ipt={exclude:new Set([tp])};class $pt{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,i){this.store.put(t,i,i.values.byteLength+256)}}const Lpt=fe.getLogger("esri.core.workers.WorkerHandle");class q2e{constructor(t,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=kme(t,ye(F({},n),{schedule:s})).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Lpt.error(`Failed to initialize ${t} worker: ${o}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),qh(()=>{r.removed=!0,mW(this._listeners,r),this._thread&&_(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this._transferLists[t],n=s?s(i):[];return this._thread.invoke(t,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(fi(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class Gle extends q2e{constructor(t=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(NM.forEach((t,i)=>{t===this&&NM.delete(i)}),this.destroy())}}const NM=new Map;function Dpt(e=null){let t=NM.get(e);return t||(_(e)?(t=new Gle(i=>e.schedule(i)),NM.set(e,t)):(t=new Gle,NM.set(null,t))),++t.ref,t}function jg(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function W2e(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Npt(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Fpt(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:jg,clone:W2e,fromValues:Npt,createView:Fpt},Symbol.toStringTag,{value:"Module"}));var jle,cc,Hle,qle,Wle;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(jle||(jle={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(cc||(cc={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(Hle||(Hle={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(qle||(qle={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Wle||(Wle={}));class kpt{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class eCt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function tCt(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class iCt{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function Upt(e,t,i,r,s,n){const o=t[r++];for(let a=0;a<o;a++){const l=new kpt(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];const c=t[r++];for(let f=0;f<c;f++){const m=t[r++],y=t[r++],v=t[r++],w=t[r++],b=!!t[r++],S=t[r++],T=i[r++],E=i[r++],C=t[r++],A=t[r++];l.colliders.push({xTile:m,yTile:y,dxPixels:v,dyPixels:w,hard:b,partIndex:S,width:C,height:A,minLod:T,maxLod:E})}const h=e[r++];for(let f=0;f<h;f++)l.textVertexRanges.push([e[r++],e[r++]]);const p=e[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([e[r++],e[r++]]);s.push(l)}return r}function rCt(e,t,i){for(const[r,s]of e.symbols)zpt(e,t,i,s,r)}function zpt(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===cc.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*h)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class cz{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return R(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){R(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class Vpt extends cz{constructor(t,i){super(t,i),this.type=cc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){_(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),_(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),_(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=oi.createVertex(t,Ei.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=oi.createIndex(t,Ei.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new Hs(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class Bpt extends cz{constructor(t,i){super(t,i),this.type=cc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){_(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),_(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),_(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,_(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),_(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),_(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=oi.createVertex(t,Ei.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=oi.createIndex(t,Ei.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=oi.createVertex(t,Ei.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=oi.createIndex(t,Ei.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,f=h.outlineMaterial;this.fillVertexArrayObject=new Hs(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new Hs(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class Gpt extends cz{constructor(t,i,r){super(t,i),this.type=cc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let f=0;f<l;f++){const m=s[a++],y=s[a++],v=s[a++];this.iconPerPageElementsMap.set(m,[y,v])}const c=s[a++];for(let f=0;f<c;f++){const m=s[a++],y=s[a++],v=s[a++];this.glyphPerPageElementsMap.set(m,[y,v])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=Upt(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){_(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),_(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),_(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),_(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,_(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),_(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),_(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),_(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=oi.createVertex(t,Ei.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=oi.createIndex(t,Ei.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=oi.createVertex(t,Ei.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=oi.createIndex(t,Ei.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=oi.createVertex(t,Ei.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=oi.createVertex(t,Ei.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,f=h.textMaterial;this.iconVertexArrayObject=new Hs(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new Hs(t,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class jpt extends cz{constructor(t,i){super(t,i),this.type=cc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){_(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),_(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),_(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=oi.createVertex(t,Ei.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=oi.createIndex(t,Ei.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new Hs(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const sCt=!0,nCt=32,Xle=200,Hpt=1/he("mapview-transitions-duration");class qpt extends as{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return R(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=xp(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=xp(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*Hpt;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class Of{constructor(t,i,r,s){this.set(t,i,r,s)}static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new Of(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new Of(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new Of(t,i,r,s),new Of(t,i,r+1,s),new Of(t,i+1,r,s),new Of(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}Of.pool=new Cs(Of,null,null,25,50);class Wpt extends qpt{constructor(t,i,r,s,n,o=s,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Of(t),this.x=i,this.y=r,this.width=s,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,i){const r=i/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,o]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;KY(s,a,0,0,0,l,0,n,o,1),sU(this.transforms.dvs,t.displayViewMat3,s)}}class FM extends Wpt{constructor(t,i,r,s,n,o,a=null){super(t,i,r,s,n,4096,4096),this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Xle}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Xle)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===cc.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(X2e.delete(this),FM._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===cc.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;_(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===cc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,i){super.setTransform(t,i);const r=i/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*r,n=this.height/this.rangeY*r,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;eQ(a),_4(a,a,o),tQ(a,a,Math.PI*t.rotation/180),iQ(a,a,[s,n,1])}_createTransforms(){return{dvs:jg(),tileMat3:jg(),tileUnitsToPixels:jg()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case cc.FILL:r=new Bpt(t,this.styleRepository);break;case cc.LINE:r=new Vpt(t,this.styleRepository);break;case cc.SYMBOL:r=new Gpt(t,this.styleRepository,this);break;case cc.CIRCLE:r=new jpt(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const X2e=new Map;function Xpt(){X2e.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const oCt={value:.5,readOnly:!0},Zpt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class OJ{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class Ypt{constructor(t,i,r){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i;const s=r.noDataValue,n=r.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let h=0;h<n.length;h++){const p=n[h];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:s,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(i[2]-i[0]),dy:(r.width-1)/(i[3]-i[1]),x0:i[0],y1:i[3]},this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,h=this.samplerData.pixelData,p=.5*wO;let f=(c-1)/o,m=(r-this.j*o)*f,y=(i-this.i*o)*f;if(f<1){const v=Math.floor(m),w=Math.floor(y),b=v+w*c,S=h[b],T=h[b+1],E=h[b+c],C=h[b+c+1];if(S+T+E+C<p){const A=m-v,I=y-w,D=hI(S,T,E,C,A,I),L=hI(S,T,E,C,A+f,I),z=hI(S,T,E,C,A,I+f),B=hI(S,T,E,C,A+f,I+f);return s.min=Math.min(D,L,z,B),s.max=Math.max(D,L,z,B),s}m=v,y=w,f=1}else m=Math.floor(m),y=Math.floor(y),f=Math.ceil(f);for(let v=m;v<=m+f;v++)for(let w=y;w<=y+f;w++){const b=h[v+w*c];b<p?(a=Math.min(a,b),l=Math.max(l,b)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}function Z2e(e,t,i){if(R(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=De(r.dy*(r.y1-t),0,s),o=De(r.dx*(e-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.width,h=a*c+l,p=r.pixelData,f=p[h],m=p[h+1],y=h+c,v=p[y],w=p[y+1];if(f+v+m+w<.5*wO){n-=a,o-=l;const b=f+(m-f)*o;return b+(v+(w-v)*o-b)*n}}return null}function wr(e,t,i){const r=Z2e(e,t,i);return _(r)?r:0}let yh=class extends Se{constructor(e){super(e),this._handles=new Nt}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=Y2e(i.fullExtent,this.viewSpatialReference);_(r)&&e.push(Lpe(r))}}),e}};function Qpt(e,t){return e===Ge.Global?new Rq(t):new Mq(t)}u([d({readOnly:!0})],yh.prototype,"layerViewsExtent",null),u([d({readOnly:!0})],yh.prototype,"tiledLayersExtent",null),u([d({readOnly:!0})],yh.prototype,"stencilEnabledExtents",null),u([d()],yh.prototype,"viewSpatialReference",void 0),u([d()],yh.prototype,"tilingScheme",void 0),u([d()],yh.prototype,"defaultTiledLayersExtent",void 0),u([d({constructOnly:!0})],yh.prototype,"layers",void 0),u([d({constructOnly:!0})],yh.prototype,"layerViews",void 0),yh=u([P("esri.views.3d.terrain.ExtentHelper")],yh);let Rq=class extends yh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?q1e:OHe}};Rq=u([P("esri.views.3d.terrain.ExtentHelperGlobal")],Rq);let Mq=class extends yh{_computeLayerViewsExtent(){const e=Lu(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=Y2e("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);Wb(e,o,e)}});const i=P9(e)?e:null,r=this._get("layerViewsExtent");return Xb(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=Lu();this.layers.forEach(n=>{if(n.loaded&&uM(n)){const o=lz(n,t,Ge.Local);if(R(o))return;const{tileInfo:a,fullExtent:l}=o;_(a)&&_(l)&&(o5(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&Wb(i,l,i)}}),Wb(i,this.defaultTiledLayersExtent,i);const r=P9(i)?i:null,s=this._get("tiledLayersExtent");return Xb(r,s)?s:r}};function Y2e(e,t){return _(e)&&!e.spatialReference.equals(t)?tge(e,e.spatialReference,t):e}Mq=u([P("esri.views.3d.terrain.ExtentHelperLocal")],Mq);var Qt;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(Qt||(Qt={}));const K1=[Qt.ELEVATION,Qt.MAP];function Q2e(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const i=Object.keys(e);for(const r of i)r.search(".glsl")!==-1&&delete e[r]}}const Jpt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Jy,ul=class extends Se{constructor(e){super(e),this._handles=new Nt,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=he("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Wi.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return _(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Ci(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new Nd({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=ed(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),ie(()=>{var t,i,r;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(r=(i=e.pointsOfInterest)==null?void 0:i.centerOnSurfaceFrequent)==null?void 0:r.location]},()=>this.setPlacementDirty()),ie(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),qi),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),uw({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,ks.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(yt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,ks.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,ks.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),_(Jy)&&(Jy.hide(),Jy=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;_(e)&&_(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Yv(-20037508342787e-6,20037508342787e-6):new Yv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Tf)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&_(e.setDrapingExtent)&&_(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,ks.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const i=pst(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,Nm);const r=bu(Nm.inner)/bu(Nm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(kr.INNER,Nm.inner,i,1*Nm.pixelRatioAdjustment,Nm.mapUnitsPerPixel),n=this._updateOverlay(kr.OUTER,Nm.outer,i,r*Nm.pixelRatioAdjustment,Nm.mapUnitsPerPixel);s!==Ef.EXTENT&&n!==Ef.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===Ef.NONE&&n===Ef.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return Ef.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,Kpt(t,n.extent)&&i===n.resolution)return o===s?Ef.NONE:Ef.RERENDER_ONLY;Jg(n.extent,t),n.resolution=i;const a=iX(n.extent);return n.renderLocalOrigin=OM(a[0],a[1],0,"OV_"+this._latestOriginId++),Ef.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[kr.INNER],r=this.renderer.overlays[kr.OUTER],s=QL(e.extent,this.surface.extent,Zle);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,kr.INNER,t),this._setTileOverlayData(s,kr.OUTER,t)):(this._clearTileOverlayData(kr.INNER,t),this._clearTileOverlayData(kr.OUTER,t))}else this._clearTileOverlayData(kr.INNER,t),this._clearTileOverlayData(kr.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[kr.INNER],i=this.renderer.overlays[kr.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=bu(r),n=Ep(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,bu(e)/s,Ep(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){Q2e(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||_(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,tft,t,i);if(R(s))return!1;const n=s.origin,o=de(aL,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=De(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=aL;ZE(dk(pk,Ci(this.view.spatialReference).radius+a),Fu(e.eye,e.viewForward),c),pe(c,c,e.eye);const h=Qv.normalize(GNe(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=bi(0,h,1,0),f=Eu(p,p,e.projectionMatrix)[1],m=De(.5+.5*f,0,1);i=m===1||m===0?.5:l?m*r:1-(1-m)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&XW(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=O();this._findHorizonBasedPointOfInterest(e,s)||ae(s,r);const n=Math.max(.1,ur(e.eye,s)),o=a_(this.view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);Wi.OVERLAY_SHOW_CENTER?(R(Jy)&&(Jy=new U0(this.view.graphics,"red")),Jy.show(s,this._renderSR)):_(Jy)&&Jy.hide(),this._overlaySREqualsRenderSR||un(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&_(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&_(this._spatialReference)?1/Ci(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*h;i.mapUnitsPerPixel=p/this._worldToPCSRatio;let f=t*p/2,m=!1,y=c?90:1/0;this._isSpherical&&_(l)&&_(this._spatialReference)&&(this._spatialReference.isWebMercator?(f/=Math.cos(aF(s[1])),y=l[3]):(m=!0,f/=Ci(this._spatialReference).metersPerDegree,y=90),f>=y&&(f=y,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let v=1;m&&(v=1/Math.max(.2,Math.cos(Math.abs(Dt(s[1])))),f*v>180&&(v=180/f),i.mapUnitsPerPixel*=v);const w=Math.log(2)/12;f=Math.exp(Math.round(Math.log(f)/w)*w);const b=f*v,S=32,T=.5*t/(S*b),E=.5*t/(S*f);s[0]=Math.round(s[0]*T)/T,s[1]=Math.round(s[1]*E)/E;const C=i.inner;C[0]=s[0]-b,C[1]=s[1]-f,C[2]=s[0]+b,C[3]=s[1]+f,this._isSpherical&&this._shiftExtentToFitBounds(C,1/0,y);const A=i.outer;if(6*b>bu(l))Jg(A,l);else if(a<=.25*Math.PI)A[0]=C[0]-b,A[1]=C[1]-f,A[2]=C[2]+b,A[3]=C[3]+f;else{un(e.eye,this._renderSR,aL,this._spatialReference),$f(l1,s,aL);let D=-Math.atan2(l1[1],l1[0])+.125*Math.PI;D<0&&(D+=2*Math.PI);const L=Math.floor(D/(.25*Math.PI));M3(l1,Jpt[L],2*f),l1[0]*=v,l1[2]*=v,YW(A,C,l1)}if(this._isSpherical)A[0]=this._longitudeCyclical.clamp(A[0]),A[2]=this._longitudeCyclical.clamp(A[2]),A[1]=Math.max(A[1],-y),A[3]=Math.min(A[3],y);else{const D=QL(C,l,Zle),L=QL(A,l,eft);oee(D,L)&&(A[2]=A[0],A[3]=A[1])}const I=Math.abs(C[2]-C[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,I),i.pixelRatioAdjustment=i.mapUnitsPerPixel/I}_drawOverlayTextures(e,t,i=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[kr.INNER],i),n=this._drawOverlay(e[kr.OUTER],i);s!==dE.CHANGED&&n!==dE.CHANGED||this.surface.updateTileOverlayParams(ks.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),r?(this.surface.requestRender(t),t===ks.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(ks.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!R(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):O3(e,t))}_rectInsideRect(e,t){return!R(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:oee(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),mF(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function Kpt(e,t){const r=Wi.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([d()],ul.prototype,"_spatialReference",void 0),u([d({readOnly:!0})],ul.prototype,"running",null),u([d()],ul.prototype,"_placementDirty",void 0),u([d()],ul.prototype,"_contentUpdated",void 0),u([d()],ul.prototype,"_isSpherical",null),u([d()],ul.prototype,"_worldToPCSRatio",null),u([d()],ul.prototype,"renderer",void 0),u([d({constructOnly:!0})],ul.prototype,"surface",void 0),u([d({readOnly:!0,aliasOf:"surface.suspended"})],ul.prototype,"suspended",void 0),u([d({readOnly:!0})],ul.prototype,"updating",null),u([d({type:Boolean})],ul.prototype,"hasHighlights",null),u([d({type:Boolean})],ul.prototype,"rendersOccluded",null),ul=u([P("esri.views.3d.terrain.OverlayManager")],ul);const l1=Xt(),aL=O(),Nm={inner:kt(),outer:kt(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Zle=kt(),eft=kt(),tft=fo();var Ef;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(Ef||(Ef={}));class u3{constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!u3.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(u3.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new Wt({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}u3.test={disabled:!1};class ift{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=mr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=Xt(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class Yle{constructor(t,i,r,s,n){this._buf=t,this._localOrigin=i,this.offset0=r,this.stride=s,this.count=n}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t,i){const r=this.getVertexOffset(i)*bh;t[0]=this._buf[r+0]+this._localOrigin[0],t[1]=this._buf[r+1]+this._localOrigin[1],t[2]=this._buf[r+2]+this._localOrigin[2]}getVertexZ(t){const i=this.getVertexOffset(t)*bh;return this._buf[i+2]+this._localOrigin[2]}setVertex(t,i,r,s){const n=this.getVertexOffset(t)*bh;this._buf[n+0]=i[0]-this._localOrigin[0],this._buf[n+1]=i[1]-this._localOrigin[1],this._buf[n+2]=i[2]-this._localOrigin[2],this._buf[n+3]=r,this._buf[n+4]=s}getNormal(t,i){const r=this.getVertexOffset(i)*bh;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}setVertexRawXYZUV(t,i,r,s,n,o){const a=this.getVertexOffset(t)*bh;this._buf[a+0]=i,this._buf[a+1]=r,this._buf[a+2]=s,this._buf[a+3]=n,this._buf[a+4]=o}setVertexRawXYZUVN(t,i,r,s,n,o,a,l,c){const h=this.getVertexOffset(t)*bh;this._buf[h+0]=i,this._buf[h+1]=r,this._buf[h+2]=s,this._buf[h+3]=n,this._buf[h+4]=o,this._buf[h+5]=a,this._buf[h+6]=l,this._buf[h+7]=c}setVertexRawNormal(t,i,r,s){const n=this.getVertexOffset(t)*bh;this._buf[n+5]=i,this._buf[n+6]=r,this._buf[n+7]=s}getVertexRawNormal(t,i){const r=this.getVertexOffset(i)*bh;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}}const rft=ls().vec3f(M.POSITION).vec2f(M.UV0).vec3f(M.NORMAL),PJ=new u3(e=>rft.createBuffer(e),e=>e.count);function sft(){PJ.clear()}function J2e(e){return PJ.acquire(e)}function nft(e){PJ.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class oft{constructor(){this.sinLonLUT=new Array(pH+1),this.cosLonLUT=new Array(pH+1)}update(t,i){const r=i[0],s=i[2];for(let n=0;n<=t;n++){const o=n/t,a=r*(1-o)+s*o;this.sinLonLUT[n]=Math.sin(a),this.cosLonLUT[n]=Math.cos(a)}}}class lL{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class aft{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new lL,new lL,new lL,new lL],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class lft{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new aft}}class m2{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=lt(this._current),this._next=lt(this._next),this._waiting=lt(this._waiting),this._delayed=lt(this._delayed)}get current(){if(R(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=m2.test.fadeMoment;if(_(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,Hg.Immediate),this._delayed=null)),_(this._next)){t=t||performance.now();const i=this._fadeDuration,r=_(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==Vn.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(lt(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(R(this._next))return 1;const t=m2.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return _(this._next)||_(this._delayed)}push(t,i=Hg.Immediate){this._delayed=lt(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),R(this._current))return void(this._current=t);const r=m2.test.fadeMoment||performance.now();return i!==Hg.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):R(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(R(t)||(lt(this._waiting),this._waiting=t))}get _fadeDuration(){return R(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Hg;m2.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Hg||(Hg={}));class K2e{constructor(){this._queue=new Wt,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),_(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class cft{constructor(){this.q=new Wt}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!R(t)){this.q.pushArray(t);for(let i=0;i<this.q.length;++i){const r=this.q.data[i];r.isLeaf||this.q.pushArray(r.children)}}}next(){return this.q.pop()}}function kM(e,t,i){if(R(t)||R(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function eEe(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function tEe(e,t){t.sort((i,r)=>iEe(i,r,e))}function iEe(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:eEe(e,t)}function uft(e,t){const i=new Map;e.forAll(r=>i.set(r.lij,r.distanceToSquared(t))),e.sort((r,s)=>i.get(r.lij)-i.get(s.lij)||eEe(r,s))}function hft(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function dft(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i&&n.loadable)return!0}}return!1}function aCt(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class IJ{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,Vn.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return _(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=Eq(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?kM:()=>!0;let h=this.tile;const p=h.level;let f;const m=this._tileLayerInfo.upsampleInfo,y=_(m)?m.tile.level:-1,v=!!_(m)&&y-p>=a,w=xr(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const b=h.level,S=p-b,T=h.layerInfo[i][t];if(T.data&&S>=a){(!v||b>y)&&this._setUpsampleTile(h),T.dataInvalidated&&(f=h);break}if((R(w)||w.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&b<=o&&!T.data&&!T.dataMissing&&((R(f)||h.level===n||b%H1e==0||p-f.level<a)&&(f=h),S>=l))break;h=h.parent}return _(f)&&p-f.level<a&&this._tileLayerInfo.upsampleInfo&&(f=null),f}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,Vn.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class pft extends IJ{get _desiredMinLevelDelta(){throw Qle}get _progressiveLevelModulo(){throw Qle}dispose(){}}const Qle=new Error("Abstract method called on TileAgent"),jl=new pft;class rEe extends IJ{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return XD(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class sEe extends IJ{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return H1e}}var lw,Ww;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(lw||(lw={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(Ww||(Ww={}));var Jle,Ne;(function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"})(Jle||(Jle={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(Ne||(Ne={}));const CN={normal:Ne.Normal,average:Ne.Average,lighten:Ne.Lighten,lighter:Ne.Lighter,screen:Ne.Screen,plus:Ne.Plus,"color-dodge":Ne.ColorDodge,darken:Ne.Darken,multiply:Ne.Multiply,"color-burn":Ne.ColorBurn,overlay:Ne.Overlay,"soft-light":Ne.SoftLight,"hard-light":Ne.HardLight,"vivid-light":Ne.VividLight,hue:Ne.Hue,saturation:Ne.Saturation,luminosity:Ne.Luminosity,color:Ne.Color,difference:Ne.Difference,exclusion:Ne.Exclusion,minus:Ne.Minus,invert:Ne.Invert,reflect:Ne.Reflect,"destination-over":Ne.DestinationOver,"destination-atop":Ne.DestinationAtop,"destination-in":Ne.DestinationIn,"destination-out":Ne.DestinationOut,"source-atop":Ne.SourceAtop,"source-in":Ne.SourceIn,"source-out":Ne.SourceOut,xor:Ne.Xor};function fft(e){return e===Ne.DestinationOver||e===Ne.DestinationAtop||e===Ne.DestinationIn||e===Ne.DestinationOut||e===Ne.SourceAtop||e===Ne.SourceIn||e===Ne.SourceOut||e===Ne.Xor}function mft(e){e.fragment.uniforms.add([new jt("u_colormap",t=>t.u_colormap),new We("u_colormapOffset",t=>t.colormap.u_colormapOffset),new We("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new We("u_opacity",t=>t.common.u_opacity)]),e.fragment.code.add(x`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}function gft(e){e.fragment.uniforms.add(new jt("u_transformGrid",t=>t.u_transformGrid)),e.fragment.uniforms.add(new vi("u_transformSpacing",t=>t.common.u_transformSpacing)),e.fragment.uniforms.add(new vi("u_transformGridSize",t=>t.common.u_transformGridSize)),e.fragment.uniforms.add(new vi("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(x`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class nEe extends Ws{constructor(){super(...arguments),this.scale=1,this.offset=Zh}}function oEe(e){e.attributes.add(M.POSITION,"vec2"),e.attributes.add(M.UV0,"vec2"),e.vertex.uniforms.add(new We("scale",t=>t.scale)),e.vertex.uniforms.add(new vi("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(x`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class yft extends nEe{constructor(t,i,r){super(),this.common=t,this.u_image=i,this.u_transformGrid=r}}function vft(e){e.include(gft),e.fragment.uniforms.add([new jt("u_image",t=>t.u_image),new Ow("u_flipY",t=>t.common.u_flipY),new Ow("u_applyTransform",t=>t.common.u_applyTransform)]),e.fragment.code.add(x`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function $J(e){e.code.add(x`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.float(257)};
      if(pos < 0.5 || pos > ${x.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}var Bo;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(Bo||(Bo={}));function aEe(e,t){const i=t.blendMode;i!==Ne.Normal&&(i===Ne.Reflect&&e.code.add(x`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Ne.ColorDodge&&i!==Ne.VividLight||e.code.add(x`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Ne.ColorBurn&&i!==Ne.VividLight||e.code.add(x`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Ne.Overlay&&e.code.add(x`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Ne.HardLight&&e.code.add(x`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Ne.SoftLight&&e.code.add(x`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Ne.VividLight&&e.code.add(x`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Ne.Hue&&i!==Ne.Saturation&&i!==Ne.Color&&i!==Ne.Luminosity||(e.code.add(x`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Ne.Hue&&i!==Ne.Saturation||e.code.add(x`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(x`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Ne.Multiply?x`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Average?x`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Lighten?x`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Darken?x`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Lighter?x`return vec4(cl * ol + cb * ob, ol + ob);`:i===Ne.Plus?x`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Ne.Minus?x`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Ne.Screen?x`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Difference?x`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Invert?x`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ne.DestinationOver?x`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Ne.DestinationAtop?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Ne.DestinationOut?x`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Ne.SourceAtop?x`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Ne.SourceOut?x`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Ne.Xor?x`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Ne.DestinationIn?x`return vec4(cb * ob * ol, ol * ob);`:i===Ne.SourceIn?x`return vec4(cl * ol * ob, ol * ob);`:i===Ne.Hue?x`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Saturation?x`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Color?x`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Luminosity?x`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Exclusion?x`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Reflect?x`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.ColorDodge?x`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.ColorBurn?x`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.Overlay?x`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.SoftLight?x`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.HardLight?x`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Ne.VividLight?x`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:x``}
    }
  `))}var go,xn;function _ft(e){const t=new Zi,i=e.output===go.GridOnly,r=e.output===go.GridComposite,s=r||i,n=e.output===go.ColorOnly,o=e.output===go.ColorComposite,a=o||n,l=r||o;if(t.include(oEe),a&&t.fragment.uniforms.add(new Tt("backgroundColor",m=>m.backgroundColor)),e.baseOpacityMode!==xn.One&&t.fragment.uniforms.add(new We("baseOpacity",m=>m.baseOpacity)),s&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include($J)),i||n)return t.fragment.code.add(x`
    void main() {
      gl_FragColor = ${n?x`vec4(backgroundColor, 1.0)`:x`gridColor(uv)`};
    }
  `),t;const c=e.blendMode!==Ne.Normal,h=e.baseOpacityMode===xn.OnBaseLayer,p=e.baseOpacityMode===xn.OnBackground||e.baseOpacityMode===xn.OnBaseLayer,f=e.premultipliedSource;return t.fragment.uniforms.add(new jt("tex",m=>m.texture)),t.fragment.uniforms.add(new We("opacity",m=>m.opacity)),(c||h||f)&&(t.fragment.uniforms.add(new jt("fboColor",m=>m.fboTexture)),t.fragment.uniforms.add(new We("tileSize",m=>_(m.fboTexture)?m.fboTexture.descriptor.width:1))),t.fragment.include(aEe,e),t.fragment.code.add(x`
    void main() {
      ${l||h||f?x`
      vec4 bgColor = ${o?x`vec4(backgroundColor, 1.0)`:r?x`gridColor(uv)`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${p?x`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${c?x`
          vec4 fboTex = ${l?x`bgColor;`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${h?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:x`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${f?x`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:l||h?x`mix(bgColor, pmColorLayer, composeAlpha);`:x`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT"})(go||(go={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(xn||(xn={}));const bft=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return go},get BaseOpacityMode(){return xn},build:_ft},Symbol.toStringTag,{value:"Module"}));class uz extends yft{constructor(t,i,r,s,n,o){super(t,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=Ba,this.fboTexture=null,this.baseOpacity=1}}class wft extends uz{}class xft extends uz{}function Tft(e){const t=new Zi;t.include(oEe),t.include(vft),t.include(mft),e.tileBlendInput===Bo.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include($J));const i=e.tileBlendInput===Bo.ColorComposite;i&&t.fragment.uniforms.add(new Tt("backgroundColor",a=>a.backgroundColor)),e.baseOpacityMode!==xn.One&&t.fragment.uniforms.add(new We("baseOpacity",a=>a.baseOpacity));const r=e.baseOpacityMode===xn.OnBaseLayer,s=e.baseOpacityMode===xn.OnBackground||e.baseOpacityMode===xn.OnBaseLayer,n=e.blendMode!==Ne.Normal;t.fragment.include(aEe,e);const o=e.tileBlendInput!==Bo.LayerOnly;return(n&&!o||r)&&(t.fragment.uniforms.add(new jt("fboColor",a=>a.fboTexture)),t.fragment.uniforms.add(new We("tileSize",a=>_(a.fboTexture)?a.fboTexture.descriptor.width:1))),t.fragment.code.add(x`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${o||r?x`
          vec4 bgColor = ${r?x`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:i?x`vec4(backgroundColor, 1.0)`:x`gridColor(vuv)`};
          ${s?x`bgColor *= baseOpacity;`:""}`:""}
      ${n?x`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${o?x`bgColor;`:x`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${r?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:o||r?x`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:x`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===lw.Stretch?Eft(t,e):e.colorizerType===lw.Lut?Sft(t):e.colorizerType===lw.Hillshade&&Cft(t,e),t}function Sft(e){e.fragment.code.add(x`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Eft(e,t){e.fragment.uniforms.add([new fP("u_bandCount",r=>r.symbolizer.u_bandCount),new aa("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new aa("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new aa("u_factor",r=>r.symbolizer.u_factor,3),new We("u_minOutput",r=>r.symbolizer.u_minOutput),new We("u_maxOutput",r=>r.symbolizer.u_maxOutput),new Ow("u_useGamma",r=>r.symbolizer.u_useGamma),new aa("u_gamma",r=>r.symbolizer.u_gamma,3),new aa("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new We("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(x`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:x`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(x`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===Ww.Noop?x`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:x`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Cft(e,t){const i=e.fragment;i.uniforms.add([new jt("u_image",s=>s.u_image),new fP("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new aa("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new aa("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new aa("u_cosZs",s=>s.symbolizer.u_cosZs,6),new aa("u_weights",s=>s.symbolizer.u_weights,6),new vi("u_factor",s=>s.symbolizer.u_factor),new We("u_minValue",s=>s.symbolizer.u_minValue),new We("u_maxValue",s=>s.symbolizer.u_maxValue),new vi("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(vm),i.code.add(x`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),i.code.add(x`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?x`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:x`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(x`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Aft=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:uz,ColorizerStretchUniforms:wft,ColorizerHillshadeUniforms:xft,build:Tft},Symbol.toStringTag,{value:"Module"}));function Rft(e,t,i="nearest",r=!1){var c;const s=!(r&&t.pixelType==="u8"),n=s?Et.FLOAT:Et.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,internalFormat:e.type===pi.WEBGL2&&s?mt.RGBA32F:Ve.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?Ke.NEAREST:Ke.LINEAR,dataType:n,wrapMode:wt.CLAMP_TO_EDGE,flipped:!1};return new nt(e,l,o)}function Mft(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=t,a=i[0]>1,l={width:a?4*n:n,height:o,target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,internalFormat:e.type===pi.WEBGL2?mt.RGBA32F:Ve.RGBA,dataType:Et.FLOAT,samplingMode:Ke.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const f=4*(h*n+p),m=2*(p*o+h);c[f]=r[m],c[f+1]=r[m+1],c[f+3]=r[m]===-1?0:1}return new nt(e,l,c)}function Kle(e,t){const i={width:t.length/4,height:1,target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,internalFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,flipped:!1};return new nt(e,i,t)}function Oft(e,t,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:Zh,u_transformGridSize:e?e.size:Zh,u_targetImageSize:t,u_srcImageSize:i}}function Pft(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function Ift(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function $ft(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const ece={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class Lft{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=Ze(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?ye(F({},ece),{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||ece}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){_(t)&&t.length>0?this._bandIds&&t.every((i,r)=>!!this._bandIds[r]&&i===this._bandIds[r])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,_(this._rasterTexture)){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?Ke.LINEAR:Ke.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=Ze(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((R(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),_(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&R(this._transformGridTexture)&&(this._transformGridTexture=Mft(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:i,width:r,height:s,opacity:n}=this,o=Oft(i,[r,s],[this.source.width,this.source.height],n),a=Pft(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Ift(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?$ft(this.symbolizerParameters):null;return new uz(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(R(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(i=>_(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=Ze(this._rasterTexture),this._transformGridTexture=Ze(this._transformGridTexture),this._colormapTexture=Ze(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=Ze(this._rasterTexture));const s=R(i)&&R(this.bandIds)||_(i)&&_(this.bandIds)&&i.join("")===this.bandIds.join("");if(_(this._rasterTexture)&&s)return;this._rasterTexture=Ze(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Rft(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=Ze(this._colormapTexture),this._colormapTexture=Kle(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=Kle(t,r),void(this._colormap=r)):(this._colormapTexture=Ze(this._colormapTexture),void(this._colormap=null))}}class AN{constructor(){this.waitingAgents=new Wt,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=o8.acquire();return i._init(t),i}release(){this.dispose(),RN.delete(this),o8.release(this)}dispose(){this.loadingAgent=Ze(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=f2(this._data)}static prune(){o8.prune(0)}_init(t){this.waitingAgents.clear(),this._data=f2(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=Hh(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){_(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||R(i))this._unsetUpsampleInfo();else{if(R(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),hft(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){f2(this._data),this._data=t}}const o8=new Cs(AN,null,()=>{}),RN=new Map;function Dft(){RN.size>0&&(console.log(`${RN.size} live TilePerLayerInfo allocations:`),RN.forEach(e=>console.log(e,`
`)))}class aS{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var bt;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(bt||(bt={}));const a8=O(),rT=O(),Yn=O(),Nft=.1;class Fft{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class LJ{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=kt(),this._elevationBounds=it(),this.layerInfo=[[],[]],this.extentInRadians=kt(),this.centerAtSeaLevel=O(),this._center=[O(),En(),O()],this.up=qW(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){DJ.prune(0),NJ.prune(0),AN.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[$a.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===ME.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=Ci(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[$a.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?_o(this._elevationBounds,i.elevationBounds):yi(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of K1){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=AN.acquire(this._surface.upsampleInfoPool),s===Qt.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,pH)}release(){Rf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of K1){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const t=this.cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Qt.MAP].reduce((t,i)=>t+(i instanceof FM?i.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(_(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let t=0;for(const{data:r}of this.layerInfo[Qt.MAP])r instanceof FM?t+=this._getTerrainDataMemory(r):this._mapTileMemory+=this._getTerrainDataMemory(r);const i=this.cpuImageMemorySize;for(const r of this.layerInfo[Qt.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=Mw(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+t),this._usedMemory}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];return(r==null?void 0:r.data)?t===Qt.MAP?this.isCached?0:this._getTerrainDataMemory(r.data):t===Qt.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof aS?Mw(t.texture):t instanceof HTMLImageElement||t instanceof oz?this.cpuImageMemorySize:t instanceof FM||t instanceof Lft?t.memoryUsage:0}updateScreenDepth(t){const i=this._center[$a.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this._screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(_(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return bt.NONE;const s=this.level;pe(a8,this._center[$a.MIDDLE],i);let n=Ua(a8),o=$a.MIDDLE;pe(rT,this._center[$a.TOP],i);const a=Ua(rT);a<n&&(n=a,o=$a.TOP),pe(rT,this._center[$a.BOTTOM],i);const l=Ua(rT);if(l<n&&(n=l,o=$a.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return bt.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,f=()=>{const w=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return w!==this.vlevel?(this.vlevel=w,bt.VSPLITMERGE):bt.NONE_HIT_MAXLOD};if(r===ME.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?f():bt.SPLIT;const m=xe(this.up,a8),y=this._elevationBounds[1]-this._elevationBounds[0],v=y/this.edgeLen;if(t.aboveGround&&m>0&&v<.001&&m/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-v>0)return bt.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,bt.VSPLITMERGE):bt.NONE;if(s>=t.maxLod)return f();if(s>6){pe(rT,this._center[o],i),le(Yn,this.up,m),pe(Yn,Yn,rT);const w=Ua(Yn);if(w>this.radius*this.radius){le(Yn,Yn,this.radius/Math.sqrt(w)),de(Yn,Yn,this._center[o]),pe(Yn,i,Yn);const b=Math.min(1,(Math.abs(xe(Yn,this.up))+.5*y+this._curvatureHeight)/Me(Yn)),S=Nft/t.angledSplitBias,T=t.fovY*c*2;if(b*(this._edgeLen/T)<S*t.relativeHeightLimit)return bt.NONE}}return bt.SPLIT}setChildren(t,i,r,s){Rf(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,i;return(i=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?i:!1}prepareToLoad(t){this.refMapData();for(const i of K1)this._createOrUpdateAgents(0,i);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const i of K1){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==jl&&(cL(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(bt.GEOMETRY),this.resetPendingUpdate(bt.TEXTURE_NOFADING),this.resetPendingUpdate(bt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[Qt.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==jl&&(cL(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(Xb(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;_(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(bt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of K1){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==jl&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(bt.SPLIT)||t!==Qt.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===bt.SPLIT||t===bt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;Hh(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return Ua(pe(Yn,this._center[$a.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;Rf(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i){switch(t){case Qt.MAP:return this._updateTexture(i);case Qt.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===Vn.FADING?bt.TEXTURE_NOFADING:bt.TEXTURE_FADING),this.setPendingUpdate(t===Vn.FADING?bt.TEXTURE_FADING:bt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(bt.GEOMETRY);for(const t of this.layerInfo[Qt.ELEVATION])t.pendingUpdates|=bt.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const t=this._elevationBounds;yi(t,Number.MAX_VALUE,-Number.MAX_VALUE);const i=this.layerInfo[Qt.ELEVATION];let r=!0;for(const s of i)_(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(r=!1));r&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,i=.5*(t[0]+t[1]);le(Yn,this.up,i),de(this._center[$a.MIDDLE],this.centerAtSeaLevel,Yn),le(Yn,this.up,t[0]),de(this._center[$a.TOP],this.centerAtSeaLevel,Yn),le(Yn,this.up,t[1]),de(this._center[$a.BOTTOM],this.centerAtSeaLevel,Yn)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[Qt.ELEVATION][t];if(_(r.elevationBounds)&&r.elevationBounds.level>=i)return;const s=this._surface.layerViewByIndex(t,Qt.ELEVATION),n=Eq(s);if(!kM(this,n,!1))return;const o=Uft;let a=!1;if(r.data){const l=r.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,h=0;for(let p=this._parent;p&&(!c||h<XD(this.level))&&(h=this.vlevel-p.level,l=c||l,c=p.layerInfo[Qt.ELEVATION][t].data,!(!c&&l&&h>=XD(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(R(r.elevationBounds)&&(r.elevationBounds=new OJ),r.elevationBounds.copyFrom(o))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==jl&&(cL(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:AN.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,Vn.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===jl&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of K1){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==jl&&(r.loadingAgent.setSuspension(i),r.loadingAgent===jl&&this.updateRenderData(t,Vn.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==jl&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=jl,!r.data&&R(r.upsampleInfo)&&this._createOrUpdateAgents(t+1,i)}_createOrUpdateAgents(t,i){const r=this.layerInfo[i];if(r.length===0)return;const s=(()=>{for(let o=t;o<r.length;++o){const a=this._surface.layerViewByIndex(o,i);if(a5(a)&&a.layer.blendMode!=="normal")return!0}return!1})(),n=this._isSuspended(i);for(let o=t;o<r.length;++o){const a=r[o];let l=!1;const c=this._surface.layerViewByIndex(o,i),h=Eq(c);if(a.loadingAgent?kM(this,h,!1)?(a.loadingAgent!==jl&&a.loadingAgent.setSuspension(n),a.loadingAgent!==jl&&(l=a.loadingAgent.update())):a.dispose():kM(this,h,!1)&&(a.loadingAgent=kft(this,o,i,n),l=a.loadingAgent.startLoading(),l?a.loadingAgent===jl&&this.setPendingUpdate(bt.GEOMETRY):(cL(a.loadingAgent),a.loadingAgent=jl)),a.loadingAgent===jl&&this.updateRenderData(i,Vn.FADING),!s&&l&&c.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationBasedVerticesPerSide(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,XD(this.level)-i);return De(1+(this.maxTesselation>>r),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,i){if(!t)return null;const r=this.surface.rootTiles;if(_(r)){for(const s of r)if(zft(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){const r=this.lij,s=this.getNeighborLIJ(r,t);return s?Vft(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){const r=t===zt.NORTH_EAST?1:t===zt.NORTH_WEST?0:t===zt.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||i&&i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){var r;return(r=this.findNeighborTile(t,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(l5(t),i)}forAllSubtreeOnSide(t,i){const r=t===zt.NORTH?[0,1]:t===zt.NORTH_EAST?[1]:t===zt.EAST?[1,3]:t===zt.SOUTH_EAST?[3]:t===zt.SOUTH?[2,3]:t===zt.SOUTH_WEST?[2]:t===zt.WEST?[0,2]:[0],s=n=>{i(n)||n.isLeaf||r.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){c5.forEach(i=>this.findNeighborCornerTileExact(i,t)),cv.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||t(s)))==null?void 0:r.forAllSubtreeOnSide(EN(i),t)})}getNeighborEdgeStartVertexIndex(t,i){const r=i!=null?i:this.findNeighborTile(cv[t],h=>h.isLoaded);if(!r||!this.isLoaded||!r.isLoaded)return 0;const s=this.level-r.level;if(s===0)return 0;const n=2**s,o=(1&t)==1,a=o?0:1,l=r.lij[a+1]*n,c=this.lij[a+1]-l;return o?n-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const i=cv[t],r=this.findNeighborTile(i,s=>s.isLoaded||s.level===this.level);if(!r)continue;if(!r.isLoaded){r.isLeaf;const s=(t+2)%4,n=EN(i);r.forAllSubtreeOnSide(n,o=>o.isLoaded?(o.updateEdgeAfterResolutionChange(s),!0):(o.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this.forEachLoadedNeighbor(i=>this._updateNeighbor(i)),cv.forEach(i=>{var r;(r=this.findNeighborTile(i,s=>s.isLoaded&&s.level<t))==null||r.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}forEachLoadedNeighbor(t){const i=this.level,r=s=>s.level===i||s.isLoaded;cv.forEach((s,n)=>{var l,c;const o=this.findNeighborTile(s,r);o!=null&&o!==this&&o.forAllSubtreeOnSide(EN(s),h=>!!h.isLoaded&&(t(h),!0));const a=(c=(l=this.renderData)==null?void 0:l.geometryState)==null?void 0:c.neighborData;a&&(a.modifiedEdgeResolutions[n]=!1)}),c5.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(l5(s),a=>a.isLoaded);!n||Bft(this,n,s),(n==null?void 0:n.isLoaded)&&t(n)})}_updateNeighbor(t){(t==null?void 0:t.isLoaded)&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,i){const r=zle(i)?-1:Ule(i)?1:0,s=Fle(i)?-1:kle(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Ct>=this.surface.extent[1]}compareLIJs(t){const i=this.lij,r=i[0],s=t[0];if(r===s)return[i,t];const n=r-s;if(n<0){const o=2**-n;return[[s,i[1]*o,i[2]*o],t]}{const o=2**n;return[i,[r,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(zle(t)&&i[3]+s>=r[3]||Ule(t)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Fle(t)&&i[0]-s<=r[0])&&!(!n&&kle(t)&&i[2]+s>=r[2])}}function kft(e,t,i,r){const s=i===Qt.ELEVATION?NJ.acquire():DJ.acquire();return s.init(e,t,i,r),s}function cL(e){e.dispose(),e instanceof rEe?NJ.release(e):e instanceof sEe&&DJ.release(e)}const DJ=new Cs(sEe),NJ=new Cs(rEe),Uft=new OJ;var $a;function zft(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function Vft(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function l8(e,t,i){return Math.abs(e-t)<=i}function Bft(e,t,i){return!R(e)&&!R(t)&&t!==e&&(e.level>=t.level?tce(e,t,i):tce(t,e,l5(i)))}function tce(e,t,i){e.level>=t.level;const r=fpt(i),s=mpt(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=l8(a[0],l[0],c)||e.surface.isGlobal&&l8(a[0],-l[0],c),p=l8(a[1],l[1],c);return h&&p?!0:e.level===t.level||!h&&!p?!1:h?ice(o[1],o[3],n[1],n[3],c):ice(o[0],o[2],n[0],n[2],c)}function ice(e,t,i,r,s=Ct){return e-s<=i&&i<=r&&r<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})($a||($a={}));class Gft{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}class Ig{constructor(){this.geometryInfo=new ift,this.intersectionData=null,this.geometryState=null,this._textureRef=new m2(()=>this.tile.surface.textureFadeDuration),this.overlay=new Gft,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(t){this._tile=t,this.clear();const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,mr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new lft,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(t,i){const r=this.updateGeometryStateAndPrepareForGeometryGeneration(i);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(r,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,i=this.vao.context){const r=this._updateNeighborData(),s=t||this._geometryStateChangedSinceLastUpdate||r;return s&&(this._updateGeometry(i),this._geometryStateChangedSinceLastUpdate=!1),s}_calculateEdgeResolution(t,i){var c;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const h=r.surface.extent;if(_(h)&&(t===0&&r.extent[3]>h[3]||t===1&&r.extent[2]>h[2]||t===2&&r.extent[1]<h[1]||t===3&&r.extent[0]<h[0]))return s}const n=r.level,o=cv[t],a=i||r.findNeighborTile(o,h=>h.isLoaded||h.level===n);if(!a||a.isLeaf&&!a.isLoaded)return R((c=r.surface)==null?void 0:c.rootTiles)||r.surface.updatingRootTiles||r.shouldHaveNeighbor(o),s;if(a.isLoaded){const h=a,p=h.renderData.geometryState,f=n-h.level;if(f===0){const v=p.numVerticesPerSide-1;return Math.max(v,s)}const m=2**f,y=p.neighborData.edgeResolutions[(t+2)%4]/m;return Math.max(1,y)}a.isLeaf;let l=s;return a.forAllSubtreeOnSide(EN(o),h=>h===r||(h.isLoaded?(l=Math.max(l,2**(h.level-n)),!0):(h.isLeaf,!1))),l}_updateNeighborData(){const t=this.tile,i=c=>c.isLoaded||c.level===t.level,r=c=>c.isLoaded,s=[null,null,null,null],n=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const h=t.findNeighborTile(cv[c],i);s[c]=h,n[c]=(h==null?void 0:h.isLoaded)?h:null}})();const o=[null,null,null,null];(()=>{for(let c=0;c<4;++c)o[c]=t.findNeighborTile(c5[c],r)})();const a=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const h=a.edgeResolutions[c],p=s[c],f=this._calculateEdgeResolution(c,p);a.edgeResolutions[c]=f,h!==f&&(l=!0,this._edgeResolutionChanged=!0,p&&p!==t&&!p.isLoaded&&p.level===t.level&&(a.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=(f,m)=>{var b,S;const y=f.reduce((T,E)=>{var C;return Math.min(T,(C=E==null?void 0:E.level)!=null?C:1/0)},1/0);for(let T=0;T<4;++T){const E=f[(T+3)%4],C=f[T];if(E&&E.level<t.level&&E===C){const A=E,I=(1&T)==1,D=(t.getNeighborEdgeStartVertexIndex(T,A)+(m===0||m===1&&!I||m===3&&I?1:0))/2**(t.level-A.level),L=I?m===0||m===1?A.extent[0]:A.extent[2]:Yt(A.extent[0],A.extent[2],D),z=I?Yt(A.extent[1],A.extent[3],D):m===0||m===3?A.extent[1]:A.extent[3];return wr(L,z,A.renderData.geometryState.samplerData)}}let v=0,w=0;for(let T=0;T<4;++T){const E=f[T];if(E&&E.level===y){const C=T===0||T===1,A=T===0||T===3,I=E.extent;w+=wr(I[C?0:2],I[A?1:3],(S=(b=E.renderData)==null?void 0:b.geometryState)==null?void 0:S.samplerData),v++}}return v?w/v:0},h=a.cornerNeighborData,p=(f,m)=>{var b;const y=h[f],v=y.cornerTiles;for(let S=0;S<4;++S){const T=c5[S],E=(b=m[S])==null?void 0:b.findCorner(l5(T),C=>(C==null?void 0:C.isLoaded)||C===t);v[S]=E}const w=c(v,f);return y.elevation!==w&&(y.elevation=w,!0)};for(let f=0;f<4;++f){const m=o[f],y=n[f],v=[m,n[(f+1)%4],t,y],w=v.map((b,S)=>v[(S+4-f)%4]);p(f,w)&&(this._cornerElevationChanged=!0,l=!0)}})(),(()=>{var p;const c=(f,m)=>{if(!(f==null?void 0:f.isLoaded)||f.lij[0]>t.lij[0])return null;const y=f.renderData.geometryState;return{neighborSamplerData:y.samplerData,neighborEdgeOverlapResolution:y.neighborData.edgeResolutions[m+2],version:y.samplerDataVersion,neighborVerticesPerSide:y.numVerticesPerSide,neighborTile:f}},h=a.edgeNeighbours;for(let f=0;f<4;++f){const m=n[f];m&&(m==null||m.isLoaded,(m==null?void 0:m.lij[0])<=t.lij[0],void 0);const y=h[f],v=y==null?void 0:y.version,w=c(m,f),b=(p=w==null?void 0:w.version)!=null?p:null,S=y!=null!=(w!=null),T=y&&w&&v!==b,E=y&&w&&(y==null?void 0:y.neighborTile)!==(w==null?void 0:w.neighborTile),C=S||T||E;this._edgeNeighborChanged||(this._edgeNeighborChanged=C),l||(l=C),!C&&v||(h[f]=w)}})(),l}updateEdgeAfterResolutionChange(t){var n,o;const i=this._calculateEdgeResolution(t),r=this.geometryState.neighborData.edgeResolutions,s=r[t];((o=(n=this.geometryState.neighborData.edgeNeighbours[t])==null?void 0:n.neighborTile.level)!=null?o:0)<=this.tile.level,i!==s&&(r[t]=i,this._edgeResolutionChanged=!0,Ig.deferTileNeighborUpdate?Ig.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(t){this.intersectionData=null;const i=this.tile,r=i.lij,s=Ig.updatedGeometryTiles.get(r)||0;Ig.updatedGeometryTiles.set(r,s+1);const n=this._vao,o=this.geometryInfo.vertexAttributes,a=!n||!o||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,l=!a&&this._edgeNeighborChanged,c=!l&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,a?(this._releaseGeometry(),this._createGeometry(t)):l?i.updateEdgeElevations():c?i.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,i){return _(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),R(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){_(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const i=this._getElevationInfo(),r=i.samplerData?this.tile.getElevationBasedVerticesPerSide(i.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(r,5);let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;return o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),i.changed&&(this._samplerDataChanged=!0,o.samplerData=i.samplerData,o.samplerDataVersion++,a=!0),Hv(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0),o.wireframe!==t&&(this._wireframeChanged=!0,o.wireframe=t,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),this._hasGeometry=!0,a}_createGeometry(t){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new Hs(t,Ui,{geometry:Dc(i.layout)},{geometry:oi.createVertex(t,s.STATIC_DRAW,i.buffer)},oi.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,nft(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,i=Hg.Immediate){_(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[Qt.ELEVATION],r=i.length;let s=new Array(r),n=0,o=0,a=!1;for(let l=0;l<r;l++){const c=i[l];if(_(c.upsampleInfo)){const h=c.upsampleInfo.tile,p=h.layerInfo[Qt.ELEVATION][l].data,f=p&&p.samplerData;t&&t[n]===f||(a=!0),s[n++]=f,o=Math.max(o,h.lij[0])}else if(c.data){const h=this.tile.surface.layerViewByIndex(l,Qt.ELEVATION);if(kM(this.tile,h.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return _(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=gu(this.intersectionData,0,i=>i.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return _(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}Ig.updatedGeometryTiles=new Map,Ig.deferTileNeighborUpdate=!1,Ig.neighborTilesToUpdate=new Set;const jft=65536;function Hft(e,t){const i=e.tile,{extent:r,extentInRadians:s,surface:n}=i,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shadingEnabled,h=a.numVerticesPerSide,p=h-1,f=(h-2)**2,m=l&&(t===Ph.HAS_SOUTH_POLE||t===Ph.HAS_BOTH_POLES),y=l&&(t===Ph.HAS_NORTH_POLE||t===Ph.HAS_BOTH_POLES),v=6,w=((m?1:0)+(y?1:0))*v*(p+1),b=a.neighborData,S=b.edgeResolutions.reduce((ee,q)=>ee+q+1,0),T=J2e(f+w+S),E=e.geometryInfo;E.numVerticesPerSide=a.numVerticesPerSide,E.vertexAttributes=T,Ji(E.uvOffsetAndScale,0,0,1,1);const C=T.position.typedBuffer,A=T.uv0.typedBuffer,I=T.normal.typedBuffer,D=E.boundingBox;mr(D);const L=o[0],z=o[1],B=o[2];c1.update(p,s);let V=0;const Q=a.samplerData,Z=i.ellipsoid.radius,ce=kJ(e),oe=h-2,$=r[0],U=r[2],G=r[1],W=r[3];(()=>{for(let ee=1;ee<=oe;ee++){const q=ee/p,te=G*(1-q)+W*q,ge=ce(q),Te=Math.cos(ge),ke=Math.sin(ge);for(let _e=1;_e<=oe;_e++){const me=_e/p,Ce=$*(1-me)+U*me,Fe=c1.sinLonLUT[_e],Li=c1.cosLonLUT[_e],zi=Z+wr(Ce,te,Q),li=Li*Te*zi-L,Vi=Fe*Te*zi-z,hi=ke*zi-B;qg(li,Vi,hi,D);const Bi=bh*V;C[Bi+0]=li,C[Bi+1]=Vi,C[Bi+2]=hi,A[Bi+0]=me,A[Bi+1]=q,++V}}})(),c&&(()=>{const ee=_e=>(pe(Wg,_e,c8),ct($E,Wg,jv),ct(LE,$E,Wg),LE),q=T.position,te=T.normal;V=0;const ge=_e=>{q.getVec(_e,vc),de(fs,fs,ee(vc))},Te=(_e,me)=>{{const Ce=_e/p,Fe=$*(1-Ce)+U*Ce,Li=c1.sinLonLUT[_e],zi=c1.cosLonLUT[_e],li=me/p,Vi=G*(1-li)+W*li,hi=ce(li),Bi=Math.cos(hi),qr=Math.sin(hi),cs=Z+wr(Fe,Vi,Q);se(vc,zi*Bi*cs-L,Li*Bi*cs-z,qr*cs-B)}de(fs,fs,ee(vc))},ke=(_e,me,Ce)=>{_e>1&&me>1&&_e<oe&&me<oe?ge(V+Ce):Te(_e,me)};for(let _e=1;_e<=oe;_e++)for(let me=1;me<=oe;me++)q.getVec(V,c8),de(Df,c8,e.localOrigin),we(jv,Df),se(fs,0,0,0),ke(me-1,_e,-1),ke(me+1,_e,1),ke(me,_e-1,-oe),ke(me,_e+1,+oe),we(fs,fs),te.setVec(V,fs),++V})(),V=f,cEe(e,f),mEe(e),V=f+S;const X=[];(()=>{const ee=(q,te)=>{const ge=te*h;qg(-L,-z,q*Z-B,D),X.push({connectedRowOffset:ge,connectedOuterEdgeOffset:q===1?0:2,rowOffset:V,latitudeResolution:v});const Te=yEe(q===-1?G:W,Z),ke=q*Math.PI/2-Te,_e=.99*(q===1?1:-1),me=Z+0;for(let Ce=1;Ce<=v;++Ce){const Fe=Te+ke*(Ce/v),Li=Math.cos(Fe),zi=Math.sin(Fe);for(let li=0;li<=p;li++){const Vi=li/p,hi=c1.sinLonLUT[li],Bi=c1.cosLonLUT[li]*Li*me-L,qr=hi*Li*me-z,cs=zi*me-B;qg(Bi,qr,cs,D);const st=bh*V;if(C[st+0]=Bi,C[st+1]=qr,C[st+2]=cs,A[st+0]=Vi,A[st+1]=_e,c){const Pr=1/Math.sqrt(Bi*Bi+qr*qr+cs*cs);I[st+0]=Pr*Bi,I[st+1]=Pr*qr,I[st+2]=Pr*cs}++V}}};m&&ee(-1,0),y&&ee(1,p)})(),lEe(E,a.numVerticesPerSide,X,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null;for(let ee=0;ee<4;++ee)E.outerEdges[ee].count,b.edgeResolutions[ee]+1}function qft(e,t){const i=e.tile,r=i.extent,s=e.localOrigin,n=e.geometryState,o=i.surface,a=o.isWebMercatorOnPlateeCarree,l=o.shadingEnabled,c=r[0],h=r[1],p=r[2]-c,f=r[3]-h,m=n.clippingArea,y=_(m)?Math.max(0,(m[0]-r[0])/p):0,v=_(m)?Math.max(0,(m[1]-r[1])/f):0,w=_(m)?Math.min(1,(m[2]-r[0])/p):1,b=_(m)?Math.min(1,(m[3]-r[1])/f):1,S=w-y,T=b-v,E=S>0?1/S:1,C=T>0?1/T:1,A=-y*E,I=-v*C,D=n.numVerticesPerSide,L=D-1,z=(D-2)**2+n.neighborData.edgeResolutions.reduce((Te,ke)=>Te+ke+1,0),B=J2e(z),V=B.position.typedBuffer,Q=B.uv0.typedBuffer,Z=B.normal.typedBuffer,ce=e.geometryInfo,oe=ce.boundingBox;mr(oe);let $=0;const U=i.ellipsoid.radius,G=n.samplerData,W=_(m)?m:wEe,X=tX(Math.max(r[0],W[0]),Math.max(r[1],W[1]),Math.min(r[2],W[2]),Math.min(r[3],W[3])),ee=s[0],q=s[1],te=s[2],ge=vP(a,U,t);(()=>{for(let Te=1;Te<=L-1;Te++){const ke=Te/L,_e=I+ke*C,me=De(h+ke*f,X[1],X[3]),Ce=De(_e,0,1),Fe=ge(me)-q,Li=p/L;for(let zi=1;zi<=L-1;zi++){const li=zi/L,Vi=A+li*E,hi=De(c+li*p,X[0],X[2]),Bi=De(Vi,0,1),qr=wr(hi,me,G),cs=hi*t-ee,st=qr-te;qg(cs,Fe,st,oe);const Pr=bh*$;if(V[Pr+0]=cs,V[Pr+1]=Fe,V[Pr+2]=st,Q[Pr+0]=Bi,Q[Pr+1]=Ce,l){const Xn=wr(hi+Li,me,G),Za=wr(hi-Li,me,G),ma=wr(hi,me+Li,G),nd=.25*(Za-Xn),od=.25*(wr(hi,me-Li,G)-ma),ga=Li,S_=Math.sqrt(nd*nd+od*od+ga*ga);Z[Pr+0]=nd/S_,Z[Pr+1]=od/S_,Z[Pr+2]=ga/S_}++$}}})(),ce.numVerticesPerSide=n.numVerticesPerSide,ce.vertexAttributes=B,Ji(e.geometryInfo.uvOffsetAndScale,y,v,w-y,b-v),cEe(e,$),uEe(e,t),$=z,lEe(ce,n.numVerticesPerSide,[],[0,D-1],[0,D-1],n.wireframe),e.intersectionData=null}function lEe(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=cv.map((b,S)=>S===0&&s[1]<t-2||S===1&&r[1]<t-2||S===2&&s[0]>1||S===3&&r[0]>1),h=3*(l+e.outerEdges.reduce((b,S,T)=>b+(c[T]?0:o-2+S.count-1),0)+i.reduce((b,S)=>b+o*(2*(S.latitudeResolution-1)+1),0))*(n?2:1),p=new(a>jft?Uint32Array:Uint16Array)(h);let f=0;const m=n?(b,S,T)=>{p[f++]=b,p[f++]=S,p[f++]=S,p[f++]=T,p[f++]=T,p[f++]=b}:(b,S,T)=>{p[f++]=b,p[f++]=S,p[f++]=T},y=t-2,v=o-2;(()=>{for(let b=Math.max(s[0],1)-1;b<Math.min(s[1],t-2)-1;++b)for(let S=Math.max(r[0],1)-1;S<Math.min(r[1],t-2)-1;++S){const T=b*y+S,E=T+1,C=E+y,A=C-1;m(T,E,C),m(C,A,T)}})(),(()=>{for(let b=0;b<4;++b){if(c[b])continue;const S=e.outerEdges[b],T=e.innerEdges[b];let E=0,C=0;const A=S.count,I=T.count;S.count;const D=b===1||b===2?(L,z,B)=>m(L,z,B):(L,z,B)=>m(L,B,z);for(;E<A-1||C<I-1;){const L=T.getVertexOffset(C),z=S.getVertexOffset(E),B=E<A-1,V=C<I-1,Q=B?0+o*(E+.5)/(A-1):0,Z=V?1+v*(C+.5)/(I-1):0;B&&(!V||Q<=Z)?(++E,D(L,z,S.getVertexOffset(E))):(++C,D(L,z,T.getVertexOffset(C)))}}})();const w=b=>{let S=e.outerEdges[b.connectedOuterEdgeOffset].offset0;for(let T=0;T<b.latitudeResolution;++T){const E=T===0?b.rowOffset:S+t;for(let C=0;C<o;C++)m(S,S+1,E+C),T<b.latitudeResolution-1&&m(S+1,E+C+1,E+C),++S;S=E}};i.forEach(w),e.indices=p,e.indexCount=h}function cEe(e,t){const i=e.localOrigin,r=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes.position.typedBuffer;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new Yle(o,i,h,p,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new Yle(o,i,c,1,h),a+=h}}}function Wft(e){var r,s;dEe(e),vEe(e);const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function Xft(e){mEe(e),FJ(e)}function Zft(e,t){pEe(e,t),_Ee(e,t),FJ(e)}function Yft(e,t){uEe(e,t),FJ(e)}function uEe(e,t){pEe(e,t),rmt(e,t),_Ee(e,t)}function hEe(e,t,i,r,s){const n=Math.cos(i),o=Math.sin(i),a=Math.sin(t),l=Math.cos(t),c=s+r;e[0]=l*n*c,e[1]=a*n*c,e[2]=o*c}function Qft(e,t,i,r,s,n){const o=s[i===0?1:3];hEe(e,s[t===0?0:2],o,r,n)}function Jft(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function Kft(e,t){return e*t}function vP(e,t,i){return e?r=>Jft(r,t):r=>Kft(r,i)}function emt(e,t,i,r,s,n,o){const a=t===0?s[0]:s[2],l=i===0?s[1]:s[3],c=r;e[0]=a*n,e[1]=o(l),e[2]=c}function tmt(e,t){const i=e.geometryState,r=e.tile,s=r.extent,n=vt(i.clippingArea,s),o=e.geometryInfo,a=o.boundingBox,l=o.outerEdges,c=i.neighborData.cornerNeighborData,h=o.uvOffsetAndScale[0],p=o.uvOffsetAndScale[1],f=o.uvOffsetAndScale[2],m=o.uvOffsetAndScale[3],y=f>0?1/f:1,v=m>0?1/m:1,w=-h*y,b=-p*v,S=r.surface.isWebMercatorOnPlateeCarree,T=vP(S,S?r.ellipsoid.radius:0,t),E=i.samplerData,C=i.neighborData.edgeNeighbours,A=e.localOrigin,I=(D,L,z,B,V)=>{const Q=s[0]*(1-B)+s[2]*B,Z=s[1]*(1-V)+s[3]*V,ce=De(Q,n[0],n[2]),oe=De(Z,n[1],n[3]),$=[oe===s[3],ce===s[2],oe===s[1],ce===s[0]],U=!$[3]&&!$[1]||!$[0]&&!$[2],G=U?$[0]&&_(C[0])?C[0]:$[1]&&_(C[1])?C[1]:$[2]&&_(C[2])?C[2]:$[3]&&_(C[3])?C[3]:null:null,W=U?G?G.neighborTile.level===r.level?.5*(wr(ce,oe,E)+wr(ce,oe,G.neighborSamplerData)):wr(ce,oe,G.neighborSamplerData):wr(ce,oe,E):c[z].elevation,X=ce*t-A[0],ee=T(oe)-A[1],q=W-A[2];qg(X,ee,q,a);const te=De(w+B*y,0,1),ge=De(b+V*v,0,1);D.setVertexRawXYZUV(L,X,ee,q,te,ge)};for(let D=0;D<4;++D){const L=l[D];I(L,0,D===0?3:D===1?1:2,D===1?1:0,D===0?1:0);const z=D===2?1:D===3?3:0,B=D===3?0:1,V=D===2?0:1;I(L,L.count-1,z,B,V)}}function dEe(e){fEe(e,(t,i,r,s)=>Qft(t,i,r,s,e.tile.extentInRadians,e.tile.ellipsoid.radius))}function pEe(e,t){const i=e.tile;_(i.renderData.geometryState.clippingArea)?tmt(e,t):fEe(e,(r,s,n,o)=>emt(r,s,n,o,e.tile.extent,t,vP(i.surface.isWebMercatorOnPlateeCarree,i.ellipsoid.radius,t)))}function fEe(e,t){const i=e.geometryInfo,r=i.outerEdges,s=e.geometryState.neighborData.cornerNeighborData,n=i.boundingBox,o=e.localOrigin,a=(l,c,h,p,f)=>{t(Ky,h,p,s[c].elevation);for(let m=0;m<3;++m)Ky[m]-=o[m];qg(Ky[0],Ky[1],Ky[2],n),l.setVertexRawXYZUV(f,Ky[0],Ky[1],Ky[2],h,p)};for(let l=0;l<4;++l){const c=r[l];a(c,l===0?3:l===1?1:2,l===1?1:0,l===0?1:0,0),a(c,l===2?1:l===3?3:0,l===3?0:1,l===2?0:1,c.count-1)}}function FJ(e){var r,s;const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function mEe(e){dEe(e);for(let t=0;t<4;++t)imt(e,t);vEe(e)}function imt(e,t){var EP,CP,AP;const i=e.geometryState,r=i.neighborData,s=e.tile;s.level;const n=s.extent,o=n[2]-n[0],a=n[3]-n[1],l=s.extentInRadians,c=l[0];l[1];const h=l[2];l[3];const p=s.ellipsoid.radius,f=kJ(e),m=Ii=>{if(!Ii)return 0;const qo=v,wo=w?0:1,Ul=Ii.lij[wo+1]*L,E_=s.lij[wo+1]-Ul;return(w?L-1-E_:E_)*qo},y=r.edgeNeighbours[t],v=r.edgeResolutions[t],w=t===1||t===3,b=t===1?1:0,S=t===0?1:0,T=n[0]+b*o,E=n[1]+S*a,C=c*(1-b)+h*b,A=f(S),I=y==null?void 0:y.neighborTile,D=s.level-((EP=I==null?void 0:I.level)!=null?EP:s.level),L=2**D,z=v*L,B=m(I),V=I==null?void 0:I.extent,Q=(t+2)%4,Z=i.samplerData,ce=(AP=(CP=I==null?void 0:I.renderData)==null?void 0:CP.geometryState)==null?void 0:AP.samplerData,oe=I&&D===0,$=(Ii,qo,wo,Ul)=>.5*(wr(Ii,qo,ce)+wr(wo,Ul,Z)),U=(Ii,qo)=>wr(Ii,qo,ce),G=oe?$:U;let W=V?Q===1?V[2]:V[0]:T,X=V?Q===0?V[3]:V[1]:E;const ee=(Ii,qo,wo)=>{const Ul=(B+Ii)/z;return X=V[1]*(1-Ul)+V[3]*Ul,G(W,X,qo,wo)},q=(Ii,qo,wo)=>{const Ul=(B+Ii)/z;return W=V[0]*(1-Ul)+V[2]*Ul,G(W,X,qo,wo)},te=I?w?ee:q:(Ii,qo,wo)=>wr(qo,wo,Z),ge=(Ii,qo,wo)=>te(Ii,qo,wo);let Te=b,ke=T,_e=C,me=S,Ce=E,Fe=A,Li=Math.sin(_e),zi=Math.cos(_e),li=Math.cos(Fe),Vi=Math.sin(Fe);const hi=w?()=>f(me):()=>A,Bi=w?Ii=>{me=Ii,Ce=n[1]*(1-Ii)+n[3]*Ii,Fe=hi(),li=Math.cos(Fe),Vi=Math.sin(Fe)}:Ii=>{Te=Ii,ke=n[0]*(1-Ii)+n[2]*Ii,_e=c*(1-Te)+h*Te,Li=Math.sin(_e),zi=Math.cos(_e)},qr=e.geometryInfo,cs=qr.boundingBox,st=qr.vertexAttributes,Pr=st.position.typedBuffer,Xn=st.uv0.typedBuffer,Za=st.normal.typedBuffer,ma=qr.outerEdges[t];let nd=ma.getVertexOffset(1);const od=v+1,ga=e.localOrigin,S_=ga[0],$z=ga[1],Lz=ga[2],wP=s.surface.shadingEnabled,xP=t===1?-1:t===3?1:0,TP=t===0?-1:t===2?1:0,SP=o/v,Dz=xP*SP,Nz=TP*SP,Fz=xP*(1/v),kz=TP*(1/v),fC=Ii=>{Cc(Wg,Ii,Df),ct($E,Wg,jv),ct(LE,$E,Wg),de(fs,fs,LE)};for(let Ii=1;Ii<od-1;++Ii){Bi(Ii/v);const qo=ge(Ii,ke,Ce),wo=p+qo,Ul=zi*li*wo,E_=Li*li*wo,RP=Vi*wo,MP=Ul-S_,OP=E_-$z,PP=RP-Lz;qg(MP,OP,PP,cs);const Op=bh*nd;if(Pr[Op+0]=MP,Pr[Op+1]=OP,Pr[Op+2]=PP,Xn[Op+0]=Te,Xn[Op+1]=me,wP){se(fs,0,0,0),se(Df,Ul,E_,RP),we(jv,Df);const ue=(Ir,mx)=>{const Gu=wr(ke+Ir*Dz,Ce+Ir*Nz,mx),C_=p+Gu,ht=Te+Ir*Fz,A_=c*(1-ht)+h*ht,Cn=Math.sin(A_),R_=Math.cos(A_),IP=f(me+Ir*kz),ad=Math.sin(IP),mC=Math.cos(IP),$P=Ue(R_*mC*C_,Cn*mC*C_,ad*C_);fC($P)};I&&ue(-1,ce),I&&!oe||ue(1,Z),Za[Op+0]=fs[0],Za[Op+1]=fs[1],Za[Op+2]=fs[2]}++nd}if(wP)for(let Ii=1;Ii<od-1;++Ii)ma.getVertexRawNormal(fs,Ii),ma.getVertex(Df,Ii),we(jv,Df),ma.getVertex(vc,Ii-1),fC(vc),ma.getVertex(vc,Ii+1),fC(vc),we(fs,fs),ma.setVertexRawNormal(Ii,fs[0],fs[1],fs[2])}function rmt(e,t){const i=e.geometryState.clippingArea,r=e.tile.extent,s=_(i)&&(r[0]<i[0]||r[2]>i[2]||r[1]<i[1]||r[3]>i[3])?nmt:smt;for(let n=0;n<4;++n)s(e,n,t)}function gEe(e,t,i,r,s,n,o){return o===s?!e||t?(a,l)=>wr(a,l,i):null:o===n&&e?(a,l)=>wr(a,l,r):null}function u5(e,t,i,r){if(t!==e)return()=>0;const s=t?3:2,n=t?1:0,o=r(s,n),a=r(n,s),l=(o!=null?1:0)+(a!=null?1:0),c=t?i:0,h=t?0:i;return(p,f,m)=>((o!=null?-(o(p+c,f+h)-m):0)+(a!=null?+(a(p-c,f-h)-m):0))/l}function smt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,y=p+1,v=c,w=e.localOrigin,b=m.samplerData,S=(q,te)=>wr(q,te,b),T=(q,te)=>.5*(wr(q,te,v.neighborSamplerData)+wr(q,te,b)),E=(q,te)=>wr(q,te,v.neighborSamplerData),C=(v==null?void 0:v.neighborTile.level)===o,A=C?T:E,I=_(v)?A:S,D=e.geometryInfo,L=D.outerEdges[t],z=vP(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),B=D.boundingBox,V=t===1||t===3,Q=t===1?f[2]:f[0],Z=t===0?f[3]:f[1],ce=t===1?1:0,oe=t===0?1:0,$=(f[2]-f[0])/h,U=v==null?void 0:v.neighborSamplerData,G=_(v),W=(q,te)=>gEe(G,C,b,U,q,te,t),X=u5(V,!0,$,W),ee=u5(V,!1,$,W);for(let q=1;q<y-1;++q){const te=q/p,ge=V?Q:f[0]*(1-te)+f[2]*te,Te=V?f[1]*(1-te)+f[3]*te:Z,ke=V?ce:te,_e=V?te:oe,me=I(ge,Te),Ce=ge*i-w[0],Fe=z(Te)-w[1],Li=me-w[2];if(qg(Ce,Fe,Li,B),l){const zi=X(ge,Te,me),li=ee(ge,Te,me),Vi=$;L.setVertexRawXYZUVN(q,Ce,Fe,Li,ke,_e,zi,li,Vi)}else L.setVertexRawXYZUV(q,Ce,Fe,Li,ke,_e)}if(l){const q=V?0:1,te=V?1:0;for(let ge=1;ge<y-1;++ge){L.getNormal(g2,ge);const Te=L.getVertexZ(ge-1)-L.getVertexZ(ge+1),ke=g2[0]+.5*q*Te,_e=g2[1]+.5*te*Te,me=2*$,Ce=1/Math.sqrt(ke*ke+_e*_e+me*me);L.setVertexRawNormal(ge,Ce*ke,Ce*_e,Ce*me)}}}function nmt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,f=n.extent,m=e.geometryState,y=vt(m.clippingArea,wEe),v=e.geometryInfo,w=v.uvOffsetAndScale[0],b=v.uvOffsetAndScale[1],S=w+v.uvOffsetAndScale[2],T=b+v.uvOffsetAndScale[3],E=S>w?1/(S-w):1,C=T>b?1/(T-b):1,A=-w*E,I=-b*C,D=p+1,L=[f[3]>y[3],f[2]>y[2],f[1]<y[1],f[0]<y[0]],z=c,B=m.samplerData,V=(li,Vi)=>wr(li,Vi,B),Q=(z==null?void 0:z.neighborTile.level)===o,Z=(li,Vi)=>{const hi=wr(li,Vi,z.neighborSamplerData);return Q?.5*(hi+wr(li,Vi,B)):hi},ce=V,oe=_(z)?Z:V,$=L[t]?ce:oe,U=v.outerEdges[t],G=v.boundingBox,W=t===1||t===3,X=De(t===1?f[2]:f[0],y[0],y[2]),ee=De(t===0?f[3]:f[1],y[1],y[3]),q=t===1?1:0,te=t===0?1:0,ge=e.localOrigin,Te=vP(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),ke=(f[2]-f[0])/h,_e=z==null?void 0:z.neighborSamplerData,me=_(z),Ce=(z==null?void 0:z.neighborTile.level)===o,Fe=(li,Vi)=>gEe(me,Ce,B,_e,li,Vi,t),Li=u5(W,!0,ke,Fe),zi=u5(W,!1,ke,Fe);for(let li=1;li<D-1;++li){const Vi=li/p,hi=W?X:De(f[0]*(1-Vi)+f[2]*Vi,y[0],y[2]),Bi=W?De(f[1]*(1-Vi)+f[3]*Vi,y[1],y[3]):ee,qr=W?q:De(A+Vi*E,0,1),cs=W?De(I+Vi*C,0,1):te,st=$(hi,Bi),Pr=hi*i-ge[0],Xn=Te(Bi)-ge[1],Za=st-ge[2];if(qg(Pr,Xn,Za,G),l){const ma=Li(hi,Bi,st),nd=zi(hi,Bi,st),od=ke;U.setVertexRawXYZUVN(li,Pr,Xn,Za,qr,cs,ma,nd,od)}else U.setVertexRawXYZUV(li,Pr,Xn,Za,qr,cs)}if(l){const li=W?0:1,Vi=W?1:0;for(let hi=1;hi<D-1;++hi){U.getNormal(g2,hi);const Bi=U.getVertexZ(hi-1)-U.getVertexZ(hi+1),qr=g2[0]+.5*li*Bi,cs=g2[1]+.5*Vi*Bi,st=2*ke,Pr=1/Math.sqrt(qr*qr+cs*cs+st*st);U.setVertexRawNormal(hi,Pr*qr,Pr*cs,Pr*st)}}}function yEe(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function omt(e,t,i,r){return yEe(e+r*(t-e),i)}function amt(e,t,i){return e*(1-i)+t*i}function kJ(e){const t=e.tile;if(t.surface.isWebMercator){const r=t.extent,s=t.ellipsoid.radius;return n=>omt(r[1],r[3],s,n)}const i=t.extentInRadians;return r=>amt(i[1],i[3],r)}function vEe(e){e.tile.surface.shadingEnabled&&bEe(e,(t,i,r,s,n,o,a)=>lmt(i,t,r,s,n,o,a))}function _Ee(e,t){e.tile.surface.shadingEnabled&&bEe(e,(i,r,s,n,o,a,l)=>cmt(hmt(e,t),i,s,o,a,l))}function lmt(e,t,i,r,s,n,o){umt(e,vc,s,n,o),Cc(Wg,vc,i),ct($E,Wg,r),ct(t,$E,Wg)}function cmt(e,t,i,r,s,n){e(vc,r,s,n);const o=vc[0]-i[0],a=vc[1]-i[1],l=vc[2]-i[2];t[0]=-o*l,t[1]=-a*l,t[2]=o*o+a*a}function umt(e,t,i,r,s){const n=kJ(e),o=e.tile,a=o.extent;UA(a,i,r,1);const l=(i-a[0])/(a[2]-a[0]),c=(r-a[1])/(a[3]-a[1]),h=o.extentInRadians;hEe(t,h[0]*(1-l)+h[2]*l,n(c),s,o.ellipsoid.radius)}function hmt(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(i,r,s,n)=>pmt(t,e.tile.ellipsoid.radius,i,r,s,n):(i,r,s,n)=>dmt(t,i,r,s,n)}function dmt(e,t,i,r,s){t[0]=i*e,t[1]=r*e,t[2]=s}function pmt(e,t,i,r,s,n){i[0]=r*e,i[1]=(Math.PI/2-2*Math.atan(Math.exp(-s/t)))*t,i[2]=n}function bEe(e,t){var o;if(!e.tile.surface.shadingEnabled)return;const i=e.geometryState.neighborData.cornerNeighborData,r=e.tile,s=r.extent,n=((o=e.tile.surface.view)==null?void 0:o.viewingMode)==="local";n&&se(jv,0,0,1);{const a=(v,w,b,S)=>{t(LE,v.renderData,Df,jv,w,b,S),de(fs,fs,LE)},c=(v,w,b,S,T,E)=>{const C=E===1?T.extent[0]:E===3?T.extent[2]:v,A=E===0?T.extent[1]:E===2?T.extent[3]:w,I=C+sT[b][0]*S,D=A+sT[b][1]*S;UA(T.extent,I,D,1);const L=wr(I,D,T.renderData.geometryState.samplerData);a(T,I,D,L)},h=(v,w,b)=>v.extent[w===0||w===1?2:0]+b,p=(v,w,b)=>v.extent[w===0||w===3?3:1]+b,f=(v,w,b,S)=>{const T=h(b,S,sT[v][0]*w),E=p(b,S,sT[v][1]*w);UA(b.extent,T,E,1);const C=wr(T,E,b.renderData.geometryState.samplerData);a(b,T,E,C)},m=(v,w,b,S,T,E)=>{const C=sT[v][0]*w,A=sT[v][1]*w,I=h(b,S,C),D=p(b,S,A),L=h(T,E,C),z=p(T,E,A);UA(b.extent,I,D,1),UA(T.extent,L,z,1);const B=wr(I,D,b.renderData.geometryState.samplerData),V=wr(L,z,T.renderData.geometryState.samplerData);a(b,I,D,.5*(B+V))},y=v=>{const w=v===0||v===1?s[2]:s[0],b=v===0||v===3?s[3]:s[1],S=i[v].cornerTiles,T=S.reduce((E,C)=>{var A;return Math.min(E,(A=C==null?void 0:C.level)!=null?A:1/0)},1/0);for(let E=0;E<4;++E){const C=S[E];e0[E]=(C==null?void 0:C.level)===T?C:null}for(let E=0;E<4;++E){const C=e0[(E+3)%4],A=e0[E];if(C!=null&&C!==r&&C===A){const I=C,D=(E+2)%4,L=I.renderData.geometryState.neighborData.edgeResolutions[D],z=Math.max(L,2**(r.level-I.level)),B=(I.extent[2]-I.extent[0])/z,V=(E+0)%4,Q=(E+1)%4;return c(w,b,(E+3)%4,B,I,E),c(w,b,V,B,I,E),c(w,b,Q,B,I,E),fs}}{e0.some(C=>(C==null?void 0:C.isLoaded)||C===r);const E=e0.reduce((C,A)=>A?A.extent[2]-A.extent[0]:C,0)/e0.reduce((C,A)=>{var I;return Math.max(C,(I=A==null?void 0:A.renderData.geometryState.numVerticesPerSide)!=null?I:1)},1);for(let C=0;C<4;++C){const A=e0[(C+3)%4],I=e0[(C+0)%4];if(!A&&!I)continue;const D=C===0?1:C===1?2:C===2?3:0,L=C===0?2:C===1?3:C===2?0:1;A&&I?m(C,E,A,D,I,L):f(C,E,A!=null?A:I,A?D:L)}}return fs};for(let v=0;v<4;++v){const w=e.geometryInfo.outerEdges[v],b=v===1||v===2?0:w.count-1;w.getVertex(Df,b),n||we(jv,Df),se(fs,0,0,0);const S=y(v);we(u8[v],S)}}{const a=(c,h,p,f,m)=>{c.setVertexRawNormal(m,h,p,f)},l=e.geometryInfo.outerEdges;for(let c=0;c<4;++c){const h=l[c];{const p=u8[c===0?3:c===1?1:2];a(h,p[0],p[1],p[2],0)}{const p=u8[c===2?1:c===3?3:0];a(h,p[0],p[1],p[2],h.count-1)}}}}function qg(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}const sT=[[0,1],[1,0],[0,-1],[-1,0]],c1=new oft,wEe=tX(-1/0,-1/0,1/0,1/0),Ky=O(),vc=O(),Wg=O(),$E=O(),LE=O(),Df=O(),c8=O(),jv=O(),fs=O(),g2=O(),u8=[O(),O(),O(),O()],e0=[null,null,null,null];class fmt extends LJ{constructor(t,i,r){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=kt(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=_(s)&&YM(s)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this.extentInRenderSR,c=this.extent;if(a){const h=Ue(c[0],c[1],0);un(h,et.WebMercator,h,et.PlateCarree);const p=Ue(c[2],c[3],0);un(p,et.WebMercator,p,et.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[$a.MIDDLE][3]=o}_isVisible(t){return PJe(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return NPe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s){return uL[0]=1/i[0],uL[1]=1/i[1],uL[2]=1/i[2],UQ(this._aabb(),t,uL,r,s)}createGeometry(){qft(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){Zft(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){Yft(this.renderData,this.horizontalScaleFactor)}}const uL=O();var h3;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(h3||(h3={}));class mmt extends LJ{constructor(t,i,r){super(),this.obb=new Array(8);for(let s=0;s<8;s++)this.obb[s]=O();t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=Yt(o,l,.5),p=Yt(n,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(f)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),CC(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const m=yl(this.centerAtSeaLevel);we(m,m),this.up=m,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)se(this._center[Vd.MIDDLE],0,0,0),se(this._center[Vd.TOP],0,0,0),se(this._center[Vd.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=Ci(this.surface.spatialReference)),this._center[Vd.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(Sn(this._center[Vd.MIDDLE],this.obb[0]),Sn(this._center[Vd.MIDDLE],this.obb[1]));this._center[Vd.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!Cv(t,this._center[Vd.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const i=this.obb;for(let r=0;r<ly.NUM;r++){const s=r===ar.NEAR,n=t[r];s&&(vA[0]=n[0],vA[1]=n[1],vA[2]=n[2],vA[3]=n[3]-this.surface.view.state.camera.near);const o=s?vA:n;let a;for(a=0;a<8;a++){const l=i[a];if(o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]<0)break}if(a===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);Hft(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,i=this.obb;for(let r=0;r<2;r++){const s=this.elevationBounds[r];let n=4*r;CC(i[n++],t[0],t[1],this.ellipsoid.radius+s),CC(i[n++],t[0],t[3],this.ellipsoid.radius+s),CC(i[n++],t[2],t[3],this.ellipsoid.radius+s),CC(i[n++],t[2],t[1],this.ellipsoid.radius+s)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Ph.HAS_NORTH_POLE:se(i[1],0,0,this.ellipsoid.radius),se(i[2],0,0,this.ellipsoid.radius),se(i[5],0,0,this.ellipsoid.radius),se(i[6],0,0,this.ellipsoid.radius);break;case Ph.HAS_SOUTH_POLE:se(i[0],0,0,-this.ellipsoid.radius),se(i[3],0,0,-this.ellipsoid.radius),se(i[4],0,0,-this.ellipsoid.radius),se(i[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,i){return t===(1<<i)-1?t===0?Ph.HAS_BOTH_POLES:Ph.HAS_SOUTH_POLE:t===0?Ph.HAS_NORTH_POLE:Ph.REGULAR}intersectsRay(t,i,r,s){const n=this._center[Vd.MIDDLE],o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,f=i[0]*p-l,m=i[1]*p-c,y=i[2]*p-h;return f*f+m*m+y*y<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<rce.length?rce[this.level]+1:2}updateCornerElevations(){Wft(this.renderData)}updateEdgeElevations(){Xft(this.renderData)}}const rce=[128,64,32,16,16,8,8,4],vA=Si();var Vd;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Vd||(Vd={}));class gmt{constructor(){this.extent=Xt(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class ymt{constructor(){this._queries=new Wt({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Wt({initialSize:30}),this._queryPool=new Cs(gmt)}queryVisibleLevelRange(t,i,r,s){const n=this._queryPool.acquire();sp(n.extent,t),n.minLevel=i||-Number.MAX_VALUE,n.maxLevel=r!=null?r:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const i=this._queries.data[t];this._queryPool.release(i),i.callback(t>=this._queriesInvPtr),i.callback=null}this._queries.clear()}scaleQueriesForTile(t){const i=t.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}}class UJ extends Wa{constructor(){super(...arguments),this.blendMode=Ne.Normal}}u([H({count:Ne.COUNT})],UJ.prototype,"blendMode",void 0);class vmt extends nEe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=Ne.Normal,this.backgroundColor=Ba}}class hz extends pr{initializeProgram(t){const i=hz.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:ym(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:ri})}}hz.shader=new rr(bft,()=>import("./BlendLayers.glsl.e958cd81.js"));class MN extends UJ{constructor(){super(...arguments),this.output=go.Composite,this.baseOpacityMode=xn.One,this.premultipliedSource=!1}}u([H({count:go.COUNT})],MN.prototype,"output",void 0),u([H({count:xn.COUNT})],MN.prototype,"baseOpacityMode",void 0),u([H()],MN.prototype,"premultipliedSource",void 0);class h8{constructor(t,i,r,s,n,o){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=bi(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ue(s,o,n)}destroy(){this.texture.release()}}function ON(){return[1,0,0,1,0,0]}function _mt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function bmt(e,t,i,r,s,n){return[e,t,i,r,s,n]}function wmt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:ON,clone:_mt,fromValues:bmt,createView:wmt},Symbol.toStringTag,{value:"Module"}));function xmt(e){return e instanceof Float32Array&&e.length>=2}function Tmt(e){return Array.isArray(e)&&e.length>=2}function d8(e){return xmt(e)||Tmt(e)}const Smt=96,Emt=39.37;function zJ(e,t){return t.type?yi(e,t.x,t.y):_o(e,t)}function Cmt(e){return $c(e)}function Amt(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const Rmt=function(){const e=it();return function(t,i,r){const s=i.targetGeometry;zJ(e,s);const n=.5*dz(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function dz(e){return e.scale*Mmt(e.targetGeometry)}function Mmt(e){return _(e)&&Pl(e.spatialReference)?1/(Cmt(e.spatialReference)*Emt*Smt):1}function Omt(e){return N5(e.rotation)||0}const VJ=function(){const e=it(),t=it(),i=it();return function(r,s,n,o,a,l){return kY(e,s),pc(t,n,.5*l),yi(i,1/o*l,-1/o*l),RY(r,t),a&&Zk(r,r,a),AY(r,r,i),Yk(r,r,e),r}}(),Pmt=function(){const e=it();return function(t,i,r,s){const n=dz(i),o=Omt(i);return zJ(e,i.targetGeometry),VJ(t,e,r,n,o,s)}}(),Imt=function(){const e=it();return function(t,i,r,s){const n=dz(i);return zJ(e,i.targetGeometry),VJ(t,e,r,n,0,s)}}();function $mt(e){const t=$v(e);return t?t.valid[1]-t.valid[0]:0}function Lmt(e,t){return Math.round($mt(e)/t)}var Oq;const Fm=[0,0];let z0=Oq=class extends ve{constructor(e){super(e),this._viewpoint2D={center:it(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new ai,this.id=0,this.inverseTransform=ON(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=ON(),this.transformNoRotation=ON(),this.displayMat3=jg(),this.displayViewMat3=jg(),this.viewMat3=jg(),this.viewMat2d=c4(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Amt(i,e.viewpoint),this._set("size",_o(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new Oq({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return d8(t)?q1(e,t,this.inverseTransform):(Fm[0]=t,Fm[1]=i,q1(e,Fm,this.inverseTransform))}toScreen(e,t,i){return d8(t)?q1(e,t,this.transform):(Fm[0]=t,Fm[1]=i,q1(e,Fm,this.transform))}toScreenNoRotation(e,t,i){return d8(t)?q1(e,t,this.transformNoRotation):(Fm[0]=t,Fm[1]=i,q1(e,Fm,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return VJ(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Xh({targetGeometry:new ot(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=dz(o),this.rotation=r,this.scale=i,this.spatialReference=t,_o(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;KY(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=eQ(this.viewMat3),h=ka(n[0]/2,n[1]/2),p=ka(-n[0]/2,-n[1]/2),f=N5(r);_4(c,c,h),tQ(c,c,f),_4(c,c,p),sU(this.displayViewMat3,this.displayMat3,c);const m=RY(this.viewMat2d,h);return Zk(m,m,f),Yk(m,m,p),Rmt(this.extent,o,n),Pmt(this.transform,o,n,s),A1e(this.inverseTransform,this.transform),Imt(this.transformNoRotation,o,n,s),this.worldScreenWidth=Lmt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([d({readOnly:!0})],z0.prototype,"id",void 0),u([d({value:1,json:{write:!0}})],z0.prototype,"pixelRatio",null),u([d({json:{write:!0}})],z0.prototype,"size",null),u([d()],z0.prototype,"spatialReference",void 0),u([d({type:Xh,json:{write:!0}})],z0.prototype,"viewpoint",null),z0=Oq=u([P("esri.views.2d.ViewState")],z0);const Dmt=z0,Nmt=.125;class Fmt{constructor(){this._renderParams={context:null,drawPhase:1,state:new Dmt({viewpoint:new Xh({targetGeometry:new ot(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),f=this._renderParams;f.context=t,f.painter=s,f.glyphMosaic=s.glyphMosaic,f.spriteMosaic=s.spriteMosaic,f.pixelRatio=h,f.displayLevel=p,f.requiredLevel=p;const m=o.getScale(i[0]),[y,v]=o.getShift(i,a*m),w=Nmt*a*m/c,b=r.transforms.dvs;b[0]=w,b[4]=-w,b[6]=-1-y-l[0]*a*2,b[7]=1+v+(1-l[1])*a*2-2,f.state.size[0]=c,f.state.size[1]=c,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(f,r,n)}}class pz extends pr{initializeProgram(t){const i=pz.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:ym(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:ri})}}pz.shader=new rr(Aft,()=>import("./RasterColorizer.glsl.598ab864.js"));class lS extends UJ{constructor(){super(...arguments),this.colorizerType=lw.Stretch,this.stretchType=Ww.Noop,this.tileBlendInput=Bo.LayerOnly,this.baseOpacityMode=xn.One,this.applyColormap=!0}}u([H({count:lw.COUNT})],lS.prototype,"colorizerType",void 0),u([H({count:Ww.COUNT})],lS.prototype,"stretchType",void 0),u([H({count:Bo.COUNT})],lS.prototype,"tileBlendInput",void 0),u([H({count:xn.COUNT})],lS.prototype,"baseOpacityMode",void 0),u([H()],lS.prototype,"applyColormap",void 0);class sce{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let i=this._pools.get(t);if(!i){const r=nce.bind(nce,this._rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.DEPTH_RENDER_BUFFER,width:t,height:t},s=>this._getPool(s.width).release(s));i=new Cs(r,null,()=>{}),this._pools.set(t,i)}return i}}class nce extends Rr{constructor(t,i,r){super(t,i),this.release=()=>r(this)}}const kmt=fe.getLogger("esri.views.3d.terrain");class Umt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new Fmt,this._bindParameters=new aU(null,null,null),this._blendLayersTechniqueConfig=new MN,this._poolToWrite=0,this._vaoQuad=Xa(this._rctx,Y3),this._fboPools.push(new sce(this._rctx)),this._fboPools.push(new sce(this._rctx))}dispose(){this._fboPools.forEach(t=>{t.clear(),t=null}),this._fboPools=null,this._doubleBufferFbo.forEach(t=>Ze(t)),this._vaoQuad=Ze(this._vaoQuad),this._vectorTileHelper=Ze(this._vectorTileHelper),this._backgroundTechnique=Ki(this._backgroundTechnique),this._applyOpacityTechnique=Ki(this._applyOpacityTechnique),this._blendLayersTechnique=Ki(this._blendLayersTechnique)}_getBlendLayersTechnique(t,i,r,s=!1){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r?i===go.Composite?xn.OnBaseLayer:xn.OnBackground:xn.One,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(hz,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,i){const r=this._getBlendLayersTechnique(Ne.Normal,i,!1),s=this._rctx.bindTechnique(r,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays($t.TRIANGLE_STRIP,0,ko(this._vaoQuad,"geometry"))}drawRasterData(t,i,r=!1){if(R(i.texture))return;const s=i.baseOpacity<1;i.blendMode!==Ne.Normal||s||r?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const n=this._getBlendLayersTechnique(i.blendMode,t,s,r),o=this._rctx.bindTechnique(n,i,this._bindParameters);this._render(o)}drawImageryTileData(t,i,r){const s=t.sourceLayerInfo.data;if(!s.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,Qt.MAP).ensureSymbolizerParameters(s);const n=r.baseOpacity<1;r.blendMode!==Ne.Normal||n?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const o=this._getRasterColorizerTechnique(s,i,r.blendMode,n),a=this._rctx.bindTechnique(o);if(!s.bind(this._rctx))return;s.opacity=r.opacity;const l=s.getUniforms();l.scale=t.scale,l.offset=t.offset,l.backgroundColor=r.backgroundColor,l.fboTexture=r.fboTexture,l.baseOpacity=r.baseOpacity,o.bindPass(l,null),this._render(a)}_getRasterColorizerTechnique(t,i,r,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return R(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new lS,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=i===go.ColorComposite?Bo.ColorComposite:i===go.GridComposite?Bo.GridComposite:Bo.LayerOnly,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s?i===go.Composite?xn.OnBaseLayer:xn.OnBackground:xn.One,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?Ww.Noop:Ww.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(pz,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,i,r,s,n,o,a){const l=this._rctx,c=i.sourceLayerInfo.data,h=i.tile.surface.layerViewByIndex(i.layerIndex,Qt.MAP),p=t.baseOpacity<1||t.opacity<1||t.blendMode!==Ne.Normal||a!==go.Composite;let f;this._getBlendLayersTechnique(t.blendMode,a,t.baseOpacity<1,p).bindPipelineState(l),p?(f=this._acquire(n),l.bindFramebuffer(f),l.setClearColor(0,0,0,0),l.clearSafe(er.COLOR_BUFFER_BIT|er.DEPTH_BUFFER_BIT)):o&&l.clearSafe(er.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(l,i.sourceLod,c,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/i.scale),i.offset,s,r)}catch(m){kmt.warnOnce("A render call containing vector tiles did not resolve correctly.",m)}return!_(f)||(l.bindFramebuffer(this._currentFBO),t.texture=f.colorTexture,t.offset=Zh,t.scale=1,this.drawRasterData(a,t,p),f.release(),o)}copyFBOToTexture(t){const i=this._rctx,r=i.bindTexture(t.texture,nt.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;i.gl.copyTexImage2D(ft.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),i.bindTexture(r,nt.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(t,i){this._rctx.bindFramebuffer(t),this._rctx.setViewport(0,0,i,i),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(er.COLOR_BUFFER_BIT|er.DEPTH_BUFFER_BIT)}_acquire(t){return this._fboPools[this._poolToWrite].acquire(t)}bindPool(t,i){this._poolToWrite=t,this._doubleBufferFbo[t]==null&&(this._doubleBufferFbo[t]=this._acquire(i),this._initFBO(this._doubleBufferFbo[t],i))}_switchPool(t){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=this._poolToWrite===0?1:0,this.bindPool(this._poolToWrite,t)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(t,i){t===this._lastPixelRatio&&i===this._lastNumLayers||(this._fboPools.forEach(r=>r.clear()),this._lastPixelRatio=t,this._lastNumLayers=i)}}class zmt{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new vmt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Umt(this._rctx,this._techniqueRepository),this._blackTex=new aS(aXe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=Ze(this._composition),this._backgroundTexture=Ki(this._backgroundTexture),this._blackTex=Ki(this._blackTex)}get backgroundIsGrid(){return R(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){if(!t.renderData)return;const r=t.surface,s=r.baseOpacity;this._numTexturedLayer=0;let n=0,o=this.tileSize,a=!1;const l=r.view.state.pixelRatio;let c=!1;const h=t.layerInfo[Qt.MAP];let p=h.length,f=0;for(;f<h.length;f++){const v=r.layerViewByIndex(f,Qt.MAP),w=v.fullOpacity;if(f8[f]=w,dye(v.layer)&&p>=h.length&&(p=f),w===0){h[f].pendingUpdates&=~(bt.TEXTURE_NOFADING&bt.TEXTURE_FADING);continue}++n;const b=p8(t,f);if(b){if(h[f].pendingUpdates&=~(bt.TEXTURE_NOFADING&bt.TEXTURE_FADING),a5(v)){const S=H2e(v.layer.parent)?"normal":v.layer.blendMode;oce[f]=S;const T=S!=="normal";T&&(c=T,a=!1)}l3(v)?o=Math.max(o,this.tileSize*l):s===1&&w===1&&(v.isOpaque||this._dataToTexture(b)&&b.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(l,h.length),o=Vmt(o);const m=o/this.tileSize,y=f-1;this._ensureBackgroundTexture(this.tileSize),this._numTexturedLayer!==0?this._numTexturedLayer===1&&!c&&this._useLayerTexture(t,y,p,f8[y])||this._composeMapLayers(t,i,y,p,f8,oce,o,m,!a||c):this._useBackgroundTexture(t,n)}_ensureBackgroundTexture(t){R(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,t),this._passParameters.offset=Zh,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=Ne.Normal,_(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,_(this.backgroundColor)?go.ColorOnly:go.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(t,i){let r=Hg.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=Hg.Delayed),this._backgroundTexture&&R(t.renderData.textureReference)&&(r=Hg.Immediate),t.renderData.setTextureReference(_(this._backgroundTexture)?new h8(this._backgroundTexture,Vn.FADING,ace,t.surface.baseOpacity,1,0):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=p8(t,i);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new h8(l.sourceLayerInfo.data,Vn.FADING,l,o,s,a)),!0)}_composeMapLayers(t,i,r,s,n,o,a,l,c){this._composition.bindPool(0,a);const h=t.surface.baseOpacity;let p=!1,f=Ke.LINEAR_MIPMAP_LINEAR,m=!1,y=0;for(let w=r;w>=0;w--){const b=p8(t,w);if(!b||n[w]===0)continue;const S=w<s&&h<1&&!p;this._passParameters.baseOpacity=S?h:1,S&&(p=!0);const T=y===0,E=c&&T?this.backgroundIsGrid?go.GridComposite:go.ColorComposite:go.Composite;lpt(b)?(this._passParameters.opacity=n[w],this._passParameters.blendMode=CN[o[w]],m=this._composition.drawVectorData(this._passParameters,b,l,this.tileSize,a,m,E)):apt(b)?(this._passParameters.opacity=n[w],this._passParameters.blendMode=CN[o[w]],this._composition.drawImageryTileData(b,E,this._passParameters),this._hasNearestInterpolation(b)&&(f=Ke.NEAREST)):this._dataToTexture(b)&&(this._passParameters.texture=b.sourceLayerInfo.data.texture,this._passParameters.offset=b.offset,this._passParameters.scale=b.scale,this._passParameters.opacity=n[w],this._passParameters.blendMode=CN[o[w]],this._composition.drawRasterData(E,this._passParameters)),y++}const v=t.renderData.ensureTexture(a,()=>this._buildTexture(a,f));this._composition.copyFBOToTexture(v),this._composition.releasePool(),t.renderData.setTextureReference(new h8(v,i,ace,p?1:h,1,0))}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(t){return upt(t)&&this._rasterDataToTexture(t),cpt(t)}_rasterDataToTexture(t){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,i=Ke.LINEAR_MIPMAP_LINEAR){if(R(t))return null;const r={target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new aS(new nt(s,r));else if(t instanceof oz)r.isOpaque=t.isOpaque,n=new aS(new nt(s,r,t.image)),t.release();else try{n=new aS(new nt(s,r,t))}catch{n=new aS($be(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,nt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,nt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function Vmt(e){const t=D2(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function p8(e,t){Gc.layerIndex=t;const i=e.layerInfo[Qt.MAP][t];if(_(i.data))return yi(Gc.offset,0,0),Gc.tile=e,Gc.scale=1,Gc.sourceLod=e.lij,Gc.sourceLayerInfo=i,Gc;const r=i.upsampleInfo;if(_(r)){const s=r.tile.layerInfo[Qt.MAP][t];return Gc.tile=r.tile,_o(Gc.offset,r.offset),Gc.scale=r.scale,Gc.sourceLod=r.tile.lij,Gc.sourceLayerInfo=s,Gc}return null}const f8=new Array,oce=new Array,Gc={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},ace={offset:[0,0],scale:1},xEe=200,m8=40,Bmt=.8,Gmt=10,VR=1e-6;function jmt(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(r[a]<l){if(s[a]<=VR)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-VR){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(r[a]>l){if(s[a]>=-VR)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=VR){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class lce{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class DE{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this.rayDirection=O(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=r-i,o=n<=TEe?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=Zmt(t,i,r,s.data,s.stride),l=De(Math.log2(n/m8),2,Gmt),c=(h,p,f)=>{const m=Wmt(o,a,h,p),y=p-h;if(y<=m8){const E=new lce(m,void 0,0,h,p);return this.bspNodeTree.push(E),E}const{axis:v,midValue:w}=Xmt(m),b=qmt(o,a,h,p,v,w),S=(E,C)=>{if(f>l)return;const A=C-E;return A<m8||A>=Bmt*y?void 0:c(E,C,f+1)},T=new lce(m,v,w,b.next,b.mid);return this.bspNodeTree.push(T),T.leftNode=S(h,b.next),T.rightNode=S(b.mid,p),T};c(0,n,0),this.triangleVertexIndices=Ymt(o,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],l=o[1],c=o[2],h=this.rayDirection,p=h[0],f=h[1],m=h[2];for(let y=t,v=3*t;y<i;++y){const w=r[v]*n,b=s[w],S=s[w+1],T=s[w+2],E=r[v+1]*n,C=s[E],A=s[E+1],I=s[E+2],D=r[v+2]*n,L=s[D],z=s[D+1],B=s[D+2];v+=3;const V=C-b,Q=A-S,Z=I-T,ce=L-b,oe=z-S,$=B-T,U=f*$-oe*m,G=m*ce-$*p,W=p*oe-ce*f,X=V*U+Q*G+Z*W;if(Math.abs(X)<=Number.EPSILON)continue;const ee=a-b,q=l-S,te=c-T,ge=ee*U+q*G+te*W;if(X>0){if(ge<0||ge>X)continue}else if(ge>0||ge<X)continue;const Te=q*Z-Q*te,ke=te*V-Z*ee,_e=ee*Q-V*q,me=p*Te+f*ke+m*_e;if(X>0){if(me<0||ge+me>X)continue}else if(me>0||ge+me<X)continue;const Ce=(ce*Te+oe*ke+$*_e)/X;if(Ce>=0){const Fe=this.indices[y]+this.firstTriangleIndex,Li=FQ(V,Q,Z,ce,oe,$,Hmt);this.callback(Ce,Li,Fe,!1)}}}DE.numFacesTested+=i-t}intersectRay(t,i){DE.numFacesTested=0;const r=Ue(t.r0[0],t.r0[1],t.r0[2]),s=Ue(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<VR)return;this.rayOrigin=r;const l=this.rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this.callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,i,r){const s=this.rayOrigin,n=this.rayDirection;if(!jmt(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=i,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=r;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}DE.numFacesTested=0;const Hmt=O(),nT=[1/0,1/0,1/0],oT=[-1/0,-1/0,-1/0];function qmt(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function Wmt(e,t,i,r){if(r<=i)return yw(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)nT[n]=t[s+0+n],oT[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let o=0;o<3;++o)nT[o]=Math.min(nT[o],t[n+0+o]),oT[o]=Math.max(oT[o],t[n+3+o])}return yw(nT[0],nT[1],nT[2],oT[0],oT[1],oT[2])}function Xmt(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function Zmt(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let f=0;f<3;++f){const m=r[c+f],y=r[h+f],v=r[p+f];o[6*a+f]=Math.min(m,y,v),o[6*a+3+f]=Math.max(m,y,v)}}return o}function Ymt(e,t,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=TEe?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+i);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const TEe=65535;class BJ extends uSe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=O(),this.origin=this.slicePlaneLocalOrigin}}var Tu,co;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(Tu||(Tu={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(co||(co={}));class Qmt extends BJ{constructor(){super(...arguments),this.identifier=Tu.Material,this.transparent=!1,this.integratedMesh=!1}}class Jmt extends BJ{constructor(){super(...arguments),this.identifier=Tu.ShadowMap}}class Kmt extends BJ{constructor(){super(...arguments),this.identifier=Tu.Highlight}}class h5 extends Kr{constructor(t,i){super(t,"vec4",ki.Draw,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}var Xg;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(Xg||(Xg={}));class egt extends Ws{constructor(){super(...arguments),this.overlayOpacity=1}}function cce(e,t){e.vertex.uniforms.add([new Va("overlayTexOffset"),new Va("overlayTexScale")]),e.fragment.uniforms.add([new We("overlayOpacity",i=>i.overlayOpacity),new jt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[kr.INNER].getColorTexture(i.overlaySource))]),SEe(e,t)}function tgt(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add([new h5("overlayTexOffset",(s,n)=>igt(s,n)),new h5("overlayTexScale",(s,n)=>rgt(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new jt("ovColorTex",(s,n)=>Pq(s,n))),SEe(e,t)}function SEe(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==Ot.Water&&t.pbrMode!==Ot.WaterOnIntegratedMesh||e.include(mSe,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.code.add(x`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(x`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(x`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==Ot.Water&&t.pbrMode!==Ot.WaterOnIntegratedMesh||(r.uniforms.add([new Tt("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(s,n)=>n.lighting.mainLight.intensity)]),r.code.add(x`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Pq(e,t){return t.overlays.length===0?null:e.identifier===Tu.Material&&e.subPass===co.Color?t.overlays[kr.INNER].getColorTextureNoRasterImage():e.identifier===Tu.Highlight?t.overlays[kr.INNER].getValidTexture(Ts.Highlight):null}function igt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Dpe(s)>0&&(y2[2*r]=e.toMapSpace[0]/bu(s)-s[0]/bu(s),y2[2*r+1]=e.toMapSpace[1]/Ep(s)-s[1]/Ep(s))}return y2}function rgt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Dpe(s)>0&&(y2[2*r]=e.toMapSpace[2]/bu(s),y2[2*r+1]=e.toMapSpace[3]/Ep(s))}return y2}const y2=Xt();function sgt(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(x`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(x`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function ngt(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new Va("texOffsetAndScale")),e.fragment.uniforms.add(new zr("tex")),e.fragment.uniforms.add(new El("textureOpacities"));const i=t.textureFadingEnabled&&!t.renderOccluded;i&&(e.vertex.uniforms.add(new Va("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new zr("texNext")),e.fragment.uniforms.add(new El("nextTexOpacities")),e.fragment.uniforms.add(new Ni("fadeFactor")));const r=t.tileBlendInput===Bo.ColorComposite,s=t.tileBlendInput===Bo.GridComposite;s&&e.fragment.include($J),r&&e.fragment.uniforms.add(new El("backgroundColor")),e.vertex.code.add(x`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${i?x`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:x``}
  }`),e.fragment.code.add(x`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${s||r?x`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${r?x`vec4(backgroundColor, 1.0)`:x`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:x`return color;`}
    }`),i?e.fragment.code.add(x`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(x`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class EEe extends egt{}function ogt(e){const t=new Zi;t.include(kSe,{name:"Terrain Shader",output:e.output}),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.UV0,"vec2"),t.attributes.add(M.NORMAL,"vec3");const{vertex:i,fragment:r}=t;if(i.uniforms.add([new Tr("proj",(s,n)=>n.camera.projectionMatrix),new sq("view",(s,n)=>qa(uce,n.camera.viewMatrix,s.origin)),new Ga("origin",s=>s.origin)]),r.uniforms.add(new Ga("origin",s=>s.origin)),e.output===K.Color){t.include(Uo),t.include(Mv,e),t.include(ngt,e),t.include(Gw,e);const s=e.overlayMode!==Xg.Disabled,n=e.overlayMode===Xg.EnabledWithWater;s&&t.include(cce,ye(F({},e),{pbrMode:Ot.Water})),n&&t.include(sgt,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&i.uniforms.add(new Tr("viewNormal",(a,l)=>l.camera.viewInverseTransposeMatrix));const o=e.receiveShadows&&!e.renderOccluded;o&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(i.uniforms.add(new Tt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),i.code.add(x`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?x`normal`:x`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?x`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?x`vuv = uv;`:""}
        ${e.screenSizePerspective?x`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${o?x`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${s?x`setOverlayVTC(uv);`:""}
        ${n?x`forwardVertexTangent(vnormal);`:x``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(vs,e),t.include(Gw,e),t.include(gP,e),t.include(Bw,e),r.uniforms.add([new Ga("cameraPosition",(a,l)=>pe(g8,l.camera.eye,a.origin)),new Tt("viewDirection",(a,l)=>we(g8,se(g8,l.camera.viewMatrix[12],l.camera.viewMatrix[13],l.camera.viewMatrix[14]))),new We("lightingGlobalFactor",(a,l)=>l.lighting.globalFactor),new Tt("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection),new Tt("lightingMainIntensity",(a,l)=>l.lighting.mainLight.intensity)]),r.constants.add("ambientBoostFactor","float",aC),n&&r.uniforms.add([new jt("ovWaterTex",(a,l)=>l.overlays.length===0?null:l.overlays[kr.INNER].getNormalTexture(a.overlaySource)),new sq("view",(a,l)=>qa(uce,l.camera.viewMatrix,a.origin))]),r.code.add(x`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r.code.add(x`
      void main() {
        ${o?x`float shadow = readShadowMap(vpos, linearDepth);`:x`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${s?x`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?x`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?x`atm + tileColor.rgb;`:x`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":x`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":x`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${n?x`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?x`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?x`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==K.Depth&&e.output!==K.Shadow||(t.include(Uo,{hasModelTransformation:!1,linearDepth:!0}),t.include(x_,{output:e.output}),t.include(Mv,e),t.varyings.add("linearDepth","float"),i.uniforms.add(new vi("nearFar",(s,n)=>n.camera.nearFar)),i.code.add(x`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(x`void main() {
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(Uo),t.include(Mv,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),i.uniforms.add(new Tr("viewNormal",(s,n)=>n.camera.viewInverseTransposeMatrix)),i.code.add(x`
        void main(void) {
          vec3 normal = ${e.shading?x`normal`:x`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),r.code.add(x`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===K.Highlight&&(t.include(Uo),t.include(Mv,e),t.include(cce,e),i.code.add(x`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(wy),r.code.add(x`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const uce=Ae(),g8=O(),agt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:EEe,build:ogt},Symbol.toStringTag,{value:"Module"}));class fz extends pr{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global}initializeProgram(t){const i=fz.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Bt({blending:i.renderOccluded?ym(Re.ONE,Re.ONE_MINUS_SRC_ALPHA):null,culling:r&&UY,depthTest:!i.renderOccluded&&{func:gr.LESS},depthWrite:!i.renderOccluded&&Nl,colorWrite:ri,stencilTest:t?Dst(Ml.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}fz.shader=new rr(agt,()=>import("./Terrain.glsl.cec4c93d.js"));class Is extends la{constructor(){super(...arguments),this.output=K.Color,this.overlayMode=Xg.Disabled,this.tileBlendInput=Bo.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=he("enable-feature:terrain-shading")}}u([H({count:K.COUNT})],Is.prototype,"output",void 0),u([H({count:Xg.COUNT})],Is.prototype,"overlayMode",void 0),u([H({count:Bo.COUNT})],Is.prototype,"tileBlendInput",void 0),u([H()],Is.prototype,"spherical",void 0),u([H()],Is.prototype,"atmosphere",void 0),u([H()],Is.prototype,"receiveShadows",void 0),u([H()],Is.prototype,"hasSlicePlane",void 0),u([H()],Is.prototype,"backfaceCullingEnabled",void 0),u([H()],Is.prototype,"stencilEnabled",void 0),u([H()],Is.prototype,"textureFadingEnabled",void 0),u([H()],Is.prototype,"renderOccluded",void 0),u([H()],Is.prototype,"hasScreenSpaceReflections",void 0),u([H()],Is.prototype,"hasCloudsReflections",void 0),u([H()],Is.prototype,"tileBorders",void 0),u([H()],Is.prototype,"screenSizePerspective",void 0),u([H()],Is.prototype,"receiveAmbientOcclusion",void 0),u([H()],Is.prototype,"shading",void 0),u([H({constValue:!0})],Is.prototype,"isGround",void 0),u([H({constValue:Ot.Disabled})],Is.prototype,"pbrMode",void 0),u([H({constValue:!1})],Is.prototype,"highStepCount",void 0),u([H({constValue:!1})],Is.prototype,"useCustomDTRExponentForWater",void 0),u([H({constValue:!1})],Is.prototype,"useFillLights",void 0);const y8=7,lgt=10,v8=Gs(),hL=Xt();let eu=class extends Se{constructor(e){super(e),this.type=Vr.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new Is,this._passParameters=new EEe,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new ymt,this.renderDataPool=new Cs(Ig),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new K2e,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Dr.Occlude}get isGlobal(){return this.stage.viewingMode===Ge.Global}get shadingEnabled(){var e;return(e=this._techniqueConfiguration)==null?void 0:e.shading}initialize(){const e=[Ee.OPAQUE_TERRAIN,Ee.TRANSPARENT_TERRAIN,Ee.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),sft()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return tp}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?Z4:Dr.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,_(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,bt.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){_(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===bt.TEXTURE_FADING?Vn.FADING:Vn.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[Qt.ELEVATION])t.pendingUpdates&=~bt.GEOMETRY;e.resetPendingUpdate(bt.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=lgt-y8,i=Math.max(0,Math.floor((e.level-t)/y8)*y8);if(this.isGlobal&&i===0)return Ba;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=ks.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new zmt(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=$be(this.rctx)}uninitializeRenderContext(){this.emptyTex=Ze(this.emptyTex),this.tileRenderer=Ze(this.tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=ugt,n=hgt;pe(s,r,i),se(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===vo.MIN,h=!!e.results.ground.target,p=LQe(e.verticalOffset),f=e.tolerance;let m,y=c&&_(o.dist)?o.dist:1/0;const v=b=>{const S=b.renderData;if(!(S==null?void 0:S.vao))return;const T=S.geometryInfo;V5(v8,T.boundingBox);const E=S.localOrigin;_(p)&&(p.localOrigin=E,p.applyToAabb(v8));const C=v8;if(aT[0]=i[0]-E[0],aT[1]=i[1]-E[1],aT[2]=i[2]-E[2],!UQ(C,aT,n,f,y))return;const A=(Q,Z,ce)=>{Q.set(this.type,b,Z,ce,hn),y=c&&_(o.dist)?o.dist:1/0},I=(Q,Z)=>{if(_(Z)&&Q>=0&&(e.options.backfacesTerrain||xe(Z,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,Q))){if((l.dist==null||Q<l.dist)&&A(l,Q,Z),e.options.isFiltered)return;e.options.store===vo.ALL&&(R(m)?(m=mQ(e.ray),A(m,Q,Z),e.results.all.push(m)):Q<m.dist&&A(m,Q,Z)),(o.dist==null||Q<o.dist)&&A(o,Q,Z),e.options.store!==vo.MIN&&(a.dist==null||Q>a.dist)&&A(a,Q,Z)}},D=dgt;pe(D,r,E);const L=T.indices,z=T.vertexAttributes,B={data:z.getField(M.POSITION,Xi).typedBuffer,size:3,stride:z.stride/4},V=T.indexCount/3;if(R(p)&&V>xEe){const Q=b.renderData;R(Q.intersectionData)&&(Q.intersectionData=new DE(L,0,V,B)),Q.intersectionData.intersectRay({r0:aT,r1:D},I)}else rP(aT,D,0,V,L,B,null,p,I)},w=this._rootTiles;_(w)&&(()=>{const b=this.tileIterator;b.reset(w);const S=e.options.invisibleTerrain;for(;!b.done;){const T=b.next();!(T.visible||S&&T.intersectsClippingArea)||!_(p)&&!T.intersectsRay(i,s,f,y)||h&&this._useStencilForTile(T)?b.skipSubtree():v(T)}})()}prepareTechnique(e){if(e.bindParameters.slot===Ee.OCCLUDED_TERRAIN){if((e.renderOccludedMask&Z4)==0)return null}else{const t=this.opaque?Ee.OPAQUE_TERRAIN:Ee.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case je.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=_(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?Xg.Disabled:this.overlayRenderer.hasWater?Xg.EnabledWithWater:Xg.Enabled;const t=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?Da.Occluded:Da.ColorAndWater;return this._updateTechnique(K.Color,t===Da.Occluded)}case je.MATERIAL_DEPTH_SHADOWMAP_ALL:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Shadow,!1)):null;case je.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Depth,!1));case je.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Normal,!1);case je.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(K.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,i){case je.MATERIAL:{const s=e.bindParameters.slot===Ee.OCCLUDED_TERRAIN?Da.Occluded:Da.ColorAndWater;this._renderMaterialPass(e,t,s);break}case je.MATERIAL_DEPTH_SHADOWMAP_ALL:case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,Da.None);break;case je.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,Da.None);break;case je.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,Da.None);break;case je.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,Da.Highlight),e.rctx.clearSafe(er.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i)}updateTileBackground(e=null){if(R(this.tileRenderer))return;const t=this.tileRenderer;let i=null;if(_(e)){const r=Pe.toUnitRGBA(e);i=Ue(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this.allTiles.forAll(r=>t.updateTileTexture(r,Vn.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?Bo.GridComposite:_(t.backgroundColor)?Bo.ColorComposite:Bo.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==h3.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>tEe(this.renderOrder,t)),e.sort((t,i)=>iEe(t[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!R(e)){(t=e[0])==null||t.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r||i.visible)if(i.rendered){if(r){const s=this._patchGroups.get(r.localOrigin)||new Array;this._patchGroups.set(r.localOrigin,s),s.push(i),(!this.highestVisibleLODTile||i.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=i),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new uq(n),e.bindParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],$t.TRIANGLES,r,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=Rxe(this.stage.viewingMode,this.ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=i===Da.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",Vf));const l=_(this.tileRenderer)&&_(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:Ba;this._techniqueConfiguration.tileBlendInput===Bo.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?$t.LINES:$t.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(h=>{const p=h[0].renderData.localOrigin;t.program.bindDraw(new uq(p),e.bindParameters),this.numOriginsRendered++;for(let f=0;f<h.length;f++){const m=h[f],y=m.renderData.textureReference;if(!R(y)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(m),hce(m.renderData.geometryInfo.uvOffsetAndScale,y.offsetAndScale,hL),n.setUniform4fv("texOffsetAndScale",hL),n.bindTexture("tex",y.texture.texture);const v=m.renderData.textureFadeFactor,w=v<1?m.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&_(w)&&v<1?(hce(m.renderData.geometryInfo.uvOffsetAndScale,w.offsetAndScale,hL),n.setUniform1f("fadeFactor",v),n.setUniform4fv("nextTexOffsetAndScale",hL),n.setUniform3fv("nextTexOpacities",w.opacities),n.bindTexture("texNext",w.texture.texture)):n.setUniform1f("fadeFactor",1),m.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,t,m,c,o,i),m.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if(R(l))return;const c=t.program;n!==Da.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===K.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(fz,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};u([d({constructOnly:!0})],eu.prototype,"overlayRenderer",void 0),u([d({constructOnly:!0})],eu.prototype,"stage",void 0),u([d({readOnly:!0})],eu.prototype,"isGlobal",null),u([d({constructOnly:!0})],eu.prototype,"allTiles",void 0),u([d({constructOnly:!0})],eu.prototype,"ellipsoidRadius",void 0),u([d({value:!1})],eu.prototype,"renderingDisabled",null),u([d()],eu.prototype,"renderPatchBorders",null),u([d()],eu.prototype,"cullBackFaces",null),u([d({value:h3.FRONT_TO_BACK})],eu.prototype,"renderOrder",null),u([d()],eu.prototype,"wireframe",null),eu=u([P("esri.views.3d.terrain.TerrainRenderer")],eu);const cgt=eu;function hce(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const ugt=O(),hgt=O(),aT=O(),dgt=O();class pgt{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let yf=class extends Se{constructor(e){super(e),this._handles=new Nt}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(ie(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=lt(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!uM(t)||t.isRejected())&&!(t.isFulfilled()&&!fgt(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||o5(t)))),e)if(e.isResolved()){const t=lz(e,this.viewSpatialReference,this.viewingMode);if(_(t)){const i=new Lr(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===Ge.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=Lr.makeWebMercatorAuxiliarySphere(t):ww(e.spatialReference)&&(e=Lr.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(ie(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ge.Global){const e=this.extentHelper.viewSpatialReference,t=ww(e)||lm(e)||cm(e);e.isWebMercator?this.tilingScheme=Lr.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=Lr.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;_(e)&&!Xb(e,this.extent)&&(this.tilingScheme=Lr.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function fgt(e,t,i){return _(lz(e,t,i))}u([d()],yf.prototype,"tilingScheme",void 0),u([d({readOnly:!0})],yf.prototype,"extent",void 0),u([d({value:!1})],yf.prototype,"tilingSchemeLocked",void 0),u([d({constructOnly:!0})],yf.prototype,"viewSpatialReference",void 0),u([d({constructOnly:!0})],yf.prototype,"layers",void 0),u([d({constructOnly:!0})],yf.prototype,"extentHelper",void 0),u([d({constructOnly:!0})],yf.prototype,"viewingMode",void 0),yf=u([P("esri.views.3d.terrain.TilingSchemeLogic")],yf);class mgt{constructor(){this.offset=it(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const gd=fe.getLogger("esri.views.3d.terrain.TerrainSurface"),ggt=.25;let si=class extends as.EventedMixin(Se){constructor(e){var t,i;super(e),this._elevationBounds=new OJ,this._iteratorPool=new Cs(K2e,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new cft,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new pgt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=O(),this._eyePosSurfaceSR=O(),this._splitLimits=new Fft,this._snapLevel=1/0,this._frustum=HO(),this._viewProjectionMatrix=Ae(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Nt,this._watchUpdatingTracking=new zf,this._frameTask=aE,this._allTiles=new Wt,this._upsampleInfoPool=new Cs(mgt),this._rootTilesExtent=kt(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!((i=(t=e.view)==null?void 0:t.state)==null?void 0:i.isLocal)}initialize(){this._lercDecoder=Dpt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new Cs(fmt):new Cs(mmt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new $pt(e.newCache("elevation-query")),this._set("overlayManager",new ul({surface:this})),this._handles.add([ie(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),ie(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new cgt({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:Ci(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([ie(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},Us),ie(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},Us),ie(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),qi),ie(()=>this.backgroundColor,s=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(s)},Us),ie(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),ie(()=>Wi.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?import("./TerrainTileTree3DDebugger.3008330e.js").then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&Wi.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=lt(this._treeDebugger))},Rt)]),this._extentHelper=Qpt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new oE({getCollections:()=>{var s,n,o;return(o=(n=(s=this.view)==null?void 0:s.defaultsFromMap)==null?void 0:n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,i=new yf({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Lf.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Lf.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(yt.TERRAIN_SURFACE,this),this._handles.add([ie(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),Rt),ie(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),qi),ie(()=>this.extent,()=>this._updateRootTiles(),Rt),this.view.on("resize",()=>this._viewChangeUpdate()),ie(()=>{var o,a;const s=this.view,n=s.state;return[this.lodBias,this.lodSnapping,(a=(o=s.resourceController)==null?void 0:o.memoryController)==null?void 0:a.memoryFactor,n.camera,n.contentCamera,n.fixedContentCamera]},()=>this._viewChangeUpdate(),Us),ie(()=>{var s,n;return(n=(s=this.view.qualitySettings)==null?void 0:s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,Rt),ie(()=>this._userClippingExtent,()=>this._updateClippingExtent(),qi)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=Ki(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=lt(this._upsampleMapCache),this._elevationQueryCache=lt(this._elevationQueryCache),this._set("tilingSchemeLogic",lt(this.tilingSchemeLogic)),this._extentHelper=lt(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",lt(this.overlayManager)),this._tilePool=lt(this._tilePool),LJ.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=lt(this._renderer),this._iteratorPool=lt(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=lt(this._upsampleInfoPool),Xpt(),Dft()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,i;const e=(i=(t=this.view.pointsOfInterest)==null?void 0:t.contentCameraOnSurface)==null?void 0:i.scale;if(e){const r=this.view.state.contentCamera;let s=mU(this.view,r.eye,r.viewForward,r.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=mxe(this.view,e)-n;Math.abs(this._snapLevel-o)>ggt&&(Math.round(o)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=o)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?ME.ON:ME.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(R(t)||R(e))return null;const i=kt(),r=O2e(t,i,e)?i:null,s=this._get("extent");return Xb(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=QL(this.groundExtent,this._userClippingExtent,kt()),t=this._get("extent");return Xb(e,t)?t:e}get groundExtent(){return _(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return _(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var t,i;const e=!this.renderingDisabled&&!this.opaque;(i=(t=this.view)==null?void 0:t._stage)==null||i.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,Ao);return R(s)?null:Z2e(Ao[0],Ao[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=Ao){var o;const n=this.rootTiles;if(R(n)||!n.length||n[0].layerInfo[Qt.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=i,!un(s,r,s,(o=this.tilingScheme)==null?void 0:o.spatialReference))return gd.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of n){if(!a.containsPoint(s))continue;for(;a&&!a.rendered&&!a.isLeaf;){let c=0;s[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),s[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c]}const l=a.renderData;return(l?l.geometryState.samplerData:null)?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!jn(e,Ao,this.spatialReference))return gd.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(_(t)){for(let i of t)if(i==null?void 0:i.containsPoint(Ao)){for(;!i.isLeaf&&!i.rendered;){let r=0;Ao[0]>i.children[0].extent[2]&&(r+=1),Ao[1]<i.children[0].extent[1]&&(r+=2),i=i.children[r]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100}getSphereElevationBounds(e,t,i,r,s){var c;if(Ao[0]=e,Ao[1]=t,Ao[2]=i,Ao[3]=r,!un(Ao,s,Ao,(c=this.tilingScheme)==null?void 0:c.spatialReference))return gd.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&nee(h.extent,Ao))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this.rootTiles;if(_(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!jn(e,Ao,this.spatialReference))return gd.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ao[3]=t;let i=null;const r=n=>{if(n&&nee(n.extent,Ao))if(n.isLeaf||n.rendered){const o=this._getLodBiasCorrectedScale(n.level);i=i==null?o:Math.min(i,o)}else for(const o of n.children)r(o)},s=this.rootTiles;if(_(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?Vn.UNFADED:Vn.IMMEDIATE)}_updateTilingScheme(){var t,i;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(Rf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(t=this.view)==null?void 0:t.state)==null?void 0:i.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return dL[0]=e,dL[1]=t,dL[2]=i,s.init(dL,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=_gt;let r=t.rootTilesInExtent(e,i,5*IS);if(_(this.rootTiles)){if(r.length>IS)return void gd.warn(PHe);const s=this.rootTiles.map(o=>o.lij),n=lRe(s,r,dce);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>dce(l,a.lij))>-1)||(this._purgeTile(a,!0),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>IS&&(gd.warn(IHe),r=t.rootTilesInExtent(e,i,IS)),this._setRootTiles(r.map(s=>this._newRootTile(s)));Xb(i,this._rootTilesExtent)||(this._rootTilesExtent=kt(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(s=>{s.isLoaded&&this._prepareToLoadTile(s)}),this._allTiles.forAll(s=>{s.isLoaded&&(this._updateTileGeometry(s),this._updateTileNeighborsAfterGeometryChange(s))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===bt.SPLIT&&t.setPendingUpdate(bt.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),_(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(bt.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(R(e))return;const t=dft(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(bt.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(bt.RENDERDATA);const c=l.computeVisibility();s||c?(l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),r=Math.max(l.elevationBounds[1],r))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(R(this._splitLimits.frustum)&&(this._splitLimits.frustum=HO()),E4(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,E4(this._frustum,e.frustum),Hr(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),ae(this._eyePosRenderSR,t.eye),un(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(CEe(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness()))):vgt(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const i=this.neighborTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const i=e.resetPendingUpdate(bt.TEXTURE_FADING)?bt.TEXTURE_FADING:!!e.resetPendingUpdate(bt.TEXTURE_NOFADING)&&bt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){pL.spatialReference=this.spatialReference,pL.tile=e,pL.extent=e.extent,this.emit("elevation-change",pL)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const i=t.next();if(i.loadable){const r=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(r===bt.SPLIT){i.resetPendingUpdate(bt.MERGE),i.isLeaf&&(i.setPendingUpdate(bt.SPLIT),t.skipSubtree());continue}i.resetPendingUpdate(bt.SPLIT)&&i.updateAgentSuspension(),r===bt.VSPLITMERGE&&i.updateAgents(Qt.ELEVATION)}if(t.skipSubtree(),!i.isLeaf){i.setPendingUpdate(bt.MERGE),i.resetPendingUpdate(bt.SPLIT);const r=this._iteratorPool.acquire();r.resetOne(i);for(let s=r.next();!r.done;s=r.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);r.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(uft(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){this.neighborTilesToUpdate.size,this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const i of e)i.updateNeighborsWithChangedEdgeResolution()};(()=>{for(const i of e)i.updateNeighborDataAndGeometryIfNeeded()})(),t(),e.clear()})()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let i=!1;for(;!e.done;){i=!0;let r=!1;const s=!this._allTiles.some(n=>{if(n.resetPendingUpdate(bt.MERGE)){if(!t)return n.setPendingUpdate(bt.MERGE),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(bt.SPLIT)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(bt.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(t=>(t.resetPendingUpdate(bt.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(ks.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*RHe}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=De(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){_(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),i}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){Rf(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(bt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){fL.spatialReference=this.spatialReference,fL.extent=e.extent,fL.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",fL)}_createTile(e,t,i,r){Rf(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===bt.SPLIT&&s.setPendingUpdate(bt.SPLIT)),s}_mergeTile(e){Rf(!e.hasPendingUpdate(bt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(Rf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),Rf(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(i=>this._prepareToLoadTile(i)),t.forEach(i=>this._loadTilePrepared(i)),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach(i=>i.updateNeighborsWithChangedEdgeResolution()),t.forEach(i=>i.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i)}}_postLoadTile(e){e.setPendingUpdate(bt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,i){const r=new Ypt(e.lij,e.extent,i);e.dataArrived(t,Qt.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=nC){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),c3(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);_(o)&&((o<r||R(r))&&(t=!0),r=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,i;let e=((i=(t=this.view.map)==null?void 0:t.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(Aq(r)&&!dye(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(a5(e)){const t=H2e(e.layer.parent)?"normal":e.layer.blendMode;if(fft(CN[t]))return!0}return!1}_layerClassFromLayerView(e){return Cq(e)?Qt.ELEVATION:Qt.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(ie(()=>e.suspended,()=>this._updateTiledLayers())),t.push(ie(()=>e.fullOpacity,()=>this._updateTileTextures(Vn.UNFADED))),t.push(ie(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),a5(e)&&t.push(ie(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Vn.UNFADED)})),e.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,e.uid);_(r)&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach(r=>{if(!r.layer||r.suspended||!c3(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===Qt.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}t[s].push(r)});for(const r of K1){const s=this._layerViews[r],n=t[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[r].set(p,h);const f=s.indexOf(n[h]);l[h]=f,h!==f&&(a=!0),f>-1&&(c[f]=h)}if(a){const h=this._postorderIterator;for(h.reset(this.rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===Qt.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(Qt.MAP),e===Vn.IMMEDIATE?this.renderer.updateTileTexture(t,bt.TEXTURE_NOFADING):t.updateRenderData(Qt.MAP,e)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=ks.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||l3(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],ye(F({},r),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Jr(o)||this._dataMissing(e,i,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===Qt.ELEVATION?Cq(i)?this._requestElevationTileData(e,i,r):Promise.reject():Aq(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=o=>{if(nn(i))return;const a=this._layerIndexByUid[Qt.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):gd.warn("TerrainSurface: received data from unknown layer %d %s",Qt.ELEVATION,e.lij.toString())},s=o=>{Jr(o)||(this._dataMissing(e,Qt.ELEVATION,t,o),this.requestUpdate())};if(Nle(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:wO,signal:i.signal}).then(o=>{if(!nn(i))return this._frameTask.schedule(()=>r(o),i.signal,s);gd.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:wO},i.signal)).then(o=>{o?r({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue}):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,f2(h),nn(i)||(this._dataMissing(e,Qt.MAP,t,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),nn(i)?f2(c):this._mapTileDataArrived(e,t,c)},i.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(l3(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],i).then(n,o)}if(az(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if(RJ(t)&&Nle(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(c=>{if(nn(i))return gd.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o(mi());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);RGe(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(Qt.MAP,t.uid);_(r)?e.dataArrived(r,Qt.MAP,i):(f2(i),gd.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);_(s)?e.dataMissing(s,t,r):gd.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(R(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),_(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return _(r)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(R(e)||R(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return Rf(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{_(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){_8.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&_8.push(i)});const t=_8.toArray();return tEe(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var e;return!!((e=this.tilingScheme)==null?void 0:e.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var e;return this.isWebMercator&&YM((e=this.view)==null?void 0:e.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}};u([d()],si.prototype,"_renderer",void 0),u([d()],si.prototype,"_hasPendingUpdates",void 0),u([d()],si.prototype,"_asyncWorkItems",void 0),u([d()],si.prototype,"_allTilesDirty",void 0),u([d()],si.prototype,"_allTilesSorted",void 0),u([d()],si.prototype,"_viewChanged",void 0),u([d({readOnly:!0})],si.prototype,"_watchUpdatingTracking",void 0),u([d()],si.prototype,"_frameTask",void 0),u([d({readOnly:!0})],si.prototype,"snapLevel",null),u([d({readOnly:!0})],si.prototype,"lodSnapping",null),u([d({constructOnly:!0})],si.prototype,"view",void 0),u([d()],si.prototype,"_userClippingExtent",null),u([d()],si.prototype,"_rootTilesExtent",void 0),u([d({readOnly:!0})],si.prototype,"extent",null),u([d({readOnly:!0})],si.prototype,"groundExtent",null),u([d({readOnly:!0})],si.prototype,"_tilingSchemeExtent",null),u([d({readOnly:!0})],si.prototype,"updating",null),u([d(Zpt)],si.prototype,"updatingProgress",void 0),u([d({readOnly:!0})],si.prototype,"updatingProgressValue",null),u([d()],si.prototype,"_maxNumUpdating",void 0),u([d({aliasOf:"view.map.ground.opacity"})],si.prototype,"baseOpacity",void 0),u([d()],si.prototype,"hasCompositeBlendMode",void 0),u([d({readOnly:!0})],si.prototype,"overlayManager",void 0),u([d({readOnly:!0})],si.prototype,"viewingMode",null),u([d()],si.prototype,"maxTextureScale",void 0),u([d({readOnly:!0})],si.prototype,"ready",null),u([d({value:h3.FRONT_TO_BACK})],si.prototype,"renderOrder",null),u([d({readOnly:!0})],si.prototype,"rootTiles",void 0),u([d({readOnly:!0})],si.prototype,"spatialReference",null),u([d({type:Pe,aliasOf:"view.map.ground.surfaceColor"})],si.prototype,"backgroundColor",void 0),u([d({value:!1})],si.prototype,"slicePlaneEnabled",null),u([d({readOnly:!0})],si.prototype,"tilingScheme",void 0),u([d({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],si.prototype,"tilingSchemeLocked",void 0),u([d({readOnly:!0})],si.prototype,"tilingSchemeLogic",void 0),u([d({value:!0})],si.prototype,"velvetOverground",null),u([Xe("_renderer.wireframe")],si.prototype,"wireframe",void 0),u([d({value:!1})],si.prototype,"suspended",null),u([d({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],si.prototype,"textureFadeDuration",void 0),u([d()],si.prototype,"_layerViewsDirty",void 0),u([Xe("_renderer.renderPatchBorders")],si.prototype,"renderPatchBorders",void 0),u([Xe("_renderer.renderingDisabled")],si.prototype,"renderingDisabled",void 0),si=u([P("esri.views.3d.terrain.TerrainSurface")],si);const ygt=si;function dce(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function CEe(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>CEe(t)))}function vgt(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const Ao=Xt(),_gt=kt(),dL=[0,0,0],_8=new Wt,pL={spatialReference:null,tile:null,extent:null,context:"ground"},fL={spatialReference:null,extent:null,scale:0};let BR=class extends Se{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach((o,a)=>{const l=o[0],c=o[1],h=o[2];let p=!1;if(c&ti.Geometry.UPDATE){const f=n.get(a);if(f){const m=f[1];if(h&ti.State.TRANSFORMATION){const y=this.model.getObject(s);this.model.updateRenderGeometryTransformation(y,l,m)&&(p=!0)}p||t.updates.push({renderGeometry:m,updateType:h})}else pt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&ti.Geometry.REMOVE||p){const f=n.get(a);f?(t.removes.push(f[1]),n.delete(a),f[0].disposed&&zw.pool.release(f[0])):c===ti.Geometry.REMOVE&&pt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&ti.Geometry.ADD||p){const f=this.model.getObject(s);if(_(f)){const m=this.model.getRenderGeometry(f,l),y=[l,m];t.adds.push(m),n.set(a,y)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,ti.Geometry.UPDATE,0,0,ti.Geometry.UPDATE,ti.Geometry.ADD|ti.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(ti.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(ti.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(ti.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,ti.Geometry.UPDATE,0,0,ti.Geometry.UPDATE,ti.Geometry.ADD|ti.Geometry.REMOVE,ti.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r[0],t,ti.Geometry.UPDATE,0,0,ti.Geometry.UPDATE,ti.Geometry.ADD|ti.Geometry.REMOVE,ti.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,ti.Geometry.ADD,ti.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,ti.Geometry.REMOVE,ti.Geometry.ADD,ti.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,o,a,l){i=vt(i,this._getParentLayerId(e));const c=e.id,h=t.id,p=this._ensureDirtyRecord(i,c),f=p.get(h);if(f){const m=f[1];m&s?(p.delete(h),f[0].disposed&&zw.pool.release(f[0])):m&n?(f[1]=r,f[2]=l):m&o?f[2]|=l:m&a||pt(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else p.set(h,[t,r,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return sn(this._dirtyGeomRecords,e=>sn(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return _(e.parentLayer)?e.parentLayer.id:UMe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const o=[];s.forEach(a=>{const l=a[1];o[l]||(o[l]=[]),o[l].push(a[0].geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)}}}};u([d({constructOnly:!0})],BR.prototype,"model",void 0),u([d()],BR.prototype,"dirty",void 0),BR=u([P("esri.views.3d.webgl-engine.lib.ModelDirtySet")],BR);const bgt=BR;let PN=class extends Se{constructor(){super(...arguments),this.dirtySet=new bgt({model:this}),this._content=new Map,this._originFactory=new nJ(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;pt(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),H4(e)&&this.dirtySet.layerAdded(e)}remove(e){pt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),H4(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)_(t)&&(pt(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)pt(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new IE(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,i){if(R(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<Mp.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([d({constructOnly:!0})],PN.prototype,"dirtySet",void 0),PN=u([P("esri.views.3d.webgl-engine.parts.Model")],PN);function AEe(){const e=new Float32Array(4);return e[3]=1,e}function REe(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function wgt(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function MEe(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:AEe,clone:REe,fromValues:wgt,createView:MEe},Symbol.toStringTag,{value:"Module"}));const ps=!0,Gb={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function GJ(e,t,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,i+Gb.identifierOffset,Gb.identifierLength)),version:t.getUint16(i+Gb.versionOffset,ps),checksum:t.getUint32(i+Gb.checksumOffset,ps)}}const Kl={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function xgt(e,t){return{sizeLo:e.getUint32(t+Kl.sizeLo,ps),sizeHi:e.getUint32(t+Kl.sizeHi,ps),minX:e.getFloat64(t+Kl.minX,ps),minY:e.getFloat64(t+Kl.minY,ps),minZ:e.getFloat64(t+Kl.minZ,ps),maxX:e.getFloat64(t+Kl.maxX,ps),maxY:e.getFloat64(t+Kl.maxY,ps),maxZ:e.getFloat64(t+Kl.maxZ,ps),errorX:e.getFloat64(t+Kl.errorX,ps),errorY:e.getFloat64(t+Kl.errorY,ps),errorZ:e.getFloat64(t+Kl.errorZ,ps),count:e.getUint32(t+Kl.count,ps),reserved:e.getUint32(t+Kl.reserved,ps)}}function lCt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=GJ(e,t,i);if(i+=Gb.byteCount,r!=="LEPCC     ")throw new j("lepcc-decode-error","Bad identifier");if(s>1)throw new j("lepcc-decode-error","Unknown version");const n=xgt(t,i);if(i+=Kl.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new j("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(i=mL(e,i,a),i=mL(e,i,l),i=mL(e,i,c),i=mL(e,i,h),i!==e.byteLength)throw new j("lepcc-decode-error","Bad length");let p=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let y=0;for(let v=0;v<l[m];v++){y+=c[p];const w=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*y),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*f),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*w),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function mL(e,t,i){const r=[];t=Iq(e,t,r);const s=[];for(let n=0;n<r.length;n++){s.length=0,t=Iq(e,t,s);for(let o=0;o<s.length;o++)i.push(s[o]+r[n])}return t}function Iq(e,t,i){const r=new DataView(e,t),s=r.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=r.getUint32(1,ps),t+=5;else if(a===1)l=r.getUint16(1,ps),t+=3;else{if(a!==2)throw new j("lepcc-decode-error","Bad count type");l=r.getUint8(1),t+=2}if(o)throw new j("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(e,t,c);let p=0,f=0,m=0;const y=-1>>>32-n;for(let v=0;v<l;v++){for(;f<n;)p|=h[m]<<f,f+=8,m+=1;i[v]=p&y,p>>>=n,f-=n,f+n>32&&(p|=h[m-1]>>8-f)}return t+m}const eb={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function Tgt(e,t){return{sizeLo:e.getUint32(t+eb.sizeLo,ps),sizeHi:e.getUint32(t+eb.sizeHi,ps),count:e.getUint32(t+eb.count,ps),colorMapCount:e.getUint16(t+eb.colorMapCount,ps),lookupMethod:e.getUint8(t+eb.lookupMethod),compressionMethod:e.getUint8(t+eb.compressionMethod)}}function Sgt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=GJ(e,t,i);if(i+=Gb.byteCount,r!=="ClusterRGB")throw new j("lepcc-decode-error","Bad identifier");if(s>1)throw new j("lepcc-decode-error","Unknown version");const n=Tgt(t,i);if(i+=eb.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new j("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+i!==e.byteLength||n.colorMapCount>256)throw new j("lepcc-decode-error","Bad count");const o=new Uint8Array(e,i,3*n.colorMapCount),a=new Uint8Array(e,i+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+i!==e.byteLength||n.colorMapCount!==0)throw new j("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(i+3!==e.byteLength||n.colorMapCount!==1)throw new j("lepcc-decode-error","Bad count");const o=t.getUint8(i),a=t.getUint8(i+1),l=t.getUint8(i+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new j("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const tb={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function Egt(e,t){return{sizeLo:e.getUint32(t+tb.sizeLo,ps),sizeHi:e.getUint32(t+tb.sizeHi,ps),count:e.getUint32(t+tb.count,ps),scaleFactor:e.getUint16(t+tb.scaleFactor,ps),bitsPerPoint:e.getUint8(t+tb.bitsPerPoint),reserved:e.getUint8(t+tb.reserved)}}function Cgt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=GJ(e,t,i);if(i+=Gb.byteCount,r!=="Intensity ")throw new j("lepcc-decode-error","Bad identifier");if(s>1)throw new j("lepcc-decode-error","Unknown version");const n=Egt(t,i);if(i+=tb.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new j("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+i!==e.byteLength)throw new j("lepcc-decode-error","Bad size");const a=new Uint8Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+i!==e.byteLength)throw new j("lepcc-decode-error","Bad size");const a=new Uint16Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(Iq(e,i,a)!==e.byteLength)throw new j("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const $q=fe.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Agt(e,t,i){let r="",s=0;for(;s<i;){const n=e[t+s];if(n<128)r+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=i)throw new j("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&e[t+s+1];r+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=i)throw new j("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];r+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new j("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=i)throw new j("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);r+=String.fromCharCode(a,l)}else r+=String.fromCharCode(o);s+=4}}}return r}function OEe(e,t){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=Dgt[o];i.fields[n.property]=a(e,r),r+=mz[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function Rgt(e,t,i){const r=[];let s,n,o=0;for(n=0;n<e;n+=1){if(s=t[n],s>0){if(r.push(Agt(i,o,s-1)),i[o+s-1]!==0)throw new j("string-array-error","Invalid string array: missing null termination.")}else r.push(null);o+=s}return r}function pce(e,t){return new mz[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function Mgt(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function Ogt(e,t,i){const r=t.header!=null?OEe(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},s={header:r,byteOffset:r.byteCount,byteCount:0,entries:Object.create(null)};let n=r.byteCount;for(let o=0;o<t.ordering.length;o++){const a=t.ordering[o],l=re(t[a]);if(l.count=r.fields.count,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=r.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new j("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!IEe(l.valueType))throw new j("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=IN(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function PEe(e,t,i){if(t!==e&&$q.error(`Invalid ${i} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new j("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function Pgt(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function cCt(e,t){const i=OEe(e,t&&t.header);let r=i.byteCount;const s={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const h=ye(F({},t.vertexAttributes[c]),{byteOffset:r,count:o}),p=fce[c]?fce[c]:"_"+c;s.vertexAttributes[p]=h,r+=IN(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const h=ye(F({},t.faces[c]),{byteOffset:r,count:a});s.faces[c]=h,r+=IN(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const h=ye(F({},t.featureAttributes[c]),{byteOffset:r,count:l});s.featureAttributes[c]=h,r+=(h.valueType==="UInt64"?8:IN(h.valueType))*h.valuesPerElement*l}}return PEe(r,e.byteLength,"geometry"),s.byteCount=r-s.byteOffset,s}function uCt(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?Pgt(e):Igt(t):$gt(e.compressedAttributes.attributes)}function Igt(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e.ordering)if(e.vertexAttributes[i])switch(i){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function $gt(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e)switch(i){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const fce={position:M.POSITION,normal:M.NORMAL,color:M.COLOR,uv0:M.UV0,region:M.UVREGION};function Lgt(e,t,i){if(e.encoding==="lepcc-rgb")return Sgt(t);if(e.encoding==="lepcc-intensity")return Cgt(t);if(e.encoding!=null&&e.encoding!=="")throw new j("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&($q.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&($q.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const r=Ogt(t,e,i);PEe(r.byteOffset+r.byteCount,t.byteLength,"attribute");const s=r.entries.attributeValues||r.entries.objectIds;if(s){if(s.valueType==="String"){const n=r.entries.attributeByteCounts,o=pce(t,n),a=Mgt(t,s);return Rgt(n.count,o,a)}return pce(t,s)}throw new j("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const mz={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},Dgt={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function IEe(e){return mz.hasOwnProperty(e)}function IN(e){return IEe(e)?mz[e].BYTES_PER_ELEMENT:0}function Ngt(e,t,i,r){const s=Fgt(e,t,i),n=Ae();return Nu(i,s,n,r),n}const $Ee=1,mce=5-$Ee;function Fgt(e,t,i){const r=O(),s=e[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/mce)*mce+$Ee);if(i.isGeographic){const l=n/Ci(i).radius*180/Math.PI,c=Math.round(e[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),f=Math.round(e[0]/p)*p;r[0]=f,r[1]=h}else{const l=Math.round(e[0]/n),c=Math.round(e[1]/n);r[0]=l*n,r[1]=c*n}const o=e[2]+t,a=Math.round(o/n);return r[2]=a*n,r}const NE=1e-6,_A=[0,0,0],gL=[0,0,0];function kgt(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new Wgt(e);$N(_A,n.minProj,n.maxProj),Cb(_A,_A,.5),$h(gL,n.maxProj,n.minProj);const o=Lq(gL),a=new Xgt;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],f=[0,0,0],m=[0,0,0],y=[0,0,0];switch(Ugt(n,e,y,l,c,h,p,f,m,a)){case 1:return void _ce(_A,gL,t);case 2:return void qgt(e,p,t)}zgt(e,y,l,c,h,p,f,m,a),LEe(e,a.b0,a.b1,a.b2,_2,b2);const v=[0,0,0];$h(v,b2,_2),a.quality=Lq(v),a.quality<o?DEe(a.b0,a.b1,a.b2,_2,b2,v,t):_ce(_A,gL,t)}function Ugt(e,t,i,r,s,n,o,a,l,c){return Vgt(e,r,s),Dq(r,s)<NE?1:($h(o,r,s),$o(o,o),Bgt(t,r,o,n)<NE?2:($h(a,s,n),$o(a,a),$h(l,n,r),$o(l,l),Lh(i,a,o),$o(i,i),ib(t,i,o,a,l,c),0))}const bA=[0,0,0],wA=[0,0,0],eh=[0,0,0],th=[0,0,0],ih=[0,0,0],t0=[0,0,0],i0=[0,0,0],r0=[0,0,0];function zgt(e,t,i,r,s,n,o,a,l){Ggt(e,t,i,bA,wA),bA[0]!==void 0&&($h(eh,bA,i),$o(eh,eh),$h(th,bA,r),$o(th,th),$h(ih,bA,s),$o(ih,ih),Lh(t0,th,n),$o(t0,t0),Lh(i0,ih,o),$o(i0,i0),Lh(r0,eh,a),$o(r0,r0),ib(e,t0,n,th,eh,l),ib(e,i0,o,ih,th,l),ib(e,r0,a,eh,ih,l)),wA[0]!==void 0&&($h(eh,wA,i),$o(eh,eh),$h(th,wA,r),$o(th,th),$h(ih,wA,s),$o(ih,ih),Lh(t0,th,n),$o(t0,t0),Lh(i0,ih,o),$o(i0,i0),Lh(r0,eh,a),$o(r0,r0),ib(e,t0,n,th,eh,l),ib(e,i0,o,ih,th,l),ib(e,r0,a,eh,ih,l))}function Vgt(e,t,i){let r=Dq(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=Dq(e.maxVert[n],e.minVert[n]);o>r&&(r=o,s=n)}_c(t,e.minVert[s]),_c(i,e.maxVert[s])}const rh=[0,0,0];function Bgt(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){rh[0]=s[l]-t[0],rh[1]=s[l+1]-t[1],rh[2]=s[l+2]-t[2];const c=i[0]*rh[0]+i[1]*rh[1]+i[2]*rh[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=rh[0]*rh[0]+rh[1]*rh[1]+rh[2]*rh[2]-c*c/h;p>o&&(o=p,a=l)}return _c(r,s,a),o}const bn=[0,0];function Ggt(e,t,i,r,s){Hgt(e,t,bn,s,r);const n=FEe(i,t);bn[1]-NE<=n&&(r[0]=void 0),bn[0]+NE>=n&&(s[0]=void 0)}const gce=[0,0,0],yce=[0,0,0],vce=[0,0,0],lT=[0,0,0],cT=[0,0,0],yL=[0,0,0];function ib(e,t,i,r,s,n){if(NEe(t)<NE)return;Lh(gce,i,t),Lh(yce,r,t),Lh(vce,s,t),v2(e,t,bn),cT[1]=bn[0],lT[1]=bn[1],yL[1]=lT[1]-cT[1];const o=[i,r,s],a=[gce,yce,vce];for(let l=0;l<3;++l){v2(e,o[l],bn),cT[0]=bn[0],lT[0]=bn[1],v2(e,a[l],bn),cT[2]=bn[0],lT[2]=bn[1],yL[0]=lT[0]-cT[0],yL[2]=lT[2]-cT[2];const c=Lq(yL);c<n.quality&&(_c(n.b0,o[l]),_c(n.b1,t),_c(n.b2,a[l]),n.quality=c)}}const jgt=[0,0,0];function v2(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function Hgt(e,t,i,r,s){const{data:n,size:o}=e;_c(r,n),_c(s,r),i[0]=FEe(jgt,t),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<i[0]&&(i[0]=l,_c(r,n,a)),l>i[1]&&(i[1]=l,_c(s,n,a))}}function _ce(e,t,i){_c(i.center,e),Cb(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const km=[0,0,0],uT=[0,0,0],xA=[0,0,0],_2=[0,0,0],b2=[0,0,0],bce=[0,0,0];function qgt(e,t,i){_c(km,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?km[0]=0:Math.abs(t[1])>Math.abs(t[2])?km[1]=0:km[2]=0,NEe(km)<NE&&(km[0]=km[1]=km[2]=1),Lh(uT,t,km),$o(uT,uT),Lh(xA,t,uT),$o(xA,xA),LEe(e,t,uT,xA,_2,b2),$h(bce,b2,_2),DEe(t,uT,xA,_2,b2,bce,i)}function LEe(e,t,i,r,s,n){v2(e,t,bn),s[0]=bn[0],n[0]=bn[1],v2(e,i,bn),s[1]=bn[0],n[1]=bn[1],v2(e,r,bn),s[2]=bn[0],n[2]=bn[1]}const vL=[0,0,0],Zp=[1,0,0,0,1,0,0,0,1],hT=[0,0,0];function DEe(e,t,i,r,s,n,o){Zp[0]=e[0],Zp[1]=e[1],Zp[2]=e[2],Zp[3]=t[0],Zp[4]=t[1],Zp[5]=t[2],Zp[6]=i[0],Zp[7]=i[1],Zp[8]=i[2],Zgt(o.quaternion,Zp),$N(hT,r,s),Cb(hT,hT,.5),Cb(o.center,e,hT[0]),Cb(vL,t,hT[1]),$N(o.center,o.center,vL),Cb(vL,i,hT[2]),$N(o.center,o.center,vL),Cb(o.halfSize,n,.5)}const jc=7;class Wgt{constructor(t){this.minVert=new Array(jc),this.maxVert=new Array(jc);const i=64*jc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,jc),r+=8*jc,this.maxProj=new Float64Array(this.buffer,r,jc),r+=8*jc;for(let l=0;l<jc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<jc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<jc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(jc),n=new Array(jc),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<jc;++l){let c=s[l];_c(this.minVert[l],o,c),c=n[l],_c(this.maxVert[l],o,c)}}}class Xgt{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function Lq(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function $N(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function $h(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function Cb(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function _c(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function Lh(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function $o(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function NEe(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function Dq(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function FEe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Zgt(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+r]+t[3*r+s])*o,e[n]=(t[3*n+r]+t[3*r+n])*o}}const UM=fy(),jb=O(),Ygt=O(),Qgt=Or();class hCt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:HW(this.buffer,56*a+0),halfSize:zbe(this.buffer,56*a+24),quaternion:MEe(this.buffer,56*a+36)}}}function jJ(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:Vs(e),halfSize:v4(t),quaternion:REe(i)}}function wce(e){return jJ(e.center,e.halfSize,e.quaternion)}function dCt(e,t){ae(t.center,e.center),ae(t.halfSize,e.halfSize),Q3(t.quaternion,e.quaternion)}function kEe(e,t){return t=t||jJ(),kgt(e,t),t}function rb(e,t){const i=lr(t,e.center),r=gz(e,t);return i>r?1:i<-r?-1:0}function pCt(e,t){t||(t=Gs());const i=nU(Qgt,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function fCt(e,t){return lr(t,e.center)-gz(e,t)}function mCt(e,t){return lr(t,e.center)+gz(e,t)}function gCt(e,t){return rb(e,t[0])<=0&&rb(e,t[1])<=0&&rb(e,t[2])<=0&&rb(e,t[3])<=0&&rb(e,t[4])<=0&&rb(e,t[5])<=0}function yCt(e,t,i,r=0){oy(UM,e.quaternion),pe(jb,t,e.center);const s=Au(jb,jb,UM),n=Au(Ygt,i,UM);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+e.halfSize[l]-s[l])/n[l],h=(-r-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+r||s[l]<-e.halfSize[l]-r)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function gz(e,t){oy(UM,e.quaternion),Au(jb,t,UM);const i=e.halfSize;return Math.abs(jb[0]*i[0])+Math.abs(jb[1]*i[1])+Math.abs(jb[2]*i[2])}function UEe(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],Au(r,r,e.quaternion),de(r,r,e.center)}}function Jgt(e){return ZW(e.halfSize)}function zEe(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function vCt(e){var t;if(he("disable-feature:i3s-draco")||!e)return!1;for(const i of e)for(const r of i.geometryBuffers)if(((t=r.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function _Ct(e,t,i,r,s,n){const o=t!==r;s.traverse(i,a=>{let l=a.mbs;return o&&(l=Kgt,pNe(a.mbs,r,l,t)),eyt(e,l)!==Hb.OUTSIDE&&(n(a),!0)})}function bCt(e,t,i){let r=0,s=0;for(let n=0;n<t.length&&r<e.length;n++)e[r]===t[n]&&(i(n)&&(e[s]=e[r],s++),r++);e.length=s}function wCt(e,t,i){let r=0,s=0;for(;r<i.length;)whe(e,i[r])>=0===t&&(i[s]=i[r],s++),r++;i.length=s}const TA=kt();function xCt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return TA[0]=(e[0]-t.position[0])/t.rotationScale[0],TA[1]=(e[1]-t.position[1])/t.rotationScale[4],TA[2]=(e[2]-t.position[0])/t.rotationScale[0],TA[3]=(e[3]-t.position[1])/t.rotationScale[4],TA}const Kgt=Xt();var Hb;function eyt(e,t){const i=t[0],r=t[1],s=t[3],n=e[0]-i,o=i-e[2],a=e[1]-r,l=r-e[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?Hb.OUTSIDE:p>0?Hb.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?Hb.INSIDE:Hb.INTERSECTS_CENTER_INSIDE}function tyt(e,t,i){const r=[],s=i&&i.missingFields,n=i&&i.originalFields;for(const o of e){const a=o.toLowerCase();let l=!1;for(const c of t)if(a===c.name.toLowerCase()){r.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return r}async function TCt(e,t,i,r,s){if(t.length===0)return[];const n=e.attributeStorageInfo;if(_(e.associatedLayer))try{return await ryt(e.associatedLayer,t,i,r)}catch(o){if(e.associatedLayer.loaded)throw o}if(n){const o=iyt(t,i,s);if(R(o))throw new j("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=e.parsedUrl.path,l=await Promise.all(o.map(c=>syt(a,n,c.node,c.indices,r).then(h=>{for(let p=0;p<c.graphics.length;p++){const f=c.graphics[p],m=h[p];if(f.attributes)for(const y in f.attributes)y in m||(m[y]=f.attributes[y]);f.attributes=m}return c.graphics})));return xhe(l)}throw new j("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function iyt(e,t,i){const r=new Map,s=[],n=i();for(const o of e){const a=o.attributes[t];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=r.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),r.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let f=l;f>0;f--)n[f]=n[f-1];n[0]=c;break}}}return s}async function ryt(e,t,i,r){t.sort((l,c)=>l.attributes[i]-c.attributes[i]);const s=t.map(l=>l.attributes[i]),n=[],o=tyt(r,e.fields,{originalFields:n}),a=await VEe(e,s,o);for(let l=0;l<t.length;l++){const c=t[l],h=a[l],p={};if(c.attributes)for(const f in c.attributes)p[f]=c.attributes[f];for(let f=0;f<n.length;f++)p[n[f]]=h[o[f]];c.attributes=p}return t}function VEe(e,t,i){const r=e.capabilities.query.maxRecordCount;if(r!=null&&t.length>r){const n=uRe(t,r);return Promise.all(n.map(o=>VEe(e,o,i))).then(xhe)}const s=new Fh({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===t.length)return n.features.map(o=>o.attributes);throw new j("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function syt(e,t,i,r,s){const n=[];for(const o of t)if(o&&s.includes(o.name)){const a=`${e}/nodes/${i.resources.attributes}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return gs(n.map(o=>Zt(o.url,{responseType:"array-buffer"}).then(a=>Lgt(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of r){const c={};for(let h=0;h<o.length;h++)o[h].value!=null&&(c[n[h].storageInfo.name]=ayt(o[h].value,l));a.push(c)}return a})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(Hb||(Hb={}));const nyt=-32768,oyt=-(2**31);function ayt(e,t){if(!e)return null;const i=e[t];return Che(e)?i===nyt?null:i:Ahe(e)?i===oyt?null:i:i!=i?null:i}function lyt(e){const t=e.store.indexCRS||e.store.geographicCRS,i=t===void 0?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new j("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new j("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new et(zEe(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function cyt(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=t===void 0?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new j("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new j("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new et(zEe(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function SCt(e,t){return R(t)?"@null":t===em(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function Nq(e,t,i){if(!im(e,t))throw new j("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(i==="local"&&!uyt(e,t))throw new j("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function uyt(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function hyt(e,t,i){const r=lyt(e),s=cyt(e);Nq(r,t,i),Nq(s,t,i)}function dyt(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function ECt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!dyt(e.store.defaultGeometrySchema))throw new j("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function CCt(e,t){hyt(e,t.spatialReference,t.viewingMode)}function pyt(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function ACt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!pyt(e.store.defaultGeometrySchema))throw new j("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function RCt(e,t){Nq(e.spatialReference,t.spatialReference,t.viewingMode)}function fyt(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function myt(e){return e.type==="mesh-3d"}function MCt(e){if(e==null||!fyt(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const i of t){if(!myt(i)||i.symbolLayers.length===0)return!0;for(const r of i.symbolLayers.items)if(r.type!=="fill"||R(r.material)||R(r.material.color)||r.material.colorMixMode!=="replace")return!0}return!1}const OCt=UTe({color:[0,0,0,0],opacity:0});class gyt{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function PCt(e){const t=new gyt;let i=!1,r=!1;for(const s of e.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(_(n)&&!i){const a=n.color,l=OSe(n.colorMixMode);_(a)?t.material={color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:Es.Multiply},t.castShadows=s.castShadows,i=!0}_(o)&&!r&&(t.edgeMaterial=kTe(o,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:Es.Multiply}),t}function ICt(e,t){return(0|e)+(0|t)|0}function yyt(e,t,i,r,s=0){r===em(r)?t.isGeographic?Syt(e,i,t,s):Tyt(e,i,t,s):t.isWGS84&&(r.isWebMercator||YM(r))?_yt(t,e,r,i,s):t.isWebMercator&&YM(r)?xyt(t,e,r,i,s):e===i?(i.center[2]+=s,dr(i.center,t,0,i.center,r,0,1)):(se(i.center,e.center[0],e.center[1],e.center[2]+s),dr(i.center,t,0,i.center,r,0,1),Q3(i.quaternion,e.quaternion),ae(i.halfSize,e.halfSize))}function vyt(e,t,i,r,s){if(Q3(s.quaternion,e.quaternion),r===Ge.Global){oy(_L,e.quaternion),Au(s0,e.center,_L),y9(dT,s0),mpe(pT,dT,e.halfSize),Cc(pT,dT,pT);const n=Me(pT);de(pT,dT,e.halfSize);const o=Me(pT);if(n<i)ae(s.center,e.center),se(s0,i,i,i),de(s.halfSize,e.halfSize,s0);else{const a=o>0?1+t/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;le(s.halfSize,dT,h),Rb(s.halfSize,s.halfSize,e.halfSize,c),le(s.center,dT,c),Rb(s.center,s.center,e.halfSize,h),fpe(s0,s0),F5(s.center,s.center,s0),Au(s.center,s.center,s.quaternion)}}else{const n=se(s0,0,0,1);Rb(s.center,e.center,n,(i+t)/2),oy(_L,e.quaternion),Au(n,n,_L),y9(n,n),Rb(s.halfSize,e.halfSize,n,(i-t)/2)}return s}const s0=O(),dT=O(),pT=O(),_L=fy();function _yt(e,t,i,r,s){ae(hv,t.center),hv[2]+=s;const n=em(i);dr(hv,e,0,hv,n,0,1),BEe(n,t,hv,i,r)}const LN=new Float64Array(24),byt={data:LN,size:3},xce=O(),hv=O(),wyt=Or();function xyt(e,t,i,r,s){ae(hv,t.center),hv[2]+=s,BEe(e,t,hv,i,r)}function BEe(e,t,i,r,s){const n=nU(wyt,t.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)xce[a]=t.halfSize[a]*((o&1<<a)!=0?-1:1);for(let a=0;a<3;++a){let l=i[a];for(let c=0;c<3;++c)l+=xce[c]*n[3*c+a];LN[3*o+a]=l}}dr(LN,e,0,LN,r,0,8),kEe(byt,s)}function Tyt(e,t,i,r){UEe(e,Fq),se(t.center,e.center[0],e.center[1],e.center[2]+r),Nu(i,t.center,Hc,em(i)),se(t.center,Hc[12],Hc[13],Hc[14]);const s=2*Math.sqrt(1+Hc[0]+Hc[5]+Hc[10]);_g[0]=(Hc[6]-Hc[9])/s,_g[1]=(Hc[8]-Hc[2])/s,_g[2]=(Hc[1]-Hc[4])/s,_g[3]=.25*s,GY(t.quaternion,_g,e.quaternion),oy(_g,t.quaternion);let n=0,o=0,a=0;for(const l of Fq)l[2]+=r,dr(l,i,0,l,em(i),0,1),Cc(Ti,l,t.center),Au(Ti,Ti,_g),n=Math.max(n,Math.abs(Ti[0])),o=Math.max(o,Math.abs(Ti[1])),a=Math.max(a,Math.abs(Ti[2]));se(t.halfSize,n,o,a)}function Syt(e,t,i,r){const s=Ci(i),n=1+Math.max(0,r)/(s.radius+e.center[2]);se(t.center,e.center[0],e.center[1],e.center[2]+r),dr(t.center,i,0,t.center,em(i),0,1),Q3(t.quaternion,e.quaternion),oy(_g,e.quaternion),se(Ti,0,0,1),Au(Ti,Ti,_g),se(Ti,e.halfSize[0]*Math.abs(Ti[0]),e.halfSize[1]*Math.abs(Ti[1]),e.halfSize[2]*Math.abs(Ti[2])),le(Ti,Ti,s.inverseFlattening),de(t.halfSize,e.halfSize,Ti),le(t.halfSize,t.halfSize,n)}function $Ct(e,t,i,r,s,n){if(!n||n.length===0||R(t))return null;const o=Ngt(e.mbs,s,i,t);let a;_s(wL,o);const l=()=>{if(!a)if(a=Fq,Lu(bL),_(e.serviceObb)){yyt(e.serviceObb,i,Tce,t,s),UEe(Tce,a);for(const m of a)ze(m,m,wL),KS(bL,m)}else{const m=e.mbs,y=m[3];un(m,i,Ti,t),ze(Ti,Ti,wL),Ti[2]+=s;for(let v=0;v<8;++v){const w=1&v?y:-y,b=2&v?y:-y,S=4&v?y:-y,T=a[v];ae(T,[Ti[0]+w,Ti[1]+b,Ti[2]+S]),KS(bL,T)}}};let c=1/0,h=-1/0;const p=m=>{if(m.type!=="replace")return;const y=m.geometry;if(!y.hasZ)return;Lu(b8);const v=y.spatialReference||r,w=y.rings.reduce((b,S)=>S.reduce((T,E)=>(un(E,v,Ti,t),ze(Ti,Ti,wL),KS(b8,Ti),Math.min(Ti[2],T)),b),1/0);l(),O3(bL,b8)&&(c=Math.min(c,w),h=Math.max(h,w))};if(n.forEach(m=>p(m)),c===1/0)return null;const f=(m,y,v)=>{ze(Ti,v,o),m[y+0]=Ti[0],m[y+1]=Ti[1],m[y+2]=Ti[2],y+=24,v[2]=c,ze(Ti,v,o),m[y+0]=Ti[0],m[y+1]=Ti[1],m[y+2]=Ti[2],y+=24,v[2]=h,ze(Ti,v,o),m[y+0]=Ti[0],m[y+1]=Ti[1],m[y+2]=Ti[2]};for(let m=0;m<8;++m)f(Sce.data,3*m,a[m]);return kEe(Sce)}function LCt(e){return _(e)&&e.halfSize[0]>=0}function DCt(e){return e[3]>=0}function NCt(e){_(e)&&(e.halfSize[0]=-1)}function FCt(e){_(e)&&(e[3]=-1)}const Hc=Ae(),_g=AEe(),Fq=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],b8=kt(),bL=kt(),Tce=jJ(),Ti=[0,0,0],Sce={data:new Array(72),size:3},wL=Ae();class Eyt{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=Cyt(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}}function Cyt(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class Ayt extends LU{constructor(t,i){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=gW(i);const r=this.count;this.visibility=new Eyt(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return R(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return R(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return R(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((R(this.cachedHighlightRanges)||R(this.cachedDefaultRanges))&&_(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=Ryt(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function Ryt(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}class kq extends LU{constructor(){super(...arguments),this.visible=w2.Hidden}}var w2;u([Io()],kq.prototype,"renderable",void 0),u([Io()],kq.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(w2||(w2={}));function Myt(e,t,i,r){if(i>=t)return e;e==null&&(e=Oyt());const s=e.isVisibleBit;let n=e.data;const o=jEe(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const m=a+1,y=Math.ceil(h.length*1.5),v=c+1;let w=Math.max(m,y);w=Math.min(w,v),n=new Uint32Array(w),n.set(h)}return a<n.length&&(n[a]=Iyt(n[a],l,p)),e.data=n,e}function GEe(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=jEe(r);return t<r.length*s?Pyt(i,r,t,s):!e.isVisibleBit}function Oyt(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function Pyt(e,t,i,r){const s=i/r|0,n=i-s*r;return $yt(t[s],n)===e}function jEe(e){return e.BYTES_PER_ELEMENT*8}function Iyt(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function $yt(e,t){return(e&1<<t)!=0}class Lyt{constructor(t,i){this._indices=_(t.indices)?t.indices:wE(t.positions.length/3),this._positions=new Xi(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(_(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,h=this._components.offsets,p=zxe(t,i,Dyt),f=t[2],m=i[2];this._components.visibility.forEachComponent(y=>{if(!GEe(this._components.pickability,y))return!0;const v=this.getComponentAabb(y,Nyt);if(_(o)){const E=o[y];_(n)?n.componentOffset=E:(t[2]=f-E,i[2]=m-E)}if(_(n)&&n.applyToAabb(v),!kQ(v,t,p,r))return!0;const w=h[y]/3,b=h[y+1]/3,S=(E,C,A)=>{a(y,E,mc(C,C,s),A)},T=b-w;return R(n)&&T>xEe?(this._componentIntersectionData[y]==null&&(this._componentIntersectionData[y]=new DE(this._indices,w,b,l)),this._componentIntersectionData[y].intersectRay({r0:t,r1:i},S)):rP(t,i,w,b,c,l,void 0,n,S),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,f=1/0,m=-1/0,y=-1/0,v=-1/0;for(let w=l;w<c;w++){const b=i[w]*s,S=r[b],T=r[b+1],E=r[b+2];h=Math.min(h,S),p=Math.min(p,T),f=Math.min(f,E),m=Math.max(m,S),y=Math.max(y,T),v=Math.max(v,E)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=f,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=y,this._perComponentAabbs[o++]=v}}get positions(){return this._positions}get indices(){return this._indices}}const Dyt=O(),Nyt=Gs();class Fyt{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}dispose(){this.material.dispose(),this.geometry.dispose()}}class HEe extends LU{constructor(t,i,r,s){super(),this.primitiveType=i,this.parameters=r,this.indexed=s,this.vao=t}}u([Io()],HEe.prototype,"vao",void 0);function kyt(e,t){return{near:e,far:t}}function _P(e){return e?d3(e,1/0,-1/0):kyt(1/0,-1/0)}function d3(e,t,i){return e.near=t,e.far=i,e}function FE(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function xL(e,t){return e.near<=t&&t<=e.far}const Uq={near:0,far:0};function Uyt(e,t){const i=_P(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=_(o.offsetObb)?o.offsetObb:o.obb,l=xe(Cc(tu,a.center,r),n),c=gz(a,n);if(xL(i,l-c)&&xL(i,l+c))return;const h=jyt(a,s);if(h===-1)return;if(h===0)return Um.far=l+c,Um.near=l-c,void FE(i,Um);const p=TL.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<TL.length;o++){const a=TL.data[o];if(xL(i,a.near)&&xL(i,a.far))continue;Um.far=a.far,Um.near=1/0,Gyt(_(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,zyt,c=>{let h=Vyt;for(let p=0;p<qEe&&c.length>0;p++){if((a.mask&1<<p)==0)continue;Byt(s[p],c,h);const f=c;c=h,h=f}for(let p=0;p<c.length;p+=3){se(fl,c.data[p+0],c.data[p+1],c.data[p+2]);const f=xe(Cc(fl,fl,r),n);Um.near=Math.min(Um.near,f)}})===0&&(Um.near=0),FE(i,Um)}return TL.length=0,i}const TL=new Wt({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),Um=_P(),fl=O(),u1=O(),zyt=new Wt({deallocator:null}),Vyt=new Wt({deallocator:null});function Byt(e,t,i){i.length=0;const r=t.length-3;w8(fl,t,r);const s=lr(e,fl);s<=0&&(i.push(fl[0]),i.push(fl[1]),i.push(fl[2]));let n=0,o=s;for(;n<r;n+=3){w8(u1,t,n);const a=lr(e,u1);o*a<0&&(pn(fl,u1,fl,a/(a-o)),ml(i,fl)),a<=0&&ml(i,u1),o=a,ae(fl,u1)}o*s<0&&(w8(u1,t,r),pn(fl,u1,fl,s/(s-o)),ml(i,fl))}function w8(e,t,i){return se(e,t.data[i+0],t.data[i+1],t.data[i+2])}function ml(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function Gyt(e,t,i,r){oy(Cce,e.quaternion),Cc(tu,t,e.center),Au(tu,tu,Cce);const s=8*((tu[0]<-e.halfSize[0]?-1:tu[0]>e.halfSize[0]?1:0)+3*(tu[1]<-e.halfSize[1]?-1:tu[1]>e.halfSize[1]?1:0)+9*(tu[2]<-e.halfSize[2]?-1:tu[2]>e.halfSize[2]?1:0)+13),n=Ece[s];if(n===0)return n;nU(SL,e.quaternion),iQ(SL,SL,e.halfSize);const o=(a,l)=>{const c=Ece[s+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),mc(a,a,SL),de(a,e.center,a)};return i.length=0,ml(i,o(x8,0)),ml(i,o(Ace,1)),ml(i,o(tu,2)),ml(i,o(Rce,3)),r(i),n===1||(i.length=0,ml(i,x8),ml(i,Rce),ml(i,o(tu,4)),ml(i,o(Mce,5)),r(i),n===2||(i.length=0,ml(i,x8),ml(i,Mce),ml(i,o(tu,6)),ml(i,Ace),r(i))),n}const Ece=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),qEe=4;function jyt(e,t){let i=0;for(let r=0;r<qEe;r++){const s=rb(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const SL=Or(),Cce=fy(),tu=O(),x8=O(),Ace=O(),Rce=O(),Mce=O();class Hyt{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?Uyt(t,this._objects.visibleObjects):null}}function qyt(e){const t=ls().vec3f(M.POSITION);return e.normals&&t.vec2i16(M.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===an.Default?t.vec2f(M.UV0):e.textureCoordinates===an.Atlas&&(t.vec2f(M.UV0),t.vec4u16(M.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(M.COLOR,{glNormalized:!0}),t.alignTo(4)}class Wyt extends Kr{constructor(t,i){super(t,"int",ki.Draw,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}var _p;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(_p||(_p={}));const HJ=429496.7296;function WEe(e,t){ZO(e/HJ*.5+.5,t)}function Xyt(e,t){switch(t.componentData){case _p.Varying:return Zyt(e);case _p.Uniform:return Yyt(e);case _p.COUNT:return;default:t.componentData}}function Zyt(e){const{vertex:t,fragment:i}=e;t.include(Lc),t.uniforms.add([new zr("componentColorTex"),new zg("componentColorTexInvDim")]),e.attributes.add(M.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(ISe),t.constants.add("elevationScale","float",2*HJ),t.code.add(x`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),i.code.add(x`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function Yyt(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new h5("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new Wyt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(x`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(x`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var Uh;function Qyt(e,t){const i=e.vertex;switch(i.code.add(x`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case Uh.None:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Uh.Opaque:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Uh.Transparent:i.code.add(x`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Uh||(Uh={}));var jf;function kCt(e){return e&&lm(e)?jf.Mars:e&&cm(e)?jf.Moon:jf.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(jf||(jf={}));var Oce,_u;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(Oce||(Oce={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(_u||(_u={}));class ui extends Wa{constructor(){super(...arguments),this.output=K.Color,this.textureCoordinateType=an.None,this.componentData=_p.Uniform,this.cullFace=hr.Back,this.vertexDiscardMode=Uh.None,this.doubleSidedMode=jr.WindingOrder,this.alphaDiscardMode=cr.Opaque,this.integratedMeshMode=_u.None,this.transparencyPassType=gt.NONE,this.ellipsoidMode=jf.Earth,this.pbrMode=Ot.Disabled,this.normalType=Mr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}u([H({count:K.COUNT})],ui.prototype,"output",void 0),u([H({count:an.COUNT})],ui.prototype,"textureCoordinateType",void 0),u([H({count:_p.COUNT})],ui.prototype,"componentData",void 0),u([H({count:hr.COUNT})],ui.prototype,"cullFace",void 0),u([H({count:Uh.COUNT})],ui.prototype,"vertexDiscardMode",void 0),u([H({count:jr.COUNT})],ui.prototype,"doubleSidedMode",void 0),u([H({count:cr.COUNT})],ui.prototype,"alphaDiscardMode",void 0),u([H({count:_u.COUNT})],ui.prototype,"integratedMeshMode",void 0),u([H({count:gt.COUNT})],ui.prototype,"transparencyPassType",void 0),u([H({count:jf.COUNT})],ui.prototype,"ellipsoidMode",void 0),u([H({count:Ot.COUNT})],ui.prototype,"pbrMode",void 0),u([H({count:Mr.COUNT})],ui.prototype,"normalType",void 0),u([H()],ui.prototype,"spherical",void 0),u([H()],ui.prototype,"doublePrecisionRequiresObfuscation",void 0),u([H()],ui.prototype,"hasVertexColors",void 0),u([H()],ui.prototype,"hasNormals",void 0),u([H()],ui.prototype,"hasSlicePlane",void 0),u([H()],ui.prototype,"hasBaseColorTexture",void 0),u([H()],ui.prototype,"receiveAmbientOcclusion",void 0),u([H()],ui.prototype,"receiveShadows",void 0),u([H()],ui.prototype,"blendingEnabled",void 0),u([H()],ui.prototype,"hasScreenSpaceReflections",void 0),u([H()],ui.prototype,"hasPolygonOffset",void 0),u([H()],ui.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([H()],ui.prototype,"hasEmissionTexture",void 0),u([H()],ui.prototype,"hasOcclusionTexture",void 0),u([H()],ui.prototype,"hasNormalTexture",void 0),u([H()],ui.prototype,"hasOccludees",void 0),u([H()],ui.prototype,"hasMultipassTerrain",void 0),u([H()],ui.prototype,"cullAboveGround",void 0),u([H()],ui.prototype,"isGround",void 0),u([H()],ui.prototype,"hasCloudsReflections",void 0),u([H()],ui.prototype,"snowCover",void 0),u([H({constValue:ki.Draw})],ui.prototype,"pbrTextureBindType",void 0),u([H({constValue:!0})],ui.prototype,"hasSliceHighlight",void 0),u([H({constValue:!1})],ui.prototype,"hasSliceInVertexProgram",void 0),u([H({constValue:!1})],ui.prototype,"useCustomDTRExponentForWater",void 0),u([H({constValue:!1})],ui.prototype,"hasVertexTangents",void 0),u([H({constValue:!0})],ui.prototype,"supportsTextureAtlas",void 0),u([H({constValue:!1})],ui.prototype,"highStepCount",void 0),u([H({constValue:!1})],ui.prototype,"instancedDoublePrecision",void 0),u([H({constValue:!0})],ui.prototype,"useFillLights",void 0);function Pce(e,t){e.include(fx,t),e.fragment.include(i3);const i=e.fragment;i.uniforms.add(new h5("baseColor",r=>r.baseColor)),i.uniforms.add(new LSe("objectOpacity",r=>r.objectOpacity)),t.hasVertexColors?i.code.add(x`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(x`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(x`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Ice(e,t){const i=e.fragment;switch(t.doubleSidedMode){case jr.None:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case jr.View:e.include(p2,t),i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case jr.WindingOrder:i.code.add(x`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case jr.COUNT:}switch(t.normalType){case Mr.Attribute:case Mr.CompressedAttribute:e.include(kU,t),i.code.add(x`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Mr.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(p2,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Mr.Ground:t.spherical?(e.include(p2,t),i.code.add(x`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(x`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(x`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case Mr.COUNT:}}function Jyt(e,t){const i=e.fragment;if(t.hasBaseColorTexture){e.include(qY,t);const r=t.textureCoordinateType===an.Atlas;i.uniforms.add(xM("baseColorTexture",s=>s.texture,r)),r?(e.include(Hbe),i.code.add(x`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):i.code.add(x`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(x`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const XEe=new Map([[M.POSITION,0],[M.NORMAL,1],[M.NORMALCOMPRESSED,1],[M.COLOR,2],[M.UV0,3],[M.UVREGION,4],[M.COMPONENTINDEX,5]]);function Kyt(e){const t=new Zi;t.include(p2,e),t.include(kU,e),t.include(fx,e),t.include(Ug,e),t.include(pP,e),t.include(Xyt,e),t.include(knt,e),t.include(Qtt,e),t.include(Jyt,e),t.include(Qyt,e);const{vertex:i,fragment:r}=t;r.uniforms.add(new e_("view")),e.pbrMode!==Ot.Normal&&e.pbrMode!==Ot.Schematic||(t.include(YY,e),e.hasNormalTexture&&t.include(FSe,e)),e.output===K.Shadow&&e.componentData===_p.Varying?i.code.add(x`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(x`#define discardShadows(castShadows) {}`);const s=e.integratedMeshMode===_u.ColorOverlay||e.integratedMeshMode===_u.ColorOverlayWithWater,n=s&&e.output===K.Color&&e.pbrMode===Ot.WaterOnIntegratedMesh;return s&&(t.include(Gw,e),t.include(tgt,e),e.spherical?i.code.add(x`
      const float invEllipsoidRadius = ${x.float(1/(e.ellipsoidMode===jf.Earth?Pi.radius:e.ellipsoidMode===jf.Mars?Uf.radius:Yg.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(x`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),i.code.add(x`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${x.float(Vo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${n?e.spherical?x`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:x`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?x`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===K.Alpha&&(r.include(Uu),t.include(zu,e),t.include(Pce,e),s&&r.uniforms.add(new jt("ovColorTex",(o,a)=>Pq(o,a))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?x`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===K.Color&&(r.include(Uu),t.include(zu,e),t.include(Pce,e),t.include(Ice,e),t.include(Gw,e),e.receiveShadows?(t.include(UU,e),r.code.add(x`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(x`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new jt("ovColorTex",(o,a)=>Pq(o,a))),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?x`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?x`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===Ot.Normal||e.pbrMode===Ot.Schematic?(r.uniforms.add(new Tt("lightingMainIntensity",(o,a)=>a.lighting.mainLight.intensity)),r.code.add(x`
        ${e.pbrMode===Ot.Normal?x`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?r.code.add(x`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(x`vec3 shadingNormal = normalVertex;`),r.code.add(x`${e.spherical?x`vec3 normalGround = normalize(positionWorld());`:x`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(x`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?x`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?r.code.add(x`float shadow = evaluateShadow();`):e.spherical?(r.uniforms.add(new We("lightingGlobalFactor",(o,a)=>a.lighting.globalFactor)),r.code.add(x`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(x`float shadow = 0.0;`),n&&r.uniforms.add(new jt("ovNormalTex",(o,a)=>qJ(a))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(x`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(x`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?x` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?x`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(x`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===gt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==K.Depth&&e.output!==K.Shadow||(t.include(x_,e),r.code.add(x`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===K.Normal&&(t.include(Ice,e),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===Mr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===K.Highlight&&(t.include(wy),r.code.add(x`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?x`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function qJ(e){return e.overlays.length===0?null:e.overlays[kr.INNER].getValidTexture(Ts.Water)}const e0t=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:XEe,build:Kyt,getOverlayNormalTexture:qJ},Symbol.toStringTag,{value:"Module"}));class yz extends pr{bindDraw(t,i){const r=this.program;r.bindDraw(t,i),r.rebindTextures(),t.componentParameters.type===_p.Varying&&t.componentParameters.texture.bind(r,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,i){i.spherical=t.viewingMode===Ge.Global,i.doublePrecisionRequiresObfuscation=dP(t.rctx)}initializeProgram(t){const i=yz.shader.get(),r=i.build(this.configuration);return new sr(t.rctx,r,i.attributeLocations)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==_u.None,s=t===gt.NONE,n=t===gt.FrontFace;return Bt({blending:i.output!==K.Color&&i.output!==K.Alpha||!i.blendingEnabled?null:s?$u:xy(t),culling:tU(i.cullFace),depthTest:{func:w_(t)},depthWrite:s||n?Nl:null,colorWrite:ri,stencilWrite:r||i.hasOccludees?am:null,stencilTest:r?Nst(Ml.IntegratedMeshMaskExcluded):i.hasOccludees?T_:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:CU})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}yz.shader=new rr(e0t,()=>import("./ComponentShader.glsl.326a6def.js"));class t0t extends Ws{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class WJ{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function Xr(e={}){return(t,i)=>{var s;const r=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=r+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(o){const a=this[r];if(a==null)this[r]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(n){this[r]!==n&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function $ce(){return(e,t)=>{var r;const i=(r=e._parameterCount)!=null?r:0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(s){this[i]!==s&&(this[i]=s,this._setDirty())}})}}class vz{constructor(t){this._low=Ri(),this._high=Ri(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;ae(i,t),Cc(r,t,i)}setElements(t,i,r){se(Lce,t,i,r),this.set(Lce)}get(t){return de(t,this._low,this._high)}getLowScaled(t){return le(t,this._low,1)}}const Lce=O();class In extends t0t{constructor(t,i){super(),this.toMapSpace=i,this.baseColor=id(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=$i(1,1,.5),this.emissiveFactor=$i(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new DN,this.componentParameters=new zM,this.textureAlphaCutoff=V4,this.alphaDiscardMode=cr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=jf.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new ui;const r=new vz(t.position),s=W2e(t.rotationScale);dx(s,s),this.transformNormalGlobalFromModel=Jh(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=Ki(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return _(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return _(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return _(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return _(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return _(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetalnessAndRoughnessTexture=_(this.metallicRoughnessTexture),n.hasEmissionTexture=_(this.emissionTexture),n.hasOcclusionTexture=_(this.occlusionTexture),n.hasNormalTexture=_(this.normalTexture),n.transparencyPassType=i.identifier===Tu.Material&&r.transparencyPassType!=null?r.transparencyPassType:gt.NONE,n.hasMultipassTerrain=i.identifier===Tu.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===Tu.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?jr.View:jr.None,n.hasBaseColorTexture=_(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Ia.Transparent||o===Ia.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?s0t(r)?qJ(r)?_u.ColorOverlayWithWater:_u.ColorOverlay:_u.NoOverlay:_u.None,n.isGround=this.isIntegratedMesh,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&R(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===_u.ColorOverlayWithWater?Ot.WaterOnIntegratedMesh:this.usePBR?a?Ot.Schematic:Ot.Normal:Ot.Disabled,n.normalType=n.integratedMeshMode===_u.None?n.hasNormals?Mr.CompressedAttribute:Mr.ScreenDerivative:Mr.Ground,n.hasSlicePlane=_(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Tu.ShadowMap?(n.output=K.Shadow,n.vertexDiscardMode=Uh.None):i.identifier===Tu.Highlight?(n.output=K.Highlight,n.vertexDiscardMode=Uh.None):(this._computeWhichMaterialPass()===Ia.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?Uh.Opaque:Uh.Transparent:n.vertexDiscardMode=Uh.None,n.output=i0t(i.subPass),i.subPass===co.Alpha&&(n.hasOccludees=r.hasOccludees),i.subPass===co.Color?(n.receiveAmbientOcclusion=r.ssaoHelper.ready,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=_(r.clouds.data)):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1),n.snowCover=this.hasSnowCover(r)),this._technique=t.releaseAndAcquire(yz,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return _(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ia.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case Ia.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case Ia.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case Ia.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),r0t(i)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==wn.None;h&&t.shadowMap.submitDraw(this,s,a,o),_(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&_(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}get attributeLocations(){return XEe}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ia.IntegratedMesh:this.objectOpacity<1?Ia.Transparent:this.componentParameters.opaqueOverride===wn.All?Ia.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===cr.Blend||this.alphaDiscardMode===cr.MaskBlend?Ia.Transparent:this.componentParameters.transparent===wn.None?Ia.Opaque:this.componentParameters.transparent===wn.All?Ia.Transparent:Ia.OpaqueAndTransparent}}var Dce,Ia,wn;u([Xr({vectorOps:Tpe})],In.prototype,"baseColor",void 0),u([Xr()],In.prototype,"usePBR",void 0),u([Xr()],In.prototype,"hasParametersFromSource",void 0),u([Xr({vectorOps:tee})],In.prototype,"mrrFactors",void 0),u([Xr({vectorOps:tee})],In.prototype,"emissiveFactor",void 0),u([Xr({dispose:!0})],In.prototype,"baseColorTexture",void 0),u([Xr({dispose:!0})],In.prototype,"metallicRoughnessTexture",void 0),u([Xr({dispose:!0})],In.prototype,"emissionTexture",void 0),u([Xr({dispose:!0})],In.prototype,"occlusionTexture",void 0),u([Xr({dispose:!0})],In.prototype,"normalTexture",void 0),u([Xr()],In.prototype,"objectOpacity",void 0),u([$ce()],In.prototype,"commonMaterialParameters",void 0),u([$ce()],In.prototype,"componentParameters",void 0),u([Xr()],In.prototype,"textureAlphaCutoff",void 0),u([Xr()],In.prototype,"alphaDiscardMode",void 0),u([Xr()],In.prototype,"isIntegratedMesh",void 0),u([Xr()],In.prototype,"polygonOffsetEnabled",void 0),u([Xr()],In.prototype,"ellipsoidMode",void 0),u([Xr()],In.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(Dce||(Dce={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Ia||(Ia={}));class DN extends WJ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=hr.Back,this.hasSlicePlane=!0}}u([Xr()],DN.prototype,"doubleSided",void 0),u([Xr()],DN.prototype,"cullFace",void 0),u([Xr()],DN.prototype,"hasSlicePlane",void 0);class zM extends WJ{constructor(){super(...arguments),this.externalColor=id(1,1,1,1),this.externalColorMixMode=Es.Multiply,this.castShadows=wn.All}get transparent(){return this.externalColor[3]<1?wn.All:wn.None}get opaqueOverride(){return this.externalColorMixMode===Es.Replace&&this.externalColor[3]===1?wn.All:wn.None}get visible(){return this.externalColor[3]>0?wn.All:wn.None}get type(){return _p.Uniform}}u([Xr({vectorOps:Tpe})],zM.prototype,"externalColor",void 0),u([Xr()],zM.prototype,"externalColorMixMode",void 0),u([Xr()],zM.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(wn||(wn={}));class GR extends WJ{constructor(){super(...arguments),this.texture=null,this.transparent=wn.None,this.opaqueOverride=wn.None,this.castShadows=wn.None}get type(){return _p.Varying}}function i0t(e){switch(e){case co.Color:return K.Color;case co.Alpha:return K.Alpha;case co.Depth:return K.Depth;case co.Normal:return K.Normal}}function r0t(e){return e.overlays.length!==0&&_(e.overlays[kr.INNER].getValidTexture(Ts.Highlight))}function s0t(e){return e.overlays.length!==0&&_(e.overlays[kr.INNER].getColorTextureNoRasterImage())}u([Xr()],GR.prototype,"texture",void 0),u([Xr()],GR.prototype,"transparent",void 0),u([Xr()],GR.prototype,"opaqueOverride",void 0),u([Xr()],GR.prototype,"castShadows",void 0);const p3=ls().vec3f(M.POSITION).u16(M.COMPONENTINDEX).u16(M.U16PADDING),ZEe=ls().vec2u8(M.SIDENESS),Nce=Dc(ZEe),YEe=ls().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX).u8(M.VARIANTOFFSET,{glNormalized:!0}).u8(M.VARIANTSTROKE).u8(M.VARIANTEXTENSION,{glNormalized:!0}).u8(M.U8PADDING,{glPadding:!0}).u16(M.U16PADDING,{glPadding:!0}),zq=YEe.clone().vec3f(M.NORMAL),Vq=YEe.clone().vec3f(M.NORMALA).vec3f(M.NORMALB),Bq=new Map([[M.POSITION0,0],[M.POSITION1,1],[M.COMPONENTINDEX,2],[M.VARIANTOFFSET,3],[M.VARIANTSTROKE,4],[M.VARIANTEXTENSION,5],[M.NORMAL,6],[M.NORMALA,6],[M.NORMALB,7],[M.SIDENESS,8]]);function Fce(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(b,S)=>{b<S?s[b+1]++:n[S+1]++};for(let b=0;b<r;b++){const S=e[3*b],T=e[3*b+1],E=e[3*b+2];o(S,T),o(T,E),o(E,S)}let a=0,l=0;for(let b=0;b<i;b++){const S=s[b+1],T=n[b+1];s[b+1]=a,n[b+1]=l,a+=S,l+=T}const c=new Uint32Array(6*r),h=s[i],p=(b,S,T)=>{if(b<S){const E=s[b+1]++;c[2*E]=S,c[2*E+1]=T}else{const E=n[S+1]++;c[2*h+2*E]=b,c[2*h+2*E+1]=T}};for(let b=0;b<r;b++){const S=e[3*b],T=e[3*b+1],E=e[3*b+2];p(S,T,b),p(T,E,b),p(E,S,b)}const f=(b,S)=>{const T=2*b,E=S-b;for(let C=1;C<E;C++){const A=c[T+2*C],I=c[T+2*C+1];let D=C-1;for(;D>=0&&c[T+2*D]>A;D--)c[T+2*D+2]=c[T+2*D],c[T+2*D+3]=c[T+2*D+1];c[T+2*D+2]=A,c[T+2*D+3]=I}};for(let b=0;b<i;b++)f(s[b],s[b+1]),f(h+n[b],h+n[b+1]);const m=new Int32Array(3*r),y=(b,S)=>b===e[3*S]?0:b===e[3*S+1]?1:b===e[3*S+2]?2:-1,v=(b,S)=>{const T=y(b,S);m[3*S+T]=-1},w=(b,S,T,E)=>{const C=y(b,S);m[3*S+C]=E;const A=y(T,E);m[3*E+A]=S};for(let b=0;b<i;b++){let S=s[b];const T=s[b+1];let E=n[b];const C=n[b+1];for(;S<T&&E<C;){const A=c[2*S],I=c[2*h+2*E];A===I?(w(b,c[2*S+1],I,c[2*h+2*E+1]),S++,E++):A<I?(v(b,c[2*S+1]),S++):(v(I,c[2*h+2*E+1]),E++)}for(;S<T;)v(b,c[2*S+1]),S++;for(;E<C;)v(c[2*h+2*E],c[2*h+2*E+1]),E++}return m}function d5(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:n0t(e.layout)}}function EL(e){return o0t(e.layout).createView(e.buffer)}function n0t(e){const t=new Array;return e.fields.forEach((i,r)=>{const s=ye(F({},i),{constructor:QEe(i.constructor)});t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function o0t(e){const t=ls();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],ye(F({},i[1]),{constructor:l0t(i[1].constructor)}))),t}const a0t=[J3,Kh,Xi,qn,Rp,mE,gE,yE,As,Pw,t_,i_,ay,Iw,r_,Fl,$w,vE,Lw,s_,Dw,_E,IO,$O,bE,Nw,LO,DO,NO,Fw,FO,kO,UO,zO,VO,BO];function QEe(e){return`${e.ElementType}_${e.ElementCount}`}function l0t(e){return JEe.get(e)}const JEe=new Map;a0t.forEach(e=>JEe.set(QEe(e),e));class KEe{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?u0t:c0t}write(t,i,r){const s=this.edgeHashFunction(r);AL.seed=s;const n=AL.getIntRange(0,255),o=AL.getIntRange(0,this.settings.variants-1),a=.7,l=AL.getFloat(),c=255*(.5*h0t(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,o),t.variantExtension.set(i,c)}trim(t,i){return t.slice(0,i)}}const XJ=new Float32Array(6),p5=new Uint32Array(XJ.buffer),Pv=new Uint32Array(1);function c0t(e){const t=XJ;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],Pv[0]=5381;for(let i=0;i<p5.length;i++)Pv[0]=31*Pv[0]+p5[i];return Pv[0]}function u0t(e){const t=XJ;t[0]=fT(e.position0[0]),t[1]=fT(e.position0[1]),t[2]=fT(e.position0[2]),t[3]=fT(e.position1[0]),t[4]=fT(e.position1[1]),t[5]=fT(e.position1[2]),Pv[0]=5381;for(let i=0;i<p5.length;i++)Pv[0]=31*Pv[0]+p5[i];return Pv[0]}const kce=1e4;function fT(e){return Math.round(e*kce)/kce}function h0t(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class f5{constructor(){this.commonWriter=new KEe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return zq.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),de(CL,r.faceNormal0,r.faceNormal1),we(CL,CL),t.normal.setVec(i,CL)}trim(t,i){return this.commonWriter.trim(t,i)}}f5.Layout=zq,f5.glLayout=Dc(zq,1);class m5{constructor(){this.commonWriter=new KEe}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return Vq.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this.commonWriter.trim(t,i)}}m5.Layout=Vq,m5.glLayout=Dc(Vq,1);const CL=O(),AL=new Rh,sb=-1;var g5;function Gq(e,t,i,r=y0t){const s=e.vertices.position,n=e.vertices.componentIndex,o=Dt(r.anglePlanar),a=Dt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=jq.edge,p=h.position0,f=h.position1,m=h.faceNormal0,y=h.faceNormal1,v=g0t(e),w=m0t(e),b=w.length/4,S=t.allocate(b);let T=0;const E=b,C=i.allocate(E);let A=0,I=0,D=0;const L=dRe(0,b),z=new Float32Array(b);mRe(z,(ce,oe,$)=>{s.getVec(w[4*oe+0],p),s.getVec(w[4*oe+1],f),$[oe]=ur(p,f)}),L.sort((ce,oe)=>z[oe]-z[ce]);const B=new Array,V=new Array;for(let ce=0;ce<b;ce++){const oe=L[ce],$=z[oe],U=w[4*oe+0],G=w[4*oe+1],W=w[4*oe+2],X=w[4*oe+3],ee=X===sb;if(s.getVec(U,p),s.getVec(G,f),ee)se(m,v[3*W+0],v[3*W+1],v[3*W+2]),ae(y,m),h.componentIndex=n.get(U),h.cosAngle=xe(m,y);else{if(se(m,v[3*W+0],v[3*W+1],v[3*W+2]),se(y,v[3*X+0],v[3*X+1],v[3*X+2]),h.componentIndex=n.get(U),h.cosAngle=xe(m,y),p0t(h,c))continue;h.cosAngle<-.9999&&ae(y,m)}I+=$,D++,ee||d0t(h,l)?(t.write(S,T++,h),B.push($)):f0t(h,o)&&(i.write(C,A++,h),V.push($))}const Q=new Float32Array(B.reverse()),Z=new Float32Array(V.reverse());return{regular:{instancesData:t.trim(S,T),lodInfo:{lengths:Q}},silhouette:{instancesData:i.trim(C,A),lodInfo:{lengths:Z}},averageEdgeLength:I/D}}function d0t(e,t){return e.cosAngle<t}function p0t(e,t){return e.cosAngle>t}function f0t(e,t){const i=fn(e.cosAngle),r=jq.fwd,s=jq.ortho;return uy(r,e.position1,e.position0),i*(xe(ct(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function m0t(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];s+=l===sb||p<f?1:0,s+=c===sb||f<m?1:0,s+=h===sb||m<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],f=i[3*a+1],m=i[3*a+2];(l===sb||p<f)&&(n[o++]=p,n[o++]=f,n[o++]=a,n[o++]=l),(c===sb||f<m)&&(n[o++]=f,n[o++]=m,n[o++]=a,n[o++]=c),(h===sb||m<p)&&(n[o++]=m,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function g0t(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=T8.v0,n=T8.v1,o=T8.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),pe(n,n,s),pe(o,o,s),ct(s,n,o),we(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(g5||(g5={}));const jq={edge:{position0:O(),position1:O(),faceNormal0:O(),faceNormal1:O(),componentIndex:0,cosAngle:0},ortho:O(),fwd:O()},T8={v0:O(),v1:O(),v2:O()},y0t={anglePlanar:4,angleSignificantEdge:35};class eCe{async extract(t){const i=S8(t),r=ZJ(i),s=[i.data.buffer];return{result:v0t(r,s),transferList:s}}async extractComponentsEdgeLocations(t){const i=S8(t),r=Hq(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=Gq(r,x0t,Vce),n=[];return{result:d5(s.regular.instancesData,n),transferList:n}}async extractEdgeLocations(t){const i=S8(t),r=Hq(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=Gq(r,w0t,Vce),n=[];return{result:d5(s.regular.instancesData,n),transferList:n}}}function ZJ(e){const t=Hq(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return Uce.updateSettings(e.writerSettings),zce.updateSettings(e.writerSettings),Gq(t,Uce,zce)}function S8(e){return{data:p3.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function v0t(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:d5(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:d5(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function Hq(e,t,i,r){if(t)return{faces:i,facesLength:r,neighbors:Fce(i,r,e.count),vertices:e};const s=jTe(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Fce(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:p3.createView(s.buffer)}}const Uce=new f5,zce=new m5;class _0t{allocate(t){return tCe.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1)}}class b0t{allocate(t){return YJ.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex)}}const w0t=new _0t,x0t=new b0t,Vce={allocate:()=>null,write:()=>{},trim:()=>null},tCe=ls().vec3f(M.POSITION0).vec3f(M.POSITION1),YJ=ls().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX).u16(M.U16PADDING,{glPadding:!0});function T0t(){return new eCe}var S0t=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",EdgeProcessingWorker:eCe,default:T0t,extract:ZJ,extractComponentsEdgeLocationsLayout:YJ,extractEdgeLocationsLayout:tCe});class E0t{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class C0t{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.textureWidth=4096,this.dirty=!0,this.texture=new nt(this.rctx,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new Fl(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,i,r,s,n,o){const a=t*this.fieldCount+i;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,s),this.data.set(a,2,n),this.data.set(a,3,o)}setDataElement(t,i,r,s){const n=t*this.fieldCount+i;this.dirty=!0,this.data.set(n,r,s)}resizeToFit(t){const i=t*this.fieldCount;if(i>=this.data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new Fl(new ArrayBuffer(4*r));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,i=this.texture.descriptor.height;this.data.count>t*i&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,i,r){t.bindTexture(i,this.texture),t.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const iCe=65536;class A0t{constructor(t,i=1){this.textureBuffer=new C0t(t,i),this.indexManager=new E0t(iCe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class rCe{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const r of this.buffers)if(r.availableCount>=t)return r;if(t>iCe)return null;const i=new A0t(this.rctx,this.fieldCount);return this.buffers.push(i),i}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const Bce=fe.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class R0t{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._objects=[new Wt,new Wt],this._renderSubmit=new Hyt(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new rCe(t.rctx,2)}dispose(){pt(this._objects[w2.Hidden].length===0&&this._objects[w2.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new kq;return i.toMapSpace=t.toMapSpace,i.transform=t.transform,i.obb=wce(t.obb),i.components=new Ayt(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new Lyt(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.dispose(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Sn(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:EJ(),externalColorMixMode:Es.Multiply,elevationOffset:0},c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let f=0,m=0,y=0,v=n.verticalOffsets,w=1/0,b=-1/0,S=!1,T=!1,E=0;for(let C=0;C<n.count;C++)i(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Es.Replace&&l.externalColor[3]===1),y+=+l.castShadows,PSe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[C],0,h[0],h[1],h[2],h[3]),S||(S=C>0&&E!==p[0]),E=p[0],T||(T=l.elevationOffset!==0),T&&R(v)&&(v=new Array(C).fill(0)),_(v)&&(v[C]=l.elevationOffset),w=Math.min(w,l.elevationOffset),b=Math.max(b,l.elevationOffset),WEe(l.elevationOffset,h),c.setData(a[C],1,h[0],h[1],h[2],h[3]),l.pickable!==GEe(n.pickability,C)&&(n.pickability=Myt(n.pickability,n.count,C,l.pickable));n.verticalOffsets=T?v:null,r.offsetObb=T?vyt(r.obb,w,b,this._viewingMode,_(r.offsetObb)?r.offsetObb:wce(r.obb)):null,S||T?(s.componentParameters=new GR,s.componentParameters.castShadows=E8(y,n.count),s.componentParameters.transparent=E8(f,n.count),s.componentParameters.opaqueOverride=E8(m,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new zM,s.componentParameters.castShadows=l.castShadows?wn.All:wn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,i,r,s=!1){t.intersectionGeometry.getComponentAabb(i,r);const n=t,o=n.components.verticalOffsets;if(s||R(o))return r;const a=o[i];if(this._viewingMode===Ge.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=$Qe(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,o){const a=t;_(n)&&(n.localOrigin=a.transform.position);const l=dx(Gce,a.transform.rotationScale);Cc(RL,i,a.transform.position),Cc(ML,r,a.transform.position),mc(RL,RL,l),mc(ML,ML,l);const c=Jh(Gce,l);return a.intersectionGeometry.intersect(RL,ML,s,c,n,a.components.verticalOffsets,o)}addEdges(t,i,r,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:Jgt(n.obb)},a,o,l,r,s)}async extractEdgeInformation(t,i,r){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:YJ.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=p3.createBuffer(a.count);KU(c.position,a),h_(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:Vs(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(t,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,i,r,s){if(t&&i.allVisible())return t;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let f=h;f<p;f++)o[a++]=t?t[f]:f;return!0}),o}addComponentHighlight(t,i){const r=t.components;R(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(R(r.highlightCounts))return void Bce.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else Bce.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;_(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[w2.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=oi.createVertex(r,Ei.STATIC_DRAW,s.vertices.data),a=rn(s.indices,v=>oi.createIndex(r,Ei.STATIC_DRAW,v)),l=Dc(qyt(n)),c=new Uint16Array(s.vertices.count);for(let v=0;v<i.count;v++){const w=i.offsets[v],b=i.offsets[v+1],S=i.materialDataIndices[v];if(_(s.indices))for(let T=w;T<b;T++)c[s.indices[T]]=S;else for(let T=w;T<b;T++)c[T]=S}const h=oi.createVertex(r,Ei.STATIC_DRAW,c.buffer),p=new In(t.transform,t.toMapSpace),f=new Hs(r,p.attributeLocations,{data:l,componentIndices:M0t},{data:o,componentIndices:h},a),m=new HEe(f,$t.TRIANGLES,n,_(a)),y={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(_(a)?a.byteSize:0)};return new Fyt(p,m,y)}_notifyDirty(){this._renderManager.notifyDirty()}}const M0t=Dc(ls().u16(M.COMPONENTINDEX));function E8(e,t){return e===t?wn.All:e===0?wn.None:wn.Some}const Gce=jg(),RL=O(),ML=O();class sCe extends Ws{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function O0t(e){const t=new Zi;t.include(b_);const i=t.fragment;switch(e.function){case fc.Standard:i.uniforms.add(new jt("tex",r=>r.texture)),e.hasOpacityFactor?(i.uniforms.add(new We("opacity",r=>r.opacity)),i.code.add(x`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):i.code.add(x`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case fc.OverlayWithTransparency:i.uniforms.add(new jt("tex",r=>r.texture)),i.uniforms.add(new fP("overlayIdx",r=>r.overlayIndex)),e.hasOpacityFactor&&i.uniforms.add(new We("opacity",r=>r.opacity)),i.code.add(x`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case fc.TransparentToHUDVisibility:i.uniforms.add(new jt("tex",r=>r.texture)),i.code.add(x`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case fc.Transparency:i.uniforms.add([new jt("colorTexture",r=>r.colorTexture),new jt("alphaTexture",r=>r.alphaTexture),new jt("frontFaceTexture",r=>r.frontFaceTexture)]),i.code.add(x`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case fc.COUNT:break;default:e.function}return t}const P0t=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:sCe,build:O0t},Symbol.toStringTag,{value:"Module"}));class f3 extends pr{initializeProgram(t){const i=f3.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){if(this.configuration.function===fc.TransparentToHUDVisibility)return Bt({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case No.None:return Bt({colorWrite:ri});case No.Alpha:return Bt({blending:bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:ri});default:return Bt({blending:ym(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),colorWrite:ri})}}}f3.shader=new rr(P0t,()=>import("./Compositing.glsl.da8fdbcb.js"));class I0t{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._configuration=new mN,this._passParameters=new sCe}dispose(){this._vao=Ze(this._vao)}compositeTransparent(t,i,r,s,n=1){this._configuration.alphaMode=No.Alpha,this._configuration.function=fc.Transparency,this._configuration.hasOpacityFactor=n!==1,this._passParameters.colorTexture=i,this._passParameters.alphaTexture=r,this._passParameters.frontFaceTexture=s;const o=this._rctx,a=this._techniqueRepository.acquire(f3,this._configuration);o.bindTechnique(a,this._passParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays($t.TRIANGLE_STRIP,0,ko(l,"geometry")),a.release()}composite(t,i,r=No.None,s=1,n=fc.Standard,o=kr.INNER){const a=this._rctx;this._configuration.alphaMode=r,this._configuration.function=n,this._configuration.hasOpacityFactor=s!==1,this._passParameters.overlayIndex=o,this._passParameters.texture=i,this._passParameters.opacity=s;const l=this._techniqueRepository.acquire(f3,this._configuration);a.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();a.bindVAO(c),a.drawArrays($t.TRIANGLE_STRIP,0,ko(c,"geometry")),l.release()}_ensureVAO(){return R(this._vao)&&(this._vao=Xa(this._rctx)),this._vao}}const $0t=1e4,qq=100,L0t=500,D0t=500,N0t=.1;function F0t(e,t,i){return VQ(t,e)*(i[1]-i[0])+i[0]}function k0t(e,t,i){if(t.size<$0t)return q0t.compute(e,t);const r=_P();return i.forAll(s=>{s.isVisible&&FE(r,U0t(e,s))}),r}function U0t(e,t){if(!t.isVisible)return;const i=_P(),r=t.getSpatialQueryAccelerator();return _(r)?z0t(i,e,r):V0t(i,e,t.objects),i}function z0t(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=i.objectCount;if(a<L0t)d3(Eh,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,dp.DepthOrder.FRONT_TO_BACK,Eh,(l,c)=>{Wq(e,t,l),Eh.far=e.near,c.setRange(Eh)},n,o),d3(Eh,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,dp.DepthOrder.BACK_TO_FRONT,Eh,(l,c)=>{Wq(e,t,l),Eh.near=e.far,c.setRange(Eh)},n,o);else{const l=Math.max(Math.min(a,D0t),Math.ceil(a*N0t)),c=i.findClosest(s,dp.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,dp.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(jce(e,t,c.boundingVolumeWorldSpace.bounds),jce(e,t,h.boundingVolumeWorldSpace.bounds))}}function V0t(e,t,i){mT.clear(),i.forAll(r=>{r.isVisible&&r.geometryRecords.length!==0&&mT.add(r)}),mT.empty||(mT.sort(t),d3(Eh,t.near,Math.min(e.near,t.far)),mT.forEachInDepthRange(Eh,dp.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&Wq(e,t,r)}),d3(Eh,Math.max(e.far,t.near),t.far),mT.forEachInDepthRange(Eh,dp.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function Wq(e,t,i){if(!i.isVisible||!Cv(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=H0t;i.geometryRecords.forEach(n=>{Hr(s,r,n.getShaderTransformation());const o=xw(s);nCe(e,t,n.geometry.boundingInfo,s,o)})}function nCe(e,t,i,r,s){if(R(i))return;const n=t.eye,o=t.viewForward;ze(Lo,i.center,r);const a=o[0]*(Lo[0]-n[0])+o[1]*(Lo[1]-n[1])+o[2]*(Lo[2]-n[2]);if(Lo[3]=i.radius*s,!(a-Lo[3]>e.near&&a+Lo[3]<e.far)&&Cv(t.frustum,Lo))if(i.radius>qq&&i.getChildren()){const l=i.getChildren();for(let c=0;c<8;++c)l[c]&&nCe(e,t,l[c],r,s)}else Xq.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function jce(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class B0t{constructor(){this._items=new Wt({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===dp.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class G0t{constructor(){this.view=Ae(),this.viewProj=Ae(),this.frustum=HO(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,i){this._reset(),Ss(this.view,t.viewMatrix),Hr(this.viewProj,t.projectionMatrix,this.view),E4(this.frustum,t.frustum);const r=this.view,s=r[2],n=r[6],o=r[10],a=r[14],l=this.range;let c=0;if(i.forEach(m=>{if(!m.instanceParameters.visible||!m.castShadow)return;let y;m.hasShaderTransformation?(m.computeBoundingSphere(m.getShaderTransformation(),Lo,1),y=Lo):y=m.boundingSphere;const v=s*y[0]+n*y[1]+o*y[2]+a,w=v-y[3],b=v+y[3];this.geometries[c]=m,this.near[c]=-b,this.far[c]=-w,++c}),this.geometries.length===0)return l;for(let m=0;m<this.geometries.length;++m)this.near[m]>l.far&&(l.far=this.near[m]),this.near[m]>2&&this.far[m]<l.near&&(l.near=this.far[m]);const h=this.looseRange;h.near=Math.max(.5*l.near,2),h.far=2*l.far;let p=0,f=0;for(let m=0;m<this.geometries.length;++m)this.near[m]<l.near&&(this.near[m]>=h.near?l.near=this.near[m]:this.nearCandidates[p++]=m),this.far[m]>l.far&&(this.far[m]<=h.far?l.far=this.far[m]:this.farCandidates[f++]=m);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((m,y)=>this.near[m]<this.near[y]?-1:this.near[m]>this.near[y]?1:0),this.farCandidates.sort((m,y)=>this.far[m]<this.far[y]?1:this.far[m]>this.far[y]?-1:0);for(let m=0;m<this.nearCandidates.length;++m){const y=this.nearCandidates[m];if(this.near[y]<l.near){const v=this.geometries[y],w=v.boundingInfo;this._includeNearBoundingInfoRec(w,v.getShaderTransformation())}}for(let m=0;m<this.farCandidates.length;++m){const y=this.farCandidates[m];if(this.far[y]>l.far){const v=this.geometries[y],w=v.boundingInfo;this._includeFarBoundingInfoRec(w,v.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,i){if(R(t))return;const r=t.getCenter();ze(Lo,r,i);const s=xw(i),n=Lo[0],o=Lo[1],a=Lo[2],l=t.getBSRadius()*s,c=this.frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const h=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14],p=h+l;if(!(-(h-l)<2||-p>=this.range.near))if(-p>this.looseRange.near)this.range.near=-p;else{if(l>qq){const f=t.getChildren();if(f!==void 0){for(let m=0;m<8;++m)f[m]!==void 0&&this._includeNearBoundingInfoRec(f[m],i);return}}Xq.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,i){if(R(t))return;let r=t.getBSRadius();const s=t.getCenter();ze(Lo,s,i);const n=xw(i),o=Lo[0],a=Lo[1],l=Lo[2];r*=n;const c=this.frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>r)return;const h=this.view[2]*o+this.view[6]*a+this.view[10]*l+this.view[14]-r;if(!(-h<=this.range.far))if(-h<this.looseRange.far)this.range.far=-h;else{if(r>qq){const p=t.getChildren();if(p!==void 0){for(let f=0;f<8;++f)p[f]!==void 0&&this._includeFarBoundingInfoRec(p[f],i);return}}Xq.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}}class j0t{constructor(){this.modelViewProj=Ae(),this.clipPosition=[Xt(),Xt(),Xt(),Xt(),Xt(),Xt(),Xt(),Xt()]}unionDepthRangeWithAABB(t,i,r,s,n){const o=this.modelViewProj;Hr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],f=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*f+o[12],c[1]=o[1]*h+o[5]*p+o[9]*f+o[13],c[2]=o[2]*h+o[6]*p+o[10]*f+o[14],c[3]=o[3]*h+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this.clipPosition[C8[l][0]],h=this.clipPosition[C8[l][1]],p=this.clipPosition[C8[l][2]],f=this._clipTriangle(c,h,p);let m=!0;for(let y=0;y<f.length;++y)if(f[y][3]>=2){m=!1;break}if(!m){a=!0;for(let y=0;y<f.length;++y){const v=f[y][3];v<t.near&&(t.near=v),v>t.far&&(t.far=v)}}}return a}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void pt(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),k5(Xt(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const C8=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Lo=En(),H0t=Ae(),Eh=_P(),mT=new B0t,q0t=new G0t,Xq=new j0t;class W0t extends Ws{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function X0t(){const e=new Zi;return e.attributes.add(M.POSITION,"vec2"),e.vertex.uniforms.add(new Va("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(x`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new zr("textureInput")),e.fragment.uniforms.add(new zr("textureMask")),e.fragment.uniforms.add(new zr("textureOverlay")),e.fragment.uniforms.add(new Ow("maskEnabled",t=>t.maskEnabled)),e.fragment.uniforms.add(new Ow("overlayEnabled",t=>t.overlayEnabled)),e.fragment.code.add(x`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function Z0t(e){const t=import("./mask-svg.d736db49.js"),i=import("./overlay-svg.ddc1dd43.js"),r=Ap((await t).default,{signal:e}),s=Ap((await i).default,{signal:e}),n={mask:await r,overlay:await s};return fi(e),n}let cS=class extends Se{constructor(){super(...arguments),this._handles=new Nt,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new W0t,this.events=new as,this.attributeLocations=new Map([[M.POSITION,0]]),this.tmpScreenPoint=Yr(),this.tmpRenderPoint=fPe()}get updating(){return R(this._imageSources)&&_(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};_(this._magnifier)&&this._handles.add(ie(()=>rn(this._magnifier,i=>i.version),t)),t()}get enabled(){return _(this._validMagnifier)}get _validMagnifier(){return _(this._magnifier)&&this._magnifier.visible&&_(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return _(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),_(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(R(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),R(this._resources))return;this._passParameters.maskEnabled=i.maskEnabled,this._passParameters.overlayEnabled=i.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;Tg(i.position,this.tmpScreenPoint);const h=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),p=.5*a,f=.5*a;h[0]=De(h[0],p,l-p-1),h[1]=De(h[1],f,c-f-1);const m=Math.floor(h[0]-p),y=Math.floor(h[1]-f);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,y,a,a,0);const v=i.offset.x*r,w=i.offset.y*r,b=(h[0]+v)/l*2-1,S=(h[1]-w)/c*2-1,T=s/l*2,E=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",b,S,T,E),e.setPipelineState(this._resources.pipelineState),e.drawArrays($t.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(R(e))return;const t=e.maskUrl,i=e.overlayUrl;!_(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),_(this._imageSources)||_(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:A3(async r=>{const s=R(t)||R(i)?Z0t(r):null,n=_(t)?Ap(t,{signal:r}):s.then(a=>a.mask),o=_(i)?Ap(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(_(this._resources)){if(this._resources.textures.size!==t){const r=this._createTextureResources(e,t);if(R(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const i=this._createTextureResources(e,t);R(i)||(this._resources={textures:i,program:this._createProgram(e),vao:Xa(e,zY,this.attributeLocations,0,1),pipelineState:Bt({blending:ym(Re.ONE,Re.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ri})})}_disposeResources(){R(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(R(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new nt(e,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,internalFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR,flipped:!0,preMultiplyAlpha:!mX(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new nt(e,{target:ft.TEXTURE_2D,pixelFormat:Ve.ALPHA,internalFormat:Ve.ALPHA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR,flipped:!0},this._imageSources.mask);return{input:new nt(e,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,internalFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new sr(e,X0t(),this.attributeLocations)}};u([d()],cS.prototype,"_imageSources",void 0),u([d()],cS.prototype,"_imageLoadTask",void 0),u([d({readOnly:!0})],cS.prototype,"updating",null),cS=u([P("esri/views/3d/webgl-engine/lib/MagnifierHelper")],cS);const Y0t=.5,Q0t=1e3/30;var m3;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(m3||(m3={}));class n0{constructor(t,i,r=m3.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new Wt({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=t,n.depthSquaredHint=s,n.indexType=i.indexed?i.vao.indexBuffer.indexType:0}dispatch(t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===gt.NONE||(r.bindTechnique(l,t,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,i),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const m=NN.get(c.indexType);for(let y=0;y<f;y+=2){const v=p[y],w=p[y+1];r.drawElements(h.primitiveType,w,c.indexType,v*m)}}else for(let m=0;m<f;m+=2){const y=p[m],v=p[m+1];r.drawArrays(h.primitiveType,y,v)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===m3.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const NN=new Map;NN.set(dt.UNSIGNED_BYTE,1),NN.set(dt.UNSIGNED_SHORT,2),NN.set(dt.UNSIGNED_INT,4);class J0t{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new Qmt,this._shadowPassParameters=new Jmt,this._highlightPassParameters=new Kmt,this._systems=new Set,this._passes={materialOpaque:new n0(t,i),materialTransparent:new n0(t,i,m3.BackToFront),materialIntegratedMesh:new n0(t,i),shadowMap:new n0(t,i),highlight:new n0(t,i),highlightIntegratedMesh:new n0(t,i),highlightShadowMap:new n0(t,i),defaultShadowMap:new n0(t,i)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,t.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case Ee.OPAQUE_MATERIAL:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=co.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=co.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=co.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case Ee.TRANSPARENT_MATERIAL:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=co.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_ALPHA:return this._materialPassParameters.subPass=co.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=co.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=co.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Ee.INTEGRATED_MESH:switch(t.pass){case je.MATERIAL:return this._materialPassParameters.subPass=co.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_DEPTH:return this._materialPassParameters.subPass=co.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_NORMAL:return this._materialPassParameters.subPass=co.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case je.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ee.OPAQUE_MATERIAL,Ee.TRANSPARENT_MATERIAL,Ee.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);_(s)&&FE(i,s,i)}),i}_configure(t){const i=t.pass===je.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===je.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.bindParameters.camera,s=r.viewInverseTransposeMatrix;se(A8,s[3],s[7],s[11]),R8.set(A8),ae(i.transformWorldFromViewTH,R8.high),ae(i.transformWorldFromViewTL,R8.low),ae(i.slicePlaneLocalOrigin,A8),Qh(i.transformViewFromCameraRelativeRS,r.viewMatrix),Ss(i.transformProjFromView,r.projectionMatrix),i.identifier===Tu.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Ee.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Ee.INTEGRATED_MESH,Jh(Hce,i.transformViewFromCameraRelativeRS),dx(i.transformNormalViewFromGlobal,Hce))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const A8=O(),Hce=Or(),R8=new vz,K0t=8.6,evt=.4;function tvt(){const e=new Zi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(M.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(M.UV0,"vec2"),t.uniforms.add(new jt("coverageTex",n=>n.coverageTexture)),r.add(x`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new jt("tex",n=>n.blurColorTexture)),i.uniforms.add(new jt("origin",n=>n.highlightColorTexture)),i.uniforms.add(new ni("uColor",n=>n.color)),i.uniforms.add(new ni("haloColor",n=>n.haloColor)),i.uniforms.add(new ni("opacities",n=>Ji(ivt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",K0t),i.constants.add("blurSize","float",evt),s.add(x`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const ivt=Xt(),rvt=Object.freeze(Object.defineProperty({__proto__:null,build:tvt},Symbol.toStringTag,{value:"Module"}));class _z extends pr{initializeProgram(t){const i=_z.shader.get().build();return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:ri})}}_z.shader=new rr(rvt,()=>import("./HighlightApply.glsl.e6d5d233.js"));class oCe extends Ws{constructor(){super(...arguments),this.blurSize=it()}}function svt(){const e=new Zi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(M.POSITION,"vec2"),e.attributes.add(M.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new jt("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new WY("blurSize",n=>n.blurSize)),r.add(x`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new XY("tex",n=>n.blurInputTexture)),s.add(x`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const nvt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:oCe,build:svt},Symbol.toStringTag,{value:"Module"}));class bz extends pr{initializeProgram(t){const i=bz.shader.get().build();return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({colorWrite:ri})}}bz.shader=new rr(nvt,()=>import("./HighlightBlur.glsl.144bbd2d.js"));class aCe extends Ws{constructor(){super(...arguments),this.invFramebufferDim=it()}}function ovt(){const e=new Zi,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(M.POSITION,"vec2"),r.add(x`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new XY("tex",n=>n.inputTexture)),i.uniforms.add(new WY("invFramebufferDim",n=>n.invFramebufferDim)),s.add(x`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const avt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:aCe,build:ovt},Symbol.toStringTag,{value:"Module"}));class wz extends pr{initializeProgram(t){const i=wz.shader.get().build();return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({colorWrite:ri})}}wz.shader=new rr(avt,()=>import("./HighlightDownsample.glsl.64803542.js"));class qce extends Ws{constructor(){super(...arguments),this.color=id(1,0,1,1),this.haloColor=id(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=bi(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const lvt=32;class cvt{constructor(t,i){this._techniqueRep=t,this._rctx=i,this.viewportToRestore=Xt(),this._passParameters=new qce,this._downsampleDrawParameters=new aCe,this._blurDrawParameters=new oCe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=Xa(this._rctx);const t={colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE,width:0,height:0},i={target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new Rr(this._rctx,t,i),this.blur1Fbo=new Rr(this._rctx,t,i);const r=new Wa;this._blurTechnique=this._techniqueRep.acquire(bz,r),this._downsampleTechnique=this._techniqueRep.acquire(wz,r),this._applyTechnique=this._techniqueRep.acquire(_z,r)}dispose(){if(this._blurTechnique=Ki(this._blurTechnique),this._downsampleTechnique=Ki(this._downsampleTechnique),this._applyTechnique=Ki(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=Ze(this.blur0Fbo),this.blur1Fbo=Ze(this.blur1Fbo)}setDefaultOptions(t){this._passParameters=F(F({},new qce),t)}render(t,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=t.camera;sp(this.viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this.quadVAO);let p=null;this._gridUpdateResources(i,lvt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(er.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,yi(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,ko(p,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(er.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,yi(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,ko(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,ko(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:ft.TEXTURE_2D,pixelFormat:Ve.RGB,dataType:Et.UNSIGNED_SHORT_5_6_5,samplingMode:Ke.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Rr(r,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,f=6,m=4,y=new Float32Array(f*m*l*c);let v=0;for(let w=0;w<l;w++)for(let b=0;b<c;b++)y[v+0]=(b-.5)*p*2-1,y[v+1]=(w-.5)*h*2-1,y[v+2]=b*p,y[v+3]=w*h,y[v+4]=(b+.5)*p*2-1,y[v+5]=(w-.5)*h*2-1,y[v+6]=b*p,y[v+7]=w*h,y[v+8]=(b-.5)*p*2-1,y[v+9]=(w+.5)*h*2-1,y[v+10]=b*p,y[v+11]=w*h,y[v+12]=(b-.5)*p*2-1,y[v+13]=(w+.5)*h*2-1,y[v+14]=b*p,y[v+15]=w*h,y[v+16]=(b+.5)*p*2-1,y[v+17]=(w-.5)*h*2-1,y[v+18]=b*p,y[v+19]=w*h,y[v+20]=(b+.5)*p*2-1,y[v+21]=(w+.5)*h*2-1,y[v+22]=b*p,y[v+23]=w*h,v+=f*m;s.vao&&s.vao.dispose(!0),s.vao=new Hs(r,Ui,{geometry:Y3},{geometry:oi.createVertex(r,Ei.STATIC_DRAW,y)})}}_gridComputeMipmap(t){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,t);i.bindVAO(this.quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,yi(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t),i.setViewport(0,0,o,a),i.drawArrays($t.TRIANGLE_STRIP,0,ko(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(_(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(_(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const uvt={dataType:Et.UNSIGNED_BYTE,internalFormat:Ve.RGBA},hvt={};class dvt{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null),r||(r=new nt(this.rctx,{target:ft.TEXTURE_2D,pixelFormat:Ve.DEPTH_STENCIL,dataType:Et.UNSIGNED_INT_24_8,samplingMode:Ke.NEAREST,wrapMode:wt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new rS(this.rctx,F({internalFormat:Fa.DEPTH_STENCIL},i)),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null)),r||(r=new nt(this.rctx,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:Ke.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return F(F({id:Cl()},hvt),t)}registerColorTarget(t={}){return F(F({id:Cl()},uvt),t)}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,t);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=_(r)?new Rr(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.DEPTH_STENCIL_TEXTURE},o,l):new Rr(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Rr(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:r?Mi.DEPTH_STENCIL_RENDER_BUFFER:Mi.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=Mw(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class pvt{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=t.type===pi.WEBGL2;this._renderTargetHelper=new dvt(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:Et.FLOAT,internalFormat:r?mt.RGBA32F:Ve.RGBA,samplingMode:Ke.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:Ke.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?mt.RGBA4:Ve.RGBA,dataType:Et.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?mt.RGBA4:Ve.RGBA,dataType:Et.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(er.COLOR_BUFFER_BIT|er.DEPTH_BUFFER_BIT|er.STENCIL_BUFFER_BIT)}composite(t){_(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,No.None)}renderTmpAndCompositeToMain(t,i,r,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,fvt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,mvt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),No.None,1,fc.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case gt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case gt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case gt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),No.PremultipliedAlpha)}compositeOccludedOntoMain(t,i){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),No.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(t,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(er.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,i,r,s,n=!1,o=!1){const a=this._rctx,l=this.bindTarget(i,r);let c=0;if(s){const p=Math.max(1e-13,s[3]);a.setClearColor(s[0],s[1],s[2],p),c|=er.COLOR_BUFFER_BIT}return n&&(c|=er.DEPTH_BUFFER_BIT),o===!1?o=0:(o===!0&&(o=255),c|=er.STENCIL_BUFFER_BIT),c&&a.clearSafe(c,o),t(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const fvt=[0,0,0,0],mvt=[0,1,0,1];class gvt{constructor(t){this.context=t,this._renderPlugins=new Wt,this.slots=[];for(let i=0;i<Ee.MAX_SLOTS;++i)this.slots[i]=[]}add(t,i,r){const s=()=>{if(r==null?void 0:r.aborted)throw i.uninitializeRenderContext(),mi();this._renderPlugins.push(i);for(const o of t)this.slots[o].push(i);this.context.requestRender()},n=i.initializeRenderContext(this.context,r);if(Vu(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let i=0;i<this.slots.length;++i)this.slots[i]=this.slots[i].filter(r=>r!==t);t.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(yvt(r)){const s=r.prepareTechnique(this.context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this.context.renderContext,i[s]))}queryDepthRange(t){const i=vvt;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&FE(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[Ee.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,0)}}function yvt(e){return"prepareTechnique"in e}const vvt={near:0,far:0};class lCe extends pSe{}const xz=255,_vt=1/xz;function bvt(){const e=new Zi,t=e.fragment;return t.include(Lc),t.include(Uu),e.include(GU),e.include(b_),e.include(UU,{receiveShadows:!0}),t.uniforms.add([new jt("depthMap",i=>i.linearDepthTexture),new Tr("inverseViewMatrix",(i,r)=>_s(Wce,qa(Wce,r.camera.viewMatrix,r.camera.center))),new vi("nearFar",(i,r)=>r.camera.nearFar)]),t.constants.add("sampleValue","float",_vt),t.code.add(x`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Wce=Ae(),wvt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:lCe,shadowCastMaxSamples:xz,build:bvt},Symbol.toStringTag,{value:"Module"}));var Xw;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(Xw||(Xw={}));class Zq extends Wa{constructor(){super(...arguments),this.visualization=Xw.Gradient,this.bandsEnabled=!1}}u([H({count:Xw.COUNT})],Zq.prototype,"visualization",void 0),u([H()],Zq.prototype,"bandsEnabled",void 0);function xvt(e){const t=new Zi,i=t.fragment;i.include(Lc),i.include(Uu),t.include(GU),t.include(b_);const{visualization:r,bandsEnabled:s}=e;i.constants.add("inverseSampleValue","float",xz),i.uniforms.add([new jt("shadowCastMap",a=>a.shadowCastMap),new We("sampleScale",a=>a.sampleScale),new We("opacityFromElevation",a=>a.opacityFromElevation),new ni("uColor",a=>a.color)]);const n=r===Xw.Gradient,o=r===Xw.Threshold;return n&&s?i.uniforms.add(new We("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new We("threshold",a=>a.threshold)),i.code.add(x`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?x`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?x`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?x`* strength`:""});
      }
    `),t}const Tvt=Object.freeze(Object.defineProperty({__proto__:null,build:xvt},Symbol.toStringTag,{value:"Module"}));class Tz extends pr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=Tz.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:$u,colorWrite:ri,depthTest:null,depthWrite:null})}get primitiveType(){return $t.TRIANGLE_STRIP}}Tz.shader=new rr(Tvt,()=>import("./ShadowCastVisualize.glsl.c0c8b911.js"));const Svt=bi(.01,0,.25,1),Evt=4e4,Cvt=5e4,cCe=1/512;let FN=class extends Se{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:Svt,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new Zq,this._enabled=!1,this._vao=Xa(t),this._techniqueConfig.visualization=Xw.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=Ze(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(Tz,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,ko(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>cCe}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;JM(e,t)||(sp(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([d()],FN.prototype,"opacityFromElevation",null),FN=u([P("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],FN);class Sz extends pr{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=Sz.shader.get().build();return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:bo(Re.ONE,Re.ONE,Re.ONE,Re.ONE),colorWrite:ri,depthTest:null,depthWrite:null})}get primitiveType(){return $t.TRIANGLE_STRIP}}Sz.shader=new rr(wvt,()=>import("./ShadowCastAccumulate.glsl.218a8751.js"));var jR;let ta=jR=class extends Se{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new lCe,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=Uq,this._previewing=!1,this._handles=new Nt,this._cameraForcedForScreenshot=!1,this._bindParameters=new aU(new oJ(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new tr,this._vao=Xa(e);const o={colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE,width:0,height:0},a={target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Rr(e,o,a),this._accumulationRenderer=new FN(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(yt.SHADOW_ACCUMULATOR,this)),this._handles.add(ie(()=>i.renderView,c=>{this._handles.remove(jR.renderViewHandleKey),R(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),jR.renderViewHandleKey)},Us))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(R(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new Sz(e,new Wa)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==Uq&&this._opacityFromElevation>cCe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(Hv(t,e,gw))return;const i=e.length;t.length=i,this._sampleCount=Math.min(xz,i);for(let r=0;r<i;++r){const s=e[r],n=t[r]||O();ae(n,s),t[r]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(jR.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=Ze(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=Ze(this._fbo),this._vao=Ze(this._vao),this._accumulationTechnique=Ki(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=Avt;return this._fbo.readPixels(e,t,1,1,Ve.RGBA,Et.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(er.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,ko(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-F2(Evt,Cvt,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};ta.previewSamples=6,ta.renderViewHandleKey="renderView",u([d()],ta.prototype,"_progress",void 0),u([d()],ta.prototype,"_sampleCount",void 0),u([d()],ta.prototype,"_enabled",void 0),u([d()],ta.prototype,"_depthRange",void 0),u([d()],ta.prototype,"_previewing",void 0),u([d()],ta.prototype,"_accumulationRenderer",void 0),u([d()],ta.prototype,"_isRefining",null),u([d()],ta.prototype,"_isActive",null),u([d()],ta.prototype,"canAccumulate",null),u([d()],ta.prototype,"_isDoneAccumulating",null),u([d()],ta.prototype,"_opacityFromElevation",null),u([d()],ta.prototype,"running",null),ta=jR=u([P("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],ta);const Avt=new Uint8Array(4),Xce={highlightedThreshold:.99999,selfShadowThreshold:.025};function Rvt(){const e=new Zi;e.include(Bw,{receiveShadows:!0});const t=e.fragment;return t.include(Lc),t.include(Uu),e.include(GU),e.include(b_),t.uniforms.add([new jt("defaultDepthTex",(i,r)=>r.shadowMap.getSnapshot(PE.Default)),new jt("highlightDepthTex",(i,r)=>r.shadowMap.getSnapshot(PE.Highlight)),new jt("depthMap",(i,r)=>r.linearDepthTexture),new jt("highlightMap",(i,r)=>r.highlightColorTexture),new ni("uColor",i=>i.shadowColor),new vi("nearFar",(i,r)=>r.camera.nearFar),new We("opacity",i=>i.shadowOpacity),new We("occludedOpacity",i=>i.occludedShadowOpacity),new We("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Tt("lightingMainDirectionView",(i,r)=>we(Yce,ze(Yce,r.lighting.lightingMainDirection,r.camera.viewInverseTransposeMatrix))),new vi("texelSize",(i,r)=>_(r.linearDepthTexture)?yi(Mvt,1/r.linearDepthTexture.descriptor.width,1/r.linearDepthTexture.descriptor.height):Zh),new Tr("inverseViewMatrix",(i,r)=>_s(Zce,qa(Zce,r.camera.viewMatrix,r.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",oTe).add("highlightedThreshold","float",Xce.highlightedThreshold).add("selfShadowThreshold","float",Xce.selfShadowThreshold),t.code.add(x`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(x`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Zce=Ae(),Yce=O(),Mvt=it(),Ovt=Object.freeze(Object.defineProperty({__proto__:null,build:Rvt},Symbol.toStringTag,{value:"Module"}));class Pvt extends Ws{constructor(){super(...arguments),this.shadowColor=bi(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class Ez extends pr{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=Ez.shader.get().build();return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({blending:bo(Re.SRC_ALPHA,Re.ONE,Re.ONE_MINUS_SRC_ALPHA,Re.ONE_MINUS_SRC_ALPHA),colorWrite:ri,depthTest:null,depthWrite:null})}get primitiveType(){return $t.TRIANGLE_STRIP}}Ez.shader=new rr(Ovt,()=>import("./ShadowHighlight.glsl.26f4492e.js"));const Ivt=.001953125,$vt=4e4,Lvt=5e4;class Dvt{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new Pvt,this._drawParameters=new pSe,this._vao=Xa(this._rctx)}get technique(){return R(this._technique)&&(this._technique=new Ez({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,i){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const r=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,ko(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(i=(t=this._vao)==null?void 0:t.size)!=null?i:0}setDefaultOptions(t){this._passParameters=F(F({},this._passParameters),t),this._updateMaxOpacity()}updateParameters(t,i){this._passParameters.opacityElevation=1-F2($vt,Lvt,t.relativeElevation);const r=this._viewingMode===Ge.Global?we(Qce,t.center):se(Qce,0,0,1),s=xe(r,i);this._passParameters.dayNightTerminator=F2(0,1,De(30*s,0,1))}dispose(){this._vao=Ze(this._vao),this._technique=Ki(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*t*i>=Ivt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const Qce=O(),Jce=v_();class Nvt{constructor(){this._plane=v_()}get isEnabled(){return!iye(this.plane,Jce)}get plane(){return this._plane}set plane(t){lx(t||Jce,this._plane)}}var Hf;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(Hf||(Hf={}));class uCe extends Wa{constructor(){super(...arguments),this.output=Hf.EdgeDetector}}u([H({count:Hf.COUNT})],uCe.prototype,"output",void 0);const o0={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function Fvt(e){const t=new Zi;return e.output===Hf.EdgeDetector&&(t.attributes.add(M.POSITION,"vec2"),t.vertex.uniforms.add(new Va("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(x`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new zr("tColor")),t.fragment.code.add(x`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${x.float(o0.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${x.float(o0.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===Hf.BlendWeight&&(t.attributes.add(M.POSITION,"vec2"),t.vertex.uniforms.add(new Va("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(x`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${x.int(o0.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new zr("tEdges")),t.fragment.uniforms.add(new zr("tArea")),t.fragment.uniforms.add(new zr("tSearch")),t.fragment.uniforms.add(new zr("tColor")),t.fragment.uniforms.add(new Va("resolution")),t.fragment.code.add(x`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(o0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${x.int(o0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(o0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${x.int(o0.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${x.int(o0.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===Hf.Blur&&(t.attributes.add(M.POSITION,"vec2"),t.vertex.uniforms.add(new Va("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(x`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new zr("tBlendWeights")),t.fragment.uniforms.add(new zr("tColor")),t.fragment.uniforms.add(new Va("resolution")),t.fragment.code.add(x`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const kvt=Object.freeze(Object.defineProperty({__proto__:null,build:Fvt},Symbol.toStringTag,{value:"Module"}));class Cz extends pr{initializeProgram(t){const i=Cz.shader.get().build(this.configuration);return new sr(t.rctx,i,Ui)}initializePipeline(){return Bt({colorWrite:ri})}}Cz.shader=new rr(kvt,()=>import("./SMAA.glsl.c4b79247.js"));let HR=class extends Se{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=Hh(this._abortController),this.disable()}_loadResources(e){if(_(this._abortController))return!1;if(_(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return import("./SmaaRenderPassData.e07ab82b.js").then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return fi(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,Ke.LINEAR,Ve.RGB),this._loadTextureFromBase64(e.searchTexure,Ke.NEAREST,Ve.LUMINANCE)]).then(([i,r])=>{nn(t)?(i.dispose(),r.dispose(),fi(t)):(this._areaTexture=i,this._searchTexture=r)})}get updating(){return _(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new uCe,i=(r,s)=>this._techniqueRep.releaseAndAcquire(Cz,r,s);t.output=Hf.EdgeDetector,this._edgeDetectTechnique=i(t,this._edgeDetectTechnique),t.output=Hf.BlendWeight,this._blendWeightsTechnique=i(t,this._blendWeightsTechnique),t.output=Hf.Blur,this._blurTechnique=i(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=oXe(this.rctx),this._edges=new Rr(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},{target:ft.TEXTURE_2D,pixelFormat:Ve.RGB,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new Rr(this.rctx,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.LINEAR,wrapMode:wt.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=Ze(this._vao),this._areaTexture=Ze(this._areaTexture),this._searchTexture=Ze(this._searchTexture),this._blend=Ze(this._blend),this._edges=Ze(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(er.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays($t.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(er.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays($t.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(er.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays($t.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return Ap(e).then(r=>new nt(this.rctx,{pixelFormat:i,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.CLAMP_TO_EDGE,width:r.width,height:r.height,samplingMode:t},r))}};u([d()],HR.prototype,"_abortController",void 0),u([d({readOnly:!0})],HR.prototype,"updating",null),HR=u([P("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],HR);function Uvt(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],o=i[3],a=i[7],l=i[11],c=i[15];i[0]+=o*r,i[1]+=o*s,i[2]+=o*n,i[4]+=a*r,i[5]+=a*s,i[6]+=a*n,i[8]+=l*r,i[9]+=l*s,i[10]+=l*n,i[12]+=c*r,i[13]+=c*s,i[14]+=c*n}function zvt(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}class Vvt{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const i=this.originData.get(t.id);return i?(i.refCount++,i.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Ae(),origin:t}),t)}release(t){const i=this.originData.get(t.id);i&&(i.refCount--,i.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(i=>{Ss(i.viewMatrix,t),zvt(i.origin.vec3,i.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}class Bvt extends lSe{constructor(t,i,r){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=i,this.transparency=r,this.transformNormalViewFromGlobal=Or()}}class Gvt extends cSe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Or(),this.slicePlaneLocalOrigin=O(),this.transformNormalGlobalFromModel=Or()}}function jvt(e){const t=x`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const Hvt=Di(.5,-4e-4);function qvt(e,t){const i=e.vertex;i.include(jvt),i.constants.add("depthBias","vec2",Hvt),i.uniforms.add(new vi("inverseViewport",(r,s)=>s.inverseViewport)),t.legacy?(i.uniforms.add(new e_("localView")),i.uniforms.add(new Tr("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new nP("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new Tr("transformProjFromView",r=>r.transformProjFromView)),i.code.add(x`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(x`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Wvt(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(x`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(x`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function Xvt(e,t){const i=e.vertex;t.silhouette?(i.code.add(x`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(x`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Zvt(e,t){const i=e.vertex;i.include(Lc),i.uniforms.add(new We("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(x`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new zr("componentDataTex")),i.uniforms.add(new zg("componentDataTexInvDim")),e.attributes.add(M.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.constants.add("verticalOffsetScale","float",2*HJ),i.code.add(x`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new MO("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(x`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(M.NORMALA,"vec3"),e.attributes.add(M.NORMALB,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(M.NORMAL,"vec3"),i.code.add(x`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(x`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(X4,t),i.include(X4,t),i.uniforms.add([new nP("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new MO("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new Ga("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new Ga("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Tt("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Tt("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(x`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?x`normalize(transformWorldFromModelTL + rotatedModelPosition);`:x`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Tr("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(x`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(x`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function hCe(e){return e.mode===zs.SKETCH||e.mode===zs.MIXED}var zs;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(zs||(zs={}));function Yvt(e,t){const i=e.vertex;switch(t.mode){case zs.SKETCH:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case zs.MIXED:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case zs.SOLID:i.code.add(x`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function QJ(e,t){const i=e.vertex;switch(e.attributes.add(M.SIDENESS,"vec2"),t.mode===zs.MIXED?i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(x`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case zs.MIXED:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case zs.SKETCH:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case zs.SOLID:i.code.add(x`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case zs.COUNT:break;default:t.mode}}function Qvt(e,t){const i=e.vertex;switch(e.include(QJ,t),hCe(t)&&i.uniforms.add(new Ni("strokesAmplitude")),t.mode){case zs.SOLID:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case zs.SKETCH:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case zs.MIXED:i.code.add(x`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Jvt(e,t){const i=e.vertex;e.include(QJ,t);const r=e.fragment;switch(hCe(t)&&(i.uniforms.add(new zg("strokesTextureScale")),i.uniforms.add(new Ni("strokesLog2Resolution")),i.uniforms.add(new Ni("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new zr("strokesTexture")),r.uniforms.add(new Ni("strokesNormalizationScale")),i.code.add(x`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(Lc),r.code.add(x`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case zs.SOLID:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(x`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case zs.SKETCH:i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(x`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case zs.MIXED:e.varyings.add("vType","float"),i.code.add(x`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(x`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Kvt(e){const t=new Zi,i=t.vertex,r=t.fragment;return e.legacy&&i.uniforms.add(new e_("model")),e.antialiasing&&(i.code.add(x`#define ANTIALIASING 1`),r.code.add(x`#define ANTIALIASING 1`)),t.include(qvt,e),t.include(Zvt,e),t.include(Qvt,e),t.include(QJ,e),t.include(Jvt,e),t.include(vs,e),t.include(Xvt,e),t.include(Wvt,e),t.include(Yvt,e),t.include(zu,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new vi("pixelToNDC",(s,n)=>yi(e_t,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))),i.uniforms.add(new ni("viewport",(s,n)=>n.camera.fullViewport)),i.uniforms.add(new We("pixelRatio",(s,n)=>n.camera.pixelRatio)),t.attributes.add(M.POSITION0,"vec3"),t.attributes.add(M.POSITION1,"vec3"),t.attributes.add(M.VARIANTOFFSET,"float"),t.attributes.add(M.VARIANTSTROKE,"float"),t.attributes.add(M.VARIANTEXTENSION,"float"),i.code.add(x`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(x`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const e_t=it(),t_t=Object.freeze(Object.defineProperty({__proto__:null,build:Kvt},Symbol.toStringTag,{value:"Module"}));class Az extends pr{initializeProgram(t){const i=Az.shader.get().build(this.configuration);return new sr(t.rctx,i,Bq)}initializePipeline(t){return t.blendMinMax?Bt({blending:bo(Re.ONE,Re.ONE,Re.ZERO,Re.ONE,sy.ADD,t.blendMinMax.MAX),depthTest:{func:gr.LEQUAL},colorWrite:ri}):Bt({depthTest:{func:gr.LEQUAL},depthWrite:Nl,colorWrite:ri})}}Az.shader=new rr(t_t,()=>import("./EdgeShader.glsl.22e6cbf8.js"));class vf extends la{constructor(){super(...arguments),this.mode=zs.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([H({count:zs.COUNT})],vf.prototype,"mode",void 0),u([H()],vf.prototype,"hasSlicePlane",void 0),u([H()],vf.prototype,"silhouette",void 0),u([H()],vf.prototype,"legacy",void 0),u([H()],vf.prototype,"antialiasing",void 0),u([H()],vf.prototype,"doublePrecisionRequiresObfuscation",void 0),u([H()],vf.prototype,"hasMultipassTerrain",void 0),u([H()],vf.prototype,"cullAboveGround",void 0),u([H()],vf.prototype,"spherical",void 0);const i_t=8,M8=128,r_t={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class s_t{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const n_t={solid:zs.SOLID,sketch:zs.SKETCH,uber:zs.MIXED};class VM{constructor(t,i,r){this.rctx=t,this.shaderTechniqueRepository=i,this._configuration=new vf,this.refCount=new s_t,this.renderables=new Set,this.sortedRenderables={[Lt.TRANSPARENT]:{[Lt.TRANSPARENT]:new Wt,[Lt.OPAQUE]:new Wt},[Lt.OPAQUE]:{[Lt.TRANSPARENT]:new Wt,[Lt.OPAQUE]:new Wt}},this._renderablesDirty=!1,this._drawParameters=new Gvt,this._settings=F(F({},r_t),r),this.key=VM.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:Wi.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=n_t[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=dP(t),this._configuration.spherical=r.spherical}dispose(){this._technique=Ki(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,i){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[i][Lt.TRANSPARENT].forAll(t),this.sortedRenderables[i][Lt.OPAQUE].forAll(t)}updateTechnique(t,i){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(Az,this._configuration,this._technique),this._technique}bindRegularEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!1),t,i)}bindSilhouetteEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!0),t,i)}renderRegularEdges(t,i,r,s,n){this._render(t,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(t,i,r,s,n){this._render(t,i,i.silhouette.vao,r,s,n)}_render(t,i,r,s,n,o){this._bindDraw(t,i,s,o),this.rctx.bindVAO(r),this.rctx.capabilities.instancing.drawArraysInstanced($t.TRIANGLE_FAN,0,4,n)}_bindDraw(t,i,r,s){if(i.components.buffer.textureBuffer.bind(t,o_t,a_t),"origin"in i.transform)t.setUniformMatrix4fv("localView",s),t.setUniformMatrix4fv("model",i.transform.modelMatrix),ae(this._drawParameters.slicePlaneLocalOrigin,i.transform.origin.vec3);else{const n=new vz(i.transform.position),o=Jh(Kce,dx(Kce,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=r.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,r),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const i=this._settings.strokesTexture,r=i.texture;R(r)||(t.bindTexture("strokesTexture",r),t.setUniform2f("strokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(i.resolution)),t.setUniform1f("strokesNormalizationScale",i.normalizationScale),t.setUniform1f("strokesAmplitude",i.amplitude),t.setUniform1f("strokeVariants",i.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[Lt.TRANSPARENT][Lt.TRANSPARENT].clear(),this.sortedRenderables[Lt.TRANSPARENT][Lt.OPAQUE].clear(),this.sortedRenderables[Lt.OPAQUE][Lt.TRANSPARENT].clear(),this.sortedRenderables[Lt.OPAQUE][Lt.OPAQUE].clear(),this.renderables.forEach(i=>{i.objectTransparency!==Lt.INVISIBLE&&i.edgeTransparency!==Lt.INVISIBLE&&this.sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform&&"origin"in r.transform?i.transform.origin.id<r.transform.origin.id?-1:i.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[Lt.TRANSPARENT][Lt.TRANSPARENT].sort(t),this.sortedRenderables[Lt.TRANSPARENT][Lt.OPAQUE].sort(t),this.sortedRenderables[Lt.OPAQUE][Lt.TRANSPARENT].sort(t),this.sortedRenderables[Lt.OPAQUE][Lt.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const o_t="componentDataTex",a_t="componentDataTexInvDim",Kce=jg();class l_t extends q2e{constructor(t){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},t)}async process(t,i,r){if(r)return ZJ(t);const s=this._packInput(t),n=await this.invoke(s,i);return this._unpackOutput(n)}async extractEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractEdgeLocations",r,i);return EL(s)}async extractComponentsEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractComponentsEdgeLocations",r,i);return EL(s)}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:qN(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:EL(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:EL(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function c_t(e){const i=SA.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=SA.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=SA.strokes.length;let p=(c-1)*h*l;for(const{distance:m,pressure:y}of SA.strokes){let v=m,w=y,b=p;for(let S=0;S<c;S++){S!==0&&(v=eue(v,g3.DISTANCE),w=eue(w,g3.PRESSURE));for(let T=0;T<SA.resolution;T++){const E=.5+(v?v[T%v.length]/a:0),C=w?w[T%w.length]:1;ZO(E,s,b),ZO(C,s,b+n),b+=4}b-=l*(h+1)}p+=l}const f=new nt(e,{pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:Ke.LINEAR,width:i,height:i,wrapMode:wt.REPEAT},s);return new h_t(i,a,o,h,f)}function eue(e,t){if(!e)return null;const i=e.length/2,r=u_t*i,s=new Array(i);let n=0;const o=t===g3.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*tue):Math.min(r,l*tue)}return s}var g3;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(g3||(g3={}));const u_t=.1,tue=.5;class h_t{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=Ze(this.texture)}}const SA={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function iue(e){let t=null;for(const i of e){const r=i.type;if(d_t(i)){if(R(t))t=r;else if(t!==r)return"uber"}}return _(t)?t:"uber"}function O8(e){let t=Lt.INVISIBLE;for(const{material:i}of e)if(dCe(i)){if(i.color[3]*i.opacity<1)return Lt.TRANSPARENT;t=Lt.OPAQUE}return t}function P8(e){let t=Lt.INVISIBLE;for(const{material:i}of e)if(dCe(i)){switch(i.objectTransparency){case Lt.TRANSPARENT:case Lt.INVISIBLE:return Lt.TRANSPARENT;case Lt.OPAQUE:if(i.opacity<1)return Lt.TRANSPARENT}t=Lt.OPAQUE}return t}function dCe(e){return e.size*e.color[3]*e.opacity>0}function d_t(e){return e.size*e.color[3]>0}function p_t(e,t){const i=whe(e,t,!0);return i===-1?t<e[0]?0:e.length:i}function rue(e,t,i){return e.length-p_t(e,t*i.minimumEdgeLength)}function sue(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}const f_t=fe.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let kd=class extends Se{constructor(e){super(e),this.updatingHandles=new zf,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[Lt.TRANSPARENT]:0,[Lt.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=O(),this.localOrigins=new Vvt(new nJ(e.renderSR))}initialize(){this.worker=new l_t(this.schedule),this.componentColorManager=new rCe(this.rctx,3);const e=ZEe.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=oi.createVertex(this.rctx,Ei.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=Ze(this.strokesTexture),this.componentColorManager=lt(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=Ze(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[Lt.TRANSPARENT]+this.numberOfRenderedEdges[Lt.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new nue(new Promise(p=>l=p),i.center,i.radius);this.perObjectData.set(e,c);const h=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void f_t.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new nue(new Promise(c=>n=c),o,Fg(o));this.perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&g_t(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let c=0;c<e.geometries.length;c++){const h=e.geometryRecords[c];if(!h.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,h,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?r=>t[r]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{const s=r.components.meta.length;for(let n=0;n<s;n++){const o=i(n),a=r.components.meta[n],l=a.index;a.material.opacity=o,r.components.buffer.textureBuffer.setDataElement(l,1,3,255*o)}this._updateTransparency(r)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,i)=>t+i.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof Sy,n=!!i.hasSlicePlane,o=iue(t),a=VM.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(a!==l.rendererKey){const c=this.renderers.get(l.rendererKey),h=this._acquireRenderer(o,n,s);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=a,h.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];r&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>{var s;const r=i.components.meta;for(let n=0;n<r.length;n++)i.components.meta[n].verticalOffset=(s=t==null?void 0:t[n])!=null?s:0;this._updateComponentBuffer(i.components)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>i.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,t.loaded==null)throw mi();return t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,R(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=O(),s=new vz;let n=0,o=0;if(this.renderers.forEach(h=>{h.refCount.value===0?(this.renderers.delete(h.key),h.dispose()):h.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,p.regular&&h.updateTechnique(e,!1),p.silhouette&&h.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),o===0)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new Bvt(a,l,t);se(r,i[3],i[7],i[11]),s.set(r),ae(c.transformWorldFromViewTH,s.high),ae(c.transformWorldFromViewTL,s.low),Qh(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),Jh(oue,c.transformViewFromCameraRelativeRS),dx(c.transformNormalViewFromGlobal,oue),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(h=>{this._renderRegularEdges(h,e,c),this._renderSilhouetteEdges(h,e,c)})}_updateTransparency(e){const t=O8(e.components.meta),i=P8(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),_(t.origin))this.localOrigins.register(t.origin);else{const r=se(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(r)}return Uvt(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e,r=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=De(Math.round(n.size*i_t),0,255),l=De(n.extensionLength,-M8,255-M8)+M8,c=n.type==="solid"?g5.SOLID:g5.SKETCH,h=255*n.opacity,p=n.color,f=255*p[0],m=255*p[1],y=255*p[2],v=255*p[3];i.textureBuffer.setData(o,0,f,m,y,v),i.textureBuffer.setData(o,1,a,l,c,h),WEe(t[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(e){if(R(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=i.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if(R(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new Hs(this.rctx,Bq,{vertices:Nce,instances:f5.glLayout},{vertices:this.verticesBufferObject,instances:oi.createVertex(this.rctx,Ei.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new Hs(this.rctx,Bq,{vertices:Nce,instances:m5.glLayout},{vertices:this.verticesBufferObject,instances:oi.createVertex(this.rctx,Ei.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,o){const a=i.vertexAttributes.get(M.POSITION),l=i.indices.get(M.POSITION),c=Ae(),h={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,r,c)};return this._addPositionData(t,h,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([r]);if(R(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,f=p.data.length/p.size,m=p3.createBuffer(f);for(let T=0;T<f;T++)m.position.set(T,0,p.data[T*p.size+0]),m.position.set(T,1,p.data[T*p.size+1]),m.position.set(T,2,p.data[T*p.size+2]);sue(o.meta,[0,m.componentIndex.count],m.componentIndex);const y=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,m,!1,n,h,i));if(e.loaded==null)return;const{regular:v,silhouette:w}=this._createEdgeResources(y),b=(v?v.vao.size:0)+(w?w.vao.size:0),S={regular:v,silhouette:w,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:b,externalMemoryUsage:!1,averageEdgeLength:y.averageEdgeLength},components:o,visible:!0,edgeTransparency:O8(o.meta),objectTransparency:P8(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(S),a.addRenderable(S),this.gpuMemoryUsage+=b}async _addComponentGeometry(e,t,i,r,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(R(a))return 0;const l=iue(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=p3.createBuffer(i.count);KU(h.position,i),sue(a.meta,s,h.componentIndex,r);const p=!0,f=c.writerSettings,m=await this.updatingHandles.addPromise(this._extractEdges(f,h,p,!1,r));if(t.loaded==null)return 0;const{regular:y,silhouette:v}=this._createEdgeResources(m),w=(y?y.vao.size:0)+(v?v.vao.size:0),b={regular:y,silhouette:v,transform:e,statistics:{gpuMemoryUsage:w,externalMemoryUsage:!0,averageEdgeLength:m.averageEdgeLength},components:a,visible:!0,edgeTransparency:O8(a.meta),objectTransparency:P8(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(b),c.addRenderable(b),w}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let b=0;b<e.geometries.length;b++){const S=e.geometries[b],T=e.geometryRecords[b];if(!T.material.supportsEdges)continue;!a&&T.origin&&(a=T);const E=S.vertexAttributes.get(M.POSITION);l+=E.data.length/E.size,o+=S.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let f=0;for(let b=0;b<e.geometries.length;b++){const S=e.geometries[b];if(!e.geometryRecords[b].material.supportsEdges)continue;const T=S.vertexAttributes.get(M.POSITION),E=S.indices.get(M.POSITION);let C=n.get(T.data);if(C==null){C=p.length/3;for(let A=0;A<T.data.length;A+=T.size)p.push(T.data[A+0]),p.push(T.data[A+1]),p.push(T.data[A+2]);n.set(T.data,C)}if(E)for(let A=0;A<S.edgeIndicesLength;A++)h[f++]=C+E[A]}const m=a||e.geometryRecords[0],y=Ae(),v=this._computeModelTransformWithLocalOrigin(e,m,y);for(let b=0;b<e.geometryRecords.length;b++)e.geometryRecords[b].origin=v;const w={position:{data:p,size:3},indices:h,modelTransform:y,origin:v};await this.updatingHandles.addPromise(this._addPositionData(t,w,h.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=VM.getKey(e,t,i);let s=this.renderers.get(r);return R(this.strokesTexture)&&(this.strokesTexture=c_t(this.rctx)),s||(s=new VM(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:i,spherical:this.viewingMode===Ge.Global}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){m_t(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=O(),s=n=>{const{center:o,radius:a}=n;Cc(r,o,t);const l=xe(r,i),c=l<-a?1/0:l<a?0:l-a;n.renderables.forEach(h=>h.distanceToCamera=c)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.regular)return;const o=rue(n.regular.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):hn;e.renderRegularEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.silhouette)return;const o=rue(n.silhouette.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):hn;e.renderSilhouetteEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}};function m_t(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function g_t(e){let t=null,i=null;for(let r=0;r<e.geometries.length;r++){const s=e.geometryRecords[r];if(s.material.supportsEdges){if(t){if(!Hv(t,s.transformation))return!1}else t=s.transformation;if(!i&&_(s.origin))i=s;else if(_(i==null?void 0:i.origin)&&_(s.origin)&&i.origin.id!==s.origin.id)return!1}}return!0}u([d({constructOnly:!0})],kd.prototype,"rctx",void 0),u([d({constructOnly:!0})],kd.prototype,"renderSR",void 0),u([d({constructOnly:!0})],kd.prototype,"viewingMode",void 0),u([d({constructOnly:!0})],kd.prototype,"techniqueRepository",void 0),u([d({constructOnly:!0})],kd.prototype,"setNeedsRender",void 0),u([d({constructOnly:!0})],kd.prototype,"schedule",void 0),u([d({readOnly:!0})],kd.prototype,"updatingHandles",void 0),u([d({readOnly:!0})],kd.prototype,"updating",null),kd=u([P("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],kd);class nue{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const oue=Or();function y_t(e){const t=e.capabilities.disjointTimerQuery;return R(t)?null:t.timestampBits()>0?new v_t(t):Yq?null:new __t(t)}class v_t{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,i=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,i)}_checkQueryResult(t,i){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,i),i);if(this.timer.disjoint())return void t(null);const r=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-r)/1e6)}}class __t{constructor(t){this.timer=t,this.query=t.createQuery(),Yq=!0,this.timer.beginTimeElapsed(this.query)}stop(t,i=50){this.timer.endTimeElapsed(),Yq=!1,this._checkQueryResult(t,i)}_checkQueryResult(t,i){const r=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!r||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,i),i);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let Yq=!1;var $s;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})($s||($s={}));const b_t=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class w_t extends Iv{constructor(){super("total"),this.total=0,this.frameCount=0}}class x_t{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new w_t,this.gpuTime=new Iv("gpu",9),this.renderPassTimings=b_t.map(t=>new Iv(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:wW(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=y_t(t))}advance(t){const i=performance.now();this.renderPassTimings[t].record(i-this._lastSample),this._lastSample=i}postrender(){_(this._gpuTimer)&&(this._gpuTimer.stop(i=>_(i)&&this.gpuTime.record(i),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const aue=.9;let cg=class extends Se{constructor(e,t,i,r,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new x_t,this._antialiasing=xb.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new Nt,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new HR(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new pvt(this._rctx,this._compositingHelper),this._sliceHelper=new Nvt,this._shadowMap=new oJ(this._rctx,l.viewingMode,2),this._ssaoHelper=new xSe(i,this._rctx,()=>this._requestRender()),this._highlight=new cvt(i,this._rctx),this._shadowHighlight=new Dvt(this._rctx,l.viewingMode),this._shadowAccumulator=new ta(this._rctx,i,l,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_ALL,c.shadowMap),c.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new qst(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new gvt({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new J0t(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([ie(()=>this._stage.state.camera,()=>this._requestRender(),Us),ie(()=>Wi.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Lt.TRANSPARENT):()=>{},this._requestRender()},Rt)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=lt(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=Ze(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),lU.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===xb.SMAA&&this._smaaPass.updating||_(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return R(this._edgeView)&&(this._edgeView=new kd({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(ie(()=>rn(this._edgeView,e=>e.updating),()=>this._requestRender(),qi)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Xme(this._bindParameters.ssr.reprojectionMatrix,hn)}set _reprojectionMatrix(e){fW(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)==null?void 0:e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:i,_bindParameters:r}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),_(e.environment)){_(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&i.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(i.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type==="sun";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?xb.SMAA:xb.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(t.length===0&&i.length===0&&r.length===0)return;i.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=aSe(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new _Se(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=sn(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=sn(this._materialRenderers,o=>o.hasOccludees),this._hasWater=sn(this._materialRenderers,o=>o.hasWater),this._needsTransparentPass=sn(this._materialRenderers,o=>o.requiresSlot(Ee.TRANSPARENT_MATERIAL,je.MATERIAL)),this._hasHUDElements=sn(this._materialRenderers,o=>o.requiresSlot(Ee.LINE_CALLOUTS_HUD_DEPTH,je.MATERIAL)||o.requiresSlot(Ee.HUD_MATERIAL,je.MATERIAL)||o.requiresSlot(Ee.LABEL_MATERIAL,je.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=i,this._bindParameters.lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=gt.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=v_(this._sliceHelper.plane);r===Rw.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,i),this._renderPlugins.prepareRender(),this.performanceInfo.advance($s.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance($s.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t,i),this._renderLinearDepth(),this.performanceInfo.advance($s.Lineardepth),this._accumulateShadows(o,t,i),this._renderNormal(),this.performanceInfo.advance($s.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance($s.SSAO),this._renderContext.pass=je.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance($s.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges(Lt.OPAQUE),this.performanceInfo.advance($s.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Ee.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance($s.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot(Ee.LINE_CALLOUTS),this.performanceInfo.advance($s.Hudvisibility),this._renderEdges(Lt.TRANSPARENT,a),this.performanceInfo.advance($s.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(Sh.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Sh.Occluded,s.framebuffer),this.performanceInfo.advance($s.HudOccluded)),this.performanceInfo.advance($s.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges(Lt.OPAQUE),this.performanceInfo.advance($s.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance($s.Transparent),this._renderEdges(Lt.TRANSPARENT),this.performanceInfo.advance($s.TransparentEdges))),a&&this._renderLineCallouts(Sh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets(()=>{this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ee.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance($s.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot(Ee.LASERLINES_CONTRAST_CONTROL),this._bindParameters,No.PremultipliedAlpha),this.performanceInfo.advance($s.Laserline),this._renderOccluded(),this.performanceInfo.advance($s.Occluded);const h=r===Rw.ON&&this._magnifierHelper.enabled,p=h&&R(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const f=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,f)&&_(f)&&this._compositingHelper.composite(this._bindParameters,f,No.None),this.performanceInfo.advance($s.Antialiasing),this._renderHUD(Sh.NotOccluded,p),this.performanceInfo.advance($s.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance($s.Highlights),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,No.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===ks.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/Y0t;this._animationTimestep=Math.max(this._animationTimestep*aue+t*(1-aue),Q0t)}}readDepthPixels(e,t,i){const r=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=er.COLOR_BUFFER_BIT|er.DEPTH_BUFFER_BIT|er.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH)}r.readPixels(t[0],t[1],t[2],t[3],Ve.RGBA,Et.UNSIGNED_BYTE,i)}readHUDVisibility(e,t,i,r,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,i,r,Ve.RGBA,Et.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;_(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,No.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,PE.Highlight)),s.clear(),this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,PE.Default),this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(je.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=je.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(je.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return Uq;const t=k0t(e,this._content,this._stage.layers);return FE(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(Ee.INTEGRATED_MESH),this._renderSlot(Ee.OPAQUE_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.OPAQUE_MATERIAL),this._renderSlot(Ee.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL),this._renderSlot(Ee.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ee.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Ee.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Sh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Ee.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ee.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,No.PremultipliedAlpha)):e===Sh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(Sh.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Ee.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ee.HUD_MATERIAL),this._renderInternalSlot(Ee.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlight,r=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(je.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(er.DEPTH_BUFFER_BIT),this._renderHUDElements(Sh.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},r=this._renderContext.pass;this._renderContext.pass=je.MATERIAL_ALPHA,i(gt.Alpha),this._renderContext.pass=je.MATERIAL,i(gt.Color),i(gt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=gt.NONE,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===Dr.OccludeAndTransparentStencil&&(e|=o.renderOccluded,CA.push(o))});const t=this._offscreenRendering,i=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};CA.length!==0&&(this._renderInternalSlot(Ee.OCCLUDER_MATERIAL,CA),i(.5,Dr.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ee.TRANSPARENT_OCCLUDER_MATERIAL,CA),!1,!1),CA.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===Dr.OccludeAndTransparent||o.renderOccluded===Dr.Transparent||o.renderOccluded===Dr.Opaque)&&(e|=o.renderOccluded,EA.push(o))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>Dr.Occlude&&this._renderSlot(Ee.OCCLUDED_TERRAIN),this._renderInternalSlot(Ee.OPAQUE_MATERIAL,EA),this._renderInternalSlot(Ee.TRANSPARENT_MATERIAL,EA),this._renderInternalSlot(Ee.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,EA),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=je.MATERIAL,i(.5,Dr.OccludeAndTransparent,()=>s(Dr.OccludeAndTransparent),!0,Ml.OutlineVisualElementMask),i(.5,Dr.Transparent,()=>s(Dr.Transparent),!0,Ml.OutlineVisualElementMask),i(1,Dr.Opaque,()=>s(Dr.Opaque),!0,Ml.OutlineVisualElementMask),EA.length=0}_renderAntiAliasing(e,t){if(e===xb.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&_(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var r;this._ensureCameraBindParameters(e,t);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(r=i.depthTexture)!=null?r:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=hn:(_s(cue,this._bindParameters.camera.viewMatrix),_s(lue,this._bindParameters.camera.projectionMatrix),Hr(gT,cue,lue),Hr(gT,this._renderContext.lastFrameCamera.viewMatrix,gT),Hr(gT,this._renderContext.lastFrameCamera.projectionMatrix,gT),this._reprojectionMatrix=gT),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,_(t)?t.forEach(r=>{if(!r.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(r);_(s)&&(i=s.render(this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((r,s)=>{s.shouldRender(this._renderContext)&&r.render(this._renderContext.pass,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=Lbe(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((r=(i=this._highlight)==null?void 0:i.gpuMemoryUsage)!=null?r:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case rv.Color:return e._offscreenRendering.colorTexture;case rv.LinearDepth:return e._offscreenRendering.linearDepthTexture;case rv.Normals:return e._offscreenRendering.normalTexture;case rv.ShadowMap:return e._shadowMap.depthTexture;case rv.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case rv.Highlight:return e._offscreenRendering.highlightTexture}}}}};var rv;u([d()],cg.prototype,"_shadowAccumulator",void 0),u([d()],cg.prototype,"_smaaPass",void 0),u([d()],cg.prototype,"_antialiasing",void 0),u([d()],cg.prototype,"_edgeView",void 0),u([d()],cg.prototype,"updating",null),u([d()],cg.prototype,"isCameraFinal",null),cg=u([P("esri.views.3d.webgl-engine.lib.Renderer")],cg),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(rv||(rv={}));const EA=[],CA=[],lue=Ae(),cue=Ae(),gT=Ae();class uue{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Re.ONE,dstRGB:Re.ZERO,srcAlpha:Re.ONE,dstAlpha:Re.ZERO},this.blendEquation={mode:sy.ADD,modeAlpha:sy.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=hp.BACK,this.frontFace=uE.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=gr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:hp.FRONT_AND_BACK,func:gr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:hp.FRONT_AND_BACK,fail:os.KEEP,zFail:os.KEEP,zPass:os.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class T_t{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(i=>{var r;t.set(i,((r=t.get(i))!=null?r:0)+1)}),t.forEach((i,r)=>{const s=r.split(`
`);s.shift(),s.shift(),console.log(`${i}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const S_t={RECORD_ALLOCATIONS:!1};class E_t{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new T_t(S_t.RECORD_ALLOCATIONS);this._current.length<Tn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<Tn.COUNT;++t){const i=this._current[t];i>0&&console.log(`${Tn[t]}: ${i}`)}}this._allocations.print()}}const C_t=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var hue,pCe={exports:{}};(hue=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(pCe.exports=hue);const A_t=pCe.exports;var due,fCe={exports:{}};due=fCe,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(due.exports=t)}();const pue=fCe.exports;var mCe={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();i!==void 0&&(e.exports=i)})()})(mCe);const R_t=mCe.exports;var yd=999,fue=9999,I8=0,$8=1,mue=2,gue=3,yue=4,OL=5,M_t=6,O_t=7,P_t=8,vue=9,I_t=10,_ue=11,$_t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function L_t(){var e,t,i,r=0,s=0,n=yd,o=[],a=[],l=1,c=0,h=0,p=!1,f=!1,m="";return function(V){return a=[],V!==null?v(V.replace?V.replace(/\r\n/g,`
`):V):w()};function y(V){V.length&&a.push({type:$_t[n],data:V,position:h,line:l,column:c})}function v(V){var Q;for(r=0,i=(m+=V).length;e=m[r],r<i;){switch(Q=r,n){case I8:r=C();break;case $8:r=E();break;case mue:r=T();break;case gue:r=A();break;case yue:r=L();break;case _ue:r=D();break;case OL:r=z();break;case fue:r=B();break;case vue:r=S();break;case yd:r=b()}Q!==r&&(m[Q]===`
`?(c=0,++l):++c)}return s+=r,m=m.slice(r),a}function w(V){return o.length&&y(o.join("")),n=I_t,y("(eof)"),a}function b(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+r-1,n=I8,t=e,r+1):t==="/"&&e==="/"?(h=s+r-1,n=$8,t=e,r+1):e==="#"?(n=mue,h=s+r,r):/\s/.test(e)?(n=vue,h=s+r,r):(p=/\d/.test(e),f=/[^\w_]/.test(e),h=s+r,n=p?yue:f?gue:fue,r)}function S(){return/[^\s]/g.test(e)?(y(o.join("")),n=yd,r):(o.push(e),t=e,r+1)}function T(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,r+1):(y(o.join("")),n=yd,r)}function E(){return T()}function C(){return e==="/"&&t==="*"?(o.push(e),y(o.join("")),n=yd,r+1):(o.push(e),t=e,r+1)}function A(){if(t==="."&&/\d/.test(e))return n=OL,r;if(t==="/"&&e==="*")return n=I8,r;if(t==="/"&&e==="/")return n=$8,r;if(e==="."&&o.length){for(;I(o););return n=OL,r}if(e===";"||e===")"||e==="("){if(o.length)for(;I(o););return y(e),n=yd,r+1}var V=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||V){for(;I(o););return n=yd,r}return o.push(e),t=e,r+1}function I(V){for(var Q,Z,ce=0;;){if(Q=pue.indexOf(V.slice(0,V.length+ce).join("")),Z=pue[Q],Q===-1){if(ce--+V.length>0)continue;Z=V.slice(0,1).join("")}return y(Z),h+=Z.length,(o=o.slice(Z.length)).length}}function D(){return/[^a-fA-F0-9]/.test(e)?(y(o.join("")),n=yd,r):(o.push(e),t=e,r+1)}function L(){return e==="."||/[eE]/.test(e)?(o.push(e),n=OL,t=e,r+1):e==="x"&&o.length===1&&o[0]==="0"?(n=_ue,o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=yd,r):(o.push(e),t=e,r+1)}function z(){return e==="f"&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(y(o.join("")),n=yd,r):(o.push(e),t=e,r+1)}function B(){if(/[^\d\w_]/.test(e)){var V=o.join("");return n=A_t.indexOf(V)>-1?P_t:R_t.indexOf(V)>-1?O_t:M_t,y(o.join("")),n=yd,r}return o.push(e),t=e,r+1}}function D_t(e){var t=L_t(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function N_t(e){return D_t(e)}function F_t(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const L8=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function k_t(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function U_t(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function qR(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,qR(e,t,r+"_"+t[r],r);return i}function gCe(e,t,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:m.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const y=r(l,f);if(y===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,y)}c<p&&h===0&&(c=f)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function z_t(e,t,i,r="lowp"){gCe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function V_t(e,t,i,r,s="lowp"){gCe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function B_t(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&e.splice(i,r-i+1),s}function bue(e,t){const i=G_t();if(_(i))return i;const r=N_t(e);if(k_t(r,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":t===vu.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===vu.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===vu.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=qR(r,o,"fragColor"),z_t(r,s,"vec4")),c.data=s),t===vu.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=B_t(r,l+1),p=qR(r,o,"fragData");V_t(r,p,"vec4",h,"mediump"),c.data=p}else t===vu.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=qR(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if(C_t.includes(c.data)){if(t===vu.VERTEX_SHADER&&U_t(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=qR(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&L8.includes(h[1].trim())){const m=r[l+1];r.splice(l,m&&m.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&L8.includes(p[1].trim())&&(c.data="#if 1");const f=c.data.match(/\#ifndef\s+(.*)/);f&&f[1]&&L8.includes(f[1].trim())&&(c.data="#if 0")}}return j_t(e,F_t(r))}function G_t(e){return null}function j_t(e,t){return t}const H_t=4294967295;class q_t{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===pi.WEBGL2&&(i=bue(i,vu.VERTEX_SHADER),r=bue(r,vu.FRAGMENT_SHADER)),this._vShader=wue(this._context,vu.VERTEX_SHADER,i),this._fShader=wue(this._context,vu.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Tn.Shader,this),EO()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(_(this._glName))return this._glName;if(R(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),EO()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===pi.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const o=r.getUniformBlockIndex(i,s);o<H_t&&r.uniformBlockBinding(i,o,n)}}return this._glName=i,this._context.instanceCounter.increment(Tn.Program,this),i}get hasGLName(){return _(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Tn.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Tn.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){Yp(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){Yp(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){Yp(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){Yp(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){Yp(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){Yp(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){Yp(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(t,i){Yp(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){Yp(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){Yp(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}}function wue(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),EO()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===vu.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(W_t(i))),s}function W_t(e){let t=2;return e.replace(/\n/g,()=>`
`+X_t(t++)+":")}function X_t(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Yp(e,t,i){const r=e.get(t);return r?fW(r,i):(e.set(t,Array.from(i)),!0)}class Z_t{constructor(t){this._rctx=t,this._store=new rJ}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(_(n))return n.ref(),n;const o=new q_t(this._rctx,t,i,r,s);return o.ref(),this._store.set(t,i,o),o}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}function xue(e,t){const i=new Rr(e,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,width:1,height:1});function r(b,S){const T=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,E=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,C=e.programCache.acquire(T,E,new Map([["position",0]])),A=new Float32Array(6);GH(b,A,3);const I=new Float32Array(6);return GH(S,I,3),e.useProgram(C),C.setUniform3f("u_highA",A[0],A[2],A[4]),C.setUniform3f("u_lowA",A[1],A[3],A[5]),C.setUniform3f("u_highB",I[0],I[2],I[4]),C.setUniform3f("u_lowB",I[1],I[3],I[5]),C}const s=oi.createVertex(e,Ei.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new Hs(e,new Map([["position",0]]),{geometry:[new yo("position",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Ue(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Ue(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=r(o,a),c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays($t.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);i.readPixels(0,0,1,1,Ve.RGBA,Et.UNSIGNED_BYTE,y),l.dispose(),n.dispose(!1),s.dispose(),i.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c);const v=(o[2]-a[2])/25,w=VQ(y);return Math.abs(v-w)}var Tue,Sue,Eue,yCe={exports:{}};function Y_t(e){var y,v,w,b,S;if(!e.gl)return!1;if(e.type===pi.WEBGL1)return!(!((y=e.capabilities.textureFloat)==null?void 0:y.textureFloat)||!((v=e.capabilities.colorBufferFloat)==null?void 0:v.textureFloat));if(!(((w=e.capabilities.textureFloat)==null?void 0:w.textureFloat)&&((b=e.capabilities.colorBufferFloat)==null?void 0:b.textureFloat)&&((S=e.capabilities.colorBufferFloat)==null?void 0:S.floatBlend)))return!1;const t=new Rr(e,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:Ve.RGBA,dataType:Et.FLOAT,internalFormat:mt.RGBA32F,samplingMode:Ke.NEAREST,width:1,height:1}),i=oi.createVertex(e,Ei.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new Hs(e,new Map([["a_pos",0]]),{geometry:[new yo("a_pos",2,dt.UNSIGNED_SHORT,0,4)]},{geometry:i}),s=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,o=e.programCache.acquire(s,n,new Map([["a_pos",0]]));e.useProgram(o);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays($t.TRIANGLE_STRIP,0,4);const f=Bt({blending:lTe});e.setPipelineState(f),e.drawArrays($t.TRIANGLE_STRIP,0,4),yCe.exports.init(e);const m=e.gl.getError();return e.setViewport(l,c,h,p),e.bindFramebuffer(a),o.dispose(),r.dispose(!1),i.dispose(),t.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}Tue=yCe,Sue=function(){var e=function(v){window.console&&window.console.log&&window.console.log(v)},t=function(v){window.console&&window.console.error?window.console.error(v):e(v)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(v){if(r==null)for(var w in r={},s={},v)typeof v[w]=="number"&&(r[v[w]]=w,s[w]=v[w])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(v){return o(),r[v]!==void 0}function l(v){o();var w=r[v];return w!==void 0?"gl."+w:"/*UNKNOWN WebGL ENUM*/ 0x"+v.toString(16)}function c(v,w,b,S){var T;if((T=i[v])!==void 0&&(T=T[w])!==void 0&&T[b]){if(typeof T[b]=="object"&&T[b].enumBitwiseOr!==void 0){for(var E=T[b].enumBitwiseOr,C=0,A=[],I=0;I<E.length;++I){var D=s[E[I]];(S&D)!=0&&(C|=D,A.push(l(D)))}return C===S?A.join(" | "):l(S)}return l(S)}return S===null?"null":S===void 0?"undefined":S.toString()}function h(v,w){for(var b="",S=w.length,T=0;T<S;++T)b+=(T==0?"":", ")+c(v,S,T,w[T]);return b}function p(v,w,b){v.__defineGetter__(b,function(){return w[b]}),v.__defineSetter__(b,function(S){w[b]=S})}function f(v,w,b,S){S=S||v,n(v),w=w||function(D,L,z){for(var B="",V=z.length,Q=0;Q<V;++Q)B+=(Q==0?"":", ")+c(L,V,Q,z[Q]);t("WebGL error "+l(D)+" in "+L+"("+B+")")};var T={};function E(D,L){return function(){b&&b(L,arguments);var z=D[L].apply(D,arguments),B=S.getError();return B!=0&&(T[B]=!0,w(B,L,arguments)),z}}var C={};for(var A in v)if(typeof v[A]=="function")if(A!="getExtension")C[A]=E(v,A);else{var I=E(v,A);C[A]=function(){return f(I.apply(v,arguments),w,b,S)}}else p(C,v,A);return C.getError=function(){for(var D in T)if(T.hasOwnProperty(D)&&T[D])return T[D]=!1,D;return v.NO_ERROR},C}function m(v){var w=v.getParameter(v.MAX_VERTEX_ATTRIBS),b=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,b);for(var S=0;S<w;++S)v.disableVertexAttribArray(S),v.vertexAttribPointer(S,4,v.FLOAT,!1,0,0),v.vertexAttrib1f(S,0);v.deleteBuffer(b);var T=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(S=0;S<T;++S)v.activeTexture(v.TEXTURE0+S),v.bindTexture(v.TEXTURE_CUBE_MAP,null),v.bindTexture(v.TEXTURE_2D,null);for(v.activeTexture(v.TEXTURE0),v.useProgram(null),v.bindBuffer(v.ARRAY_BUFFER,null),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.disable(v.BLEND),v.disable(v.CULL_FACE),v.disable(v.DEPTH_TEST),v.disable(v.DITHER),v.disable(v.SCISSOR_TEST),v.blendColor(0,0,0,0),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.ONE,v.ZERO),v.clearColor(0,0,0,0),v.clearDepth(1),v.clearStencil(-1),v.colorMask(!0,!0,!0,!0),v.cullFace(v.BACK),v.depthFunc(v.LESS),v.depthMask(!0),v.depthRange(0,1),v.frontFace(v.CCW),v.hint(v.GENERATE_MIPMAP_HINT,v.DONT_CARE),v.lineWidth(1),v.pixelStorei(v.PACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_ALIGNMENT,4),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),v.UNPACK_COLORSPACE_CONVERSION_WEBGL&&v.pixelStorei(v.UNPACK_COLORSPACE_CONVERSION_WEBGL,v.BROWSER_DEFAULT_WEBGL),v.polygonOffset(0,0),v.sampleCoverage(1,!1),v.scissor(0,0,v.canvas.width,v.canvas.height),v.stencilFunc(v.ALWAYS,0,4294967295),v.stencilMask(4294967295),v.stencilOp(v.KEEP,v.KEEP,v.KEEP),v.viewport(0,0,v.canvas.width,v.canvas.height),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);v.getError(););}function y(v){var w,b,S=[],T=[],E={},C=1,A=!1,I=[],D=0,L=0,z=!1,B=0,V={};function Q(q){return typeof q=="function"?q:function(te){q.handleEvent(te)}}v.getContext=(b=v.getContext,function(){var q=b.apply(v,arguments);if(q instanceof WebGLRenderingContext){if(q!=w){if(w)throw"got different context";E=ee(w=q)}return E}return q});var Z=function(q){S.push(Q(q))},ce=function(q){T.push(Q(q))};function oe(q){var te=q.addEventListener;q.addEventListener=function(ge,Te,ke){switch(ge){case"webglcontextlost":Z(Te);break;case"webglcontextrestored":ce(Te);break;default:te.apply(q,arguments)}}}function $(){for(var q=Object.keys(V),te=0;te<q.length;++te)delete V[q]}function U(){++L,A||D==L&&v.loseContext()}function G(q,te){var ge=q[te];return function(){if(U(),!A)return ge.apply(q,arguments)}}function W(){for(var q=0;q<I.length;++q){var te=I[q];te instanceof WebGLBuffer?w.deleteBuffer(te):te instanceof WebGLFramebuffer?w.deleteFramebuffer(te):te instanceof WebGLProgram?w.deleteProgram(te):te instanceof WebGLRenderbuffer?w.deleteRenderbuffer(te):te instanceof WebGLShader?w.deleteShader(te):te instanceof WebGLTexture&&w.deleteTexture(te)}}function X(q){return{statusMessage:q,preventDefault:function(){z=!0}}}return oe(v),v.loseContext=function(){if(!A){for(A=!0,D=0,++C;w.getError(););$(),V[w.CONTEXT_LOST_WEBGL]=!0;var q=X("context lost"),te=S.slice();setTimeout(function(){for(var ge=0;ge<te.length;++ge)te[ge](q);B>=0&&setTimeout(function(){v.restoreContext()},B)},0)}},v.restoreContext=function(){A&&T.length&&setTimeout(function(){if(!z)throw"can not restore. webglcontestlost listener did not call event.preventDefault";W(),m(w),A=!1,L=0,z=!1;for(var q=T.slice(),te=X("context restored"),ge=0;ge<q.length;++ge)q[ge](te)},0)},v.loseContextInNCalls=function(q){if(A)throw"You can not ask a lost contet to be lost";D=L+q},v.getNumCalls=function(){return L},v.setRestoreTimeout=function(q){B=q},v;function ee(q){for(var te in q)typeof q[te]=="function"?E[te]=G(q,te):p(E,q,te);E.getError=function(){if(U(),!A)for(;Ce=w.getError();)V[Ce]=!0;for(var Ce in V)if(V[Ce])return delete V[Ce],Ce;return E.NO_ERROR};for(var ge=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Te=0;Te<ge.length;++Te){var ke=ge[Te];E[ke]=function(Ce){return function(){if(U(),A)return null;var Fe=Ce.apply(q,arguments);return Fe.__webglDebugContextLostId__=C,I.push(Fe),Fe}}(q[ke])}var _e=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Te=0;Te<_e.length;++Te)ke=_e[Te],E[ke]=function(Ce){return function(){return U(),A?null:Ce.apply(q,arguments)}}(E[ke]);var me=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Te=0;Te<me.length;++Te)ke=me[Te],E[ke]=function(Ce){return function(){return U(),!A&&Ce.apply(q,arguments)}}(E[ke]);return E.checkFramebufferStatus=function(Ce){return function(){return U(),A?E.FRAMEBUFFER_UNSUPPORTED:Ce.apply(q,arguments)}}(E.checkFramebufferStatus),E.getAttribLocation=function(Ce){return function(){return U(),A?-1:Ce.apply(q,arguments)}}(E.getAttribLocation),E.getVertexAttribOffset=function(Ce){return function(){return U(),A?0:Ce.apply(q,arguments)}}(E.getVertexAttribOffset),E.isContextLost=function(){return A},E}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:f,makeLostContextSimulatingCanvas:y,resetToInitialState:m}},(Eue=Sue())!==void 0&&(Tue.exports=Eue);const Q_t=fe.getLogger("esri.views.WebGLDriverTest");function J_t(e){const t=new Rr(e,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,width:1,height:1}),i=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,r=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=oi.createVertex(e,Ei.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Hs(e,new Map([["a_position",0]]),{geometry:[new yo("a_position",2,dt.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(i,r,new Map([["a_pos",0]]));e.useProgram(a);const l=new nt(e,{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:h,y:p,width:f,height:m}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays($t.TRIANGLE_STRIP,0,4),e.setViewport(h,p,f,m),t.readPixels(0,0,1,1,Ve.RGBA,Et.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const y=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return y&&Q_t.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),y}new yo("a_pos",2,dt.BYTE,0,2);new yo("a_pos",2,dt.BYTE,0,4),new yo("a_tex",2,dt.BYTE,2,4);const K_t={geometry:[new yo("a_pos",2,dt.UNSIGNED_SHORT,0,4)]};async function e1t(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new Rr(e,{colorTarget:ss.TEXTURE,depthStencilTarget:Mi.NONE},{target:ft.TEXTURE_2D,wrapMode:wt.CLAMP_TO_EDGE,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,samplingMode:Ke.NEAREST,width:1,height:1}),r=oi.createVertex(e,Ei.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Hs(e,new Map([["a_pos",0]]),K_t,{geometry:r}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new nt(e,{dataType:Et.UNSIGNED_BYTE,pixelFormat:Ve.RGBA,preMultiplyAlpha:!1,wrapMode:wt.CLAMP_TO_EDGE,samplingMode:Ke.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:h,y:p,width:f,height:m}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(er.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays($t.TRIANGLE_STRIP,0,4);const y=new Uint8Array(4);return i.readPixels(0,0,1,1,Ve.RGBA,Et.UNSIGNED_BYTE,y),a.dispose(),s.dispose(!1),r.dispose(),i.dispose(),l.dispose(),e.setViewport(h,p,f,m),e.bindFramebuffer(c),t.src="",y[0]===255}class t1t{constructor(t){this.context=t,this._floatBufferBlendWorking=Y_t(t),e1t(t).then(i=>this._svgAlwaysPremultipliesAlpha=!i)}get floatBufferBlendWorking(){if(R(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(R(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(R(this._doublePrecisionRequiresObfuscation)){const t=xue(this.context,!1),i=xue(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(i===0||t/i>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return R(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=J_t(this.context)),this._ignoresSamplerPrecision}}class Cue{constructor(t,i,r,s,n,o,a,l){this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}function i1t(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&zn(e)?new Cue(()=>e.createQuery(),r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>e.beginQuery(i.TIME_ELAPSED_EXT,r),()=>e.endQuery(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new Cue(()=>i.createQueryEXT(),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function r1t(e,t){if(t.disjointTimerQuery)return null;if(zn(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function s1t(e){if(zn(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function n1t(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function o1t(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function a1t(e,t){if(zn(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function l1t(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function c1t(e,t){if(zn(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function u1t(e,t){if(zn(e)){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function AA(e,t,i,r,s){if(r&&zn(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function h1t(e,t){if(!zn(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function d1t(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function p1t(e,t){if(zn(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class f1t{constructor(t,i){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=r1t(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=s1t(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=p1t(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=n1t(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=o1t(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=l1t(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=i1t(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=c1t(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=u1t(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=a1t(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=AA(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=AA(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=AA(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=AA(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=d1t(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=h1t(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=AA(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class m1t{constructor(t,i){this.gl=t,this.instanceCounter=new E_t,this.programCache=new Z_t(this),this._state=new uue,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=zn(t)?pi.WEBGL2:pi.WEBGL1,this._loadExtensions(),this.configure(i)}configure(t){this._capabilities=new f1t(this.gl,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new uue,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new YWe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new t1t(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(xt.ARRAY_BUFFER),this.unbindBuffer(xt.ELEMENT_ARRAY_BUFFER),zn(this.gl)&&(this.unbindBuffer(xt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(xt.PIXEL_PACK_BUFFER),this.unbindBuffer(xt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(xt.COPY_READ_BUFFER),this.unbindBuffer(xt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,wh()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,i){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,i,r,s){t===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,i,r,s),this._state.blendColor.r=t,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,i){t===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,i,r,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,i,r,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,i){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(t,i),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(t,i,r,s){this._state.colorMask.r===t&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(t,i,r,s),this._state.colorMask.r=t,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,i,r,s){this._state.clearColor.r===t&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(t,i,r,s),this._state.clearColor.r=t,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,i){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=i,this.gl.polygonOffset(t,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,i,r,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(t,i,r,s),this._state.scissorRect.x=t,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,i){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===i||(this.gl.depthRange(t,i),this._state.depthRange.zNear=t,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,i,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,i,r),this._state.stencilFunction.face=hp.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,i,r,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,i,r,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,i,r){this._state.stencilOperation.face===hp.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,i,r),this._state.stencilOperation.face=hp.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,i,r,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,i,r,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,i=!1){const r=this._state.activeTexture;return t>=0&&(i||t!==this._state.activeTexture)&&(this.gl.activeTexture(wV+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,i=255){t&&(t&er.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&er.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&er.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(t))}drawArrays(t,i,r){if(wh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Aue(t,r)),this.gl.drawArrays(t,i,r),wh()){const s=Gse(this);s&&console.error("drawArrays:",s)}}drawElements(t,i,r,s){var n;if(wh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Aue(t,i)),this.gl.drawElements(t,i,r,s),wh()){const o=Gse(this);if(o){const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c=a==null?void 0:a.vertexBuffers,h={indexBuffer:l,vertexBuffers:c},p={mode:t,count:i,type:r,offset:s},f=(n=rn(l,v=>v.size))!=null?n:0,m=s+i,y=f<m?`. Buffer is too small. Attempted to draw index ${m} of ${f}`:"";console.error(`drawElements: ${o}${y}`,{args:p,vao:h})}}}logInfo(){wh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){wh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===i&&n.width===r&&n.height===s||(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var i,r;this._state.program!==t&&((i=this._state.program)==null||i.stop(),this._state.program=t,this.gl.useProgram((r=t==null?void 0:t.glName)!=null?r:null))}bindTexture(t,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return R(t)||t.glName==null?(_(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==t?(this.setActiveTexture(i,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[i]=t,s):(t.isDirty&&(this.setActiveTexture(i,r),t.applyChanges()),s)}unbindTexture(t){if(!R(t))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===t&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(t,i=!1){if(i||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(R(t))return this.gl.bindFramebuffer(Fn.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(Fn.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,i,r=!1){const s=i===Fn.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==t)&&(R(t)?this.gl.bindFramebuffer(i,null):t.initializeAndBind(i),s?this._state.readFramebuffer=vt(t,null):this._state.drawFramebuffer=vt(t,null))}blitFramebuffer(t,i,r=0,s=0,n=t.width,o=t.height,a=0,l=0,c=i.width,h=i.height,p=er.COLOR_BUFFER_BIT,f=Ke.NEAREST){this.bindFramebufferSeparate(t,Fn.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Fn.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,p,f)}bindBuffer(t,i){if(t)switch(i!=null||(i=t.bufferType),i){case xt.ARRAY_BUFFER:this._state.vertexBuffer=Hl(this.gl,t,i,this._state.vertexBuffer);break;case xt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Hl(this.gl,t,i,this._state.indexBuffer);break;case xt.UNIFORM_BUFFER:this._state.uniformBuffer=Hl(this.gl,t,i,this._state.uniformBuffer);break;case xt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Hl(this.gl,t,i,this._state.pixelPackBuffer);break;case xt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Hl(this.gl,t,i,this._state.pixelUnpackBuffer);break;case xt.COPY_READ_BUFFER:this._state.copyReadBuffer=Hl(this.gl,t,i,this._state.copyReadBuffer);break;case xt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Hl(this.gl,t,i,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const i=this.gl;t||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(i.bindRenderbuffer(i.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return R(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(t,i,r){const s=this._getBufferBinding(t,i);R(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(t,i,r,s,n){const o=this._getBufferBinding(t,i);if(!R(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(t,i,r,s){R(i)?this.bindBufferBase(xt.UNIFORM_BUFFER,t,null):(wh()&&(s!=null?s:i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(xt.UNIFORM_BUFFER,t,i.buffer,r,s):this.bindBufferBase(xt.UNIFORM_BUFFER,t,i.buffer))}unbindUBO(t){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];_(s)&&s.buffer===t.buffer&&this.bindBufferBase(xt.UNIFORM_BUFFER,i,null)}}unbindBuffer(t){switch(t){case xt.ARRAY_BUFFER:this._state.vertexBuffer=Hl(this.gl,null,t,this._state.vertexBuffer);break;case xt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Hl(this.gl,null,t,this._state.indexBuffer);break;case xt.UNIFORM_BUFFER:this._state.uniformBuffer=Hl(this.gl,null,t,this._state.uniformBuffer);break;case xt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Hl(this.gl,null,t,this._state.pixelPackBuffer);break;case xt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Hl(this.gl,null,t,this._state.pixelUnpackBuffer);break;case xt.COPY_READ_BUFFER:this._state.copyReadBuffer=Hl(this.gl,null,t,this._state.copyReadBuffer);break;case xt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Hl(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){R(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const i=this.gl,r=i.fenceSync(LH.SYNC_GPU_COMMANDS_COMPLETE,0);let s;this.instanceCounter.increment(Tn.Sync,r),i.flush();do await P2(t),s=i.clientWaitSync(r,0,0);while(s===g4.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Tn.Sync,r),i.deleteSync(r),s===g4.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=Fn.FRAMEBUFFER){return t===Fn.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(xt.ARRAY_BUFFER),this.unbindBuffer(xt.ELEMENT_ARRAY_BUFFER),zn(this.gl)&&(this.unbindBuffer(xt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(xt.PIXEL_PACK_BUFFER),this.unbindBuffer(xt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(xt.COPY_READ_BUFFER),this.unbindBuffer(xt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(Re.ONE,Re.ZERO),this.setBlendEquation(sy.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(hp.BACK),this.setFrontFace(uE.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(gr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(gr.ALWAYS,0,0),this.setStencilOp(os.KEEP,os.KEEP,os.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n,o,a,l;const t=this.gl,i=this.capabilities.vao;i&&i.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)t.disableVertexAttribArray(c);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(xt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(xt.ELEMENT_ARRAY_BUFFER,null),zn(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(xt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const h=this._state.uniformBufferBindingPoints[c];if(_(h)){const{buffer:p,offset:f,size:m}=h;p!==null?f===0&&m===0?t.bindBufferBase(xt.UNIFORM_BUFFER,c,p.glName):t.bindBufferRange(xt.UNIFORM_BUFFER,c,p.glName,f,m):t.bindBufferBase(xt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(xt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(xt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(xt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(xt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(Fn.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(Fn.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(au.COLOR_ATTACHMENT0)),t.bindFramebuffer(Fn.DRAW_FRAMEBUFFER,(s=(r=this._state.drawFramebuffer)==null?void 0:r.glName)!=null?s:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(Fn.FRAMEBUFFER,(o=(n=this._state.drawFramebuffer)==null?void 0:n.glName)!=null?o:null);if(i&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}t.useProgram((l=(a=this._state.program)==null?void 0:a.glName)!=null?l:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){t.activeTexture(wV+c),t.bindTexture(ft.TEXTURE_2D,null),t.bindTexture(ft.TEXTURE_CUBE_MAP,null),zn(t)&&(t.bindTexture(ft.TEXTURE_3D,null),t.bindTexture(ft.TEXTURE_2D_ARRAY,null));const h=this._state.textureUnitMap[c];_(h)&&t.bindTexture(h.descriptor.target,h.glName)}t.activeTexture(wV+this._state.activeTexture),t.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===pi.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var a;const i=this.capabilities.textureFilterAnisotropic,r=(a=t.maxAnisotropy)!=null?a:1/0,s=zn(this.gl),n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return nt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}}function Hl(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function Aue(e,t){switch(e){case $t.POINTS:return 2*t;case $t.TRIANGLES:return t/3;case $t.TRIANGLE_STRIP:case $t.TRIANGLE_FAN:return t-2;default:return 0}}class g1t extends m1t{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,i,r,s){this.useProgram(t.program);const n=_(r)?r.slot:null;return t.bindPipelineState(this,n,s),_(i)&&_(r)&&t.bindPass(i,r),t.program}get test(){return this.programCache.test}}const vCe=fe.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let uS=class extends Se{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new as,this._frameTask=e.resourceController.scheduler.registerTask(yt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(Mp.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return R(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(mP,new aJ)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),vt(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",ks.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(R(t))return pt(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new y1t(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),_(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,Jr(a)||vCe.error(a),null);return Vu(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",ks.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([d()],uS.prototype,"_loadingCount",void 0),u([d()],uS.prototype,"_frameTask",void 0),u([d()],uS.prototype,"updating",null),uS=u([P("esri.views.3d.webgl-engine.lib.TextureRepository")],uS);class y1t{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(vCe.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const v1t=fe.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let WR=class extends Se{constructor(){super(...arguments),this._data=new Array,this._state=lc.NOT_LOADED}dispose(){this._state=lc.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===lc.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[xi("esri/images/materials/water/normals.jpg"),xi("esri/images/materials/water/perturbation.jpg")];this._state=lc.LOADING,Promise.all(t.map(i=>Ap(i))).then(i=>{i.forEach(r=>this._data.push(new nt(e,{target:ft.TEXTURE_2D,pixelFormat:Ve.RGBA,dataType:Et.UNSIGNED_BYTE,wrapMode:wt.REPEAT,samplingMode:Ke.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:r.width,height:r.height},r))),this._state=lc.LOADED}).catch(i=>{v1t.error("Failed to load textures for water material.",i),this._state=lc.NOT_LOADED})}bind(e){this._state===lc.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};u([d()],WR.prototype,"_state",void 0),u([d({type:Boolean,readOnly:!0})],WR.prototype,"updating",null),WR=u([P("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],WR);class _1t extends LU{constructor(t,i,r,s,n,o){super(),this._rctx=t,this._renderScene=i,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(ks.BACKGROUND);const i=xp();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const r=ye(F({},i.settings),{pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio}),s=this._renderScreenshot(t,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){if(R(this._renderOverlay))return i;t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(t,i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=$B(r,s,a);this._rctx.gl.readPixels(0,0,r,s,Ve.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,ye(F({},t),{region:null}));const c=$B(n.width,n.height,a);return wat(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=$B(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,Ve.RGBA,dt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i){let r=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:o}=i;let a=!1;const l=i.disableDecorations&&t.frameHasDecorations,c=n!==s.fullWidth||o!==s.fullHeight,h=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,p=c||l||h;if(p){const y=s.clone();if(i.ignorePadding){const b=hk(y.padding);for(let S=0;S<4;S++)b[S]=Math.round(b[S]/y.pixelRatio*i.pixelRatio);y.padding=b}y.fullWidth=n,y.fullHeight=o,y.pixelRatio=i.pixelRatio;const v=s.fovX-y.fovX,w=s.fovY-y.fovY;v<0&&v<w?y.fovX=s.fovX:w<0&&w<v&&(y.fovY=s.fovY),this._forceCameraHook(y),a=!0,r=new Rr(this._rctx,{width:y.fullWidth,height:y.fullHeight,colorTarget:ss.TEXTURE,depthStencilTarget:Mi.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(r,y,i.disableDecorations?Rw.OFF:Rw.ON),this._disposeOffscreenBuffers()}const f=()=>{this._rctx.bindFramebuffer(null),Ze(r)},m=this._readbackScreenshot(i,f);if(f(),p&&!this._rctx.contextAttributes.alpha)for(let y=3;y<m.data.length;y+=4)m.data[y]=255;return a&&this._forceCameraHook(s),m}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const Rue=fe.getLogger("esri.views.3d.webgl-engine.parts.View");let Oo=class extends $U(Se){constructor(e){super({}),this.events=new as,this.waterTextureRepository=new WR,this._magnifierHelper=new cS,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),ie(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),Rt),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new TSe(this._rctx),this._shaderTechniqueRepository=new qTe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new uS(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new WTe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new I0t(this._rctx,this._shaderTechniqueRepository),this._renderer=new cg(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new _1t(this._rctx,(t,i,r)=>this._renderer.render(t,i,i,r),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=cn(this._frameTask),this._shaderTechniqueRepository=Ze(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=ks.UPDATE){e===ks.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,i,r,s){this._renderer.readHUDVisibility(e,t,i,r,s)}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=F0t(4*c,a,r.nearFar);l>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(l=h)}if(_(e)){const c=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);_(c)&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(R(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){Q2e(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=ks.BACKGROUND,n=!1;const o={preRender:a=>{r=this.updating,s=this._needsUpdate?ks.UPDATE:ks.BACKGROUND,e.processSyncLayers();const l=a.time-this._lastAnimationUpdate;(l>this.animationTimestep||_(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(ks.BACKGROUND),this._lastAnimationUpdate=a.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,Rw.ON),n=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(ks.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=uw(o)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},r=QWe("3d",this._canvas,i);if(R(r)){const n=he("esri-force-webgl");Rue.error(n)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&Rue.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&he("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new g1t(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return R(this._componentObjectCollection)&&(this._componentObjectCollection=new R0t(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([d({type:Boolean,readOnly:!0})],Oo.prototype,"updating",null),u([Io()],Oo.prototype,"_rctx",void 0),u([Io()],Oo.prototype,"_container",void 0),u([Io()],Oo.prototype,"_canvas",void 0),u([Io()],Oo.prototype,"_stippleTextureRepository",void 0),u([Io(),d()],Oo.prototype,"waterTextureRepository",void 0),u([Io(),d()],Oo.prototype,"_magnifierHelper",void 0),u([Io(),d()],Oo.prototype,"_textureRepository",void 0),u([Io()],Oo.prototype,"_compositingHelper",void 0),u([Io()],Oo.prototype,"_renderer",void 0),u([Io()],Oo.prototype,"_screenshotManager",void 0),u([Io()],Oo.prototype,"componentObjectCollection",null),u([Io()],Oo.prototype,"_componentObjectCollection",void 0),u([d()],Oo.prototype,"_needsUpdate",void 0),u([d()],Oo.prototype,"_needsWaterReflectionUpdate",void 0),Oo=u([P("esri.views.3d.webgl-engine.parts.RenderView")],Oo);var kN;let hl=kN=class extends $U(Se){constructor(e){super(e),this._handles=new Nt,this._model=new PN,this._layers=new Wt,this._changeSet=new oSe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Oo(this)),this._frameTask=this.resourceController.scheduler.registerTask(yt.STAGE,this),this._handles.add(this._frameTask)}destroy(){zw.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),H4(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){R(e)||(this.renderView.requestRender(),this._model.remove(e),H4(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){_(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){_(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){R(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>R(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;kN.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),kN.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===hE.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{Ple(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(Vu(r))return r.then(s);s()}removeRenderPlugin(e){Ple(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};hl.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([d({constructOnly:!0})],hl.prototype,"resourceController",void 0),u([d({constructOnly:!0})],hl.prototype,"options",void 0),u([d({constructOnly:!0})],hl.prototype,"state",void 0),u([d({constructOnly:!0})],hl.prototype,"sceneIntersectionHelper",void 0),u([d({readOnly:!0})],hl.prototype,"viewingMode",null),u([d({constructOnly:!0})],hl.prototype,"container",void 0),u([d({constructOnly:!0})],hl.prototype,"renderSR",void 0),u([d({constructOnly:!0})],hl.prototype,"_handles",void 0),u([d({readOnly:!0})],hl.prototype,"updating",null),u([d({constructOnly:!0})],hl.prototype,"_model",void 0),u([Io(),d()],hl.prototype,"renderView",void 0),hl=kN=u([P("esri.views.3d.webgl-engine.Stage")],hl);function _Ce(e){return _m(e)&&e.intersector===Vr.PCL&&!!e.target}function Rz(e){return _m(e)&&e.intersector===Vr.I3S&&!!e.target}function b1t(e){return _m(e)&&e.intersector===Vr.TERRAIN&&!!e.target}function bCe(e){return _m(e)&&e.intersector===Vr.OVERLAY&&!!e.target}function JJ(e){return _m(e)&&e.intersector===Vr.LOD&&!!e.target}function Mue(e,t){var i;return uU(e)||hU(e)?y3(e.target.object.metadata,t):b1t(e)?(i=t.map)==null?void 0:i.ground:_Ce(e)||Rz(e)||bCe(e)?y3(e.target,t):null}function UCt(e,t){const i=Qq(e,t);return _(i)&&i.type==="graphic"?i.graphic:null}function Qq(e,t){if(R(e))return null;if(uU(e)||hU(e))return Oue(e.target.object.metadata,t);if(_Ce(e)){const i=e.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return bCe(e)||JJ(e)?Oue(e.target,t):Rz(e)?w1t(e.target,t):null}function Oue(e,t){if(R(e)||R(e.graphicUid))return null;const i=y3(e,t);if(R(i))return null;if(i===t.graphics)return R(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||R(e.graphicUid)?null:"getHit"in r?r.getHit(e.graphicUid):null}function w1t(e,t){const i=y3(e,t);if(R(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?T1t(r.getGraphicFromIntersectorTarget(e)):null}function x1t(e,t){const i=y3(e,t);if(R(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}function T1t(e){return _(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function y3(e,t){return R(e.layerUid)?null:_(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function zCt(e,t){if(uU(e)||hU(e))return Fg(e.target.object.boundingVolumeWorldSpace.bounds);if(JJ(e)){jme(PL,e.transformation);const i=Math.max(PL[0],PL[1],PL[2]);return e.target.baseBoundingSphere.radius*i}return Rz(e)?rn(x1t(e.target,t),i=>.5*Fpe(i)):null}function VCt(e){return!uU(e)&&!hU(e)&&(JJ(e)?e.target.numLodLevels>1:!!Rz(e))}const PL=O();async function S1t(e,t){if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t);if(i.results.length===0)return i;const r=i.results[0],s=_(r.distance)?r.distance*(1+E1t):r.distance,n=i.results.findIndex(o=>o.distance>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const E1t=.05;let D8,N8;function C1t(e){const t=Obe(e);for(;t.length>1;){const i=Pue(t.shift());if(i.available)return i}return Pue(t.shift())}function Pue(e){switch(e){case pi.WEBGL1:return A1t();case pi.WEBGL2:return R1t()}}function A1t(){return D8||(D8=P1t()),D8}function R1t(){return N8||(N8=I1t()),N8}class wCe{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class M1t extends wCe{constructor(){super(...arguments),this.type=pi.WEBGL1}}class O1t extends wCe{constructor(){super(...arguments),this.type=pi.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function xCe(e,t){var n;if(e===pi.WEBGL1&&typeof WebGLRenderingContext===void 0||e===pi.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const i=document.createElement("canvas");if(!i)return null;let r=y4(i,e,{failIfMajorPerformanceCaveat:!0});if(R(r)&&(r=y4(i,e),_(r)&&(t.majorPerformanceCaveat=!0)),R(r))return r;if(e===pi.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function P1t(){const e=new M1t,t=xCe(pi.WEBGL1,e);return R(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function I1t(){const e=new O1t,t=xCe(pi.WEBGL2,e);return R(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function $1t(e){const t=C1t(e);if(!t.available)return new j("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new j("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new j("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new j("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===pi.WEBGL1){if(!t.supportsElementIndexUint)return new j("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new j("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new j("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function L1t(e){return e&&"nodeType"in e}function D1t(e){return e&&typeof e.render=="function"}const Iue={component:"esri-component"};let nb=class extends Se{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Iue.component),t&&t.classList.remove(Iue.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||L1t(e)?(this._set("widget",null),sk(e)):(D1t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([d({dependsOn:[]})],nb.prototype,"id",null),u([d()],nb.prototype,"node",null),u([qt("node")],nb.prototype,"castNode",null),u([d({readOnly:!0})],nb.prototype,"widget",void 0),nb=u([P("esri.views.ui.Component")],nb);const UN=nb,N1t={left:0,top:0,bottom:0,right:0},TCe={bottom:30,top:15,right:15,left:15},F8="manual",sl={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function F1t(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function k8(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function U8(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let ug=class extends as.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Nt,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&U8(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&U8(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([ie(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,Rt),ie(()=>this.padding,this._applyUIPadding,Rt)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(sl.ui),fUe(e),this._attachContainers(e)),t&&(t.classList.remove(sl.ui),U8(t,{top:"",bottom:"",left:"",right:""}),Ome(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:F(F({},TCe),e)}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=k8(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||F8)===F8?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(sl.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=k8(e)||k8(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof UN||(e=new UN({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof UN?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||N1t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(sl.innerContainer),e.classList.add(sl.cornerContainer);const t=document.createElement("div");t.classList.add(sl.innerContainer),t.classList.add(sl.manualContainer);const i=document.createElement("div");i.classList.add(sl.topLeft),i.classList.add(sl.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(sl.topRight),r.classList.add(sl.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(sl.bottomLeft),s.classList.add(sl.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(sl.bottomRight),n.classList.add(sl.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=cp();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup=F({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||F8,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(F1t(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?Uee(t.node,s.firstChild):s.appendChild(t.node));r>=o.length?s.appendChild(t.node):Uee(t.node,o[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};u([d()],ug.prototype,"container",null),u([d()],ug.prototype,"height",null),u([d({value:TCe})],ug.prototype,"padding",null),u([qt("padding")],ug.prototype,"castPadding",null),u([d()],ug.prototype,"view",void 0),u([d()],ug.prototype,"width",null),ug=u([P("esri.views.ui.UI")],ug);const k1t=ug;function $ue(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function U1t(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function IL(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function z1t(e){return e.type==="bing-maps"}const a0=[];let hS=class extends q2{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new ut,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>ie(()=>{var s;return[r.suspended,(s=r.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.handles.add([ns(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),jo(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");a0.length=0,e?(e.forEach(t=>{var s;if(t.suspended||!((s=t.layer)==null?void 0:s.attributionVisible))return;const i=t.layer;if($ue(i,"user"))return void IL(a0,t,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(t)){const n=this._fetchedAttributionData.get(t);return void(n?IL(a0,t,this._getDynamicAttribution(n,this.view,i)):$ue(i)&&IL(a0,t,i.copyright))}return void this._fetchAttributionData(t)}const r=i.get("portalItem.accessInformation");IL(a0,t,r||i.copyright)}),U1t(this.items,a0)&&(this.items.removeAll(),this.items.addMany(a0)),a0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await ku(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,z1t(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:et.WGS84},f={extent:Dg(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let m=c;m<=h;m++)r[m]=r[m]||[],r[m].push(f)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||n==null||n<=-1)return"";const o=e[n],a=Qw(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const h=!l[c.id]&&a&&LW(c.extent,a);return h&&(l[c.id]=!0),h}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([d({readOnly:!0,type:ut})],hS.prototype,"items",void 0),u([d({readOnly:!0})],hS.prototype,"state",null),u([d()],hS.prototype,"view",void 0),hS=u([P("esri.widgets.Attribution.AttributionViewModel")],hS);const SCe=hS,l0={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let dl=class extends Wn{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.iconClass=l0.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new SCe}initialize(){this.own(ns(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[l0.open]:this._isOpen};return k("div",{bind:this,class:this.classes(l0.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return k("div",{class:l0.poweredBy},"Powered by"," ",k("a",{class:l0.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s={[l0.sourcesOpen]:e,[l0.interactive]:t};return k("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(l0.sources,s),innerHTML:r,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([d()],dl.prototype,"_isOpen",void 0),u([d()],dl.prototype,"_isInteractive",null),u([d()],dl.prototype,"_attributionTextOverflowed",void 0),u([d()],dl.prototype,"_prevSourceNodeHeight",void 0),u([d({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],dl.prototype,"attributionText",null),u([d()],dl.prototype,"iconClass",void 0),u([d()],dl.prototype,"itemDelimiter",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],dl.prototype,"label",void 0),u([d(),dn("esri/widgets/Attribution/t9n/Attribution")],dl.prototype,"messages",void 0),u([Xe("viewModel.view")],dl.prototype,"view",void 0),u([d({type:SCe})],dl.prototype,"viewModel",void 0),u([gl()],dl.prototype,"_toggleState",null),dl=u([P("esri.widgets.Attribution")],dl);const V1t=dl,B1t="esri.widgets.CompassViewModel";let ob=class extends IY(Se){constructor(e){super(e),this._handles=new Nt,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(ie(()=>this.view,this._updateRotationWatcher,Rt))}destroy(){this._handles=cn(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?ie(()=>e==null?void 0:e.rotation,this._updateForRotation,Rt):ie(()=>e==null?void 0:e.camera,this._updateForCamera,Rt))}};u([d({readOnly:!0})],ob.prototype,"canShowNorth",null),u([d()],ob.prototype,"orientation",void 0),u([d({readOnly:!0})],ob.prototype,"state",null),u([d()],ob.prototype,"view",void 0),ob=u([P(B1t)],ob);const ECe=ob,c0={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let _f=class extends Wn{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=c0.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new ECe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[c0.disabled]:i,[c0.interactive]:!i},o={[c0.northIcon]:r,[c0.rotationIcon]:!r},{messages:a}=this;return k("div",{bind:this,class:this.classes(c0.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},k("span",{"aria-hidden":"true",class:this.classes(c0.icon,o),styles:this._toRotationTransform(e)}),k("span",{class:c0.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([Xe("viewModel.goToOverride")],_f.prototype,"goToOverride",void 0),u([d()],_f.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],_f.prototype,"label",void 0),u([d(),dn("esri/widgets/Compass/t9n/Compass")],_f.prototype,"messages",void 0),u([Xe("viewModel.view")],_f.prototype,"view",void 0),u([d({type:ECe})],_f.prototype,"viewModel",void 0),u([gl()],_f.prototype,"_reset",null),_f=u([P("esri.widgets.Compass")],_f);const G1t=_f;let dS=class extends Se{constructor(e){super(e),this._handles=new Nt,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(jo(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([d({readOnly:!0})],dS.prototype,"state",null),u([d()],dS.prototype,"navigationMode",void 0),u([d()],dS.prototype,"view",void 0),dS=u([P("esri.widgets.NavigationToggleViewModel")],dS);const CCe=dS,sh={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let bf=class extends Wn{constructor(e,t){super(e,t),this.iconClass=sh.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new CCe}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[sh.disabled]:e,[sh.isLayoutHorizontal]:this.layout==="horizontal"},r={[sh.activeButton]:t},s={[sh.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return k("div",{bind:this,class:this.classes(sh.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},k("div",{class:this.classes(sh.button,sh.panButton,r)},k("span",{class:sh.panIcon})),k("div",{class:this.classes(sh.button,sh.rotateButton,s)},k("span",{class:sh.rotationIcon})))}_toggle(){this.toggle()}};u([d()],bf.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],bf.prototype,"label",void 0),u([d({value:"vertical"})],bf.prototype,"layout",null),u([d(),dn("esri/widgets/NavigationToggle/t9n/NavigationToggle")],bf.prototype,"messages",void 0),u([Xe("viewModel.view")],bf.prototype,"view",void 0),u([d({type:CCe})],bf.prototype,"viewModel",void 0),u([gl()],bf.prototype,"_toggle",null),bf=u([P("esri.widgets.NavigationToggle")],bf);const j1t=bf,RA={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let V0=class extends Wn{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[RA.disabled]:!this.enabled,[RA.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return k("div",{bind:this,class:this.classes(RA.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},k("span",{"aria-hidden":"true",role:"presentation",class:this.classes(RA.icon,i)}),k("span",{class:RA.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([d()],V0.prototype,"action",void 0),u([d()],V0.prototype,"enabled",void 0),u([d()],V0.prototype,"iconClass",void 0),u([d()],V0.prototype,"title",void 0),u([gl()],V0.prototype,"_triggerAction",null),V0=u([P("esri.widgets.IconButton")],V0);const Lue=V0;let pS=class extends Se{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([d({readOnly:!0})],pS.prototype,"canZoomIn",null),u([d({readOnly:!0})],pS.prototype,"canZoomOut",null),u([d()],pS.prototype,"view",void 0),pS=u([P("esri.widgets.Zoom.ZoomConditions2D")],pS);const H1t=pS;let fS=class extends Se{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};u([d({readOnly:!0})],fS.prototype,"canZoomIn",null),u([d({readOnly:!0})],fS.prototype,"canZoomOut",null),u([d()],fS.prototype,"view",void 0),fS=u([P("esri.widgets.Zoom.ZoomConditions3D")],fS);const q1t=fS;let B0=class extends Se{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new H1t({view:e}):e.type==="3d"&&(this._zoomConditions=new q1t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():o9(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():o9(e.goTo({zoomFactor:.5}))}};u([d()],B0.prototype,"_zoomConditions",void 0),u([d({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],B0.prototype,"canZoomIn",void 0),u([d({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],B0.prototype,"canZoomOut",void 0),u([d({readOnly:!0})],B0.prototype,"state",null),u([d()],B0.prototype,"view",null),B0=u([P("esri.widgets.Zoom.ZoomViewModel")],B0);const ACe=B0,MA={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let hg=class extends Wn{constructor(e,t){super(e,t),this.iconClass=MA.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new ACe}initialize(){this._zoomInButton=new Lue({action:this.zoomIn.bind(this),iconClass:MA.zoomInIcon}),this._zoomOutButton=new Lue({action:this.zoomOut.bind(this),iconClass:MA.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[MA.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,k("div",{class:this.classes(MA.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([d()],hg.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],hg.prototype,"label",void 0),u([d({value:"vertical"})],hg.prototype,"layout",null),u([d(),dn("esri/widgets/Zoom/t9n/Zoom")],hg.prototype,"messages",void 0),u([Xe("viewModel.view")],hg.prototype,"view",void 0),u([d({type:ACe})],hg.prototype,"viewModel",void 0),hg=u([P("esri.widgets.Zoom")],hg);const W1t=hg,RCe="esri.views.ui.DefaultUI";function X1t(e){return e&&e.view!==void 0}fe.getLogger(RCe);let zN=class extends k1t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([ie(()=>this.components,this._componentsWatcher.bind(this),Rt),ie(()=>this.view,this._updateViewAwareWidgets.bind(this),Rt)])}_add(e,t,i,r){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;X1t(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new UN({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new V1t({view:this.view})}_createCompass(){return new G1t({view:this.view})}_createNavigationToggle(){return new j1t({view:this.view})}_createZoom(){return new W1t({view:this.view})}};u([d()],zN.prototype,"components",void 0),zN=u([P(RCe)],zN);const Z1t=zN;let VN=class extends Z1t{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([d()],VN.prototype,"components",void 0),VN=u([P("esri.views.ui.3d.DefaultUI3D")],VN);const MCe=VN,qc=fe.getLogger("esri.views.SceneView");let rt=class extends BFe(wHe(NHe(Iqe))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new ry({slicePlane:Zge},this),this._resourceController=Xdt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new nq({view:this}),this.labeler=new Q1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new K2,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new wb,this.environmentManager=new Dd,this.extent=null,this.floors=new ut,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Dqe({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new zht,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new MCe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new Tq,this.voxelWasm=null,this.voxelWasmPromise=null,ADe(),e&&e.environment||(this._defaults.environment=new tS,this.environment=this._defaults.environment);const t=(i=null)=>{_(i)&&i.type===Yi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([ns(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),ie(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new qet({view:this}),this.stateManager=new ddt({view:this})}initialize(){this.groundView=new DHe({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(ns(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},Rt),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},Rt),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>LMe(t>0?1e3/Math.ceil(t):0),Rt),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,Us),this.updatingHandles.add(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),Us),this.handles.add(ie(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),qi))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=lt(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=lt(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=lt(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||R(e)?(this._clippingArea=null,null):e instanceof ai?this.spatialReference&&(e=$L(e,this.spatialReference),R(e))?(qc.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),R(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(qc.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&_(e)?qc.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===Ge.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return R(t)||R(e)||t.spatialReference.equals(e)?t:$L(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||et.WGS84,i=$L(this.clippingArea,t);_(i)&&(e=_(e)?e.intersection(i):i);const r=this._get("dataExtent");return _(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||et.WGS84;let t;const i=n=>{const o=$L(n,e);R(o)||(_(t)?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r==null?void 0:r.spatialReference){const n=r.groundExtent;i(new ai({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!_(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(R(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof tS?e:e instanceof hbe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):tS.fromWebsceneEnvironment(e):Bs(tS,e):new tS}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||_(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(R(this.state)||this.state.stationary)}set qualityProfile(e){TN.isValidProfile(e)&&(TN.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||TN.getDefaultProfile()}set slicePlane(e){if(_(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),R(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");lx(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?hye(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?ox.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var r,s,n;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(t=!0,o.suspended||c3(o))return;++i,e+=o.updatingProgress}}else++i});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])_(o)&&o.updating&&(i+=.1,e+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])_(o)&&o.updating&&(++i,e+=o.updatingProgress);if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((r=this.inputManager)==null?void 0:r.hasPendingInputs)||((n=(s=this.map)==null?void 0:s.allLayers)==null?void 0:n.some(o=>!o.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const o=performance.now();if(e<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?o:0}return t}get viewingMode(){var i;const e=this._predeterminedViewingMode;if(_(e))return mV(e);const t=this.spatialReference;return t?_((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?mV(this.defaultsFromMap.viewingMode):L4(t,Ge.Global)?"global":"local":"global"}set viewingMode(e){this.ready?qc.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new ypt(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return qc.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=_(i.graphics)&&(_(i.graphics.include)||_(i.graphics.exclude)),s=wse(e)?bse(this,e):e,n=Tg(s);i.enableDraped=i.include&&!i.include.has(tp)||i.exclude&&i.exclude.has(tp);const o=this.sceneIntersectionHelper,a=ed(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?vo.ALL:vo.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=Qq(l,this);if(R(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return qc.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=vt(e.z==null&&kf(this.elevationProvider,e),0);return jn(e,yT,this.renderSpatialReference,t),this.state.camera.projectToScreen(yT,z8),Sp(z8[0],z8[1])}pixelSizeAt(e){return this.ready?e?(jn(e,yT,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(yT)):0:(qc.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return qc.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=wse(e)?bse(this,e):e,r=Yr(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=ed(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=vo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Mue(a,this),c=_(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:_m(a)?a.distanceInRenderSpace:0,layer:c}};return Wi.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:i}=await S1t(this,e);let r=null;return!(t.length===0||Math.abs(vt(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(R(e.parent))throw new j("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="line-of-sight"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return gat(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return yat(i,this._pixelFormat())}_completeSettings(e){const t=mat(e,this);return t.pixelRatio/=this.state.pixelRatio,xat(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return Mse.importLayerView(e)}hasLayerViewModule(e){return Mse.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=$1t(this.type);if(he("safari")&&he("safari")<9&&(e=new j("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:he("safari")})),_(e))throw qc.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,i;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(i=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?i:null;return _(e)?Cse(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(_(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,Ge.Local),s=this._validateSpatialReferenceForViewingMode(e,t,Ge.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,Ge.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,Ge.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!L4(e,i)&&(!!R(t)||!!gte(t)||(!uM(t)||!R(lz(t,e,i)))&&(!mte(t)||i!==Ge.Global))}_makeSpatialReferenceConstraints(e,t,i){if(R(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return gte(t)&&(r||s)?!s||i===Ge.Local||MJ(t.tileInfo,t.fullExtent,e,Ge.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:et.WebMercator,viewingMode:i}]:[{spatialReference:r?et.WGS84:et.WebMercator,viewingMode:i}]:uM(t)||mte(t)||!r&&!s?uM(t)&&r&&i!==Ge.Global?[{spatialReference:e,viewingMode:i},{spatialReference:et.WGS84,viewingMode:Ge.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?et.WGS84:et.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=_(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(_(i)?qc.warnOnce(`Spatial reference defined on view not supported in ${mV(i)} viewing mode.`):e.isGeographic&&qc.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||et.WGS84;return un(e,this.renderSpatialReference,e,i)||(i=et.WGS84,un(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new ot(e,i),t}trackGraphicState(e){if(!e.graphic)return qc.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var o;!r&&_(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return _(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return R2(e.map(i=>this.highlight(i)));if(ut.isCollection(e))return R2(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):qh()}maskOccludee(e){if(!e)return qc.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&_(n)&&nHe(n)&&(i=n.maskOccludee(e))};return _(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,_(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){_(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await _w(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new j("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,BM.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,BM.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(yT)?(t=this.computeMapPointFromVec3d(yT,t),e.intersector===Vr.TERRAIN&&this.basemapTerrain&&(t.z=vt(kf(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=Mue(n,this);if(_(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=Qq(n,this);if(R(a))continue;if(a.type==="graphic"){if(R(r)&&s!==e.length-1&&(r=new Set),_(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push(ye(F({},a),{mapPoint:l,distance:c}))}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return R(e)||(R(e.include)||e.include.has(i))&&(R(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof Ha)Y1t(i,this._getGraphicFilterUid(e)),t===BM.INCLUDE&&(_(this.graphicsView)&&e.layer===this?OA(i,this.graphicsView.processor.layer.id):e.layer&&OA(i,e.layer.uid));else if(ode(e))for(const r of e)r===this.graphics&&_(this.graphicsView)?OA(i,this.graphicsView.processor.layer.id):r===this.map.ground?OA(i,tp):this._externalToInternalRenderItems(r,t,i);else"uid"in e&&OA(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new ygt({view:this})),this._set("elevationProvider",new zR({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new ia({view:this})),this._set("featureTiles",new no({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var i;const t=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const r=_(this.basemapTerrain.extent)?N3(z5(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;_(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Wi.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(import("./FeatureTileTree3DDebugger.ad5233f5.js")).then(({FeatureTileTree3DDebugger:i})=>{!this.featureTreeDebugger&&Wi.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new i({view:this}))}):t||!this.featureTreeDebugger||Wi.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},Us),this.updatingHandles.add(()=>this.clippingArea,e,Us),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,Us)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new $dt(this.map,e));const t=this.state.isGlobal,i=cye(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",n5.create(this.state.viewingMode,i)),t||this.handles.add(ie(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&ck(r,this.basemapTerrain.spatialReference,Due,s)&&(this.renderCoordsHelper.extent=Due)},qi),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(xE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){_(e)&&e.type===Yi.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(ie(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),qi),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new ydt(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const i=sk(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new hl({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=C3(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new j("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),Rt),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),Rt),ie(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,Us)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:Tq.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(xE/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new _pt({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new wht})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await import("./GraphicsView3D.7a1977e2.js")).default;fi(e),await _w(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),_(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Cse(this.viewingMode);if(e===Ge.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(ns(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(tp);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(tp);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return R(this.voxelWasm)?(R(this.voxelWasmPromise)&&(this.voxelWasmPromise=import("./VoxelWasmPerSceneView.b045b618.js").then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){_(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function OA(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function Y1t(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function $L(e,t){return _(e)&&im(e.spatialReference,t)?N3(e,t):null}var BM;rt.type="3d",u([d()],rt.prototype,"_userClippingArea",void 0),u([d()],rt.prototype,"_resourceController",void 0),u([d()],rt.prototype,"_stage",void 0),u([d({readOnly:!0})],rt.prototype,"deconflictor",void 0),u([d({readOnly:!0})],rt.prototype,"labeler",void 0),u([d(c7(K2,"analyses"))],rt.prototype,"analyses",void 0),u([d({type:lE,readOnly:!0,aliasOf:"state.animation"})],rt.prototype,"animation",void 0),u([d({readOnly:!0})],rt.prototype,"basemapTerrain",void 0),u([d({readOnly:!0})],rt.prototype,"elevationProvider",void 0),u([d({type:Rc,aliasOf:"stateManager.camera"})],rt.prototype,"camera",void 0),u([d({type:Rc,aliasOf:"stateManager.contentCamera"})],rt.prototype,"contentCamera",void 0),u([d({readOnly:!0})],rt.prototype,"canvas",void 0),u([d({type:ot,aliasOf:"stateManager.center"})],rt.prototype,"center",void 0),u([d({type:ai})],rt.prototype,"clippingArea",null),u([d({type:wb})],rt.prototype,"constraints",void 0),u([d({type:ai,readOnly:!0})],rt.prototype,"renderDataExtent",null),u([d({type:ai,readOnly:!0})],rt.prototype,"dataExtent",null),u([d({type:ai,readOnly:!0})],rt.prototype,"groundAndLayersExtent",null),u([d({value:null,type:tS})],rt.prototype,"environment",null),u([qt("environment")],rt.prototype,"castEnvironment",null),u([d({readOnly:!0})],rt.prototype,"environmentManager",void 0),u([d({type:ai,aliasOf:"stateManager.extent"})],rt.prototype,"extent",void 0),u([d()],rt.prototype,"floors",void 0),u([d({readOnly:!0,aliasOf:"stateManager.screenCenter"})],rt.prototype,"screenCenter",void 0),u([d({aliasOf:"stateManager.frustum"})],rt.prototype,"frustum",void 0),u([d({type:Number,readOnly:!0})],rt.prototype,"fullOpacity",void 0),u([d({readOnly:!0})],rt.prototype,"graphicsView",void 0),u([d({readOnly:!0})],rt.prototype,"analysisViewManager",void 0),u([d()],rt.prototype,"groundView",void 0),u([d({type:Boolean})],rt.prototype,"initialExtentRequired",null),u([d()],rt.prototype,"_defaultsFromMapSettings",null),u([d({type:Boolean,readOnly:!0})],rt.prototype,"interacting",null),u([d()],rt.prototype,"stationary",null),u([d({aliasOf:"state.navigating"})],rt.prototype,"navigating",void 0),u([d()],rt.prototype,"map",void 0),u([d({readOnly:!0})],rt.prototype,"mapCoordsHelper",void 0),u([d({aliasOf:"stateManager.padding"})],rt.prototype,"padding",void 0),u([d({type:ia,readOnly:!0})],rt.prototype,"pointsOfInterest",void 0),u([d({type:no,readOnly:!0})],rt.prototype,"featureTiles",void 0),u([d()],rt.prototype,"featureTreeDebugger",void 0),u([d({type:Boolean})],rt.prototype,"screenSizePerspectiveEnabled",void 0),u([d({constructOnly:!0})],rt.prototype,"deactivatedWebGLExtensions",void 0),u([d({constructOnly:!0})],rt.prototype,"debugWebGLExtensions",void 0),u([d({constructOnly:!0})],rt.prototype,"renderCanvas",void 0),u([d({constructOnly:!0})],rt.prototype,"state",void 0),u([d({readOnly:!0})],rt.prototype,"inputManager",void 0),u([d({readOnly:!0})],rt.prototype,"stateManager",void 0),u([d({type:["low","medium","high"]})],rt.prototype,"qualityProfile",null),u([d({type:$le,get(){let e=this._get("qualitySettings");return e||(e=new $le,TN.apply(this.qualityProfile,e)),e}})],rt.prototype,"qualitySettings",void 0),u([d()],rt.prototype,"slicePlane",null),u([d({readOnly:!0})],rt.prototype,"typeSpecificPreconditionsReady",null),u([d({readOnly:!0})],rt.prototype,"renderCoordsHelper",void 0),u([d({readOnly:!0})],rt.prototype,"sceneIntersectionHelper",void 0),u([d({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],rt.prototype,"resolution",null),u([d({type:Number,aliasOf:"stateManager.scale"})],rt.prototype,"scale",void 0),u([d()],rt.prototype,"heightModelInfo",null),u([d()],rt.prototype,"spatialReference",void 0),u([d({type:Boolean,constructOnly:!0})],rt.prototype,"alphaCompositingEnabled",void 0),u([d({constructOnly:!0})],rt.prototype,"preserveDrawingBufferEnabled",void 0),u([d({type:Boolean})],rt.prototype,"supersampleScreenshotsEnabled",void 0),u([d({readOnly:!0})],rt.prototype,"type",void 0),u([d({type:MCe})],rt.prototype,"ui",void 0),u([d({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],rt.prototype,"updating",null),u([d({type:Number,readOnly:!0,dependsOn:["updating"]})],rt.prototype,"updatingProgress",void 0),u([d({type:["global","local"]})],rt.prototype,"viewingMode",null),u([d({type:Xh,aliasOf:"stateManager.viewpoint"})],rt.prototype,"viewpoint",void 0),u([d({type:Number,aliasOf:"stateManager.zoom"})],rt.prototype,"zoom",void 0),u([d({type:Tq})],rt.prototype,"highlightOptions",void 0),rt=u([P("esri.views.SceneView")],rt),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(BM||(BM={}));const yT=O(),z8=Yr(),Due=kt(),BCt=rt,ji={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let mS,OCe,Mz,PCe=!1,y5=!1,KJ=!1,pu=!1,Nue=null,Jq=!1;const pC=typeof window!="undefined"?window:{};ji.cssVarShim&&pC.CSS;const bp=pC.document||{head:{}},eK=pC.HTMLElement||class{},kl={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},v5=ji.shadowDomShim&&ji.shadowDom?(()=>(bp.head.attachShadow+"").indexOf("[native")>-1)():!0,Q1t=(()=>{let e=!1;try{bp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),J1t=e=>Promise.resolve(e),K1t=ji.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,ICe=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=tbt(e,s),l=ebt(t,o),c=ibt(s);kl.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>kl.rel(a,n,l,c))})},ebt=(e,t)=>i=>{try{ji.lazyLoad||e.$hostElement$[t](i)}catch(r){bP(r)}},tbt=(e,t)=>t&4?bp:t&8?pC:t&16?bp.body:e,ibt=e=>Q1t?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Fue="http://www.w3.org/1999/xlink",Zw=(e,t="")=>()=>{},kue=new WeakMap,rbt=(e,t,i)=>{let r=w5.get(e);K1t&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,w5.set(e,r)},sbt=(e,t,i,r)=>{let s=$Ce(t,i);const n=w5.get(s);if(e=e.nodeType===11?e:bp,n)if(typeof n=="string"){e=e.head||e;let o=kue.get(e),a;o||kue.set(e,o=new Set),o.has(s)||(a=bp.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},nbt=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=Zw("attachStyles",t.$tagName$),n=sbt(v5&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},$Ce=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),obt=e=>Lbt.map(t=>t(e)).find(t=>!!t),Uue={},abt="http://www.w3.org/2000/svg",lbt="http://www.w3.org/1999/xhtml",cbt=e=>e!=null,tK=e=>(e=typeof e,e==="object"||e==="function"),Ds=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!tK(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?_5(null,r):r),a=o)};if(c(i),t&&(ji.isDev&&e==="input"&&dbt(t),ji.vdomKey&&t.key&&(s=t.key),ji.slotRelocation&&t.name&&(n=t.name),ji.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}if(ji.isDev&&l.some(LCe)&&Ibt(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),ji.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,ubt);const h=_5(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),ji.vdomKey&&(h.$key$=s),ji.slotRelocation&&(h.$name$=n),h},_5=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return ji.vdomAttribute&&(i.$attrs$=null),ji.vdomKey&&(i.$key$=null),ji.slotRelocation&&(i.$name$=null),i},iK={},LCe=e=>e&&e.$tag$===iK,ubt={forEach:(e,t)=>e.map(zue).forEach(t),map:(e,t)=>e.map(zue).map(t).map(hbt)},zue=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),hbt=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),Ds(e.vtag,i,...e.vchildren||[])}const t=_5(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},dbt=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&$bt('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},Vue=(e,t,i,r,s,n)=>{if(i!==r){let o=Hue(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Bue(i),h=Bue(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Hue(pC,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&kl.rel(e,t,i,!1),r&&kl.ael(e,t,r,!1);else{const l=tK(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{const h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(Fue,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(Fue,t,r):e.setAttribute(t,r))}}},pbt=/\s/,Bue=e=>e?e.split(pbt):[],DCe=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||Uue,o=t.$attrs$||Uue;for(r in n)r in o||Vue(s,r,n[r],void 0,i,t.$flags$);for(r in o)Vue(s,r,n[r],o[r],i,t.$flags$)},b5=(e,t,i,r)=>{const s=t.$children$[i];let n=0,o,a,l;if(PCe||(KJ=!0,s.$tag$==="slot"&&(mS&&r.classList.add(mS+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=bp.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=bp.createTextNode("");else{if(pu||(pu=s.$tag$==="svg"),o=s.$elm$=bp.createElementNS(pu?abt:lbt,s.$flags$&2?"slot-fb":s.$tag$),pu&&s.$tag$==="foreignObject"&&(pu=!1),DCe(null,s,pu),cbt(mS)&&o["s-si"]!==mS&&o.classList.add(o["s-si"]=mS),s.$children$)for(n=0;n<s.$children$.length;++n)a=b5(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?pu=!1:o.tagName==="foreignObject"&&(pu=!0)}return o["s-hn"]=Mz,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=OCe,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&v3(e.$elm$,!1)),o},v3=(e,t)=>{kl.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==Mz&&s["s-ol"]&&(kCe(s).insertBefore(s,rK(s)),s["s-ol"].remove(),s["s-ol"]=void 0,KJ=!0),t&&v3(s,t)}kl.$flags$&=-2},NCe=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===Mz&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=b5(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,rK(t))))},FCe=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,VCe(r),y5=!0,s["s-ol"]?s["s-ol"].remove():v3(s,!0),s.remove())},fbt=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,f=r[0],m=r[p],y,v;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(f==null)f=r[++n];else if(m==null)m=r[--p];else if(LL(c,f))gS(c,f),c=t[++s],f=r[++n];else if(LL(h,m))gS(h,m),h=t[--l],m=r[--p];else if(LL(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&v3(c.$elm$.parentNode,!1),gS(c,m),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],m=r[--p];else if(LL(h,f))(c.$tag$==="slot"||m.$tag$==="slot")&&v3(h.$elm$.parentNode,!1),gS(h,f),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],f=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===f.$key$){o=a;break}o>=0?(v=t[o],v.$tag$!==f.$tag$?y=b5(t&&t[n],i,o,e):(gS(v,f),t[o]=void 0,y=v.$elm$),f=r[++n]):(y=b5(t&&t[n],i,n,e),f=r[++n]),y&&kCe(c.$elm$).insertBefore(y,rK(c.$elm$))}s>l?NCe(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&FCe(t,s,l)},LL=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,rK=e=>e&&e["s-ol"]||e,kCe=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,gS=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(pu=n==="svg"?!0:n==="foreignObject"?!1:pu,n==="slot"||DCe(e,t,pu),r!==null&&s!==null?fbt(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),NCe(i,null,t,s,0,s.length-1)):r!==null&&FCe(r,0,r.length-1),pu&&n==="svg"&&(pu=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},UCe=e=>{const t=e.childNodes;let i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}UCe(i)}},Kd=[],zCe=e=>{let t,i,r,s,n,o,a=0;const l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(Gue(i,s)?(n=Kd.find(h=>h.$nodeToRelocate$===i),y5=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:Kd.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&Kd.map(h=>{Gue(h.$nodeToRelocate$,i["s-sn"])&&(n=Kd.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):Kd.some(h=>h.$nodeToRelocate$===i)||Kd.push({$nodeToRelocate$:i}));t.nodeType===1&&zCe(t)}},Gue=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",VCe=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(VCe)},mbt=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||_5(null,null),n=LCe(t)?t:Ds(null,null,t);Mz=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,mS=i["s-sc"],OCe=i["s-cr"],PCe=v5&&(r.$flags$&1)!==0,y5=!1,gS(s,n);{if(kl.$flags$|=1,KJ){zCe(n.$elm$);let o,a,l,c,h,p,f=0;for(;f<Kd.length;f++)o=Kd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=bp.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Kd.length;f++)if(o=Kd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}y5&&UCe(n.$elm$),kl.$flags$&=-2,Kd.length=0}},gbt=(e,t)=>{},BCe=(e,t)=>(e.$flags$|=16,gbt(e,e.$ancestorComponent$),Fbt(()=>ybt(e,t))),ybt=(e,t)=>{const i=e.$hostElement$,r=Zw("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=x2(s,"componentWillLoad"):n=x2(s,"componentWillUpdate"),n=jue(n,()=>x2(s,"componentWillRender")),r(),jue(n,()=>vbt(e,s,t))},vbt=async(e,t,i)=>{const r=e.$hostElement$,s=Zw("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&nbt(e);const n=Zw("render",e.$cmpMeta$.$tagName$);_bt(e,t,r),n(),s(),bbt(e)},_bt=(e,t,i)=>{try{Nue=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(ji.hasRenderFn||ji.reflect)&&(ji.vdomRender||ji.reflect)&&(ji.hydrateServerSide||mbt(e,t))}catch(a){bP(a,e.$hostElement$)}return Nue=null,null},bbt=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=Zw("postUpdate",t),s=i;e.$ancestorComponent$,x2(s,"componentDidRender"),e.$flags$&64?(x2(s,"componentDidUpdate"),r()):(e.$flags$|=64,x2(s,"componentDidLoad"),r())},x2=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){bP(r)}},jue=(e,t)=>e&&e.then?e.then(t):t(),wbt=(e,t)=>e!=null&&!tK(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,xbt=(e,t)=>Oz(e).$instanceValues$.get(t),Tbt=(e,t,i,r)=>{const s=Oz(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=wbt(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(f=>{try{l[f](i,o,t)}catch(m){bP(m,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;BCe(s,!1)}}}},Sbt=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return xbt(this,n)},set(a){Tbt(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){kl.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},Ebt=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=obt(e)]);const a=$Ce(i,t.$modeName$);if(!w5.has(a)){const l=Zw("registerStyles",i.$tagName$);rbt(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>BCe(t,!0))()},Cbt=e=>{},Abt=e=>{if((kl.$flags$&1)===0){const t=Oz(e),i=t.$cmpMeta$,r=Zw("connectedCallback",i.$tagName$);t.$flags$&1?(ICe(e,t,i.$listeners$),Cbt(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&Rbt(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),Ebt(e,t,i)),r()}},Rbt=e=>{const t=e["s-cr"]=bp.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},Mbt=e=>{if((kl.$flags$&1)===0){const t=Oz(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},sK=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};ji.member&&(i.$members$=t[2]),ji.hostListener&&(i.$listeners$=t[3]),ji.watchCallback&&(i.$watchers$=e.$watchers$),ji.reflect&&(i.$attrsToReflect$=[]),ji.shadowDom&&!v5&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){Pbt(this,i)},connectedCallback(){Abt(this),ji.connectedCallback&&r&&r.call(this)},disconnectedCallback(){Mbt(this),ji.disconnectedCallback&&s&&s.call(this)},__attachShadow(){v5?ji.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,Sbt(e,i)},Obt=e=>{const t=new URL(e,kl.$resourcesUrl$);return t.origin!==pC.location.origin?t.href:t.pathname},GCe=new WeakMap,Oz=e=>GCe.get(e),Pbt=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return ji.isDev&&(i.$renderCount$=0),ji.method&&ji.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),ji.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),ICe(e,i,t.$listeners$),GCe.set(e,i)},Hue=(e,t)=>t in e,bP=(e,t)=>(0,console.error)(e,t),jCe=ji.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],Ibt=(...e)=>console.error(...jCe,...e),$bt=(...e)=>console.warn(...jCe,...e),w5=new Map,Lbt=[],que=[],HCe=[],Dbt=(e,t)=>i=>{e.push(i),Jq||(Jq=!0,t&&kl.$flags$&4?Nbt(Kq):kl.raf(Kq))},Wue=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){bP(i)}e.length=0},Kq=()=>{Wue(que),Wue(HCe),(Jq=que.length>0)&&kl.raf(Kq)},Nbt=e=>J1t().then(e),Fbt=Dbt(HCe,!0),nK={isDev:!!ji.isDev,isBrowser:!0,isServer:!1,isTesting:!!ji.isTesting};/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */function kbt(e){return e.map(t=>{let i="";for(let r=0;r<t;r++)i+=((1+Math.random())*65536|0).toString(16).substring(1);return i}).join("-")}const Ubt=()=>kbt([2,1,1,1,3]);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */function zbt(e){const t="dir",i=`[${t}]`,r=oK(e,i);return r?r.getAttribute(t):"ltr"}function qCe(e){return e.getRootNode()}function WCe(e){return e.host||null}function Vbt(e,{selector:t,id:i}){function r(s){if(!s)return null;s.assignedSlot&&(s=s.assignedSlot);const n=qCe(s),o=i?"getElementById"in n?n.getElementById(i):null:t?n.querySelector(t):null,a=WCe(n);return o||(a?r(a):null)}return r(e)}function oK(e,t){function i(r){return r?r.closest(t)||i(WCe(qCe(r))):null}return i(e)}function Bbt(e){return(!!e).toString()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */const XCe="calciteInternalLabelClick",aK="calciteInternalLabelConnected",eW="calciteInternaLabelDisconnected",Xue="calcite-label",x5=new WeakMap,_3=new WeakMap,T5=new WeakMap,T2=new Set,Gbt=e=>{const{id:t}=e,i=t&&Vbt(e,{selector:`${Xue}[for="${t}"]`});if(i)return i;const r=oK(e,Xue);return!r||jbt(r,e)?null:r};function jbt(e,t){let i;const r="custom-element-ancestor-check",s=o=>{o.stopImmediatePropagation();const a=o.composedPath();i=a.slice(a.indexOf(t),a.indexOf(e))};return e.addEventListener(r,s,{once:!0}),t.dispatchEvent(new CustomEvent(r,{composed:!0,bubbles:!0})),e.removeEventListener(r,s),i.filter(o=>o!==t&&o!==e).filter(o=>{var a;return(a=o.tagName)===null||a===void 0?void 0:a.includes("-")}).length>0}function ZCe(e){const t=Gbt(e.el);if(x5.has(t)||!t&&T2.has(e))return;const i=Zbt.bind(e);if(t){e.labelEl=t;const r=Wbt.bind(e);x5.set(e.labelEl,r),e.labelEl.addEventListener(XCe,r),T2.delete(e),document.removeEventListener(aK,_3.get(e)),T5.set(e,i),document.addEventListener(eW,i)}else T2.has(e)||(i(),document.removeEventListener(eW,T5.get(e)))}function Hbt(e){if(T2.delete(e),document.removeEventListener(aK,_3.get(e)),document.removeEventListener(eW,T5.get(e)),_3.delete(e),T5.delete(e),!e.labelEl)return;const t=x5.get(e.labelEl);e.labelEl.removeEventListener(XCe,t),x5.delete(e.labelEl)}function qbt(e){var t,i;return e.label||((i=(t=e.labelEl)===null||t===void 0?void 0:t.textContent)===null||i===void 0?void 0:i.trim())||""}function Wbt(e){this.disabled||this.el.contains(e.detail.sourceEvent.target)||this.onLabelClick(e)}function Xbt(){T2.has(this)&&ZCe(this)}function Zbt(){T2.add(this);const e=_3.get(this)||Xbt.bind(this);_3.set(this,e),document.addEventListener(aK,e)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */function YCe(e,t,i){const r=Ybt(e);return nK.isBrowser?new r(t,i):void 0}function Ybt(e){return e==="intersection"?window.IntersectionObserver:e==="mutation"?window.MutationObserver:window.ResizeObserver}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */function Qbt(){}function Jbt(e,t=!1){if(e.disabled){e.el.setAttribute("tabindex","-1"),e.el.setAttribute("aria-disabled","true"),e.el.contains(document.activeElement)&&document.activeElement.blur(),e.el.click=Qbt;return}e.el.click=HTMLElement.prototype.click,typeof t=="function"?e.el.setAttribute("tabindex",t.call(e)?"0":"-1"):t===!0?e.el.setAttribute("tabindex","0"):t===!1&&e.el.removeAttribute("tabindex"),e.el.removeAttribute("aria-disabled")}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */function Kbt(e){var t;(t=e.formEl)===null||t===void 0||t.requestSubmit()}function ewt(e){var t;(t=e.formEl)===null||t===void 0||t.reset()}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */const twt={icon:"icon",flipRtl:"flip-rtl"},V8={},B8={},QCe={s:16,m:24,l:32};async function iwt({icon:e,scale:t}){const i=QCe[t],r=rwt(e),s=r.charAt(r.length-1)==="F",o=`${s?r.substring(0,r.length-1):r}${i}${s?"F":""}`;if(V8[o])return V8[o];B8[o]||(B8[o]=fetch(Obt(`./assets/icon/${o}.json`)).then(l=>l.json()).catch(()=>(console.error(`"${o}" is not a valid calcite-ui-icon name`),"")));const a=await B8[o];return V8[o]=a,a}function rwt(e){const t=!isNaN(Number(e.charAt(0))),i=e.split("-");return i.length===1?t?`i${e}`:e:i.map((r,s)=>s===0?t?`i${r.toUpperCase()}`:r:r.charAt(0).toUpperCase()+r.slice(1)).join("")}const swt="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:-ms-inline-flexbox;display:inline-flex;color:var(--calcite-ui-icon-color)}:host([scale=s]){height:1rem;width:1rem;min-width:1rem;min-height:1rem}:host([scale=m]){height:1.5rem;width:1.5rem;min-width:1.5rem;min-height:1.5rem}:host([scale=l]){height:2rem;width:2rem;min-width:2rem;min-height:2rem}.flip-rtl{-webkit-transform:scaleX(-1);transform:scaleX(-1)}.svg{display:block}",nwt=sK(class extends eK{constructor(){super();this.__registerHost(),this.__attachShadow(),this.icon=null,this.flipRtl=!1,this.scale="m",this.visible=!1}connectedCallback(){this.waitUntilVisible(()=>{this.visible=!0,this.loadIconPathData()})}disconnectedCallback(){var e;(e=this.intersectionObserver)===null||e===void 0||e.disconnect(),this.intersectionObserver=null}async componentWillLoad(){this.loadIconPathData()}render(){const{el:e,flipRtl:t,pathData:i,scale:r,textLabel:s}=this,n=zbt(e),o=QCe[r],a=!!s,l=[].concat(i||"");return Ds(iK,{"aria-hidden":Bbt(!a),"aria-label":a?s:null,role:a?"img":null},Ds("svg",{class:{[twt.flipRtl]:n==="rtl"&&t,svg:!0},fill:"currentColor",height:"100%",viewBox:`0 0 ${o} ${o}`,width:"100%",xmlns:"http://www.w3.org/2000/svg"},l.map(c=>typeof c=="string"?Ds("path",{d:c}):Ds("path",{d:c.d,opacity:"opacity"in c?c.opacity:1}))))}async loadIconPathData(){const{icon:e,scale:t,visible:i}=this;!nK.isBrowser||!e||!i||(this.pathData=await iwt({icon:e,scale:t}))}waitUntilVisible(e){if(this.intersectionObserver=YCe("intersection",t=>{t.forEach(i=>{i.isIntersecting&&(this.intersectionObserver.disconnect(),this.intersectionObserver=null,e())})},{rootMargin:"50px"}),!this.intersectionObserver){e();return}this.intersectionObserver.observe(this.el)}static get assetsDirs(){return["assets"]}get el(){return this}static get watchers(){return{icon:["loadIconPathData"],scale:["loadIconPathData"]}}static get style(){return swt}},[1,"calcite-icon",{icon:[513],flipRtl:[516,"flip-rtl"],scale:[513],textLabel:[1,"text-label"],pathData:[32],visible:[32]}]);function JCe(){if(typeof customElements=="undefined")return;["calcite-icon"].forEach(t=>{switch(t){case"calcite-icon":customElements.get(t)||customElements.define(t,nwt);break}})}JCe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */const owt='@charset "UTF-8";@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{position:relative;margin-left:auto;margin-right:auto;display:none;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;padding-top:4rem;padding-bottom:4rem;opacity:1;min-height:var(--calcite-loader-size);font-size:var(--calcite-loader-font-size);stroke:var(--calcite-ui-brand);stroke-width:3;fill:none;-webkit-transform:scale(1, 1);transform:scale(1, 1);animation:loader-color-shift 6s alternate-reverse infinite linear}:host([scale=s]){--calcite-loader-font-size:var(--calcite-font-size--2);--calcite-loader-size:2rem;--calcite-loader-size-inline:0.75rem}:host([scale=m]){--calcite-loader-font-size:var(--calcite-font-size-0);--calcite-loader-size:4rem;--calcite-loader-size-inline:1rem}:host([scale=l]){--calcite-loader-font-size:var(--calcite-font-size-2);--calcite-loader-size:6rem;--calcite-loader-size-inline:1.5rem}:host([no-padding]){padding-top:0px;padding-bottom:0px}:host{display:none}:host([active]){display:-ms-flexbox;display:flex}.loader__text{display:block;text-align:center;font-size:var(--calcite-font-size--2);line-height:1rem;color:var(--calcite-ui-text-1);margin-top:calc(var(--calcite-loader-size) + 1.5rem)}.loader__percentage{position:absolute;display:block;text-align:center;color:var(--calcite-ui-text-1);font-size:var(--calcite-loader-font-size);width:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);line-height:0.25;-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svgs{position:absolute;overflow:visible;opacity:1;width:var(--calcite-loader-size);height:var(--calcite-loader-size);left:50%;margin-left:calc(var(--calcite-loader-size) / 2 * -1);-webkit-transform:scale(1, 1);transform:scale(1, 1)}.loader__svg{position:absolute;top:0px;left:0px;-webkit-transform-origin:center;transform-origin:center;overflow:visible;width:var(--calcite-loader-size);height:var(--calcite-loader-size);-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-timing-function:linear;animation-timing-function:linear;-webkit-animation-name:loader-clockwise;animation-name:loader-clockwise}@supports (display: grid){.loader__svg--1{-webkit-animation-name:loader-offset-1;animation-name:loader-offset-1}.loader__svg--2{-webkit-animation-name:loader-offset-2;animation-name:loader-offset-2}.loader__svg--3{-webkit-animation-name:loader-offset-3;animation-name:loader-offset-3}}:host([type=determinate]){-webkit-animation:none;animation:none;stroke:var(--calcite-ui-border-3)}:host([type=determinate]) .loader__svg--3{-webkit-animation:none;animation:none;stroke:var(--calcite-ui-brand);stroke-dasharray:150.79632;-webkit-transform:rotate(-90deg);transform:rotate(-90deg);-webkit-transition:all var(--calcite-internal-animation-timing-fast) linear;transition:all var(--calcite-internal-animation-timing-fast) linear}:host([inline]){position:relative;margin:0px;-webkit-animation:none;animation:none;stroke:currentColor;stroke-width:2;padding-top:0px;padding-bottom:0px;height:var(--calcite-loader-size-inline);min-height:var(--calcite-loader-size-inline);width:var(--calcite-loader-size-inline);-webkit-margin-end:calc(var(--calcite-loader-size-inline) * 0.5);margin-inline-end:calc(var(--calcite-loader-size-inline) * 0.5);vertical-align:calc(var(--calcite-loader-size-inline) * -1 * 0.2)}:host([active][inline]){display:inline-block}:host([inline]) .loader__svgs{top:0px;left:0px;margin:0px;width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([inline]) .loader__svg{width:var(--calcite-loader-size-inline);height:var(--calcite-loader-size-inline)}:host([complete]){opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms;transition:opacity var(--calcite-internal-animation-timing-medium) linear 1000ms, transform var(--calcite-internal-animation-timing-medium) linear 1000ms, -webkit-transform var(--calcite-internal-animation-timing-medium) linear 1000ms}:host([complete]) .loader__svgs{opacity:0;-webkit-transform:scale(0.75, 0.75);transform:scale(0.75, 0.75);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms;transition:opacity calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms, -webkit-transform calc(180ms * var(--calcite-internal-duration-factor)) linear 800ms}:host([complete]) .loader__percentage{color:var(--calcite-ui-brand);-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05);-webkit-transform-origin:center;transform-origin:center;-webkit-transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear;transition:color var(--calcite-internal-animation-timing-medium) linear, transform var(--calcite-internal-animation-timing-medium) linear, -webkit-transform var(--calcite-internal-animation-timing-medium) linear}.loader__svg--1{stroke-dasharray:27.9252444444% 139.6262222222%;-webkit-animation-duration:0.72s;animation-duration:0.72s}@-webkit-keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-1{0%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-83.7757333333%}100%{stroke-dasharray:27.9252444444% 251.3272%;stroke-dashoffset:-279.2524444444%}}.loader__svg--2{stroke-dasharray:55.8504888889% 139.6262222222%;-webkit-animation-duration:0.96s;animation-duration:0.96s}@-webkit-keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-2{0%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-97.7383555556%}100%{stroke-dasharray:55.8504888889% 223.4019555556%;stroke-dashoffset:-279.2524444444%}}.loader__svg--3{stroke-dasharray:13.9626222222% 139.6262222222%;-webkit-animation-duration:1.16s;animation-duration:1.16s}@-webkit-keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@keyframes loader-offset-3{0%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:0}50%{stroke-dasharray:139.6262222222% 139.6262222222%;stroke-dashoffset:-76.7944222222%}100%{stroke-dasharray:13.9626222222% 265.2898222222%;stroke-dashoffset:-279.2524444444%}}@-webkit-keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@keyframes loader-color-shift{0%{stroke:var(--calcite-ui-brand)}33%{stroke:var(--calcite-ui-brand-press)}66%{stroke:var(--calcite-ui-brand-hover)}100%{stroke:var(--calcite-ui-brand)}}@-webkit-keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes loader-clockwise{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}',awt=sK(class extends eK{constructor(){super();this.__registerHost(),this.__attachShadow(),this.active=!1,this.inline=!1,this.scale="m",this.value=0,this.text="",this.noPadding=!1}render(){const{el:e,inline:t,label:i,scale:r,text:s,type:n,value:o}=this,a=e.id||Ubt(),l=.45,c=t?this.getInlineSize(r):this.getSize(r),h=c*l,p=`0 0 ${c} ${c}`,f=n==="determinate",m=2*h*Math.PI,y=o/100*m,v=m-y,w=Math.floor(o),b={"aria-valuenow":w,"aria-valuemin":0,"aria-valuemax":100,complete:w===100},S={r:h,cx:c/2,cy:c/2},T={"stroke-dasharray":`${y} ${v}`};return Ds(iK,Object.assign({"aria-label":i,id:a,role:"progressbar"},f?b:{}),Ds("div",{class:"loader__svgs"},Ds("svg",{class:"loader__svg loader__svg--1",viewBox:p},Ds("circle",Object.assign({},S))),Ds("svg",{class:"loader__svg loader__svg--2",viewBox:p},Ds("circle",Object.assign({},S))),Ds("svg",Object.assign({class:"loader__svg loader__svg--3",viewBox:p},f?{style:T}:{}),Ds("circle",Object.assign({},S)))),s&&Ds("div",{class:"loader__text"},s),f&&Ds("div",{class:"loader__percentage"},o))}getSize(e){return{s:32,m:56,l:80}[e]}getInlineSize(e){return{s:12,m:16,l:20}[e]}get el(){return this}static get style(){return owt}},[1,"calcite-loader",{active:[516],inline:[516],label:[1],scale:[513],type:[513],value:[2],text:[1],noPadding:[4,"no-padding"]}]);function KCe(){if(typeof customElements=="undefined")return;["calcite-loader"].forEach(t=>{switch(t){case"calcite-loader":customElements.get(t)||customElements.define(t,awt);break}})}KCe();/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.0.0-beta.83
 */(function(e){if(typeof e.requestSubmit=="function")return;e.requestSubmit=function(r){r?(t(r,this),r.click()):(r=document.createElement("input"),r.type="submit",r.hidden=!0,this.appendChild(r),r.click(),this.removeChild(r))};function t(r,s){r instanceof HTMLElement||i(TypeError,"parameter 1 is not of type 'HTMLElement'"),r.type=="submit"||i(TypeError,"The specified element is not a submit button"),r.form==s||i(DOMException,"The specified element is not owned by this form element","NotFoundError")}function i(r,s,n){throw new r("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+s+".",n)}})(HTMLFormElement.prototype);const vd={buttonLoader:"calcite-button--loader",content:"content",contentSlotted:"content--slotted",icon:"icon",iconStart:"icon--start",iconEnd:"icon--end",loadingIn:"loading-in",loadingOut:"loading-out",iconStartEmpty:"icon-start-empty",iconEndEmpty:"icon-end-empty"},lwt={loading:"Loading"},cwt="@-webkit-keyframes in{0%{opacity:0}100%{opacity:1}}@keyframes in{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-down{0%{opacity:0;-webkit-transform:translate3D(0, -5px, 0);transform:translate3D(0, -5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@keyframes in-up{0%{opacity:0;-webkit-transform:translate3D(0, 5px, 0);transform:translate3D(0, 5px, 0)}100%{opacity:1;-webkit-transform:translate3D(0, 0, 0);transform:translate3D(0, 0, 0)}}@-webkit-keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}@keyframes in-scale{0%{opacity:0;-webkit-transform:scale3D(0.95, 0.95, 1);transform:scale3D(0.95, 0.95, 1)}100%{opacity:1;-webkit-transform:scale3D(1, 1, 1);transform:scale3D(1, 1, 1)}}:root{--calcite-animation-timing:calc(150ms * var(--calcite-internal-duration-factor));--calcite-internal-duration-factor:var(--calcite-duration-factor, 1);--calcite-internal-animation-timing-fast:calc(100ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-medium:calc(200ms * var(--calcite-internal-duration-factor));--calcite-internal-animation-timing-slow:calc(300ms * var(--calcite-internal-duration-factor))}.calcite-animate{opacity:0;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:var(--calcite-animation-timing);animation-duration:var(--calcite-animation-timing)}.calcite-animate__in{-webkit-animation-name:in;animation-name:in}.calcite-animate__in-down{-webkit-animation-name:in-down;animation-name:in-down}.calcite-animate__in-up{-webkit-animation-name:in-up;animation-name:in-up}.calcite-animate__in-scale{-webkit-animation-name:in-scale;animation-name:in-scale}:root{--calcite-popper-transition:var(--calcite-animation-timing)}:host([hidden]){display:none}:host{display:inline-block;width:auto;vertical-align:middle}:host([round]){border-radius:50px}:host([round]) a,:host([round]) button{border-radius:50px}:host button,:host a{outline-color:transparent}:host button:focus,:host a:focus{outline:2px solid var(--calcite-ui-brand);outline-offset:2px}:host button,:host a{--calcite-button-content-margin:0.5rem;--calcite-button-padding-x:7px;--calcite-button-padding-y:3px;padding:var(--calcite-button-padding-y) var(--calcite-button-padding-x) var(--calcite-button-padding-y) var(--calcite-button-padding-x);position:relative;-webkit-box-sizing:border-box;box-sizing:border-box;display:-ms-flexbox;display:flex;height:100%;width:100%;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;border-radius:0px;border-style:none;text-align:center;font-family:inherit;font-weight:var(--calcite-font-weight-normal);-webkit-text-decoration-line:none;text-decoration-line:none;-webkit-transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out, -webkit-box-shadow var(--calcite-animation-timing) ease-in-out;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out, -webkit-box-shadow var(--calcite-animation-timing) ease-in-out;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out;transition:color var(--calcite-animation-timing) ease-in-out, background-color var(--calcite-animation-timing) ease-in-out, box-shadow var(--calcite-animation-timing) ease-in-out, outline-color var(--calcite-internal-animation-timing-fast) ease-in-out, -webkit-box-shadow var(--calcite-animation-timing) ease-in-out}:host button:hover,:host a:hover{-webkit-text-decoration-line:none;text-decoration-line:none}.content{display:-ms-flexbox;display:flex;-ms-flex-preferred-size:auto;flex-basis:auto;-webkit-margin-start:var(--calcite-button-content-margin);margin-inline-start:var(--calcite-button-content-margin);-webkit-margin-end:var(--calcite-button-content-margin);margin-inline-end:var(--calcite-button-content-margin)}.icon-start-empty .content{-webkit-margin-start:unset;margin-inline-start:unset}.icon-end-empty .content{-webkit-margin-end:unset;margin-inline-end:unset}:host([scale=m]) button,:host([scale=m]) a{--calcite-button-content-margin:0.75rem}:host([scale=l]) button,:host([scale=l]) a{--calcite-button-content-margin:1rem}:host([width=auto]){width:auto}:host([width=half]){width:50%}:host([width=full]){width:100%}:host([alignment=center]:not([width=auto])) a,:host([alignment=center]:not([width=auto])) button{-ms-flex-pack:center;justify-content:center}:host([alignment=start]:not([width=auto])) a,:host([alignment=start]:not([width=auto])) button{-ms-flex-pack:start;justify-content:flex-start}:host([alignment=end]:not([width=auto])) a,:host([alignment=end]:not([width=auto])) button{-ms-flex-pack:end;justify-content:flex-end}:host([alignment*=space-between]:not([width=auto])) a,:host([alignment*=space-between]:not([width=auto])) button{-ms-flex-pack:justify;justify-content:space-between}:host([alignment=icon-start-space-between]:not([width=auto])) .icon--start{-webkit-margin-end:auto;margin-inline-end:auto}:host([alignment=icon-start-space-between]:not([width=auto])) a,:host([alignment=icon-start-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=icon-end-space-between]:not([width=auto])) .icon--end{-webkit-margin-start:auto;margin-inline-start:auto}:host([alignment=icon-end-space-between]:not([width=auto])) a,:host([alignment=icon-end-space-between]:not([width=auto])) button{text-align:unset}:host([alignment=center]) a:not(.content--slotted) .icon--start+.icon--end,:host([alignment=center]) button:not(.content--slotted) .icon--start+.icon--end{-webkit-margin-start:var(--calcite-button-content-margin);margin-inline-start:var(--calcite-button-content-margin)}.icon{position:relative;margin:0px;display:-ms-inline-flexbox;display:inline-flex;font-weight:var(--calcite-font-weight-normal);line-height:inherit}:host([disabled]){pointer-events:none;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;opacity:var(--calcite-ui-opacity-disabled)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}:host([loading]){pointer-events:none}:host([loading]) button,:host([loading]) a{pointer-events:none;opacity:var(--calcite-ui-opacity-disabled)}@-webkit-keyframes loader-in{0%{width:0;opacity:0;-webkit-transform:scale(0.5);transform:scale(0.5)}100%{width:1em;opacity:1;-webkit-transform:scale(1);transform:scale(1)}}@keyframes loader-in{0%{width:0;opacity:0;-webkit-transform:scale(0.5);transform:scale(0.5)}100%{width:1em;opacity:1;-webkit-transform:scale(1);transform:scale(1)}}@-webkit-keyframes loader-out{0%{width:1em;opacity:1;-webkit-transform:scale(1);transform:scale(1)}100%{width:0;opacity:0;-webkit-transform:scale(0.5);transform:scale(0.5)}}@keyframes loader-out{0%{width:1em;opacity:1;-webkit-transform:scale(1);transform:scale(1)}100%{width:0;opacity:0;-webkit-transform:scale(0.5);transform:scale(0.5)}}.calcite-button--loader{display:-ms-flexbox;display:flex}.calcite-button--loader calcite-loader{margin:0px;-webkit-transition:width var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, -webkit-transform var(--calcite-internal-animation-timing-slow) ease-in-out;transition:width var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, -webkit-transform var(--calcite-internal-animation-timing-slow) ease-in-out;transition:width var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out;transition:width var(--calcite-internal-animation-timing-slow) ease-in-out, opacity var(--calcite-internal-animation-timing-slow) ease-in-out, transform var(--calcite-internal-animation-timing-slow) ease-in-out, -webkit-transform var(--calcite-internal-animation-timing-slow) ease-in-out}.calcite-button--loader calcite-loader.loading-in{-webkit-animation-name:loader-in;animation-name:loader-in;-webkit-animation-duration:310ms;animation-duration:310ms}.calcite-button--loader calcite-loader.loading-out{-webkit-animation-name:loader-out;animation-name:loader-out;-webkit-animation-duration:310ms;animation-duration:310ms}:host([loading]) button.content--slotted .calcite-button--loader calcite-loader,:host([loading]) a.content--slotted .calcite-button--loader calcite-loader{-webkit-margin-end:var(--calcite-button-content-margin);margin-inline-end:var(--calcite-button-content-margin)}:host([loading]) button:not(.content--slotted) .icon--start,:host([loading]) button:not(.content--slotted) .icon--end,:host([loading]) a:not(.content--slotted) .icon--start,:host([loading]) a:not(.content--slotted) .icon--end{display:none}:host([appearance=solid]) button,:host([appearance=solid]) a{border-width:1px;border-style:solid;border-color:transparent}:host([appearance=solid][color=blue]) button,:host([appearance=solid][color=blue]) a{background-color:var(--calcite-ui-brand);color:var(--calcite-ui-text-inverse)}:host([appearance=solid][color=blue]) button:hover,:host([appearance=solid][color=blue]) button:focus,:host([appearance=solid][color=blue]) a:hover,:host([appearance=solid][color=blue]) a:focus{background-color:var(--calcite-ui-brand-hover)}:host([appearance=solid][color=blue]) button:active,:host([appearance=solid][color=blue]) a:active{background-color:var(--calcite-ui-brand-press)}:host([appearance=solid][color=blue]) button calcite-loader,:host([appearance=solid][color=blue]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=solid][color=red]) button,:host([appearance=solid][color=red]) a{background-color:var(--calcite-ui-danger);color:var(--calcite-ui-text-inverse)}:host([appearance=solid][color=red]) button:hover,:host([appearance=solid][color=red]) button:focus,:host([appearance=solid][color=red]) a:hover,:host([appearance=solid][color=red]) a:focus{background-color:var(--calcite-ui-danger-hover)}:host([appearance=solid][color=red]) button:active,:host([appearance=solid][color=red]) a:active{background-color:var(--calcite-ui-danger-press)}:host([appearance=solid][color=red]) button calcite-loader,:host([appearance=solid][color=red]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=solid][color=neutral]) button,:host([appearance=solid][color=neutral]) a{background-color:var(--calcite-ui-foreground-3);color:var(--calcite-ui-text-1)}:host([appearance=solid][color=neutral]) button:hover,:host([appearance=solid][color=neutral]) button:focus,:host([appearance=solid][color=neutral]) a:hover,:host([appearance=solid][color=neutral]) a:focus{background-color:var(--calcite-ui-foreground-2)}:host([appearance=solid][color=neutral]) button:active,:host([appearance=solid][color=neutral]) a:active{background-color:var(--calcite-ui-foreground-1)}:host([appearance=solid][color=neutral]) button calcite-loader,:host([appearance=solid][color=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=solid][color=inverse]) button,:host([appearance=solid][color=inverse]) a{color:var(--calcite-ui-text-inverse);background-color:var(--calcite-ui-inverse)}:host([appearance=solid][color=inverse]) button:hover,:host([appearance=solid][color=inverse]) button:focus,:host([appearance=solid][color=inverse]) a:hover,:host([appearance=solid][color=inverse]) a:focus{background-color:var(--calcite-ui-inverse-hover)}:host([appearance=solid][color=inverse]) button:active,:host([appearance=solid][color=inverse]) a:active{background-color:var(--calcite-ui-inverse-press)}:host([appearance=solid][color=inverse]) button calcite-loader,:host([appearance=solid][color=inverse]) a calcite-loader{color:var(--calcite-ui-text-inverse)}:host([appearance=outline]) button,:host([appearance=outline]) a{border-width:1px;border-style:solid;background-color:var(--calcite-ui-foreground-1);-webkit-box-shadow:inset 0 0 0 1px transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=outline][color=blue]) button,:host([appearance=outline][color=blue]) a{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand)}:host([appearance=outline][color=blue]) button:hover,:host([appearance=outline][color=blue]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=outline][color=blue]) button:focus,:host([appearance=outline][color=blue]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=outline][color=blue]) button:active,:host([appearance=outline][color=blue]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=outline][color=blue]) button calcite-loader,:host([appearance=outline][color=blue]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=outline][color=red]) button,:host([appearance=outline][color=red]) a{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger)}:host([appearance=outline][color=red]) button:hover,:host([appearance=outline][color=red]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=outline][color=red]) button:focus,:host([appearance=outline][color=red]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=outline][color=red]) button:active,:host([appearance=outline][color=red]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=outline][color=red]) button calcite-loader,:host([appearance=outline][color=red]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=outline][color=neutral]) button,:host([appearance=outline][color=neutral]) a{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-foreground-3)}:host([appearance=outline][color=neutral]) button:hover,:host([appearance=outline][color=neutral]) a:hover{-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=outline][color=neutral]) button:focus,:host([appearance=outline][color=neutral]) a:focus{-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][color=neutral]) button:active,:host([appearance=outline][color=neutral]) a:active{-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=outline][color=neutral]) button calcite-loader,:host([appearance=outline][color=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][color=inverse]) button,:host([appearance=outline][color=inverse]) a{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=outline][color=inverse]) button:hover,:host([appearance=outline][color=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=outline][color=inverse]) button:focus,:host([appearance=outline][color=inverse]) a:focus{border-color:var(--calcite-ui-inverse);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=outline][color=inverse]) button:active,:host([appearance=outline][color=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=outline][color=inverse]) button calcite-loader,:host([appearance=outline][color=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=clear]) button,:host([appearance=clear]) a{border-width:1px;border-style:solid;background-color:transparent;-webkit-box-shadow:inset 0 0 0 1px transparent;box-shadow:inset 0 0 0 1px transparent}:host([appearance=clear][color=blue]) button,:host([appearance=clear][color=blue]) a{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand)}:host([appearance=clear][color=blue]) button:hover,:host([appearance=clear][color=blue]) a:hover{border-color:var(--calcite-ui-brand-hover);color:var(--calcite-ui-brand-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-brand-hover)}:host([appearance=clear][color=blue]) button:focus,:host([appearance=clear][color=blue]) a:focus{border-color:var(--calcite-ui-brand);color:var(--calcite-ui-brand);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-brand);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand)}:host([appearance=clear][color=blue]) button:active,:host([appearance=clear][color=blue]) a:active{border-color:var(--calcite-ui-brand-press);color:var(--calcite-ui-brand-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-brand-press)}:host([appearance=clear][color=blue]) button calcite-loader,:host([appearance=clear][color=blue]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=clear][color=red]) button,:host([appearance=clear][color=red]) a{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger)}:host([appearance=clear][color=red]) button:hover,:host([appearance=clear][color=red]) a:hover{border-color:var(--calcite-ui-danger-hover);color:var(--calcite-ui-danger-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-danger-hover)}:host([appearance=clear][color=red]) button:focus,:host([appearance=clear][color=red]) a:focus{border-color:var(--calcite-ui-danger);color:var(--calcite-ui-danger);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-danger);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger)}:host([appearance=clear][color=red]) button:active,:host([appearance=clear][color=red]) a:active{border-color:var(--calcite-ui-danger-press);color:var(--calcite-ui-danger-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-danger-press)}:host([appearance=clear][color=red]) button calcite-loader,:host([appearance=clear][color=red]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=clear][color=neutral]) button,:host([appearance=clear][color=neutral]) a{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-foreground-3)}:host([appearance=clear][color=neutral]) button:hover,:host([appearance=clear][color=neutral]) a:hover{-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 1px var(--calcite-ui-foreground-3)}:host([appearance=clear][color=neutral]) button:focus,:host([appearance=clear][color=neutral]) a:focus{-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=clear][color=neutral]) button:active,:host([appearance=clear][color=neutral]) a:active{-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3);box-shadow:inset 0 0 0 2px var(--calcite-ui-foreground-3)}:host([appearance=clear][color=neutral]) button calcite-loader,:host([appearance=clear][color=neutral]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=clear][color=inverse]) button,:host([appearance=clear][color=inverse]) a{color:var(--calcite-ui-text-1);border-color:var(--calcite-ui-inverse)}:host([appearance=clear][color=inverse]) button:hover,:host([appearance=clear][color=inverse]) a:hover{border-color:var(--calcite-ui-inverse-hover);-webkit-box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover);box-shadow:inset 0 0 0 1px var(--calcite-ui-inverse-hover)}:host([appearance=clear][color=inverse]) button:focus,:host([appearance=clear][color=inverse]) a:focus{border-color:var(--calcite-ui-inverse);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse)}:host([appearance=clear][color=inverse]) button:active,:host([appearance=clear][color=inverse]) a:active{border-color:var(--calcite-ui-inverse-press);-webkit-box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press);box-shadow:inset 0 0 0 2px var(--calcite-ui-inverse-press)}:host([appearance=clear][color=inverse]) button calcite-loader,:host([appearance=clear][color=inverse]) a calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=outline][split-child=primary]) button,:host([appearance=clear][split-child=primary]) button{border-inline-end-width:0;border-inline-start-width:1px}:host([appearance=outline][split-child=secondary]) button,:host([appearance=clear][split-child=secondary]) button{border-inline-start-width:0;border-inline-end-width:1px}:host([appearance=transparent]:not(.enable-editing-button)) button,:host([appearance=transparent]:not(.enable-editing-button)) a{background-color:transparent}:host([appearance=transparent]:not(.enable-editing-button)) button:hover,:host([appearance=transparent]:not(.enable-editing-button)) button:focus,:host([appearance=transparent]:not(.enable-editing-button)) a:hover,:host([appearance=transparent]:not(.enable-editing-button)) a:focus{background-color:var(--calcite-button-transparent-hover)}:host([appearance=transparent]:not(.enable-editing-button)) button:active,:host([appearance=transparent]:not(.enable-editing-button)) a:active{background-color:var(--calcite-button-transparent-press)}:host([appearance=transparent][color=blue]) button,:host([appearance=transparent][color=blue]) a{color:var(--calcite-ui-brand)}:host([appearance=transparent][color=blue]) button:hover,:host([appearance=transparent][color=blue]) a:hover{color:var(--calcite-ui-brand-hover)}:host([appearance=transparent][color=blue]) button:focus,:host([appearance=transparent][color=blue]) a:focus{color:var(--calcite-ui-brand)}:host([appearance=transparent][color=blue]) button:active,:host([appearance=transparent][color=blue]) a:active{color:var(--calcite-ui-brand-press)}:host([appearance=transparent][color=blue]) button calcite-loader,:host([appearance=transparent][color=blue]) a calcite-loader{color:var(--calcite-ui-brand)}:host([appearance=transparent][color=red]) button,:host([appearance=transparent][color=red]) a{color:var(--calcite-ui-danger)}:host([appearance=transparent][color=red]) button:hover,:host([appearance=transparent][color=red]) a:hover{color:var(--calcite-ui-danger-hover)}:host([appearance=transparent][color=red]) button:focus,:host([appearance=transparent][color=red]) a:focus{color:var(--calcite-ui-danger)}:host([appearance=transparent][color=red]) button:active,:host([appearance=transparent][color=red]) a:active{color:var(--calcite-ui-danger-press)}:host([appearance=transparent][color=red]) button calcite-loader,:host([appearance=transparent][color=red]) a calcite-loader{color:var(--calcite-ui-danger)}:host([appearance=transparent][color=neutral]:not(.cancel-editing-button)) button,:host([appearance=transparent][color=neutral]:not(.cancel-editing-button)) a,:host([appearance=transparent][color=neutral]:not(.cancel-editing-button)) calcite-loader{color:var(--calcite-ui-text-1)}:host([appearance=transparent][color=neutral].cancel-editing-button) button{border-top-width:1px;border-bottom-width:1px;color:var(--calcite-ui-text-3);border-top-color:var(--calcite-ui-border-input);border-bottom-color:var(--calcite-ui-border-input);border-bottom-style:solid;border-top-style:solid}:host([appearance=transparent][color=neutral].cancel-editing-button) button:not(.content--slotted){--calcite-button-padding-y:0}:host([appearance=transparent][color=neutral].cancel-editing-button) button:hover{color:var(--calcite-ui-text-1)}:host([appearance=transparent][color=neutral].enable-editing-button) button{background-color:transparent}:host(.confirm-changes-button) button:focus,:host(.cancel-editing-button) button:focus,:host(.enable-editing-button) button:focus{outline-offset:-2px}:host([appearance=transparent][color=inverse]) button,:host([appearance=transparent][color=inverse]) a,:host([appearance=transparent][color=inverse]) calcite-loader{color:var(--calcite-ui-text-inverse)}:host([scale=s]) button.content--slotted,:host([scale=s]) a.content--slotted{font-size:var(--calcite-font-size--2);line-height:1rem}:host([scale=s][appearance=transparent]) button.content--slotted,:host([scale=s][appearance=transparent]) a.content--slotted{--calcite-button-padding-x:0.5rem;--calcite-button-padding-y:0.25rem}:host([scale=m]) button.content--slotted,:host([scale=m]) a.content--slotted{--calcite-button-padding-x:11px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=m]:not([appearance=transparent])) button.content--slotted,:host([scale=m]:not([appearance=transparent])) a.content--slotted{--calcite-button-padding-y:7px}:host([scale=m][appearance=transparent]) button.content--slotted,:host([scale=m][appearance=transparent]) a.content--slotted{--calcite-button-padding-x:0.75rem;--calcite-button-padding-y:0.5rem}:host([scale=l]) button.content--slotted,:host([scale=l]) a.content--slotted{--calcite-button-padding-x:15px;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l]:not([appearance=transparent])) button.content--slotted,:host([scale=l]:not([appearance=transparent])) a.content--slotted{--calcite-button-padding-y:11px}:host([scale=l][appearance=transparent]) button.content--slotted,:host([scale=l][appearance=transparent]) a.content--slotted{--calcite-button-padding-x:1rem;--calcite-button-padding-y:0.75rem}:host([scale=s]) button:not(.content--slotted),:host([scale=s]) a:not(.content--slotted){--calcite-button-padding-x:0.125rem;--calcite-button-padding-y:3px;width:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-height:1.5rem}:host([scale=s][appearance=transparent]) button:not(.content--slotted),:host([scale=s][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y:0.25rem}:host([scale=m]) button:not(.content--slotted),:host([scale=m]) a:not(.content--slotted){--calcite-button-padding-x:0.125rem;--calcite-button-padding-y:7px;width:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-height:2rem}:host([scale=m][appearance=transparent]) button:not(.content--slotted),:host([scale=m][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y:0.5rem}:host([scale=l]) button:not(.content--slotted),:host([scale=l]) a:not(.content--slotted){--calcite-button-padding-x:0.125rem;--calcite-button-padding-y:9px;width:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem;min-height:2.75rem}:host([scale=l][appearance=transparent]) button:not(.content--slotted),:host([scale=l][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-y:0.625rem}:host([scale=s][icon-start][icon-end]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x:23px;height:1.5rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=s][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=s][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x:1.5rem}:host([scale=m][icon-start][icon-end]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x:2rem;height:2rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=m][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=m][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x:33px}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end]) a:not(.content--slotted){--calcite-button-padding-x:43px;height:2.75rem;font-size:var(--calcite-font-size-0);line-height:1.25rem}:host([scale=l][icon-start][icon-end]) button:not(.content--slotted) .icon--start+.icon--end,:host([scale=l][icon-start][icon-end]) a:not(.content--slotted) .icon--start+.icon--end{-webkit-margin-start:1rem;margin-inline-start:1rem}:host([scale=l][icon-start][icon-end][appearance=transparent]) button:not(.content--slotted),:host([scale=l][icon-start][icon-end][appearance=transparent]) a:not(.content--slotted){--calcite-button-padding-x:2.75rem}",uwt=sK(class extends eK{constructor(){super();this.__registerHost(),this.__attachShadow(),this.alignment="center",this.appearance="solid",this.color="blue",this.disabled=!1,this.intlLoading=lwt.loading,this.loading=!1,this.round=!1,this.scale="m",this.splitChild=!1,this.type="button",this.width="auto",this.mutationObserver=YCe("mutation",()=>this.updateHasContent()),this.hasContent=!1,this.hasLoader=!1,this.handleClick=()=>{const{type:e}=this;this.href||(e==="submit"?Kbt(this):e==="reset"&&ewt(this))}}loadingChanged(e,t){!!e&&!t&&(this.hasLoader=!0),!e&&!!t&&window.setTimeout(()=>{this.hasLoader=!1},300)}connectedCallback(){this.hasLoader=this.loading,this.setupTextContentObserver(),ZCe(this),this.formEl=oK(this.el,this.form?`#${this.form}`:"form")}disconnectedCallback(){var e;(e=this.mutationObserver)===null||e===void 0||e.disconnect(),Hbt(this),this.formEl=null}componentWillLoad(){nK.isBrowser&&this.updateHasContent()}componentDidRender(){Jbt(this)}render(){const e=this.href?"a":"button",t=e,i=this.hasLoader?Ds("div",{class:vd.buttonLoader},Ds("calcite-loader",{active:!0,class:this.loading?vd.loadingIn:vd.loadingOut,inline:!0,label:this.intlLoading,scale:"m"})):null,r=Ds("calcite-icon",{class:{[vd.icon]:!0,[vd.iconStart]:!0},flipRtl:this.iconFlipRtl==="start"||this.iconFlipRtl==="both",icon:this.iconStart,scale:"s"}),s=Ds("calcite-icon",{class:{[vd.icon]:!0,[vd.iconEnd]:!0},flipRtl:this.iconFlipRtl==="end"||this.iconFlipRtl==="both",icon:this.iconEnd,scale:"s"}),n=Ds("span",{class:vd.content},Ds("slot",null));return Ds(t,{"aria-label":qbt(this),class:{[vd.contentSlotted]:this.hasContent,[vd.iconStartEmpty]:!this.iconStart,[vd.iconEndEmpty]:!this.iconEnd},disabled:this.disabled||this.loading,href:e==="a"&&this.href,name:e==="button"&&this.name,onClick:this.handleClick,ref:o=>this.childEl=o,rel:e==="a"&&this.rel,tabIndex:this.disabled||this.loading?-1:null,target:e==="a"&&this.target,type:e==="button"&&this.type},i,this.iconStart?r:null,this.hasContent?n:null,this.iconEnd?s:null)}async setFocus(){this.childEl.focus()}updateHasContent(){var e,t;const i=this.el.textContent.trim().length>0||this.el.childNodes.length>0;this.hasContent=this.el.childNodes.length===1&&((e=this.el.childNodes[0])===null||e===void 0?void 0:e.nodeName)==="#text"?((t=this.el.textContent)===null||t===void 0?void 0:t.trim().length)>0:i}setupTextContentObserver(){var e;(e=this.mutationObserver)===null||e===void 0||e.observe(this.el,{childList:!0,subtree:!0})}onLabelClick(){this.handleClick(),this.setFocus()}get el(){return this}static get watchers(){return{loading:["loadingChanged"]}}static get style(){return cwt}},[1,"calcite-button",{alignment:[513],appearance:[513],label:[1],color:[513],disabled:[516],href:[513],iconEnd:[513,"icon-end"],iconFlipRtl:[513,"icon-flip-rtl"],iconStart:[513,"icon-start"],intlLoading:[1,"intl-loading"],loading:[516],name:[1],rel:[1],form:[1],round:[516],scale:[513],splitChild:[520,"split-child"],target:[1],type:[1025],width:[513],hasContent:[32],hasLoader:[32],setFocus:[64]}]);function hwt(){if(typeof customElements=="undefined")return;["calcite-button","calcite-icon","calcite-loader"].forEach(t=>{switch(t){case"calcite-button":customElements.get(t)||customElements.define(t,uwt);break;case"calcite-icon":customElements.get(t)||JCe();break;case"calcite-loader":customElements.get(t)||KCe();break}})}hwt();function eAe(e){return e&&"getAtOrigin"in e&&"originOf"in e}function Zue(e){e&&e.writtenProperties&&e.writtenProperties.forEach(({target:t,propName:i,newOrigin:r})=>{eAe(t)&&r&&t.originOf(i)!==r&&t.updateOrigin(i,r)})}async function dwt(e,t,i,r,s,n){let o=null;if(_(i)){const c=`${e}/nodepages/`,h=c+Math.floor(i.rootIndex/i.nodesPerPage);try{return{type:"page",rootPage:(await Zt(h,{query:{f:"json",token:r},responseType:"json",signal:n})).data,rootIndex:i.rootIndex,pageSize:i.nodesPerPage,lodMetric:i.lodSelectionMetricType,urlPrefix:c}}catch(p){_(s)&&s.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,p),o=p}}if(!t)return null;const a=`${e}/nodes/`,l=a+(t&&t.split("/").pop());try{return{type:"node",rootNode:(await Zt(l,{query:{f:"json",token:r},responseType:"json",signal:n})).data,urlPrefix:a}}catch(c){throw new j("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}async function pwt(e,t={},i){await e.load(i);const r=Ll(e.itemUrl,"resources"),{start:s=1,num:n=10,sortOrder:o="asc",sortField:a="created"}=t,l={query:{start:s,num:n,sortOrder:o,sortField:a,token:e.apiKey},signal:xr(i,"signal")},c=await e.portal._request(r,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:h,size:p,resource:f})=>({created:new Date(h),size:p,resource:e.resourceFromPath(f)}))}}async function fwt(e,t,i,r){if(!e.hasPath())throw new j(`portal-item-resource-${t}:invalid-path`,"Resource does not have a valid path");const s=e.portalItem;await s.load(r);const n=Ll(s.userItemUrl,t==="add"?"addResources":"updateResources"),[o,a]=tAe(e.path),l=await iAe(i),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),_(r)&&r.access&&c.append("access",r.access),await s.portal._request(n,{method:"post",body:c,signal:xr(r,"signal")}),e}async function mwt(e,t,i){if(!t.hasPath())throw new j("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(i);const r=Ll(e.userItemUrl,"removeResources");await e.portal._request(r,{method:"post",query:{resource:t.path},signal:xr(i,"signal")}),t.portalItem=null}async function gwt(e,t){await e.load(t);const i=Ll(e.userItemUrl,"removeResources");return e.portal._request(i,{method:"post",query:{deleteAll:!0},signal:xr(t,"signal")})}function tAe(e){const t=e.lastIndexOf("/");return t===-1?[".",e]:[e.slice(0,t),e.slice(t+1)]}function lK(e){const[t,i]=ywt(e),[r,s]=tAe(t);return[r,s,i]}function ywt(e){const t=gX(e);return R(t)?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}async function iAe(e){return e instanceof Blob?e:(await Zt(e.url,{responseType:"blob"})).data}function vwt(e,t){if(!e.hasPath())return null;const[i,,r]=lK(e.path);return e.portalItem.resourceFromPath(Ll(i,t+r))}function rAe(e,t){if(!e.hasPath())return null;const[i,,r]=lK(e.path);return e.portalItem.resourceFromPath(Ll(i,t+r))}var XR=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",addOrUpdateResource:fwt,contentToBlob:iAe,fetchResources:pwt,getSiblingOfSameType:vwt,getSiblingOfSameTypeI:rAe,removeAllResources:gwt,removeResource:mwt,splitPrefixFileNameAndExtension:lK});async function Yue(e,t,i){if(!t||!t.resources)return;const r=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const s=new Set(t.resources.toKeep.map(c=>c.resource.path)),n=new Set,o=[];s.forEach(c=>{r.delete(c),e.paths.push(c)});for(const c of t.resources.toUpdate)if(r.delete(c.resource.path),s.has(c.resource.path)||n.has(c.resource.path)){const{resource:h,content:p,finish:f,error:m}=c,y=rAe(h,bZ());e.paths.push(y.path),o.push(Que({resource:y,content:p,finish:f,error:m},i))}else e.paths.push(c.resource.path),o.push(_wt(c,i)),n.add(c.resource.path);for(const c of t.resources.toAdd)o.push(Que(c,i)),e.paths.push(c.resource.path);if(r.forEach(c=>{const h=t.portalItem.resourceFromPath(c);o.push(h.portalItem.removeResource(h).catch(()=>{}))}),o.length===0)return;const a=await gs(o);fi(i);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new j("save:resources","Failed to save one or more resources",{errors:l})}async function Que(e,t){const i=await ku(e.resource.portalItem.addResource(e.resource,e.content,t));if(i.ok!==!0)throw e.error&&e.error(i.error),i.error;e.finish&&e.finish(e.resource)}async function _wt(e,t){const i=await ku(e.resource.update(e.content,t));if(i.ok!==!0)throw e.error(i.error),i.error;e.finish(e.resource)}const vT=fe.getLogger("esri.layers.mixins.SceneService"),sAe=e=>{let t=class extends e{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=$5(async(i,r,s)=>{switch(i){case f_.SAVE:return this._save(r);case f_.SAVE_AS:return this._saveAs(s,r)}})}readSpatialReference(i,r){return this._readSpatialReference(r)}_readSpatialReference(i){if(i.spatialReference!=null)return et.fromJSON(i.spatialReference);{const r=i.store,s=r.indexCRS||r.geographicCRS,n=s&&parseInt(s.substring(s.lastIndexOf("/")+1,s.length),10);return n!=null?new et(n):null}}readFullExtent(i,r,s){if(i!=null&&typeof i=="object"){const a=i.spatialReference==null?ye(F({},i),{spatialReference:this._readSpatialReference(r)}):i;return ai.fromJSON(a,s)}const n=r.store,o=this._readSpatialReference(r);return o==null||n==null||n.extent==null||!Array.isArray(n.extent)||n.extent.some(a=>a<G8)?null:new ai({xmin:n.extent[0],ymin:n.extent[1],xmax:n.extent[2],ymax:n.extent[3],spatialReference:o})}parseVersionString(i){const r={major:Number.NaN,minor:Number.NaN,versionString:i},s=i.split(".");return s.length>=2&&(r.major=parseInt(s[0],10),r.minor=parseInt(s[1],10)),r}readVersion(i,r){const s=r.store,n=s.version!=null?s.version.toString():"";return this.parseVersionString(n)}readTitlePortalItem(i){return this.sublayerTitleMode!=="item-title"?void 0:i}readTitleService(i,r){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return U_e(this.url,r.name);let n=r.name;if(!n&&this.url){const o=Cw(this.url);_(o)&&(n=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&s&&(n=s+" - "+n),jk(n)}set url(i){const r=V_e({layer:this,url:i,nonStandardUrlAllowed:!1,logger:vT});this._set("url",r.url),r.layerId!=null&&this._set("layerId",r.layerId)}writeUrl(i,r,s,n){B_e(this,i,"layers",r,n)}get parsedUrl(){const i=this._get("url");if(!i)return null;const r=js(i);return this.layerId!=null&&(r.path=`${r.path}/layers/${this.layerId}`),r}async _fetchIndexAndUpdateExtent(i,r){this.indexInfo=dwt(this.parsedUrl.path,this.rootNode,i,this.apiKey,vT,r),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(i){var r,s,n;if((i==null?void 0:i.type)==="page"){const o=i.rootIndex%i.pageSize,a=(s=(r=i.rootPage)==null?void 0:r.nodes)==null?void 0:s[o];if(a==null||a.obb==null||a.obb.center==null||a.obb.halfSize==null)throw new j("sceneservice:invalid-node-page","Invalid node page.");if(a.obb.center[0]<G8||this.fullExtent==null||this.fullExtent.hasZ)return;const l=a.obb.halfSize,c=a.obb.center[2],h=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-h,this.fullExtent.zmax=c+h}else if((i==null?void 0:i.type)==="node"){const o=(n=i.rootNode)==null?void 0:n.mbs;if(!Array.isArray(o)||o.length!==4||o[0]<G8)return;const a=o[2],l=o[3];this.fullExtent.zmin=a-l,this.fullExtent.zmax=a+l}}async _fetchService(i){if(this.url==null)throw new j("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(i);r!=null&&(this.layerId=r)}return this._fetchServiceLayer(i)}async _fetchFirstLayerId(i){const r=await Zt(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:i});if(r.data&&Array.isArray(r.data.layers)&&r.data.layers.length>0)return r.data.layers[0].id}async _fetchServiceLayer(i){const r=await Zt(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:i});r.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let s=!1;if(r.data.layerType&&r.data.layerType==="Voxel"&&(s=!0),s)return this._fetchVoxelServiceLayer();const n=r.data;this.read(n,{origin:"service",url:this.parsedUrl}),this.validateLayer(n)}async _fetchVoxelServiceLayer(i){const r=(await Zt(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:i})).data;this.read(r,{origin:"service",url:this.parsedUrl}),this.validateLayer(r)}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(i){}_updateTypeKeywords(i,r,s){i.typeKeywords||(i.typeKeywords=[]);const n=r.getTypeKeywords();for(const o of n)i.typeKeywords.push(o);i.typeKeywords&&(i.typeKeywords=i.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),s===GM.newItem&&(i.typeKeywords=i.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(i,r){const s=F(F({},Jue),r);let n=nE.from(i);n||(vT.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new j("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),n.id&&(n=n.clone(),n.id=null);const o=n.portal||Gn.getDefault();await this._ensureLoadBeforeSave(),n.type=DL,n.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:n,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations),await this._validateAgainstJSONSchema(l,a,s),n.url=this.url,n.title||(n.title=this.title),this._updateTypeKeywords(n,s,GM.newItem),await o._signIn(),await o.user.addItem({item:n,folder:s&&s.folder,data:l}),await Yue(this.resourceReferences,a,null),this.portalItem=n,Zue(a),a.portalItem=n,n}async _save(i){const r=F(F({},Jue),i);this.portalItem||(vT.error("_save(): requires the .portalItem property to be set"),await Promise.reject(new j("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),this.portalItem.type!==DL&&(vT.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+DL),await Promise.reject(new j("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${DL}"`))),await this._ensureLoadBeforeSave();const s={origin:"portal-item",url:this.portalItem.itemUrl&&js(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||Gn.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},n={layers:[this.write({},s)]};return await Promise.all(s.resources.pendingOperations),await this._validateAgainstJSONSchema(n,s,r),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,r,GM.existingItem),await this.portalItem.update({data:n}),await Yue(this.resourceReferences,s,null),Zue(s),this.portalItem}async _validateAgainstJSONSchema(i,r,s){let n=r.messages.filter(o=>o.type==="error").map(o=>new j(o.name,o.message,o.details));if(s&&s.validationOptions.ignoreUnsupported&&(n=n.filter(o=>o.name!=="layer:unsupported"&&o.name!=="symbol:unsupported"&&o.name!=="symbol-layer:unsupported"&&o.name!=="property:unsupported"&&o.name!=="url:unsupported"&&o.name!=="scenemodification:unsupported")),s.validationOptions.enabled||bwt){const o=(await import("./schemaValidator.1583a6d3.js")).validate(i,s.portalItemLayerType);if(o.length>0){const a=`Layer item did not validate:
${o.join(`
`)}`;if(vT.error(`_validateAgainstJSONSchema(): ${a}`),s.validationOptions.failPolicy==="throw"){const l=o.map(c=>new j("sceneservice:schema-validation",c)).concat(n);throw new j("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:l})}}}if(n.length>0)throw new j("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:n})}};return u([d(q_e)],t.prototype,"id",void 0),u([d({type:et})],t.prototype,"spatialReference",void 0),u([Ie("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readSpatialReference",null),u([d({type:ai})],t.prototype,"fullExtent",void 0),u([Ie("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],t.prototype,"readFullExtent",null),u([d({readOnly:!0,type:ox})],t.prototype,"heightModelInfo",void 0),u([d({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],t.prototype,"minScale",void 0),u([d({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],t.prototype,"maxScale",void 0),u([d({readOnly:!0})],t.prototype,"version",void 0),u([Ie("version",["store.version"])],t.prototype,"readVersion",null),u([d({type:String,json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),u([d({type:String,json:{read:!1}})],t.prototype,"sublayerTitleMode",void 0),u([d({type:String})],t.prototype,"title",void 0),u([Ie("portal-item","title")],t.prototype,"readTitlePortalItem",null),u([Ie("service","title",["name"])],t.prototype,"readTitleService",null),u([d({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],t.prototype,"layerId",void 0),u([d(j_e)],t.prototype,"url",null),u([qe("url")],t.prototype,"writeUrl",null),u([d()],t.prototype,"parsedUrl",null),u([d({readOnly:!0})],t.prototype,"store",void 0),u([d({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],t.prototype,"rootNode",void 0),t=u([P("esri.layers.mixins.SceneService")],t),t},G8=-1e38,bwt=!1;var GM;(function(e){e[e.existingItem=0]="existingItem",e[e.newItem=1]="newItem"})(GM||(GM={}));const DL="Scene Service",Jue={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var f_;(function(e){e[e.SAVE=0]="SAVE",e[e.SAVE_AS=1]="SAVE_AS"})(f_||(f_={}));const wwt={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};class xwt{constructor(t,i,r,s){this.parsedUrl=t,this.portalItem=i,this.apiKey=r,this.signal=s,this.rootDocument=null;const n=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);n&&(this.urlParts={root:n[1],layerId:parseInt(n[2],10)})}async fetch(){var r;if(!this.urlParts)return null;const t=(r=this.portalItem)!=null?r:await this._portalItemFromServiceItemId();if(R(t))return this._loadFromUrl();const i=await this._findAndLoadRelatedPortalItem(t);return R(i)?null:this._loadFeatureLayerFromPortalItem(i)}async fetchPortalItem(){var i;if(!this.urlParts)return null;const t=(i=this.portalItem)!=null?i:await this._portalItemFromServiceItemId();return R(t)?null:this._findAndLoadRelatedPortalItem(t)}async _fetchRootDocument(){if(_(this.rootDocument))return this.rootDocument;if(R(this.urlParts))return this.rootDocument={},{};const t={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},i=`${this.urlParts.root}/SceneServer`;try{const r=await Zt(i,t);this.rootDocument=r.data}catch{this.rootDocument={}}return this.rootDocument}async _fetchServiceOwningPortalUrl(){const t=Gr==null?void 0:Gr.findServerInfo(this.parsedUrl.path);if(t==null?void 0:t.owningSystemUrl)return t.owningSystemUrl;const i=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const r=(await Zt(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(r)return r}catch(r){bc(r)}return null}async _findAndLoadRelatedPortalItem(t){try{return(await t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(i=>i.type==="Feature Service")||null}catch(i){return bc(i),null}}async _loadFeatureLayerFromPortalItem(t){await t.load({signal:this.signal});const i=await this._findMatchingAssociatedSublayerUrl(t.url);return new l4({url:i,portalItem:t}).load({signal:this.signal})}async _loadFromUrl(){const t=await this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return new l4({url:t}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(t){const i=t.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),r={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},s=this.urlParts.layerId,n=this._fetchRootDocument(),o=Zt(i,r),[a,l]=await Promise.all([o,n]),c=l&&l.layers,h=a.data&&a.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(c)){for(let p=0;p<Math.min(c.length,h.length);p++)if(c[p].id===s)return`${i}/${h[p].id}`}else if(s<h.length)return`${i}/${h[s].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const t=(await this._fetchRootDocument()).serviceItemId;if(!t)return null;const i=new nE({id:t,apiKey:this.apiKey}),r=await this._fetchServiceOwningPortalUrl();_(r)&&(i.portal=new Gn({url:r}));try{return i.load({signal:this.signal})}catch(s){return bc(s),null}}}let dv=class extends ve{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};u([d({type:Number})],dv.prototype,"nodesPerPage",void 0),u([d({type:Number})],dv.prototype,"rootIndex",void 0),u([d({type:String})],dv.prototype,"lodSelectionMetricType",void 0),dv=u([P("esri.layer.support.I3SNodePageDefinition")],dv);let $g=class extends ve{constructor(){super(...arguments),this.factor=1}};u([d({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],$g.prototype,"id",void 0),u([d({type:Number})],$g.prototype,"factor",void 0),$g=u([P("esri.layer.support.I3SMaterialTexture")],$g);let G0=class extends ve{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};u([d({type:[Number]})],G0.prototype,"baseColorFactor",void 0),u([d({type:$g})],G0.prototype,"baseColorTexture",void 0),u([d({type:$g})],G0.prototype,"metallicRoughnessTexture",void 0),u([d({type:Number})],G0.prototype,"metallicFactor",void 0),u([d({type:Number})],G0.prototype,"roughnessFactor",void 0),G0=u([P("esri.layer.support.I3SMaterialPBRMetallicRoughness")],G0);let nu=class extends ve{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};u([at({opaque:"opaque",mask:"mask",blend:"blend"})],nu.prototype,"alphaMode",void 0),u([d({type:Number})],nu.prototype,"alphaCutoff",void 0),u([d({type:Boolean})],nu.prototype,"doubleSided",void 0),u([at({none:"none",back:"back",front:"front"})],nu.prototype,"cullFace",void 0),u([d({type:$g})],nu.prototype,"normalTexture",void 0),u([d({type:$g})],nu.prototype,"occlusionTexture",void 0),u([d({type:$g})],nu.prototype,"emissiveTexture",void 0),u([d({type:[Number]})],nu.prototype,"emissiveFactor",void 0),u([d({type:G0})],nu.prototype,"pbrMetallicRoughness",void 0),nu=u([P("esri.layer.support.I3SMaterialDefinition")],nu);let ZR=class extends ve{};u([d({type:String,json:{read:{source:["name","index"],reader:(e,t)=>e!=null?e:`${t.index}`}}})],ZR.prototype,"name",void 0),u([at({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],ZR.prototype,"format",void 0),ZR=u([P("esri.layer.support.I3STextureFormat")],ZR);let qS=class extends ve{constructor(){super(...arguments),this.atlas=!1}};u([d({type:[ZR]})],qS.prototype,"formats",void 0),u([d({type:Boolean})],qS.prototype,"atlas",void 0),qS=u([P("esri.layer.support.I3STextureSetDefinition")],qS);let Xd=class extends ve{};u([at({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Xd.prototype,"type",void 0),u([d({type:Number})],Xd.prototype,"component",void 0),Xd=u([P("esri.layer.support.I3SGeometryAttribute")],Xd);let YR=class extends ve{};u([at({draco:"draco"})],YR.prototype,"encoding",void 0),u([d({type:[String]})],YR.prototype,"attributes",void 0),YR=u([P("esri.layer.support.I3SGeometryCompressedAttributes")],YR);let _d=class extends ve{constructor(){super(...arguments),this.offset=0}};u([d({type:Number})],_d.prototype,"offset",void 0),u([d({type:Xd})],_d.prototype,"position",void 0),u([d({type:Xd})],_d.prototype,"normal",void 0),u([d({type:Xd})],_d.prototype,"uv0",void 0),u([d({type:Xd})],_d.prototype,"color",void 0),u([d({type:Xd})],_d.prototype,"uvRegion",void 0),u([d({type:Xd})],_d.prototype,"featureId",void 0),u([d({type:Xd})],_d.prototype,"faceRange",void 0),u([d({type:YR})],_d.prototype,"compressedAttributes",void 0),_d=u([P("esri.layer.support.I3SGeometryBuffer")],_d);let WS=class extends ve{};u([at({triangle:"triangle"})],WS.prototype,"topology",void 0),u([d()],WS.prototype,"geometryBuffers",void 0),WS=u([P("esri.layer.support.I3SGeometryDefinition")],WS);let j0=class extends ve{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};u([d({type:String,json:{read:!0,write:!0}})],j0.prototype,"name",void 0),u([d({type:String,json:{read:!0,write:!0}})],j0.prototype,"field",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],j0.prototype,"currentRangeExtent",void 0),u([d({type:[Number],json:{read:!0,write:!0}})],j0.prototype,"fullRangeExtent",void 0),u([d({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],j0.prototype,"type",void 0),j0=u([P("esri.layers.support.RangeInfo")],j0);function tW(e){return cK[Twt(e)]||Ewt}function Twt(e){return e instanceof Blob?e.type:Swt(e.url)}function Swt(e){const t=gX(e);return iW[t]||nAe}const cK={},nAe="text/plain",Ewt=cK[nAe],iW={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const e in iW)cK[iW[e]]=e;function S5(e){const t=_(e)&&e.origins?e.origins:[void 0];return(i,r)=>{const s=Cwt(e,i,r);for(const n of t){const o=SW(i,n,r);for(const a in s)o[a]=s[a]}}}function Cwt(e,t,i){if(_(e)&&e.type==="resource")return Awt(e,t,i);switch(_(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:r,write:s}=TIe;return{read:r,write:s}}}}function Awt(e,t,i){const r=S3(t,i);return{type:String,read:(s,n,o)=>{const a=W5(s,n,o);return r.type===String?a:typeof r.type=="function"?new r.type({url:a}):void 0},write:{writer(s,n,o,a){if(!a||!a.resources)return typeof s=="string"?void(n[o]=Kg(s,a)):void(n[o]=s.write({},a));const l=Pwt(s),c=l?Kg(l,ye(F({},a),{verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),z2.NO):null,h=r.type!==String&&(!eAe(this)||a&&a.origin&&this.originIdOf(i)>Ag(a.origin));a&&a.portalItem&&_(c)&&!wc(c)?h?Rwt(this,i,s,c,n,o,a,e):Mwt(c,n,o,a):a&&a.portalItem&&(R(c)||_(rfe(c))||Wv(c)||h)?oAe(this,i,s,c,n,o,a,e):n[o]=c}}}}function oAe(e,t,i,r,s,n,o,a){const l=bZ(),c=lAe(i,r,o),h=Ll(xr(a,"prefix"),l),p=`${h}.${tW(c)}`,f=o.portalItem.resourceFromPath(p);Wv(r)&&o.resources.pendingOperations.push(Owt(r).then(m=>{f.path=`${h}.${tW(m)}`,s[n]=f.itemRelativeUrl}).catch(()=>{})),aAe(e,t,f,c,o.resources.toAdd),s[n]=f.itemRelativeUrl}function Rwt(e,t,i,r,s,n,o,a){const l=o.portalItem.resourceFromPath(r),c=lAe(i,r,o);tW(c)===gX(l.path)?(aAe(e,t,l,c,o.resources.toUpdate),s[n]=r):oAe(e,t,i,r,s,n,o,a)}function Mwt(e,t,i,r){r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(e)}),t[i]=e}function aAe(e,t,i,r,s){s.push({resource:i,content:r,finish:n=>{Iwt(e,t,n)}})}function lAe(e,t,i){return typeof e=="string"?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}async function Owt(e){const t=(await Promise.resolve().then(function(){return gfe})).default,{data:i}=await t(e,{responseType:"blob"});return i}function Pwt(e){return R(e)?null:typeof e=="string"?e:e.url}function Iwt(e,t,i){typeof e[t]=="string"?e[t]=i.url:e[t].url=i.url}var BN;let rW=BN=class extends Yw(ut.ofType(Go)){constructor(e){super(e)}clone(){return new BN(this.items.map(e=>e.clone()))}write(e,t){return this.toJSON(t)}toJSON(e){var i;const t=(i=e==null?void 0:e.layer)==null?void 0:i.spatialReference;return t?this.toArray().map(r=>{if(!t.equals(r.spatialReference)){if(!im(r.spatialReference,t))return e&&e.messages&&e.messages.push(new ja("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),null;const n=new Go;rge(r,n,t),r=n}const s=r.toJSON(e);return delete s.spatialReference,s}).filter(r=>r!=null):((e==null?void 0:e.messages)&&e.messages.push(new ja("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:e.layer.spatialReference,context:e})),this.toArray().map(r=>r.toJSON(e)))}static fromJSON(e,t){const i=new BN;return e.forEach(r=>i.add(Go.fromJSON(r,t))),i}};rW=BN=u([P("esri.layers.support.PolygonCollection")],rW);const sW=rW;var nW;let yS=nW=class extends ve{constructor(e){super(e),this.spatialRelationship="disjoint",this.geometries=new sW,this._geometriesSource=null,this._handles=new Nt}initialize(){this._handles.add(ns(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,qi))}destroy(){this._handles.destroy()}readGeometries(e,t,i){this._geometriesSource={url:Qf(e,i),context:i}}async loadGeometries(e,t){if(R(this._geometriesSource))return;const{url:i,context:r}=this._geometriesSource,s=await Zt(i,{responseType:"json",signal:xr(t,"signal")}),n=e.toJSON(),o=s.data.map(a=>ye(F({},a),{spatialReference:n}));this.geometries=sW.fromJSON(o,r),this._geometriesSource=null}clone(){return new nW({geometries:re(this.geometries),spatialRelationship:this.spatialRelationship})}};u([d({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],yS.prototype,"spatialRelationship",void 0),u([d({type:sW,nonNullable:!0,json:{write:!0}}),S5({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],yS.prototype,"geometries",void 0),u([Ie(["web-scene","portal-item"],"geometries")],yS.prototype,"readGeometries",null),yS=nW=u([P("esri.layers.support.SceneFilter")],yS);const $wt=yS,Lwt=["3DObject","Point"],_T=fe.getLogger("esri.layers.SceneLayer"),Kue=a1e();let It=class extends sAe(fY(gY(yY(vY(Gk(pY(sE))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new ut,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var r,s,n,o;const i=(s=(r=this.getFeatureType(t==null?void 0:t.feature))==null?void 0:r.domains)==null?void 0:s[e];return i&&i.type!=="inherited"?i:(o=(n=this.getField(e))==null?void 0:n.domain)!=null?o:null}getFeatureType(e){return e&&_(this.associatedLayer)?this.associatedLayer.getFeatureType(e):null}get types(){return _(this.associatedLayer)?this.associatedLayer.types:[]}get typeIdField(){return _(this.associatedLayer)?this.associatedLayer.typeIdField:null}get formTemplate(){return _(this.associatedLayer)?this.associatedLayer.formTemplate:null}get fieldsIndex(){return new o1e(this.fields)}readNodePages(e,t,i){return t.layerType==="Point"&&(e=t.pointNodePages),e==null||typeof e!="object"?null:dv.fromJSON(e,i)}set elevationInfo(e){this._set("elevationInfo",e),this.loaded&&this._validateElevationInfo()}get geometryType(){return Dwt[this.profile]||"mesh"}set renderer(e){cF(e,this.fieldsIndex),this._set("renderer",e)}readCachedDrawingInfo(e){return e!=null&&typeof e=="object"||(e={}),e.color==null&&(e.color=!1),e}get capabilities(){const e=_(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:wwt,{query:t,editing:{supportsGlobalId:i,supportsRollbackOnFailure:r,supportsUploadWithItemId:s,supportsReturnServiceEditsInSourceSpatialReference:n},data:{supportsZ:o,supportsM:a,isVersioned:l,supportsAttachment:c},operations:{supportsEditing:h,supportsUpdate:p,supportsQuery:f,supportsQueryAttachments:m}}=e,y=e.operations.supportsChangeTracking;return{query:t,editing:{supportsGlobalId:i,supportsReturnServiceEditsInSourceSpatialReference:n,supportsRollbackOnFailure:r,supportsGeometryUpdate:!1,supportsUploadWithItemId:s},data:{supportsAttachment:c,supportsZ:o,supportsM:a,isVersioned:l},operations:{supportsQuery:f,supportsQueryAttachments:m,supportsEditing:h&&y,supportsAdd:!1,supportsDelete:!1,supportsUpdate:p&&y}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}get defaultPopupTemplate(){return _(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(i=>(i.type==="esriFieldTypeOID"&&(e=i.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(i=>(i.type==="esriFieldTypeGlobalID"&&(e=i.name),!!e)),e||void 0}get displayField(){return _(this.associatedLayer)?this.associatedLayer.displayField:null}readProfile(e,t){const i=t.store.profile;return i!=null&&ehe[i]?ehe[i]:(_T.error("Unknown or missing profile",{profile:i,layer:this}),"mesh-pyramids")}load(e){const t=_(e)?e.signal:null,i=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(bc).then(()=>this._fetchService(t)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),_(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>c1e(this,{origin:"service"},t)).then(()=>cF(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}async beforeSave(){_(this.filter)&&await this.load()}createQuery(){const e=new Fh;return this.geometryType!=="mesh"&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||"1=1",e.sqlFormat="standard",e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryFeatures(e||this.createQuery(),t)).then(i=>{if(i==null?void 0:i.features)for(const r of i.features)r.layer=this,r.sourceLayer=this;return i})}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(i=>i.queryAttachments(e,t))}getFieldUsageInfo(e){const t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(_T.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),t)}createPopupTemplate(e){return u1e(this,e)}_getAssociatedLayerForQuery(){const e=this.associatedLayer;return _(e)&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),R(this.associatedLayer))throw new j("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(e){throw new j("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){if(await this.load(t),!this.statisticsInfo)throw new j("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const i=this.fieldsIndex.get(e);if(!i)throw new j("scenelayer:field-unexisting",`Field '${e}' does not exist on the layer`);for(const r of this.statisticsInfo)if(r.name===i.name){const s=Ll(this.parsedUrl.path,r.href);return Zt(s,{query:{f:"json",token:this.apiKey},responseType:"json",signal:t?t.signal:null}).then(n=>n.data)}throw new j("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(e,t){return this._debouncedSaveOperations(f_.SAVE_AS,ye(F({},t),{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"}),e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(f_.SAVE,e)}async applyEdits(e,t){const i=await import("./editingSupport.311b5f05.js");if(await this.load(),R(this.associatedLayer))throw new j(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),i.applyEdits(this,this.associatedLayer.source,e,t)}on(e,t){return super.on(e,t)}validateLayer(e){if(e.layerType&&!Lwt.includes(e.layerType))throw new j("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new j("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new j("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function t(i,r){let s=!1,n=!1;if(i==null)s=!0,n=!0;else{const o=r&&r.isGeographic;switch(i){case"east-north-up":case"earth-centered":s=!0,n=o;break;case"vertex-reference-frame":s=!0,n=!o;break;default:s=!1}}if(!s)throw new j("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!n)throw new j("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const e=[];if(this.profile==="points")e.push("Point");else{if(this.profile!=="mesh-pyramids")throw new j("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);e.push("3DObject")}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const e of this.fields){const t=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(s=>s.name===e.name)),i=!!(_(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(s=>s&&e.name===s.name)),r={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||i,supportsLayerQuery:i};this._fieldUsageInfo[e.name]=r}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides()}_applyAssociatedLayerFieldsOverrides(){if(R(this.associatedLayer)||!this.associatedLayer.fields)return;let e=null;for(const t of this.associatedLayer.fields){const i=this.getField(t.name);i?(!i.domain&&t.domain&&(i.domain=t.domain.clone()),i.editable=t.editable,i.nullable=t.nullable,i.length=t.length):(e||(e=this.fields?this.fields.slice():[]),e.push(t.clone()))}e&&this._set("fields",e)}_applyAssociatedLayerPopupOverrides(){if(R(this.associatedLayer))return;const e=["popupTemplate","popupEnabled"],t=ua(this);for(let i=0;i<e.length;i++){const r=e[i],s=this.originIdOf(r),n=this.associatedLayer.originIdOf(r);s<n&&(n===Vt.SERVICE||n===Vt.PORTAL_ITEM)&&t.setAtOrigin(r,this.associatedLayer[r],n)}}async _setAssociatedFeatureLayer(e){if(!["mesh-pyramids","points"].includes(this.profile))return;const t=new xwt(this.parsedUrl,this.portalItem,this.apiKey,e);try{this.associatedLayer=await t.fetch()}catch(i){Jr(i)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await _w(()=>this.popupEnabled&&this.popupTemplate!=null);const e=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?_T.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${e}`):_T.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${e}`)}_validateElevationInfo(){const e=this.elevationInfo;e&&(this.profile==="mesh-pyramids"&&e.mode==="relative-to-scene"&&_T.warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),e.featureExpressionInfo&&e.featureExpressionInfo.expression!=="0"&&_T.warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};u([d({types:{key:"type",base:kg,typeMap:{selection:lH}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],It.prototype,"featureReduction",void 0),u([d({type:[j0],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],It.prototype,"rangeInfos",void 0),u([d({json:{read:!1}})],It.prototype,"associatedLayer",void 0),u([d({type:["show","hide"]})],It.prototype,"listMode",void 0),u([d({type:["ArcGISSceneServiceLayer"]})],It.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],It.prototype,"type",void 0),u([d(ye(F({},Kue.fields),{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],It.prototype,"fields",void 0),u([d()],It.prototype,"types",null),u([d()],It.prototype,"typeIdField",null),u([d()],It.prototype,"formTemplate",null),u([d({readOnly:!0})],It.prototype,"fieldsIndex",null),u([d({type:l1e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],It.prototype,"floorInfo",void 0),u([d(Kue.outFields)],It.prototype,"outFields",void 0),u([d({type:dv,readOnly:!0,json:{read:!1}})],It.prototype,"nodePages",void 0),u([Ie("service","nodePages",["nodePages","pointNodePages"])],It.prototype,"readNodePages",null),u([d({type:[nu],readOnly:!0})],It.prototype,"materialDefinitions",void 0),u([d({type:[qS],readOnly:!0})],It.prototype,"textureSetDefinitions",void 0),u([d({type:[WS],readOnly:!0})],It.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],It.prototype,"serviceUpdateTimeStamp",void 0),u([d({readOnly:!0})],It.prototype,"attributeStorageInfo",void 0),u([d({readOnly:!0})],It.prototype,"statisticsInfo",void 0),u([d({type:ut.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],It.prototype,"excludeObjectIds",void 0),u([d({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],It.prototype,"definitionExpression",void 0),u([d({type:$wt,json:{name:"layerDefinition.polygonFilter",write:!0}})],It.prototype,"filter",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],It.prototype,"path",void 0),u([d(mY)],It.prototype,"elevationInfo",null),u([d({type:String})],It.prototype,"geometryType",null),u([d(qk)],It.prototype,"labelsVisible",void 0),u([d({type:[W3],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:a4},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:a4},write:!0}})],It.prototype,"labelingInfo",void 0),u([d(H_e)],It.prototype,"legendEnabled",void 0),u([d({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(e,t){var r,s;if(typeof e=="number"&&e>=0&&e<=1)return e;const i=(s=(r=t.layerDefinition)==null?void 0:r.drawingInfo)==null?void 0:s.transparency;return i!==void 0?k2(i):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],It.prototype,"opacity",void 0),u([d({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],It.prototype,"priority",void 0),u([d({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],It.prototype,"semantic",void 0),u([d({types:R_e,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],It.prototype,"renderer",null),u([d({json:{read:!1}})],It.prototype,"cachedDrawingInfo",void 0),u([Ie("service","cachedDrawingInfo")],It.prototype,"readCachedDrawingInfo",null),u([d({readOnly:!0,json:{read:!1}})],It.prototype,"capabilities",null),u([d({type:Boolean,json:{read:!1}})],It.prototype,"editingEnabled",null),u([d(Hk)],It.prototype,"popupEnabled",void 0),u([d({type:WE,json:{name:"popupInfo",write:!0}})],It.prototype,"popupTemplate",void 0),u([d({readOnly:!0,json:{read:!1}})],It.prototype,"defaultPopupTemplate",null),u([d({type:String,json:{read:!1}})],It.prototype,"objectIdField",void 0),u([Ie("service","objectIdField",["objectIdField","fields"])],It.prototype,"readObjectIdField",null),u([d({type:String,json:{read:!1}})],It.prototype,"globalIdField",void 0),u([Ie("service","globalIdField",["globalIdField","fields"])],It.prototype,"readGlobalIdField",null),u([d({readOnly:!0,type:String,json:{read:!1}})],It.prototype,"displayField",null),u([d({type:String,json:{read:!1}})],It.prototype,"profile",void 0),u([Ie("service","profile",["store.profile"])],It.prototype,"readProfile",null),u([d({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],It.prototype,"normalReferenceFrame",void 0),u([d(G_e)],It.prototype,"screenSizePerspectiveEnabled",void 0),It=u([P("esri.layers.SceneLayer")],It);const ehe={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Dwt={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},Nwt=It;var GCt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Nwt}),oW;let vS=oW=class extends ve{constructor(e){super(e),this.geometry=null,this.type="clip"}writeGeometry(e,t,i,r){if(r.layer&&r.layer.spatialReference&&!r.layer.spatialReference.equals(this.geometry.spatialReference)){if(!im(e.spatialReference,r.layer.spatialReference))return void(r&&r.messages&&r.messages.push(new ja("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:r.layer.spatialReference,context:r})));const s=new Go;rge(e,s,r.layer.spatialReference),t[i]=s.toJSON(r)}else t[i]=e.toJSON(r);delete t[i].spatialReference}clone(){return new oW({geometry:re(this.geometry),type:this.type})}};u([d({type:Go}),S5()],vS.prototype,"geometry",void 0),u([qe(["web-scene","portal-item"],"geometry")],vS.prototype,"writeGeometry",null),u([d({type:["clip","mask","replace"],nonNullable:!0}),S5()],vS.prototype,"type",void 0),vS=oW=u([P("esri.layers.support.SceneModification")],vS);const j8=vS;var QR;let GN=QR=class extends Yw(ut.ofType(j8)){constructor(e){super(e),this.url=null}clone(){return new QR({url:this.url,items:this.items.map(e=>e.clone())})}toJSON(e){return this.toArray().map(t=>t.toJSON(e)).filter(t=>!!t.geometry)}static fromJSON(e,t){const i=new QR;for(const r of e)i.add(j8.fromJSON(r,t));return i}static async fromUrl(e,t,i){const r={url:js(e),origin:"service"},s=await Zt(e,{responseType:"json",signal:xr(i,"signal")}),n=t.toJSON(),o=[];for(const a of s.data)o.push(j8.fromJSON(ye(F({},a),{geometry:ye(F({},a.geometry),{spatialReference:n})}),r));return new QR({url:e,items:o})}};u([d({type:String})],GN.prototype,"url",void 0),GN=QR=u([P("esri.layers.support.SceneModifications")],GN);const cAe=GN;let Pa=class extends sAe(fY(gY(yY(vY(Gk(pY(sE))))))){constructor(...e){super(...e),this._handles=new Nt,this.geometryType="mesh",this.operationalLayerType="IntegratedMeshLayer",this.type="integrated-mesh",this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.profile="mesh-pyramids",this.modifications=null,this._modificationsSource=null,this.elevationInfo=null,this.path=null}destroy(){this._handles.destroy()}initialize(){this._handles.add(ns(()=>this.modifications,"after-changes",()=>this.modifications=this.modifications,qi))}normalizeCtorArgs(e,t){return typeof e=="string"?F({url:e},t):e}readModifications(e,t,i){this._modificationsSource={url:Qf(e,i),context:i}}async load(e){return this.addResolvingPromise(this._doLoad(e)),this}async _doLoad(e){const t=xr(e,"signal");try{await this.loadFromPortal({supportedTypes:["Scene Service"]},e)}catch(i){bc(i)}if(await this._fetchService(t),_(this._modificationsSource)){const i=await cAe.fromUrl(this._modificationsSource.url,this.spatialReference,e);this.setAtOrigin("modifications",i,this._modificationsSource.context.origin),this._modificationsSource=null}await this._fetchIndexAndUpdateExtent(this.nodePages,t)}beforeSave(){if(!R(this._modificationsSource))return this.load().then(()=>{},()=>{})}async saveAs(e,t){return this._debouncedSaveOperations(f_.SAVE_AS,ye(F({},t),{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"integrated-mesh"}),e)}async save(){const e={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"integrated-mesh"};return this._debouncedSaveOperations(f_.SAVE,e)}validateLayer(e){if(e.layerType&&e.layerType!=="IntegratedMesh")throw new j("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new j("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(this.version.major>1)throw new j("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"})}_getTypeKeywords(){return["IntegratedMeshLayer"]}};u([d({type:String,readOnly:!0})],Pa.prototype,"geometryType",void 0),u([d({type:["show","hide"]})],Pa.prototype,"listMode",void 0),u([d({type:["IntegratedMeshLayer"]})],Pa.prototype,"operationalLayerType",void 0),u([d({json:{read:!1},readOnly:!0})],Pa.prototype,"type",void 0),u([d({type:dv,readOnly:!0})],Pa.prototype,"nodePages",void 0),u([d({type:[nu],readOnly:!0})],Pa.prototype,"materialDefinitions",void 0),u([d({type:[qS],readOnly:!0})],Pa.prototype,"textureSetDefinitions",void 0),u([d({type:[WS],readOnly:!0})],Pa.prototype,"geometryDefinitions",void 0),u([d({readOnly:!0})],Pa.prototype,"serviceUpdateTimeStamp",void 0),u([d({type:cAe}),S5({origins:["web-scene","portal-item"],type:"resource",prefix:"modifications"})],Pa.prototype,"modifications",void 0),u([Ie(["web-scene","portal-item"],"modifications")],Pa.prototype,"readModifications",null),u([d(mY)],Pa.prototype,"elevationInfo",void 0),u([d({type:String,json:{origins:{"web-scene":{read:!0,write:!0},"portal-item":{read:!0,write:!0}},read:!1}})],Pa.prototype,"path",void 0),Pa=u([P("esri.layers.IntegratedMeshLayer")],Pa);const Fwt=Pa;var jCt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Fwt});let dg=class extends IY(as.EventedAccessor){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then(()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))})}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new j("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=new AbortController;this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch{}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};u([d()],dg.prototype,"_goingHomeController",void 0),u([d({readOnly:!0})],dg.prototype,"state",null),u([d()],dg.prototype,"view",null),u([d({type:Xh})],dg.prototype,"viewpoint",null),u([d()],dg.prototype,"go",null),u([d()],dg.prototype,"cancelGo",null),dg=u([P("esri.widgets.Home.HomeViewModel")],dg);const uAe=dg,h1={base:"esri-home esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",homeIcon:"esri-icon esri-icon-home",loadingIcon:"esri-icon-loading-indicator",rotatingIcon:"esri-rotating",widgetIcon:"esri-icon-home",disabled:"esri-disabled"};let pl=class extends Wn{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=h1.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.view=null,this.viewModel=new uAe,this.viewpoint=null}get homeTitle(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{messagesCommon:t,messages:i}=this;return e==="going-home"?t.cancel:i.title}cancelGo(){return null}go(){return null}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{homeTitle:t}=this,i={[h1.disabled]:e==="disabled"};return k("div",{bind:this,class:this.classes(h1.base,i),role:"button",tabIndex:0,onclick:this._go,onkeydown:this._go,"aria-label":t,title:t},this.renderIcon(),this.renderText())}renderIcon(){var i;const e=(i=this.viewModel)==null?void 0:i.state,t={[h1.loadingIcon]:e==="going-home",[h1.rotatingIcon]:e==="going-home"};return k("span",{"aria-hidden":"true",class:this.classes(h1.homeIcon,t)})}renderText(){const{messages:e}=this;return k("span",{class:h1.text},e.button)}_go(){const{viewModel:e}=this;e.state==="going-home"?e.cancelGo():e.go()}};u([Xe("viewModel.goToOverride")],pl.prototype,"goToOverride",void 0),u([d({readOnly:!0})],pl.prototype,"homeTitle",null),u([d()],pl.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],pl.prototype,"label",void 0),u([d(),dn("esri/widgets/Home/t9n/Home")],pl.prototype,"messages",void 0),u([d(),dn("esri/t9n/common")],pl.prototype,"messagesCommon",void 0),u([Xe("viewModel.view")],pl.prototype,"view",void 0),u([d({type:uAe}),b0e("go")],pl.prototype,"viewModel",void 0),u([Xe("viewModel.viewpoint")],pl.prototype,"viewpoint",void 0),u([Xe("viewModel.cancelGo")],pl.prototype,"cancelGo",null),u([Xe("viewModel.go")],pl.prototype,"go",null),u([gl()],pl.prototype,"_go",null),pl=u([P("esri.widgets.Home")],pl);const HCt=pl,b3=-1;let wf=class extends Se{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=he("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(the(e))}catch(t){this._transitionTo([]),fe.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return this._to!==null}canTransitionTo(e){try{return this.scale>0&&ihe(this._current,the(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}end(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&ihe(this._current,e,this.scale)?(this._final=e,this._to=re(e),kwt(this._current,this._to,this.scale),this._from=re(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?re(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let i=0;i<this._current.length;i++){const r=this._current[i],s=this._from[i],n=this._to[i];r.scale=Uwt(s.scale,n.scale,t);for(let o=0;o<r.effects.length;o++){const a=r.effects[o],l=s.effects[o],c=n.effects[o];a.interpolate(l,c,t)}}t===1&&(this._current=this._final,this._set("effects",this._current[0]?re(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),this._current.length===0)return;const t=this._current,i=this._current.length-1;let r,s,n=1;if(t.length===1||e>=t[0].scale)s=r=t[0].effects;else if(e<=t[i].scale)s=r=t[i].effects;else for(let o=0;o<i;o++){const a=t[o],l=t[o+1];if(a.scale>=e&&l.scale<=e){n=(e-a.scale)/(l.scale-a.scale),r=a.effects,s=l.effects;break}}for(let o=0;o<this.effects.length;o++)this.effects[o].interpolate(r[o],s[o],n)}};function the(e){const t=IZ(e)||[];return zwt(t)?[{scale:b3,effects:t}]:t}function ihe(e,t,i){var r,s,n,o;return!((r=e[0])==null?void 0:r.effects)||!((s=t[0])==null?void 0:s.effects)?!0:!((((n=e[0])==null?void 0:n.scale)===b3||((o=t[0])==null?void 0:o.scale)===b3)&&(e.length>1||t.length>1)&&i<=0)&&S0e(e[0].effects,t[0].effects)}function kwt(e,t,i){var l,c;const r=e.length>t.length?e:t,s=e.length>t.length?t:e,n=s[s.length-1],o=(l=n==null?void 0:n.scale)!=null?l:i,a=(c=n==null?void 0:n.effects)!=null?c:[];for(let h=s.length;h<r.length;h++)s.push({scale:o,effects:[...a]});for(let h=0;h<r.length;h++)s[h].scale=s[h].scale===b3?i:s[h].scale,r[h].scale=r[h].scale===b3?i:r[h].scale,E0e(s[h].effects,r[h].effects)}function Uwt(e,t,i){return e+(t-e)*i}function zwt(e){const t=e[0];return!!t&&"type"in t}u([d()],wf.prototype,"_to",void 0),u([d()],wf.prototype,"duration",void 0),u([d({value:""})],wf.prototype,"effect",null),u([d({readOnly:!0})],wf.prototype,"effects",void 0),u([d({readOnly:!0})],wf.prototype,"hasEffects",null),u([d({value:0})],wf.prototype,"scale",null),u([d({readOnly:!0})],wf.prototype,"transitioning",null),wf=u([P("esri.layers.effects.EffectView")],wf);function qCt(e){var i;const t=e.layer;return"floorInfo"in t&&((i=t.floorInfo)==null?void 0:i.floorField)&&"floors"in e.view?hAe(e.view.floors,t.floorInfo.floorField):null}function rhe(e,t){var i;return"floorInfo"in t&&((i=t.floorInfo)==null?void 0:i.floorField)?hAe(e,t.floorInfo.floorField):null}function hAe(e,t){if(!(e==null?void 0:e.length))return null;const i=e.filter(r=>r!=="").map(r=>`'${r}'`);return i.push("''"),`${t} IN (${i.join(",")}) OR ${t} IS NULL`}function WCt(e,t,i){return t.flatten(({sublayers:s})=>s).length!==e.length?!0:!!e.some(s=>s.originIdOf("minScale")>i||s.originIdOf("maxScale")>i||s.originIdOf("renderer")>i||s.originIdOf("labelingInfo")>i||s.originIdOf("opacity")>i||s.originIdOf("labelsVisible")>i||s.originIdOf("source")>i)||!dAe(e,t)}function Vwt(e,t,i){return!!e.some(r=>{const s=r.source;return!(!s||s.type==="map-layer"&&s.mapLayerId===r.id&&(R(s.gdbVersion)||s.gdbVersion===i))||r.originIdOf("renderer")>Vt.SERVICE||r.originIdOf("labelingInfo")>Vt.SERVICE||r.originIdOf("opacity")>Vt.SERVICE||r.originIdOf("labelsVisible")>Vt.SERVICE})||!dAe(e,t)}function dAe(e,t){if(!e||!e.length||R(t))return!0;const i=t.slice().reverse().flatten(({sublayers:n})=>n&&n.toArray().reverse()).map(n=>n.id).toArray();if(e.length>i.length)return!1;let r=0;const s=i.length;for(const{id:n}of e){for(;r<s&&i[r]!==n;)r++;if(r>=s)return!1}return!0}function XCt(e){return!!e&&e.some(t=>t.minScale!=null||t.layerDefinition&&t.layerDefinition.minScale!=null)}const Bwt={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let iu=class extends g_(Se){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(t=>{const i=rhe(this.floors,t);return t.toExportImageJSON(i)});return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&Vwt(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",t=>this.notifyChange(Bwt[t.propertyName]))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(t=>t.id).join(","):"show:-1":null}get layerDefs(){var i;const e=!!((i=this.floors)==null?void 0:i.length),t=this.visibleSublayers.filter(r=>r.definitionExpression!=null||e&&r.floorInfo!=null);return t.length?JSON.stringify(t.reduce((r,s)=>{const n=rhe(this.floors,s),o=P_e(n,s.definitionExpression);return _(o)&&(r[s.id]=o),r},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=s=>{const n=this.scale,o=n===0,a=s.minScale===0||n<=s.minScale,l=s.maxScale===0||n>=s.maxScale;s.visible&&(o||a&&l)&&(s.sublayers?s.sublayers.forEach(i):e.unshift(s))};t&&t.forEach(i);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some((s,n)=>e[n]!==s)?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=ye(F({},t),{layers:this.layers,layerDefs:this.layerDefs}),t}};u([d({readOnly:!0})],iu.prototype,"dynamicLayers",null),u([d()],iu.prototype,"floors",void 0),u([d({readOnly:!0})],iu.prototype,"hasDynamicLayers",null),u([d()],iu.prototype,"layer",null),u([d({readOnly:!0})],iu.prototype,"layers",null),u([d({readOnly:!0})],iu.prototype,"layerDefs",null),u([d({type:Number})],iu.prototype,"scale",void 0),u([d(gGe)],iu.prototype,"timeExtent",void 0),u([d({readOnly:!0})],iu.prototype,"version",null),u([d({readOnly:!0})],iu.prototype,"visibleSublayers",null),iu=u([P("esri.layers.mixins.ExportImageParameters")],iu);function pAe(e){return R(e)||e.type==="simple"||e.type==="unique-value"||e.type==="class-breaks"||e.type==="dictionary"||e.type==="heatmap"}function ZCt(e){if(R(e))return null;if(!pAe(e))return new j("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return Gwt(e);case"unique-value":return jwt(e);case"class-breaks":return Hwt(e);case"dictionary":case"heatmap":return null}return null}function uK(e,t){if(!t)return null;let i;if(i=Array.isArray(t)?t:[t],i.length>0){const r=i.map(n=>n.details.symbol.type||n.details.symbol.declaredClass).filter(n=>!!n);r.sort();const s=[];return r.forEach((n,o)=>{o!==0&&n===r[o-1]||s.push(n)}),new j("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${s.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:i})}return null}function Gwt(e){return uK(e,H2(e.symbol).error)}function jwt(e){const t=e.uniqueValueInfos.map(r=>H2(r.symbol).error).filter(r=>!!r),i=H2(e.defaultSymbol);return i.error&&t.unshift(i.error),uK(e,t)}function Hwt(e){const t=e.classBreakInfos.map(r=>H2(r.symbol).error).filter(r=>!!r),i=H2(e.defaultSymbol);return i.error&&t.unshift(i.error),uK(e,t)}const qwt=(e,t)=>{const i=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return(t==null?void 0:t.levels)?t.levels[i]:null};function Wwt(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const i=e.visualVariables.find(s=>s.type==="size"),r=qwt(t,i);return r?new FX({field:i.field,minSize:r[2].size,minDataValue:r[2].value,maxSize:r[3].size,maxDataValue:r[3].value}):null}function fAe(e,t,i,r){return e.name?e.styleName&&e.styleName==="Esri2DPointSymbolsStyle"?Xwt(e,t,r):Rme(e,t,r).then(s=>mAe(s,e.name,t,i,r)):Promise.reject(new j("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function mAe(e,t,i,r,s){const n=e.data,o=i&&_(i.portal)?i.portal:Gn.getDefault(),a={portal:o,url:js(e.baseUrl),origin:"portal-item"},l=n.items.find(m=>m.name===t);if(!l){const m=`The symbol name '${t}' could not be found`;return Promise.reject(new j("symbolstyleutils:symbol-name-not-found",m,{symbolName:t}))}let c=Qf(VLe(l,r),a),h=l.thumbnail&&l.thumbnail.href;const p=l.thumbnail&&l.thumbnail.imageData;clt()&&(c=yq(c),h=yq(h));const f={portal:o,url:js(fX(c)),origin:"portal-item"};return kX(c,s).then(m=>{const y=r==="cimRef"?Mme(m.data):m.data,v=Cme(y,f);if(v&&Jf(v)){if(h){const w=Qf(h,a);v.thumbnail=new Zb({url:w})}else p&&(v.thumbnail=new Zb({url:`data:image/png;base64,${p}`}));e.styleUrl?v.styleOrigin=new tO({portal:i.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(v.styleOrigin=new tO({portal:i.portal,styleName:e.styleName,name:t}))}return v})}function Xwt(e,t,i){const r=BLe.replace(/\{SymbolName\}/gi,e.name),s=_(t.portal)?t.portal:Gn.getDefault();return kX(r,i).then(n=>{const o=Mme(n.data);return Cme(o,{portal:s,url:js(fX(r)),origin:"portal-item"})})}var Zwt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetchSymbolFromStyle:mAe,resolveWebStyleSymbol:fAe});const Ab=Hn.size,jN=Hn.maxSize,hK=Hn.maxOutlineSize,she=Hn.lineWidth,aW=Hn.tallSymbolWidth,Ywt=fe.getLogger("esri.symbols.support.previewSymbol3D");function XS(e){const t=e.outline,i=_(e.material)?e.material.color:null,r=_(i)?i.toHex():null;if(R(t)||"pattern"in t&&_(t.pattern)&&t.pattern.type==="style"&&t.pattern.style==="none")return e.type==="fill"&&r==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const s=gi(t.size)||0;return{color:"rgba("+(_(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,hK),style:"pattern"in t&&_(t.pattern)&&t.pattern.type==="style"?zZ(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function Qwt(e,t){const i=t&&t.resource,r=i&&i.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(r&&t.type!=="object")return Promise.resolve($0e(e,t));const s=xi("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?fAe(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var o;return((o=n==null?void 0:n.thumbnail)==null?void 0:o.url)||s}):Promise.resolve(s)}function H8(e,t=1){const i=e.a,r=CY(e),s=r.h,n=r.s/t,o=100-(100-r.v)/t,{r:a,g:l,b:c}=X3({h:s,s:n,v:o});return[a,l,c,i]}function E5(e){return e.type==="water"?R(e.color)?null:e.color:R(e.material)||R(e.material.color)?null:e.material.color}function Cr(e,t=0){const i=E5(e);if(!i){if(e.type==="fill")return null;const s=xze.r,n=Fv(s,t);return[n,n,n,100]}const r=i.toRgba();for(let s=0;s<3;s++)r[s]=Fv(r[s],t);return r}async function gAe(e,t){const i=e.style;return i==="none"?null:{type:"pattern",x:0,y:0,src:await wze(xi(`esri/symbols/patterns/${i}.png`),t.toCss(!0)),width:5,height:5}}function nhe(e){return e.outline?XS(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function yAe(e,t){const i=E5(e);if(!i)return null;let r="rgba(";return r+=Fv(i.r,t)+",",r+=Fv(i.g,t)+",",r+=Fv(i.b,t)+",",r+i.a+");"}function lW(e,t){const i=yAe(e,t);return i?"pattern"in e&&_(e.pattern)&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:i,width:Math.min(e.size?gi(e.size):.75,hK),style:"pattern"in e&&_(e.pattern)&&e.pattern.type==="style"?zZ(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?gi(2):e.join:null}:{}}function NL(e,t,i){const r=.75*i;return{type:"linear",x1:r?.25*r:0,y1:r?.5*r:0,x2:r||4,y2:r?.5*r:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function Jwt(e){const t=e.depth,i=e.height,r=e.width;return r&&t&&i&&r===t&&r<i}function Kwt(e,t,i){const r=[];if(!e)return r;switch(e.type){case"icon":{const o=t,a=t;switch(e.resource&&e.resource.primitive||nfe){case"circle":r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:Cr(e,0),stroke:XS(e)});break;case"square":r.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,a]},{command:"Z",values:[]}]},fill:Cr(e,0),stroke:XS(e)});break;case"triangle":r.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,a]},{command:"Z",values:[]}]},fill:Cr(e,0),stroke:XS(e)});break;case"cross":r.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,a]},{command:"M",values:[0,.5*a]},{command:"L",values:[o,.5*a]}]},stroke:nhe(e)});break;case"x":r.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,a]},{command:"M",values:[o,0]},{command:"L",values:[0,a]}]},stroke:nhe(e)});break;case"kite":r.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*a]},{command:"L",values:[.5*o,a]},{command:"Z",values:[]}]},fill:Cr(e,0),stroke:XS(e)})}break}case"object":switch(e.resource&&e.resource.primitive||wX){case"cone":{const s=NL(Cr(e,0),Cr(e,-.6),i?aW:t),n=X7e(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s});break}case"inverted-cone":{const s=Cr(e,0),n=NL(s,Cr(e,-.6),t),o=Z7e(t);r.push({shape:o[0],fill:n}),r.push({shape:o[1],fill:s});break}case"cube":{const s=q7e(t,i);r.push({shape:s[0],fill:Cr(e,0)}),r.push({shape:s[1],fill:Cr(e,-.3)}),r.push({shape:s[2],fill:Cr(e,-.5)});break}case"cylinder":{const s=NL(Cr(e,0),Cr(e,-.6),i?aW:t),n=W7e(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s}),r.push({shape:n[2],fill:Cr(e,0)});break}case"diamond":{const s=Y7e(t);r.push({shape:s[0],fill:Cr(e,-.3)}),r.push({shape:s[1],fill:Cr(e,0)}),r.push({shape:s[2],fill:Cr(e,-.3)}),r.push({shape:s[3],fill:Cr(e,-.7)});break}case"sphere":{const s=NL(Cr(e,0),Cr(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=Q7e(t);r.push({shape:s[0],fill:Cr(e,-.3)}),r.push({shape:s[1],fill:Cr(e,0)}),r.push({shape:s[2],fill:Cr(e,-.6)});break}}break}return r}function Pz(e){const t=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return t?gi(t):null}function ext(e){return e.type==="icon"?"multiply":"tint"}function txt(e,t){const i=Pz(t),r=t&&t.maxSize?gi(t.maxSize):null,s=t&&t.disableUpsampling,n=e.symbolLayers,o=[];let a=0,l=0;const c=n.getItemAt(n.length-1);let h;return c&&c.type==="icon"&&(h=c.size&&gi(c.size)),n.forEach(p=>{var y;if(p.type!=="icon"&&p.type!=="object")return;const f=p.type==="icon"?p.size&&gi(p.size):0,m=i||f?Math.ceil(Math.min(i||f,r||jN)):Ab;if(p&&p.resource&&p.resource.href){const v=Qwt(e,p).then(w=>{const b=p.get("material.color"),S=ext(p);return Hje(w,m,b,S,s)}).then(w=>{const b=w.width,S=w.height;return a=Math.max(a,b),l=Math.max(l,S),[{shape:{type:"image",x:0,y:0,width:b,height:S,src:w.url},fill:null,stroke:null}]});o.push(v)}else{let v=m;p.type==="icon"&&h&&i&&(v=m*(f/h));const w=(t==null?void 0:t.symbolConfig)==="tall"||((y=t==null?void 0:t.symbolConfig)==null?void 0:y.isTall)||p.type==="object"&&Jwt(p);a=Math.max(a,w?aW:v),l=Math.max(l,v),o.push(Promise.resolve(Kwt(p,v,w)))}}),gs(o).then(p=>{const f=[];return p.forEach(m=>{m.value?f.push(m.value):m.error&&Ywt.warn("error while building swatchInfo!",m.error)}),Z3(f,[a,l],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})})}function ixt(e,t){const i=e.symbolLayers,r=[],s=Ik(e),n=Pz(t),o=(t&&t.maxSize?gi(t.maxSize):null)||hK;let a,l=0,c=0;return i.forEach((h,p)=>{if(!h||h.type!=="line"&&h.type!=="path")return;const f=[];switch(h.type){case"line":{const m=lW(h,0);if(R(m))break;const y=m&&m.width||0;p===0&&(a=y);const v=Math.min(n||y,o),w=p===0?v:n?v*(y/a):v,b=w>she/2?2*w:she;c=Math.max(c,w),l=Math.max(l,b),m.width=w,f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*c]},{command:"L",values:[l,.5*c]}]},stroke:m});break}case"path":{const m=Math.min(n||Ab,o),y=Cr(h,0),v=Cr(h,-.2),w=yAe(h,-.4),b=w?{color:w,width:1}:{};if(h.profile==="quad"){const S=h.width,T=h.height,E=G7e(S&&T?S/T:1,T===0,S===0),C=ye(F({},b),{join:"bevel"});f.push({shape:E[0],fill:v,stroke:C}),f.push({shape:E[1],fill:v,stroke:C}),f.push({shape:E[2],fill:y,stroke:C})}else f.push({shape:uH.pathSymbol3DLayer[0],fill:v,stroke:b}),f.push({shape:uH.pathSymbol3DLayer[1],fill:y,stroke:b});c=Math.max(c,m),l=c}}r.push(f)}),Promise.resolve(Z3(r,[l,c],{node:t&&t.node,scale:s,opacity:t&&t.opacity}))}async function rxt(e,t){const i=e.type==="mesh-3d",r=e.symbolLayers,s=Pz(t),n=t&&t.maxSize?gi(t.maxSize):null,o=s||Ab,a=[];let l=0,c=0,h=!1;for(let p=0;p<r.length;p++){const f=r.getItemAt(p),m=[];if(i&&f.type!=="fill")continue;const y=uH.fill[0];switch(f.type){case"fill":{const v=XS(f),w=Math.min(o,n||jN);l=Math.max(l,w),c=Math.max(c,w),h=!0;let b=Cr(f,0);const S="pattern"in f&&f.pattern,T=E5(f);!i&&_(S)&&S.type==="style"&&S.style!=="solid"&&T&&(b=await gAe(S,T)),m.push({shape:y,fill:b,stroke:v});break}case"line":{const v=lW(f,0);if(R(v))break;const w={stroke:v,shape:y};l=Math.max(l,Ab),c=Math.max(c,Ab),m.push(w);break}case"extrude":{const v=F({join:"round",width:1},lW(f,-.4)),w=Cr(f,0),b=Cr(f,-.2),S=Math.min(o,n||jN),T=j7e(S);v.width=1,m.push({shape:T[0],fill:b,stroke:v}),m.push({shape:T[1],fill:b,stroke:v}),m.push({shape:T[2],fill:w,stroke:v});const E=Ab,C=.7*Ab+.5*S;l=Math.max(l,E),c=Math.max(c,C);break}case"water":{const v=E5(f),w=H8(v),b=H8(v,2),S=H8(v,3),T=H7e();h=!0,m.push({shape:T[0],fill:w}),m.push({shape:T[1],fill:b}),m.push({shape:T[2],fill:S});const E=Math.min(o,n||jN);l=Math.max(l,E),c=Math.max(c,E);break}}a.push(m)}return Z3(a,[l,c],{node:t&&t.node,scale:h,opacity:t&&t.opacity})}function sxt(e,t){if(e.symbolLayers.length===0)return Promise.reject(new j("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return txt(e,t);case"line-3d":return ixt(e,t);case"polygon-3d":case"mesh-3d":return rxt(e,t)}return Promise.reject(new j("symbolPreview: swatchInfo3D","symbol not supported."))}var nxt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getPatternDescriptor:gAe,getSizeFromOptions:Pz,getSymbolLayerFill:Cr,previewSymbol3D:sxt});const ohe={HH:315,HL:45,LL:135,LH:225},oxt={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function axt(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return Cr(e.symbolLayers.getItemAt(0));if(t==="simple-line"){const i=pO(e);return i&&i.color}if(e.type==="simple-marker"&&(e.style==="x"||e.style==="cross")){const i=pO(e);return i&&i.color}return bze(e)}function lxt(e,t){const i=t.HH.label,r=t.LL.label,s=t.HL.label,n=t.LH.label;switch(e){case"HH":default:return{top:i,bottom:r,left:s,right:n};case"HL":return{top:s,bottom:n,left:r,right:i};case"LL":return{top:r,bottom:i,left:n,right:s};case"LH":return{top:n,bottom:s,left:i,right:r}}}function cxt(e){const{focus:t,infos:i,numClasses:r}=e,s=oxt[r],n={};i.forEach(a=>{n[a.value]={label:a.label,fill:axt(a.symbol)}});const o=[];for(let a=0;a<r;a++){const l=[];for(let c=0;c<r;c++){const h=n[s[a][c]];l.push(h.fill)}o.push(l)}return{type:"relationship-ramp",numClasses:r,focus:t,colors:o,labels:lxt(t,n),rotation:vAe(t)}}function vAe(e){let t=ohe[e];return e&&t==null&&(t=ohe.HH),t||0}const cW=30,uW=12,_Ae=[255,255,255],bAe=[200,200,200],ZS=[128,128,128],uxt=20,hxt=5;function dxt(e){return e.declaredClass==="esri.symbols.SimpleMarkerSymbol"}function pxt(e){return e.declaredClass==="esri.symbols.PictureMarkerSymbol"}function fxt(e){return e.declaredClass==="esri.symbols.SimpleLineSymbol"}function mxt(e){return e.declaredClass==="esri.symbols.TextSymbol"}function gxt(e,t){const i=e.length-1;return e.map((r,s)=>k0e(r,s,i,t))}async function yxt(e,t,i,r,s,n){const o=t.legendOptions,a=o&&o.customValues,l=await bxt(e,i),c=!!l,h=!!a,p=t.minSize!=null&&t.maxSize!=null,f=t.stops&&t.stops.length>1,m=!!t.target;if(!c||!h&&!(p||f&&!m))return;const y=Ik(l);let v=null,w=null,b=null;w=y&&!f?XF([t.minDataValue,t.maxDataValue]):a||await xxt(t,l,r,s);const S=e==null?void 0:e.authoringInfo,T=(S==null?void 0:S.type)==="univariate-color-size",E=T&&(S==null?void 0:S.univariateTheme)==="above-and-below";if(!w&&f&&(w=t.stops.map(D=>D.value),v=t.stops.some(D=>!!D.label),e.type==="flow"&&(w=XF(w)),v&&(b=t.stops.map(D=>D.label))),y&&(w==null?void 0:w.length)>2&&!E&&(w=[w[0],w[w.length-1]]),!w)return null;T&&(w==null?void 0:w.length)!==5&&(w=TAe({minSize:w[0],maxSize:w[w.length-1]}));const C=y?vxt(e,w):null,A=Eze(l),I=v?null:gxt(w,n);return(await Promise.all(w.map(async(D,L)=>{const z=y?C[L]:await _S(t,l,D,r,s);return{value:D,symbol:Ext(E&&e.type==="class-breaks"?_xt(e,L):l,z),label:v?b[L]:I[L],size:z,outlineSize:A}}))).reverse()}function vxt(e,t){const i=e==null?void 0:e.authoringInfo,r=(i==null?void 0:i.type)==="univariate-color-size";let s=[uW,cW];if(r){const n=t[0],o=t[t.length-1],a=uW,l=cW;s=t.map(c=>a+(c-n)/(o-n)*(l-a))}return r&&(i==null?void 0:i.univariateTheme)==="below"&&s.reverse(),s}function _xt(e,t){const i=e.classBreakInfos,r=i.length,s=r<2||!(t>=2)?i[0].symbol.clone():i[r-1].symbol.clone();return e.visualVariables.some(n=>n.type==="color")&&(s.type.includes("3d")?wAe(s):xAe(s)),s}async function bxt(e,t){var s;if(e.type==="flow")return U0e(e,t);if(e.type==="pie-chart")return new xc({color:null,outline:((s=e.outline)==null?void 0:s.width)?e.outline:new Pc});let i=null,r=null;if(e.type==="simple")i=e.symbol;else if(e.type==="class-breaks"){const n=e.classBreakInfos;i=n&&n[0]&&n[0].symbol,r=n.length>1}else if(e.type==="unique-value"){const n=e.uniqueValueInfos;i=n&&n[0]&&n[0].symbol,r=n.length>1}return!i||wxt(i)?null:(i=i.clone(),(t||r)&&(i.type.includes("3d")?wAe(i):xAe(i)),i)}function wxt(e){return e?Jf(e)?!!e.symbolLayers&&e.symbolLayers.some(t=>t&&t.type==="fill"):e.type.includes("fill"):!1}function wAe(e){e.type==="line-3d"?e.symbolLayers.forEach(t=>{t.material={color:ZS}}):e.symbolLayers.forEach(t=>{t.type!=="icon"||t.resource&&t.resource.href?t.material={color:bAe}:(t.material={color:_Ae},t.outline={color:ZS,size:1.5})})}function xAe(e){var i,r;const t=PZ();e.type==="cim"?M0e(e,new Pe(bAe)):e.type.includes("line")?e.color=ZS:(e.color=t?ZS:_Ae,e.type==="simple-marker"&&(e.outline?((r=(i=e.outline)==null?void 0:i.color)==null?void 0:r.toHex())==="#ffffff"&&(e.outline.color=ZS):e.outline={color:ZS,width:1.5}))}async function xxt(e,t,i,r){const s=(await Promise.resolve().then(function(){return nx})).getSizeRangeAtScale(e,i,r),n=s&&TAe(s);if(!s&&!n)return;let o=n.map(a=>Txt(a,e,s));o=XF(o);for(let a=1;a<o.length-1;a++){const l=await Sxt(e,t,o[a],o[a-1],i,r);l&&(o[a]=l[0],n[a]=l[1])}return o}function TAe(e){const t=e.minSize,i=e.maxSize,r=hxt,s=(i-t)/(r-1),n=[];for(let o=0;o<r;o++)n.push(t+s*o);return n}function Txt(e,t,i){const r=i.minSize,s=i.maxSize,n=t.minDataValue,o=t.maxDataValue;let a=null;return e<=r?a=n:e>=s?a=o:a=(e-r)/(s-r)*(o-n)+n,a}async function Sxt(e,t,i,r,s,n){const o=await _S(e,t,i,s,n),a=await _S(e,t,r,s,n),l=WF(i),c=l.fractional,h=uxt;let p=l.integer,f=null,m=null;i>0&&i<1&&(f=10**c,p=WF(i*=f).integer);for(let y=p-1;y>=0;y--){const v=10**y;let w=Math.floor(i/v)*v,b=Math.ceil(i/v)*v;f!=null&&(w/=f,b/=f);let S=(w+b)/2;[,S]=XF([w,S,b],{indexes:[1]});const T=await _S(e,t,w,s,n),E=await _S(e,t,b,s,n),C=await _S(e,t,S,s,n),A=CD(o,T,a,null),I=CD(o,E,a,null),D=CD(o,C,a,null);let L=A.previous<=h,z=I.previous<=h;if(L&&z&&(A.previous<=I.previous?(L=!0,z=!1):(z=!0,L=!1)),L?m=[w,T]:z?m=[b,E]:D.previous<=h&&(m=[S,C]),m)break}return m}async function _S(e,t,i,r,s){const{getSize:n}=await Promise.resolve().then(function(){return nx});return n(e,i,{scale:r,view:s,shape:t.type==="simple-marker"?t.style:null})}function Ext(e,t){const i=e.clone();if(Jf(i))Ik(i)||i.symbolLayers.forEach(r=>{r.type!=="fill"&&(r.size=t)});else if(dxt(i))i.size=t;else if(pxt(i)){const r=i.width,s=i.height;i.height=t,i.width=t*(r/s)}else fxt(i)?i.width=t:mxt(i)&&i.font&&(i.font.size=t);return i}function Cxt(e){const i=Math.floor(Math.log10(Math.abs(e)))+1,r=i<4||i>6?4:i,s=1e6,n=Math.abs(e)>=s?"compact":"standard";return Wh(e,{notation:n,minimumSignificantDigits:2,maximumSignificantDigits:r})}const u0=fe.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),Axt="https://utility.arcgis.com/sharing/tools/legend",Rxt="esri.layers.ImageryLayer",Mxt="esri.layers.ImageryTileLayer",Oxt="esri.layers.WCSLayer",FL=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Pxt=new wi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ahe={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},kL=new xc({size:6,outline:{color:[128,128,128,.5],width:.5}}),Ixt=new dm({style:"solid"});function hW(e){return e.type==="flow"}function SAe(e){return e.type==="vector-field"}function EAe(e){return e.type==="raster-colormap"}function CAe(e){return e.type==="raster-stretch"}function AAe(e){return e.type==="raster-shaded-relief"}function bS(e){return e.declaredClass==="esri.renderers.SimpleRenderer"}function wS(e){return e.declaredClass==="esri.renderers.ClassBreaksRenderer"}function dW(e){return e.declaredClass==="esri.renderers.UniqueValueRenderer"}function RAe(e){return e.declaredClass==="esri.renderers.HeatmapRenderer"}function $xt(e){return dK(e)||pK(e)||fK(e)||Lxt(e)}function Lxt(e){return e.declaredClass==="esri.renderers.PointCloudRGBRenderer"}function dK(e){return e.declaredClass==="esri.renderers.PointCloudClassBreaksRenderer"}function pK(e){return e.declaredClass==="esri.renderers.PointCloudStretchRenderer"}function fK(e){return e.declaredClass==="esri.renderers.PointCloudUniqueValueRenderer"}function MAe(e){return e.declaredClass==="esri.renderers.DotDensityRenderer"}function OAe(e){return e.declaredClass==="esri.renderers.PieChartRenderer"}function Dxt(e,t){return bS(e)||wS(e)||dW(e)||RAe(e)||MAe(e)||OAe(e)?t.type==="2d"||pAe(e):CAe(e)||EAe(e)||AAe(e)||dK(e)||pK(e)||fK(e)||SAe(e)||hW(e)}function lhe(e){return e.declaredClass==="esri.layers.BuildingSceneLayer"}function Nxt(e){return e.declaredClass==="esri.layers.VoxelLayer"}function Fxt(e){return e.declaredClass==="esri.layers.WMSLayer"}function kxt(e){return e.declaredClass==="esri.layers.WMTSLayer"}function che(e){return e.declaredClass==="esri.layers.MapImageLayer"}function Uxt(e){return e.declaredClass==="esri.layers.TileLayer"}function zxt(e){return e.declaredClass==="esri.layers.FeatureLayer"}function PA(e){return e.declaredClass===Rxt}function q8(e){return e.declaredClass===Mxt}function Vxt(e){return e.declaredClass===Oxt}function Bxt(e){return e.type==="stretch-ramp"}function Gxt(e){var t;return((t="authoringInfo"in e&&(e==null?void 0:e.authoringInfo))==null?void 0:t.type)==="univariate-color-size"}function jxt(e){const t="authoringInfo"in e&&(e==null?void 0:e.authoringInfo);return(t==null?void 0:t.type)==="univariate-color-size"&&(t==null?void 0:t.univariateTheme)==="above-and-below"}const Hxt=new xc({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let bT={},$n=class extends Se{constructor(e){super(e),this._handles=new Nt,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new ut,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([ns(()=>this.children,"change",t=>{const{added:i,removed:r}=t,s=this._handles;i.forEach(n=>{const o=`activeLayerInfo-ready-watcher-${n.layer.uid}`;s.add(ie(()=>n.ready,e,Rt),o)}),r.forEach(n=>s.remove(n.layer.uid)),e()})]),this.keepCacheOnDestroy||(bT={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(bT=null)}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new wf,t.effect=e.effect,t.end(),t.scale=this.scale),t}get opacity(){var s;const e=this.layer.opacity,t=(s=this.parent)==null?void 0:s.opacity,i=this.layer.parent,r=i&&"uid"in i?this._getParentLayerOpacity(i):null;return t!=null?t*e:r!=null?r*e:e}get ready(){return this.layer===null||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(e===null)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if(e.featureReduction.type==="cluster")return!0;if(e.featureReduction.type==="binning"&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(!(!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView()))return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,i=>{if(zxt(i))return this._getRendererLegendElements(i.renderer,{title:i.title});if(i.featureSet&&i.featureSet.features.length){const r=i.layerDefinition,s=r&&r.drawingInfo,n=s&&M9e(s.renderer),o=Pxt.read(r.geometryType);return n?this._getRendererLegendElements(n,{title:i.name,geometryType:o}):(u0.warn("drawingInfo not available!"),null)}return null});try{const i=[];await gs(t).then(r=>{r.forEach(({value:s})=>s&&i.push(...s))}),this.legendElements=i,this.notifyChange("ready")}catch(i){u0.warn("error while building legend for layer!",i)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(t){u0.warn("error while building legend for layer!",t)}}async buildLegendElementsForTools(){var t,i;const e=this.layer;if(Nxt(e))this._constructLegendElementsForVoxellayer();else if(kxt(e))this._constructLegendElementsForWMTSlayer();else if(Fxt(e))await this._constructLegendElementsForWMSSublayers();else if(lhe(e))await this._constructLegendElementsForBuildingSceneLayer();else if(che(e)||Uxt(e)||lhe(e))await this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");let r="default";PA(e)&&(r=(((t=e==null?void 0:e.renderingRule)==null?void 0:t.functionName)||"default")+"_"+(((i=e.bandIds)==null?void 0:i.length)?e.bandIds.join(""):"###")),await this._getLegendLayers(`${e.uid}-${r}`).then(async s=>{this.legendElements=[],this.notifyChange("ready");const n=s.map(async o=>{if(PA(e)||q8(e)){const l=ie(()=>["renderingRule"in e&&e.renderingRule,e.bandIds],()=>$5(async()=>{bT.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()})());this._handles.add(l,"imageryLayers-watcher")}const a=this._generateSymbolTableElementForLegendLayer(o);a&&a.infos.length&&(PA(e)&&(a.title=e.title),this.legendElements.push(a)),this.notifyChange("ready")});await gs(n)}).catch(s=>{u0.warn("Request to server for legend has failed!",s)})}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,i=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!i&&!(t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await _w(()=>!t.updating);const r=i?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return r.geometry=this.view.extent,(i?"queryFeatureCount"in t&&await t.queryFeatureCount(r):"queryFeatureCount"in e&&await e.queryFeatureCount(r))!==0}_getParentLayerOpacity(e){let t=1;const i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some(t=>t.ready)}_isRendererScaleDriven(e){if(e.type==="dot-density")return!0;const t="valueExpression"in e&&e.valueExpression;if(FL.test(t))return!0;const i="visualVariables"in e&&e.visualVariables;return!!i&&i.some(r=>this._isScaleDrivenSizeVariable(r))}_isScaleDrivenSizeVariable(e){if(e&&e.type!=="size")return!1;const t=e,i=t.minSize,r=t.maxSize;return typeof i=="object"&&i?this._isScaleDrivenSizeVariable(i):typeof r=="object"&&r?this._isScaleDrivenSizeVariable(r):!!t.expression||FL.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(i=>this._isLayerScaleDriven(i));const t=e.parent;if(e.loaded===!1&&t&&che(t)&&"source"in e&&e.source&&e.source.type==="map-layer"){for(const i of t.sourceJSON.layers)if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0}return!1}async _constructLegendElementsForVoxellayer(){var n;this.legendElements=[],this._handles.remove("voxel-style-watcher");const e=this.layer;this._handles.add(ie(()=>e.currentVariableId,()=>this._constructLegendElementsForVoxellayer()),"voxel-style-watcher");const t=e.getVariableStyle(null),i=[];if(t){if((n=t.uniqueValues)==null?void 0:n.length){const o=[];t.uniqueValues.forEach(a=>{a.enabled&&o.push({label:a.label||`${a.value}`,value:a.value,symbol:new dm({color:a.color,outline:null})})}),o.length&&i.push({type:"symbol-table",title:t.label,infos:o})}else if(t.transferFunction){const{colorStops:o,stretchRange:a}=t.transferFunction,l=o.toArray().reverse(),c=a.map((p,f)=>`${f===0?N0e:F0e} ${Cxt(p)}`).reverse(),h=l.map(p=>({color:p.color,value:null,label:null}));h[0].label=c[0],h[h.length-1].label=c[1],i.push({type:"color-ramp",title:t.label,infos:h,preview:B1(l.map(p=>p.color))})}}const r=e.opacity,s=i.reduce((o,a)=>o.concat(this._getAllInfos(a)),[]).filter(o=>!!(o==null?void 0:o.symbol)).map(o=>this._getSymbolPreview(o,r));await gs(s),this.legendElements=i,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(ie(()=>{const{layer:t}=this;return t&&"activeLayer"in t&&t.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some(i=>e.styleId===i.id&&(t=i.legendUrl,!0)),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t=F(F({},e.customParameters),e.customLayerParameters)),this._handles.add(ie(()=>{const{layer:i}=this;return i&&"sublayers"in i&&i.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const i=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");const r=e.toArray();for(const s of r){const n=ie(()=>[s.title,s.visible,s.legendEnabled],()=>this._constructLegendElementsForWMSSublayers());if(this._handles.add(n,"wms-sublayers-watcher"),!this.respectLayerVisibility||s.visible&&s.legendEnabled){const o=await this._generateSymbolTableElementForWMSSublayer(s,t);o&&o.infos.length&&i.unshift(o)}}return i}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const i=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(r=>r);return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var o;let i=e.legendUrl;if(!i)return;const r={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(i=KL(i,t));let s=null;const n=(o=e.layer)==null?void 0:o.opacity;try{s=(await Zt(i,{responseType:"image"})).data,s&&(s.style.opacity=n)}catch{}return r.infos.push({src:i,preview:s,opacity:n}),r}_getLegendLayers(e,t){const i=bT&&bT[e];return i?Promise.resolve(i):this._legendRequest(t).then(r=>{const s=r.layers;return bT[e]=s,s})}_legendRequest(e){const t=this.layer;let i={f:"json",dynamicLayers:e};if(PA(t)){const s=t.exportImageServiceParameters.renderingRule;if(s&&(i.renderingRule=JSON.stringify(s.rasterFunctionDefinition||s.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:n,viewId:o,customParameters:a}=t;i=F(F({raster:n,viewId:o},i),a)}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const s=r.indexOf("?");s>-1?r=r.substring(0,s)+"/legend"+r.substring(s):r+="/legend"}else{const s=r.toLowerCase().indexOf("/rest/"),n=r.substring(0,s)+r.substring(s+5,r.length);r=Axt+"?soapUrl="+encodeURI(n)+"&returnbytes=true"}return Zt(r,{query:i}).then(s=>s.data)}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(ie(()=>e.sublayers,()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){u0.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForBuildingSublayers(e,t){let i=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");const r=e.toArray();for(const s of r){const n=ie(()=>["renderer"in s&&s.renderer,s.opacity,s.title,s.visible],()=>this._constructLegendElementsForBuildingSceneLayer());if(this._handles.add(n,"sublayers-watcher"),!this.respectLayerVisibility||s.visible){const o=s&&s.opacity!=null?s.opacity:null,a=o!=null?o*t:t;if(s.type==="building-group"){const l={type:"symbol-table",title:s.title,infos:[]},c=await this._generateLegendElementsForBuildingSublayers(s.sublayers,a);l.infos.push(...c),i=[l,...i]}else s.renderer&&(i=[...await this._getRendererLegendElements(s.renderer,{title:s.title,opacity:a,sublayer:s}),...i])}}return i.filter(s=>!!s&&(!("infos"in s)||s.infos.length>0))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(ie(()=>e.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(t){u0.warn("Request to server for legend has failed!",t)}}async _generateLegendElementsForSublayers(e,t,i){const r=this.layer;let s=[];this._handles.add(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let n=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(n=this.sublayerIds.map(o=>r.findSublayerById(o)).filter(Boolean));for(const o of n){const a=ie(()=>[o.renderer,o.opacity,o.title,o.visible,o.legendEnabled],()=>this._constructLegendElementsForSublayers());if(this._handles.add(a,"sublayers-watcher"),!this.respectLayerVisibility||o.visible&&o.legendEnabled&&this._isSublayerInScale(o)){const l=o&&o.opacity!=null?o.opacity:null,c=l!=null?l*t:t;if(o.renderer&&!o.sublayers&&o.originIdOf("renderer")>Vt.SERVICE)await o.load(),s=[...await this._getRendererLegendElements(o.renderer,{title:o.title,opacity:c,sublayer:o}),...s];else{const h=await this._generateSymbolTableElementForSublayer(o,c,i);h&&s.unshift(h)}}}return s.filter(o=>!!o&&(!("infos"in o)||o.infos.length>0))}async _generateSymbolTableElementForSublayer(e,t,i){if(!i){i=new Map;const s=this.layer,n=e.source;let o=null;if(!(!n||n.type==="map-layer"&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===("gdbVersion"in s&&s.gdbVersion)))||e.originIdOf("renderer")>Vt.SERVICE||e.originIdOf("labelingInfo")>Vt.SERVICE||e.originIdOf("labelsVisible")>Vt.SERVICE){const l=new iu({layer:this.layer});o=l.hasDynamicLayers?l.dynamicLayers:null,l.destroy()}const a=o||`${s.uid}-default`;(await this._getLegendLayers(a,o)).forEach(l=>i.set(l.layerId,l))}const r=i.get(e.id);if((!r||(r==null?void 0:r.subLayerIds)&&r.defaultVisibility)&&e.sublayers){const s=await this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendLayer(r,e,t)}_generateSymbolTableElementForLegendLayer(e,t,i){var a;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const r=t==null?void 0:t.renderer;let s=(t==null?void 0:t.title)||e.layerName;if(r&&(!t||(t==null?void 0:t.originIdOf("renderer"))>Vt.SERVICE)){const l=(t==null?void 0:t.title)||this._getRendererTitle(r,t);l&&(s&&typeof l!="string"&&"title"in l&&(l.title=s),s=l)}const n={type:"symbol-table",title:s,legendType:e.legendType?e.legendType:null,infos:[]},o=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return((a=e.legendGroups)==null?void 0:a.length)>0?e.legendGroups.forEach(l=>{var h;const c={type:"symbol-table",title:l.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(o.filter(p=>p.groupId===l.id),e.layerId,i)};((h=c.infos)==null?void 0:h.length)>0&&n.infos.push(c)}):n.infos=this._generateSymbolTableElementInfosForLegendLayer(o,e.layerId,i),n.infos.length>0?n:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map(r=>{let s=r.url;if(r.imageData&&r.imageData.length>0)s=`data:image/png;base64,${r.imageData}`;else{if(s.indexOf("http")===0)return null;s=LIe(`${this.layer.url}/${t}/images/${s}`)}return{label:r.label,src:s,opacity:i==null?this.opacity:i,width:r.width,height:r.height}}).filter(r=>!!r)}_isSublayerInScale(e){const t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){const i=t||this.layer;let r=null,s=null,n=!0;return!i.minScale&&i.minScale!==0||!i.maxScale&&i.maxScale!==0?(e.minScale===0&&i.tileInfo&&(r=i.tileInfo.lods[0].scale),e.maxScale===0&&i.tileInfo&&(s=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(r=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,s=Math.max(i.maxScale,e.maxScale)),(r>0&&r<this.scale||s>this.scale)&&(n=!1),n}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||e.length===0)return e;const i=t.renderer,r=e.some(o=>o.values);let s=null,n=null;return r&&e.some((o,a)=>(o.values||(s=a,n=o,n.label||(n.label="others")),n!=null)),i?i.type==="unique-value"?n&&(e.splice(s,1),e.push(n)):i.type==="class-breaks"&&(n&&e.splice(s,1),e.reverse(),n&&e.push(n)):n&&(e.splice(s,1),e.push(n)),e}async _getRendererLegendElements(e,t={}){return Dxt(e,this.view)?$xt(e)?this._constructPointCloudRendererLegendElements(e,t):MAe(e)?this._constructDotDensityRendererLegendElements(e):OAe(e)?this._constructPieChartRendererLegendElements(e):this._constructRendererLegendElements(e,t):(u0.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const i=t.title,r=[];let s=null,n=null;if(dK(e))s={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(a=>{s.infos.unshift({label:a.label||a.minValue+" - "+a.maxValue,value:[a.minValue,a.maxValue],symbol:this._getAppliedCloneSymbol(kL,a.color)})});else if(pK(e)){const a=e.stops;let l=null;if(a.length&&(a.length===1&&(l=a[0].color),!l)){const h=a[0].value,p=a[a.length-1].value;h!=null&&p!=null&&(l=V0e(h+(p-h)/2,a))}s={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(kL,l||kL.color)}]};const c=Gze(e.stops);n={type:"color-ramp",title:i||this._getPointCloudRendererTitle(e),infos:c,preview:B1(c.map(h=>h.color))}}else fK(e)&&(s={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach(a=>{s.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:this._getAppliedCloneSymbol(kL,a.color)})}));s&&s.infos.length&&r.push(s),n&&n.infos.length&&r.push(n);const o=r.reduce((a,l)=>a.concat(l.infos),[]).filter(a=>!!a.symbol).map(a=>this._getSymbolPreview(a,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}}));return gs(o).then(()=>r)}_getElementInfoForDotDensity(e,t){var f;const{backgroundColor:i,outline:r,dotSize:s}=e,n=(f=this.effectList)==null?void 0:f.effects.map(m=>m.toJSON()),o=ZF(n),a=s+"-"+t+"-"+i+"-"+(r&&JSON.stringify(r.toJSON()))+"-"+o,l=this._dotDensityUrlCache,c=l.has(a)?l.get(a):qje(e,t);l.set(a,c);const h={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},p=Z3([[h]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:p,width:c.width,height:c.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),i=e.legendOptions&&e.legendOptions.unit,r={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};return e.attributes.forEach(s=>{const n=this._getElementInfoForDotDensity(e,s.color);n.label=s.label||s.valueExpressionTitle||s.field,r.infos.push(n)}),Promise.resolve([r])}async _constructPieChartRendererLegendElements(e){var l,c,h,p;const t=this.layer.opacity,i=[],r="Others",s=e.outline;e.attributes.forEach(f=>{const m=new xc({color:f.color,outline:s}),y=f.label||f.valueExpressionTitle||f.field;i.push({label:y,symbol:m})});const n=i.length?[...i]:[];if(((l=e.othersCategory)==null?void 0:l.color)&&((c=e.othersCategory)==null?void 0:c.threshold)!==0){const f=new xc({color:e.othersCategory.color,outline:s});i.push({label:e.othersCategory.label||r,symbol:f})}if((h=e.defaultColor)==null?void 0:h.a){const f=new xc({color:e.defaultColor,outline:s});i.push({label:e.defaultLabel,symbol:f})}const o=await this._getVisualVariableLegendElements(e,this.layer)||[];if(i.length){o.unshift({type:"symbol-table",title:null,infos:i});const f=n.filter(y=>y.label!==r).map(y=>y.symbol.color).filter(Boolean),m=Wje(f,{holePercentage:e.holePercentage,backgroundColor:(p=e.backgroundFillSymbol)==null?void 0:p.color,effectList:this.effectList,outline:s});o.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:i,preview:m})}const a=o.reduce((f,m)=>f.concat(this._getAllInfos(m)),[]).filter(f=>!!(f==null?void 0:f.symbol)&&!(f==null?void 0:f.preview)).map(f=>this._getSymbolPreview(f,t,{effectList:this.effectList}));return await gs(a),o}async _constructRendererLegendElements(e,t={}){var w;const{title:i,sublayer:r}=t,s=r||this.layer;let n=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const o=await this._getVisualVariableLegendElements(n,s)||[],a={type:"symbol-table",title:i||this._getRendererTitle(n,s),infos:[]};let l=null,c=!1;const h=new Set;if(hW(n)&&!this._hasSizeRamp){const b=await U0e(n);a.infos.push({label:null,symbol:b})}else if(Gxt(n)){let b=i;const S=jxt(n)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",T=o.findIndex(D=>D.type==="color-ramp"),E=T!==-1?o.splice(T,1)[0]:null,C=o.findIndex(D=>D.type==="size-ramp"),A=C!==-1?o.splice(C,1)[0]:null,I=[];E&&(b=E.title,I.push(E)),A&&(b=A.title,I.push(A)),I.length>0&&o.push({type:S,title:b,infos:I})}else if(RAe(n)){const b=B0e(n);o.push({type:"heatmap-ramp",title:i||((w=n.legendOptions)==null?void 0:w.title),infos:b,preview:B1(b.map(S=>S.color),{effectList:this.effectList})})}else if(dW(n)){const b=n&&n.authoringInfo;if(b&&b.type==="relationship"){const{focus:S,numClasses:T,field1:E,field2:C}=b;if(T&&E&&C){const A=[E,C];let I=vAe(S)||0;for(const L of A){const{field:z,normalizationField:B,label:V}=L,Q=V||{field:this._getFieldAlias(z,s),normField:B&&this._getFieldAlias(B,s)},Z=Hxt.clone();Z.angle=I,a.infos.push({label:Q,symbol:Z}),h.add(Z),I+=90}const D=cxt({focus:S,numClasses:T,infos:n.uniqueValueInfos});o.unshift(D)}}else{const S=n.field;n.uniqueValueInfos.forEach(T=>{T.symbol&&a.infos.push({label:T.label||this._getDomainName(S,T.value,s)||T.value,value:T.value,symbol:T.symbol})})}n.defaultSymbol&&(a.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),c=!0)}else if(wS(n))l=this._isUnclassedRenderer(n),(!l||!this._hasSizeRamp)&&(n.classBreakInfos.forEach(b=>{b.symbol&&a.infos.unshift({label:b.label||(l?null:b.minValue+" - "+b.maxValue),value:[b.minValue,b.maxValue],symbol:b.symbol})}),l&&(a.title=null),this._updateInfosforClassedSizeRenderer(n,a.infos)),n.defaultSymbol&&!l&&(a.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),c=!0);else if(CAe(n))if(q8(this.layer)||Vxt(this.layer)){const b=this._constructTileImageryStretchRendererElements(n);Bxt(b)?o.push(b):a.infos=b}else{const b=this.layer;let S,T;n.statistics&&n.statistics.length&&(S=n.statistics[0].min!=null?n.statistics[0].min:n.statistics[0][0],T=n.statistics[0].max!=null?n.statistics[0].max:n.statistics[0][1]);let E=[];const C=b.renderingRule?await b.generateRasterInfo(b.renderingRule):b.serviceRasterInfo,A=C.keyProperties.BandProperties,I=ahe[b.rasterInfo.pixelType.toLowerCase()];C.bandCount===1||b.bandIds&&b.bandIds.length===1?(S=S!=null?S:C.statistics?C.statistics[b.bandIds[0]].min:I[0],T=T!=null?T:C.statistics?C.statistics[b.bandIds[0]].max:I[1],S||T?o.push(this._getStretchLegendElements(n,{min:S,max:T})):this._getServerSideLegend()):C.bandCount>=3?A&&A.length>=C.bandCount?b.bandIds&&b.bandIds.length===3?(E=b.bandIds.map(D=>A[D].BandName),a.infos=this._createSymbolTableElementMultiBand(E)):b.format==="lerc"?(E=[0,1,2].map(D=>A[D].BandName),a.infos=this._createSymbolTableElementMultiBand(E)):this._getServerSideLegend():b.format==="lerc"?(E=["band1","band2","band3"],a.infos=this._createSymbolTableElementMultiBand(E)):this._getServerSideLegend():this._getServerSideLegend()}else if(EAe(n))n.colormapInfos.forEach(b=>{a.infos.push({label:b.label,value:b.value,symbol:this._getAppliedCloneSymbol(Ixt,b.color)})});else if(bS(n)){let b=n.symbol;switch(t.geometryType){case"point":b="pointSymbol"in s&&s.pointSymbol;break;case"polyline":b="lineSymbol"in s&&s.lineSymbol;break;case"polygon":b="polygonSymbol"in s&&s.polygonSymbol}n.symbol&&!this._hasSizeRamp&&a.infos.push({label:n.label,symbol:b})}else if(SAe(n)){n.outputUnit&&(this.title="("+n.toJSON().outputUnit+")"),a.title=n.attributeField;const b=n.getClassBreakInfos();(b==null?void 0:b.length)?b.forEach(S=>{a.infos.push({label:S.minValue+" - "+S.maxValue,symbol:S.symbol})}):a.infos.push({label:n.attributeField,symbol:n.getDefaultSymbol()})}else AAe(n)&&o.push(this._getStretchLegendElements(n,{min:0,max:255}));const p=n.defaultSymbol;!p||c||bS(n)||l&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||o.push({type:"symbol-table",infos:[{label:n.defaultLabel||"others",symbol:p}]}),a.infos.length&&o.unshift(a);const f=t.opacity==null?this.opacity:t.opacity,m=this._isTallSymbol("visualVariables"in n&&n.visualVariables),y=PA(this.layer)||q8(this.layer),v=o.reduce((b,S)=>b.concat(this._getAllInfos(S)),[]).filter(b=>!!(b==null?void 0:b.symbol)).map(b=>this._getSymbolPreview(b,f,{isDefault:b.symbol===p,applyScaleDrivenSize:!h.has(b.symbol),symbolConfig:{isTall:m,isSquareFill:y},effectList:h.has(b.symbol)?null:this.effectList}));return n=null,await gs(v),o}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){const t=e==null?void 0:e.infos;return t?t.reduce((i,r)=>i.concat(this._getAllInfos(r)),[]):[e]}_constructTileImageryStretchRendererElements(e){var h,p;const t=this.layer,i=t.rasterInfo,r=i.bandCount||e.statistics.length;let s,n,o=[];const a=i.keyProperties&&i.keyProperties.BandProperties,l=((h=e==null?void 0:e.statistics)==null?void 0:h.length)?e.statistics:i==null?void 0:i.statistics;if(l)s=l[0].min!==void 0?l[0].min:l[0][0],n=l[0].max||l[0][1];else{const f=ahe[t.rasterInfo.pixelType.toLowerCase()];s=f[0],n=f[1]}if(t.hasStandardTime()&&(s=t.getStandardTimeValue(s),n=t.getStandardTimeValue(n)),i.bandCount===1||((p=t.bandIds)==null?void 0:p.length)===1)return this._getStretchLegendElements(e,{min:s,max:n});function c(f){var y;const m=(((y=t==null?void 0:t.bandIds)==null?void 0:y.length)?t.bandIds:Array.from(Array(Math.min(i.bandCount,3)).keys())).map(v=>f&&f[v]&&f[v].BandName||"band"+(v+1));return m.length<3?m.push(m[1]):m.length>3&&m.splice(3),m}return o=a&&a.length>=r?c(a):c(),this._createSymbolTableElementMultiBand(o)}_getStretchLegendElements(e,t){const i=e.colorRamp,r=Hze(i,t);return{type:"stretch-ramp",title:"",infos:r,preview:B1(r.map(s=>s.color))}}async _getSizeLegendElement(e,t,i,r){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await yxt(i,t,await G7(i),this.scale,this.view.type,r)}}_createSymbolTableElementMultiBand(e){const t=[],i=["red","green","blue"];return e.forEach((r,s)=>{var n;t.push({label:{colorName:i[s],bandName:r},src:zze[s],opacity:(n=this.opacity)!=null?n:1})}),t}_updateInfosforClassedSizeRenderer(e,t){const i=e.authoringInfo&&e.authoringInfo.type==="class-breaks-size",r=e.classBreakInfos.some(s=>Ik(s.symbol));if(i&&r){const s=cW,n=uW,o=e.classBreakInfos.length,a=(s-n)/(o>1?o-1:o);t.forEach((l,c)=>{l.size=s-a*c})}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let r=0;r<e.length&&(!t||!i);r++){const s=e[r];s.type==="size"&&(s.axis==="height"&&(t=!0),s.axis==="width-and-depth"&&(i=!0))}return t&&i}async _getSymbolPreview(e,t,i){let r=!(i==null?void 0:i.isDefault)&&e.size==null&&this._hasSizeRamp?$l(Hn.size):e.size;if(this._scaleDrivenSizeVariable&&(i==null?void 0:i.applyScaleDrivenSize)){const{getSize:s}=await Promise.resolve().then(function(){return nx});r=s(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:e.symbol.type==="simple-marker"?e.symbol.style:null})}return D1e(e.symbol,{size:r,opacity:t,scale:!1,symbolConfig:i==null?void 0:i.symbolConfig,effectView:i==null?void 0:i.effectList}).then(s=>(e.preview=s,e)).catch(()=>(e.preview=null,e))}async _loadRenderer(e){var n,o;const t=[],i=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const r="visualVariables"in e&&((n=e.visualVariables)==null?void 0:n.some(a=>a.type==="size"&&a.target!=="outline"&&!FL.test(a.valueExpression)));if(e&&"visualVariables"in e&&!r&&"featureReduction"in i&&((o=i.featureReduction)==null?void 0:o.type)==="cluster"){const a=this.layerView._effectiveRenderer,l=Wwt(a,this.view);if(l){const c=i.featureReduction;if("clusterMinSize"in c&&"clusterMaxSize"in c){const{clusterMinSize:p,clusterMaxSize:f}=c;l.legendOptions=new qfe({showLegend:p!==f})}const h=e.visualVariables||[];e.visualVariables=h.concat([l]),this._hasClusterSizeVariable=!0}}const s=await G7(e);if(wS(e)||dW(e)){const a=(e.classBreakInfos||e.uniqueValueInfos).map(l=>this._fetchSymbol(l.symbol,s).then(c=>{l.symbol=c}).catch(()=>{l.symbol=null}));Array.prototype.push.apply(t,a)}return t.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:s).then(a=>{this._applySymbolToRenderer(e,a,bS(e))}).catch(()=>{this._applySymbolToRenderer(e,null,bS(e))})),gs(t).then(()=>e)}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if(e.type==="web-style"){const i=this._webStyleSymbolCache;try{const r=await(this.view.type==="2d"?e.fetchCIMSymbol({cache:i}):e.fetchSymbol({cache:i}));return this._getAppliedCloneSymbol(r,t)}catch{throw u0.warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const i=e.clone(),r=t&&t.toRgba();return i.type.includes("3d")?this._applyColorTo3dSymbol(i,r):i.type==="cim"?M0e(i,t):i.color&&(i.color=new Pe(r||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(i=>{i&&(i.material||(i.material={}),i.material.color=new Pe(t))})}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||e.type==="vector-field")return null;const i=e.visualVariables,r=[],s=[],n=[];for(const h of i)h.type==="color"?r.push(h):h.type==="size"?s.push(h):h.type==="opacity"&&n.push(h);const o=[...r,...s,...n];let a,l;if(r.length===0&&wS(e)&&e.classBreakInfos&&e.classBreakInfos.length===1){const h=e.classBreakInfos[0];a=h&&h.symbol}if(r.length===0&&bS(e)&&(a=e.symbol),a)if(a.type.includes("3d")){const h=a.symbolLayers.getItemAt(0);h.type==="water"?_(h.color)&&(l=h.color):_(h.material)&&_(h.material.color)&&(l=h.material.color)}else a.url||(l=a.color);const c=this.effectList;return(await Promise.all(o.map(async h=>{if(!h.legendOptions||h.legendOptions.showLegend!==!1){const p=hW(e)?h.field:this._getRampTitle(h,t);let f=null;const m="getField"in t&&t.getField&&t.getField(h.field),y=m&&f3e(m);if(h.type==="color"){const v=await j7(h,null,y);f={type:"color-ramp",title:p,infos:v,preview:B1(v.map(w=>w.color),{effectList:c})},this._hasColorRamp||(this._hasColorRamp=!(f.infos==null||!f.infos.length))}else if(h.type==="size"&&h.target!=="outline")FL.test(h.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=h):(f=await this._getSizeLegendElement(p,h,e,y),this._hasSizeRamp||(this._hasSizeRamp=!(f.infos==null||!f.infos.length)));else if(h.type==="opacity"){const v=await j7(h,l,y);f={type:"opacity-ramp",title:p,infos:v,preview:B1(v.map(w=>w.color),{effectList:c})},this._hasOpacityRamp||(this._hasOpacityRamp=!(f.infos==null||!f.infos.length))}return f&&f.infos?f:null}}))).filter(h=>!!h)}_getDomainName(e,t,i){if(e&&typeof e!="function"){const r="getField"in i&&i.getField&&i.getField(e),s=r&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(r.name):null;return s&&s.type==="coded-value"?s.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&t.featureReduction.type==="cluster"){const r=t.featureReduction,s="popupTemplate"in r&&r.popupTemplate,n=s&&s.fieldInfos;if(n){for(const o of n)if(o.fieldName===i)return i==="cluster_count"?o.label||{showCount:!0}:o.label}}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,r=e.normalizationField,s=!1,n=!1,o=!1,a=null;i=typeof i=="function"?null:i,r=typeof r=="function"?null:r;const l=e.legendOptions&&e.legendOptions.title;if(l!=null)a=l;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const c=t.renderer.authoringInfo.visualVariables;for(let h=0;h<c.length;h++){const p=c[h];if(p.type==="color"){if(p.style==="ratio"){s=!0;break}if(p.style==="percent"){n=!0;break}if(p.style==="percent-of-total"){o=!0;break}}}}a={field:i&&this._getFieldAlias(i,t),normField:r&&this._getFieldAlias(r,t),ratio:s,ratioPercent:n,ratioPercentTotal:o}}return a}_getRendererTitle(e,t){const i=e;if(i.legendOptions&&i.legendOptions.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let r=i.field,s=null,n=null;wS(i)&&(s=i.normalizationField,n=i.normalizationType==="percent-of-total"),r=typeof r=="function"?null:r,s=typeof s=="function"?null:s;let o=null;return(r||s)&&(o={field:r&&this._getFieldAlias(r,t),normField:s&&this._getFieldAlias(s,t),normByPct:n}),o}_getFieldAlias(e,t){const i="popupTemplate"in t&&t.popupTemplate,r=i&&i.fieldInfos;let s=null;r&&r.some(l=>e===l.fieldName&&(s=l,!0));let n=null;"getField"in t&&t.getField?n=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(n=t.fieldsIndex.get(e));const o=s||n;let a=null;return o&&(a=s&&s.label||n&&n.alias||"name"in o&&o.name||"fieldName"in o&&o.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let i=!1;return wS(e)&&e.classBreakInfos&&e.classBreakInfos.length===1&&t&&(i=e.field?t.some(r=>!(!r||e.field!==r.field||(e.normalizationField||r.normalizationField)&&e.normalizationField!==r.normalizationField)):!!t.length),i}};u([d()],$n.prototype,"children",void 0),u([d({readOnly:!0})],$n.prototype,"effectList",null),u([d()],$n.prototype,"layerView",void 0),u([d()],$n.prototype,"layer",void 0),u([d()],$n.prototype,"legendElements",void 0),u([d({readOnly:!0})],$n.prototype,"opacity",null),u([d()],$n.prototype,"parent",void 0),u([d({readOnly:!0,dependsOn:[]})],$n.prototype,"ready",null),u([d()],$n.prototype,"hideLayersNotInCurrentView",void 0),u([d()],$n.prototype,"keepCacheOnDestroy",void 0),u([d()],$n.prototype,"respectLayerVisibility",void 0),u([d({readOnly:!0})],$n.prototype,"scale",null),u([d()],$n.prototype,"sublayerIds",void 0),u([d({readOnly:!0})],$n.prototype,"isScaleDriven",null),u([d()],$n.prototype,"title",void 0),u([d({readOnly:!0,dependsOn:["ready"],value:0})],$n.prototype,"version",null),u([d()],$n.prototype,"view",void 0),$n=u([P("esri.widgets.Legend.support.ActiveLayerInfo")],$n);const PAe=$n,d1={state:"state",view:"view",allLayerViews:"all-layer-views",legendProperties:"legend-properties"},IAe=ut.ofType(PAe),qxt=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],$Ae="view.basemapView.baseLayerViews",LAe="view.groundView.layerViews",DAe="view.basemapView.referenceLayerViews",Wxt=[$Ae,LAe,"view.layerViews",DAe];let gh=class extends Se{constructor(e){super(e),this._handles=new Nt,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new ut,this.activeLayerInfos=new IAe,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add(ie(()=>this.view,()=>this._viewHandles(),Rt),d1.view),this._handles.add(_fe(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(d1.state),this.view&&this._handles.add(ie(()=>this.state,()=>this._stateHandles(),Rt),d1.state)}_stateHandles(){this._resetAll(),this.state==="ready"&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([d1.allLayerViews,d1.legendProperties]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",t=>this._allLayerViewsChangeHandle(t)),d1.allLayerViews),this._handles.add(ie(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),d1.legendProperties)}_allLayerViewsChangeHandle(e){e.removed.forEach(t=>this._destroyViewActiveLayerInfo(t.uid)),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach(r=>{if(!r.parent){const s=r.layer.parent,n=s&&"uid"in s&&this._layerViewByLayerId[s.uid],o=n&&this._activeLayerInfosByLayerViewId[n.uid];o&&e.includes(o)&&(t.push(r),r.parent=o,o.children.add(r),this._sortActiveLayerInfos(o.children))}}),e.removeMany(t);const i={};this.view.allLayerViews.forEach((r,s)=>i[r.layer.uid]=s),e.sort((r,s)=>{const n=i[r.layer.uid]||0;return(i[s.layer.uid]||0)-n})}_generateLayerViews(){const e=[];return Wxt.filter(this._filterLayerViews,this).map(this.get,this).filter(t=>t!=null).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===$Ae||e===DAe),i=!this.groundLegendVisible&&e===LAe;return!t&&!i}_collectLayerViews(e,t){const i=r=>(r&&r.forEach(s=>{t.push(s),i(s[e])}),t);return i}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some(i=>this._hasLayerInfo(i,e))}_hasLayerInfo(e,t){const i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(i=>this._isLayerUIDMatching(i,t))}_isLayerViewSupported(e){return!!qxt.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(ie(()=>{var t;return[e.legendEnabled,(t=e.layer)==null?void 0:t.legendEnabled]},()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var o;const t=e.layer,i=e.uid,r=this._layerInfosByLayerViewId[i];let s=this._activeLayerInfosByLayerViewId[i];if(!s){const a=r&&r.title!==void 0&&r.layer.uid===t.uid;s=new PAe({layer:t,layerView:e,title:a?r.title:t.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:r&&r.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=s}const n=t.parent&&"uid"in t.parent&&this._layerViewByLayerId[(o=t.parent)==null?void 0:o.uid];if(s.parent=this._activeLayerInfosByLayerViewId[n==null?void 0:n.uid],!this._handles.has(i)){const a=[ie(()=>t.title,l=>this._titleHandle(l,s)),ie(()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol],()=>this._constructLegendElements(s)),jo(()=>{var l;return((l=this.view)==null?void 0:l.stationary)===!0},()=>this._scaleHandle(s),Rt),ie(()=>e._effectiveRenderer,()=>this._constructLegendElements(s)),ie(()=>"effect"in t&&t.effect,()=>this._constructLegendElements(s))];if(this.respectLayerVisibility){const l=ie(()=>e.legendEnabled,h=>this._legendEnabledHandle(h,s)),c=ie(()=>t.legendEnabled,h=>this._legendEnabledHandle(h,s));a.push(l,c)}this._handles.add(a,i)}s.isScaleDriven||this._constructLegendElements(s),this._addActiveLayerInfo(s)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){var r;const{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const s=e.parent;if(s)s.children.includes(e)||s.children.push(e),this._sortActiveLayerInfos(s.children);else{const n=(r=this.layerInfos)==null?void 0:r.some(o=>o.layer.uid===i.uid);i.parent&&"uid"in i.parent&&!n?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const n=[];this._activeLayerInfosWithNoParent.forEach(o=>{const a=o.layer.parent,l=a&&"uid"in a&&this._layerViewByLayerId[a==null?void 0:a.uid],c=this._activeLayerInfosByLayerViewId[l==null?void 0:l.uid];c&&(n.push(o),o.parent=c)}),n.length&&(this._activeLayerInfosWithNoParent.removeMany(n),n.forEach(o=>this._addActiveLayerInfo(o)))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){var i;const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&((i=t.featureReduction)==null?void 0:i.type)==="binning"&&"renderer"in t.featureReduction?e.buildLegendElementsForRenderer(t.featureReduction.renderer):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach(r=>this._constructLegendElements(r))}};u([d({type:IAe})],gh.prototype,"activeLayerInfos",void 0),u([d()],gh.prototype,"basemapLegendVisible",void 0),u([d()],gh.prototype,"groundLegendVisible",void 0),u([d()],gh.prototype,"hideLayersNotInCurrentView",void 0),u([d()],gh.prototype,"keepCacheOnDestroy",void 0),u([d()],gh.prototype,"respectLayerVisibility",void 0),u([d()],gh.prototype,"layerInfos",void 0),u([d({readOnly:!0})],gh.prototype,"state",null),u([d()],gh.prototype,"view",void 0),gh=u([P("esri.widgets.Legend.LegendViewModel")],gh);const Xxt=gh,Zxt="http://www.w3.org/2000/svg",Nr={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};function NAe(e,t,i,r){const{focus:s,labels:n}=e,o=!!s,a=Yxt(e,t,i,r),l={justifyContent:"center"},c=cp();return o?k("div",{class:Nr.diamondContainer,styles:l},k("div",{class:Nr.diamondLeftCol},c?n.right:n.left),k("div",{class:Nr.diamondMidCol},k("div",{class:Nr.diamondMidColLabel},n.top),a,k("div",{class:Nr.diamondMidColLabel},n.bottom)),k("div",{class:Nr.diamondRightCol},c?n.left:n.right)):k("div",{class:Nr.squareTable},k("div",{class:Nr.squareTableRow},k("div",{class:AS(Nr.squareTableCell,Nr.squareTableLabel,Nr.squareTableLabelRightBottom)},c?n.top:n.left),k("div",{class:Nr.squareTableCell}),k("div",{class:AS(Nr.squareTableCell,Nr.squareTableLabel,Nr.squareTableLabelLeftBottom)},c?n.left:n.top)),k("div",{class:Nr.squareTableRow},k("div",{class:Nr.squareTableCell}),a,k("div",{class:Nr.squareTableCell})),k("div",{class:Nr.squareTableRow},k("div",{class:AS(Nr.squareTableCell,Nr.squareTableLabel,Nr.squareTableLabelRightTop)},c?n.right:n.bottom),k("div",{class:Nr.squareTableCell}),k("div",{class:AS(Nr.squareTableCell,Nr.squareTableLabel,Nr.squareTableLabelLeftTop)},c?n.bottom:n.right)))}function uhe(e,t,i){const r=`${i}_arrowStart`,s=`${i}_arrowEnd`,n=e==="left",o={markerStart:null,markerEnd:null};switch(t){case"HL":n?o.markerStart=`url(#${s})`:o.markerEnd=`url(#${r})`;break;case"LL":o.markerStart=`url(#${s})`;break;case"LH":n?o.markerEnd=`url(#${r})`:o.markerStart=`url(#${s})`;break;default:o.markerEnd=`url(#${r})`}return o}function Yxt(e,t,i,r,s=60){const{focus:n,numClasses:o,colors:a,rotation:l}=e,c=!!n,h=Math.sqrt(s**2+s**2)+(c?0:5),p=[],f=[],m=[],y=(s||75)/o;for(let z=0;z<o;z++){const B=z*y;for(let V=0;V<o;V++){const Q=V*y,Z=OY(a[z][V]),ce=PY(null),oe={type:"rect",x:Q,y:B,width:y,height:y};p.push(P1e(Z)),f.push(MY(oe,Z.fill,ce,null)),m.push(I1e(oe))}}const v=10,w=15,b=15,S=10;let T=null;c||(T="margin: -15px -15px -18px -15px");const E=uhe("left",n,t),C=uhe("right",n,t),A=$1e(m),I=hH(A,h,h,0,!1,l,!1),D=hH(A,h,h,0,!1,c?-45:null,!1),L={filter:mO(r),opacity:i==null?null:`${i}`};return k("div",{styles:L,class:c?Nr.diamondMidColRamp:Nr.squareTableCell},k("svg",{xmlns:Zxt,width:h,height:h,style:T},k("defs",null,k("marker",{id:`${t}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},k("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),k("marker",{id:`${t}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},k("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),p),k("g",{transform:I},f),k("g",{transform:D},k("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":E.markerStart,"marker-end":E.markerEnd,x1:-v,y1:s-w,x2:-v,y2:w}),k("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:b,y1:s+S,x2:s-b,y2:s+S}))))}const Qxt=NF(),FAe=10,mK=20,Iz=10,gK=20,yK={univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",colorRamp:"esri-legend__color-ramp"};function Jxt(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return e==="vertical"?k("svg",{height:"4",width:"10"},k("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):k("svg",{height:"10",width:"10"},k("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function Kxt(e,t="vertical"){const i=document.createElement("div");return i.style.height=`${mK}px`,i.className=yK.univariateAboveAndBelowSymbol,e!=null&&(i.style.opacity=e.toString()),Qxt.append(i,Jxt.bind(null,t)),i}function kAe(e,t,i="vertical",r){e.infos.forEach((s,n)=>{if(r&&n===2)s.preview=Kxt(t,i);else{const o=gi(s.size)+(i==="horizontal"?gK:Iz),a=s.preview.tagName.toLowerCase()==="div",l=a?s.preview:document.createElement("div");l.className=yK.univariateAboveAndBelowSymbol,i==="horizontal"?l.style.width=`${o}px`:l.style.height=`${o}px`,a||l.appendChild(s.preview),s.preview=l}})}function C5(e,t="classic"){const i=e.infos;return t==="classic"?(gi(i[0].size)+Iz)/2:(gi(i[0].size)-gi(i[i.length-1].size))/2}function S2(e,t){if(!e)return null;const i=e.infos.map(s=>s.color),r=B1(t.type==="full"?i:t.type==="above"?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return r.className=yK.colorRamp,t.opacity!=null&&(r.style.opacity=t.opacity.toString()),r}function pW(e,t,i,r="vertical"){let s=0;const n=e.infos,o=Math.floor(n.length/2),a=t==="full"||t==="above"?0:o,l=t==="full"||t==="below"?n.length-1:o;for(let c=a;c<=l;c++)i&&c===o?s+=r==="horizontal"?FAe:mK:s+=gi(n[c].size)+(r==="horizontal"?gK:Iz);return Math.round(s)}function E2(e,t,i,r="vertical"){const s=pW(e,t,i,r),n=e.infos,o=Math.floor(n.length/2),a=t==="full"||t==="above"?0:o,l=t==="full"||t==="below"?n.length-1:o,c=t==="full"?n[a].size+n[l].size:t==="above"?n[a].size:n[l].size,h=i?r==="vertical"?mK:FAe:0,p=r==="vertical"?Iz*(t==="full"?2:1):gK*(t==="full"?2:1);return Math.round(s-(gi(c)/2+h/2+p/2))}function UAe(e,t,i="vertical"){const r=e.infos;let s=r.find(({type:o})=>o==="size-ramp"),n=r.find(({type:o})=>o==="color-ramp");return s&&(s=F({},s),s.infos=[...s.infos],kAe(s,t,i,!0)),n&&(n=F({},n),n.infos=[...n.infos]),i==="horizontal"&&(s==null||s.infos.reverse(),n==null||n.infos.reverse()),{sizeRampElement:s,colorRampElement:n}}function zAe(e,t="vertical"){const i=e.infos;let r=i.find(({type:n})=>n==="size-ramp"),s=i.find(({type:n})=>n==="color-ramp");return r&&(r=F({},r),r.infos=[...r.infos],kAe(r,null,t,!1)),s&&(s=F({},s),s.infos=[...s.infos]),t==="horizontal"&&(r==null||r.infos.reverse(),s==null||s.infos.reverse()),{sizeRampElement:r,colorRampElement:s}}function eTt(e,t){return t}function ao(e){const t=this;e.appendChild(t)}function C2(e,t,i){if(!t)return;if(typeof t=="string"||typeof t=="number")return t;if("value"in t||"unit"in t)return _h(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let r=null;return eTt(t,i)?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:VAe(t,i)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?_h(r==="showField"?"{field}":e[r],{field:t.field,normField:t.normField}):null}function VAe(e,t){return!t}function BAe(e,t){return!!(t&&t==="Stretched"&&e.version>=10.3&&e.declaredClass==="esri.layers.ImageryLayer")}const _t={activated:"esri-legend--card__carousel-indicator--activated",base:"esri-legend--card",stacked:"esri-legend--stacked",carouselTitle:"esri-legend--card__carousel-title",indicator:"esri-legend--card__carousel-indicator",intervalSeparator:"esri-legend--card__interval-separator",imageryLayerStretchedImage:"esri-legend--card__imagery-layer-image--stretched",imageLabel:"esri-legend--card__image-label",layerCaption:"esri-legend--card__layer-caption",labelElement:"esri-legend--card__label-element",layerRow:"esri-legend--card__layer-row",labelCell:"esri-legend--card__label-cell",message:"esri-legend--card__message",rampLabel:"esri-legend--card__ramp-label",section:"esri-legend--card__section",relationshipSection:"esri-legend--card__relationship-section",serviceCaptionText:"esri-legend--card__service-caption-text",serviceContent:"esri-legend--card__service-content",service:"esri-legend--card__service",groupLayer:"esri-legend--card__group-layer",groupLayerChild:"esri-legend--card__group-layer-child",symbol:"esri-legend--card__symbol",sizeRampRow:"esri-legend--card__size-ramp-row",symbolRow:"esri-legend--card__symbol-row",symbolCell:"esri-legend--card__symbol-cell",indicatorContainer:"esri-legend--card__carousel-indicator-container",intervalSeparatorsContainer:"esri-legend--card__interval-separators-container",relationshipLabelContainer:"esri-legend--card__relationship-label-container",labelContainer:"esri-legend--card__label-container",serviceCaptionContainer:"esri-legend--card__service-caption-container",symbolContainer:"esri-legend--card__symbol-container",sizeRampContainer:"esri-legend--card__size-ramp-container",sizeRampPreview:"esri-legend--card__size-ramp-preview",pieChartRampPreview:"esri-legend--card__pie-chart-ramp-preview",rampContainer:"esri-legend__ramps",sizeRampHorizontal:"esri-legend__size-ramp--horizontal",rampLabelsContainer:"esri-legend__ramp-labels",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card",hidden:"esri-hidden"},tTt=25,iTt=25,rTt=768,sTt=100;var jM;(function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"})(jM||(jM={}));const nTt="#ddd",wT=window.devicePixelRatio;function oTt(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1),r=i.resource&&i.resource.primitive;return r==="circle"||r==="cross"||r==="kite"||r==="sphere"||r==="cube"||r==="diamond"}{const t=e.style;return t==="circle"||t==="diamond"||t==="cross"}}}function aTt(e){if(e){if(e.type.includes("3d")){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return i==="triangle"||i==="cone"||i==="tetrahedron"}return e.style==="triangle"}}let Ud=class extends Wn{constructor(e,t){super(e,t),this._handles=new Nt,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout=jM.Stack,this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own(ie(()=>this.activeLayerInfos,e=>{this._handles.removeAll(),this._watchForSectionChanges(e)}))}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators=this.layout===jM.Auto&&this.view.container.clientWidth<=rTt||this.layout===jM.Stack;const e=this.activeLayerInfos,t=e&&e.toArray().map(a=>this._renderLegendForLayer(a)).filter(a=>!!a);this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const i=this._sectionNames.length,r=this._sectionNames.map((a,l)=>{const c=_h(this.messagesCommon.pagination.pageText,{index:l+1,total:i});return k("div",{key:a,role:"tab",id:a,"aria-label":c,"aria-controls":`${a}-panel`,"aria-selected":(this._selectedSectionName===a).toString(),tabIndex:this._selectedSectionName===a?0:-1,title:c,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(_t.indicator,{[_t.activated]:this._selectedSectionName===a}),"data-section-name":a})}),s=this._hasIndicators&&i>1?k("div",{class:_t.indicatorContainer,key:"carousel-navigation",role:"tablist"},r):null,n=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,o={[_t.stacked]:this._hasIndicators};return k("div",{class:this.classes(_t.base,o)},n||k("div",{class:_t.message},this.messages.noLegend),s)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,i=t==="ArrowLeft"?-1:1,r=e.target.getAttribute("data-section-name"),s=this._sectionNames.indexOf(r),n=this._sectionNames;let o=null;s!==-1&&(n[s+i]?o=document.getElementById(n[s+i]):t==="ArrowLeft"?o=document.getElementById(n[n.length-1]):t==="ArrowRight"&&(o=document.getElementById(n[0])),o&&o.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach(i=>{const r=`activeLayerInfo-${i.layer.uid}-version-change`;this._handles.remove(r),this._watchForSectionChanges(i.children),this._handles.add(ie(()=>i.version,()=>this._generateSectionNames()),r)});const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",()=>this._watchForSectionChanges(e)),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,i){return`${this.id}${e.uid}-type-${t.type}-${i}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((t,i)=>{this._sectionNames.push(this._getSectionName(e.layer,t,i))})}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map(i=>this._renderLegendForLayer(i)).toArray();return k("div",{key:e.layer.uid,class:this.classes(_t.service,_t.groupLayer)},k("div",{class:_t.serviceCaptionContainer},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const i=t.some(n=>n.type==="relationship-ramp"),r=t.map((n,o)=>this._renderLegendForElement(n,e,o,i)).filter(n=>!!n);if(!r.length)return null;const s={[_t.groupLayerChild]:!!e.parent};return k("div",{key:e.layer.uid,class:this.classes(_t.service,s)},k("div",{class:_t.serviceCaptionContainer},k("div",{class:_t.serviceCaptionText},e.title)),k("div",{class:_t.serviceContent},r))}}_renderLegendForElement(e,t,i,r=!1){const s=e.type==="color-ramp",n=e.type==="opacity-ramp",o=e.type==="size-ramp",a=t.layer;let l=null;if(typeof e.title=="string")l=e.title;else if(e.title){const y=e.title,v=C2(this.messages,y,s||n);l=y.title?`${y.title} (${v})`:v}const c=this._getSectionName(a,e,i),h=this._hasIndicators?k("div",null,k(tw,{level:this.headingLevel,class:_t.carouselTitle},t.title),k(tw,{level:oUe(this.headingLevel),class:_t.layerCaption},l)):l?k(tw,{level:this.headingLevel,class:_t.layerCaption},l):null,p=t.effectList;let f=null;if(e.type==="symbol-table"){const y=e.infos.map((v,w)=>this._renderLegendForElementInfo(v,t,e.legendType,w)).filter(v=>!!v);if(y.length){const v=y[0].properties.classes&&y[0].properties.classes[_t.symbolRow],w={[_t.labelContainer]:!v&&!r,[_t.relationshipLabelContainer]:r};f=k("div",{class:this.classes(w)},y)}}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"?f=this._renderLegendForRamp(e,a.opacity,p):o?f=this._renderSizeRamp(e,a.opacity):e.type==="pie-chart-ramp"?f=this._renderPieChartRamp(e):e.type==="relationship-ramp"?f=NAe(e,this.id,a.opacity,p):e.type==="univariate-above-and-below-ramp"?f=this._renderUnivariateAboveAndBelowRamp(e,a.opacity,p):e.type==="univariate-color-size-ramp"&&(f=this._renderUnivariateColorSizeRamp(e,a.opacity,p));if(!f)return null;const m=k("div",{key:c,class:_t.section,id:`${c}-panel`,role:"tabpanel","aria-labelledby":c,tabIndex:0},[h,f]);return this._sectionMap.set(c,m),m}_renderPieChartRamp(e){return k("div",{class:_t.pieChartRampPreview,bind:e.preview,afterCreate:ao})}_renderUnivariateAboveAndBelowRamp(e,t,i){const{sizeRampElement:r,colorRampElement:s}=UAe(e,t,"horizontal");if(!r)return null;const n=pW(r,"full",!0,"horizontal"),o=E2(r,"above",!0,"horizontal"),a=E2(r,"below",!0,"horizontal"),l=12,c=S2(s,{width:o,height:l,rampAlignment:"horizontal",opacity:t,type:"above",effectList:i}),h=S2(s,{width:a,height:l,rampAlignment:"horizontal",opacity:t,type:"below",effectList:i}),p=C5(r,"card"),f=r.infos.map(T=>T.label),m=f.length-1,y=f.map((T,E)=>E===0||E===m?k("div",{key:E},T):null),v={display:"flex",flexDirection:"column"},w={display:"flex",flexDirection:"row"},b={marginTop:"3px",display:"flex"};cp(this.container)?b.marginRight=`${p}px`:b.marginLeft=`${p}px`;const S={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return k("div",{class:_t.layerRow,key:"size-ramp-preview",styles:v},k("div",{class:this.classes(_t.symbolContainer,_t.sizeRampHorizontal),styles:w},r.infos.map((T,E)=>k("div",{key:E,class:_t.symbol,bind:T.preview,afterCreate:ao}))),c?k("div",{class:_t.univariateAboveAndBelowColorRamp,styles:b,key:"color-ramp-preview"},k("div",{bind:c,afterCreate:ao}),k("div",{bind:h,afterCreate:ao})):null,k("div",{class:_t.layerInfo},k("div",{class:_t.rampLabelsContainer,styles:S},y)))}_renderUnivariateColorSizeRamp(e,t,i){const{sizeRampElement:r,colorRampElement:s}=zAe(e,"horizontal");if(!r)return null;const n=pW(r,"full",!1,"horizontal"),o=E2(r,"full",!1,"horizontal"),a=S2(s,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:i}),l=C5(r,"card"),c=r.infos.length-1,h=r.infos.map((v,w)=>w===0||w===c?k("div",{key:w},v.label):null),p={display:"flex",flexDirection:"column"},f={display:"flex",flexDirection:"row"},m={marginTop:"3px",display:"flex"};cp(this.container)?m.marginRight=`${l}px`:m.marginLeft=`${l}px`;const y={width:`${n}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return k("div",{class:_t.layerRow,key:"size-ramp-preview",styles:p},k("div",{class:this.classes(_t.symbolContainer,_t.sizeRampHorizontal),styles:f},r.infos.map((v,w)=>k("div",{key:w,class:_t.symbol,bind:v.preview,afterCreate:ao}))),k("div",{class:_t.univariateAboveAndBelowColorRamp,styles:m,key:"color-ramp-preview"},k("div",{bind:a,afterCreate:ao})),k("div",{class:_t.layerInfo},k("div",{class:_t.rampLabelsContainer,styles:y},h)))}_renderLegendForElementInfo(e,t,i,r){var o,a;const s=t.layer;if(e.type)return this._renderLegendForElement(e,t,r);const n=BAe(s,i);if(e.preview){if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return k("div",{key:r,bind:e.preview,afterCreate:ao});const C={[_t.symbolCell]:this._hasIndicators};return k("div",{key:r,class:this.classes(_t.layerRow,{[_t.symbolRow]:this._hasIndicators})},k("div",{class:this.classes(C),bind:e.preview,afterCreate:ao}),k("div",{class:this.classes(_t.imageLabel,{[_t.labelCell]:this._hasIndicators})},C2(this.messages,e.label,!1)||""))}let l=255,c=255,h=255,p=0,f=255,m=255,y=255,v=0;const w=e.symbol.color&&e.symbol.color.a,b=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;w&&(l=e.symbol.color.r,c=e.symbol.color.g,h=e.symbol.color.b,p=e.symbol.color.a*s.opacity),b&&(f=e.symbol.outline.color.r,m=e.symbol.outline.color.g,y=e.symbol.outline.color.b,v=e.symbol.outline.color.a*s.opacity);const S=(a=(o=e.symbol.color)==null?void 0:o.isBright)!=null?a:!0,T=S?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",E={background:w?`rgba(${l}, ${c}, ${h}, ${p})`:"none",color:S?"black":"white",textShadow:`-1px -1px 0 ${T},
                                              1px -1px 0 ${T},
                                              -1px 1px 0 ${T},
                                              1px 1px 0 ${T}`,border:b?`1px solid rgba(${f}, ${m}, ${y}, ${v})`:"none",filter:mO(t.effectList)};return k("div",{key:r,class:_t.layerRow},k("div",{class:_t.labelElement,styles:E}," ",e.label," "))}if(e.src){const l=this._renderImage(e,s,n);return k("div",{key:r,class:_t.layerRow},l,k("div",{class:_t.imageLabel},e.label||""))}}_renderImage(e,t,i){const{label:r,src:s,opacity:n}=e,o={[_t.imageryLayerStretchedImage]:i,[_t.symbol]:!i},a={opacity:`${n!=null?n:t.opacity}`};return k("img",{alt:C2(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:a})}_renderSizeRampLines(e){const t=e.infos,i=t[0],r=t[t.length-1],s=i.symbol,n=this._hasIndicators,o=gi(i.size+i.outlineSize)*wT,a=gi(r.size+r.outlineSize)*wT,l=n?o:o+50*wT,c=n?o/2+50*wT:o,h=aTt(s),p=oTt(s),f=document.createElement("canvas");f.width=l,f.height=c,f.style.width=f.width/wT+"px",f.style.height=f.height/wT+"px";const m=f.getContext("2d");if(n){m.beginPath();const y=0,v=0,w=l/2-a/2,b=c;m.moveTo(y,v),m.lineTo(w,b);const S=l,T=0,E=l/2+a/2,C=c;m.moveTo(S,T),m.lineTo(E,C)}else{m.beginPath();const y=0,v=c/2-a/2,w=l,b=0;m.moveTo(y,v),m.lineTo(w,b);const S=0,T=c/2+a/2,E=l,C=c;m.moveTo(S,T),m.lineTo(E,C)}return m.strokeStyle=nTt,m.stroke(),k("div",{bind:f,afterCreate:ao,styles:n?{display:"flex",marginTop:`-${h?0:p?o/2:0}px`,marginBottom:`-${h?a:p?a/2:0}px`}:{display:"flex",marginRight:`-${h?0:p?o/2:0}px`,marginLeft:`-${h?0:p?a/2:0}px`}})}_renderSizeRamp(e,t){const i=e.infos,r=i[0].label,s=i[i.length-1].label;let n=i[0].preview,o=i[i.length-1].preview;const a=this._hasIndicators,l={"flex-direction":a?"column":"row-reverse"};n&&(n=n.cloneNode(!0),n.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const c={opacity:t!=null?`${t}`:""};return k("div",{class:this.classes(_t.layerRow,{[_t.sizeRampRow]:a})},k("div",{class:_t.rampLabel},a?r:s),k("div",{class:_t.sizeRampContainer,styles:l},k("div",{bind:n,afterCreate:ao,class:_t.sizeRampPreview,styles:c}),this._renderSizeRampLines(e),k("div",{bind:o,afterCreate:ao,class:_t.sizeRampContainer,styles:c})),k("div",{class:_t.rampLabel},a?s:r))}_renderLegendForRamp(e,t,i){const r=e.infos,s=e.type==="heatmap-ramp",n=r.length-1,o=iTt,a=n>2&&!s?tTt*n:sTt,l=a+20,c=10,h=r.slice(0).reverse();h.forEach((C,A)=>{C.offset=s?C.ratio:A/n});const p=h.length-1,f=h.length%2!=0&&h[h.length/2|0],m=f&&k("div",{class:_t.intervalSeparatorsContainer},k("div",{class:_t.intervalSeparator},"|"),k("div",{class:_t.rampLabel},f.label)),y=r[r.length-1].label,v=r[0].label,w=[[{shape:{type:"path",path:`M0 ${o/2} L${c} 0 L${c} ${o} Z`},fill:h[0].color,stroke:{width:0}},{shape:{type:"rect",x:c,y:0,width:a,height:o},fill:{type:"linear",x1:c,y1:0,x2:a+c,y2:0,colors:h},stroke:{width:0}},{shape:{type:"path",path:`M${a+c} 0 L${l} ${o/2} L${a+c} ${o} Z`},fill:h[p].color,stroke:{width:0}}]],b=L1e(w,l,o),{messages:S}=this,T={filter:mO(i),opacity:t==null?null:`${t}`},E={justifyContent:"center"};return k("div",{class:_t.layerRow,styles:E},k("div",{class:_t.rampLabel},s?S[y]:y),k("div",{class:_t.symbolContainer},k("div",{styles:T},b),m),k("div",{class:_t.rampLabel},s?S[v]:v))}};u([d()],Ud.prototype,"activeLayerInfos",void 0),u([d()],Ud.prototype,"headingLevel",void 0),u([d()],Ud.prototype,"layout",void 0),u([d(),dn("esri/widgets/Legend/t9n/Legend")],Ud.prototype,"messages",void 0),u([d(),dn("esri/t9n/common")],Ud.prototype,"messagesCommon",void 0),u([d({readOnly:!0})],Ud.prototype,"type",void 0),u([d()],Ud.prototype,"view",void 0),u([gl()],Ud.prototype,"_selectSection",null),Ud=u([P("esri.widgets.Legend.styles.Card")],Ud);const W8=Ud,Ft={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},lTt="esri-legend__",cTt=24,hhe={display:"flex",alignItems:"flex-start"},X8={marginLeft:"3px"},xT={display:"table-cell",verticalAlign:"middle"};let ab=class extends Wn{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map(i=>this._renderLegendForLayer(i)).filter(i=>!!i);return k("div",null,t&&t.length?t:k("div",{class:Ft.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,i=`${lTt}${e.layer.uid}-version-${e.version}`,r=e.title?tw({level:this.headingLevel,class:this.classes(Ft.header,Ft.label)},e.title):null;if(t){const s=e.children.map(n=>this._renderLegendForLayer(n)).toArray();return k("div",{key:i,class:this.classes(Ft.service,Ft.groupLayer)},r,s)}{const s=e.legendElements;if(s&&!s.length)return null;const n=s.map(a=>this._renderLegendForElement(a,e.layer,e.effectList)).filter(a=>!!a);if(!n.length)return null;const o={[Ft.groupLayerChild]:!!e.parent};return k("div",{key:i,class:this.classes(Ft.service,o),tabIndex:0},r,k("div",{class:Ft.layer},n))}}_renderLegendForElement(e,t,i,r){const s=e.type==="color-ramp",n=e.type==="opacity-ramp",o=e.type==="size-ramp";let a=null;if(e.type==="symbol-table"||o){const m=e.infos.map(y=>this._renderLegendForElementInfo(y,t,i,o,e.legendType)).filter(y=>!!y);m.length&&(a=k("div",{class:Ft.layerBody},m))}else e.type==="color-ramp"||e.type==="opacity-ramp"||e.type==="heatmap-ramp"||e.type==="stretch-ramp"?a=this._renderLegendForRamp(e,t.opacity):e.type==="relationship-ramp"?a=NAe(e,this.id,t.opacity,i):e.type==="pie-chart-ramp"?a=this._renderPieChartRamp(e):e.type==="univariate-above-and-below-ramp"?a=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,i):e.type==="univariate-color-size-ramp"&&(a=this._renderUnivariateColorSizeRamp(e,t.opacity,i));if(!a)return null;const l=e.title;let c=null;if(typeof l=="string")c=l;else if(l){const m=C2(this.messages,l,s||n);c=VAe(l,s||n)&&l.title?`${l.title} (${m})`:m}const h=r?Ft.layerChildTable:Ft.layerTable,p=c?k("div",{class:Ft.layerCaption},c):null,f={[Ft.layerTableSizeRamp]:o||!r};return k("div",{class:this.classes(h,f)},p,a)}_renderPieChartRamp(e){return k("div",{bind:e.preview,afterCreate:ao})}_renderUnivariateAboveAndBelowRamp(e,t,i){const{sizeRampElement:r,colorRampElement:s}=UAe(e,t);if(!r)return null;const n=E2(r,"above",!0),o=E2(r,"below",!0),a=12,l=S2(s,{width:a,height:n,rampAlignment:"vertical",opacity:t,type:"above",effectList:i}),c=S2(s,{width:a,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:i}),h=C5(r),p=r.infos.map(E=>E.label),f=p.map((E,C)=>C===0?k("div",{key:C,class:E?l?Ft.univariateAboveAndBelowLabel:Ft.rampLabel:null},E):C===2?k("div",null):null),m=p.length-1,y=Math.floor(p.length/2),v=p.map((E,C)=>C===y||C===m?k("div",{key:C,class:E?l?Ft.univariateAboveAndBelowLabel:Ft.rampLabel:null},E):null),w={display:"table-cell",verticalAlign:"middle"},b={marginTop:`${h}px`},S={height:`${n}px`},T={height:`${o}px`};return k("div",{key:"univariate-above-and-below-ramp-preview",styles:hhe},k("div",{class:Ft.layerBody},r.infos.map((E,C)=>k("div",{class:this.classes(Ft.layerRow,Ft.sizeRamp)},k("div",{class:Ft.symbol,styles:w,bind:E.preview,afterCreate:ao}),l||C%2!=0?null:k("div",{class:Ft.layerInfo},p[C])))),l?k("div",{styles:b,key:"color-ramp-preview"},k("div",{styles:X8},k("div",{styles:xT},k("div",{class:Ft.rampContainer,bind:l,afterCreate:ao})),k("div",{styles:xT},k("div",{class:Ft.rampLabelsContainer,styles:S},f))),k("div",{styles:X8},k("div",{styles:xT},k("div",{class:Ft.rampContainer,bind:c,afterCreate:ao})),k("div",{styles:xT},k("div",{class:Ft.rampLabelsContainer,styles:T},v)))):null)}_renderUnivariateColorSizeRamp(e,t,i){const{sizeRampElement:r,colorRampElement:s}=zAe(e);if(!r)return null;const n=C5(r),o=12,a=E2(r,"full",!1),l=S2(s,{width:o,height:a,rampAlignment:"vertical",opacity:t,type:"full",effectList:i}),c=r.infos.length-1,h=r.infos.map((y,v)=>v===0||v===c?k("div",{key:v,class:y.label?s?Ft.univariateAboveAndBelowLabel:Ft.rampLabel:null},y.label):null),p={display:"table-cell",verticalAlign:"middle"},f={marginTop:`${n}px`},m={height:`${a}px`};return k("div",{key:"univariate-above-and-below-ramp-preview",styles:hhe},k("div",{class:Ft.layerBody},r.infos.map(y=>k("div",{class:this.classes(Ft.layerRow,Ft.sizeRamp)},k("div",{class:Ft.symbol,styles:p,bind:y.preview,afterCreate:ao})))),k("div",{styles:f,key:"color-ramp-preview"},k("div",{styles:X8},k("div",{styles:xT},k("div",{class:Ft.rampContainer,bind:l,afterCreate:ao})),k("div",{styles:xT},k("div",{class:Ft.rampLabelsContainer,styles:m},h)))))}_renderLegendForRamp(e,t){const i=e.infos,r=e.type==="opacity-ramp",s=e.type==="heatmap-ramp",n=e.type==="stretch-ramp",o=e.preview,a=r?Ft.opacityRamp:"";o.className=`${Ft.colorRamp} ${a}`,t!=null&&(o.style.opacity=t.toString());const l=i.map(p=>k("div",{class:p.label?Ft.rampLabel:null},s?this.messages[p.label]||p.label:n?this._getStretchStopLabel(p):p.label)),c={width:`${cTt}px`},h={height:o.style.height};return k("div",{class:Ft.layerRow},k("div",{class:Ft.symbolContainer,styles:c},k("div",{class:Ft.rampContainer,bind:o,afterCreate:ao})),k("div",{class:Ft.layerInfo},k("div",{class:Ft.rampLabelsContainer,styles:h},l)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+(typeof e.value=="string"?e.value:Wh(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}_renderLegendForElementInfo(e,t,i,r,s){if(e.type)return this._renderLegendForElement(e,t,i,!0);let n=null;const o=BAe(t,s);if(e.preview?n=k("div",{class:Ft.symbol,bind:e.preview,afterCreate:ao}):e.src&&(n=this._renderImage(e,t,o)),!n)return null;const a={[Ft.imageryLayerInfoStretched]:o},l={[Ft.imageryLayerInfoStretched]:o,[Ft.sizeRamp]:!o&&r};return k("div",{class:Ft.layerRow},k("div",{class:this.classes(Ft.symbolContainer,l)},n),k("div",{class:this.classes(Ft.layerInfo,a)},C2(this.messages,e.label,!1)||""))}_renderImage(e,t,i){const{label:r,src:s,opacity:n}=e,o={[Ft.imageryLayerStretchedImage]:i,[Ft.symbol]:!i},a={opacity:`${n!=null?n:t.opacity}`};return k("img",{alt:C2(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:a})}};u([d()],ab.prototype,"activeLayerInfos",void 0),u([d()],ab.prototype,"headingLevel",void 0),u([d(),dn("esri/widgets/Legend/t9n/Legend")],ab.prototype,"messages",void 0),u([d({readOnly:!0})],ab.prototype,"type",void 0),ab=u([P("esri.widgets.Legend.styles.Classic")],ab);const TT=ab,UL={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let Po=class extends Wn{constructor(e,t){super(e,t),this._handles=new Nt,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=UL.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new TT,this.view=null,this.viewModel=new Xxt}initialize(){this.own([ns(()=>this.view,"resize",()=>this.scheduleRender()),ns(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),ie(()=>this.headingLevel,e=>{const{style:t}=this;t&&(t.headingLevel=e)}),ie(()=>this.style,(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,e.type==="card"&&(e.view=this.view),e.headingLevel=this.headingLevel)},Rt)])}destroy(){this._handles=lt(this._handles)}castStyle(e){if(e instanceof W8||e instanceof TT)return e;if(typeof e=="string")return e==="card"?new W8:new TT;if(e&&typeof e.type=="string"){const t=F({},e);return delete t.type,new(e.type==="card"?W8:TT)(t)}return new TT}render(){return k("div",{class:this.classes(UL.base,UL.widget,this.style instanceof TT?UL.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach(t=>this._renderOnActiveLayerInfoChange(t)),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=ie(()=>e.version,()=>this.scheduleRender());this._handles.add(t,`version_${e.layer.uid}`);const i=ns(()=>e.children,"change",()=>e.children.forEach(r=>this._renderOnActiveLayerInfoChange(r)),Rt);this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach(r=>this._renderOnActiveLayerInfoChange(r))}};u([Xe("viewModel.activeLayerInfos")],Po.prototype,"activeLayerInfos",void 0),u([Xe("viewModel.basemapLegendVisible")],Po.prototype,"basemapLegendVisible",void 0),u([Xe("viewModel.groundLegendVisible")],Po.prototype,"groundLegendVisible",void 0),u([d()],Po.prototype,"headingLevel",void 0),u([Xe("viewModel.hideLayersNotInCurrentView")],Po.prototype,"hideLayersNotInCurrentView",void 0),u([Xe("viewModel.keepCacheOnDestroy")],Po.prototype,"keepCacheOnDestroy",void 0),u([Xe("viewModel.respectLayerVisibility")],Po.prototype,"respectLayerVisibility",void 0),u([d()],Po.prototype,"iconClass",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Po.prototype,"label",void 0),u([Xe("viewModel.layerInfos")],Po.prototype,"layerInfos",void 0),u([d(),dn("esri/widgets/Legend/t9n/Legend")],Po.prototype,"messages",void 0),u([d()],Po.prototype,"style",void 0),u([qt("style")],Po.prototype,"castStyle",null),u([Xe("viewModel.view")],Po.prototype,"view",void 0),u([d()],Po.prototype,"viewModel",void 0),Po=u([P("esri.widgets.Legend")],Po);const YCt=Po;let H0=class extends Se{constructor(e){super(e),this._viewpointHandle=null,this._handles=new Nt,this.group=null}initialize(){this._handles.add(ns(()=>{var e;return(e=this.view)==null?void 0:e.ui},"expand",e=>{const{target:t}=e;t&&t!==this&&t.expanded&&t.group&&t.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(e){this._set("autoCollapse",e),this._watchViewpoint()}set expanded(e){const t=!!e;this._set("expanded",t);const i=this.get("view.ui");i&&i.emit("expand",{target:this}),this._viewpointHandleChange(t)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){this._get("view")!==e&&(this._set("view",e),e&&jo(()=>e.ready,()=>{this.view===e&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(e){this._viewpointHandle&&(e?jo(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const e="viewpoint";this._handles.remove(e),this._viewpointHandle=null;const{autoCollapse:t,view:i}=this;if(i&&t){const r=qLe(()=>i.type==="3d"?i.camera:i.viewpoint,()=>this._collapse());this._handles.add(r,e),this._viewpointHandle=r}}_collapse(){this.expanded=!1}};u([d({value:!1})],H0.prototype,"autoCollapse",null),u([d({value:!1})],H0.prototype,"expanded",null),u([d()],H0.prototype,"group",void 0),u([d({readOnly:!0})],H0.prototype,"state",null),u([d({value:null})],H0.prototype,"view",null),H0=u([P("esri.widgets.Expand.ExpandViewModel")],H0);const GAe=H0,An={base:"esri-expand esri-widget",modeAuto:"esri-expand--auto",modeDrawer:"esri-expand--drawer",modeFloating:"esri-expand--floating",container:"esri-expand__container",containerExpanded:"esri-expand__container--expanded",panel:"esri-expand__panel",button:"esri-widget--button",text:"esri-icon-font-fallback-text",icon:"esri-collapse__icon",iconExpanded:"esri-expand__icon--expanded",iconNumber:"esri-expand__icon-number",iconNumberExpanded:"esri-expand__icon-number--expanded",expandIcon:"esri-icon-expand",collapseIcon:"esri-icon-collapse",content:"esri-expand__content",contentExpanded:"esri-expand__content--expanded",expandMask:"esri-expand__mask",expandMaskExpanded:"esri-expand__mask--expanded"};let Ys=class extends Wn{constructor(e,t){super(e,t),this.autoCollapse=null,this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expanded=null,this.expandTooltip="",this.group=null,this.iconNumber=0,this.label=void 0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.view=null,this.viewModel=new GAe,this._handleKeyDown=i=>{const{closeOnEsc:r,_toggleButtonEl:s,expanded:n}=this;!n||!r||i.target===s||i.key!=="Escape"||(typeof r=="function"?r(i):r)&&(this.expanded=!1,s==null||s.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:i,expandTooltip:r}=this;return e?i||t.collapse:r||t.expand}get collapseIconClass(){return An.collapseIcon}set collapseIconClass(e){e?this._override("collapseIconClass",e):this._clearOverride("collapseIconClass")}get expandIconClass(){return qF(this.content)?this.content.iconClass:An.expandIcon}set expandIconClass(e){e?this._override("expandIconClass",e):this._clearOverride("expandIconClass")}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:e}=this,t={[An.modeAuto]:e==="auto",[An.modeDrawer]:e==="drawer",[An.modeFloating]:e==="floating"};return k("div",{class:this.classes(An.base,t),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:e}=this,t={[An.containerExpanded]:e};return k("div",{class:this.classes(An.container,t)},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:e}=this,t={[An.expandMaskExpanded]:e};return k("div",{bind:this,onclick:this._toggle,class:this.classes(An.expandMask,t)})}renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?k("span",{key:"expand__icon-number",class:An.iconNumber},t):null}renderPanelNumber(){const{iconNumber:e,expanded:t}=this;return e&&t?k("span",{key:"expand__expand-icon-number",class:this.classes(An.iconNumber,An.iconNumberExpanded)},e):null}renderIcon(){const{collapseIconClass:e,expandIconClass:t,expanded:i}=this,r={[An.iconExpanded]:i,[e]:i,[t]:!i};return e===t&&(r[e]=!0),k("span",{"aria-hidden":"true",class:this.classes(An.icon,r)})}renderTitle(){return k("span",{class:An.text},this.expandTitle)}renderExpandButton(){const{expanded:e,expandTitle:t,contentId:i}=this;return k("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":i,"aria-expanded":e?"true":"false",bind:this,class:An.button,onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:t},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return k("div",{class:An.panel},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:e,contentId:t,content:i}=this,r={[An.contentExpanded]:e},s={id:t,role:"region",class:this.classes(An.content,r)};return typeof i=="string"?k("div",F({key:"content__string",innerHTML:i},s)):qF(i)?k("div",F({key:"content__widget"},s),i.render()):i instanceof HTMLElement?k("div",F({key:"content__html-element",bind:i,afterCreate:this._attachToNode},s)):x0e(i)?k("div",F({key:"content__node",bind:i.domNode,afterCreate:this._attachToNode},s)):null}_toggle(){this.toggle()}_attachToNode(e){const t=this;e.appendChild(t)}_storeToggleButtonEl(e){this._toggleButtonEl=e}};u([d({readOnly:!0})],Ys.prototype,"contentId",null),u([d({readOnly:!0})],Ys.prototype,"expandTitle",null),u([Xe("viewModel.autoCollapse")],Ys.prototype,"autoCollapse",void 0),u([d()],Ys.prototype,"closeOnEsc",void 0),u([d()],Ys.prototype,"collapseIconClass",null),u([d()],Ys.prototype,"collapseTooltip",void 0),u([d()],Ys.prototype,"content",void 0),u([Xe("viewModel.expanded")],Ys.prototype,"expanded",void 0),u([d()],Ys.prototype,"expandIconClass",null),u([d()],Ys.prototype,"expandTooltip",void 0),u([Xe("viewModel.group")],Ys.prototype,"group",void 0),u([d()],Ys.prototype,"iconNumber",void 0),u([d({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ys.prototype,"label",void 0),u([d(),dn("esri/widgets/Expand/t9n/Expand")],Ys.prototype,"messages",void 0),u([d(),dn("esri/t9n/common")],Ys.prototype,"messagesCommon",void 0),u([d()],Ys.prototype,"mode",void 0),u([Xe("viewModel.view")],Ys.prototype,"view",void 0),u([d({type:GAe})],Ys.prototype,"viewModel",void 0),u([gl()],Ys.prototype,"_toggle",null),Ys=u([P("esri.widgets.Expand")],Ys);const QCt=Ys;export{qh as $,Fwt as A,WE as B,R as C,Yt as D,IX as E,lt as F,Mee as G,q2 as H,MM as I,hE as J,l4 as K,nqe as L,S$e as M,S_e as N,Jr as O,UX as P,ie as Q,VEt as R,I3 as S,BEt as T,qi as U,sE as V,ert as W,ny as X,Fh as Y,ut as Z,Us as _,YCt as a,un as a$,LEt as a0,jEt as a1,tEt as a2,Y5 as a3,iEt as a4,rEt as a5,CX as a6,G5 as a7,t1e as a8,eEt as a9,ai as aA,aE as aB,Wt as aC,zEt as aD,H2 as aE,UEt as aF,JEt as aG,nJ as aH,kEt as aI,FEt as aJ,jo as aK,ns as aL,nC as aM,yt as aN,cn as aO,j as aP,YTe as aQ,gs as aR,sn as aS,wTt as aT,xu as aU,ho as aV,qv as aW,xr as aX,np as aY,_w as aZ,se as a_,as as aa,IEt as ab,oNe as ac,Rl as ad,rm as ae,sht as af,Yrt as ag,ku as ah,fi as ai,mW as aj,he as ak,oSt as al,fe as am,ed as an,vo as ao,G2 as ap,hGe as aq,vt as ar,mr as as,nX as at,ae as au,Zf as av,Lu as aw,O as ax,Gs as ay,ry as az,h4 as b,F7 as b$,de as b0,le as b1,ot as b2,mu as b3,QP as b4,PEt as b5,nte as b6,CEt as b7,Jrt as b8,Z5 as b9,xi as bA,je as bB,Ee as bC,pi as bD,gr as bE,hp as bF,os as bG,Zt as bH,Je as bI,ar as bJ,n5 as bK,Ge as bL,cye as bM,lv as bN,re as bO,q5 as bP,Y0e as bQ,Kme as bR,gSt as bS,_ie as bT,tVe as bU,W0e as bV,M6e as bW,uSt as bX,LIe as bY,wke as bZ,Q0e as b_,im as ba,hTt as bb,rx as bc,nht as bd,WQ as be,pAe as bf,Wf as bg,ln as bh,zE as bi,kt as bj,O2e as bk,aSt as bl,ZCt as bm,dr as bn,ck as bo,lEt as bp,Jg as bq,Dpe as br,Wb as bs,oee as bt,Npe as bu,Eht as bv,Ci as bw,yTt as bx,Ehe as by,The as bz,Ape as c,gm as c$,I6e as c0,hj as c1,Dk as c2,Ll as c3,VE as c4,sj as c5,js as c6,bI as c7,qd as c8,z6e as c9,c1e as cA,khe as cB,fY as cC,gY as cD,yY as cE,Gk as cF,Dpt as cG,Ki as cH,bc as cI,KM as cJ,ox as cK,j_e as cL,Ie as cM,WD as cN,vTt as cO,g_ as cP,Y2 as cQ,m9e as cR,ha as cS,RTt as cT,nn as cU,qt as cV,mi as cW,vl as cX,_l as cY,sa as cZ,Ec as c_,RMe as ca,wi as cb,ey as cc,$5 as cd,X9e as ce,mm as cf,Sc as cg,et as ch,Qg as ci,WGe as cj,XGe as ck,ZGe as cl,P6e as cm,O6e as cn,Zue as co,Gn as cp,mZ as cq,lRe as cr,qSt as cs,nE as ct,Cw as cu,eGe as cv,pSt as cw,LA as cx,ASt as cy,N3 as cz,vPe as d,fEt as d$,PD as d0,vO as d1,aY as d2,r4 as d3,Ls as d4,J8e as d5,Nv as d6,Na as d7,Y8e as d8,Yh as d9,i9e as dA,s9e as dB,hfe as dC,$c as dD,yO as dE,O8e as dF,Z8e as dG,W8e as dH,B8e as dI,p9e as dJ,u9e as dK,c9e as dL,B2t as dM,h9e as dN,d9e as dO,G8e as dP,j8e as dQ,X8e as dR,a9e as dS,XZ as dT,H2t as dU,k8e as dV,U8e as dW,N8e as dX,D8e as dY,ES as dZ,Mqe as d_,H8e as da,V8e as db,z8e as dc,Ew as dd,fu as de,__e as df,Vu as dg,CVe as dh,L8e as di,F8e as dj,ii as dk,v_e as dl,Mu as dm,Q8e as dn,q8e as dp,f9 as dq,ux as dr,NW as ds,K8e as dt,e9e as du,Su as dv,Jw as dw,t9e as dx,nY as dy,r9e as dz,Gfe as e,dC as e$,Zpt as e0,oCt as e1,MJ as e2,X5 as e3,bu as e4,Ep as e5,nc as e6,O3 as e7,Fr as e8,M as e9,ym as eA,Re as eB,H as eC,hr as eD,rr as eE,la as eF,pr as eG,sr as eH,Ui as eI,Bt as eJ,xy as eK,tU as eL,w_ as eM,Nl as eN,SU as eO,ri as eP,am as eQ,d_ as eR,T_ as eS,AU as eT,bm as eU,EU as eV,bU as eW,Vw as eX,BU as eY,ant as eZ,ZY as e_,Xb as ea,Sk as eb,Wi as ec,ti as ed,Ns as ee,wt as ef,kr as eg,IE as eh,cEt as ei,QL as ej,Qw as ek,Pdt as el,Zi as em,Iu as en,Uo as eo,vi as ep,Age as eq,x as er,vs as es,zu as et,jt as eu,We as ev,K as ew,V4 as ex,vm as ey,gt as ez,BCt as f,$Ct as f$,kTe as f0,Es as f1,hk as f2,rn as f3,tyt as f4,epe as f5,DTt as f6,w3e as f7,lyt as f8,sGe as f9,q2e as fA,A5 as fB,uw as fC,UDe as fD,ze as fE,Fg as fF,qNe as fG,Ae as fH,Vr as fI,$Qe as fJ,LCt as fK,yCt as fL,DCt as fM,mQ as fN,jJ as fO,j8 as fP,MCt as fQ,ECt as fR,CCt as fS,SCt as fT,R7 as fU,Hxe as fV,Dc as fW,qyt as fX,TCt as fY,Ngt as fZ,gC as f_,Nq as fa,R2 as fb,ja as fc,FHe as fd,are as fe,Br as ff,J2t as fg,o1e as fh,dwt as fi,u1e as fj,wwt as fk,dv as fl,nu as fm,qS as fn,WS as fo,fGe as fp,R_e as fq,Hk as fr,at as fs,a1e as ft,V5 as fu,lee as fv,Cu as fw,Vpe as fx,mc as fy,Ty as fz,I$e as g,Sn as g$,Fgt as g0,RSt as g1,wce as g2,w2 as g3,Kb as g4,Hr as g5,DDe as g6,Qh as g7,jg as g8,OSt as g9,zTt as gA,iZ as gB,Me as gC,FCt as gD,NCt as gE,kCt as gF,mEt as gG,N2 as gH,cr as gI,Lgt as gJ,s2t as gK,uCt as gL,zh as gM,RW as gN,ATt as gO,HO as gP,YM as gQ,Bu as gR,NEt as gS,$we as gT,sp as gU,crt as gV,yyt as gW,vyt as gX,gCt as gY,Cv as gZ,HNe as g_,bi as ga,an as gb,xp as gc,bCt as gd,pNe as ge,eyt as gf,Hb as gg,ICt as gh,Ji as gi,jE as gj,PCt as gk,Lt as gl,ayt as gm,bme as gn,wme as go,DEt as gp,OCt as gq,xCt as gr,wCt as gs,LX as gt,OF as gu,tX as gv,Jz as gw,De as gx,Pi as gy,Xt as gz,zf as h,nGe as h$,ur as h0,xe as h1,Ua as h2,pe as h3,em as h4,QD as h5,Lf as h6,cyt as h7,Cse as h8,_Ct as h9,Lv as hA,hw as hB,ste as hC,aze as hD,R2t as hE,vie as hF,O2t as hG,LTt as hH,Rde as hI,hOe as hJ,b2t as hK,uve as hL,dve as hM,lve as hN,BTt as hO,xEt as hP,Xde as hQ,UOe as hR,PTt as hS,Oc as hT,C$e as hU,A$e as hV,ve as hW,V3 as hX,KE as hY,tve as hZ,REt as h_,nee as ha,uEt as hb,Ddt as hc,uRe as hd,r2t as he,Wh as hf,xNe as hg,TNe as hh,gW as hi,zge as hj,ROe as hk,DOe as hl,qb as hm,pve as hn,Qde as ho,LW as hp,MTt as hq,Pl as hr,kZ as hs,oze as ht,U2 as hu,Mc as hv,eVe as hw,ITt as hx,xS as hy,KR as hz,Rt as i,w2t as i$,gGe as i0,CMe as i1,qCt as i2,VTt as i3,NTt as i4,kTt as i5,FTt as i6,UTt as i7,QM as i8,Gh as i9,ft as iA,Ve as iB,mt as iC,Et as iD,Ke as iE,Rr as iF,Xa as iG,nt as iH,Wa as iI,Ze as iJ,er as iK,ko as iL,sy as iM,ls as iN,d8 as iO,yi as iP,m4 as iQ,__ as iR,wU as iS,bEt as iT,it as iU,gi as iV,vge as iW,PSt as iX,hye as iY,W2t as iZ,D5 as i_,b3e as ia,TTe as ib,SEt as ic,Qit as id,MEt as ie,Lpe as ig,iSt as ih,_Tt as ii,aCt as ij,KTt as ik,z5 as il,F6e as im,OEt as io,Lr as ip,rve as iq,z_e as ir,b_ as is,Fnt as it,Ws as iu,$u as iv,$t as iw,Tf as ix,ss as iy,Mi as iz,FX as j,wEt as j$,pTt as j0,jn as j1,lJ as j2,Ol as j3,Yi as j4,GL as j5,Yde as j6,CTt as j7,M2t as j8,xSt as j9,Lb as jA,dCt as jB,pCt as jC,sSt as jD,DPe as jE,rb as jF,hCt as jG,j4 as jH,e_ as jI,Tr as jJ,zg as jK,El as jL,Lc as jM,wy as jN,yo as jO,dt as jP,lSt as jQ,U3 as jR,Ri as jS,Si as jT,ca as jU,kpe as jV,fCt as jW,mCt as jX,sX as jY,kNe as jZ,ak as j_,lfe as ja,vw as jb,aq as jc,A3 as jd,Hh as je,HSt as jf,Vwt as jg,rhe as jh,P_e as ji,Kw as jj,A2 as jk,qe as jl,KK as jm,Kze as jn,Jze as jo,iu as jp,CSt as jq,TTt as jr,Uv as js,$v as jt,_I as ju,VW as jv,zW as jw,BW as jx,X0e as jy,OTt as jz,u as k,Rh as k$,Hs as k0,oi as k1,Ei as k2,QEt as k3,ACt as k4,RCt as k5,G0e as k6,dR as k7,qge as k8,MMe as k9,p7 as kA,RF as kB,sNe as kC,iw as kD,kme as kE,Of as kF,iCt as kG,nCt as kH,W2e as kI,Xle as kJ,tCt as kK,rCt as kL,eCt as kM,FM as kN,AD as kO,Npt as kP,id as kQ,qTt as kR,sQ as kS,ka as kT,qle as kU,dpt as kV,ppt as kW,aEt as kX,X3 as kY,oEt as kZ,Cs as k_,v4 as ka,FP as kb,cCt as kc,pce as kd,lCt as ke,fa as kf,i2 as kg,oE as kh,Ic as ki,Yb as kj,Zg as kk,L5 as kl,WX as km,hyt as kn,vCt as ko,TOe as kp,kEe as kq,Ue as kr,whe as ks,KL as kt,P2 as ku,Lft as kv,C1t as kw,h7 as kx,ds as ky,u7 as kz,Pe as l,k5 as l$,ZO as l0,d2t as l1,$l as l2,JF as l3,UFe as l4,hNe as l5,BSt as l6,uNe as l7,we as l8,ct as l9,Nme as lA,wSt as lB,ESt as lC,SSt as lD,TSt as lE,$f as lF,SO as lG,Fo as lH,xk as lI,t2t as lJ,i2t as lK,KSt as lL,e2t as lM,Ss as lN,Sy as lO,Ba as lP,EJ as lQ,wdt as lR,BS as lS,pq as lT,Hw as lU,Di as lV,iS as lW,wge as lX,_o as lY,pn as lZ,yl as l_,RE as la,ww as lb,Ou as lc,MSt as ld,USt as le,zSt as lf,NY as lg,rne as lh,Dt as li,kf as lj,cme as lk,eLe as ll,KS as lm,nNe as ln,ni as lo,bo as lp,Dr as lq,JM as lr,HEt as ls,_fe as lt,WTt as lu,tn as lv,_St as lw,vSt as lx,uLe as ly,lLe as lz,HCt as m,QX as m$,Hv as m0,tWe as m1,pc as m2,Wd as m3,Js as m4,fbe as m5,FY as m6,JS as m7,lR as m8,uy as m9,ew as mA,AJe as mB,_Et as mC,yEt as mD,vEt as mE,NSt as mF,l_t as mG,O2 as mH,o9 as mI,Vit as mJ,rrt as mK,pEt as mL,Rb as mM,Cc as mN,bSt as mO,tr as mP,_se as mQ,wW as mR,Tg as mS,kwe as mT,ax as mU,nZ as mV,YTt as mW,FSt as mX,tSt as mY,vse as mZ,pm as m_,oZ as ma,J2 as mb,lr as mc,cM as md,fk as me,GSt as mf,gw as mg,jSt as mh,aWe as mi,hWe as mj,i7 as mk,Sp as ml,Yr as mm,kY as mn,fPe as mo,He as mp,Vs as mq,VSt as mr,iFe as ms,VX as mt,Mh as mu,bee as mv,SQ as mw,fm as mx,fo as my,Tl as mz,d as n,GNe as n$,age as n0,tm as n1,Or as n2,nm as n3,Tt as n4,Vo as n5,CU as n6,xU as n7,pt as n8,Xi as n9,GQ as nA,nk as nB,XTt as nC,oRe as nD,kSt as nE,Rz as nF,IF as nG,b1t as nH,UCt as nI,VCt as nJ,zCt as nK,WW as nL,yW as nM,eSt as nN,p1 as nO,yse as nP,hf as nQ,Yw as nR,S5 as nS,lZ as nT,cO as nU,X2 as nV,QTt as nW,oKe as nX,cZ as nY,Bme as nZ,W2 as n_,nSt as na,lle as nb,sZ as nc,_s as nd,xO as ne,hEt as nf,JTt as ng,ISt as nh,tp as ni,Uu as nj,GU as nk,zr as nl,qa as nm,Va as nn,Ni as no,En as np,Bxe as nq,LSt as nr,utt as ns,Fu as nt,Eu as nu,NNe as nv,Mp as nw,Yxe as nx,CE as ny,D2 as nz,P as o,Bat as o$,Fae as o0,Ac as o1,v_ as o2,xFe as o3,ty as o4,gk as o5,RXe as o6,$St as o7,KEt as o8,O5 as o9,uOe as oA,Z2t as oB,E9e as oC,M8e as oD,a3e as oE,Dbe as oF,GY as oG,Nbe as oH,fy as oI,gc as oJ,As as oK,Nu as oL,uP as oM,Xme as oN,hn as oO,KU as oP,WDe as oQ,XEt as oR,pE as oS,h_ as oT,qEt as oU,ZEt as oV,WEt as oW,Uat as oX,Gat as oY,zat as oZ,Vat as o_,lx as oa,Du as ob,PDe as oc,Vf as od,dEt as oe,dn as of,Wn as og,k as oh,_h as oi,M7 as oj,qF as ok,Gr as ol,Ohe as om,e2 as on,eO as oo,Xpe as op,hSt as oq,C3 as or,Fi as os,fp as ot,H5 as ou,kE as ov,fSt as ow,o2t as ox,a2t as oy,TEt as oz,dm as p,WSt as p$,y2t as p0,C2t as p1,E2t as p2,J_e as p3,Xze as p4,fve as p5,T2t as p6,x2t as p7,GTt as p8,jTt as p9,uc as pA,S2t as pB,Lk as pC,AEe as pD,$i as pE,oy as pF,Au as pG,vv as pH,CY as pI,dp as pJ,YJ as pK,DSt as pL,KNe as pM,ETt as pN,STt as pO,uIe as pP,pX as pQ,sCt as pR,cc as pS,vW as pT,Wle as pU,XP as pV,e6 as pW,VPe as pX,JSt as pY,ZSt as pZ,YSt as p_,HTt as pa,uPe as pb,AEt as pc,EEt as pd,Cl as pe,R6e as pf,T$e as pg,JOe as ph,h6e as pi,P2t as pj,x6e as pk,aie as pl,ive as pm,A2t as pn,tDe as po,mSt as pp,a7 as pq,L6 as pr,D6 as ps,n9 as pt,nRe as pu,fTt as pv,mTt as pw,gu as px,g2t as py,gTt as pz,Ha as q,ovt as q$,Bye as q0,O5e as q1,QSt as q2,XSt as q3,EEe as q4,ogt as q5,Hn as q6,bze as q7,pO as q8,uH as q9,iit as qA,B4 as qB,znt as qC,Hnt as qD,Ont as qE,xn as qF,go as qG,_ft as qH,sCe as qI,O0t as qJ,PZe as qK,Vrt as qL,n2t as qM,Rnt as qN,xft as qO,wft as qP,uz as qQ,Tft as qR,q4 as qS,$st as qT,XEe as qU,Kyt as qV,qJ as qW,tvt as qX,oCe as qY,svt as qZ,aCe as q_,nEt as qa,Z3 as qb,wze as qc,hze as qd,m2t as qe,h2t as qf,u2t as qg,l2t as qh,TS as qi,pze as qj,c2t as qk,uze as ql,cze as qm,R3 as qn,cot as qo,p2t as qp,f2t as qq,AWe as qr,qXe as qs,twe as qt,MZe as qu,JZe as qv,oQ as qw,iYe as qx,wYe as qy,PYe as qz,_ as r,XE as r$,lCe as r0,bvt as r1,xz as r2,Rvt as r3,Fvt as r4,snt as r5,xvt as r6,Kvt as r7,Kot as r8,Hat as r9,Xv as rA,ZM as rB,q_e as rC,H_e as rD,Pc as rE,Q5 as rF,xc as rG,wGe as rH,rGe as rI,oGe as rJ,IGe as rK,cF as rL,Kde as rM,s7e as rN,qk as rO,W3 as rP,a4 as rQ,VD as rR,Bk as rS,G_e as rT,xY as rU,n1e as rV,Xe as rW,a9 as rX,$6 as rY,YRe as rZ,h7e as r_,aut as ra,Out as rb,Sut as rc,hX as rd,fX as re,Yu as rf,kat as rg,GEt as rh,iGe as ri,vY as rj,sqe as rk,iqe as rl,KHe as rm,rse as rn,W1e as ro,ua as rp,MGe as rq,Cpe as rr,bZ as rs,sAe as rt,pY as ru,f_ as rv,xwt as rw,K2t as rx,mY as ry,W5 as rz,Nwt as s,N2t as s$,ir as s0,Vfe as s1,Hfe as s2,Fze as s3,MLe as s4,kze as s5,xme as s6,n4 as s7,xTt as s8,zfe as s9,uY as sA,vGe as sB,yGe as sC,UE as sD,Ffe as sE,Y2t as sF,wc as sG,mp as sH,cSt as sI,sfe as sJ,Qf as sK,mGe as sL,Q2t as sM,oOe as sN,GK as sO,N as sP,ySt as sQ,V2t as sR,ere as sS,$2t as sT,Kie as sU,o9e as sV,z2t as sW,j2t as sX,G2t as sY,D2t as sZ,L2t as s_,xF as sa,tGe as sb,$Tt as sc,Bs as sd,bTt as se,yw as sf,rSt as sg,Ag as sh,Vt as si,WCt as sj,qw as sk,bW as sl,Jf as sm,FT as sn,l1e as so,XCt as sp,tF as sq,bM as sr,c7 as ss,j1e as st,Yf as su,qf as sv,nme as sw,efe as sx,dTt as sy,M_e as sz,yv as t,oq as t$,F2t as t0,U2t as t1,$8e as t2,ire as t3,k2t as t4,n9e as t5,Vk as t6,w_e as t7,x_e as t8,Qge as t9,CNe as tA,Nf as tB,KSe as tC,_W as tD,gXe as tE,dSt as tF,u2e as tG,d2e as tH,$M as tI,Eb as tJ,qn as tK,Fl as tL,Kh as tM,Qx as tN,ZTt as tO,iJ as tP,vlt as tQ,n2e as tR,dlt as tS,c2e as tT,a2e as tU,ylt as tV,vq as tW,l2e as tX,s_ as tY,plt as tZ,r_ as t_,vFe as ta,ra as tb,cqe as tc,X2t as td,yje as te,c4 as tf,yb as tg,q1 as th,Yk as ti,Zk as tj,pje as tk,I2t as tl,RY as tm,Rme as tn,BLe as to,kX as tp,Mme as tq,VLe as tr,clt as ts,yq as tt,QGe as tu,JGe as tv,KGe as tw,hm as tx,CXe as ty,RNe as tz,Nt as u,Lw as u0,ist as u1,qlt as u2,Hlt as u3,jlt as u4,gEt as u5,gfe as u6,v2t as u7,_2t as u8,q2t as u9,sEt as ua,$Et as ub,YEt as uc,GCt as ud,jCt as ue,Go as v,ix as w,QCt as x,Se as y,HE as z};
